{"url": "https://api.github.com/repos/rust-lang/rust/issues/35139", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/35139/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/35139/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/35139/events", "html_url": "https://github.com/rust-lang/rust/issues/35139", "id": 168529845, "node_id": "MDU6SXNzdWUxNjg1Mjk4NDU=", "number": 35139, "title": "Unsound: Borrowck missing that closure needs to be \"move\" ", "user": {"login": "diwic", "id": 9721510, "node_id": "MDQ6VXNlcjk3MjE1MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/9721510?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diwic", "html_url": "https://github.com/diwic", "followers_url": "https://api.github.com/users/diwic/followers", "following_url": "https://api.github.com/users/diwic/following{/other_user}", "gists_url": "https://api.github.com/users/diwic/gists{/gist_id}", "starred_url": "https://api.github.com/users/diwic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diwic/subscriptions", "organizations_url": "https://api.github.com/users/diwic/orgs", "repos_url": "https://api.github.com/users/diwic/repos", "events_url": "https://api.github.com/users/diwic/events{/privacy}", "received_events_url": "https://api.github.com/users/diwic/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-07-31T17:58:10Z", "updated_at": "2016-08-01T00:38:58Z", "closed_at": "2016-08-01T00:38:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Here's as far as I've come in minifying the problem. It gives bad result on both Stable, Beta and Nightly according to playground.\n\n```\npub trait MethodType: Sized + Default {\n    type GetProp: ?Sized;\n}\n\n#[derive(Default, Debug, Copy, Clone)]\npub struct MTFn;\n\nimpl<'a> MethodType for MTFn {\n    type GetProp = Fn(&mut String) -> Result<(), ()> + 'a;\n}\n\npub struct Property<M: MethodType> {\n    get_cb: Option<Box<M::GetProp>>,\n}\n\nimpl<'a> Property<MTFn> {\n    pub fn on_get<H>(mut self, handler: H) -> Property<MTFn>\n        where H: Fn(&mut String) -> Result<(), ()> + 'a {\n        self.get_cb = Some(Box::new(handler) as Box<_>);\n        self\n    }\n}\n\nfn main() {\n    let z: Option<Property<MTFn>>;\n    {\n        let mut v = format!(\"ABC DEF GHI JKL\");\n        let p = Property { get_cb: None };\n\n        // This line should give an error indicating we need a \"move\" closure\n        z = Some(p.on_get(|s| { *s = v.clone(); Ok(()) }));\n\n        // Destroy v to show the error\n        v = format!(\"MNO PQR\");\n    }\n    let mut q = format!(\"STU\");\n    let _ = (z.unwrap().get_cb.unwrap())(&mut q);\n    println!(\"{}\", q); // Prints \"STU PQR\" !\n}\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/35139/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/35139/timeline", "performed_via_github_app": null, "state_reason": "completed"}