{"url": "https://api.github.com/repos/rust-lang/rust/issues/45852", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45852/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45852/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45852/events", "html_url": "https://github.com/rust-lang/rust/issues/45852", "id": 272009475, "node_id": "MDU6SXNzdWUyNzIwMDk0NzU=", "number": 45852, "title": "Tracking issue for the change to LUB/GLB", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 630636017, "node_id": "MDU6TGFiZWw2MzA2MzYwMTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-future-compatibility", "name": "C-future-compatibility", "color": "f5f1fd", "default": false, "description": "Category: future compatibility lints"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-11-07T22:34:51Z", "updated_at": "2019-11-26T20:45:28Z", "closed_at": "2019-11-26T20:45:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This issue proposes to change the LUB/GLB strategy in rustc to adopt something that is more conservative, but also more correct, and also more forwards compatible.\r\n\r\n### How this affects you\r\n\r\nIn some limited cases, you may need to alter your Rust code to \"cast\" the types of functions more explicitly. This can occur specifically when combining function pointers or trait objects that involve lifetimes. For example, the following function no longer compiles:\r\n\r\n```rust\r\nfn foo(\r\n    x: fn(&u8, &u8),\r\n    y: for<'a> fn(&'a u8, &'a u8),\r\n) {       \r\n    let z = match 22 {\r\n        0 => x,\r\n        _ => y,\r\n    };\r\n}\r\n```\r\n\r\nThe fix is to \"upcast\" `x` and `y` into a common type. In this case, since `x`  accepts arguments with two distinct lifetimes, but `y` requires a single lifetime, we would want to pick the type of `y` (which is more selective).\r\n\r\n\r\n```rust\r\nfn foo(\r\n    x: fn(&u8, &u8),\r\n    y: for<'a> fn(&'a u8, &'a u8),\r\n) {       \r\n    let z = match 22 {\r\n        0 => x as for<'a> fn(&'a u8, &'a u8),\r\n        //     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ explicit cast\r\n        _ => y,\r\n    };\r\n}\r\n```\r\n\r\n### Background: why is this change being made?\r\n\r\nSimply put, the existing code for handling function types of this kind if known to be buggy and incomplete. Since this scenario -- combining two function pointers with distinct signatures -- occurs quite rarely (in fact, no known instances were encountered), it was decided to adopt a simpler, more conservative approach that is known to be correct.\r\n\r\nMore specifically, we adopted a rule that computing the least-upper-bound (common supertype) of two higher-ranked types (e.g., function pointers, trait objects) is done by requiring them to be equal. \r\n\r\n### What happens now?\r\n\r\nGiven that we did not find any occurrences of this code in our crater run, and that a **full** warning period is difficult to achieve, we opted to move straight to a hard-error with this code. If you are having problems fixing your code, or would like to object to this decision, please leave a comment (cc @nikomatsakis) or -- perhaps better yet -- reach out on IRC (`nmatsakis`).\r\n\r\n", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45852/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45852/timeline", "performed_via_github_app": null, "state_reason": "completed"}