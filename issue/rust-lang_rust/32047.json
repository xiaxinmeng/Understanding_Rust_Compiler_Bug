{"url": "https://api.github.com/repos/rust-lang/rust/issues/32047", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/32047/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/32047/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/32047/events", "html_url": "https://github.com/rust-lang/rust/issues/32047", "id": 138567346, "node_id": "MDU6SXNzdWUxMzg1NjczNDY=", "number": 32047, "title": "Build with --disable-elf-tls doesn't disable tls", "user": {"login": "rillian", "id": 225102, "node_id": "MDQ6VXNlcjIyNTEwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/225102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rillian", "html_url": "https://github.com/rillian", "followers_url": "https://api.github.com/users/rillian/followers", "following_url": "https://api.github.com/users/rillian/following{/other_user}", "gists_url": "https://api.github.com/users/rillian/gists{/gist_id}", "starred_url": "https://api.github.com/users/rillian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rillian/subscriptions", "organizations_url": "https://api.github.com/users/rillian/orgs", "repos_url": "https://api.github.com/users/rillian/repos", "events_url": "https://api.github.com/users/rillian/events{/privacy}", "received_events_url": "https://api.github.com/users/rillian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-03-04T19:41:45Z", "updated_at": "2017-05-01T13:02:03Z", "closed_at": "2017-05-01T13:02:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Sorry for not testing this earlier, but the no-tls builds we were doing for gecko seem to be broken in 1.7.0.\n\nIf I set `MACOSX_DEPLOYMENT_TARGET=10.7` and `configure --disable-elf-tls` as before, the resulting build uses thread-local storage:\n\n```\n 15:57:48 INFO - ld: targeted OS version does not support use of thread local variables in __ZN10sys_common11thread_info14current_thread20h4ec593d7ee7ff5477SsE for architecture x86_64\n```\n\nSo it seems like --disable-elf-tls is broken. The target_thread_local changes in #30417 added MACOSX_DEPLOYMENT_TARGET-based detection. However, it seems building against a 10.6 target also doesn't work:\n\n```\n$ MACOSX_DEPLOYMENT_TARGET=10.6 ./configure --prefix=_dist/rustc --target=x86_64-apple-darwin,i686-apple-darwin --disable-docs\n[...]\n$ MACOSX_DEPLOYMENT_TARGET=10.6 make -j8\n[...]\nclang: error: invalid deployment target for -stdlib=libc++ (requires OS X 10.7 or later)\n```\n\nIs there an sdk I'm missing or has llvm dropped 10.6 support?\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/32047/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/32047/timeline", "performed_via_github_app": null, "state_reason": "completed"}