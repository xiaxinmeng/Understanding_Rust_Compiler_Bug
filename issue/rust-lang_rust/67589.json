{"url": "https://api.github.com/repos/rust-lang/rust/issues/67589", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67589/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67589/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67589/events", "html_url": "https://github.com/rust-lang/rust/issues/67589", "id": 542156438, "node_id": "MDU6SXNzdWU1NDIxNTY0Mzg=", "number": 67589, "title": "ICE with 1.40", "user": {"login": "agbaroni", "id": 1510959, "node_id": "MDQ6VXNlcjE1MTA5NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1510959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/agbaroni", "html_url": "https://github.com/agbaroni", "followers_url": "https://api.github.com/users/agbaroni/followers", "following_url": "https://api.github.com/users/agbaroni/following{/other_user}", "gists_url": "https://api.github.com/users/agbaroni/gists{/gist_id}", "starred_url": "https://api.github.com/users/agbaroni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/agbaroni/subscriptions", "organizations_url": "https://api.github.com/users/agbaroni/orgs", "repos_url": "https://api.github.com/users/agbaroni/repos", "events_url": "https://api.github.com/users/agbaroni/events{/privacy}", "received_events_url": "https://api.github.com/users/agbaroni/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-12-24T15:17:12Z", "updated_at": "2020-02-29T23:28:54Z", "closed_at": "2020-02-29T23:28:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello,\r\n\r\nthis simple code returns an ICE with cargo run:\r\n\r\n```rust\r\nenum TokenType {\r\n}\r\n\r\n#[derive(Clone, Copy)]\r\nstruct Position {\r\n    column: u64,\r\n    line: u64\r\n}\r\n\r\nstruct Token {\r\n    position: Position,\r\n    type_: TokenType,\r\n    value: String\r\n}\r\n\r\nfn main() {\r\n}\r\n\r\n```\r\n\r\nThis is the backtrace:\r\n```\r\nerror: internal compiler error: src/librustc/dep_graph/graph.rs:680: DepNode Hir(nitor_scheme[e747]::Token[0]::value[0]) should have been pre-allocated but wasn't.\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:931:9\r\nstack backtrace:\r\n   0:     0x7f0695515b24 - backtrace::backtrace::libunwind::trace::h65597d255cb1398b\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88\r\n   1:     0x7f0695515b24 - backtrace::backtrace::trace_unsynchronized::hd4f479d7150ec4a0\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/mod.rs:66\r\n   2:     0x7f0695515b24 - std::sys_common::backtrace::_print_fmt::h015072984a2b172c\r\n                               at src/libstd/sys_common/backtrace.rs:77\r\n   3:     0x7f0695515b24 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h6df05d3335f32194\r\n                               at src/libstd/sys_common/backtrace.rs:61\r\n   4:     0x7f069554e45c - core::fmt::write::h1f444f4312eb6c27\r\n                               at src/libcore/fmt/mod.rs:1028\r\n   5:     0x7f0695509f07 - std::io::Write::write_fmt::h8d147888220078ef\r\n                               at src/libstd/io/mod.rs:1412\r\n   6:     0x7f069551a38e - std::sys_common::backtrace::_print::h8a6df0fa81d6af62\r\n                               at src/libstd/sys_common/backtrace.rs:65\r\n   7:     0x7f069551a38e - std::sys_common::backtrace::print::h6f05b4733407e509\r\n                               at src/libstd/sys_common/backtrace.rs:50\r\n   8:     0x7f069551a38e - std::panicking::default_hook::{{closure}}::h0d0a23bd02315dd8\r\n                               at src/libstd/panicking.rs:188\r\n   9:     0x7f069551a081 - std::panicking::default_hook::h8d15a9aecb4efac6\r\n                               at src/libstd/panicking.rs:205\r\n  10:     0x7f06959fb853 - rustc_driver::report_ice::h604244c68c1c9a3a\r\n  11:     0x7f069551ab60 - std::panicking::rust_panic_with_hook::hbe174577402a475d\r\n                               at src/libstd/panicking.rs:468\r\n  12:     0x7f069788411d - std::panicking::begin_panic::h58bba5e152fa0bee\r\n  13:     0x7f06978b8473 - rustc_errors::HandlerInner::bug::h7438b1481ec83686\r\n  14:     0x7f06978b733a - rustc_errors::Handler::bug::h4011e86e57f14226\r\n  15:     0x7f06971000d3 - rustc::util::bug::opt_span_bug_fmt::{{closure}}::hb274b8a1780df2dc\r\n  16:     0x7f06970fd793 - rustc::ty::context::tls::with_opt::{{closure}}::h7a7e5562232b0149\r\n  17:     0x7f06970fd703 - rustc::ty::context::tls::with_context_opt::h525375971cd1d6ed\r\n  18:     0x7f06970fd747 - rustc::ty::context::tls::with_opt::h3f94bd5c689d4af2\r\n  19:     0x7f06970fffe8 - rustc::util::bug::opt_span_bug_fmt::h5637bf03a92b95d0\r\n  20:     0x7f06970fff52 - rustc::util::bug::bug_fmt::hfb79a0bf2b371fa1\r\n  21:     0x7f06970aa62e - rustc::dep_graph::graph::DepGraph::try_mark_previous_green::h74a25b2962b19d8f\r\n  22:     0x7f06970a9ee1 - rustc::dep_graph::graph::DepGraph::try_mark_green::h783cf10326639eb8\r\n  23:     0x7f06970a9d5d - rustc::dep_graph::graph::DepGraph::try_mark_green_and_read::h088e27bf030f5a81\r\n  24:     0x7f0696102fbd - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::haa291ed7fecfadf5\r\n  25:     0x7f06961b244c - <rustc_typeck::outlives::implicit_infer::InferVisitor as rustc::hir::itemlikevisit::ItemLikeVisitor>::visit_item::h46947760d3b16f49\r\n  26:     0x7f06961cdf09 - rustc::hir::Crate::visit_all_item_likes::hee5ce7b527af9397\r\n  27:     0x7f06961da92f - rustc_typeck::outlives::inferred_outlives_crate::h84380a3c7dac5826\r\n  28:     0x7f0695fe91e5 - rustc::ty::query::__query_compute::inferred_outlives_crate::h32257f22e659aa48\r\n  29:     0x7f06960378ec - rustc::dep_graph::graph::DepGraph::with_task_impl::h57be74ef47de7e30\r\n  30:     0x7f06960c4b0b - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h0ad054575a564b37\r\n  31:     0x7f06961da4e4 - rustc_typeck::outlives::inferred_outlives_of::h4ecb649ed041f96b\r\n  32:     0x7f0695fe8a5a - rustc::ty::query::__query_compute::inferred_outlives_of::h26400f5a0cd8a817\r\n  33:     0x7f06960b340b - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::inferred_outlives_of>::compute::h12dab411960a0d54\r\n  34:     0x7f0696035324 - rustc::dep_graph::graph::DepGraph::with_task_impl::h3eb481da3650be8d\r\n  35:     0x7f06960dc184 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h4db42ec3df58ac35\r\n  36:     0x7f06960a4897 - rustc_typeck::collect::predicates_defined_on::h590325cb0b3d7229\r\n  37:     0x7f0695fe8c12 - rustc::ty::query::__query_compute::predicates_defined_on::h67ad5fec3c426f82\r\n  38:     0x7f06960b343c - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::predicates_defined_on>::compute::heec42bde4eece152\r\n  39:     0x7f069603a591 - rustc::dep_graph::graph::DepGraph::with_task_impl::h85e1073e233e91a4\r\n  40:     0x7f0696106eff - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hafc10a5a79999f86\r\n  41:     0x7f06960a4b29 - rustc_typeck::collect::predicates_of::h42293ade3b8b48d1\r\n  42:     0x7f0695fe754f - rustc::ty::query::__query_compute::predicates_of::h2471f2a7bf3fae84\r\n  43:     0x7f06960b310c - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::predicates_of>::compute::hfe607691855e423c\r\n  44:     0x7f069603d5a1 - rustc::dep_graph::graph::DepGraph::with_task_impl::hb30b8b10acd5c5ac\r\n  45:     0x7f06960d302d - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h3e57daecd1133c5f\r\n  46:     0x7f069609bfc0 - <rustc_typeck::collect::CollectItemTypesVisitor as rustc::hir::intravisit::Visitor>::visit_item::h6b6ec407b14bfe3f\r\n  47:     0x7f0696013213 - rustc::hir::map::Map::visit_item_likes_in_module::h4c4aa1fa526963f4\r\n  48:     0x7f069609bc14 - rustc_typeck::collect::collect_mod_item_types::h34811f2e4b252d4a\r\n  49:     0x7f0695fe8eda - rustc::ty::query::__query_compute::collect_mod_item_types::heac1873a1e411c55\r\n  50:     0x7f06960b34bb - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::collect_mod_item_types>::compute::h6ca5ef9ca4bcc3cd\r\n  51:     0x7f0696040257 - rustc::dep_graph::graph::DepGraph::with_task_impl::hc5b3fca2a6918254\r\n  52:     0x7f0696111ec0 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hd4708da89736dc71\r\n  53:     0x7f06960b3c95 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::ensure_query::hf66c67084d9786e3\r\n  54:     0x7f06961b3059 - rustc_typeck::check_crate::{{closure}}::{{closure}}::ha0485b0a17522e83\r\n  55:     0x7f069619cc86 - rustc::util::common::time::hf116161cfd242531\r\n  56:     0x7f06961dc19d - rustc_typeck::check_crate::hcef2c601ae2b67e5\r\n  57:     0x7f0695adeb04 - rustc_interface::passes::analysis::h77fd894da5badde0\r\n  58:     0x7f0695a69481 - rustc::ty::query::__query_compute::analysis::h39e6fd766157b8c8\r\n  59:     0x7f0695a6bd39 - rustc::dep_graph::graph::DepGraph::with_task_impl::h7d50a3684e7e1a75\r\n  60:     0x7f06959e3f56 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h8792deed72f3c814\r\n  61:     0x7f0695a6ea3a - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h13f9e1b0bf2386ce\r\n  62:     0x7f0695b3092a - rustc_interface::passes::create_global_ctxt::{{closure}}::h3f8b716b6851e054\r\n  63:     0x7f0695a6e78e - rustc_interface::passes::BoxedGlobalCtxt::enter::h710e6729620e7fd4\r\n  64:     0x7f0695a3e7c7 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h0a60318490fa2acb\r\n  65:     0x7f0695a1f112 - std::thread::local::LocalKey<T>::with::h6fe64a0878c37a25\r\n  66:     0x7f0695a1cbce - scoped_tls::ScopedKey<T>::set::h7c068b51568535e7\r\n  67:     0x7f0695a4b264 - syntax::with_globals::heb0c291b2ded5098\r\n  68:     0x7f0695a638d0 - std::sys_common::backtrace::__rust_begin_short_backtrace::h0dd3117452872c48\r\n  69:     0x7f069552b44a - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:78\r\n  70:     0x7f0695a64809 - core::ops::function::FnOnce::call_once{{vtable.shim}}::hb67c6244c5ee6f29\r\n  71:     0x7f06954fbe2f - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h3534c64212330b0c\r\n                               at /rustc/73528e339aae0f17a15ffa49a8ac608f50c6cf14/src/liballoc/boxed.rs:942\r\n  72:     0x7f0695529e70 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h338c10574a337ece\r\n                               at /rustc/73528e339aae0f17a15ffa49a8ac608f50c6cf14/src/liballoc/boxed.rs:942\r\n  73:     0x7f0695529e70 - std::sys_common::thread::start_thread::h761ac6d57710d65d\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  74:     0x7f0695529e70 - std::sys::unix::thread::Thread::new::thread_start::h61c012ef60f933c0\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  75:     0x7f06952962de - start_thread\r\n  76:     0x7f0694bba133 - __GI___clone\r\n  77:                0x0 - <unknown>\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.40.0 (73528e339 2019-12-16) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [type_of] processing `Token::value`\r\n#1 [inferred_outlives_crate] computing the inferred outlives predicates for items in this crate\r\n#2 [inferred_outlives_of] processing `TokenType`\r\n#3 [predicates_defined_on] processing `TokenType`\r\n#4 [predicates_of] processing `TokenType`\r\n#5 [collect_mod_item_types] collecting item types in top-level module\r\n#6 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67589/timeline", "performed_via_github_app": null, "state_reason": "completed"}