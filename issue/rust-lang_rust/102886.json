{"url": "https://api.github.com/repos/rust-lang/rust/issues/102886", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/102886/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/102886/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/102886/events", "html_url": "https://github.com/rust-lang/rust/issues/102886", "id": 1403367094, "node_id": "I_kwDOAAsO6M5Tpa62", "number": 102886, "title": "The compiler fails to produce INTERP section on custom ELF targets", "user": {"login": "js2xxx", "id": 12331626, "node_id": "MDQ6VXNlcjEyMzMxNjI2", "avatar_url": "https://avatars.githubusercontent.com/u/12331626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/js2xxx", "html_url": "https://github.com/js2xxx", "followers_url": "https://api.github.com/users/js2xxx/followers", "following_url": "https://api.github.com/users/js2xxx/following{/other_user}", "gists_url": "https://api.github.com/users/js2xxx/gists{/gist_id}", "starred_url": "https://api.github.com/users/js2xxx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/js2xxx/subscriptions", "organizations_url": "https://api.github.com/users/js2xxx/orgs", "repos_url": "https://api.github.com/users/js2xxx/repos", "events_url": "https://api.github.com/users/js2xxx/events{/privacy}", "received_events_url": "https://api.github.com/users/js2xxx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-10T15:35:04Z", "updated_at": "2022-10-19T04:03:57Z", "closed_at": "2022-10-19T04:03:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this:\r\n\r\nIt's within my OS project [oceanic](https://github.com/js2xxx/oceanic). My OS can only execute binaries depending on its dynamic loader. However, some recent update seems to change the compiler's behavior and it fails to produce INTERP section on my custom ELF target (located in [`/.cargo`](https://github.com/js2xxx/oceanic/blob/task-async/.cargo/x86_64-pc-oceanic.json)), causing the binary to fail to be loaded.\r\n\r\nIf anyone is interested to reproduce the issue, the branch `task-async` of my project is preferred since the master branch is not tested for a long time.\r\n\r\n## Version it most recently worked on: \r\n\r\n```\r\nrustc 1.66.0-nightly (0ca356586 2022-10-06)\r\nbinary: rustc\r\ncommit-hash: 0ca356586fed56002b10920fd21ddf6fb12de797\r\ncommit-date: 2022-10-06\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.66.0-nightly\r\nLLVM version: 15.0.2\r\n```\r\n\r\n## Version it fails to work on:\r\n\r\n```\r\nrustc 1.66.0-nightly (8b0c05d9a 2022-10-07)\r\nbinary: rustc\r\ncommit-hash: 8b0c05d9ad7121cdb97600f261bcd5f04c8db20d\r\ncommit-date: 2022-10-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.66.0-nightly\r\nLLVM version: 15.0.2\r\n```\r\n\r\n## Output excerpted from `llvm-objdump` (located in `/debug/progm.txt`, auto-generated if built)\r\n\r\n### Built with the former version (expected):\r\n\r\n```\r\nProgram Header:\r\n    PHDR off    0x0000000000000040 vaddr 0x0000000000000040 paddr 0x0000000000000040 align 2**3\r\n         filesz 0x00000000000002a0 memsz 0x00000000000002a0 flags r--\r\n  INTERP off    0x00000000000002e0 vaddr 0x00000000000002e0 paddr 0x00000000000002e0 align 2**0\r\n         filesz 0x0000000000000012 memsz 0x0000000000000012 flags r--\r\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**12\r\n         filesz 0x00000000000049ec memsz 0x00000000000049ec flags r--\r\n    LOAD off    0x0000000000005000 vaddr 0x0000000000005000 paddr 0x0000000000005000 align 2**12\r\n         filesz 0x000000000002625b memsz 0x000000000002625b flags r-x\r\n    LOAD off    0x000000000002c000 vaddr 0x000000000002c000 paddr 0x000000000002c000 align 2**12\r\n         filesz 0x00000000000027a0 memsz 0x00000000000027a0 flags rw-\r\n    LOAD off    0x000000000002f000 vaddr 0x000000000002f000 paddr 0x000000000002f000 align 2**12\r\n         filesz 0x0000000000001198 memsz 0x00000000000012a8 flags rw-\r\n    TLS off    0x000000000002c000 vaddr 0x000000000002c000 paddr 0x000000000002c000 align 2**3\r\n         filesz 0x0000000000000380 memsz 0x0000000000000410 flags r--\r\n DYNAMIC off    0x000000000002e508 vaddr 0x000000000002e508 paddr 0x000000000002e508 align 2**3\r\n         filesz 0x0000000000000120 memsz 0x0000000000000120 flags rw-\r\n   RELRO off    0x000000000002c000 vaddr 0x000000000002c000 paddr 0x000000000002c000 align 2**0\r\n         filesz 0x00000000000027a0 memsz 0x0000000000003000 flags r--\r\nEH_FRAME off    0x0000000000004928 vaddr 0x0000000000004928 paddr 0x0000000000004928 align 2**2\r\n         filesz 0x0000000000000024 memsz 0x0000000000000024 flags r--\r\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**64\r\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\r\n    NOTE off    0x00000000000002f4 vaddr 0x00000000000002f4 paddr 0x00000000000002f4 align 2**2\r\n         filesz 0x0000000000000018 memsz 0x0000000000000018 flags r--\r\n...\r\n```\r\n\r\n### Built with the latter version (erroneous):\r\n\r\n```\r\nProgram Header:\r\n    PHDR off    0x0000000000000040 vaddr 0x0000000000000040 paddr 0x0000000000000040 align 2**3\r\n         filesz 0x0000000000000230 memsz 0x0000000000000230 flags r--\r\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**12\r\n         filesz 0x000000000000764c memsz 0x000000000000764c flags r--\r\n    LOAD off    0x0000000000007650 vaddr 0x0000000000008650 paddr 0x0000000000008650 align 2**12\r\n         filesz 0x000000000002624b memsz 0x000000000002624b flags r-x\r\n    LOAD off    0x000000000002d8a0 vaddr 0x000000000002f8a0 paddr 0x000000000002f8a0 align 2**12\r\n         filesz 0x0000000000002780 memsz 0x0000000000002780 flags rw-\r\n    LOAD off    0x0000000000030020 vaddr 0x0000000000033020 paddr 0x0000000000033020 align 2**12\r\n         filesz 0x0000000000001198 memsz 0x00000000000012a8 flags rw-\r\n    TLS off    0x000000000002d8a0 vaddr 0x000000000002f8a0 paddr 0x000000000002f8a0 align 2**3\r\n         filesz 0x0000000000000380 memsz 0x0000000000000410 flags r--\r\n DYNAMIC off    0x000000000002fda8 vaddr 0x0000000000031da8 paddr 0x0000000000031da8 align 2**3\r\n         filesz 0x0000000000000100 memsz 0x0000000000000100 flags rw-\r\n   RELRO off    0x000000000002d8a0 vaddr 0x000000000002f8a0 paddr 0x000000000002f8a0 align 2**0\r\n         filesz 0x0000000000002780 memsz 0x0000000000003760 flags r--\r\nEH_FRAME off    0x0000000000007588 vaddr 0x0000000000007588 paddr 0x0000000000007588 align 2**2\r\n         filesz 0x0000000000000024 memsz 0x0000000000000024 flags r--\r\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**64\r\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\r\n...\r\n```\r\n", "closed_by": {"login": "js2xxx", "id": 12331626, "node_id": "MDQ6VXNlcjEyMzMxNjI2", "avatar_url": "https://avatars.githubusercontent.com/u/12331626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/js2xxx", "html_url": "https://github.com/js2xxx", "followers_url": "https://api.github.com/users/js2xxx/followers", "following_url": "https://api.github.com/users/js2xxx/following{/other_user}", "gists_url": "https://api.github.com/users/js2xxx/gists{/gist_id}", "starred_url": "https://api.github.com/users/js2xxx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/js2xxx/subscriptions", "organizations_url": "https://api.github.com/users/js2xxx/orgs", "repos_url": "https://api.github.com/users/js2xxx/repos", "events_url": "https://api.github.com/users/js2xxx/events{/privacy}", "received_events_url": "https://api.github.com/users/js2xxx/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/102886/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/102886/timeline", "performed_via_github_app": null, "state_reason": "completed"}