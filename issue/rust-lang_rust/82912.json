{"url": "https://api.github.com/repos/rust-lang/rust/issues/82912", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82912/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82912/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82912/events", "html_url": "https://github.com/rust-lang/rust/issues/82912", "id": 825018452, "node_id": "MDU6SXNzdWU4MjUwMTg0NTI=", "number": 82912, "title": "Rust is linking frankenstein binaries when static linking", "user": {"login": "richfelker", "id": 10458007, "node_id": "MDQ6VXNlcjEwNDU4MDA3", "avatar_url": "https://avatars.githubusercontent.com/u/10458007?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richfelker", "html_url": "https://github.com/richfelker", "followers_url": "https://api.github.com/users/richfelker/followers", "following_url": "https://api.github.com/users/richfelker/following{/other_user}", "gists_url": "https://api.github.com/users/richfelker/gists{/gist_id}", "starred_url": "https://api.github.com/users/richfelker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richfelker/subscriptions", "organizations_url": "https://api.github.com/users/richfelker/orgs", "repos_url": "https://api.github.com/users/richfelker/repos", "events_url": "https://api.github.com/users/richfelker/events{/privacy}", "received_events_url": "https://api.github.com/users/richfelker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-08T22:31:42Z", "updated_at": "2021-03-08T23:28:14Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "This report comes as a result of a user reporting a segfault on call to `sqlite3_open` in code using the `libsqlite3-sys` crate with musl libc, where Rust is currently defaulting to static linking. Analysis of the backtrace showed a call to address 0. The issue was speculated and later [reproduced on Twitter](https://twitter.com/remmyfoo/status/1369004378200367108?s=20) as Rust's link process emitting `DT_NEEDED` references to dynamic libraries in a static linked program (where symbolic runtime relocations are never processed and thereby end up evaluating to 0).\r\n\r\nI don't understand the mechanism of Rust's linker invocation well enough to know exactly how this is happening, but I assume it's the equivalent of passing `-Wl,-Bdynamic` in the middle of the link command line to a C compiler driver invoking the linker.\r\n\r\nIf targeting a static binary, the linker should never be instructed to search dynamic libraries; it should only link static ones, and fail to link if they are not present.\r\n\r\nThis issue is related to, but orthogonal to, the issue of Rust currently defaulting to static linking with musl libc target. As far as I can tell, it would affect any target with static linking.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82912/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82912/timeline", "performed_via_github_app": null, "state_reason": null}