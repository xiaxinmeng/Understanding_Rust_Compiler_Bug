{"url": "https://api.github.com/repos/rust-lang/rust/issues/63251", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63251/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63251/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63251/events", "html_url": "https://github.com/rust-lang/rust/issues/63251", "id": 476518034, "node_id": "MDU6SXNzdWU0NzY1MTgwMzQ=", "number": 63251, "title": "rustc unable to interact with trait bound required by other required trait", "user": {"login": "vadixidav", "id": 12789579, "node_id": "MDQ6VXNlcjEyNzg5NTc5", "avatar_url": "https://avatars.githubusercontent.com/u/12789579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vadixidav", "html_url": "https://github.com/vadixidav", "followers_url": "https://api.github.com/users/vadixidav/followers", "following_url": "https://api.github.com/users/vadixidav/following{/other_user}", "gists_url": "https://api.github.com/users/vadixidav/gists{/gist_id}", "starred_url": "https://api.github.com/users/vadixidav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vadixidav/subscriptions", "organizations_url": "https://api.github.com/users/vadixidav/orgs", "repos_url": "https://api.github.com/users/vadixidav/repos", "events_url": "https://api.github.com/users/vadixidav/events{/privacy}", "received_events_url": "https://api.github.com/users/vadixidav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1405345617, "node_id": "MDU6TGFiZWwxNDA1MzQ1NjE3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lazy-normalization", "name": "A-lazy-normalization", "color": "f7e101", "default": false, "description": "Area: lazy normalization (tracking issue: #60471)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-04T05:48:49Z", "updated_at": "2019-08-04T10:55:49Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This bug happens on `nightly-2019-08-01-x86_64-unknown-linux-gnu` and also a nightly I had from a month ago.\r\n\r\n`rustc 1.38.0-nightly (8a58268b5 2019-07-31)`\r\n\r\nI minimized my issue to the following ([playground link](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=c06d680065267e09adc752a8318f0366)):\r\n\r\n```rust\r\nuse generic_array::{GenericArray, ArrayLength};\r\n\r\npub struct HNSW<M: ArrayLength<u32>> {\r\n    zero: Vec<ZeroNode<M>>,\r\n}\r\n\r\nstruct ZeroNode<N: ArrayLength<u32>> {\r\n    neighbors: GenericArray<u32, N>,\r\n}\r\n\r\nimpl<M: ArrayLength<u32>> HNSW<M> {\r\n    pub fn insert(&mut self) {\r\n        self.zero.push(ZeroNode {\r\n            neighbors: [!0; M::USIZE].into(),\r\n        });\r\n    }\r\n}\r\n```\r\n\r\n`ArrayLength` has a required bound `Unsigned` from typenum which has an associated const `USIZE`. Therefore, the ArrayLength trait bound should work. The compiler adds this comment:\r\n\r\n```rust\r\n   Compiling playground v0.0.1 (/playground)\r\nerror[E0599]: no associated item named `USIZE` found for type `M` in the current scope\r\n  --> src/lib.rs:14:32\r\n   |\r\n14 |             neighbors: [!0; M::USIZE].into(),\r\n   |                                ^^^^^ associated item not found in `M`\r\n   |\r\n   = help: items from traits can only be used if the trait is implemented and in scope\r\n   = note: the following trait defines an item `USIZE`, perhaps you need to implement it:\r\n           candidate #1: `typenum::marker_traits::Unsigned`\r\n```\r\n\r\nIf I do what it says, it gives the exact same issue ([playground link](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=02d82925e94dd2140fdae6e6ff4f8543)).\r\n\r\nI then attempted to be clever and force the compiler to do the right thing ([playground link](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=6df9200d2d1699a46b26688f78b597cd)):\r\n\r\n`<M as typenum::marker_traits::Unsigned>::USIZE`:\r\n\r\n```rust\r\nerror[E0277]: the trait bound `M: typenum::marker_traits::Unsigned` is not satisfied\r\n  --> src/lib.rs:15:29\r\n   |\r\n15 |             neighbors: [!0; <M as typenum::marker_traits::Unsigned>::USIZE].into(),\r\n   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `typenum::marker_traits::Unsigned` is not implemented for `M`\r\n   |\r\n   = help: consider adding a `where M: typenum::marker_traits::Unsigned` bound\r\n   = note: required by `typenum::marker_traits::Unsigned::USIZE`\r\n```\r\n\r\nIt seems that, even when the trait is specifically required to be implemented, it still isn't implemented. This behavior is highly erroneous.\r\n\r\nIn the meantime, if anyone knows temporary workarounds for this issue, I would appreciate that. I am using this in [this](https://github.com/rust-photogrammetry/hnsw) crate.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63251/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63251/timeline", "performed_via_github_app": null, "state_reason": null}