{"url": "https://api.github.com/repos/rust-lang/rust/issues/18718", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18718/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18718/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18718/events", "html_url": "https://github.com/rust-lang/rust/issues/18718", "id": 48023683, "node_id": "MDU6SXNzdWU0ODAyMzY4Mw==", "number": 18718, "title": "Compiler fails unpredictably", "user": {"login": "manuels", "id": 31315, "node_id": "MDQ6VXNlcjMxMzE1", "avatar_url": "https://avatars.githubusercontent.com/u/31315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/manuels", "html_url": "https://github.com/manuels", "followers_url": "https://api.github.com/users/manuels/followers", "following_url": "https://api.github.com/users/manuels/following{/other_user}", "gists_url": "https://api.github.com/users/manuels/gists{/gist_id}", "starred_url": "https://api.github.com/users/manuels/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/manuels/subscriptions", "organizations_url": "https://api.github.com/users/manuels/orgs", "repos_url": "https://api.github.com/users/manuels/repos", "events_url": "https://api.github.com/users/manuels/events{/privacy}", "received_events_url": "https://api.github.com/users/manuels/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2014-11-06T22:31:45Z", "updated_at": "2016-02-08T20:53:44Z", "closed_at": "2016-02-08T19:23:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have two rust source files and one c source code file ([see this gist](https://gist.github.com/manuels/567bf4de17b52d61594e)).\n\nI compile the code like this:\n\n```\n$ gcc -c function_arg.c -o /tmp/libcxx.a\n# clang -c function_arg.c -o /tmp/libcxx.a\n# using clang instead of gcc doesn't resolve the issue\n$ rustc -o /tmp/libfoo.rlib function_arg.rs\n$ rustc -L /tmp/ function_arg_run.rs -o /tmp/main\n```\n\nMost of the times I get this error:\n\n```\n$ rustc -L /tmp/ ././tests/function_arg_run.rs -o /tmp/main\ntests/function_arg_run.rs:7:26: 7:36 error: unresolved name `foo::apply`.\ntests/function_arg_run.rs:7     unsafe { println!(\"{}\", foo::apply(double, 2)) }\n                                                        ^~~~~~~~~~\nnote: in expansion of format_args!\n<std macros>:2:23: 2:77 note: expansion site\n<std macros>:1:1: 3:2 note: in expansion of println!\ntests/function_arg_run.rs:7:11: 7:50 note: expansion site\n```\n\nBut sometimes the code compiles just fine.\n\nThe reason seems to lie in the `rustc -o /tmp/libfoo.rlib function_arg.rs` command.\nWhen I run into the \"unresolved name\" error, the `/tmp/libfoo.rlib` has a size of 11012 bytes and does not contain the string \"apply\".\nIn the case where everything just compiles fine, `/tmp/libfoo.rlib` is 4828 bytes and contains \"apply\" three times:\n\n```\n$ grep apply /tmp/libfoo.rlib --text --only-matching | wc -l\n3\n```\n\nI do not change a single line in the source code but the compiler sometimes results in different output files, which is really strange.\n\nI use these versions:\n\n```\n$ rustc -v\nrustc 0.13.0-nightly (63c4f22f2 2014-11-05 22:31:44 +0000)\n$ gcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.7/lto-wrapper\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Debian 4.7.2-5' --with-bugurl=file:///usr/share/doc/gcc-4.7/README.Bugs --enable-languages=c,c++,go,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.7 --enable-shared --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.7 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --enable-plugin --enable-objc-gc --with-arch-32=i586 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 4.7.2 (Debian 4.7.2-5) \n$ clang -v\nDebian clang version 3.5.0-1~exp1 (trunk) (based on LLVM 3.5.0)\nTarget: x86_64-pc-linux-gnu\nThread model: posix\nFound candidate GCC installation: /usr/bin/../lib/gcc/i486-linux-gnu/4.7\nFound candidate GCC installation: /usr/bin/../lib/gcc/i486-linux-gnu/4.7.2\nFound candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/4.6\nFound candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/4.6.3\nFound candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/4.7\nFound candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/4.7.2\nFound candidate GCC installation: /usr/lib/gcc/i486-linux-gnu/4.7\nFound candidate GCC installation: /usr/lib/gcc/i486-linux-gnu/4.7.2\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/4.6\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/4.6.3\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/4.7\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/4.7.2\nSelected GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/4.7\nCandidate multilib: .;@m64\nSelected multilib: .;@m64\n```\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18718/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18718/timeline", "performed_via_github_app": null, "state_reason": "completed"}