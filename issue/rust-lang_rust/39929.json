{"url": "https://api.github.com/repos/rust-lang/rust/issues/39929", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39929/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39929/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39929/events", "html_url": "https://github.com/rust-lang/rust/issues/39929", "id": 208647389, "node_id": "MDU6SXNzdWUyMDg2NDczODk=", "number": 39929, "title": "ICE inferring lifetimes in `impl Trait` return type", "user": {"login": "zrneely", "id": 5863146, "node_id": "MDQ6VXNlcjU4NjMxNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/5863146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zrneely", "html_url": "https://github.com/zrneely", "followers_url": "https://api.github.com/users/zrneely/followers", "following_url": "https://api.github.com/users/zrneely/following{/other_user}", "gists_url": "https://api.github.com/users/zrneely/gists{/gist_id}", "starred_url": "https://api.github.com/users/zrneely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zrneely/subscriptions", "organizations_url": "https://api.github.com/users/zrneely/orgs", "repos_url": "https://api.github.com/users/zrneely/repos", "events_url": "https://api.github.com/users/zrneely/events{/privacy}", "received_events_url": "https://api.github.com/users/zrneely/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-02-18T15:12:43Z", "updated_at": "2017-06-18T16:31:02Z", "closed_at": "2017-06-18T16:31:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "Minimal example here: https://is.gd/yWRQML\r\n\r\nIt appears that lifetime inference fails in a way that causes an ICE. Filling in the lifetimes manually solves the ICE, but seems unnecessary based on existing lifetime inference rules (`fn foo(&self) -> &Bar` infers correctly, so intuitively this should too).\r\n\r\nRunning the example locally, I get:\r\n\r\n```\r\n$ RUST_BACKTRACE=1 cargo +nightly build --verbose\r\n   Compiling ice_test v0.1.0 (file:///home/zrneely/src/ice_test)\r\n     Running `rustc --crate-name ice_test src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=e6671092544cc031 -C extra-filename=-e6671092544cc031 --out-dir /home/zrneely/src/ice_test/target/debug/deps -L dependency=/home/zrneely/src/ice_test/target/debug/deps`\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'assertion failed: match *region { ty::ReLateBound(..) => false, _ => true, }', /checkout/src/librustc/infer/higher_ranked/mod.rs:492\r\nstack backtrace:\r\n   1:     0x7ff3279b5009 - std::sys::imp::backtrace::tracing::imp::write::hbb14611794d3841b\r\n                        at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n   2:     0x7ff3279c369e - std::panicking::default_hook::{{closure}}::h6ed906c7818ac88c\r\n                        at /checkout/src/libstd/panicking.rs:351\r\n   3:     0x7ff3279c3244 - std::panicking::default_hook::h23eeafbf7c1c05c3\r\n                        at /checkout/src/libstd/panicking.rs:361\r\n   4:     0x7ff3279c3afb - std::panicking::rust_panic_with_hook::hd0067971b6d1240e\r\n                        at /checkout/src/libstd/panicking.rs:545\r\n   5:     0x7ff3248a1aaf - std::panicking::begin_panic::hde7d51dcf3662e2a\r\n   6:     0x7ff3249ac7d7 - rustc::infer::higher_ranked::fold_regions_in::{{closure}}::hea1fcfa314a22ba6\r\n   7:     0x7ff324a9ffad - rustc::ty::fold::TypeFolder::fold_ty::h68a470792183a4e9\r\n   8:     0x7ff3249d7014 - rustc::infer::InferCtxt::match_poly_projection_predicate::h8b51b6b4fe807f7f\r\n   9:     0x7ff324a7c7cd - rustc::traits::project::confirm_param_env_candidate::h1405ee0677619818\r\n  10:     0x7ff324a790e1 - rustc::traits::project::opt_normalize_projection_type::h9a1f08a6d84c365a\r\n  11:     0x7ff324a76915 - rustc::traits::project::normalize_projection_type::ha781dda3bc20ae6d\r\n  12:     0x7ff324a76588 - <rustc::traits::project::AssociatedTypeNormalizer<'a, 'b, 'gcx, 'tcx> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_ty::ha853479c5d2915be\r\n  13:     0x7ff324a77e51 - rustc::traits::project::opt_normalize_projection_type::h9a1f08a6d84c365a\r\n  14:     0x7ff324a742ac - rustc::traits::project::project_and_unify_type::h1c6f37e3966299ea\r\n  15:     0x7ff3249cec13 - rustc::infer::InferCtxt::commit_if_ok::heaaf11ccdfb3a3f0\r\n  16:     0x7ff324a72160 - <rustc::traits::fulfill::FulfillProcessor<'a, 'b, 'gcx, 'tcx> as rustc_data_structures::obligation_forest::ObligationProcessor>::process_obligation::h50e2a0588496d86c\r\n  17:     0x7ff324912da5 - <rustc_data_structures::obligation_forest::ObligationForest<O>>::process_obligations::h82abd7913980107a\r\n  18:     0x7ff324a70e5f - rustc::traits::fulfill::FulfillmentContext::select_where_possible::hab5c0eddfc9ae35d\r\n  19:     0x7ff32511d1e9 - rustc_typeck::check::FnCtxt::select_obligations_where_possible::ha28e350318dde14e\r\n  20:     0x7ff32511e4b0 - rustc_typeck::check::FnCtxt::check_argument_types::h957aa994cd289f96\r\n  21:     0x7ff3250f8266 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::confirm_builtin_call::h40e1bd1893b4a8fb\r\n  22:     0x7ff3250f711d - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_call::h602eecfba51f9212\r\n  23:     0x7ff32512a327 - rustc_typeck::check::FnCtxt::check_expr_kind::h47d7b8c44bdda6f2\r\n  24:     0x7ff32512957d - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::hce4fb530b89e15be\r\n  25:     0x7ff3250af495 - rustc_typeck::check::_match::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_match::h4f0a07bc613bc073\r\n  26:     0x7ff32512a96d - rustc_typeck::check::FnCtxt::check_expr_kind::h47d7b8c44bdda6f2\r\n  27:     0x7ff32512957d - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::hce4fb530b89e15be\r\n  28:     0x7ff32513af4d - rustc_typeck::check::FnCtxt::check_decl_initializer::hd76bb07692b005c9\r\n  29:     0x7ff32513b054 - rustc_typeck::check::FnCtxt::check_decl_local::hd0c479e258ff3ce6\r\n  30:     0x7ff32513b387 - rustc_typeck::check::FnCtxt::check_stmt::hf238c8ab59a67467\r\n  31:     0x7ff32513b6de - rustc_typeck::check::FnCtxt::check_block_with_expected::h976a451c1aea835a\r\n  32:     0x7ff32512a347 - rustc_typeck::check::FnCtxt::check_expr_kind::h47d7b8c44bdda6f2\r\n  33:     0x7ff32512957d - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::hce4fb530b89e15be\r\n  34:     0x7ff32513b721 - rustc_typeck::check::FnCtxt::check_block_with_expected::h976a451c1aea835a\r\n  35:     0x7ff32512a347 - rustc_typeck::check::FnCtxt::check_expr_kind::h47d7b8c44bdda6f2\r\n  36:     0x7ff32512957d - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::hce4fb530b89e15be\r\n  37:     0x7ff32510fc31 - rustc_typeck::check::check_fn::h6b753ec84c013b4a\r\n  38:     0x7ff32510ec15 - rustc_typeck::check::check_bare_fn::hb24e70a67e127683\r\n  39:     0x7ff32510bfa5 - rustc_typeck::check::check_item_bodies::h0cab204d56268561\r\n  40:     0x7ff325178547 - rustc_typeck::check_crate::h441df7c8151905be\r\n  41:     0x7ff327d61534 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h7d2a6da150c7eba7\r\n  42:     0x7ff327ccfa14 - rustc::ty::context::TyCtxt::create_and_enter::h825fbad7d24d1480\r\n  43:     0x7ff327d44e63 - rustc_driver::driver::compile_input::hf3e3aa4173908b86\r\n  44:     0x7ff327d8c42d - rustc_driver::run_compiler::h8f8d47f1d258a8a6\r\n  45:     0x7ff327c967cb - std::panicking::try::do_call::h206b9daee04f4ea2\r\n  46:     0x7ff3279cc9aa - __rust_maybe_catch_panic\r\n                        at /checkout/src/libpanic_unwind/lib.rs:98\r\n  47:     0x7ff327cbeb92 - <F as alloc::boxed::FnBox<A>>::call_box::h5d196fbb3229f499\r\n  48:     0x7ff3279c24e4 - std::sys::imp::thread::Thread::new::thread_start::h2c901daa88f3cb32\r\n                        at /checkout/src/liballoc/boxed.rs:648\r\n                        at /checkout/src/libstd/sys_common/thread.rs:21\r\n                        at /checkout/src/libstd/sys/unix/thread.rs:84\r\n  49:     0x7ff31f698183 - start_thread\r\n  50:     0x7ff32766a37c - clone\r\n  51:                0x0 - <unknown>\r\n\r\nerror: Could not compile `ice_test`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name ice_test src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=e6671092544cc031 -C extra-filename=-e6671092544cc031 --out-dir /home/zrneely/src/ice_test/target/debug/deps -L dependency=/home/zrneely/src/ice_test/target/debug/deps` (exit code: 101)\r\n\r\n```", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39929/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39929/timeline", "performed_via_github_app": null, "state_reason": "completed"}