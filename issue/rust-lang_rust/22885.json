{"url": "https://api.github.com/repos/rust-lang/rust/issues/22885", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22885/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22885/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22885/events", "html_url": "https://github.com/rust-lang/rust/issues/22885", "id": 59320830, "node_id": "MDU6SXNzdWU1OTMyMDgzMA==", "number": 22885, "title": "Fix relocation-model test on systems with grsecurity's PaX.", "user": {"login": "quantheory", "id": 1740206, "node_id": "MDQ6VXNlcjE3NDAyMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1740206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/quantheory", "html_url": "https://github.com/quantheory", "followers_url": "https://api.github.com/users/quantheory/followers", "following_url": "https://api.github.com/users/quantheory/following{/other_user}", "gists_url": "https://api.github.com/users/quantheory/gists{/gist_id}", "starred_url": "https://api.github.com/users/quantheory/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/quantheory/subscriptions", "organizations_url": "https://api.github.com/users/quantheory/orgs", "repos_url": "https://api.github.com/users/quantheory/repos", "events_url": "https://api.github.com/users/quantheory/events{/privacy}", "received_events_url": "https://api.github.com/users/quantheory/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-02-28T02:29:14Z", "updated_at": "2018-09-24T18:07:09Z", "closed_at": "2018-09-24T18:07:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "These three sections are present in the relocation-model test's Makefile:\n\n```\n    $(RUSTC) -C relocation-model=dynamic-no-pic foo.rs\n    $(call RUN,foo)\n\n    $(RUSTC) -C relocation-model=default foo.rs\n    $(call RUN,foo)\n\n    $(RUSTC) -C relocation-model=static foo.rs\n    $(call RUN,foo)\n```\n\nOn systems with PaX's MPROTECT enabled (and with ELFRELOCS disabled), relocations are forbidden by default. Running these binaries therefore requires use of paxctl-ng to disable MPROTECT, like so:\n\n```\n    $(RUSTC) -C relocation-model=dynamic-no-pic foo.rs\n    paxctl-ng -cm $(TMPDIR)/foo\n    $(call RUN,foo)\n\n    $(RUSTC) -C relocation-model=default foo.rs\n    paxctl-ng -cm $(TMPDIR)/foo\n    $(call RUN,foo)\n\n    $(RUSTC) -C relocation-model=static foo.rs\n    paxctl-ng -cm $(TMPDIR)/foo\n    $(call RUN,foo)\n```\n\nTwo notes:\n1. Of course this particular change only works when paxctl-ng is in the $PATH, as it is for me on my system.\n2. The first of these three sections actually does not require the paxctl-ng command! I believe that this is because foo.rs contains nothing but an empty `main`, and the dynamic-no-pic option uses PIC dynamic libraries, so there's no reason for relocations to be produced.\n\nMy feeling is that either this test needs to go away (it's not clear to me what it's actually checking for, or that it works as intended), or we need to add paxctl detection back into the build system for this test.\n\nNote that reverting the changes from #14850 is not enough to accomplish the latter. Nowadays most PaX systems are probably using extended attributes, which means that the newer command paxctl-ng should be searched for first, and then the obsolete paxctl command should be used only if that's not present.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22885/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22885/timeline", "performed_via_github_app": null, "state_reason": "completed"}