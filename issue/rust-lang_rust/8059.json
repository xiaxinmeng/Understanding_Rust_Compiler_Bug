{"url": "https://api.github.com/repos/rust-lang/rust/issues/8059", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8059/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8059/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8059/events", "html_url": "https://github.com/rust-lang/rust/issues/8059", "id": 17257150, "node_id": "MDU6SXNzdWUxNzI1NzE1MA==", "number": 8059, "title": "ICE if generic destructor invokes a method on self", "user": {"login": "chris-morgan", "id": 392868, "node_id": "MDQ6VXNlcjM5Mjg2OA==", "avatar_url": "https://avatars.githubusercontent.com/u/392868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chris-morgan", "html_url": "https://github.com/chris-morgan", "followers_url": "https://api.github.com/users/chris-morgan/followers", "following_url": "https://api.github.com/users/chris-morgan/following{/other_user}", "gists_url": "https://api.github.com/users/chris-morgan/gists{/gist_id}", "starred_url": "https://api.github.com/users/chris-morgan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chris-morgan/subscriptions", "organizations_url": "https://api.github.com/users/chris-morgan/orgs", "repos_url": "https://api.github.com/users/chris-morgan/repos", "events_url": "https://api.github.com/users/chris-morgan/events{/privacy}", "received_events_url": "https://api.github.com/users/chris-morgan/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-07-26T10:23:08Z", "updated_at": "2014-02-06T16:20:31Z", "closed_at": "2013-07-26T18:22:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Minimal test case:\n\n``` rust\nstruct Foo<T>(T);\ntrait Bar {\n    fn x(&self) {\n    }\n}\nimpl Bar for uint;\n\n#[unsafe_destructor]\nimpl<T: Bar> Drop for Foo<T> {\n    fn drop(&self) {\n        self.x()  // Same failure for `(*self).x()` or `(**self).x()`\n    }\n}\n\nfn main() {\n    Foo(1u);  // Necessary to actually use the destructor\n}\n```\n\n`rustc` output:\n\n```\n$ RUST_LOG=rustc=1,::rt::backtrace rustc x.rs\nrust: task failed at 'vtables missing where they are needed', /home/chris/vc/rust/src/libstd/option.rs:350\n/home/chris/opt/rust/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fc0344903eb]\n/home/chris/opt/rust/bin/../lib/librustrt.so(+0x2b939)[0x7fc0344a1939]\n/home/chris/opt/rust/bin/../lib/librustrt.so(upcall_fail+0x1a8)[0x7fc034492438]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(_ZN3sys13begin_unwind_16_89e154cd091567114_0$x2e8$x2dpreE+0x569)[0x7fc03603b2b9]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11ad42)[0x7fc03603ad42]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11abc8)[0x7fc03603abc8]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11acf1)[0x7fc03603acf1]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11abc8)[0x7fc03603abc8]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(_ZN3sys14__extensions__10meth_111399fail_with17_d96679812a86c36714_0$x2e8$x2dpreE+0x72)[0x7fc035f966e2]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans6common11find_vtable16_5e9f485eda840b914_0$x2e8$x2dpreE+0x57e)[0x7fc0348f41ce]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4meth19trans_method_callee16_9a29a366e2a113e14_0$x2e8$x2dpreE+0x5d0)[0x7fc03487a520]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x1b2344)[0x7fc034879344]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x1c69e5)[0x7fc03488d9e5]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base17with_scope_result17_c81a7c4cd4a84fa014_0$x2e8$x2dpreE+0x16c)[0x7fc03483eb6c]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans6callee16trans_call_inner16_20be7b29a79d8f914_0$x2e8$x2dpreE+0xf5)[0x7fc034877f05]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans6callee17trans_method_call17_647ccf86fa79a01014_0$x2e8$x2dpreE+0x67b)[0x7fc03487869b]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4expr27trans_rvalue_dps_unadjusted17_6ce6f5b9a16ba59614_0$x2e8$x2dpreE+0x6a3)[0x7fc03489da43]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4expr10trans_into17_6ce6f5b9a16ba59614_0$x2e8$x2dpreE+0xa77)[0x7fc0348341a7]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans11controlflow11trans_block15_a728a33de113ed14_0$x2e8$x2dpreE+0x1fc)[0x7fc03483148c]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base13trans_closure17_59e7a19d96b67a5814_0$x2e8$x2dpreE+0x732)[0x7fc03492f672]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base8trans_fn17_a2b968dda5e8917814_0$x2e8$x2dpreE+0x3e9)[0x7fc0347ffa89]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4meth12trans_method17_3a9cc0402553143914_0$x2e8$x2dpreE+0x238)[0x7fc03482bc58]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans12monomorphize14monomorphic_fn16_b547e550db2f1ab14_0$x2e8$x2dpreE+0x4476)[0x7fc034804446]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base12get_res_dtor17_f1e46721eb3615e614_0$x2e8$x2dpreE+0x454)[0x7fc034851284]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x1896fc)[0x7fc0348506fc]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base9with_cond16_80523e944b7f74c14_0$x2e8$x2dpreE+0xd0)[0x7fc03483f480]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue22trans_struct_drop_flag17_bb6e74152f1117e114_0$x2e8$x2dpreE+0x232)[0x7fc03484fd82]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue14make_drop_glue16_153bfa6ebf9769614_0$x2e8$x2dpreE+0x3a6)[0x7fc03484c086]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue23make_generic_glue_inner17_46be2880a02831e514_0$x2e8$x2dpreE+0x27a)[0x7fc034858a0a]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue17make_generic_glue16_f329aed71553b2c14_0$x2e8$x2dpreE+0x1e7)[0x7fc03484b287]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue23lazily_emit_tydesc_glue17_b0dd522de6b2f23114_0$x2e8$x2dpreE+0x70f)[0x7fc0348497ef]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue21call_tydesc_glue_full17_9468b63fac1fd47e14_0$x2e8$x2dpreE+0x159)[0x7fc03484cde9]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue16call_tydesc_glue17_b628d0c2acd3449d14_0$x2e8$x2dpreE+0x1c4)[0x7fc034847a94]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4glue7drop_ty16_153bfa6ebf9769614_0$x2e8$x2dpreE+0x14e)[0x7fc034847d6e]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x1c73b2)[0x7fc03488e3b2]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base17with_scope_result17_c81a7c4cd4a84fa014_0$x2e8$x2dpreE+0x16c)[0x7fc03483eb6c]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans6callee16trans_call_inner16_20be7b29a79d8f914_0$x2e8$x2dpreE+0xf5)[0x7fc034877f05]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans6callee10trans_call17_d944ba6ba242a15914_0$x2e8$x2dpreE+0x304)[0x7fc034877bd4]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4expr27trans_rvalue_dps_unadjusted17_6ce6f5b9a16ba59614_0$x2e8$x2dpreE+0x625)[0x7fc03489d9c5]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4expr10trans_into17_6ce6f5b9a16ba59614_0$x2e8$x2dpreE+0xa77)[0x7fc0348341a7]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base10trans_stmt17_ed162f61b91273df14_0$x2e8$x2dpreE+0x4f5)[0x7fc034832eb5]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans11controlflow11trans_block15_a728a33de113ed14_0$x2e8$x2dpreE+0x100)[0x7fc034831390]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base13trans_closure17_59e7a19d96b67a5814_0$x2e8$x2dpreE+0x732)[0x7fc03492f672]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base8trans_fn17_a2b968dda5e8917814_0$x2e8$x2dpreE+0x3e9)[0x7fc0347ffa89]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base10trans_item17_45da8d91232c406014_0$x2e8$x2dpreE+0x8a0)[0x7fc0347f8cf0]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base9trans_mod17_4ce71fbebc90137214_0$x2e8$x2dpreE+0x8d)[0x7fc0349353bd]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6middle5trans4base11trans_crate17_9cee2ec11615e9a214_0$x2e8$x2dpreE+0x40e)[0x7fc034943fbe]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x88477c)[0x7fc034f4b77c]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6driver6driver12compile_rest15_4bcc908e4730a114_0$x2e8$x2dpreE+0x26ad)[0x7fc034f4911d]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6driver6driver12compile_upto17_137ef03814afa89c14_0$x2e8$x2dpreE+0x134)[0x7fc034f4ba84]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN6driver6driver13compile_input17_b7dc6f2c2099232314_0$x2e8$x2dpreE+0xd5)[0x7fc034f4bde5]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN12run_compiler17_7aefb92a92c4c2b414_0$x2e8$x2dpreE+0x18ec)[0x7fc034f6d03c]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x8c841e)[0x7fc034f8f41e]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x8c4004)[0x7fc034f8b004]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(+0x8bb772)[0x7fc034f82772]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0xefadf)[0x7fc03600fadf]\n/home/chris/opt/rust/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x2b)[0x7fc034490d7b]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/chris/vc/rust/src/librustc/rustc.rs:364\n/home/chris/opt/rust/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fc0344903eb]\n/home/chris/opt/rust/bin/../lib/librustrt.so(+0x2b939)[0x7fc0344a1939]\n/home/chris/opt/rust/bin/../lib/librustrt.so(upcall_fail+0x1a8)[0x7fc034492438]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(_ZN3sys13begin_unwind_16_89e154cd091567114_0$x2e8$x2dpreE+0x569)[0x7fc03603b2b9]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11b3f2)[0x7fc03603b3f2]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11abc8)[0x7fc03603abc8]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11b3a1)[0x7fc03603b3a1]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x11abc8)[0x7fc03603abc8]\n/home/chris/opt/rust/bin/../lib/libstd-6c65cf4b443341b1-0.8-pre.so(+0x8dacc)[0x7fc035fadacc]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN7monitor16_cd19199377934ec14_0$x2e8$x2dpreE+0x2f85)[0x7fc034f70b55]\n/home/chris/opt/rust/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.8-pre.so(_ZN4main15_f3d16eaf7d573814_0$x2e8$x2dpreE+0x69)[0x7fc034f8f359]\n/home/chris/opt/rust/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x2b)[0x7fc034490d7b]\nrust: domain main @0xcfecf0 root task failed\n```\n", "closed_by": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/8059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8059/timeline", "performed_via_github_app": null, "state_reason": "completed"}