{"url": "https://api.github.com/repos/rust-lang/rust/issues/42404", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42404/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42404/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42404/events", "html_url": "https://github.com/rust-lang/rust/issues/42404", "id": 233365896, "node_id": "MDU6SXNzdWUyMzMzNjU4OTY=", "number": 42404, "title": "[rustbuild] should not rollback the submodules most of the time", "user": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 693664741, "node_id": "MDU6TGFiZWw2OTM2NjQ3NDE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mentor", "name": "E-needs-mentor", "color": "02e10c", "default": false, "description": "Call for participation: This issue is in need of a mentor."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-06-03T12:14:58Z", "updated_at": "2023-02-03T08:29:39Z", "closed_at": "2023-02-03T08:29:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Currently rustbuild unconditionally forcefully checks out all the modules before building. This clashes with the workflow that probably should just work:\r\n\r\n* Edit a submodule (could commit or not commit);\r\n* Compile;\r\n\r\n[rustbuild] will wipe all the changes, potentially losing significant amount of work. I\u2019ve seen this happen to multiple people over time. Instead you have to do this:\r\n\r\n* Edit a submodule;\r\n* Commit changes to the submodule;\r\n* Commit submodule update to the rustc repo;\r\n* Compile\r\n\r\nWhich is super unobvious and failure prone. Miss any of the steps and your changes are wiped. My proposal would be to not forcefully checkout the submodules if the following are true:\r\n\r\n* The working directory of the submodule is dirty;\r\n* Submodule is \u201cahead\u201d of the commit that would otherwise be checked out;\r\n\r\nPotentially printing a warning or whatever.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42404/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42404/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}