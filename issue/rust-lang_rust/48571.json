{"url": "https://api.github.com/repos/rust-lang/rust/issues/48571", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48571/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48571/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48571/events", "html_url": "https://github.com/rust-lang/rust/issues/48571", "id": 300475337, "node_id": "MDU6SXNzdWUzMDA0NzUzMzc=", "number": 48571, "title": "Help improving bootstrap.py documentation", "user": {"login": "Phlosioneer", "id": 4657718, "node_id": "MDQ6VXNlcjQ2NTc3MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4657718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Phlosioneer", "html_url": "https://github.com/Phlosioneer", "followers_url": "https://api.github.com/users/Phlosioneer/followers", "following_url": "https://api.github.com/users/Phlosioneer/following{/other_user}", "gists_url": "https://api.github.com/users/Phlosioneer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Phlosioneer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Phlosioneer/subscriptions", "organizations_url": "https://api.github.com/users/Phlosioneer/orgs", "repos_url": "https://api.github.com/users/Phlosioneer/repos", "events_url": "https://api.github.com/users/Phlosioneer/events{/privacy}", "received_events_url": "https://api.github.com/users/Phlosioneer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-02-27T02:52:50Z", "updated_at": "2018-03-02T08:36:41Z", "closed_at": "2018-03-02T08:36:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hey, I recently did some work to improve the `bootstrap.py` code. While I was doing performance testing, I had a very hard time understanding what the code was trying to do. I'd like to write better comments and documentation for the build script, so I was wondering if anyone could help explain what these parts do.\r\n\r\nI've been digging through commit logs, `git blame`-suggested commits, and reading full commit messages. Some are a lot better than others, and refactoring can make tracking down the original commit message for code very difficult.\r\n\r\n## `update_submodules()`\r\n[source](https://github.com/rust-lang/rust/blob/bedbad61195d2eae69b43eca49c6d3e2aee8f208/src/bootstrap/bootstrap.py#L630)\r\n\r\n- `git submodule -q sync`: From the git documentation: \"Synchronizes submodules' remote URL configuration setting to the value specified in .gitmodules...  This is useful when submodule URLs change upstream\" What does this mean? Why do these URLs ever change?\r\n- `git submodule -q foreach 'git reset -q --hard'`: Why do we need to do a `git reset --hard` on submodules...? I thought this only matters if we're adding/removing files, and it destroys those changes. Why would we need to do this to cloned submodules?\r\n- `git submodule -q foreach 'git clean -qdfx'`: Why do we need to do a `git clean` on submodules...? This goes back to the `git reset` question: I thought this just destroys any untracked files, why do we need to do this to cloned submodules?\r\n\r\nThe two reasons I care are 1) these seem like arcane magic and 2) they take 20-30 seconds (combined) to complete. Most of that time is spent in the llvm submodule, if you're curious.\r\n\r\n## `default_build_triple()`\r\n[source](https://github.com/rust-lang/rust/blob/bedbad61195d2eae69b43eca49c6d3e2aee8f208/src/bootstrap/bootstrap.py#L170)\r\n\r\nWhere does the magic list of `cputype_mapper` come from? Where do the special cases come from?\r\n\r\n## Misc\r\nWhat's going on with the doc comment for [`bootstrap_binary()`](https://github.com/rust-lang/rust/blob/bedbad61195d2eae69b43eca49c6d3e2aee8f208/src/bootstrap/bootstrap.py#L575)?\r\n\r\nWhat exactly _are_ the submodules? Some of them are self-explanatory, but others are cryptic:\r\n```\r\nSynchronizing submodule url for 'src/binaryen'  // ?\r\nSynchronizing submodule url for 'src/dlmalloc'  // ?\r\nSynchronizing submodule url for 'src/doc/book'\r\nSynchronizing submodule url for 'src/doc/nomicon'  // ?\r\nSynchronizing submodule url for 'src/doc/reference'\r\nSynchronizing submodule url for 'src/doc/rust-by-example'\r\nSynchronizing submodule url for 'src/jemalloc'  // ?\r\nSynchronizing submodule url for 'src/libcompiler_builtins'\r\nSynchronizing submodule url for 'src/liblibc'\r\nSynchronizing submodule url for 'src/llvm'\r\nSynchronizing submodule url for 'src/llvm-emscripten'\r\nSynchronizing submodule url for 'src/tools/cargo'\r\nSynchronizing submodule url for 'src/tools/clippy'\r\nSynchronizing submodule url for 'src/tools/miri'  // ?\r\nSynchronizing submodule url for 'src/tools/rls'\r\nSynchronizing submodule url for 'src/tools/rust-installer'  // Is this rustup...?\r\nSynchronizing submodule url for 'src/tools/rustfmt'\r\n```", "closed_by": {"login": "Phlosioneer", "id": 4657718, "node_id": "MDQ6VXNlcjQ2NTc3MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4657718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Phlosioneer", "html_url": "https://github.com/Phlosioneer", "followers_url": "https://api.github.com/users/Phlosioneer/followers", "following_url": "https://api.github.com/users/Phlosioneer/following{/other_user}", "gists_url": "https://api.github.com/users/Phlosioneer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Phlosioneer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Phlosioneer/subscriptions", "organizations_url": "https://api.github.com/users/Phlosioneer/orgs", "repos_url": "https://api.github.com/users/Phlosioneer/repos", "events_url": "https://api.github.com/users/Phlosioneer/events{/privacy}", "received_events_url": "https://api.github.com/users/Phlosioneer/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48571/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48571/timeline", "performed_via_github_app": null, "state_reason": "completed"}