{"url": "https://api.github.com/repos/rust-lang/rust/issues/18514", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18514/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18514/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18514/events", "html_url": "https://github.com/rust-lang/rust/issues/18514", "id": 47516024, "node_id": "MDU6SXNzdWU0NzUxNjAyNA==", "number": 18514, "title": "ICE: assertion failed: `(left == right) && (right == left)` (left: `11`, right: `0`)", "user": {"login": "s-panferov", "id": 198327, "node_id": "MDQ6VXNlcjE5ODMyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/198327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s-panferov", "html_url": "https://github.com/s-panferov", "followers_url": "https://api.github.com/users/s-panferov/followers", "following_url": "https://api.github.com/users/s-panferov/following{/other_user}", "gists_url": "https://api.github.com/users/s-panferov/gists{/gist_id}", "starred_url": "https://api.github.com/users/s-panferov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s-panferov/subscriptions", "organizations_url": "https://api.github.com/users/s-panferov/orgs", "repos_url": "https://api.github.com/users/s-panferov/repos", "events_url": "https://api.github.com/users/s-panferov/events{/privacy}", "received_events_url": "https://api.github.com/users/s-panferov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-11-01T20:25:59Z", "updated_at": "2014-11-03T23:12:40Z", "closed_at": "2014-11-03T23:12:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "ICE:\n\n``` rust\ntask 'rustc' panicked at 'assertion failed: `(left == right) && (right == left)` (left: `11`, right: `0`)', /Users/rustbuild/src/rust-buildbot/slave/nightly-mac/build/src/librustc/middle/ty.rs:2569\n\nstack backtrace:\n   1:        0x1053ac929 - rt::backtrace::imp::write::hfe87245730e40e498nq\n   2:        0x1053afb6c - failure::on_fail::h250240fc1d2cc13cHEq\n   3:        0x10560b395 - unwind::begin_unwind_inner::h629bbfd5c5c7ad4bSJd\n   4:        0x10560b02f - unwind::begin_unwind_fmt::h26eed6b8c9614d01kHd\n   5:        0x1024f5487 - middle::ty::type_contents::tc_ty::h4f516816f0265f20JIH\n   6:        0x1024f473e - middle::ty::type_contents::tc_ty::h4f516816f0265f20JIH\n   7:        0x1024f4c7f - middle::ty::type_contents::tc_ty::h4f516816f0265f20JIH\n   8:        0x1022ada4f - middle::ty::type_contents::hcbff11a2d2064355XHH\n   9:        0x102497834 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::consume_expr::h12011496269642837587\n  10:        0x1024916af - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_expr::h6289422402745590059\n  11:        0x102497889 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::consume_expr::h12011496269642837587\n  12:        0x1024916af - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_expr::h6289422402745590059\n  13:        0x102497889 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::consume_expr::h12011496269642837587\n  14:        0x1024916af - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_expr::h6289422402745590059\n  15:        0x102497ae3 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_local::h480003012053056122\n  16:        0x102497a15 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_block::h3271632192568197791\n  17:        0x10249180e - middle::expr_use_visitor::ExprUseVisitor<'d, 't, TYPER>::walk_expr::h6289422402745590059\n  18:        0x10249d180 - middle::trans::_match::trans_match_inner::closure.126642\n  19:        0x10242094b - middle::trans::_match::trans_match::h812670c167266a78prk\n  20:        0x1024100fd - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  21:        0x1023d5cf9 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  22:        0x1023d604e - middle::trans::controlflow::trans_block::hb6579525f1a9c0e0M30\n  23:        0x10247633a - middle::trans::base::trans_closure::h73d516938fc276e1Zah\n  24:        0x1023c995f - middle::trans::base::trans_fn::ha1261357d96dceccpmh\n  25:        0x1023cb592 - middle::trans::monomorphize::monomorphic_fn::h3beeee8af9d8e21acu0\n  26:        0x1023fc857 - middle::trans::callee::trans_fn_ref_with_substs::he50eea051fdbe5a9sH3\n  27:        0x1023e0aae - middle::trans::meth::trans_method_callee::ha6757eb79d64f196aAm\n  28:        0x10240211b - middle::trans::callee::trans_method_call::closure.122853\n  29:        0x1023dd895 - middle::trans::callee::trans_call_inner::hecb2b66e77f79065c33\n  30:        0x102401f4d - middle::trans::callee::trans_method_call::hd6c33d4672989d74EY3\n  31:        0x10240fb8f - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  32:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  33:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  34:        0x102419a98 - middle::trans::expr::trans_addr_of::hfcdfbe87e717518flZ6\n  35:        0x10240f120 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  36:        0x1023d5d19 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  37:        0x102422651 - middle::trans::expr::trans_adt::h9723c7611e8b803aFJ6\n  38:        0x1024106ff - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  39:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  40:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  41:        0x1024206e2 - middle::trans::_match::trans_match::h812670c167266a78prk\n  42:        0x1024100fd - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  43:        0x1023d5cf9 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  44:        0x1023d604e - middle::trans::controlflow::trans_block::hb6579525f1a9c0e0M30\n  45:        0x10247633a - middle::trans::base::trans_closure::h73d516938fc276e1Zah\n  46:        0x1023c995f - middle::trans::base::trans_fn::ha1261357d96dceccpmh\n  47:        0x1023cb592 - middle::trans::monomorphize::monomorphic_fn::h3beeee8af9d8e21acu0\n  48:        0x1023fc857 - middle::trans::callee::trans_fn_ref_with_substs::he50eea051fdbe5a9sH3\n  49:        0x1023e0aae - middle::trans::meth::trans_method_callee::ha6757eb79d64f196aAm\n  50:        0x10240211b - middle::trans::callee::trans_method_call::closure.122853\n  51:        0x1023dd895 - middle::trans::callee::trans_call_inner::hecb2b66e77f79065c33\n  52:        0x102401f4d - middle::trans::callee::trans_method_call::hd6c33d4672989d74EY3\n  53:        0x10240fb8f - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  54:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  55:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  56:        0x102419a98 - middle::trans::expr::trans_addr_of::hfcdfbe87e717518flZ6\n  57:        0x10240f120 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  58:        0x1023d5d19 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  59:        0x102422651 - middle::trans::expr::trans_adt::h9723c7611e8b803aFJ6\n  60:        0x1024106ff - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  61:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  62:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  63:        0x1024206e2 - middle::trans::_match::trans_match::h812670c167266a78prk\n  64:        0x1024100fd - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  65:        0x1023d5cf9 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  66:        0x10249d8ee - middle::trans::_match::store_local::closure.126680\n  67:        0x10249d7a0 - middle::trans::_match::mk_binding_alloca::h3000336027245779899\n  68:        0x10246dd5f - middle::trans::_match::store_local::h8039e9afecf4d4cdKEk\n  69:        0x1023d52d4 - middle::trans::base::init_local::h33c895e862085d0aQig\n  70:        0x1023d4741 - middle::trans::controlflow::trans_stmt::h85c129a56de52a90GY0\n  71:        0x1023d5f48 - middle::trans::controlflow::trans_block::hb6579525f1a9c0e0M30\n  72:        0x10247633a - middle::trans::base::trans_closure::h73d516938fc276e1Zah\n  73:        0x1023c995f - middle::trans::base::trans_fn::ha1261357d96dceccpmh\n  74:        0x1023cb42c - middle::trans::monomorphize::monomorphic_fn::h3beeee8af9d8e21acu0\n  75:        0x1023fc857 - middle::trans::callee::trans_fn_ref_with_substs::he50eea051fdbe5a9sH3\n  76:        0x1023e0aae - middle::trans::meth::trans_method_callee::ha6757eb79d64f196aAm\n  77:        0x10240211b - middle::trans::callee::trans_method_call::closure.122853\n  78:        0x1023dd895 - middle::trans::callee::trans_call_inner::hecb2b66e77f79065c33\n  79:        0x102401f4d - middle::trans::callee::trans_method_call::hd6c33d4672989d74EY3\n  80:        0x10240fb8f - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  81:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  82:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  83:        0x102407fe4 - middle::trans::callee::trans_args::h6215d14867a1f36bno4\n  84:        0x1023de92d - middle::trans::callee::trans_call_inner::hecb2b66e77f79065c33\n  85:        0x102401f4d - middle::trans::callee::trans_method_call::hd6c33d4672989d74EY3\n  86:        0x10240fb8f - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  87:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  88:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  89:        0x102419a98 - middle::trans::expr::trans_addr_of::hfcdfbe87e717518flZ6\n  90:        0x10240f120 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  91:        0x1023d5d19 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  92:        0x102422651 - middle::trans::expr::trans_adt::h9723c7611e8b803aFJ6\n  93:        0x1024106ff - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  94:        0x10240e911 - middle::trans::expr::trans_unadjusted::hcc11a8a8a1a648574x5\n  95:        0x1023d7272 - middle::trans::expr::trans::h13b6cdaa2b8246660Q4\n  96:        0x1024206e2 - middle::trans::_match::trans_match::h812670c167266a78prk\n  97:        0x1024100fd - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n  98:        0x1023d5cf9 - middle::trans::expr::trans_into::h6b9cbd6894a0b3dd6M4\n  99:        0x1023d604e - middle::trans::controlflow::trans_block::hb6579525f1a9c0e0M30\n  100:        0x102410168 - middle::trans::expr::trans_rvalue_dps_unadjusted::hea6dad8c49515284vb6\n ... <frames omitted>\n```\n\n```\nrustc 0.13.0-nightly (221fc1e3c 2014-10-31 02:27:15 +0000)\n```\n\n**How to reproduce**:\n\n```\ngit clone https://github.com/s-panferov/ice-assertion-ty.git\ncd ice-assertion-ty\ncargo test\n```\n\nMain body:\n\n``` rust\n\n#![feature(macro_rules)]\n\npub trait ToSql {\n    fn to_sql(&self) -> String;\n}\n\n#[deriving(Clone)]\npub enum ExprValue<T> {\n    ExpressionValue,\n    DefaultValue\n}\n\n#[allow(dead_code)]\n#[deriving(Clone)]\npub enum Insert<T, V, M> {\n    InsertDefaultValues,\n    InsertValues(Vec<V>)\n}\n\n#[allow(dead_code)]\n#[deriving(Clone)]\npub struct InsertQuery<T, V, M> {\n    pub values: Insert<T, V, M>\n}\n\nimpl ToSql for ()  {\n    fn to_sql(&self) -> String {\n        \"DEFAULT VALUES\".to_string()\n    }\n}\n\nimpl<T: Clone, V: ToSql, M: Clone> ToSql for Insert<T, V, M> {\n    fn to_sql(&self) -> String {\n        match self {\n            &InsertDefaultValues => {\n                \"DEFAULT VALUES\".to_string()\n            },\n            &InsertValues(ref rows) => {\n                let val: Vec<&V> = rows.iter().collect();\n                \"\".to_string()\n            }\n\n        }\n    }\n}\n\nimpl<T: Clone, V: Clone+ToSql, M: Clone> ToSql for InsertQuery<T, V, M> {\n    fn to_sql(&self) -> String {\n        // ..\n        format!(\"{}\", self.values.to_sql())\n    }\n}\n```\n\nTest body:\n\n``` rust\n#![feature(globs)]\n\nextern crate ice;\n\nuse ice::*;\n\n#[test]\nfn test() {\n  let values: Insert<(), (), ()> = InsertDefaultValues;\n  let query: InsertQuery<(), (), ()> = InsertQuery {\n       values: values\n  };\n  println!(\"result\");\n  println!(\"{}\", query.to_sql());  \n}\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18514/timeline", "performed_via_github_app": null, "state_reason": "completed"}