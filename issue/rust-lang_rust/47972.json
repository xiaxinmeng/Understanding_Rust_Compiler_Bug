{"url": "https://api.github.com/repos/rust-lang/rust/issues/47972", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47972/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47972/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47972/events", "html_url": "https://github.com/rust-lang/rust/issues/47972", "id": 294006527, "node_id": "MDU6SXNzdWUyOTQwMDY1Mjc=", "number": 47972, "title": "thread 'rustc' panicked at 'already borrowed: BorrowMutError', libcore/result.rs:945:5", "user": {"login": "PaulGrandperrin", "id": 1748936, "node_id": "MDQ6VXNlcjE3NDg5MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1748936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PaulGrandperrin", "html_url": "https://github.com/PaulGrandperrin", "followers_url": "https://api.github.com/users/PaulGrandperrin/followers", "following_url": "https://api.github.com/users/PaulGrandperrin/following{/other_user}", "gists_url": "https://api.github.com/users/PaulGrandperrin/gists{/gist_id}", "starred_url": "https://api.github.com/users/PaulGrandperrin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PaulGrandperrin/subscriptions", "organizations_url": "https://api.github.com/users/PaulGrandperrin/orgs", "repos_url": "https://api.github.com/users/PaulGrandperrin/repos", "events_url": "https://api.github.com/users/PaulGrandperrin/events{/privacy}", "received_events_url": "https://api.github.com/users/PaulGrandperrin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2018-02-02T20:02:01Z", "updated_at": "2018-02-24T23:28:38Z", "closed_at": "2018-02-24T23:28:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, I'm hitting a kind of transient bug:\r\n - appears seemingly randomly\r\n - then is 100% reproducible if you don't touch anything\r\n - then disappears when doing `cargo clean`\r\n\r\nIt's the second time I'm hitting it. The first time I made by mistake a change to my environment and the bug disappeared before I could get a backtrace of it. I don't remember exactly how and when it first appeared but I think it was unrelated to this new instance.\r\n\r\nI would say it looks like it's related to incremental compilation.\r\n\r\nI made a huge `tar` of my environment (.rustup .cargo and project) before doing a `cargo clean`, so if needed I can share it somewhere to reproduce.\r\n\r\nI was using a locally compiled rustc from #47828 at the time, but the other time I got it, it was with a recent official nightly.\r\n```\r\nrustc 1.25.0-dev\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.25.0-dev\r\nLLVM version: 6.0\r\n```\r\ncc: @eddyb because we spoke about it on IRC\r\n\r\nHere is the full backtrace:\r\n```\r\npaulg@debian ~/P/r/src> env RUST_BACKTRACE=full cargo run --features \"instrumentation\" --verbose\r\n       Fresh cfg-if v0.1.2\r\n       Fresh futures-await-await-macro v0.1.0\r\n       Fresh rustc-demangle v0.1.5\r\n       Fresh either v1.4.0\r\n       Fresh byteorder v1.2.1\r\n       Fresh futures v0.1.18\r\n       Fresh slab v0.4.0\r\n       Fresh unicode-xid v0.0.4\r\n       Fresh cc v1.0.4\r\n       Fresh libc v0.2.36\r\n       Fresh unicode-xid v0.1.0\r\n       Fresh num-traits v0.1.42\r\n       Fresh quote v0.3.15\r\n       Fresh itertools v0.7.6\r\n       Fresh synom v0.11.3\r\n       Fresh iovec v0.1.2\r\n       Fresh proc-macro2 v0.1.10\r\n       Fresh syn v0.11.11\r\n       Fresh bytes v0.4.6\r\n       Fresh futures-await-quote v0.4.0\r\n       Fresh enum-primitive-derive v0.1.2\r\n       Fresh synstructure v0.6.1\r\n       Fresh backtrace-sys v0.1.16\r\n       Fresh futures-await-synom v0.12.0\r\n       Fresh failure_derive v0.1.1\r\n       Fresh backtrace v0.3.5\r\n       Fresh futures-await-syn v0.12.0\r\n       Fresh failure v0.1.1\r\n       Fresh futures-await-async-macro v0.1.1\r\n       Fresh futures-await v0.1.0\r\n   Compiling reactfs v0.1.0 (file:///home/paulg/Projets/reactfs)\r\n     Running `rustc --crate-name reactfs src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 --cfg 'feature=\"instrumentation\"' -C metadata=bc74da62e3393027 -C extra-filename=-bc74da62e3393027 --out-dir /home/paulg/Projets/reactfs/target/debug/deps -C incremental=/home/paulg/Projets/reactfs/target/debug/incremental -L dependency=/home/paulg/Projets/reactfs/target/debug/deps --extern num_traits=/home/paulg/Projets/reactfs/target/debug/deps/libnum_traits-91d422bec119676e.rlib --extern byteorder=/home/paulg/Projets/reactfs/target/debug/deps/libbyteorder-e390d66463519670.rlib --extern futures=/home/paulg/Projets/reactfs/target/debug/deps/libfutures-292d74a9b9173e00.rlib --extern itertools=/home/paulg/Projets/reactfs/target/debug/deps/libitertools-304d90e56277d5f7.rlib --extern slab=/home/paulg/Projets/reactfs/target/debug/deps/libslab-4a88d95025404389.rlib --extern failure=/home/paulg/Projets/reactfs/target/debug/deps/libfailure-63b1079093d206e3.rlib --extern futures_await=/home/paulg/Projets/reactfs/target/debug/deps/libfutures_await-e7d684946059c77d.rlib --extern bytes=/home/paulg/Projets/reactfs/target/debug/deps/libbytes-bb322e567597addb.rlib --extern enum_primitive_derive=/home/paulg/Projets/reactfs/target/debug/deps/libenum_primitive_derive-0e356ce256d8b220.so --extern reactfs=/home/paulg/Projets/reactfs/target/debug/deps/libreactfs-88d7ac954800cac3.rlib -L native=/home/paulg/Projets/reactfs/target/debug/build/backtrace-sys-70a67d15ed90922a/out/.libs`\r\nerror[E0433]: failed to resolve. Could not find `instrumentation` in `core`\r\n  --> src/main.rs:37:8\r\n   |\r\n37 |     core::instrumentation::fuzz_btree(b\"\");\r\n   |           ^^^^^^^^^^^^^^^ Could not find `instrumentation` in `core`\r\n\r\nthread 'rustc' panicked at 'already borrowed: BorrowMutError', libcore/result.rs:945:5\r\nstack backtrace:\r\n   0:     0x7f0de340001b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h286b8794444c24e0\r\n   1:     0x7f0de33ccee0 - std::sys_common::backtrace::print::h224f0d22b1b51e8c\r\n   2:     0x7f0de33d2f65 - std::panicking::default_hook::{{closure}}::hfe62b839a6606b48\r\n   3:     0x7f0de33d2cc1 - std::panicking::default_hook::h6bf4077c78186846\r\n   4:     0x7f0de33d33a1 - std::panicking::rust_panic_with_hook::hfe94f219d0bc73b3\r\n   5:     0x7f0de33d3262 - std::panicking::begin_panic::hcb9d3389615f930e\r\n   6:     0x7f0de33d3162 - std::panicking::begin_panic_fmt::h3c2e7e0c6de38643\r\n   7:     0x7f0de33d30f1 - rust_begin_unwind\r\n   8:     0x7f0de3472e82 - core::panicking::panic_fmt::h455334a40386cc7c\r\n   9:     0x7f0ddfcbc245 - core::result::unwrap_failed::h3eacb25393b53dcd\r\n  10:     0x7f0ddf9de95b - rustc::ty::maps::on_disk_cache::OnDiskCache::load_diagnostics::h7b42610c81f80e3f\r\n  11:     0x7f0ddfdbd2f3 - rustc::dep_graph::graph::DepGraph::try_mark_green::hd17018d9cd45c700\r\n  12:     0x7f0ddfdbd6ea - rustc::dep_graph::graph::DepGraph::try_mark_green::hd17018d9cd45c700\r\n  13:     0x7f0ddf9dd252 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_mark_green_and_read::h1612a1810dbb6b47\r\n  14:     0x7f0ddf6a4ec7 - rustc::ty::maps::<impl rustc::ty::maps::queries::adt_def<'tcx>>::try_get::hdad1982db995c6e0\r\n  15:     0x7f0ddf91641a - rustc::ty::maps::TyCtxtAt::adt_def::h668c969545fa4695\r\n  16:     0x7f0ddf970daf - serialize::serialize::Decoder::read_enum::h64b43bb79d06e2c7\r\n  17:     0x7f0ddf9fd056 - rustc::ty::maps::on_disk_cache::__ty_decoder_impl::<impl serialize::serialize::SpecializedDecoder<&'tcx rustc::ty::TyS<'tcx>> for rustc::ty::maps::on_disk_cache::CacheDecoder<'a, 'tcx, 'x>>::specialized_decode::had3d86f29fb18219\r\n  18:     0x7f0ddf9e10ec - rustc::ty::maps::on_disk_cache::OnDiskCache::try_load_query_result::h6856f98dff5c9869\r\n  19:     0x7f0ddf69c3ea - rustc::ty::maps::<impl rustc::ty::maps::queries::type_of<'tcx>>::try_get::h9eb2b0ce7b1d773d\r\n  20:     0x7f0ddf915f0f - rustc::ty::maps::TyCtxtAt::type_of::h01a3db5b6203f699\r\n  21:     0x7f0ddf9fee50 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::type_of::h0c94c376681792c7\r\n  22:     0x7f0de1e9b958 - <rustc_typeck::collect::CollectItemTypesVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_item::hf67d6995b4fa1e74\r\n  23:     0x7f0de1ebd66c - rustc::hir::Crate::visit_all_item_likes::h0a4c9c83ce97cf1e\r\n  24:     0x7f0de1ea8487 - rustc::util::common::time::hb8c52e5097c58534\r\n  25:     0x7f0de1f78410 - rustc_typeck::check_crate::hb57d0f09c809136c\r\n  26:     0x7f0de37fedfa - <std::thread::local::LocalKey<T>>::with::h6664f48517e4b7e1\r\n  27:     0x7f0de37ffaf3 - <std::thread::local::LocalKey<T>>::with::h704a26f0a78f0701\r\n  28:     0x7f0de38551ae - rustc::ty::context::TyCtxt::create_and_enter::hae32c8a45b10f266\r\n  29:     0x7f0de376d883 - rustc_driver::driver::compile_input::h290f112545b8616b\r\n  30:     0x7f0de3833cf6 - rustc_driver::run_compiler::h7dbc15974bba2187\r\n  31:     0x7f0de373c258 - std::sys_common::backtrace::__rust_begin_short_backtrace::ha26daf9dd29d125e\r\n  32:     0x7f0de3414129 - __rust_maybe_catch_panic\r\n  33:     0x7f0de379bc87 - <F as alloc::boxed::FnBox<A>>::call_box::h0a954d980a423ec9\r\n  34:     0x7f0de3403cda - std::sys_common::thread::start_thread::hd0eea2f47ffbdc04\r\n  35:     0x7f0de33d3d35 - std::sys::unix::thread::Thread::new::thread_start::hb76f80f796f2d3c9\r\n  36:     0x7f0ddd95b519 - start_thread\r\n  37:     0x7f0de30c03ee - clone\r\n  38:                0x0 - <unknown>\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.25.0-dev running on x86_64-unknown-linux-gnu\r\n\r\nerror: Could not compile `reactfs`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name reactfs src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 --cfg feature=\"instrumentation\" -C metadata=bc74da62e3393027 -C extra-filename=-bc74da62e3393027 --out-dir /home/paulg/Projets/reactfs/target/debug/deps -C incremental=/home/paulg/Projets/reactfs/target/debug/incremental -L dependency=/home/paulg/Projets/reactfs/target/debug/deps --extern num_traits=/home/paulg/Projets/reactfs/target/debug/deps/libnum_traits-91d422bec119676e.rlib --extern byteorder=/home/paulg/Projets/reactfs/target/debug/deps/libbyteorder-e390d66463519670.rlib --extern futures=/home/paulg/Projets/reactfs/target/debug/deps/libfutures-292d74a9b9173e00.rlib --extern itertools=/home/paulg/Projets/reactfs/target/debug/deps/libitertools-304d90e56277d5f7.rlib --extern slab=/home/paulg/Projets/reactfs/target/debug/deps/libslab-4a88d95025404389.rlib --extern failure=/home/paulg/Projets/reactfs/target/debug/deps/libfailure-63b1079093d206e3.rlib --extern futures_await=/home/paulg/Projets/reactfs/target/debug/deps/libfutures_await-e7d684946059c77d.rlib --extern bytes=/home/paulg/Projets/reactfs/target/debug/deps/libbytes-bb322e567597addb.rlib --extern enum_primitive_derive=/home/paulg/Projets/reactfs/target/debug/deps/libenum_primitive_derive-0e356ce256d8b220.so --extern reactfs=/home/paulg/Projets/reactfs/target/debug/deps/libreactfs-88d7ac954800cac3.rlib -L native=/home/paulg/Projets/reactfs/target/debug/build/backtrace-sys-70a67d15ed90922a/out/.libs` (exit code: 101)\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47972/timeline", "performed_via_github_app": null, "state_reason": "completed"}