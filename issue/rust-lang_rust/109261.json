{"url": "https://api.github.com/repos/rust-lang/rust/issues/109261", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109261/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109261/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109261/events", "html_url": "https://github.com/rust-lang/rust/issues/109261", "id": 1629170418, "node_id": "I_kwDOAAsO6M5hGyry", "number": 109261, "title": "`unused_imports` lints on an import from a crate with a lang item", "user": {"login": "Niki4tap", "id": 66798058, "node_id": "MDQ6VXNlcjY2Nzk4MDU4", "avatar_url": "https://avatars.githubusercontent.com/u/66798058?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Niki4tap", "html_url": "https://github.com/Niki4tap", "followers_url": "https://api.github.com/users/Niki4tap/followers", "following_url": "https://api.github.com/users/Niki4tap/following{/other_user}", "gists_url": "https://api.github.com/users/Niki4tap/gists{/gist_id}", "starred_url": "https://api.github.com/users/Niki4tap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Niki4tap/subscriptions", "organizations_url": "https://api.github.com/users/Niki4tap/orgs", "repos_url": "https://api.github.com/users/Niki4tap/repos", "events_url": "https://api.github.com/users/Niki4tap/events{/privacy}", "received_events_url": "https://api.github.com/users/Niki4tap/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1183099971, "node_id": "MDU6TGFiZWwxMTgzMDk5OTcx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-suggestion-diagnostics", "name": "A-suggestion-diagnostics", "color": "f7e101", "default": false, "description": "Area: suggestions generated by the compiler applied by cargo fix"}, {"id": 1596299768, "node_id": "MDU6TGFiZWwxNTk2Mjk5NzY4", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-invalid-suggestion", "name": "D-invalid-suggestion", "color": "c9f7a3", "default": false, "description": "A structured suggestion resulting in incorrect code"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-03-17T11:44:39Z", "updated_at": "2023-06-04T02:59:07Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When importing an item from a crate, which has a language item defined, `unused_imports` can lint, which makes sense if the item is actually unused, but if you remove this import (run `cargo fix` for example), the code stops working, because if you don't import anything from the crate, the lang item doesn't get defined.\r\n\r\nSeems like this issue can also happen with panic handlers and other project-wide items (don't know the proper term here).\r\n\r\nInterestingly enough, it seems like importing just the crate `use lib as _` (without `::inner`) doesn't lint, which made me feel like there was a similar issue already, but I wasn't able to find it.\r\n\r\nI tried this code:\r\n\r\nlib.rs:\r\n```rust\r\n#![feature(lang_items)]\r\n#![no_std]\r\n\r\n#[lang = \"eh_personality\"]\r\nextern \"C\" fn eh_personality() {}\r\n\r\n#[panic_handler]\r\nfn panic(_info: &core::panic::PanicInfo) -> ! { loop {} }\r\n\r\npub mod inner {}\r\n```\r\n\r\nmain.rs:\r\n```rust\r\n#![no_std]\r\n#![no_main]\r\n\r\nuse lib::inner as _;\r\n\r\n#[link(name = \"c\", kind = \"dylib\")]\r\nextern {}\r\n\r\n#[no_mangle]\r\nextern \"C\" fn main() {}\r\n```\r\n\r\nI expected to see this happen: `unused_imports` doesn't fire\r\n\r\nInstead, this happened:\r\n```\r\nwarning: unused import: `lib::inner as _`\r\n --> main.rs:4:5\r\n  |\r\n4 | use lib::inner as _;\r\n  |     ^^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(unused_imports)]` on by default\r\n```\r\n\r\nAfter running `cargo fix`:\r\n```\r\nThe following errors were reported:\r\nerror: `#[panic_handler]` function required, but not found\r\n\r\nerror: language item required, but not found: `eh_personality`\r\n  |\r\n  = note: this can occur when a binary crate with `#![no_std]` is compiled for a target where `eh_personality` is defined in the standard library\r\n  = help: you may be able to compile for a target that doesn't need `eh_personality`, specify a target with `--target` or in `.cargo/config`\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.68.0-nightly (333ee6c46 2023-01-18)\r\nbinary: rustc\r\ncommit-hash: 333ee6c466972185973d5097f8b5fb0f9fb13fa5\r\ncommit-date: 2023-01-18\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.68.0-nightly\r\nLLVM version: 15.0.6\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109261/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109261/timeline", "performed_via_github_app": null, "state_reason": null}