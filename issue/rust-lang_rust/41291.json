{"url": "https://api.github.com/repos/rust-lang/rust/issues/41291", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/41291/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/41291/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/41291/events", "html_url": "https://github.com/rust-lang/rust/issues/41291", "id": 221718619, "node_id": "MDU6SXNzdWUyMjE3MTg2MTk=", "number": 41291, "title": "[beta] armv7-unknown-linux-gnueabihf bootstrap SIGILL", "user": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2017-04-14T01:00:24Z", "updated_at": "2017-04-20T09:47:25Z", "closed_at": "2017-04-20T09:47:25Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "While bootstrapping on Fedora 25 armv7l, I'm hitting a SIGILL when some beta-compiled programs are actually executed.  This is with a purely default `./configure`, no external LLVM or anything.\r\n\r\nOn beta (exactly ca3d11832caf), I get a little ways into stage1, and then build scripts SIGILL, apparently from double-panics.  I reckon that the stable stage0 builds a stage1 compiler that's fine, then that stage1 starts building things that don't even need to execute until we get to a build script.  Then:\r\n\r\n```\r\nCopying stage1 compiler (armv7-unknown-linux-gnueabihf)\r\nBuilding stage1 std artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\n    Finished release [optimized] target(s) in 0.1 secs\r\nCopying stage1 std from stage1 (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf / armv7-unknown-linux-gnueabihf)\r\nBuilding stage1 test artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\n    Finished release [optimized] target(s) in 0.0 secs\r\nCopying stage1 test from stage1 (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf / armv7-unknown-linux-gnueabihf)\r\nBuilding stage1 compiler artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\n   Compiling rustdoc v0.0.0 (file:///root/rust/src/librustdoc)\r\n   Compiling flate v0.0.0 (file:///root/rust/src/libflate)\r\n   Compiling rustc_llvm v0.0.0 (file:///root/rust/src/librustc_llvm)\r\n   Compiling syntax v0.0.0 (file:///root/rust/src/libsyntax)\r\nerror: failed to run custom build command for `rustdoc v0.0.0 (file:///root/rust/src/librustdoc)`\r\nprocess didn't exit successfully: `/root/rust/build/armv7-unknown-linux-gnueabihf/stage1-rustc/release/build/rustdoc-d21a2a025c4fade3/build-script-build` (signal: 4, SIGILL: illegal instruction)\r\n--- stderr\r\nthread panicked while processing panic. aborting.\r\n\r\nBuild failed, waiting for other jobs to finish...\r\nerror: failed to run custom build command for `flate v0.0.0 (file:///root/rust/src/libflate)`\r\nprocess didn't exit successfully: `/root/rust/build/armv7-unknown-linux-gnueabihf/stage1-rustc/release/build/flate-45efc5f9b5c983fe/build-script-build` (signal: 4, SIGILL: illegal instruction)\r\n--- stderr\r\nthread panicked while processing panic. aborting.\r\n\r\nBuild failed, waiting for other jobs to finish...\r\nerror: failed to run custom build command for `rustc_llvm v0.0.0 (file:///root/rust/src/librustc_llvm)`\r\nprocess didn't exit successfully: `/root/rust/build/armv7-unknown-linux-gnueabihf/stage1-rustc/release/build/rustc_llvm-95b19f11b71e673a/build-script-build` (signal: 4, SIGILL: illegal instruction)\r\n--- stderr\r\nthread panicked while processing panic. aborting.\r\n\r\nBuild failed, waiting for other jobs to finish...\r\n```\r\n\r\nSo I also tried the master branch (exactly 43ef63d5b427), and that fails as soon as it executes `rustc` at the start of stage1.  Here it seems that the downloaded beta stage0 compiler builds all of its stuff fine, which presumably includes executing some builds scripts like above.  But the stage1 `rustc` it creates seems to be bad:\r\n\r\n```\r\nCopying stage0 rustc from stage0 (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf / armv7-unknown-linux-gnueabihf)\r\nexecuting step Step { name: \"librustc\", stage: 0, host: \"armv7-unknown-linux-gnueabihf\", target: \"armv7-unknown-linux-gnueabihf\" }\r\nexecuting step Step { name: \"rustc\", stage: 1, host: \"armv7-unknown-linux-gnueabihf\", target: \"armv7-unknown-linux-gnueabihf\" }\r\nCopying stage1 compiler (armv7-unknown-linux-gnueabihf)\r\nexecuting step Step { name: \"startup-objects\", stage: 1, host: \"armv7-unknown-linux-gnueabihf\", target: \"armv7-unknown-linux-gnueabihf\" }\r\nexecuting step Step { name: \"build-crate-std\", stage: 1, host: \"armv7-unknown-linux-gnueabihf\", target: \"armv7-unknown-linux-gnueabihf\" }\r\nBuilding stage1 std artifacts (armv7-unknown-linux-gnueabihf -> armv7-unknown-linux-gnueabihf)\r\nrunning: \"/root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage0/bin/cargo\" \"build\" \"-j\" \"4\" \"--target\" \"armv7-unknown-linux-gnueabihf\" \"-v\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/root/rust-nightly/src/libstd/Cargo.toml\"\r\nerror: process didn't exit successfully: `/root/rust-nightly/build/bootstrap/debug/rustc -vV` (signal: 4, SIGILL: illegal instruction)\r\n--- stderr\r\nthread panicked while processing panic. aborting.\r\n\r\n\r\n\r\ncommand did not execute successfully: \"/root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage0/bin/cargo\" \"build\" \"-j\" \"4\" \"--target\" \"armv7-unknown-linux-gnueabihf\" \"-v\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/root/rust-nightly/src/libstd/Cargo.toml\"\r\nexpected success, got: exit code: 101\r\n```\r\n\r\nI traced through with gdb, and it's not actually `bootstrap/debug/rustc` crashing, rather the `stage1/bin/rustc` that it execs into.  Here's the backtrace:\r\n\r\n```\r\n#0  0xb6e65e00 in std::panicking::rust_panic_with_hook::hcf91b7c3478664b3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#1  0xb6e65d30 in std::panicking::begin_panic::h8a671f9e65f4cf12 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#2  0xb6e65ce4 in std::panicking::begin_panic_fmt::h9f922d1d569b2ea6 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#3  0xb6e65c94 in rust_begin_unwind () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#4  0xb6e7d7f4 in core::panicking::panic_fmt::h9106bacc40a4f5cd () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#5  0xb6e3fa7c in core::result::unwrap_failed::h8d064d4d03caecd3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#6  0xb6e5ab10 in std::sys_common::thread_info::ThreadInfo::with::_$u7b$$u7b$closure$u7d$$u7d$::haa3976f926a1414d () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#7  0xb6e65750 in std::panicking::default_hook::hd83360e73457e19b () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#8  0xb6e65ebc in std::panicking::rust_panic_with_hook::hcf91b7c3478664b3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#9  0xb6e65d30 in std::panicking::begin_panic::h8a671f9e65f4cf12 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#10 0xb6e65ce4 in std::panicking::begin_panic_fmt::h9f922d1d569b2ea6 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#11 0xb6e65c94 in rust_begin_unwind () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#12 0xb6e7d7f4 in core::panicking::panic_fmt::h9106bacc40a4f5cd () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#13 0xb6e3fa7c in core::result::unwrap_failed::h8d064d4d03caecd3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#14 0xb6e5ab10 in std::sys_common::thread_info::ThreadInfo::with::_$u7b$$u7b$closure$u7d$$u7d$::haa3976f926a1414d () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#15 0xb6e65750 in std::panicking::default_hook::hd83360e73457e19b () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#16 0xb6e65ebc in std::panicking::rust_panic_with_hook::hcf91b7c3478664b3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#17 0xb6e65d30 in std::panicking::begin_panic::h8a671f9e65f4cf12 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#18 0xb6e65ce4 in std::panicking::begin_panic_fmt::h9f922d1d569b2ea6 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#19 0xb6e65c94 in rust_begin_unwind () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#20 0xb6e7d7f4 in core::panicking::panic_fmt::h9106bacc40a4f5cd () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#21 0xb6e3fa7c in core::result::unwrap_failed::h8d064d4d03caecd3 () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#22 0xb6e66a6c in std::rt::lang_start::h0d05e03c29910bbb () from /root/rust-nightly/build/armv7-unknown-linux-gnueabihf/stage1/bin/../lib/libstd-8ba26b786e55861e.so\r\n#23 0xb6c6d73c in __libc_start_main () from /lib/libc.so.6\r\n#24 0x7f5556f8 in _start ()\r\n```\r\n\r\nThat looks like a *triple* panic!\r\n\r\nThe actual SIGILL is delivered for a `udf` instruction:\r\n\r\n```\r\nDump of assembler code for function _ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E:\r\n   0xb6e65d78 <+0>:     push    {r4, r5, r6, r7, r8, r9, r11, lr}\r\n   0xb6e65d7c <+4>:     sub     sp, sp, #72     ; 0x48\r\n   0xb6e65d80 <+8>:     mov     r8, r0\r\n   0xb6e65d84 <+12>:    ldr     r0, [pc, #544]  ; 0xb6e65fac <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+564>\r\n   0xb6e65d88 <+16>:    ldr     r7, [r2]\r\n   0xb6e65d8c <+20>:    ldmib   r2, {r4, r5}\r\n   0xb6e65d90 <+24>:    mov     r9, r1\r\n   0xb6e65d94 <+28>:    add     r0, pc, r0\r\n   0xb6e65d98 <+32>:    bl      0xb6e3d8c8 <__tls_get_addr@plt>\r\n   0xb6e65d9c <+36>:    ldr     r0, [r0]\r\n   0xb6e65da0 <+40>:    cmp     r0, #0\r\n   0xb6e65da4 <+44>:    beq     0xb6e65e04 <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+140>\r\n   0xb6e65da8 <+48>:    ldr     r0, [pc, #512]  ; 0xb6e65fb0 <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+568>\r\n   0xb6e65dac <+52>:    add     r0, pc, r0\r\n   0xb6e65db0 <+56>:    bl      0xb6e3d8c8 <__tls_get_addr@plt>\r\n   0xb6e65db4 <+60>:    ldr     r1, [r0, #4]\r\n   0xb6e65db8 <+64>:    add     r6, r1, #1\r\n   0xb6e65dbc <+68>:    str     r6, [r0, #4]\r\n   0xb6e65dc0 <+72>:    cmp     r6, #2\r\n   0xb6e65dc4 <+76>:    bls     0xb6e65e24 <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+172>\r\n   0xb6e65dc8 <+80>:    ldr     r0, [pc, #484]  ; 0xb6e65fb4 <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+572>\r\n   0xb6e65dcc <+84>:    ldr     r1, [pc, #484]  ; 0xb6e65fb8 <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+576>\r\n   0xb6e65dd0 <+88>:    add     r0, pc, r0\r\n   0xb6e65dd4 <+92>:    add     r1, pc, r1\r\n   0xb6e65dd8 <+96>:    str     r0, [sp, #4]\r\n   0xb6e65ddc <+100>:   mov     r0, #1\r\n   0xb6e65de0 <+104>:   str     r0, [sp, #8]\r\n   0xb6e65de4 <+108>:   mov     r0, #0\r\n   0xb6e65de8 <+112>:   str     r0, [sp, #16]\r\n   0xb6e65dec <+116>:   str     r0, [sp, #12]\r\n   0xb6e65df0 <+120>:   str     r1, [sp, #20]\r\n   0xb6e65df4 <+124>:   str     r0, [sp, #24]\r\n   0xb6e65df8 <+128>:   add     r0, sp, #4\r\n   0xb6e65dfc <+132>:   bl      0xb6e5ae8c <_ZN3std10sys_common4util10dumb_print17h91e4eccb0a94ba40E>\r\n=> 0xb6e65e00 <+136>:   udf     #65006  ; 0xfdee\r\n   0xb6e65e04 <+140>:   ldr     r0, [pc, #432]  ; 0xb6e65fbc <_ZN3std9panicking20rust_panic_with_hook17hcf91b7c3478664b3E+580>\r\n   0xb6e65e08 <+144>:   add     r0, pc, r0\r\n   0xb6e65e0c <+148>:   bl      0xb6e3d8c8 <__tls_get_addr@plt>\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/41291/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/41291/timeline", "performed_via_github_app": null, "state_reason": "completed"}