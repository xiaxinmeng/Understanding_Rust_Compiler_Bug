{"url": "https://api.github.com/repos/rust-lang/rust/issues/91372", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91372/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91372/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91372/events", "html_url": "https://github.com/rust-lang/rust/issues/91372", "id": 1066578964, "node_id": "I_kwDOAAsO6M4_krQU", "number": 91372, "title": "Linking to private symbols from frameworks between compilation units", "user": {"login": "madsmtm", "id": 10577181, "node_id": "MDQ6VXNlcjEwNTc3MTgx", "avatar_url": "https://avatars.githubusercontent.com/u/10577181?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madsmtm", "html_url": "https://github.com/madsmtm", "followers_url": "https://api.github.com/users/madsmtm/followers", "following_url": "https://api.github.com/users/madsmtm/following{/other_user}", "gists_url": "https://api.github.com/users/madsmtm/gists{/gist_id}", "starred_url": "https://api.github.com/users/madsmtm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madsmtm/subscriptions", "organizations_url": "https://api.github.com/users/madsmtm/orgs", "repos_url": "https://api.github.com/users/madsmtm/repos", "events_url": "https://api.github.com/users/madsmtm/events{/privacy}", "received_events_url": "https://api.github.com/users/madsmtm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1966877457, "node_id": "MDU6TGFiZWwxOTY2ODc3NDU3", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-critical", "name": "P-critical", "color": "eb6420", "default": false, "description": "Critical priority"}], "state": "closed", "locked": false, "assignee": {"login": "hkratz", "id": 3736990, "node_id": "MDQ6VXNlcjM3MzY5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3736990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkratz", "html_url": "https://github.com/hkratz", "followers_url": "https://api.github.com/users/hkratz/followers", "following_url": "https://api.github.com/users/hkratz/following{/other_user}", "gists_url": "https://api.github.com/users/hkratz/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkratz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkratz/subscriptions", "organizations_url": "https://api.github.com/users/hkratz/orgs", "repos_url": "https://api.github.com/users/hkratz/repos", "events_url": "https://api.github.com/users/hkratz/events{/privacy}", "received_events_url": "https://api.github.com/users/hkratz/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "hkratz", "id": 3736990, "node_id": "MDQ6VXNlcjM3MzY5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3736990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hkratz", "html_url": "https://github.com/hkratz", "followers_url": "https://api.github.com/users/hkratz/followers", "following_url": "https://api.github.com/users/hkratz/following{/other_user}", "gists_url": "https://api.github.com/users/hkratz/gists{/gist_id}", "starred_url": "https://api.github.com/users/hkratz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hkratz/subscriptions", "organizations_url": "https://api.github.com/users/hkratz/orgs", "repos_url": "https://api.github.com/users/hkratz/repos", "events_url": "https://api.github.com/users/hkratz/events{/privacy}", "received_events_url": "https://api.github.com/users/hkratz/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/87", "html_url": "https://github.com/rust-lang/rust/milestone/87", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/87/labels", "id": 7260815, "node_id": "MI_kwDOAAsO6M4AbsqP", "number": 87, "title": "1.58.0", "description": null, "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 539, "state": "closed", "created_at": "2021-10-17T19:18:18Z", "updated_at": "2022-01-18T15:20:17Z", "due_on": null, "closed_at": "2022-01-18T15:20:17Z"}, "comments": 16, "created_at": "2021-11-29T22:45:34Z", "updated_at": "2022-01-27T01:26:15Z", "closed_at": "2022-01-08T11:34:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nThis used to work on Rust `nightly-2021-11-24`:\r\n\r\n```rust\r\n// Cargo.toml\r\n[package]\r\nname = \"foo\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n// lib.rs\r\n#[link(name = \"AppKit\", kind = \"framework\")]\r\nextern \"C\" {}\r\n\r\n// main.rs\r\nuse foo as _;\r\n\r\n#[link(name = \"CoreGraphics\", kind = \"framework\")]\r\nextern \"C\" {}\r\n\r\nextern \"C\" {\r\n    fn CGDisplayCreateUUIDFromDisplayID(display: u32) -> *const std::os::raw::c_void;\r\n}\r\n\r\nfn main() {\r\n    unsafe { CGDisplayCreateUUIDFromDisplayID(0) };\r\n}\r\n```\r\n\r\n`CGDisplayCreateUUIDFromDisplayID` is present in the `ColorSync` framework (on macOS +10.13; on lower versions, in the `CoreGraphics` framework). The `AppKit` framework uses `ColorSync` internally, so the symbol is available through that (I think).\r\n\r\nLinking like this worked previously, but since Rust `nightly-2021-11-26` it started failing.\r\n\r\nThis is [affecting `winit`'s CI](https://github.com/rust-windowing/winit/runs/4356515596).\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nOS: macOS Mojave 10.14.6.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.58.0-nightly (dd549dcab 2021-11-25)\r\nbinary: rustc\r\ncommit-hash: dd549dcab404ec4c7d07b5a83aca5bdd7171138f\r\ncommit-date: 2021-11-25\r\nhost: x86_64-apple-darwin\r\nrelease: 1.58.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\n   Compiling link_error v0.1.0 (./link_error)\r\nerror: linking with `cc` failed: exit status: 1\r\n  |\r\n  = note: \"cc\" \"-m64\" \"-arch\" \"x86_64\" \"./link_error/target/debug/deps/link_error-df545b853490a663.1684psdcp1c8t8w.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.3mg4gkj495esxxn3.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.4lqpqqd6m4wsa5ac.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.4q6v301re75li0ws.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.4spajtpt70opf5uj.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.5gpk52ejgwv2r4xx.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.rk5agyyp0moj2ik.rcgu.o\" \"./link_error/target/debug/deps/link_error-df545b853490a663.aueco4pi09j3onj.rcgu.o\" \"-L\" \"./link_error/target/debug/deps\" \"-L\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib\" \"-framework\" \"CoreGraphics\" \"./link_error/target/debug/deps/liblink_error-9c8bbc70359362ee.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libstd-12c85425d8bdabd2.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libpanic_unwind-c69df909f9b81081.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libobject-f0c16355db7307b7.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libmemchr-d69ae56aea540e36.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libaddr2line-3fd4756c45c77fb7.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libgimli-1d2aab3cb0cd976a.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libstd_detect-1491074c150e2040.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/librustc_demangle-5a7d603578c76924.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libhashbrown-a5bcb345953a0f7b.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/librustc_std_workspace_alloc-3ffc0cbe23a29292.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libunwind-ee442041a1b0c90d.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcfg_if-e0c705be41bf34ff.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liblibc-23f0461cd27b5763.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liballoc-7db0f39aca3e5046.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/librustc_std_workspace_core-7454d006639b0b9c.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcore-07b1a016408f5808.rlib\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcompiler_builtins-852eb1ab762cbb0b.rlib\" \"-framework\" \"AppKit\" \"-lSystem\" \"-lresolv\" \"-lc\" \"-lm\" \"-liconv\" \"-L\" \"~/.rustup/toolchains/nightly-2021-11-26-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib\" \"-o\" \"./link_error/target/debug/deps/link_error-df545b853490a663\" \"-Wl,-dead_strip\" \"-nodefaultlibs\"\r\n  = note: Undefined symbols for architecture x86_64:\r\n            \"_CGDisplayCreateUUIDFromDisplayID\", referenced from:\r\n                link_error::main::h68dbd3e6b69f3cec in link_error-df545b853490a663.5gpk52ejgwv2r4xx.rcgu.o\r\n          ld: symbol(s) not found for architecture x86_64\r\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n\r\nerror: could not compile `link_error` due to previous error\r\n```\r\n\r\n</p>\r\n</details>\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"hkratz\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91372/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91372/timeline", "performed_via_github_app": null, "state_reason": "completed"}