{"url": "https://api.github.com/repos/rust-lang/rust/issues/74433", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74433/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74433/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74433/events", "html_url": "https://github.com/rust-lang/rust/issues/74433", "id": 659068828, "node_id": "MDU6SXNzdWU2NTkwNjg4Mjg=", "number": 74433, "title": "adding #[track_caller] to #[global_allocator] to trace allocation source", "user": {"login": "Geal", "id": 119296, "node_id": "MDQ6VXNlcjExOTI5Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/119296?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Geal", "html_url": "https://github.com/Geal", "followers_url": "https://api.github.com/users/Geal/followers", "following_url": "https://api.github.com/users/Geal/following{/other_user}", "gists_url": "https://api.github.com/users/Geal/gists{/gist_id}", "starred_url": "https://api.github.com/users/Geal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Geal/subscriptions", "organizations_url": "https://api.github.com/users/Geal/orgs", "repos_url": "https://api.github.com/users/Geal/repos", "events_url": "https://api.github.com/users/Geal/events{/privacy}", "received_events_url": "https://api.github.com/users/Geal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 129836139, "node_id": "MDU6TGFiZWwxMjk4MzYxMzk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-allocators", "name": "A-allocators", "color": "f7e101", "default": false, "description": "Area: Custom and system allocators"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}, {"id": 1606844895, "node_id": "MDU6TGFiZWwxNjA2ODQ0ODk1", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-track_caller", "name": "F-track_caller", "color": "f9c0cc", "default": false, "description": "`#![feature(track_caller)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-17T09:28:45Z", "updated_at": "2020-08-16T12:04:30Z", "closed_at": "2020-08-16T12:04:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello,\r\nI am using a [custom allocator](https://github.com/geal/tracing_allocator) to trace allocations and deallocations when debugging code. I was wondering if adding `#[track_caller]` to the `GlobalAlloc::alloc` and `GlobalAlloc::dealloc` methods could give me the origin of allocations (even if it ends up in libstd), but unfortunately, it only gives me the position of the `#[global_allocator]` attribute.\r\n\r\nAs an alternative, I am trying to obtain it with the [backtrace crate](https://crates.io/crates/backtrace), but apparently I cannot resolve the symbols for a stackframe (I suspect it would allocate), so I would need to store the instruction address at runtime, and post process the result with [gimli](https://crates.io/crates/gimli).\r\n\r\nMaking `#[track_caller]` usable from a custom allocator would simplify a lot that use case, since everything returned by `panic::Location::caller()` is `'static`, so there are no allocations.\r\n\r\nSo I'm not sure if this request fits the use case of `#[track_caller]` but I'm probably not the only one wanting a nice way to track allocations :)", "closed_by": {"login": "Geal", "id": 119296, "node_id": "MDQ6VXNlcjExOTI5Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/119296?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Geal", "html_url": "https://github.com/Geal", "followers_url": "https://api.github.com/users/Geal/followers", "following_url": "https://api.github.com/users/Geal/following{/other_user}", "gists_url": "https://api.github.com/users/Geal/gists{/gist_id}", "starred_url": "https://api.github.com/users/Geal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Geal/subscriptions", "organizations_url": "https://api.github.com/users/Geal/orgs", "repos_url": "https://api.github.com/users/Geal/repos", "events_url": "https://api.github.com/users/Geal/events{/privacy}", "received_events_url": "https://api.github.com/users/Geal/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74433/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74433/timeline", "performed_via_github_app": null, "state_reason": "completed"}