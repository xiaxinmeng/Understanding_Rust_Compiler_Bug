{"url": "https://api.github.com/repos/rust-lang/rust/issues/50628", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50628/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50628/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50628/events", "html_url": "https://github.com/rust-lang/rust/issues/50628", "id": 322068846, "node_id": "MDU6SXNzdWUzMjIwNjg4NDY=", "number": 50628, "title": "rustc, error 101", "user": {"login": "hedgar2017", "id": 31586236, "node_id": "MDQ6VXNlcjMxNTg2MjM2", "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hedgar2017", "html_url": "https://github.com/hedgar2017", "followers_url": "https://api.github.com/users/hedgar2017/followers", "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}", "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}", "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions", "organizations_url": "https://api.github.com/users/hedgar2017/orgs", "repos_url": "https://api.github.com/users/hedgar2017/repos", "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}", "received_events_url": "https://api.github.com/users/hedgar2017/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-05-10T20:15:48Z", "updated_at": "2018-05-29T08:01:10Z", "closed_at": "2018-05-29T08:01:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "The code I worked on when the compiler started to crash:\r\n```\r\nstate.database.send(user)\r\n        .from_err()\r\n        .and_then(|res| {\r\n            match res {\r\n                Ok(user) => Ok(view::user::json(&user)),\r\n                Err(_) => Ok(view::Error::InternalError.into()),\r\n                //Err(_) => Ok(actix_web::HttpResponse::InternalServerError().into()),\r\n            }\r\n        })\r\n        .responder()\r\n```\r\n\r\nLogs with full backtrace:\r\n\r\n  ```\r\n Compiling l2_loki_server v0.1.1 (file:///home/hedgar/share/src/L2LokiServer)\r\n     Running `rustc --crate-name l2_loki_server src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=893315bf4caeed9c -C extra-filename=-893315bf4caeed9c --out-dir /home/hedgar/share/src/L2LokiServer/target/debug/deps -C incremental=/home/hedgar/share/src/L2LokiServer/target/debug/incremental -L dependency=/home/hedgar/share/src/L2LokiServer/target/debug/deps --extern futures=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libfutures-91246f81fd045a75.rlib --extern serde_derive=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde_derive-d252ad1b95e490b0.so --extern actix=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libactix-be666c94d5155c10.rlib --extern failure=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libfailure-b81d669fb4be0425.rlib --extern diesel=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libdiesel-d4b184aa0bb9f13a.rlib --extern serde=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde-d7469299e49f1978.rlib --extern env_logger=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libenv_logger-d933f45970fb75ad.rlib --extern serde_json=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde_json-020d1231a90ed580.rlib --extern actix_web=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libactix_web-a8bed6e22a252cda.rlib -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/backtrace-sys-593be0f56d76b72e/out/.libs -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/brotli-sys-63eab5591cb8b2f0/out -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/ring-e012e05d037e6ca4/out -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/miniz-sys-3e2c2de0c9951ff4/out -L native=/usr/lib`\r\nwarning: Hard linking files in the incremental compilation cache failed. Copying files instead. Consider moving the cache directory to a file system which supports hard linking in session dir `/home/hedgar/share/src/L2LokiServer/target/debug/incremental/l2_loki_server-milgj98ihldx/s-f0wyl220dn-1gbunql-working`\r\n\r\nthread 'rustc' panicked at 'already borrowed: BorrowMutError', libcore/result.rs:945:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at libstd/sys_common/backtrace.rs:71\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/sys_common/backtrace.rs:59\r\n             at libstd/panicking.rs:380\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:396\r\n   4: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:576\r\n   5: std::panicking::begin_panic\r\n             at libstd/panicking.rs:537\r\n   6: std::panicking::begin_panic_fmt\r\n             at libstd/panicking.rs:521\r\n   7: rust_begin_unwind\r\n             at libstd/panicking.rs:497\r\n   8: core::panicking::panic_fmt\r\n             at libcore/panicking.rs:71\r\n   9: core::result::unwrap_failed\r\n  10: rustc::ty::maps::on_disk_cache::OnDiskCache::load_diagnostics\r\n  11: rustc::dep_graph::graph::DepGraph::try_mark_green\r\n  12: rustc::dep_graph::graph::DepGraph::try_mark_green\r\n  13: rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_mark_green_and_read\r\n  14: rustc::ty::maps::<impl rustc::ty::maps::queries::adt_def<'tcx>>::try_get_with\r\n  15: rustc::ty::maps::TyCtxtAt::adt_def\r\n  16: rustc::ty::codec::decode_adt_def\r\n  17: serialize::serialize::Decoder::read_enum_variant\r\n  18: rustc::ty::codec::decode_ty\r\n  19: serialize::serialize::Decoder::read_enum_variant\r\n  20: <<core::result::Result<V, E> as core::iter::traits::FromIterator<core::result::Result<A, E>>>::from_iter::Adapter<Iter, E> as core::iter::iterator::Iterator>::next\r\n  21: <core::result::Result<V, E> as core::iter::traits::FromIterator<core::result::Result<A, E>>>::from_iter\r\n  22: <core::result::Result<T, E> as rustc::ty::context::InternIteratorElement<T, R>>::intern_with\r\n  23: rustc::ty::codec::decode_substs\r\n  24: serialize::serialize::Decoder::read_enum_variant\r\n  25: rustc::ty::codec::decode_ty\r\n  26: rustc::ty::maps::on_disk_cache::OnDiskCache::load_indexed\r\n  27: rustc::ty::maps::<impl rustc::ty::maps::queries::type_of<'tcx>>::try_get_with\r\n  28: rustc::ty::maps::TyCtxtAt::type_of\r\n  29: rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::type_of\r\n  30: <rustc_typeck::collect::CollectItemTypesVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_impl_item\r\n  31: rustc_typeck::check_crate::{{closure}}::{{closure}}\r\n  32: rustc_typeck::check_crate\r\n  33: rustc::ty::context::TyCtxt::create_and_enter\r\n  34: rustc_driver::driver::compile_input\r\n  35: rustc_driver::run_compiler\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.25.0 (84203cac6 2018-03-25) running on x86_64-unknown-linux-gnu\r\n\r\nerror: Could not compile `l2_loki_server`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name l2_loki_server src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=893315bf4caeed9c -C extra-filename=-893315bf4caeed9c --out-dir /home/hedgar/share/src/L2LokiServer/target/debug/deps -C incremental=/home/hedgar/share/src/L2LokiServer/target/debug/incremental -L dependency=/home/hedgar/share/src/L2LokiServer/target/debug/deps --extern futures=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libfutures-91246f81fd045a75.rlib --extern serde_derive=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde_derive-d252ad1b95e490b0.so --extern actix=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libactix-be666c94d5155c10.rlib --extern failure=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libfailure-b81d669fb4be0425.rlib --extern diesel=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libdiesel-d4b184aa0bb9f13a.rlib --extern serde=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde-d7469299e49f1978.rlib --extern env_logger=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libenv_logger-d933f45970fb75ad.rlib --extern serde_json=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libserde_json-020d1231a90ed580.rlib --extern actix_web=/home/hedgar/share/src/L2LokiServer/target/debug/deps/libactix_web-a8bed6e22a252cda.rlib -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/backtrace-sys-593be0f56d76b72e/out/.libs -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/brotli-sys-63eab5591cb8b2f0/out -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/ring-e012e05d037e6ca4/out -L native=/home/hedgar/share/src/L2LokiServer/target/debug/build/miniz-sys-3e2c2de0c9951ff4/out -L native=/usr/lib` (exit code: 101)\r\n```\r\n\r\nI had a problem with different futures crate versions conflicting with each other. When I fixed it and finished playing with it, I returned to one of my futures handles (at the beginning of the post), commented the third arm, uncommented the second one and ran 'cargo run', then the compiler crashed.\r\nI removed the whole /target directory and recompiled everything. Does not crash now.", "closed_by": {"login": "hedgar2017", "id": 31586236, "node_id": "MDQ6VXNlcjMxNTg2MjM2", "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hedgar2017", "html_url": "https://github.com/hedgar2017", "followers_url": "https://api.github.com/users/hedgar2017/followers", "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}", "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}", "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions", "organizations_url": "https://api.github.com/users/hedgar2017/orgs", "repos_url": "https://api.github.com/users/hedgar2017/repos", "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}", "received_events_url": "https://api.github.com/users/hedgar2017/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50628/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50628/timeline", "performed_via_github_app": null, "state_reason": "completed"}