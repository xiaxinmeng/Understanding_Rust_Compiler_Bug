{"url": "https://api.github.com/repos/rust-lang/rust/issues/104723", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104723/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104723/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104723/events", "html_url": "https://github.com/rust-lang/rust/issues/104723", "id": 1460205875, "node_id": "I_kwDOAAsO6M5XCPkz", "number": 104723, "title": "bootstrap should not use `rustc --version` to detect the build triple on on Mac Apple Silicon M1 arm64", "user": {"login": "HarrisonMc555", "id": 22666187, "node_id": "MDQ6VXNlcjIyNjY2MTg3", "avatar_url": "https://avatars.githubusercontent.com/u/22666187?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HarrisonMc555", "html_url": "https://github.com/HarrisonMc555", "followers_url": "https://api.github.com/users/HarrisonMc555/followers", "following_url": "https://api.github.com/users/HarrisonMc555/following{/other_user}", "gists_url": "https://api.github.com/users/HarrisonMc555/gists{/gist_id}", "starred_url": "https://api.github.com/users/HarrisonMc555/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HarrisonMc555/subscriptions", "organizations_url": "https://api.github.com/users/HarrisonMc555/orgs", "repos_url": "https://api.github.com/users/HarrisonMc555/repos", "events_url": "https://api.github.com/users/HarrisonMc555/events{/privacy}", "received_events_url": "https://api.github.com/users/HarrisonMc555/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3940166907, "node_id": "LA_kwDOAAsO6M7q2iz7", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AArch64", "name": "O-AArch64", "color": "6e6ec0", "default": false, "description": "Armv8-A or later processors in AArch64 mode"}], "state": "closed", "locked": false, "assignee": {"login": "john-h-k", "id": 32420055, "node_id": "MDQ6VXNlcjMyNDIwMDU1", "avatar_url": "https://avatars.githubusercontent.com/u/32420055?v=4", "gravatar_id": "", "url": "https://api.github.com/users/john-h-k", "html_url": "https://github.com/john-h-k", "followers_url": "https://api.github.com/users/john-h-k/followers", "following_url": "https://api.github.com/users/john-h-k/following{/other_user}", "gists_url": "https://api.github.com/users/john-h-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/john-h-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/john-h-k/subscriptions", "organizations_url": "https://api.github.com/users/john-h-k/orgs", "repos_url": "https://api.github.com/users/john-h-k/repos", "events_url": "https://api.github.com/users/john-h-k/events{/privacy}", "received_events_url": "https://api.github.com/users/john-h-k/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "john-h-k", "id": 32420055, "node_id": "MDQ6VXNlcjMyNDIwMDU1", "avatar_url": "https://avatars.githubusercontent.com/u/32420055?v=4", "gravatar_id": "", "url": "https://api.github.com/users/john-h-k", "html_url": "https://github.com/john-h-k", "followers_url": "https://api.github.com/users/john-h-k/followers", "following_url": "https://api.github.com/users/john-h-k/following{/other_user}", "gists_url": "https://api.github.com/users/john-h-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/john-h-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/john-h-k/subscriptions", "organizations_url": "https://api.github.com/users/john-h-k/orgs", "repos_url": "https://api.github.com/users/john-h-k/repos", "events_url": "https://api.github.com/users/john-h-k/events{/privacy}", "received_events_url": "https://api.github.com/users/john-h-k/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2022-11-22T16:37:39Z", "updated_at": "2023-04-28T06:32:01Z", "closed_at": "2023-04-28T06:32:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "# TL;DR\n\nI understand that Apple Silicon/M1/Arm is not supported as a tier 1 target. However, I was hoping that I would be able to compile the Rust compiler with Rosetta support. However, I could not do so.\n\n# Details\n\nI did a fresh clone of the `rust` repository and tried to compile it by running `./x.py`. However, it gave me the following errors:\n\n```\n  = note: ld: warning: ignoring file /opt/homebrew/Cellar/xz/5.2.7/lib/liblzma.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\n          Undefined symbols for architecture x86_64:\n            \"_lzma_code\", referenced from:\n                xz2::stream::Stream::process::h73782f45eb644e15 in libxz2-35bd6285e11c4f9a.rlib(xz2-35bd6285e11c4f9a.xz2.e97199be-cgu.2.rcgu.o)\n            \"_lzma_end\", referenced from:\n                _$LT$xz2..stream..Stream$u20$as$u20$core..ops..drop..Drop$GT$::drop::h9a9d62c278838afd in libxz2-35bd6285e11c4f9a.rlib(xz2-35bd6285e11c4f9a.xz2.e97199be-cgu.2.rcgu.o)\n            \"_lzma_stream_decoder\", referenced from:\n                xz2::stream::Stream::new_stream_decoder::hfed3d487f93f4786 in libxz2-35bd6285e11c4f9a.rlib(xz2-35bd6285e11c4f9a.xz2.e97199be-cgu.2.rcgu.o)\n          ld: symbol(s) not found for architecture x86_64\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\nI expected to see this happen: I expected to be able to compile the Rust compiler on my machine.\n\nInstead, this happened: I could not compile the Rust compiler on my machine.\n\nI can see the warning that \"building for macOS-x86_64 but attempting to link with file built for macOS-arm64\". However, I don't know how to change that. I'm also a bit confused by the difference in reporting from the rust tools themselves vs. the `file` command. The tools themselves report \"x86_64\", but the `file` command reports \"arm64\".\n\n```\n$ rustc --version --verbose\nrustc 1.64.0 (a55dd71d5 2022-09-19)\nbinary: rustc\ncommit-hash: a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52\ncommit-date: 2022-09-19\nhost: x86_64-apple-darwin\nrelease: 1.64.0\nLLVM version: 14.0.6\n\n$ file $(which rustc)\n/Users/harrisonmccullough/.cargo/bin/rustc: Mach-O 64-bit executable arm64\n\n$ cargo --version --verbose\ncargo 1.64.0 (387270bc7 2022-09-16)\nrelease: 1.64.0\ncommit-hash: 387270bc7f446d17869c7f208207c73231d6a252\ncommit-date: 2022-09-16\nhost: x86_64-apple-darwin\nlibgit2: 1.4.2 (sys:0.14.2 vendored)\nlibcurl: 7.79.1 (sys:0.4.55+curl-7.83.1 system ssl:(SecureTransport) LibreSSL/3.3.6)\nos: Mac OS 12.5.1 [64-bit]\n\n$ file $(which cargo)\n/Users/harrisonmccullough/.cargo/bin/cargo: Mach-O 64-bit executable arm64\n```\n\n### Meta\n```\n$ rustc --version --verbose\nrustc 1.64.0 (a55dd71d5 2022-09-19)\nbinary: rustc\ncommit-hash: a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52\ncommit-date: 2022-09-19\nhost: x86_64-apple-darwin\nrelease: 1.64.0\nLLVM version: 14.0.6\n```\n\n```\n$ uname -a\nDarwin Harrison-MacBook-Pro 21.6.0 Darwin Kernel Version 21.6.0: Wed Aug 10 14:28:23 PDT 2022; root:xnu-8020.141.5~2/RELEASE_ARM64_T6000 arm64 arm Darwin\n\n$ git log --format=%H -n1\n736c675d2ab65bcde6554e1b73340c2dbc27c85a\n```\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"john-h-k\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104723/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104723/timeline", "performed_via_github_app": null, "state_reason": "completed"}