{"url": "https://api.github.com/repos/rust-lang/rust/issues/42287", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42287/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42287/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42287/events", "html_url": "https://github.com/rust-lang/rust/issues/42287", "id": 231886760, "node_id": "MDU6SXNzdWUyMzE4ODY3NjA=", "number": 42287, "title": "Warn when elided lifetime is shorter than it could have been.", "user": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-05-28T18:50:09Z", "updated_at": "2018-03-02T23:01:57Z", "closed_at": "2017-06-23T12:51:04Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Hi! Several times I've faced this interesting case of lifetime miselision:\r\n\r\n```Rust\r\nstruct Foo<'a> { bar: &'a Bar}\r\n\r\nimpl<'a> Foo<'a> {\r\n  fn get_bar(&self) -> & /* 'a */ Bar { self.bar }\r\n}\r\n```\r\n\r\nhttp://play.integer32.com/?gist=3aba0526aff729bb9d62483a10732826&version=undefined\r\n\r\nHere, we want to use `'a` lifetime for the returned `Bar` reference, but lifetime elision gives use lifetime of the self reference. The problem here is that code with elided lifetimes compiles flawlessly by itself, but may fail at the call site, and this is tremendously confusing, because you get a misleading compiler error in the completely wrong place! I've hit this issues several times in practice ([the latest one](https://github.com/matklad/fall/commit/73eeeb9d5f464fbdb2bb7b8f24975f4d8f586bb9#diff-036076241b912ab646c1ef74b94afccaL31)).\r\n\r\nI wonder if we can warn about this? That is, we issue a warning if a lifetime in a returned position is elided, but the lifetime of the returned value from the function can actually be larger (alternatively, if the actual lifetime is among the input lifetimes, and is not the same as the one inferred by elision). The fix for warning would be to specify lifetimes explicitly (I suppose that \"I did mean to use a shorter lifetime here\" is a rather rare use-case). ", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42287/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42287/timeline", "performed_via_github_app": null, "state_reason": "completed"}