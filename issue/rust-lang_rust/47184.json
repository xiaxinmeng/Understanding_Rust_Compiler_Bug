{"url": "https://api.github.com/repos/rust-lang/rust/issues/47184", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47184/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47184/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47184/events", "html_url": "https://github.com/rust-lang/rust/issues/47184", "id": 286024016, "node_id": "MDU6SXNzdWUyODYwMjQwMTY=", "number": 47184, "title": "NLL should identify and respect the lifetime annotations that the user wrote", "user": {"login": "shepmaster", "id": 174509, "node_id": "MDQ6VXNlcjE3NDUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shepmaster", "html_url": "https://github.com/shepmaster", "followers_url": "https://api.github.com/users/shepmaster/followers", "following_url": "https://api.github.com/users/shepmaster/following{/other_user}", "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions", "organizations_url": "https://api.github.com/users/shepmaster/orgs", "repos_url": "https://api.github.com/users/shepmaster/repos", "events_url": "https://api.github.com/users/shepmaster/events{/privacy}", "received_events_url": "https://api.github.com/users/shepmaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234876, "node_id": "MDU6TGFiZWwyMzQ4NzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-hard", "name": "E-hard", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Hard / a lot"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 37977651, "node_id": "MDU6TGFiZWwzNzk3NzY1MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/metabug", "name": "metabug", "color": "5319e7", "default": false, "description": "Issues about issues themselves (\"bugs about bugs\")"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867466592, "node_id": "MDU6TGFiZWw4Njc0NjY1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-sound", "name": "NLL-sound", "color": "f799ea", "default": false, "description": "Working towards the \"invalid code does not compile\" goal"}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/55", "html_url": "https://github.com/rust-lang/rust/milestone/55", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/55/labels", "id": 3463307, "node_id": "MDk6TWlsZXN0b25lMzQ2MzMwNw==", "number": 55, "title": "Rust 2018 Release", "description": "See https://internals.rust-lang.org/t/rust-2018-the-home-stretch/7810", "creator": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 66, "state": "closed", "created_at": "2018-06-29T18:51:49Z", "updated_at": "2018-12-08T10:44:16Z", "due_on": "2018-12-06T08:00:00Z", "closed_at": "2018-12-08T10:44:16Z"}, "comments": 38, "created_at": "2018-01-04T15:38:25Z", "updated_at": "2018-10-30T17:41:54Z", "closed_at": "2018-10-30T17:41:53Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We have made some progress on this issue.\r\n\r\nHere's a list of everywhere within function bodies where we annotate types, with check boxes on the ones that are currently getting checked by the MIR-borrowck / NLL.\r\n\r\n- [ ] Let bindings\r\n  - [x] Simple local variable declarations, eg. `let x: u32 = 3;`\r\n  - [x] More complicated let bindings. eg. `let (x, y): (u32, u32) = (33, 54);`\r\n    - [x] https://github.com/rust-lang/rust/pull/53873 made these *mostly* work, but there are some edge cases where we still have problems. See the FIXME in the `patterns.rs` UI test.\r\n    - [x] remainder is broken out into https://github.com/rust-lang/rust/issues/54570\r\n  - [x] \"Ignored\" bindings, eg. `let _: Foo<'long> = c_is_short_oops;` (https://github.com/rust-lang/rust/pull/53873)\r\n  - [x] Simple bindings with no initializer, e.g., `let x: T;` (https://github.com/rust-lang/rust/pull/53873)\r\n  - [x] Complex bindings with no initializer, e.g., `let (x, y): (u32, u32);`\r\n    - broken out into https://github.com/rust-lang/rust/issues/54570\r\n  - [ ] `ref` bindings: e.g. `let ref x: u32 = 3;`, broken out into #55401\r\n- [ ] Turbofish\r\n  - [x] Function calls. eg. `\"2048\".parse::<u32>()` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Fully qualified paths. eg. `<T as Trait<_>>::method` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Fully qualified paths. eg. `<_ as Trait<T>>::method` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Fully qualified paths. eg. `<_ as Trait<_>>::method<T>` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Multi-segment paths. e.g. `Foo::<X>::method` -- broken out into https://github.com/rust-lang/rust/issues/54574\r\n  - [x] Value references. eg. `let x = foo::<...>;` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Struct names. eg. `let x = SomeStruct::<'static> { field: u32 };` -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Associated constants in expressions: `<T as Foo>::BAR` ? (broken out to https://github.com/rust-lang/rust/issues/54571)\r\n  - [ ] Associated constants in patterns: `<T as Foo>::BAR` ? (https://github.com/rust-lang/rust/issues/55511)\r\n  - [x] Lifetimes in patterns: `let A::<'static>(r) = ...` ? -- broken out into https://github.com/rust-lang/rust/issues/54573\r\n  - [x] Calls to enum variants / struct ctors: `Enum::Variant::<...>(...)`  -- https://github.com/rust-lang/rust/pull/53225\r\n  - [x] Reference to nullary structs / variants: `None::<&'static u32>` -- https://github.com/rust-lang/rust/pull/53225\r\n- [x] Casts: `x as T` (broken out into https://github.com/rust-lang/rust/issues/54332)\r\n- [x] Type ascription: `x: &'static u32` (broken out into https://github.com/rust-lang/rust/issues/54331)\r\n- [x] Method call disambiguation. eg. `<Type as Trait>::method(args);` -- https://github.com/rust-lang/rust/pull/53225\r\n- [x] Lifetimes defined but not used, this currently only occurs in the `yield-subtype.rs` test but that will also need resolved.\r\n- [ ] Normalization code is probably wrong (the user types need, I suspect, to be normalized? Not sure, have to look.)\r\n\r\n(We should update this list as we think of more.)\r\n\r\nOriginal bug report follows:\r\n\r\n----\r\n\r\nThis code compiles with 1.24.0-nightly (2018-01-03 0a3761e63e5961ddd6ae5b9923e7a3c0725541f8):\r\n\r\n```rust\r\n#![feature(nll)]\r\n\r\nfn main() {\r\n    let vec: Vec<&'static String> = vec![&String::new()];\r\n\r\n    // fn only_static(_: Vec<&'static String>) {}\r\n    // only_static(vec);\r\n}\r\n```\r\n\r\nThis is confusing as the `Vec` almost certainly cannot contain a reference of a `'static` lifetime. If you uncomment the call to `only_static`, you get the expected error that the `String` does not live long enough.\r\n\r\n@nikomatsakis said:\r\n\r\n> NLL currently ignores hand-written type annotations, in particular, those that appear in local variables.", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47184/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47184/timeline", "performed_via_github_app": null, "state_reason": "completed"}