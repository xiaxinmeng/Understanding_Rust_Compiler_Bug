{"url": "https://api.github.com/repos/rust-lang/rust/issues/63145", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63145/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63145/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63145/events", "html_url": "https://github.com/rust-lang/rust/issues/63145", "id": 474724044, "node_id": "MDU6SXNzdWU0NzQ3MjQwNDQ=", "number": 63145, "title": "Fix to #62194 broke the coherence tests and made error messages more mysterious", "user": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-07-30T17:57:33Z", "updated_at": "2019-08-06T12:02:21Z", "closed_at": "2019-08-06T12:02:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "PR #62696 had *removed* the notes from the tests for the upstream/downstream printing logic, so now that logic is not tested:\r\n\r\nhttps://github.com/rust-lang/rust/commit/2ced474e808d59e4b3bf2c6874e40446a4598f51\r\n\r\nPlus, the new error messages are worse: an upstream impl can indeed be added, even if the crate is private.\r\n\r\nI think that even in the OP case, some sort of note should be added, unless we change coherence. Again, the test case:\r\n```Rust\r\ntrait Private {\r\n}\r\n\r\nimpl<T: Private> Send for T {\r\n//~^ ERROR conflicting implementations\r\n}\r\n```\r\n\r\nThere, the error message is a coherence conflict for `&_: Send`, where this impl conflicts with the libcore impl, because the compiler can't prove that `! &_: Private`.\r\n\r\nNow, the error message says that the reason that the compiler can't prove `! &_ : Private` is because of a possible downstream impl. Of course, no downstream impl can exist as the trait is private, however, I don't think we want to change coherence to account for that, especially not without an RFC.\r\n\r\nMaybe a wording change is in order?\r\n\r\nI don't think the \"upstream\" message needs to change any (see the test diff), it's still good in the private case. Maybe it should try to mention a non-private trait, but that would be some work.\r\n\r\nSay, for non-exported trait, change the note to say:\r\n```\r\nnote: unable to assume the type `&_` does not implement the trait `Private`\r\n```\r\n\r\nI'm not even sure the note is a problem, I personally like the state before the PR the best.\r\n\r\ncc @estebank @nagisa", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63145/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63145/timeline", "performed_via_github_app": null, "state_reason": "completed"}