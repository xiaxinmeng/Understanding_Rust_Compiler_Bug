{"url": "https://api.github.com/repos/rust-lang/rust/issues/99121", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/99121/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/99121/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/99121/events", "html_url": "https://github.com/rust-lang/rust/issues/99121", "id": 1299966464, "node_id": "I_kwDOAAsO6M5Ne-oA", "number": 99121, "title": "rustdoc: sidebar items not shown on crate page on docs.rs", "user": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 2406929537, "node_id": "MDU6TGFiZWwyNDA2OTI5NTM3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-rustdoc-ui", "name": "A-rustdoc-ui", "color": "f7e101", "default": false, "description": "Area: rustdoc UI (generated HTML)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-07-10T16:52:25Z", "updated_at": "2022-07-15T14:25:22Z", "closed_at": "2022-07-15T14:25:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On docs.rs pages, until recently, the crate page (the top of the hierarchy for a crate) would show structs, enums, traits, etc in the sidebar, in addition to the page contents:\r\n\r\nhttps://docs.rs/rustls/0.20.6/rustls/index.html\r\n\r\n<img src=\"https://user-images.githubusercontent.com/220205/178153876-f6bcd9f0-10dd-4fdf-96d8-946411e1fbc0.png\" width=200>\r\n\r\nIn more recently built pages, it doesn't: \r\n\r\n<img src=\"https://user-images.githubusercontent.com/220205/178153898-1f58915a-774f-4477-9f33-7d16770835ea.png\" width=200>\r\n\r\nI believe this is in part due to my refactoring in #98124 - I believed (based on behavior for library/std) that crate pages were not intended to show structs, etc in the sidebar.\r\n\r\nHowever, it gets more complicated. The code in main.js shows that it's not supposed to display those \"sidebar items\" on module pages. Crate pages are considered module pages (they have `class=\"crate mod ...\"`).\r\n\r\nhttps://github.com/rust-lang/rust/blob/29554c0a120f6c1eb0c60f2a88c06faeb3d0f3c9/src/librustdoc/html/static/js/main.js#L482-L483\r\n\r\nSo why does docs.rs show the sidebar items on a crate page? The check above operates on `document.body`, but docs.rs rewrites the HTML so what _used_ to be the body tag becomes `<div id=\"rustdoc_body_wrapper\" class=\"...\">`. So the class is still present from CSS' perspective but it's on the wrong div so the check passes. On doc.rs, nothing is considered a module page so every page gets the full list of sidebar items. The check is buggy; or another way of thinking about it is that the interface between rustdoc and docs.rs is not clearly defined. A better way to do this particular check might be to use rustdoc-vars instead of piggybacking on CSS semantics.\r\n\r\nI think we should fix the most recent change, so docs.rs gets sidebar items on crate and module pages again, and then discuss what behavior we actually intend.\r\n\r\nSome context: here's the PR from about a year ago where we tried to suppress showing structs etc on module pages: https://github.com/rust-lang/rust/pull/84834/files#r625337543\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/99121/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/99121/timeline", "performed_via_github_app": null, "state_reason": "completed"}