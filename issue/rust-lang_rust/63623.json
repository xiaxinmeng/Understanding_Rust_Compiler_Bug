{"url": "https://api.github.com/repos/rust-lang/rust/issues/63623", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63623/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63623/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63623/events", "html_url": "https://github.com/rust-lang/rust/issues/63623", "id": 481405976, "node_id": "MDU6SXNzdWU0ODE0MDU5NzY=", "number": 63623, "title": "[llvm build] Host compiler must support std::atomic", "user": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-08-16T01:46:39Z", "updated_at": "2019-08-16T10:56:49Z", "closed_at": "2019-08-16T10:56:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I cannot build rustc locally with commit f7af19c279.\r\n\r\nThe build log is:\r\n\r\n```bash\r\n% ./x.py test src/test/ui --pass check\r\nUpdating only changed submodules\r\nSubmodules updated in 0.06 seconds\r\n    Finished dev [unoptimized] target(s) in 0.21s\r\nBuilding stage0 std artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n    Finished release [optimized] target(s) in 0.29s\r\nCopying stage0 std from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding stage0 test artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n    Finished release [optimized] target(s) in 0.22s\r\nCopying stage0 test from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding stage0 compiler artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n    Finished release [optimized] target(s) in 0.27s\r\nCopying stage0 rustc from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding LLVM for x86_64-unknown-linux-gnu\r\nrunning: \"cmake\" \"/home/lzutao/forked/rust/compiler-rust/src/llvm-project/llvm\" \"-G\" \"Ninja\" \"-DLLVM_ENABLE_ASSERTIONS=OFF\" \"-DLLVM_TARGETS_TO_BUILD=AArch64;ARM;X86\" \"-DLLVM_EXPERIMENTAL_TARGETS_TO_BUILD=\" \"-DLLVM_INCLUDE_EXAMPLES=OFF\" \"-DLLVM_INCLUDE_TESTS=OFF\" \"-DLLVM_I\r\nNCLUDE_DOCS=OFF\" \"-DLLVM_INCLUDE_BENCHMARKS=OFF\" \"-DLLVM_ENABLE_ZLIB=OFF\" \"-DWITH_POLLY=OFF\" \"-DLLVM_ENABLE_TERMINFO=OFF\" \"-DLLVM_ENABLE_LIBEDIT=OFF\" \"-DLLVM_ENABLE_Z3_SOLVER=OFF\" \"-DLLVM_PARALLEL_COMPILE_JOBS=32\" \"-DLLVM_TARGET_ARCH=x86_64\" \"-DLLVM_DEFAULT_TARGET_TRIPLE=\r\nx86_64-unknown-linux-gnu\" \"-DLLVM_OCAML_INSTALL_PATH=usr/lib/ocaml\" \"-DLLVM_LINK_LLVM_DYLIB=ON\" \"-DLLVM_ENABLE_LIBXML2=OFF\" \"-DLLVM_VERSION_SUFFIX=-rust-1.39.0-dev-48818e9f5\" \"-DPYTHON_EXECUTABLE=/home/lzutao/.local/bin/python2.7\" \"-DCMAKE_INSTALL_MESSAGE=LAZY\" \"-DCMAKE_C\r\n_COMPILER_LAUNCHER=ccache\" \"-DCMAKE_CXX_COMPILER_LAUNCHER=ccache\" \"-DCMAKE_C_COMPILER=cc\" \"-DCMAKE_CXX_COMPILER=c++\" \"-DCMAKE_C_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64\" \"-DCMAKE_CXX_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64\" \"-DCMAKE_INSTALL_PREFIX\r\n=/home/lzutao/forked/rust/compiler-rust/build/x86_64-unknown-linux-gnu/llvm\" \"-DCMAKE_BUILD_TYPE=Release\"\r\n-- Could NOT find Z3: Found unsuitable version \"0.0.0\", but required is at least \"4.7.1\" (found Z3_LIBRARIES-NOTFOUND)\r\nCMake Error at cmake/modules/CheckAtomic.cmake:50 (message):\r\n  Host compiler must support std::atomic!\r\nCall Stack (most recent call first):\r\n  cmake/config-ix.cmake:349 (include)\r\n  CMakeLists.txt:618 (include)\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/home/lzutao/forked/rust/compiler-rust/build/x86_64-unknown-linux-gnu/llvm/build/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/home/lzutao/forked/rust/compiler-rust/build/x86_64-unknown-linux-gnu/llvm/build/CMakeFiles/CMakeError.log\".\r\nthread 'main' panicked at '\r\ncommand did not execute successfully, got: exit code: 1\r\n\r\nbuild script failed, must exit now', /home/lzutao/.cargo/registry/src/github.com-1ecc6299db9ec823/cmake-0.1.38/src/lib.rs:813:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\n        finished in 0.100\r\nfailed to run: /home/lzutao/forked/rust/compiler-rust/build/bootstrap/debug/bootstrap test src/test/ui --pass check\r\nBuild completed unsuccessfully in 0:00:02\r\n```\r\n\r\n---\r\n\r\n### Host machine\r\n\r\n```bash\r\n% uname -a\r\nLinux gcc122.bak.milne.osuosl.org 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u2 (2019-05-13) x86_64 GNU/Linux\r\n```\r\n\r\n### Custom `config.toml`\r\n\r\n```diff\r\n--- config.toml.example 2019-08-09 12:13:49.714819942 +0000\r\n+++ config.toml 2019-08-09 17:26:12.650918099 +0000\r\n@@ -30,7 +30,7 @@\r\n #assertions = false\r\n \r\n # Indicates whether ccache is used when building LLVM\r\n-#ccache = false\r\n+ccache = true\r\n # or alternatively ...\r\n #ccache = \"/path/to/ccache\"\r\n \r\n@@ -46,7 +46,7 @@\r\n # Tell the LLVM build system to use Ninja instead of the platform default for\r\n # the generated build system. This can sometimes be faster than make, for\r\n # example.\r\n-#ninja = false\r\n+ninja = true\r\n \r\n # LLVM targets to build support for.\r\n # Note: this is NOT related to Rust compilation targets. However, as Rust is\r\n@@ -57,12 +57,13 @@\r\n # support. You'll need to write a target specification at least, and most\r\n # likely, teach rustc about the C ABI of the target. Get in touch with the\r\n # Rust team and file an issue if you need assistance in porting!\r\n-#targets = \"AArch64;ARM;Hexagon;MSP430;Mips;NVPTX;PowerPC;RISCV;Sparc;SystemZ;WebAssembly;X86\"\r\n+targets = \"AArch64;ARM;X86\"\r\n \r\n # LLVM experimental targets to build support for. These targets are specified in\r\n # the same format as above, but since these targets are experimental, they are\r\n # not built by default and the experimental Rust compilation targets that depend\r\n-# on them will not work unless the user opts in to building them.\r\n+# on them will not work unless the user opts in to building them. By default the\r\n+# `WebAssembly` and `RISCV` targets are enabled when compiling LLVM from scratch.\r\n #experimental-targets = \"\"\r\n \r\n # Cap the number of parallel linker invocations when compiling LLVM.\r\n```\r\n", "closed_by": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63623/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63623/timeline", "performed_via_github_app": null, "state_reason": "completed"}