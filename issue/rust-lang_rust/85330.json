{"url": "https://api.github.com/repos/rust-lang/rust/issues/85330", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85330/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85330/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85330/events", "html_url": "https://github.com/rust-lang/rust/issues/85330", "id": 892435809, "node_id": "MDU6SXNzdWU4OTI0MzU4MDk=", "number": 85330, "title": "Failing to build dependency (criterion) in Rust 1.52.1 when it works on 1.52.0", "user": {"login": "Nateckert", "id": 9706794, "node_id": "MDQ6VXNlcjk3MDY3OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/9706794?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nateckert", "html_url": "https://github.com/Nateckert", "followers_url": "https://api.github.com/users/Nateckert/followers", "following_url": "https://api.github.com/users/Nateckert/following{/other_user}", "gists_url": "https://api.github.com/users/Nateckert/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nateckert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nateckert/subscriptions", "organizations_url": "https://api.github.com/users/Nateckert/orgs", "repos_url": "https://api.github.com/users/Nateckert/repos", "events_url": "https://api.github.com/users/Nateckert/events{/privacy}", "received_events_url": "https://api.github.com/users/Nateckert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-05-15T12:42:54Z", "updated_at": "2021-06-02T09:23:57Z", "closed_at": "2021-06-02T09:23:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nAs I was working on my crate https://github.com/Nateckert/newton_rootfinder/tree/bug_criterion, I wasn't able to run `cargo test` in version 1.52.1 of Rust.\r\n\r\nThis issue is reproducible on commit `5b3ffab748584efc327294842f58fceb97dead1c` on branch `bug_criterion`\r\n\r\nIt seems to be platform dependant\r\n\r\n### Code\r\n \r\nI tried this code:\r\n\r\n```bash\r\nrustup default 1.52.0\r\ncargo test\r\n```\r\n\r\nThe previous code runs fine\r\n\r\n```bash\r\nrustup default 1.52.1\r\ncargo test\r\n```\r\n\r\nI expected to see the tests to run smoothly, however, I got:\r\n\r\n```\r\nCompiling newton_rootfinder v0.6.0 (/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder)\r\n   Compiling criterion v0.3.4\r\ndyld: lazy symbol binding failed: Symbol not found: __ZN4core3ptr5write17he134e1ef58ed9196E\r\n  Referenced from: /Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde_derive-59fc6572c32d11d8.dylib\r\n  Expected in: flat namespace\r\n\r\ndyld: Symbol not found: __ZN4core3ptr5write17he134e1ef58ed9196E\r\n  Referenced from: /Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde_derive-59fc6572c32d11d8.dylib\r\n  Expected in: flat namespace\r\n\r\nerror: could not compile `criterion`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name criterion --edition=2018 /Users/nathaneckert/.cargo/registry/src/github.com-1ecc6299db9ec823/criterion-0.3.4/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 --cfg 'feature=\"cargo_bench_support\"' --cfg 'feature=\"default\"' -C metadata=bf7612fd7d202f66 -C extra-filename=-bf7612fd7d202f66 --out-dir /Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps -L dependency=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps --extern atty=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libatty-8778e74db0e26e75.rmeta --extern cast=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libcast-97cec559d460f34a.rmeta --extern clap=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libclap-ff9cb72b97fca80d.rmeta --extern criterion_plot=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libcriterion_plot-877d62c5a199b748.rmeta --extern csv=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libcsv-3d49e045cc2a2771.rmeta --extern itertools=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libitertools-4a8bbcd802399ef8.rmeta --extern lazy_static=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/liblazy_static-636833fdad2098d0.rmeta --extern num_traits=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libnum_traits-96b13ddb5e8eb4b9.rmeta --extern oorandom=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/liboorandom-47a36f1104e83ba5.rmeta --extern plotters=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libplotters-677343b9e18988c5.rmeta --extern rayon=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/librayon-f2840e842c2bd86f.rmeta --extern regex=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libregex-7e1bc1bd52c2c5c2.rmeta --extern serde=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde-89ac4ad46923bafd.rmeta --extern serde_cbor=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde_cbor-2d829d9822cd06f8.rmeta --extern serde_derive=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde_derive-59fc6572c32d11d8.dylib --extern serde_json=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libserde_json-f7ac127dbc6f49cd.rmeta --extern tinytemplate=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libtinytemplate-9739375ae0e10512.rmeta --extern walkdir=/Users/nathaneckert/Desktop/Informatique/Code/Rust/newton_rootfinder/target/debug/deps/libwalkdir-13934b6c78fa5700.rmeta --cap-lints allow -C link-arg=-undefined -C link-arg=dynamic_lookup` (signal: 6, SIGABRT: process abort signal)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\n```\r\n\r\n### Version it worked on\r\n\r\nIt most recently worked on: Rust 1.52.0\r\nIt also works on `rustc 1.54.0-nightly (5c0292654 2021-05-11)`\r\n\r\n### Version with regression\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.52.1 (9bc8c42bb 2021-05-09)\r\nbinary: rustc\r\ncommit-hash: 9bc8c42bb2f19e745a63f3445f1ac248fb015e53\r\ncommit-date: 2021-05-09\r\nhost: x86_64-apple-darwin\r\nrelease: 1.52.1\r\nLLVM version: 12.0.0\r\n```\r\n\r\n### Additional infos\r\n\r\nThe tests run without problem on Travis-CI (https://www.travis-ci.com/github/Nateckert/newton_rootfinder/jobs/505652512), on which I test only Linux, while my machine is a MacBook Pro from 2012, running macOS Catalina 10.15.7\r\n\r\nRunning the command `cargo build` works fine. However, the crate `criterion` is only a dev dependency.\r\n\r\nI also tested `rustc 1.54.0-nightly (5c0292654 2021-05-11)` and the bug does not occur there. I get the expected output.\r\n\r\nBest regards and thanks a lot for all the work !\r\n", "closed_by": {"login": "apiraino", "id": 6098822, "node_id": "MDQ6VXNlcjYwOTg4MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/6098822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apiraino", "html_url": "https://github.com/apiraino", "followers_url": "https://api.github.com/users/apiraino/followers", "following_url": "https://api.github.com/users/apiraino/following{/other_user}", "gists_url": "https://api.github.com/users/apiraino/gists{/gist_id}", "starred_url": "https://api.github.com/users/apiraino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apiraino/subscriptions", "organizations_url": "https://api.github.com/users/apiraino/orgs", "repos_url": "https://api.github.com/users/apiraino/repos", "events_url": "https://api.github.com/users/apiraino/events{/privacy}", "received_events_url": "https://api.github.com/users/apiraino/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85330/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85330/timeline", "performed_via_github_app": null, "state_reason": "completed"}