{"url": "https://api.github.com/repos/rust-lang/rust/issues/39177", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39177/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39177/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39177/events", "html_url": "https://github.com/rust-lang/rust/issues/39177", "id": 201821458, "node_id": "MDU6SXNzdWUyMDE4MjE0NTg=", "number": 39177, "title": "Found a runtime compiler bug", "user": {"login": "J-F-Liu", "id": 1472963, "node_id": "MDQ6VXNlcjE0NzI5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/1472963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/J-F-Liu", "html_url": "https://github.com/J-F-Liu", "followers_url": "https://api.github.com/users/J-F-Liu/followers", "following_url": "https://api.github.com/users/J-F-Liu/following{/other_user}", "gists_url": "https://api.github.com/users/J-F-Liu/gists{/gist_id}", "starred_url": "https://api.github.com/users/J-F-Liu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/J-F-Liu/subscriptions", "organizations_url": "https://api.github.com/users/J-F-Liu/orgs", "repos_url": "https://api.github.com/users/J-F-Liu/repos", "events_url": "https://api.github.com/users/J-F-Liu/events{/privacy}", "received_events_url": "https://api.github.com/users/J-F-Liu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-01-19T10:35:22Z", "updated_at": "2017-01-19T16:36:04Z", "closed_at": "2017-01-19T16:36:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am the author of [pom](https://github.com/J-F-Liu/pom), now I use pom to implement a PDF parser and get some surprising result:\r\n```\r\ngit clone https://github.com/J-F-Liu/lopdf.git\r\ncd lopdf/pdfutil\r\ncargo build\r\ncargo run -- decompress -i /home/junfeng/Downloads/OpenGEX.1.1.2.pdf\r\n``` \r\nThe output is:\r\n```\r\n\u25b6 cargo run -- decompress -i /home/junfeng/Downloads/OpenGEX.1.1.2.pdf\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs\r\n     Running `target/debug/pdfutil decompress -i /home/junfeng/Downloads/OpenGEX.1.1.2.pdf`\r\nOpen /home/junfeng/Downloads/OpenGEX.1.1.2.pdf\r\nxref has 75 entires\r\n...\r\nxref has 75 entires\r\nxref has 139815792274816 entires\r\nxref has 75 entires\r\nxref has 75 entires\r\nxref has 139815791991872 entires\r\nxref has 75 entires\r\nxref has 75 entires\r\nxref has 139815792057408 entires\r\nxref has 75 entires\r\nxref has 75 entires\r\nxref has 139815792057408 entires\r\nxref has 75 entires\r\nxref has 139815792057696 entires\r\n...\r\nxref has 139815792057696 entires\r\nxref has 75 entires\r\nDo decompress\r\n```\r\nxref is the same BTreeMap variable captured in nested closures printing its len().\r\nNotice these big random numbers, probably caused by wrong pointers.\r\n\r\nTry another PDF file:\r\n```\r\n\u25b6 cargo run -- decompress -i /home/junfeng/Downloads/rfc7159.pdf           \r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs\r\n     Running `target/debug/pdfutil decompress -i /home/junfeng/Downloads/rfc7159.pdf`\r\nOpen /home/junfeng/Downloads/rfc7159.pdf\r\nxref has 234 entires\r\nxref has 234 entires\r\nxref has 234 entires\r\nxref has 234 entires\r\nxref has 234 entires\r\nxref has 139647596457568 entires\r\n```\r\nThis time the parser actually accesses entry in xref, the program failed and exited without printing any panic message!\r\n\r\nThe download links of these example PDF files are:\r\n- [OpenGEX.1.1.2.pdf](http://opengex.org/OpenGEX.1.1.2.pdf)\r\n- [rfc7159.pdf](https://tools.ietf.org/pdf/rfc7159.pdf)\r\n\r\nYou can play with the code, add more debug infos, please find out the root cause.", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39177/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39177/timeline", "performed_via_github_app": null, "state_reason": "completed"}