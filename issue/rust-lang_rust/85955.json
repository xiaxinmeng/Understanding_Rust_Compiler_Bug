{"url": "https://api.github.com/repos/rust-lang/rust/issues/85955", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85955/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85955/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85955/events", "html_url": "https://github.com/rust-lang/rust/issues/85955", "id": 910221264, "node_id": "MDU6SXNzdWU5MTAyMjEyNjQ=", "number": 85955, "title": "ICE: \"cannot lex `source_file` without source\" with integration test", "user": {"login": "XAMPPRocky", "id": 4464295, "node_id": "MDQ6VXNlcjQ0NjQyOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/4464295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/XAMPPRocky", "html_url": "https://github.com/XAMPPRocky", "followers_url": "https://api.github.com/users/XAMPPRocky/followers", "following_url": "https://api.github.com/users/XAMPPRocky/following{/other_user}", "gists_url": "https://api.github.com/users/XAMPPRocky/gists{/gist_id}", "starred_url": "https://api.github.com/users/XAMPPRocky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/XAMPPRocky/subscriptions", "organizations_url": "https://api.github.com/users/XAMPPRocky/orgs", "repos_url": "https://api.github.com/users/XAMPPRocky/repos", "events_url": "https://api.github.com/users/XAMPPRocky/events{/privacy}", "received_events_url": "https://api.github.com/users/XAMPPRocky/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/82", "html_url": "https://github.com/rust-lang/rust/milestone/82", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/82/labels", "id": 6717076, "node_id": "MDk6TWlsZXN0b25lNjcxNzA3Ng==", "number": 82, "title": "1.54.0", "description": null, "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 652, "state": "closed", "created_at": "2021-05-01T02:53:57Z", "updated_at": "2022-02-03T12:07:26Z", "due_on": null, "closed_at": "2021-08-17T19:06:49Z"}, "comments": 8, "created_at": "2021-06-03T07:52:32Z", "updated_at": "2021-06-22T17:34:56Z", "closed_at": "2021-06-22T17:34:55Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "If you attempt to `include!` a file in both the library and an external integration test that links to the library (this is important because if there is no `extern crate` or `use` statements, the ICE does not happen), it causes an ICE in the latest nightly. This ICE is not present in stable or beta.\r\n\r\n<details>\r\n<summary>build.rs</summary>\r\n\r\n```rust\r\nfn main() {\r\n    std::fs::write(\r\n        &std::path::Path::new(&std::env::var_os(\"OUT_DIR\").unwrap()).join(\"crash.rs\"),\r\n        \"pub struct A;\",\r\n    )\r\n    .unwrap();\r\n}\r\n```\r\n</details>\r\n\r\n<details>\r\n<summary>src/lib.rs</summary>\r\n\r\n```rust\r\ninclude!(concat!(env!(\"OUT_DIR\"), \"/\", \"crash.rs\"));\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>tests/crash.rs</summary>\r\n\r\n```rust\r\nextern crate abc; // abc must be replaced by the name of the crate to test (e.g. the name in the Cargo.toml file)\r\n\r\ninclude!(concat!(env!(\"OUT_DIR\"), \"/\", \"crash.rs\"));\r\n```\r\n</details>\r\n\r\n### Command\r\n\r\n```\r\ncargo test\r\n```\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.54.0-nightly (625d5a693 2021-06-01)\r\nbinary: rustc\r\ncommit-hash: 625d5a693e4697bcafdd34fd1a38c281acabb8e9\r\ncommit-date: 2021-06-01\r\nhost: x86_64-apple-darwin\r\nrelease: 1.54.0-nightly\r\nLLVM version: 12.0.1\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: cannot lex `source_file` without source: /Users/src/ice-test/target/debug/build/ice-test-dcdce532143b8bc1/out/xds.core.v3.rs\r\n\r\nthread 'rustc' panicked at 'Box<Any>', compiler/rustc_errors/src/lib.rs:1005:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.54.0-nightly (625d5a693 2021-06-01) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C split-debuginfo=unpacked -C debuginfo=2 -C incremental\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nstack backtrace:\r\n   0:        0x1170d13b4 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hc0a32d3c3444fdc6\r\n   1:        0x117135b5c - core::fmt::write::h120e3853e954a389\r\n   2:        0x1170c33ea - std::io::Write::write_fmt::hfa38fa23f7fce513\r\n   3:        0x1170d506f - std::panicking::default_hook::{{closure}}::h5d5d1571ac2df726\r\n   4:        0x1170d4b6d - std::panicking::default_hook::h4f38c2182113a3d6\r\n   5:        0x10f8b72b8 - rustc_driver::report_ice::h315ec60d4f33b035\r\n   6:        0x1170d58a6 - std::panicking::rust_panic_with_hook::h111fa41f5cc5bae1\r\n   7:        0x1139d22b1 - std::panicking::begin_panic::{{closure}}::hb5d77af7cdcca810\r\n   8:        0x1139d2229 - std::sys_common::backtrace::__rust_end_short_backtrace::h4cf6426c0e11596d\r\n   9:        0x113c91811 - std::panicking::begin_panic::hf129750fee14a661\r\n  10:        0x1139f1080 - std::panic::panic_any::h35ee1f3d736053e5\r\n  11:        0x1139f76ac - rustc_errors::HandlerInner::bug::hffe2549ce25674c9\r\n  12:        0x1139f5457 - rustc_errors::Handler::bug::h5d19ee9d6012acf4\r\n  13:        0x11335dc2a - rustc_parse::maybe_file_to_stream::{{closure}}::h2b76850df2689f69\r\n  14:        0x11335db4f - rustc_parse::maybe_file_to_stream::h6a5b54720a5326c4\r\n  15:        0x11335d5e3 - rustc_parse::maybe_source_file_to_parser::hb2889c8806f22353\r\n  16:        0x11335d244 - rustc_parse::new_parser_from_file::h880749fe6c165a55\r\n  17:        0x111edea8e - rustc_builtin_macros::source_util::expand_include::hec829b007a51890d\r\n  18:        0x1131665fa - rustc_expand::expand::MacroExpander::fully_expand_fragment::hc9471323bbd298aa\r\n  19:        0x113165489 - rustc_expand::expand::MacroExpander::expand_crate::ha260ef6cedc5f864\r\n  20:        0x10f9c91c0 - rustc_interface::passes::configure_and_expand_inner::h995c2829b63caf5c\r\n  21:        0x10f9bf430 - rustc_interface::passes::configure_and_expand::{{closure}}::hc06a0520c8089ddc\r\n  22:        0x10f9b2fdb - rustc_data_structures::box_region::PinnedGenerator<I,A,R>::new::h7057a1aefc5c0c79\r\n  23:        0x10f9c7ef5 - rustc_interface::passes::configure_and_expand::h5530d33ac5f81757\r\n  24:        0x10f9e680d - rustc_interface::queries::Queries::expansion::hde0b694af7141ffa\r\n  25:        0x10f8d5e89 - rustc_span::with_session_globals::h8ceb270caa69a3cc\r\n  26:        0x10f913b3f - std::sys_common::backtrace::__rust_begin_short_backtrace::h044fc2ce181347b9\r\n  27:        0x10f8c6ebd - core::ops::function::FnOnce::call_once{{vtable.shim}}::h95785b84dcf6930e\r\n  28:        0x1170e0b6b - std::sys::unix::thread::Thread::new::thread_start::hd7d90a4d6d405897\r\n  29:     0x7fff2073f954 - __pthread_start\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85955/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85955/timeline", "performed_via_github_app": null, "state_reason": "completed"}