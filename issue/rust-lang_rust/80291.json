{"url": "https://api.github.com/repos/rust-lang/rust/issues/80291", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80291/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80291/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80291/events", "html_url": "https://github.com/rust-lang/rust/issues/80291", "id": 772905499, "node_id": "MDU6SXNzdWU3NzI5MDU0OTk=", "number": 80291, "title": "ICE with \"Encountered error `OutputTypeParameterMismatch\" on stable rust", "user": {"login": "nbliznashki", "id": 39500154, "node_id": "MDQ6VXNlcjM5NTAwMTU0", "avatar_url": "https://avatars.githubusercontent.com/u/39500154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nbliznashki", "html_url": "https://github.com/nbliznashki", "followers_url": "https://api.github.com/users/nbliznashki/followers", "following_url": "https://api.github.com/users/nbliznashki/following{/other_user}", "gists_url": "https://api.github.com/users/nbliznashki/gists{/gist_id}", "starred_url": "https://api.github.com/users/nbliznashki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nbliznashki/subscriptions", "organizations_url": "https://api.github.com/users/nbliznashki/orgs", "repos_url": "https://api.github.com/users/nbliznashki/repos", "events_url": "https://api.github.com/users/nbliznashki/events{/privacy}", "received_events_url": "https://api.github.com/users/nbliznashki/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 149689562, "node_id": "MDU6TGFiZWwxNDk2ODk1NjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-associated-items", "name": "A-associated-items", "color": "f7e101", "default": false, "description": "Area: Associated items such as associated types and consts."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-12-22T12:20:54Z", "updated_at": "2021-08-26T12:19:25Z", "closed_at": "2021-08-26T12:19:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have encountered an ICE in stable rust, please see the code and error below.  The issue seems to be present also on nightly and also older rust compiler versions like 1.45. \r\n\r\n\r\n### Code\r\n\r\n```Rust\r\ntrait ColumnOutput<'a, T> {\r\n    type Output: Sized;\r\n}\r\n\r\nstruct C;\r\n\r\nimpl<'a, T> ColumnOutput<'a, T> for C {\r\n    type Output = T;\r\n}\r\n\r\nfn calc<'a, T1: Default, T2, O1, O2, F1>(f: F1)\r\nwhere\r\n    O1: ColumnOutput<'a, T1>,\r\n    O2: ColumnOutput<'a, T2>,\r\n    F1: Fn(&<O2 as ColumnOutput<T2>>::Output) -> T1,\r\n{\r\n    let c2_data: Vec<<O2 as ColumnOutput<T2>>::Output> = Vec::new();\r\n    let mut dummy: Vec<T1> = Vec::new();\r\n    dummy.extend(c2_data.iter().map(|c2_value| f(c2_value)));\r\n}\r\n\r\npub fn run_calc() {\r\n    calc::<u64, u64, C, C, _>(|c2_data| *c2_data)\r\n}\r\n\r\nfn main() {\r\n    run_calc();\r\n}\r\n```\r\n\r\n\r\n### Meta\r\nThe ICE happens also on nightly\r\n\r\n`rustc --version --verbose`:\r\n```\r\n<version>\r\nrustc 1.48.0 (7eac88abb 2020-11-16)\r\nbinary: rustc\r\ncommit-hash: 7eac88abb2e57e752f3302f02be5f3ce3d7adfb4\r\ncommit-date: 2020-11-16\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.48.0\r\nLLVM version: 11.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n<output>\r\n\r\nerror: internal compiler error: compiler\\rustc_trait_selection\\src\\traits\\codegen\\mod.rs:75:17: Encountered error `OutputTypeParameterMismatch(Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&<operations::generic_functions_3::C as operations::generic_functions_3::ColumnOutput<'_, u64>>::Output,)>>), Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&u64,)>>), Sorts(ExpectedFound { expected: u64, found: \r\n<operations::generic_functions_3::C as operations::generic_functions_3::ColumnOutput<'_, u64>>::Output }))` selecting `Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&u64,)>>)` during codegen\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nerror: internal compiler error: compiler\\rustc_trait_selection\\src\\traits\\codegen\\mod.rs:75:17: Encountered error `OutputTypeParameterMismatch(Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&<operations::generic_functions_3::C as operations::generic_functions_3::ColumnOutput<'_, u64>>::Output,)>>), Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&u64,)>>), Sorts(ExpectedFound { expected: u64, found: \r\n<operations::generic_functions_3::C as operations::generic_functions_3::ColumnOutput<'_, u64>>::Output }))` selecting `Binder(<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&u64,)>>)` during codegen\r\n\r\nthread 'rustc' panicked at 'Box<Any>', compiler\\rustc_errors\\src\\lib.rs:945:9\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.48.0 (7eac88abb 2020-11-16) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [codegen_fulfill_obligation] checking if `std::ops::Fn` fulfills its obligations\r\n#1 [resolve_instance] resolving instance `<[closure@src\\operations\\generic_functions_3.rs:23:31: 23:49] as std::ops::Fn<(&u64,)>>::call`\r\n#2 [collect_and_partition_mono_items] collect_and_partition_mono_items\r\n#3 [exported_symbols] exported_symbols\r\nend of query stack\r\n<backtrace>\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80291/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80291/timeline", "performed_via_github_app": null, "state_reason": "completed"}