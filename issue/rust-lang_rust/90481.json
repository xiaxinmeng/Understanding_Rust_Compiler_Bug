{"url": "https://api.github.com/repos/rust-lang/rust/issues/90481", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90481/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90481/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90481/events", "html_url": "https://github.com/rust-lang/rust/issues/90481", "id": 1041463471, "node_id": "I_kwDOAAsO6M4-E3iv", "number": 90481, "title": "Local bootstrap fails until I manually invoke `git submodule update --init`", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 583436937, "node_id": "MDU6TGFiZWw1ODM0MzY5Mzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-author", "name": "S-waiting-on-author", "color": "d3dddd", "default": false, "description": "Status: This is awaiting some action (such as code changes or more information) from the author."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-11-01T18:24:59Z", "updated_at": "2021-11-27T03:45:36Z", "closed_at": "2021-11-27T03:45:36Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I have found recently for some of my checkouts that I have to manually do `git submodule update --init` to work around an LLVM build failure.\r\n\r\nI was under the impression that our build system was supposed to always take care of maintaining the git submodules, at least if you weren't doing things like trying to make your own local changes to those submodules. (I have no idea what our guarantees are, if any, in the latter scenario.)\r\n\r\nBut from what I can tell, the error in the transcript below, which I have now seen twice, is resolved by a manual invocation of `git submodule update --init`.\r\n\r\nI don't expect other people to be able to do much about this until I manage to reproduce what is causing it. Luckily, *this* time I had the foresight to make a tarball of my git repo state when I encountered the problem this second time around.\r\n\r\n<details>\r\n<Summary> Transcript of the failing build. </Summary>\r\n\r\n```text\r\n % /usr/bin/time -lp ../x.py build\r\nUpdating only changed submodules\r\nSubmodules updated in 0.04 seconds\r\nextracting /Users/pnkfelix/Dev/Rust/rust.git/objdir/build/cache/2021-10-22/rust-std-beta-x86_64-apple-darwin.tar.xz\r\nextracting /Users/pnkfelix/Dev/Rust/rust.git/objdir/build/cache/2021-10-22/rustc-beta-x86_64-apple-darwin.tar.xz\r\nextracting /Users/pnkfelix/Dev/Rust/rust.git/objdir/build/cache/2021-10-22/cargo-beta-x86_64-apple-darwin.tar.xz\r\nextracting /Users/pnkfelix/Dev/Rust/rust.git/objdir/build/cache/2021-10-23/rustfmt-nightly-x86_64-apple-darwin.tar.xz\r\n   Compiling proc-macro2 v1.0.30\r\n   Compiling unicode-xid v0.2.2\r\n   Compiling syn v1.0.80\r\n   Compiling autocfg v1.0.0\r\n   Compiling version_check v0.9.3\r\n   Compiling memchr v2.4.1\r\n   Compiling cfg-if v1.0.0\r\n   Compiling libc v0.2.103\r\n   Compiling serde_derive v1.0.125\r\n   Compiling lazy_static v1.4.0\r\n   Compiling log v0.4.14\r\n   Compiling serde v1.0.125\r\n   Compiling ryu v1.0.5\r\n   Compiling regex-syntax v0.6.25\r\n   Compiling regex-automata v0.1.10\r\n   Compiling same-file v1.0.6\r\n   Compiling serde_json v1.0.59\r\n   Compiling fnv v1.0.7\r\n   Compiling cc v1.0.69\r\n   Compiling unicode-width v0.1.8\r\n   Compiling bootstrap v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/src/bootstrap)\r\n   Compiling itoa v0.4.6\r\n   Compiling once_cell v1.7.2\r\n   Compiling opener v0.5.0\r\n   Compiling build_helper v0.1.0 (/Users/pnkfelix/Dev/Rust/rust.git/src/build_helper)\r\n   Compiling thread_local v1.0.1\r\n   Compiling proc-macro-error-attr v1.0.4\r\n   Compiling proc-macro-error v1.0.4\r\n   Compiling num-traits v0.2.12\r\n   Compiling crossbeam-utils v0.8.3\r\n   Compiling getopts v0.2.21\r\n   Compiling walkdir v2.3.1\r\n   Compiling cmake v0.1.44\r\n   Compiling filetime v0.2.14\r\n   Compiling num_cpus v1.13.0\r\n   Compiling time v0.1.43\r\n   Compiling quote v1.0.7\r\n   Compiling aho-corasick v0.7.18\r\n   Compiling bstr v0.2.13\r\n   Compiling regex v1.5.4\r\n   Compiling globset v0.4.5\r\n   Compiling ignore v0.4.17\r\n   Compiling merge_derive v0.1.0\r\n   Compiling merge v0.1.0\r\n   Compiling toml v0.5.7\r\n    Finished dev [unoptimized] target(s) in 41.86s\r\nBuilding stage0 std artifacts (x86_64-apple-darwin -> x86_64-apple-darwin)\r\n   Compiling cc v1.0.69\r\n   Compiling core v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/core)\r\n   Compiling libc v0.2.103\r\n   Compiling memchr v2.4.1\r\n   Compiling std v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/std)\r\n   Compiling compiler_builtins v0.1.49\r\n   Compiling unwind v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/unwind)\r\n   Compiling rustc-std-workspace-core v1.99.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/rustc-std-workspace-core)\r\n   Compiling alloc v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/alloc)\r\n   Compiling cfg-if v0.1.10\r\n   Compiling adler v0.2.3\r\n   Compiling rustc-demangle v0.1.21\r\n   Compiling rustc-std-workspace-alloc v1.99.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/rustc-std-workspace-alloc)\r\n   Compiling panic_abort v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/panic_abort)\r\n   Compiling panic_unwind v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/panic_unwind)\r\n   Compiling gimli v0.25.0\r\n   Compiling std_detect v0.1.5 (/Users/pnkfelix/Dev/Rust/rust.git/library/stdarch/crates/std_detect)\r\n   Compiling object v0.26.2\r\n   Compiling miniz_oxide v0.4.0\r\n   Compiling hashbrown v0.11.0\r\n   Compiling addr2line v0.16.0\r\n   Compiling rustc-std-workspace-std v1.99.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/rustc-std-workspace-std)\r\n   Compiling proc_macro v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/proc_macro)\r\n   Compiling unicode-width v0.1.8\r\n   Compiling getopts v0.2.21\r\n   Compiling test v0.0.0 (/Users/pnkfelix/Dev/Rust/rust.git/library/test)\r\n    Finished release [optimized] target(s) in 42.02s\r\nCopying stage0 std from stage0 (x86_64-apple-darwin -> x86_64-apple-darwin / x86_64-apple-darwin)\r\nBuilding LLVM for x86_64-apple-darwin\r\nrunning: \"cmake\" \"/Users/pnkfelix/Dev/Rust/rust.git/src/llvm-project/llvm\" \"-G\" \"Ninja\" \"-DLLVM_ENABLE_ASSERTIONS=OFF\" \"-DLLVM_ENABLE_PLUGINS=OFF\" \"-DLLVM_TARGETS_TO_BUILD=AArch64;ARM;BPF;Hexagon;MSP430;Mips;NVPTX;PowerPC;RISCV;Sparc;SystemZ;WebAssembly;X86\" \"-DLLVM_EXPERIMENTAL_TARGETS_TO_BUILD=AVR;M68k\" \"-DLLVM_INCLUDE_EXAMPLES=OFF\" \"-DLLVM_INCLUDE_DOCS=OFF\" \"-DLLVM_INCLUDE_BENCHMARKS=OFF\" \"-DLLVM_INCLUDE_TESTS=OFF\" \"-DLLVM_ENABLE_TERMINFO=OFF\" \"-DLLVM_ENABLE_LIBEDIT=OFF\" \"-DLLVM_ENABLE_BINDINGS=OFF\" \"-DLLVM_ENABLE_Z3_SOLVER=OFF\" \"-DLLVM_PARALLEL_COMPILE_JOBS=12\" \"-DLLVM_TARGET_ARCH=x86_64\" \"-DLLVM_DEFAULT_TARGET_TRIPLE=x86_64-apple-darwin\" \"-DLLVM_INSTALL_UTILS=ON\" \"-DLLVM_ENABLE_ZLIB=ON\" \"-DLLVM_ENABLE_LIBXML2=OFF\" \"-DLLVM_VERSION_SUFFIX=-rust-dev\" \"-DCMAKE_INSTALL_MESSAGE=LAZY\" \"-DCMAKE_C_COMPILER=cc\" \"-DCMAKE_CXX_COMPILER=c++\" \"-DCMAKE_ASM_COMPILER=cc\" \"-DCMAKE_C_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64 -arch x86_64 -stdlib=libc++\" \"-DCMAKE_CXX_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64 -arch x86_64 -stdlib=libc++\" \"-DCMAKE_INSTALL_PREFIX=/Users/pnkfelix/Dev/Rust/rust.git/objdir/build/x86_64-apple-darwin/llvm\" \"-DCMAKE_ASM_FLAGS= -ffunction-sections -fdata-sections -fPIC -m64 -arch x86_64\" \"-DCMAKE_BUILD_TYPE=Release\"\r\n-- Found libtool - /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/libtool\r\n-- Native target architecture is X86\r\n-- Threads enabled.\r\n-- Doxygen disabled.\r\n-- Go bindings disabled.\r\n-- Ninja version: 1.10.2\r\n-- Found ld64 - /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld\r\n-- Could NOT find OCaml (missing: OCAMLFIND OCAML_VERSION OCAML_STDLIB_PATH) \r\n-- OCaml bindings disabled.\r\n-- LLVM host triple: x86_64-apple-darwin19.6.0\r\n-- LLVM default target triple: x86_64-apple-darwin\r\n-- Building with -fPIC\r\n-- LLVMHello ignored -- Loadable modules not supported on this platform.\r\n-- Targeting AArch64\r\n-- Targeting ARM\r\n-- Targeting BPF\r\n-- Targeting Hexagon\r\n-- Targeting MSP430\r\n-- Targeting Mips\r\n-- Targeting NVPTX\r\n-- Targeting PowerPC\r\n-- Targeting RISCV\r\n-- Targeting Sparc\r\n-- Targeting SystemZ\r\n-- Targeting WebAssembly\r\n-- Targeting X86\r\n-- Targeting AVR\r\n-- Targeting M68k\r\nCMake Error at lib/Target/CMakeLists.txt:32 (add_subdirectory):\r\n  add_subdirectory given source \"M68k\" which is not an existing directory.\r\n\r\n\r\nCMake Error at cmake/modules/LLVM-Build.cmake:42 (get_property):\r\n  get_property could not find TARGET M68k.  Perhaps it has not yet been\r\n  created.\r\nCall Stack (most recent call first):\r\n  lib/CMakeLists.txt:61 (LLVMBuildGenerateCFragment)\r\n\r\n\r\nCMake Error at cmake/modules/LLVM-Build.cmake:43 (get_property):\r\n  get_property could not find TARGET M68k.  Perhaps it has not yet been\r\n  created.\r\nCall Stack (most recent call first):\r\n  lib/CMakeLists.txt:61 (LLVMBuildGenerateCFragment)\r\n\r\n\r\n-- BugpointPasses ignored -- Loadable modules not supported on this platform.\r\nCMake Error at cmake/modules/LLVM-Config.cmake:138 (message):\r\n  Target M68k is not in the set of libraries.\r\nCall Stack (most recent call first):\r\n  cmake/modules/LLVM-Config.cmake:256 (llvm_expand_pseudo_components)\r\n  cmake/modules/LLVM-Config.cmake:102 (llvm_map_components_to_libnames)\r\n  cmake/modules/LLVM-Config.cmake:95 (explicit_llvm_config)\r\n  cmake/modules/AddLLVM.cmake:908 (llvm_config)\r\n  cmake/modules/AddLLVM.cmake:1209 (add_llvm_executable)\r\n  tools/llvm-gsymutil/CMakeLists.txt:11 (add_llvm_tool)\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/Users/pnkfelix/Dev/Rust/rust.git/objdir/build/x86_64-apple-darwin/llvm/build/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/Users/pnkfelix/Dev/Rust/rust.git/objdir/build/x86_64-apple-darwin/llvm/build/CMakeFiles/CMakeError.log\".\r\nthread 'main' panicked at '\r\ncommand did not execute successfully, got: exit status: 1\r\n\r\nbuild script failed, must exit now', /Users/pnkfelix/.cargo/registry/src/github.com-1ecc6299db9ec823/cmake-0.1.44/src/lib.rs:885:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\tfinished in 5.004 seconds\r\nBuild completed unsuccessfully in 0:01:42\r\n\r\n</details>\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90481/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90481/timeline", "performed_via_github_app": null, "state_reason": "completed"}