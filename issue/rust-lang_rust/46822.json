{"url": "https://api.github.com/repos/rust-lang/rust/issues/46822", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46822/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46822/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46822/events", "html_url": "https://github.com/rust-lang/rust/issues/46822", "id": 282993810, "node_id": "MDU6SXNzdWUyODI5OTM4MTA=", "number": 46822, "title": "armv5te hello world fails to run on qemu and pi3", "user": {"login": "malbarbo", "id": 1678126, "node_id": "MDQ6VXNlcjE2NzgxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1678126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/malbarbo", "html_url": "https://github.com/malbarbo", "followers_url": "https://api.github.com/users/malbarbo/followers", "following_url": "https://api.github.com/users/malbarbo/following{/other_user}", "gists_url": "https://api.github.com/users/malbarbo/gists{/gist_id}", "starred_url": "https://api.github.com/users/malbarbo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/malbarbo/subscriptions", "organizations_url": "https://api.github.com/users/malbarbo/orgs", "repos_url": "https://api.github.com/users/malbarbo/repos", "events_url": "https://api.github.com/users/malbarbo/events{/privacy}", "received_events_url": "https://api.github.com/users/malbarbo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2017-12-18T19:28:59Z", "updated_at": "2017-12-23T07:50:07Z", "closed_at": "2017-12-22T01:48:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Running (in qemu and in raspberry pi 3) a hello world binary compiled with xargo and rust nightly-2017-11-16 works as expected. Using rustc nightly-2017-11-17 it segfaults.\r\n\r\nHere is a docker file that can be used to reproduce the problem:\r\n\r\n```Dockerfile\r\nFROM ubuntu:17.10\r\n\r\nRUN apt-get update\r\nRUN apt-get install \\\r\n    qemu-user \\\r\n    curl ca-certificates \\\r\n    make file \\\r\n    gcc libc6-dev \\\r\n    gcc-arm-linux-gnueabi libc6-dev-armel-cross \\\r\n    -y --no-install-recommends\r\n# change to 2017-11-17 to fail\r\nRUN curl https://sh.rustup.rs -sSf | sh -s -- -y --default-toolchain nightly-2017-11-16 \r\nENV PATH=$PATH:/root/.cargo/bin/\r\nRUN rustup component add rust-src\r\nRUN cargo install xargo\r\n\r\nENV USER=root\r\nRUN cargo new hello --bin\r\n\r\nRUN mkdir hello/.cargo/\r\nRUN echo \"[target.armv5te-unknown-linux-gnueabi]\\nlinker = \\\"arm-linux-gnueabi-gcc\\\"\" > hello/.cargo/config\r\n\r\nRUN echo \"[target.armv5te-unknown-linux-gnueabi.dependencies.std]\\nfeatures = [\\\"force_alloc_system\\\"] \" > hello/Xargo.toml\r\n\r\nRUN echo \"\\n[profile.release]\\npanic = \\\"abort\\\"\" >> hello/Cargo.toml\r\n\r\nENV CFLAGS_armv5te_unknown_linux_gnueabi=\"-march=armv5te -mfloat-abi=soft\" \\\r\n    CC_armv5te_unknown_linux_gnueabi=arm-linux-gnueabi-gcc\r\n\r\nRUN cd hello && xargo build --release --target armv5te-unknown-linux-gnueabi\r\n\r\nRUN QEMU_STRACE=1 qemu-arm -L /usr/arm-linux-gnueabi hello/target/armv5te-unknown-linux-gnueabi/release/hello\r\n```\r\n\r\n[According to](https://github.com/rust-lang/rust/pull/46498#issuecomment-352456868) @Dushistov, the crash happens in `__sync_val_compare_and_swap_4`, but I get other result.\r\n\r\nEdit: removed the stack trace, it was not helping and it takes to much space.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46822/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46822/timeline", "performed_via_github_app": null, "state_reason": "completed"}