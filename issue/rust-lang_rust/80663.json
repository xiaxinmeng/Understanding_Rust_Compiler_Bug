{"url": "https://api.github.com/repos/rust-lang/rust/issues/80663", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80663/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80663/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80663/events", "html_url": "https://github.com/rust-lang/rust/issues/80663", "id": 777719882, "node_id": "MDU6SXNzdWU3Nzc3MTk4ODI=", "number": 80663, "title": "Default target regression since 1.48", "user": {"login": "rxrbln", "id": 18517006, "node_id": "MDQ6VXNlcjE4NTE3MDA2", "avatar_url": "https://avatars.githubusercontent.com/u/18517006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rxrbln", "html_url": "https://github.com/rxrbln", "followers_url": "https://api.github.com/users/rxrbln/followers", "following_url": "https://api.github.com/users/rxrbln/following{/other_user}", "gists_url": "https://api.github.com/users/rxrbln/gists{/gist_id}", "starred_url": "https://api.github.com/users/rxrbln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rxrbln/subscriptions", "organizations_url": "https://api.github.com/users/rxrbln/orgs", "repos_url": "https://api.github.com/users/rxrbln/repos", "events_url": "https://api.github.com/users/rxrbln/events{/privacy}", "received_events_url": "https://api.github.com/users/rxrbln/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1050784470, "node_id": "MDU6TGFiZWwxMDUwNzg0NDcw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-bisection", "name": "E-needs-bisection", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs bisection: https://github.com/rust-lang/cargo-bisect-rustc"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-01-03T21:29:19Z", "updated_at": "2021-01-05T01:43:04Z", "closed_at": "2021-01-04T17:58:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "When bootstrapping Rustc from source, e.g. for embedded use cross compiling for another architecture, e.g. i586, arm, mips, etc. rustc since 1.48 no longer defaults to the configured target tripplet.\r\n\r\nConfigured with:\r\n./configure --prefix=/usr/src/t2-clean/build/x86-20.12-generic-x86-i586-cross-linux/TOOLCHAIN/tools.cross/usr --libdir=/usr/src/t2-clean/build/x86-20.12-generic-x86-i586-cross-linux/TOOLCHAIN/tools.cross/usr/lib --llvm-config=/usr/src/t2-clean/build/x86-20.12-generic-x86-i586-cross-linux/TOOLCHAIN/tools.cross/usr/bin/llvm-config --release-channel=stable --disable-codegen-tests --target= i586-unknown-linux-gnu --build=x86_64-unknown-linux-gnu --host=x86_64-unknown-linux-gnu\r\n\r\nI expected to yield a compiler defaulting to i586.\r\n\r\nInstead since 1.48 it defaults to the host: # rustc --print cfg\r\ndebug_assertions\r\ntarget_arch=\"x86_64\"\r\ntarget_endian=\"little\"\r\ntarget_env=\"gnu\"\r\ntarget_family=\"unix\"\r\ntarget_feature=\"fxsr\"\r\ntarget_feature=\"sse\"\r\ntarget_feature=\"sse2\"\r\ntarget_os=\"linux\"\r\ntarget_pointer_width=\"64\"\r\ntarget_vendor=\"unknown\"\r\nunix\r\n\r\nThe std is however correctly build for i586 (or arm, mips, ...) and does work when manually requested thru --target or cargo. However, for integration we need the default to work correctly to avoid nightmarish complexity building other large projects, such as Firefox. The end of the build log includes:\r\n\r\ninstall: installing component 'rust-std-i586-unknown-linux-gnu'\r\n\r\n    std is standing at the ready.\r\n\r\nDist rustc stage2 (x86_64-unknown-linux-gnu)\r\n        finished in 15.071\r\nInstall rustc stage2 (Some(TargetSelection { triple: \"x86_64-unknown-linux-gnu\", file: None }))\r\n\r\nIn any case, this used to work for quite a while, and regressed since Rustc 1.48.0 and is still broken in 1.49.0", "closed_by": {"login": "rxrbln", "id": 18517006, "node_id": "MDQ6VXNlcjE4NTE3MDA2", "avatar_url": "https://avatars.githubusercontent.com/u/18517006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rxrbln", "html_url": "https://github.com/rxrbln", "followers_url": "https://api.github.com/users/rxrbln/followers", "following_url": "https://api.github.com/users/rxrbln/following{/other_user}", "gists_url": "https://api.github.com/users/rxrbln/gists{/gist_id}", "starred_url": "https://api.github.com/users/rxrbln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rxrbln/subscriptions", "organizations_url": "https://api.github.com/users/rxrbln/orgs", "repos_url": "https://api.github.com/users/rxrbln/repos", "events_url": "https://api.github.com/users/rxrbln/events{/privacy}", "received_events_url": "https://api.github.com/users/rxrbln/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80663/timeline", "performed_via_github_app": null, "state_reason": "completed"}