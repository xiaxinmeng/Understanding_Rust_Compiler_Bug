{"url": "https://api.github.com/repos/rust-lang/rust/issues/37528", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37528/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37528/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37528/events", "html_url": "https://github.com/rust-lang/rust/issues/37528", "id": 186696208, "node_id": "MDU6SXNzdWUxODY2OTYyMDg=", "number": 37528, "title": "rustc fails to infer types, provides confusing error message", "user": {"login": "jimblandy", "id": 751272, "node_id": "MDQ6VXNlcjc1MTI3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/751272?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jimblandy", "html_url": "https://github.com/jimblandy", "followers_url": "https://api.github.com/users/jimblandy/followers", "following_url": "https://api.github.com/users/jimblandy/following{/other_user}", "gists_url": "https://api.github.com/users/jimblandy/gists{/gist_id}", "starred_url": "https://api.github.com/users/jimblandy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jimblandy/subscriptions", "organizations_url": "https://api.github.com/users/jimblandy/orgs", "repos_url": "https://api.github.com/users/jimblandy/repos", "events_url": "https://api.github.com/users/jimblandy/events{/privacy}", "received_events_url": "https://api.github.com/users/jimblandy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-11-02T02:19:39Z", "updated_at": "2017-10-24T10:28:11Z", "closed_at": "2016-11-02T23:12:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Rust is unable to infer the element type in the results of a call to `Iterator::partition` if the item type is a reference, but not if it's an integer. The error message says nothing about lifetimes, or any other characteristic specific to references.\r\n\r\nIn nightly Rust, compiling the following code:\r\n```\r\nfn main() {\r\n    let one = Some(1i32);\r\n\r\n    // Rust won't infer the element type here:\r\n    let _a: (Vec<_>, Vec<_>) = one.iter().partition(|_v| true);\r\n    \r\n    // But it does here:\r\n    let _a: (Vec<_>, Vec<_>) = one.iter().cloned().partition(|_v| true);\r\n    \r\n    // And it infers Vec<i32> here:\r\n    let _a: (Vec<_>, Vec<_>) = (0i32..1).partition(|_v| true);    \r\n}\r\n```\r\nproduces the following error:\r\n```\r\nerror[E0282]: unable to infer enough type information about `_`\r\n --> <anon>:3:13\r\n  |\r\n3 |     let _a: (Vec<_>, Vec<_>) = Some(1i32).iter().partition(|_v| true);\r\n  |             ^^^^^^^^^^^^^^^^ cannot infer type for `_`\r\n  |\r\n  = note: type annotations or generic parameter binding required\r\n```\r\n\r\nIt's not clear to me at all why making the iterator clone the items, or using an iterator that doesn't produce references in the first place, should make the type inference work; it seems like `partition` should be as happy to build a vector of references as a vector of integers.\r\n\r\nThis is using: `rustc 1.14.0-nightly (3f4408347 2016-10-27)`", "closed_by": {"login": "jimblandy", "id": 751272, "node_id": "MDQ6VXNlcjc1MTI3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/751272?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jimblandy", "html_url": "https://github.com/jimblandy", "followers_url": "https://api.github.com/users/jimblandy/followers", "following_url": "https://api.github.com/users/jimblandy/following{/other_user}", "gists_url": "https://api.github.com/users/jimblandy/gists{/gist_id}", "starred_url": "https://api.github.com/users/jimblandy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jimblandy/subscriptions", "organizations_url": "https://api.github.com/users/jimblandy/orgs", "repos_url": "https://api.github.com/users/jimblandy/repos", "events_url": "https://api.github.com/users/jimblandy/events{/privacy}", "received_events_url": "https://api.github.com/users/jimblandy/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37528/timeline", "performed_via_github_app": null, "state_reason": "completed"}