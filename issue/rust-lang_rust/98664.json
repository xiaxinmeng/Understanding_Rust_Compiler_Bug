{"url": "https://api.github.com/repos/rust-lang/rust/issues/98664", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/98664/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/98664/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/98664/events", "html_url": "https://github.com/rust-lang/rust/issues/98664", "id": 1288379808, "node_id": "I_kwDOAAsO6M5Myx2g", "number": 98664, "title": "library/std time::tests::instant_math Conditional jump or move depends on uninitialised value(s) reported in Valgrind", "user": {"login": "spital", "id": 11034264, "node_id": "MDQ6VXNlcjExMDM0MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/11034264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spital", "html_url": "https://github.com/spital", "followers_url": "https://api.github.com/users/spital/followers", "following_url": "https://api.github.com/users/spital/following{/other_user}", "gists_url": "https://api.github.com/users/spital/gists{/gist_id}", "starred_url": "https://api.github.com/users/spital/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spital/subscriptions", "organizations_url": "https://api.github.com/users/spital/orgs", "repos_url": "https://api.github.com/users/spital/repos", "events_url": "https://api.github.com/users/spital/events{/privacy}", "received_events_url": "https://api.github.com/users/spital/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-06-29T08:48:45Z", "updated_at": "2022-10-02T22:38:28Z", "closed_at": "2022-10-02T22:38:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am not sure if this may be a problem or if I am doing something wrong, please kindly check.\r\n\r\nTested with a notebook and a desktop PC, no ECC RAM, same error reported by valgrind.\r\n\r\n### NTB:\r\n\r\n``` bash\r\nuname -r\r\n5.18.6-200.fc36.x86_64\r\n\r\ngrep model.name /proc/cpuinfo |head -1\r\nmodel name\t: Intel(R) Core(TM) i7-6600U CPU @ 2.60GHz\r\n```\r\n\r\n### Desktop\r\n\r\n``` bash\r\nuname -r\r\n5.18.5-100.fc35.x86_64\r\n\r\ngrep model.name /proc/cpuinfo |head -1\r\nmodel name\t: AMD Ryzen 9 5900X 12-Core Processor\r\n```\r\n\r\n## Test\r\n\r\nI just cloned rust repo and copied config.toml.example -> config.toml\r\n\r\n``` bash\r\ngit branch\r\n* master\r\n\r\ngit log | head -1\r\ncommit 64eb9ab869bc3f9ef3645302fbf22e706eea16cf\r\n\r\n./x.py clean\r\n\r\n./x.py test library/std # ~ 10 GB disk space needed and ~ 3 hours on a slow ntb\r\n\r\ncd ./build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps\r\n\r\nLD_LIBRARY_PATH=. valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes ./std-c8cf8b0bc965f555 --exact time::tests::instant_math\r\n```\r\n\r\n``` text\r\n==63522== Memcheck, a memory error detector\r\n==63522== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.\r\n==63522== Using Valgrind-3.19.0 and LibVEX; rerun with -h for copyright info\r\n==63522== Command: ./std-c8cf8b0bc965f555 --exact time::tests::instant_math\r\n==63522== \r\n\r\nrunning 1 test\r\n==63522== Thread 2 time::tests::ins:\r\n==63522== Conditional jump or move depends on uninitialised value(s)\r\n==63522==    at 0x49F2F78: <core::time::Duration as core::fmt::Debug>::fmt::fmt_decimal (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522==    by 0x49F2A82: <core::time::Duration as core::fmt::Debug>::fmt (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522==    by 0x4A0A32D: core::fmt::write (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522==    by 0x49AE777: std::io::stdio::_print (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522==    by 0x258B77: std::time::tests::instant_math (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/std-c8cf8b0bc965f555)\r\n==63522==    by 0x4893C12: test::__rust_begin_short_backtrace (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libtest-5edec50902d88f98.so)\r\n==63522==    by 0x4893D9C: test::run_test_in_process (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libtest-5edec50902d88f98.so)\r\n==63522==    by 0x487D303: std::sys_common::backtrace::__rust_begin_short_backtrace (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libtest-5edec50902d88f98.so)\r\n==63522==    by 0x4885E65: core::ops::function::FnOnce::call_once{{vtable.shim}} (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libtest-5edec50902d88f98.so)\r\n==63522==    by 0x498A972: std::sys::unix::thread::Thread::new::thread_start (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522==    by 0x4C3CE2C: start_thread (pthread_create.c:442)\r\n==63522==    by 0x4CC17D3: clone (clone.S:100)\r\n==63522==  Uninitialised value was created by a stack allocation\r\n==63522==    at 0x4A0A170: core::fmt::write (in /home/......../rust/build/x86_64-unknown-linux-gnu/stage1-std/x86_64-unknown-linux-gnu/release/deps/libstd-f7446023a5d37bcb.so)\r\n==63522== \r\ntest time::tests::instant_math ... ok\r\n\r\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 929 filtered out; finished in 0.25s\r\n\r\n==63522== \r\n==63522== HEAP SUMMARY:\r\n==63522==     in use at exit: 0 bytes in 0 blocks\r\n==63522==   total heap usage: 682 allocs, 682 frees, 173,981 bytes allocated\r\n==63522== \r\n==63522== All heap blocks were freed -- no leaks are possible\r\n==63522== \r\n==63522== For lists of detected and suppressed errors, rerun with: -s\r\n==63522== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\r\n```\r\n", "closed_by": {"login": "spital", "id": 11034264, "node_id": "MDQ6VXNlcjExMDM0MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/11034264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spital", "html_url": "https://github.com/spital", "followers_url": "https://api.github.com/users/spital/followers", "following_url": "https://api.github.com/users/spital/following{/other_user}", "gists_url": "https://api.github.com/users/spital/gists{/gist_id}", "starred_url": "https://api.github.com/users/spital/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spital/subscriptions", "organizations_url": "https://api.github.com/users/spital/orgs", "repos_url": "https://api.github.com/users/spital/repos", "events_url": "https://api.github.com/users/spital/events{/privacy}", "received_events_url": "https://api.github.com/users/spital/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/98664/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/98664/timeline", "performed_via_github_app": null, "state_reason": "completed"}