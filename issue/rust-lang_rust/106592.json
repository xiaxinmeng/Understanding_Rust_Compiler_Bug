{"url": "https://api.github.com/repos/rust-lang/rust/issues/106592", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/106592/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/106592/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/106592/events", "html_url": "https://github.com/rust-lang/rust/issues/106592", "id": 1524531666, "node_id": "I_kwDOAAsO6M5a3oHS", "number": 106592, "title": "Split DWARF inlining should be disabled by default", "user": {"login": "khuey", "id": 325892, "node_id": "MDQ6VXNlcjMyNTg5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/325892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khuey", "html_url": "https://github.com/khuey", "followers_url": "https://api.github.com/users/khuey/followers", "following_url": "https://api.github.com/users/khuey/following{/other_user}", "gists_url": "https://api.github.com/users/khuey/gists{/gist_id}", "starred_url": "https://api.github.com/users/khuey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khuey/subscriptions", "organizations_url": "https://api.github.com/users/khuey/orgs", "repos_url": "https://api.github.com/users/khuey/repos", "events_url": "https://api.github.com/users/khuey/events{/privacy}", "received_events_url": "https://api.github.com/users/khuey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-01-08T14:27:31Z", "updated_at": "2023-03-10T11:21:19Z", "closed_at": "2023-01-11T19:56:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm trying out `-Csplit-debuginfo=packed` on a large proprietary Rust project. I see that much of the debug info gets moved to the DWP file, but a lot gets left behind in the main executable.\r\n\r\ne.g.\r\n\r\n```\r\n readelf -S target/release/deps/app_server-d69c587c4cd8e14c.dwp\r\nThere are 10 section headers, starting at offset 0x294c5450:\r\n\r\nSection Headers:\r\n  [Nr] Name              Type             Address           Offset\r\n       Size              EntSize          Flags  Link  Info  Align\r\n  [ 0]                   NULL             0000000000000000  00000000\r\n       0000000000000000  0000000000000000           0     0     0\r\n  [ 1] .debug_str_offset PROGBITS         0000000000000000  00000040\r\n       0000000001c9022c  0000000000000000           0     0     1\r\n  [ 2] .debug_abbrev.dwo PROGBITS         0000000000000000  01c9026c\r\n       00000000002b7fd4  0000000000000000           0     0     1\r\n  [ 3] .debug_info.dwo   PROGBITS         0000000000000000  01f48240\r\n       000000001302d170  0000000000000000           0     0     1\r\n  [ 4] .debug_loc.dwo    PROGBITS         0000000000000000  14f753b0\r\n       000000000603c179  0000000000000000           0     0     1\r\n  [ 5] .debug_str.dwo    PROGBITS         0000000000000000  1afb1529\r\n       000000000e4dffe0  0000000000000000           0     0     1\r\n  [ 6] .debug_cu_index   PROGBITS         0000000000000000  29491509\r\n       0000000000033ea0  0000000000000000           0     0     1\r\n  [ 7] .symtab           SYMTAB           0000000000000000  294c53b0\r\n       0000000000000018  0000000000000018           8     1     8\r\n  [ 8] .strtab           STRTAB           0000000000000000  294c53c8\r\n       0000000000000001  0000000000000000           0     0     1\r\n  [ 9] .shstrtab         STRTAB           0000000000000000  294c53c9\r\n       0000000000000082  0000000000000000           0     0     1\r\n```\r\nvs\r\n```\r\nreadelf -S target/release/app_server\r\nThere are 45 section headers, starting at offset 0x1e25b610:\r\n[snip]\r\n  [32] .debug_aranges    PROGBITS         0000000000000000  03260840\r\n       0000000000442710  0000000000000000           0     0     16\r\n  [33] .debug_info       PROGBITS         0000000000000000  036a2f50\r\n       00000000060c92de  0000000000000000           0     0     1\r\n  [34] .debug_abbrev     PROGBITS         0000000000000000  0976c22e\r\n       0000000000080958  0000000000000000           0     0     1\r\n  [35] .debug_line       PROGBITS         0000000000000000  097ecb86\r\n       0000000003005a24  0000000000000000           0     0     1\r\n  [36] .debug_frame      PROGBITS         0000000000000000  0c7f25b0\r\n       0000000000000178  0000000000000000           0     0     8\r\n  [37] .debug_str        PROGBITS         0000000000000000  0c7f2728\r\n       0000000004ccf04b  0000000000000001  MS       0     0     1\r\n  [38] .debug_loc        PROGBITS         0000000000000000  114c1773\r\n       0000000000932322  0000000000000000           0     0     1\r\n  [39] .debug_ranges     PROGBITS         0000000000000000  11df3a95\r\n       00000000092b4bf0  0000000000000000           0     0     1\r\n  [40] .debug_macro      PROGBITS         0000000000000000  1b0a8685\r\n       0000000000032384  0000000000000000           0     0     1\r\n  [41] .debug_addr       PROGBITS         0000000000000000  1b0daa09\r\n       0000000001cc51e8  0000000000000000           0     0     1\r\n```\r\n\r\nWhen using split DWARF with clang the binary's .debug_info section contains compile units with a single DW_TAG_compile_unit/DW_TAG_skeleton_unit (depending on DWARF 4 vs DWARF 5) and nothing else. When using split DWARF with rustc (1.66.0) though, a lot of stuff is left behind in the binary. The size of the .debug_info section in the binary is still roughly 1/3rd the size of the .debug_info section in the .dwp.\r\n\r\nOne sample of what's left behind:\r\n\r\n```\r\n< 1><0x0000046a>    DW_TAG_subprogram\r\n                      DW_AT_low_pc                0x007d09a0\r\n                      DW_AT_high_pc               <offset-from-lowpc>376\r\n                      DW_AT_name                  variant_seed<serde_json::error::Error, core::marker::PhantomData<variables::data_renderer::_::{impl#0}::deserialize::__Field>>\r\n< 2><0x0000047b>      DW_TAG_inlined_subroutine\r\n                        DW_AT_abstract_origin       <0x00000458>\r\n                        DW_AT_ranges                0x00000f00\r\n                ranges: 4 at .debug_ranges offset 3840 (0x00000f00) (64 bytes)\r\n                        [ 0] range entry    0x007d09aa 0x007d0a99\r\n                        [ 1] range entry    0x007d0aae 0x007d0ad1\r\n                        [ 2] range entry    0x007d0ae7 0x007d0b18\r\n                        [ 3] range end      0x00000000 0x00000000\r\n                        DW_AT_call_file             0x00000003 /home/khuey/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.151/src/private/de.rs\r\n                        DW_AT_call_line             0x000008a5\r\n                        DW_AT_call_column           0x0000000d\r\n< 3><0x00000488>        DW_TAG_inlined_subroutine\r\n                          DW_AT_abstract_origin       <0x00000452>\r\n                          DW_AT_ranges                0x00000f40\r\n                ranges: 4 at .debug_ranges offset 3904 (0x00000f40) (64 bytes)\r\n                        [ 0] range entry    0x007d09aa 0x007d0a99\r\n                        [ 1] range entry    0x007d0aae 0x007d0ad1\r\n                        [ 2] range entry    0x007d0ae7 0x007d0b18\r\n                        [ 3] range end      0x00000000 0x00000000\r\n                          DW_AT_call_file             0x00000007 /home/khuey/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.151/src/de/mod.rs\r\n                          DW_AT_call_line             0x00000318\r\n                          DW_AT_call_column           0x00000009\r\n< 4><0x00000495>          DW_TAG_inlined_subroutine\r\n                            DW_AT_abstract_origin       <0x0000044c>\r\n                            DW_AT_ranges                0x00000f80\r\n                ranges: 4 at .debug_ranges offset 3968 (0x00000f80) (64 bytes)\r\n...\r\n```\r\n\r\nIn general it all seems to be related to inline functions somehow. I assume the contents of debug_str/etc are supporting data for these DIEs.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/106592/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/106592/timeline", "performed_via_github_app": null, "state_reason": "completed"}