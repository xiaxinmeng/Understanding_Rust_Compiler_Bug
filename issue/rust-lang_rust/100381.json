{"url": "https://api.github.com/repos/rust-lang/rust/issues/100381", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100381/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100381/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100381/events", "html_url": "https://github.com/rust-lang/rust/issues/100381", "id": 1334935215, "node_id": "I_kwDOAAsO6M5PkX6v", "number": 100381, "title": "Support generating unique profraw files by default when using `-C instrument-coverage`", "user": {"login": "ridwanabdillahi", "id": 91507758, "node_id": "U_kgDOBXRMLg", "avatar_url": "https://avatars.githubusercontent.com/u/91507758?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ridwanabdillahi", "html_url": "https://github.com/ridwanabdillahi", "followers_url": "https://api.github.com/users/ridwanabdillahi/followers", "following_url": "https://api.github.com/users/ridwanabdillahi/following{/other_user}", "gists_url": "https://api.github.com/users/ridwanabdillahi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ridwanabdillahi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ridwanabdillahi/subscriptions", "organizations_url": "https://api.github.com/users/ridwanabdillahi/orgs", "repos_url": "https://api.github.com/users/ridwanabdillahi/repos", "events_url": "https://api.github.com/users/ridwanabdillahi/events{/privacy}", "received_events_url": "https://api.github.com/users/ridwanabdillahi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 2483744621, "node_id": "MDU6TGFiZWwyNDgzNzQ0NjIx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-code-coverage", "name": "A-code-coverage", "color": "f7e101", "default": false, "description": "Area: Source-based code coverage (-Cinstrument-coverage)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-10T17:11:55Z", "updated_at": "2022-08-22T15:23:44Z", "closed_at": "2022-08-22T15:23:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Currently, when enabling the instrumentation of Rust crates using the `-C instrument-coverage` rustc flag, rustc does not set any default naming scheme for the generated `*.profraw` files. Today, a user has two options:\r\n\r\n1. Allow LLVM to set the default naming scheme which is `default.profraw`. Thie issue here is if there is more than one binary being executed that is linked to the instrumented library, LLVM would overwrite the coverage results from the previous executed binary.\r\n2. Manually set the `LLVM_PROFILE_FILE` environment variable and apply [LLVMs special pattern strings](https://clang.llvm.org/docs/SourceBasedCodeCoverage.html#running-the-instrumented-program) to ensure unique files are generated.\r\n\r\nLLVM also has API support for passing in the designated filename for instrumented profile files via rustc. This is leveraged today when enabling profile guided optimization or PGO. The Rust compiler directly sets a default naming scheme for the generated profraw file, `default_%m.profraw`.\r\n\r\nProfile files generated by rustc's `-C instrument-coverage` should have the same or similar defaults to ensure coverage results are not overwritten by each test binary executed. A similar but more unique version of the default for PGO instrumented profile files should be used since multiple binaries are executed using the same instrumented library such as `default_%m_%p.profraw`.", "closed_by": {"login": "ridwanabdillahi", "id": 91507758, "node_id": "U_kgDOBXRMLg", "avatar_url": "https://avatars.githubusercontent.com/u/91507758?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ridwanabdillahi", "html_url": "https://github.com/ridwanabdillahi", "followers_url": "https://api.github.com/users/ridwanabdillahi/followers", "following_url": "https://api.github.com/users/ridwanabdillahi/following{/other_user}", "gists_url": "https://api.github.com/users/ridwanabdillahi/gists{/gist_id}", "starred_url": "https://api.github.com/users/ridwanabdillahi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ridwanabdillahi/subscriptions", "organizations_url": "https://api.github.com/users/ridwanabdillahi/orgs", "repos_url": "https://api.github.com/users/ridwanabdillahi/repos", "events_url": "https://api.github.com/users/ridwanabdillahi/events{/privacy}", "received_events_url": "https://api.github.com/users/ridwanabdillahi/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100381/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100381/timeline", "performed_via_github_app": null, "state_reason": "completed"}