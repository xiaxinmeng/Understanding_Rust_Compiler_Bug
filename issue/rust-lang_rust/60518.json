{"url": "https://api.github.com/repos/rust-lang/rust/issues/60518", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60518/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60518/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60518/events", "html_url": "https://github.com/rust-lang/rust/issues/60518", "id": 440152730, "node_id": "MDU6SXNzdWU0NDAxNTI3MzA=", "number": 60518, "title": "ICE with the newest nightly in `lower_ty_direct`", "user": {"login": "dovahcrow", "id": 998606, "node_id": "MDQ6VXNlcjk5ODYwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/998606?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dovahcrow", "html_url": "https://github.com/dovahcrow", "followers_url": "https://api.github.com/users/dovahcrow/followers", "following_url": "https://api.github.com/users/dovahcrow/following{/other_user}", "gists_url": "https://api.github.com/users/dovahcrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/dovahcrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dovahcrow/subscriptions", "organizations_url": "https://api.github.com/users/dovahcrow/orgs", "repos_url": "https://api.github.com/users/dovahcrow/repos", "events_url": "https://api.github.com/users/dovahcrow/events{/privacy}", "received_events_url": "https://api.github.com/users/dovahcrow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36956, "node_id": "MDU6TGFiZWwzNjk1Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-frontend", "name": "A-frontend", "color": "f7e101", "default": false, "description": "Area: frontend (errors, parsing and HIR)"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133344, "node_id": "MDU6TGFiZWwyNTYxMzMzNDQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-hir", "name": "A-hir", "color": "f7e101", "default": false, "description": "Area: the High level Intermediate Representation (HIR)"}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}], "state": "closed", "locked": false, "assignee": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2019-05-03T17:49:12Z", "updated_at": "2019-05-04T10:22:35Z", "closed_at": "2019-05-04T10:22:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was using nightly rust extensively for its async/await and specialization feature. After a recent update (nightly-2019-05-02), a new ICE introduced with following logs:\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:347:21\r\nstack backtrace:\r\n   0:        0x110e581b3 - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h6365da97c1471e71\r\n   1:        0x110e50892 - std::sys_common::backtrace::_print::h16aa04d49feca3fd\r\n   2:        0x110e54756 - std::panicking::default_hook::{{closure}}::h9fc4c0be5c9ca44c\r\n   3:        0x110e544ff - std::panicking::default_hook::h9f3e4e5508e6484c\r\n   4:        0x10fd84862 - rustc::util::common::panic_hook::h4551d4322cc0be4e\r\n   5:        0x110e54fb0 - std::panicking::rust_panic_with_hook::h297147e5cbed8f24\r\n   6:        0x110e549fc - std::panicking::continue_panic_fmt::h3ae1ed03b6fbf85b\r\n   7:        0x110e548e8 - rust_begin_unwind\r\n   8:        0x110e7bda1 - core::panicking::panic_fmt::h92ee99ae8e2af121\r\n   9:        0x110e7bce6 - core::panicking::panic::hb56cbf1700d827ce\r\n  10:        0x10fb86454 - rustc::hir::lowering::LoweringContext::lower_ty_direct::h9ebc55904e648f31\r\n  11:        0x10fb701f8 - <core::iter::adapters::Map<I,F> as core::iter::traits::iterator::Iterator>::fold::h653da98ee2e15104\r\n  12:        0x10fa9a102 - <alloc::vec::Vec<T> as alloc::vec::SpecExtend<T,I>>::from_iter::h736c20ebb9808f68\r\n  13:        0x10fb8c4f5 - rustc::hir::lowering::LoweringContext::lower_fn_decl::h65e61c23b5e1db51\r\n  14:        0x10fb97896 - rustc::hir::lowering::LoweringContext::lower_method_sig::hcc9e0b8d06e43390\r\n  15:        0x10fb83948 - <rustc::hir::lowering::LoweringContext::lower_crate::ItemLowerer as syntax::visit::Visitor>::visit_impl_item::hf58ebdc514d497b2\r\n  16:        0x10fc6b431 - syntax::visit::walk_item::h07763bacbb55de9b\r\n  17:        0x10fb81e06 - <rustc::hir::lowering::LoweringContext::lower_crate::ItemLowerer as syntax::visit::Visitor>::visit_item::h0d167e58e23044e6\r\n  18:        0x10fb81aab - <rustc::hir::lowering::LoweringContext::lower_crate::ItemLowerer as syntax::visit::Visitor>::visit_mod::hd9777ed3e1d08615\r\n  19:        0x10fb80aa3 - rustc::hir::lowering::lower_crate::h0c5e238015c897e0\r\n  20:        0x10cc0a276 - rustc::util::common::time::h348b235e44461401\r\n  21:        0x10cb636e9 - rustc_interface::passes::BoxedResolver::access::{{closure}}::h5e3406b2f5a3ba63\r\n  22:        0x10cbaf2a4 - rustc_interface::passes::configure_and_expand::{{closure}}::hab3456cc016f1063\r\n  23:        0x10cb87880 - rustc_data_structures::box_region::PinnedGenerator<I,A,R>::access::h947d707adafbf1b3\r\n  24:        0x10cbf43d2 - rustc_interface::queries::Query<T>::compute::h0c12b0325a8fa361\r\n  25:        0x10cbf4f7e - rustc_interface::queries::Query<T>::compute::h419fdaafe2fe1061\r\n  26:        0x10cbdffbb - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::prepare_outputs::h0b2ca183a9af9723\r\n  27:        0x10c9b1141 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h6a703186bc682b69\r\n  28:        0x10ca29396 - std::thread::local::LocalKey<T>::with::h31807013e3f0179f\r\n  29:        0x10c9f7ad5 - scoped_tls::ScopedKey<T>::set::h4a42df1285ef48d6\r\n  30:        0x10ca24f42 - syntax::with_globals::h968f8ffc9c58c643\r\n  31:        0x10c995988 - std::sys_common::backtrace::__rust_begin_short_backtrace::h209394f9599ce87a\r\n  32:        0x110e645ee - __rust_maybe_catch_panic\r\n  33:        0x10c9adea6 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h56573a7f40ae7fa3\r\n  34:        0x110e3688d - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::hc80e6bd391717f52\r\n  35:        0x110e633ad - std::sys::unix::thread::Thread::new::thread_start::hfe8c382e207f42b7\r\n  36:     0x7fff6444f304 - _pthread_body\r\n  37:     0x7fff6445226e - _pthread_start\r\n```\r\nAfter a quick search it seems like [this](https://github.com/rust-lang/rust/blob/master/src/librustc/hir/lowering.rs#L1478) is the only `unwrap` in direct cause `lower_ty_direct` (stack frame 10).\r\n\r\n\r\n~I cannot share the code or produce a minimal case because the code base is rather big.~\r\n\r\n[Minimal reproducing case](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=db9ab3e714907d634adc75f26a765103)", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60518/timeline", "performed_via_github_app": null, "state_reason": "completed"}