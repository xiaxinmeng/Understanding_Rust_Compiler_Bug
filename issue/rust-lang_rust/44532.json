{"url": "https://api.github.com/repos/rust-lang/rust/issues/44532", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44532/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44532/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44532/events", "html_url": "https://github.com/rust-lang/rust/issues/44532", "id": 257244435, "node_id": "MDU6SXNzdWUyNTcyNDQ0MzU=", "number": 44532, "title": "std::fs::copy returns the combined size of all streams on NTFS on Windows", "user": {"login": "stephaneyfx", "id": 24405066, "node_id": "MDQ6VXNlcjI0NDA1MDY2", "avatar_url": "https://avatars.githubusercontent.com/u/24405066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stephaneyfx", "html_url": "https://github.com/stephaneyfx", "followers_url": "https://api.github.com/users/stephaneyfx/followers", "following_url": "https://api.github.com/users/stephaneyfx/following{/other_user}", "gists_url": "https://api.github.com/users/stephaneyfx/gists{/gist_id}", "starred_url": "https://api.github.com/users/stephaneyfx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stephaneyfx/subscriptions", "organizations_url": "https://api.github.com/users/stephaneyfx/orgs", "repos_url": "https://api.github.com/users/stephaneyfx/repos", "events_url": "https://api.github.com/users/stephaneyfx/events{/privacy}", "received_events_url": "https://api.github.com/users/stephaneyfx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2017-09-13T03:10:28Z", "updated_at": "2017-10-04T00:57:36Z", "closed_at": "2017-10-04T00:57:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "NTFS files may contain alternate data streams besides the main one. Since PR #26751, `std::fs::copy` returns the combined size of all streams, which is confusing and likely unexpected unless the user is aware of this Windows/NTFS peculiarity.\r\n\r\nAn example where Windows uses alternate data streams seems to be when storing whether a file was downloaded from the internet (e.g. to display a security section and an \"Unblock\" button in the file properties). Such alternate streams are more like metadata, and to be consistent with other file metadata (attributes, permissions, extended attributes, etc.), their size should not be reflected in the value returned by `copy`.\r\n\r\nIn summary, I think `std::fs::copy` should return the size of the main stream for the following reasons (alternate data streams are still copied, their size is just not reported, like other metadata):\r\n\r\n- This is the least confusing result for non-NTFS experts and what most people expect (no \"copying more bytes than the file contains\").\r\n- This is consistent with other file metadata whose size is not reported by `copy`.\r\n- Alternate streams are mostly invisible, unless you try to open them explicitly. Even the file properties don't show them and Windows reports only the size of the main stream in the dialog.\r\n\r\n@retep998, what do you think?\r\n\r\n# Steps to reproduce\r\n1. On Windows, download an executable file to a NTFS partition and verify that the property dialog contains a security section with an \"Unblock\" button.\r\n2. Note the file size reported in the file properties.\r\n3. Copy the file to the same partition using `std::fs::copy` and note the number of bytes returned.\r\n\r\n# Expected result\r\nThe number of bytes copied reported by `copy` is equal to the file size.\r\n\r\n# Actual result\r\n`copy` reports a number of bytes greater than the file size.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44532/timeline", "performed_via_github_app": null, "state_reason": "completed"}