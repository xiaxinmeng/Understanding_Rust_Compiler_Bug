{"url": "https://api.github.com/repos/rust-lang/rust/issues/66077", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66077/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66077/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66077/events", "html_url": "https://github.com/rust-lang/rust/issues/66077", "id": 517056954, "node_id": "MDU6SXNzdWU1MTcwNTY5NTQ=", "number": 66077, "title": "Broken MIR (debug info?) with mir-opt-level=2", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-11-04T10:16:39Z", "updated_at": "2019-11-06T08:18:42Z", "closed_at": "2019-11-06T08:18:42Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Miri sometimes ICEs when printing the backtrace of a failure with `mir-opt-level=2`:\r\n```\r\nRUST_BACKTRACE=1 ./miri run tests/compile-fail/deallocate-twice.rs -Zmir-opt-level=2\r\n```\r\ngives\r\n```\r\n  15: core::panicking::panic_bounds_check\r\n             at src/libcore/panicking.rs:96\r\n  16: <usize as core::slice::SliceIndex<[T]>>::index\r\n             at /rustc/cba93685377bc74a2fde1eb8e7a086039b038e94/src/libcore/slice/mod.rs:2796\r\n  17: core::slice::<impl core::ops::index::Index<I> for [T]>::index\r\n             at /rustc/cba93685377bc74a2fde1eb8e7a086039b038e94/src/libcore/slice/mod.rs:2647\r\n  18: <alloc::vec::Vec<T> as core::ops::index::Index<I>>::index\r\n             at /rustc/cba93685377bc74a2fde1eb8e7a086039b038e94/src/liballoc/vec.rs:1861\r\n  19: <rustc_index::vec::IndexVec<I,T> as core::ops::index::Index<I>>::index\r\n             at /rustc/cba93685377bc74a2fde1eb8e7a086039b038e94/src/librustc_index/vec.rs:740\r\n  20: rustc_mir::interpret::eval_context::InterpCx<M>::generate_stacktrace\r\n             at /rustc/cba93685377bc74a2fde1eb8e7a086039b038e94/src/librustc_mir/interpret/eval_context.rs:755\r\n  21: miri::eval::eval_main\r\n             at src/eval.rs:225\r\n  22: <miri::MiriCompilerCalls as rustc_driver::Callbacks>::after_analysis::{{closure}}\r\n             at src/bin/miri.rs:52\r\n```\r\nWhat happens here is that the following indexing operation is out-of-bounds:\r\nhttps://github.com/rust-lang/rust/blob/cba93685377bc74a2fde1eb8e7a086039b038e94/src/librustc_mir/interpret/eval_context.rs#L755\r\nThis looks like broken MIR to me.\r\n\r\n(This is not a new error, but somehow it seems I did not report it when this started happening quite a while ago.)\r\n\r\nCc @oli-obk @eddyb @wesleywiser ", "closed_by": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66077/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66077/timeline", "performed_via_github_app": null, "state_reason": "completed"}