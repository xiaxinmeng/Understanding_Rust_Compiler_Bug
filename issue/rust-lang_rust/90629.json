{"url": "https://api.github.com/repos/rust-lang/rust/issues/90629", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90629/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90629/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90629/events", "html_url": "https://github.com/rust-lang/rust/issues/90629", "id": 1046189945, "node_id": "I_kwDOAAsO6M4-W5d5", "number": 90629, "title": "anonymous constants are overly restrictive wrt variance", "user": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1282665911, "node_id": "MDU6TGFiZWwxMjgyNjY1OTEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-generics", "name": "A-const-generics", "color": "f7e101", "default": false, "description": "Area: const generics (parameters and arguments)"}, {"id": 2341291797, "node_id": "MDU6TGFiZWwyMzQxMjkxNzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_const_exprs", "name": "F-generic_const_exprs", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_const_exprs)]`"}, {"id": 3675472455, "node_id": "LA_kwDOAAsO6M7bE0JH", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-variance", "name": "A-variance", "color": "f7e101", "default": false, "description": "Area: Variance (https://doc.rust-lang.org/nomicon/subtyping.html)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-11-05T19:48:46Z", "updated_at": "2022-05-30T06:48:52Z", "closed_at": "2022-05-30T06:48:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "cc https://github.com/rust-lang/rust/pull/89829#issuecomment-948921310\r\n\r\nthis currently causes an error as `'a` is considered invariant because it is used in an anonymous constant.\r\n```rust\r\n#![feature(generic_const_exprs)]\r\nstruct Foo<'a>([&'a u32; std::mem::size_of::<&'a u32>()]);\r\nfn covariant<'a>(v: &'a Foo<'static>) -> &'a Foo<'a> {\r\n    v //~ERROR mismatched types\r\n}\r\n```\r\nThis shouldn't actually be needed for `std::mem::size_of` as it doesn't care about variance.\r\n\r\nOnce stuff like the following causes an error (instead of a future imcompat lint, cc https://github.com/rust-lang/rust/issues/56105), subtyping should not be able to influence const eval, so we could allow lifetimes used in constants to remain bivariant. It is not clear that we should do that, as this restriction on subtyping is definitely not obvious or even necessarily desirable.\r\n```rust\r\ntrait SadBee {\r\n    const ASSOC: usize;\r\n}\r\n// fn(&'static ())` is a supertype of `for<'a> fn(&'a ())` while\r\n// we allow two different impls for these types, leading\r\n// to different const eval results.\r\nimpl SadBee for for<'a> fn(&'a ()) {\r\n    const ASSOC: usize = 0;\r\n}\r\nimpl SadBee for fn(&'static ()) {\r\n    const ASSOC: usize = 100;\r\n}\r\n```", "closed_by": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90629/timeline", "performed_via_github_app": null, "state_reason": "completed"}