{"url": "https://api.github.com/repos/rust-lang/rust/issues/93916", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93916/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93916/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93916/events", "html_url": "https://github.com/rust-lang/rust/issues/93916", "id": 1133046869, "node_id": "I_kwDOAAsO6M5DiOxV", "number": 93916, "title": "cargo fix aborts after an error", "user": {"login": "mrpink76", "id": 7203676, "node_id": "MDQ6VXNlcjcyMDM2NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7203676?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrpink76", "html_url": "https://github.com/mrpink76", "followers_url": "https://api.github.com/users/mrpink76/followers", "following_url": "https://api.github.com/users/mrpink76/following{/other_user}", "gists_url": "https://api.github.com/users/mrpink76/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrpink76/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrpink76/subscriptions", "organizations_url": "https://api.github.com/users/mrpink76/orgs", "repos_url": "https://api.github.com/users/mrpink76/repos", "events_url": "https://api.github.com/users/mrpink76/events{/privacy}", "received_events_url": "https://api.github.com/users/mrpink76/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-02-11T20:14:21Z", "updated_at": "2022-02-12T03:55:04Z", "closed_at": "2022-02-12T03:55:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "When i tried to run ```cargo fix``` I got an error message that I should submit a bug with the output of cargo fix which is what I'm doing\r\n\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\nbinary: rustc\r\ncommit-hash: db9d1b20bba1968c1ec1fc49616d4742c1725b4b\r\ncommit-date: 2022-01-20\r\nhost: aarch64-apple-darwin\r\nrelease: 1.58.1\r\nLLVM version: 13.0.0\r\n```\r\n\r\nThe error I got after applying ```cargo fix --broken-code```\r\n```\r\n   Compiling rc v0.1.0 (/Users/petter/git/rc)\r\nerror[E0425]: cannot find value `input` in this scope\r\n   --> src/filesystem/mod.rs:115:21\r\n    |\r\n115 |                     input.clone(),\r\n    |                     ^^^^^ help: a local variable with a similar name exists: `_input`\r\n\r\nerror[E0425]: cannot find value `input` in this scope\r\n   --> src/filesystem/mod.rs:118:18\r\n    |\r\n118 |             (id, input)\r\n    |                  ^^^^^ help: a local variable with a similar name exists: `_input`\r\n```\r\n\r\nThe problematic code:\r\n\r\n```rust\r\n    async fn run_background_task(&self, task: Box<dyn BackgroundTask>) -> () {\r\n        let (_id, _task) = {\r\n            let mut app = self.app.lock().await;\r\n            let id = Uuid::new_v4();\r\n            app.foreground_task = Some(id);\r\n            let input = task.task();  // <--- 'input' here is flagged with a warning saying that it is never used (which is wrong)\r\n            app.tasks.insert(\r\n                id,\r\n                (\r\n                    TaskData {\r\n                        start: todo!(),\r\n                        completed: todo!(),\r\n                    },\r\n                    input.clone(),\r\n                ),\r\n            );\r\n            (id, input)\r\n        };\r\n   }\r\n```\r\n\r\nThe warning:\r\n```\r\nwarning: unused variable: `input`\r\n   --> src/filesystem/mod.rs:107:17\r\n    |\r\n107 |             let input = task.task();\r\n    |                 ^^^^^ help: if this is intentional, prefix it with an underscore: `_input`\r\n    |\r\n    = note: `#[warn(unused_variables)]` on by default\r\n```\r\n\r\nThe output of cargo fix:\r\n\r\n```\r\npetter@petters-mbp rc % cargo fix\r\n    Checking rc v0.1.0 (/Users/petter/git/rc)\r\nwarning: failed to automatically apply fixes suggested by rustc to crate `rc`\r\n\r\nafter fixes were automatically applied the compiler reported errors within these files:\r\n\r\n  * /Users/petter/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/panic.rs\r\n  * src/filesystem/mod.rs\r\n\r\nThis likely indicates a bug in either rustc or cargo itself,\r\nand we would appreciate a bug report! You're likely to see\r\na number of compiler warnings after this message which cargo\r\nattempted to fix but failed. If you could open an issue at\r\nhttps://github.com/rust-lang/rust/issues\r\nquoting the full output of this command we'd be very appreciative!\r\nNote that you may be able to make some more progress in the near-term\r\nfixing code with the `--broken-code` flag\r\n\r\nThe following errors were reported:\r\nerror[E0425]: cannot find value `input` in this scope\r\n   --> src/filesystem/mod.rs:115:21\r\n    |\r\n115 |                     input.clone(),\r\n    |                     ^^^^^ help: a local variable with a similar name exists: `_input`\r\n\r\nerror[E0425]: cannot find value `input` in this scope\r\n   --> src/filesystem/mod.rs:118:18\r\n    |\r\n118 |             (id, input)\r\n    |                  ^^^^^ help: a local variable with a similar name exists: `_input`\r\n\r\nwarning: unreachable expression\r\n   --> src/filesystem/mod.rs:113:36\r\n    |\r\n112 |                         start: todo!(),\r\n    |                                ------- any code following this expression is unreachable\r\n113 |                         completed: todo!(),\r\n    |                                    ^^^^^^^ unreachable expression\r\n    |\r\n    = note: `#[warn(unreachable_code)]` on by default\r\n    = note: this warning originates in the macro `$crate::panic::panic_2015` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: aborting due to 2 previous errors; 1 warning emitted\r\n\r\nFor more information about this error, try `rustc --explain E0425`.\r\nOriginal diagnostics will follow.\r\n\r\nwarning: unused import: `crate::app::Pane`\r\n --> src/filesystem/mod.rs:2:5\r\n  |\r\n2 | use crate::app::Pane;\r\n  |     ^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(unused_imports)]` on by default\r\n\r\nwarning: unused import: `crate::app::RcTask::DeleteInput`\r\n --> src/filesystem/mod.rs:3:5\r\n  |\r\n3 | use crate::app::RcTask::DeleteInput;\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `crate::app::RcTask::SearchInput`\r\n --> src/filesystem/mod.rs:4:5\r\n  |\r\n4 | use crate::app::RcTask::SearchInput;\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `crate::filesystem::flatsearchresultprovider::FlatSearchResultProvider`\r\n --> src/filesystem/mod.rs:8:5\r\n  |\r\n8 | use crate::filesystem::flatsearchresultprovider::FlatSearchResultProvider;\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `chrono::Local`\r\n  --> src/filesystem/mod.rs:16:5\r\n   |\r\n16 | use chrono::Local;\r\n   |     ^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `git2::Repository`\r\n  --> src/filesystem/mod.rs:17:5\r\n   |\r\n17 | use git2::Repository;\r\n   |     ^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `ignore::overrides::OverrideBuilder`\r\n  --> src/filesystem/mod.rs:18:5\r\n   |\r\n18 | use ignore::overrides::OverrideBuilder;\r\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `ignore::WalkBuilder`\r\n  --> src/filesystem/mod.rs:19:5\r\n   |\r\n19 | use ignore::WalkBuilder;\r\n   |     ^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `regex::Regex`\r\n  --> src/filesystem/mod.rs:20:5\r\n   |\r\n20 | use regex::Regex;\r\n   |     ^^^^^^^^^^^^\r\n\r\nwarning: unused import: `std::fs::File`\r\n  --> src/filesystem/mod.rs:21:5\r\n   |\r\n21 | use std::fs::File;\r\n   |     ^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `std::io::Read`\r\n  --> src/filesystem/mod.rs:22:5\r\n   |\r\n22 | use std::io::Read;\r\n   |     ^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `std::path::Path`\r\n  --> src/filesystem/mod.rs:23:5\r\n   |\r\n23 | use std::path::Path;\r\n   |     ^^^^^^^^^^^^^^^\r\n\r\nwarning: unused imports: `path::PathBuf`, `remove_dir`, `remove_file`\r\n  --> src/filesystem/mod.rs:25:10\r\n   |\r\n25 |     fs::{remove_dir, remove_file},\r\n   |          ^^^^^^^^^^  ^^^^^^^^^^^\r\n26 |     path::PathBuf,\r\n   |     ^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `tracing::error`\r\n  --> src/filesystem/mod.rs:30:5\r\n   |\r\n30 | use tracing::error;\r\n   |     ^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `crate::app::Pane`\r\n --> src/task/search_task.rs:2:5\r\n  |\r\n2 | use crate::app::Pane;\r\n  |     ^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `crate::app::TaskData`\r\n --> src/task/search_task.rs:6:5\r\n  |\r\n6 | use crate::app::TaskData;\r\n  |     ^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `crate::network::PaneIdentifier`\r\n --> src/task/search_task.rs:8:5\r\n  |\r\n8 | use crate::network::PaneIdentifier;\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `chrono::Local`\r\n  --> src/task/search_task.rs:11:5\r\n   |\r\n11 | use chrono::Local;\r\n   |     ^^^^^^^^^^^^^\r\n\r\nwarning: unused import: `uuid::Uuid`\r\n  --> src/task/search_task.rs:20:5\r\n   |\r\n20 | use uuid::Uuid;\r\n   |     ^^^^^^^^^^\r\n\r\nwarning: unreachable expression\r\n   --> src/filesystem/mod.rs:115:36\r\n    |\r\n114 |                         start: todo!(),\r\n    |                                ------- any code following this expression is unreachable\r\n115 |                         completed: todo!(),\r\n    |                                    ^^^^^^^ unreachable expression\r\n    |\r\n    = note: `#[warn(unreachable_code)]` on by default\r\n    = note: this warning originates in the macro `$crate::panic::panic_2015` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nwarning: unused variable: `input`\r\n   --> src/filesystem/mod.rs:109:17\r\n    |\r\n109 |             let input = task.task();\r\n    |                 ^^^^^ help: if this is intentional, prefix it with an underscore: `_input`\r\n    |\r\n    = note: `#[warn(unused_variables)]` on by default\r\n\r\nwarning: unused variable: `e`\r\n   --> src/filesystem/mod.rs:137:17\r\n    |\r\n137 |             Err(e) => {\r\n    |                 ^ help: if this is intentional, prefix it with an underscore: `_e`\r\n\r\nwarning: unused variable: `search_result_name`\r\n   --> src/task/search_task.rs:110:13\r\n    |\r\n110 |         let search_result_name = store_search_result(&hits2, &self.client_config, &self.input);\r\n    |             ^^^^^^^^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_search_result_name`\r\n\r\nwarning: variant is never constructed: `UserActionRequest`\r\n   --> src/app.rs:241:5\r\n    |\r\n241 |     UserActionRequest(UserActionRequest), /* Skip / Abort */\r\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n    |\r\n    = note: `#[warn(dead_code)]` on by default\r\n\r\nwarning: variant is never constructed: `FileCopyToExistingFile`\r\n   --> src/app.rs:245:5\r\n    |\r\n245 |     FileCopyToExistingFile, /* Skip / Abort */\r\n    |     ^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: enum is never used: `UserActionResponse`\r\n   --> src/app.rs:248:10\r\n    |\r\n248 | pub enum UserActionResponse {\r\n    |          ^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: associated function is never used: `parent`\r\n   --> src/app.rs:381:12\r\n    |\r\n381 |     pub fn parent(&mut self) -> &mut Option<Pane> {\r\n    |            ^^^^^^\r\n\r\nwarning: associated function is never used: `new`\r\n  --> src/task/search_task.rs:28:12\r\n   |\r\n28 |     pub fn new(input: SearchDialog, client_config: ClientConfig) -> SearchTask {\r\n   |            ^^^\r\n\r\nwarning: `rc` (bin \"rc\") generated 28 warnings\r\nwarning: `rc` (bin \"rc\" test) generated 28 warnings (28 duplicates)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 1.26s\r\n```", "closed_by": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93916/timeline", "performed_via_github_app": null, "state_reason": "completed"}