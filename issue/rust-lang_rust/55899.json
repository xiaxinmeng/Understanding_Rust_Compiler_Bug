{"url": "https://api.github.com/repos/rust-lang/rust/issues/55899", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55899/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55899/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55899/events", "html_url": "https://github.com/rust-lang/rust/issues/55899", "id": 379829429, "node_id": "MDU6SXNzdWUzNzk4Mjk0Mjk=", "number": 55899, "title": "Fail to preserve non-referenced statics", "user": {"login": "ababo", "id": 503292, "node_id": "MDQ6VXNlcjUwMzI5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/503292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ababo", "html_url": "https://github.com/ababo", "followers_url": "https://api.github.com/users/ababo/followers", "following_url": "https://api.github.com/users/ababo/following{/other_user}", "gists_url": "https://api.github.com/users/ababo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ababo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ababo/subscriptions", "organizations_url": "https://api.github.com/users/ababo/orgs", "repos_url": "https://api.github.com/users/ababo/repos", "events_url": "https://api.github.com/users/ababo/events{/privacy}", "received_events_url": "https://api.github.com/users/ababo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-12T15:32:46Z", "updated_at": "2018-11-12T19:27:04Z", "closed_at": "2018-11-12T19:25:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "I need some non-referenced static variables to be included in output binary image within a specified section, but failing to achieve that.\r\n\r\n```rust\r\n#[used]\r\n#[linkage = \"external\"]\r\n#[link_section = \".header\"]\r\nstatic HEADER: &[u8] = b\"Some data I want to expose in the binary image\";\r\n```\r\n\r\nBuilding with the following target:\r\n```json\r\n{\r\n    \"arch\": \"x86_64\",\r\n    \"data-layout\": \"e-m:e-i64:64-f80:128-n8:16:32:64-S128\",\r\n    \"disable-redzone\": true,\r\n    \"executables\": true,\r\n    \"features\": \"-mmx,-sse,+soft-float\",\r\n    \"linker\": \"rust-lld\",\r\n    \"linker-flavor\": \"ld.lld\",\r\n    \"llvm-target\": \"x86_64-unknown-none\",\r\n    \"os\": \"none\",\r\n    \"panic-strategy\": \"abort\",\r\n    \"relocation_model\": \"static\",\r\n    \"target-c-int-width\": \"32\",\r\n    \"target-endian\": \"little\",\r\n    \"target-pointer-width\": \"64\"\r\n}\r\n```\r\n\r\nHere is a build log (from `cargo-xbuild`):\r\n```\r\n+ \"rustc\" \"--print\" \"sysroot\"\r\n+ \"rustc\" \"--print\" \"target-list\"\r\n+ \"cargo\" \"rustc\" \"-p\" \"core\" \"--release\" \"--manifest-path\" \"/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.HH2luaMyKmpm/Cargo.toml\" \"--target\" \"x86_64-octopus.json\" \"-v\" \"--\" \"--sysroot\" \"/Users/ababo/Desktop/octopus/target/sysroot\" \"-Z\" \"force-unstable-if-unmarked\"\r\n   Compiling core v0.0.0 (/Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcore)\r\n     Running `rustc --crate-name core /Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcore/lib.rs --color always --crate-type lib --emit=dep-info,link -C opt-level=3 --sysroot /Users/ababo/Desktop/octopus/target/sysroot -Z force-unstable-if-unmarked -C metadata=5783578f8aca7d94 -C extra-filename=-5783578f8aca7d94 --out-dir /var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.HH2luaMyKmpm/target/x86_64-octopus/release/deps --target /Users/ababo/Desktop/octopus/x86_64-octopus.json -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.HH2luaMyKmpm/target/x86_64-octopus/release/deps -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.HH2luaMyKmpm/target/release/deps`\r\n    Finished release [optimized] target(s) in 24.76s\r\n+ \"cargo\" \"rustc\" \"-p\" \"compiler_builtins\" \"--release\" \"--manifest-path\" \"/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/Cargo.toml\" \"--target\" \"x86_64-octopus.json\" \"-v\" \"--\" \"--sysroot\" \"/Users/ababo/Desktop/octopus/target/sysroot\" \"-Z\" \"force-unstable-if-unmarked\"\r\n   Compiling compiler_builtins v0.1.0 (/Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcompiler_builtins)\r\n     Running `rustc --crate-name build_script_build /Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcompiler_builtins/build.rs --color always --crate-type bin --emit=dep-info,link -C opt-level=3 --cfg 'feature=\"compiler-builtins\"' --cfg 'feature=\"mem\"' -C metadata=469ac36c511e85d0 -C extra-filename=-469ac36c511e85d0 --out-dir /var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/release/build/compiler_builtins-469ac36c511e85d0 -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/release/deps`\r\n     Running `/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/release/build/compiler_builtins-469ac36c511e85d0/build-script-build`\r\n     Running `rustc --crate-name compiler_builtins /Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/libcompiler_builtins/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C opt-level=3 --sysroot /Users/ababo/Desktop/octopus/target/sysroot -Z force-unstable-if-unmarked --cfg 'feature=\"compiler-builtins\"' --cfg 'feature=\"mem\"' -C metadata=b110665f7d331de0 -C extra-filename=-b110665f7d331de0 --out-dir /var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/x86_64-octopus/release/deps --target /Users/ababo/Desktop/octopus/x86_64-octopus.json -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/x86_64-octopus/release/deps -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.UVTNPT989UbU/target/release/deps`\r\n    Finished release [optimized] target(s) in 2.43s\r\n+ \"cargo\" \"rustc\" \"-p\" \"alloc\" \"--release\" \"--manifest-path\" \"/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.wZMNn8CTWNq7/Cargo.toml\" \"--target\" \"x86_64-octopus.json\" \"-v\" \"--\" \"--sysroot\" \"/Users/ababo/Desktop/octopus/target/sysroot\" \"-Z\" \"force-unstable-if-unmarked\"\r\n   Compiling alloc v0.0.0 (/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.wZMNn8CTWNq7)\r\n     Running `rustc --crate-name alloc /Users/ababo/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src/liballoc/lib.rs --color always --crate-type lib --emit=dep-info,link -C opt-level=3 --sysroot /Users/ababo/Desktop/octopus/target/sysroot -Z force-unstable-if-unmarked -C metadata=a1554c1aaf613b4b -C extra-filename=-a1554c1aaf613b4b --out-dir /var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.wZMNn8CTWNq7/target/x86_64-octopus/release/deps --target /Users/ababo/Desktop/octopus/x86_64-octopus.json -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.wZMNn8CTWNq7/target/x86_64-octopus/release/deps -L dependency=/var/folders/g3/tsl1395n45d_t9gv4zcs4d440000gn/T/xargo.wZMNn8CTWNq7/target/release/deps`\r\n    Finished release [optimized] target(s) in 4.37s\r\n+ RUSTFLAGS=\"--sysroot /Users/ababo/Desktop/octopus/target/sysroot\"\r\n+ \"cargo\" \"build\" \"--target\" \"x86_64-octopus.json\" \"--release\" \"-v\"\r\n   Compiling octopus v0.1.0 (/Users/ababo/Desktop/octopus)\r\n     Running `rustc --crate-name octopus src/main.rs --color always --crate-type bin --emit=dep-info,link -C opt-level=3 -C metadata=303a51754fa6a1c4 -C extra-filename=-303a51754fa6a1c4 --out-dir /Users/ababo/Desktop/octopus/target/x86_64-octopus/release/deps --target /Users/ababo/Desktop/octopus/x86_64-octopus.json -L dependency=/Users/ababo/Desktop/octopus/target/x86_64-octopus/release/deps -L dependency=/Users/ababo/Desktop/octopus/target/release/deps --sysroot /Users/ababo/Desktop/octopus/target/sysroot`\r\n    Finished release [optimized] target(s) in 0.44s\r\n```\r\n\r\nYou can reproduce the problem using [these sources](https://github.com/ababo/octopus/tree/704f17672bfc4c9ebaaf998ce5b9c21babdaa66f).\r\n\r\nrustc version: `rustc 1.32.0-nightly (8b096314a 2018-11-02)`", "closed_by": {"login": "ababo", "id": 503292, "node_id": "MDQ6VXNlcjUwMzI5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/503292?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ababo", "html_url": "https://github.com/ababo", "followers_url": "https://api.github.com/users/ababo/followers", "following_url": "https://api.github.com/users/ababo/following{/other_user}", "gists_url": "https://api.github.com/users/ababo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ababo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ababo/subscriptions", "organizations_url": "https://api.github.com/users/ababo/orgs", "repos_url": "https://api.github.com/users/ababo/repos", "events_url": "https://api.github.com/users/ababo/events{/privacy}", "received_events_url": "https://api.github.com/users/ababo/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55899/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55899/timeline", "performed_via_github_app": null, "state_reason": "completed"}