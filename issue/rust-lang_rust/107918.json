{"url": "https://api.github.com/repos/rust-lang/rust/issues/107918", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107918/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107918/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107918/events", "html_url": "https://github.com/rust-lang/rust/issues/107918", "id": 1580635880, "node_id": "I_kwDOAAsO6M5eNpbo", "number": 107918, "title": "`cargo doc` fails on `found duplicate lang item 'panic_impl'` dependency issue (`no_std`)", "user": {"login": "tgross35", "id": 13724985, "node_id": "MDQ6VXNlcjEzNzI0OTg1", "avatar_url": "https://avatars.githubusercontent.com/u/13724985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tgross35", "html_url": "https://github.com/tgross35", "followers_url": "https://api.github.com/users/tgross35/followers", "following_url": "https://api.github.com/users/tgross35/following{/other_user}", "gists_url": "https://api.github.com/users/tgross35/gists{/gist_id}", "starred_url": "https://api.github.com/users/tgross35/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tgross35/subscriptions", "organizations_url": "https://api.github.com/users/tgross35/orgs", "repos_url": "https://api.github.com/users/tgross35/repos", "events_url": "https://api.github.com/users/tgross35/events{/privacy}", "received_events_url": "https://api.github.com/users/tgross35/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2023-02-11T04:00:48Z", "updated_at": "2023-02-26T04:57:12Z", "closed_at": "2023-02-26T04:57:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It seems like `cargo doc` fails is there is a dependency that has a `panic_impl` and a binary that defines it as well, even if the dependency is never imported.\r\n\r\nI ran into this issue when I had >1 no_std bin per crate, where one binary had a custom panic_impl and another used that from a dependency. Minimal reproduction:\r\n\r\n```sh\r\ncrate1 % tree\r\n.\r\n\u251c\u2500\u2500 Cargo.lock\r\n\u251c\u2500\u2500 Cargo.toml\r\n\u2514\u2500\u2500 src\r\n    \u2514\u2500\u2500 main.rs\r\n```\r\n\r\n```toml\r\n[package]\r\nname = \"crate1\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\n# this dependency adds `panic_impl`, but it is never imported or used\r\nflash-algorithm = \"0.3.0\"\r\n```\r\n\r\n```rs\r\n// main.rs\r\n#![no_std]\r\n#![no_main]\r\n\r\n#[panic_handler]\r\nfn panic(_: &core::panic::PanicInfo) -> ! {\r\n    loop {}\r\n}\r\n```\r\n\r\nThe following works:\r\n\r\n```sh\r\ncargo c --target thumbv7em-none-eabihf\r\ncargo build --target thumbv7em-none-eabihf\r\n```\r\n\r\nBut this fails (also when specifying target)\r\n\r\n```sh\r\n% cargo doc\r\n Documenting flash-algorithm v0.3.0\r\n Documenting crate1 v0.1.0 (/crate1)\r\nerror[E0152]: found duplicate lang item `panic_impl`\r\n --> src/main.rs:5:1\r\n  |\r\n5 | fn panic(_: &core::panic::PanicInfo) -> ! {\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: the lang item is first defined in crate `flash_algorithm`.\r\n  = note: first definition in `flash_algorithm` loaded from /crate1/target/debug/deps/libflash_algorithm-53fc8a5d1bd6046f.rmeta\r\n  = note: second definition in the local crate (`crate1`)\r\n\r\nFor more information about this error, try `rustc --explain E0152`.\r\nerror: could not document `crate1`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustdoc --edition=2021 --crate-type bin --crate-name crate1 src/main.rs -o /crate1/target/doc --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --diagnostic-width=147 --document-private-items '-Arustdoc::private-intra-doc-links' -C metadata=90e18e4cce856399 -L dependency=/crate1/target/debug/deps --extern flash_algorithm=/crate1/target/debug/deps/libflash_algorithm-53fc8a5d1bd6046f.rmeta --crate-version 0.1.0` (exit status: 1)\r\n```\r\n\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.69.0-nightly (1e225413a 2023-01-28)\r\nbinary: rustc\r\ncommit-hash: 1e225413a21fa69570bd3fefea9eb05e33f8b917\r\ncommit-date: 2023-01-28\r\nhost: x86_64-apple-darwin\r\nrelease: 1.69.0-nightly\r\nLLVM version: 15.0.7\r\n```\r\n\r\n@rustbot label +T-rustdoc", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107918/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107918/timeline", "performed_via_github_app": null, "state_reason": "completed"}