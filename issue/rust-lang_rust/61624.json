{"url": "https://api.github.com/repos/rust-lang/rust/issues/61624", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61624/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61624/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61624/events", "html_url": "https://github.com/rust-lang/rust/issues/61624", "id": 453607407, "node_id": "MDU6SXNzdWU0NTM2MDc0MDc=", "number": 61624, "title": "ICE using a type alias to a const generic struct across crates", "user": {"login": "carado", "id": 407034, "node_id": "MDQ6VXNlcjQwNzAzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/407034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carado", "html_url": "https://github.com/carado", "followers_url": "https://api.github.com/users/carado/followers", "following_url": "https://api.github.com/users/carado/following{/other_user}", "gists_url": "https://api.github.com/users/carado/gists{/gist_id}", "starred_url": "https://api.github.com/users/carado/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carado/subscriptions", "organizations_url": "https://api.github.com/users/carado/orgs", "repos_url": "https://api.github.com/users/carado/repos", "events_url": "https://api.github.com/users/carado/events{/privacy}", "received_events_url": "https://api.github.com/users/carado/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 13242248, "node_id": "MDU6TGFiZWwxMzI0MjI0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-metadata", "name": "A-metadata", "color": "f7e101", "default": false, "description": "Area: crate metadata"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1282665911, "node_id": "MDU6TGFiZWwxMjgyNjY1OTEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-generics", "name": "A-const-generics", "color": "f7e101", "default": false, "description": "Area: const generics (parameters and arguments)"}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1486687397, "node_id": "MDU6TGFiZWwxNDg2Njg3Mzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-const_generics", "name": "F-const_generics", "color": "f9c0cc", "default": false, "description": "`#![feature(const_generics)]`"}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2019-06-07T16:56:52Z", "updated_at": "2019-10-15T04:56:08Z", "closed_at": "2019-10-15T04:56:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "In a folder `a`, I have a blank library crate with the following `src/lib.rs`:\r\n```rust\r\n#![feature(const_generics)]\r\n\r\npub struct Struct<const N: usize>([u8; N]);\r\n\r\npub type Alias = Struct<2>;\r\n```\r\nIn a folder `b`, I have a blank binary crate with the follow `src/main.rs`:\r\n```rust\r\n// note: the error seems to be the same regardless of whether the following line is commented or not\r\n//#![feature(const_generics)]\r\n\r\nstruct Container(a::Alias);\r\n\r\nfn main() {}\r\n```\r\n`b`'s Cargo.toml uses crate `a` with the following line: \r\n```\r\n[dependencies]\r\na = { path = \"../a\", version = \"\" }\r\n```\r\nRunning `cargo check` or `cargo build` in `b` will produce the following ICE:\r\n```\r\n    Checking b v0.1.0 (/home/carado/tmp/rust7/b)\r\nerror: internal compiler error: src/librustc_metadata/decoder.rs:484: entry: id not found: DefIndex(18) in crate a with number 15\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:638:9\r\nstack backtrace:\r\n   0:     0x7f4371ffb19b - backtrace::backtrace::libunwind::trace::h034f17449c8f06d2\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/libunwind.rs:88\r\n   1:     0x7f4371ffb19b - backtrace::backtrace::trace_unsynchronized::h88fceba984274b2d\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/mod.rs:66\r\n   2:     0x7f4371ffb19b - std::sys_common::backtrace::_print::h113a7251db1bb0bb\r\n                               at src/libstd/sys_common/backtrace.rs:47\r\n   3:     0x7f4371ffb19b - std::sys_common::backtrace::print::he1709f3e64aa1331\r\n                               at src/libstd/sys_common/backtrace.rs:36\r\n   4:     0x7f4371ffb19b - std::panicking::default_hook::{{closure}}::h4c7c19a95acf509e\r\n                               at src/libstd/panicking.rs:198\r\n   5:     0x7f4371ffae9c - std::panicking::default_hook::haf2a960f108a3f30\r\n                               at src/libstd/panicking.rs:212\r\n   6:     0x7f436fd54dd1 - rustc::util::common::panic_hook::h96cf50c713bc84f6\r\n   7:     0x7f4371ffb9f9 - std::panicking::rust_panic_with_hook::h89241749267406d1\r\n                               at src/libstd/panicking.rs:479\r\n   8:     0x7f436e9a652d - std::panicking::begin_panic::h23f047602abbec1f\r\n   9:     0x7f436e9c661f - rustc_errors::Handler::bug::h1846692de954732d\r\n  10:     0x7f436f9ceac3 - rustc::util::bug::opt_span_bug_fmt::{{closure}}::h4eeb8977ea9f490d\r\n  11:     0x7f436f9ce09a - rustc::ty::context::tls::with_opt::{{closure}}::h4f8aad466ccd8399\r\n  12:     0x7f436f9cdfb5 - rustc::ty::context::tls::with_context_opt::h93eb33abb81e1499\r\n  13:     0x7f436f9ce047 - rustc::ty::context::tls::with_opt::h84f79a4206f98907\r\n  14:     0x7f436f9ce9d8 - rustc::util::bug::opt_span_bug_fmt::hcae1e85db26d61d1\r\n  15:     0x7f436f9ce942 - rustc::util::bug::bug_fmt::h0d9f8eae974cd447\r\n  16:     0x7f437048e53a - rustc_metadata::decoder::<impl rustc_metadata::cstore::CrateMetadata>::entry::hd6886155c7e8ad94\r\n  17:     0x7f437048f82c - rustc_metadata::decoder::<impl rustc_metadata::cstore::CrateMetadata>::get_type::he89c8116f2a9d946\r\n  18:     0x7f4370499601 - rustc_metadata::cstore_impl::provide_extern::type_of::h81daf21c535e688b\r\n  19:     0x7f436fce71cd - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::type_of>::compute::h6309e2152a5e3c65\r\n  20:     0x7f436f8b5517 - rustc::dep_graph::graph::DepGraph::with_task_impl::had7a0c15c5f1905b\r\n  21:     0x7f436fbb7456 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hb3169834330de254\r\n  22:     0x7f436f7cea4f - rustc::ty::instance::Instance::resolve::h72798ee26e58abe1\r\n  23:     0x7f436fd411bb - <rustc::traits::project::AssocTypeNormalizer as rustc::ty::fold::TypeFolder>::fold_const::hd5c5bcc5cc84d8c5\r\n  24:     0x7f436f956ffa - <smallvec::SmallVec<A> as core::iter::traits::collect::FromIterator<<A as smallvec::Array>::Item>>::from_iter::h56ca20c895cf1fe3\r\n  25:     0x7f436fa90fec - rustc::ty::fold::TypeFoldable::fold_with::h9620990ca94be452\r\n  26:     0x7f436faacdcd - rustc::ty::structural_impls::<impl rustc::ty::fold::TypeFoldable for &rustc::ty::TyS>::super_fold_with::h42aca40e5d6f720c\r\n  27:     0x7f436fd40b65 - <rustc::traits::project::AssocTypeNormalizer as rustc::ty::fold::TypeFolder>::fold_ty::h0000082e2319606a\r\n  28:     0x7f436cd1ed64 - rustc::traits::project::normalize::hbd56f85fc248fb4d\r\n  29:     0x7f436cb40590 - rustc_typeck::check::FnCtxt::normalize_associated_types_in::h8d3d18278d4fdeda\r\n  30:     0x7f436cd664b0 - <core::iter::adapters::Map<I,F> as core::iter::traits::iterator::Iterator>::fold::h7a0fbf29f0ae4dd7\r\n  31:     0x7f436ccb1f67 - rustc::ty::context::GlobalCtxt::enter_local::h05475195df7a61f1\r\n  32:     0x7f436cd92e9b - rustc_typeck::check::wfcheck::check_item_well_formed::hdb36490216ee054e\r\n  33:     0x7f436cb6165e - rustc::ty::query::__query_compute::check_item_well_formed::he41baf5c84b70167\r\n  34:     0x7f436cc2b7bd - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::check_item_well_formed>::compute::h7c840c44c057109d\r\n  35:     0x7f436cb966fb - rustc::dep_graph::graph::DepGraph::with_task_impl::h9a2f7b5bbc29bc70\r\n  36:     0x7f436cc876f0 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::ha95df13349dc610e\r\n  37:     0x7f436cd96967 - <rustc_typeck::check::wfcheck::CheckTypeWellFormedVisitor as rustc::hir::itemlikevisit::ParItemLikeVisitor>::visit_item::ha1c79ec81b0ae69c\r\n  38:     0x7f437200c8ea - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:85\r\n  39:     0x7f436cba2519 - rustc_data_structures::sync::par_for_each_in::he5330af9a7aa0673\r\n  40:     0x7f437200c8ea - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:85\r\n  41:     0x7f436cd59313 - rustc::hir::Crate::par_visit_all_item_likes::h7e35cc6980d7d055\r\n  42:     0x7f436cb64fcd - rustc::util::common::time::h7201fa0034b9369a\r\n  43:     0x7f436cd78a28 - rustc_typeck::check_crate::h2869f0da763831fb\r\n  44:     0x7f43719ceb45 - rustc_interface::passes::analysis::h3924fc0f51a4916f\r\n  45:     0x7f437235b576 - rustc::ty::query::__query_compute::analysis::hecebb52178cb72d8\r\n  46:     0x7f43722c5e02 - rustc::dep_graph::graph::DepGraph::with_task_impl::h13f978acfb884bfb\r\n  47:     0x7f43722bfe0d - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h41a19a7094d84ad5\r\n  48:     0x7f43722cfdc6 - rustc::ty::context::tls::enter_global::hde76617de84f513e\r\n  49:     0x7f43722ee377 - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h7e90e4645ca62211\r\n  50:     0x7f4371a2c4d5 - rustc_interface::passes::create_global_ctxt::{{closure}}::hd1ffcd24d8253592\r\n  51:     0x7f43722ef6ba - rustc_interface::interface::run_compiler_in_existing_thread_pool::hbb3327ac4471db7f\r\n  52:     0x7f4372361346 - std::thread::local::LocalKey<T>::with::h889b3604823f7d6d\r\n  53:     0x7f4372304e65 - scoped_tls::ScopedKey<T>::set::h04ec88caee9f9ad7\r\n  54:     0x7f437232cea4 - syntax::with_globals::h380e3542e6008820\r\n  55:     0x7f437234bd9d - std::sys_common::backtrace::__rust_begin_short_backtrace::h5f9f48a6f860c8d7\r\n  56:     0x7f437200c8ea - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:85\r\n  57:     0x7f43722d7f29 - core::ops::function::FnOnce::call_once{{vtable.shim}}::hc55a01470f319106\r\n  58:     0x7f4371fdeebf - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h3f73aebf71bfd2d8\r\n                               at /rustc/5eeb567a27eba18420a620ca7d0c007e29d8bc0c/src/liballoc/boxed.rs:746\r\n  59:     0x7f437200b5c0 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::hf5740d907353c675\r\n                               at /rustc/5eeb567a27eba18420a620ca7d0c007e29d8bc0c/src/liballoc/boxed.rs:746\r\n  60:     0x7f437200b5c0 - std::sys_common::thread::start_thread::h9d627f833866d0b2\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  61:     0x7f437200b5c0 - std::sys::unix::thread::Thread::new::thread_start::h6883c5e892c614cf\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  62:     0x7f4371f42fa8 - start_thread\r\n                               at /builddir/glibc-2.29/nptl/pthread_create.c:486\r\n  63:     0x7f4371e64a1f - __GI___clone\r\n  64:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [type_of] processing `a::Alias::{{constant}}#0`\r\n#1 [check_item_well_formed] processing `Container`\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.37.0-nightly (5eeb567a2 2019-06-06) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `b`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61624/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61624/timeline", "performed_via_github_app": null, "state_reason": "completed"}