{"url": "https://api.github.com/repos/rust-lang/rust/issues/103141", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103141/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103141/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103141/events", "html_url": "https://github.com/rust-lang/rust/issues/103141", "id": 1411194036, "node_id": "I_kwDOAAsO6M5UHRy0", "number": 103141, "title": "Rust update from 1.63 to 1.64 introduce lifetime problem on build", "user": {"login": "Aboussejra", "id": 70523950, "node_id": "MDQ6VXNlcjcwNTIzOTUw", "avatar_url": "https://avatars.githubusercontent.com/u/70523950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aboussejra", "html_url": "https://github.com/Aboussejra", "followers_url": "https://api.github.com/users/Aboussejra/followers", "following_url": "https://api.github.com/users/Aboussejra/following{/other_user}", "gists_url": "https://api.github.com/users/Aboussejra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aboussejra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aboussejra/subscriptions", "organizations_url": "https://api.github.com/users/Aboussejra/orgs", "repos_url": "https://api.github.com/users/Aboussejra/repos", "events_url": "https://api.github.com/users/Aboussejra/events{/privacy}", "received_events_url": "https://api.github.com/users/Aboussejra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1966877457, "node_id": "MDU6TGFiZWwxOTY2ODc3NDU3", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-critical", "name": "P-critical", "color": "eb6420", "default": false, "description": "Critical priority"}], "state": "closed", "locked": false, "assignee": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2022-10-17T09:07:48Z", "updated_at": "2022-11-10T15:57:00Z", "closed_at": "2022-11-10T15:57:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\n\r\nThis is an attempt to reproduce a minimal example of a regression problem (backwards compatibility not assured) from a closed-source company codebase.\r\n\r\nI tried this code: -> https://github.com/Aboussejra/rust_compiler_1.64_update_problem\r\n\r\n```rust\r\npub struct VecNumber<'s> {\r\n    pub vec_number: Vec<Number<'s>>,\r\n    pub auxiliary_object: &'s Vec<usize>,\r\n}\r\n\r\n#[derive(Clone)]\r\npub struct Number<'s> {\r\n    pub number: &'s usize,\r\n}\r\n\r\nimpl<'s> VecNumber<'s> {\r\n    pub fn vec_number_iterable_per_item_in_auxiliary_object(\r\n        &self,\r\n    ) -> impl Iterator<Item = (&'s usize, impl Iterator<Item = &Number<'s>> + Clone)> {\r\n        self.auxiliary_object.iter().map(move |n| {\r\n            let iter_number = self.vec_number.iter();\r\n            (n, iter_number)\r\n        })\r\n    }\r\n}\r\n```\r\n\r\nI expected to see the code building (This code is old and was building for years on rust 1.54, and builds on rust 1.63. the code works as intended in the proprietary codebase)\r\n\r\nInstead, this happened: \r\n\r\n```\r\nerror: lifetime may not live long enough\r\n  --> src/main.rs:15:9\r\n   |\r\n11 |   impl<'s> VecNumber<'s> {\r\n   |        -- lifetime `'s` defined here\r\n12 |       pub fn vec_number_iterable_per_item_in_auxiliary_object(\r\n13 |           &self,\r\n   |           - let's call the lifetime of this reference `'1`\r\n14 |       ) -> impl Iterator<Item = (&'s usize, impl Iterator<Item = &Number<'s>> + Clone)> {\r\n15 | /         self.auxiliary_object.iter().map(move |n| {\r\n16 | |             let iter_number = self.vec_number.iter();\r\n17 | |             (n, iter_number)\r\n18 | |         })\r\n   | |__________^ associated function was supposed to return data with lifetime `'s` but it is returning data with lifetime `'1`\r\n```\r\n\r\n\r\n### Version it worked on\r\n\r\nIt most recently worked on: 1.63 (from my repo, commit : 4c37cdc458abdecd0baf018500bbc0611bad568f)\r\n```\r\nrustc 1.63.0 (4b91a6ea7 2022-08-08)\r\nbinary: rustc\r\ncommit-hash: 4b91a6ea7258a947e59c6522cd5898e7c0a6a88f\r\ncommit-date: 2022-08-08\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.63.0\r\nLLVM version: 14.0.5\r\n```\r\n\r\n### Version with regression\r\n\r\nIt does not work anymore on version 1.64: (from my repo, commit : 2728a5acdb645f93ef223a0bc15dd3545fd82c51)\r\n\r\n```\r\nrustc 1.64.0 (a55dd71d5 2022-09-19)\r\nbinary: rustc\r\ncommit-hash: a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52\r\ncommit-date: 2022-09-19\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.64.0\r\nLLVM version: 14.0.6\r\n```\r\n\r\n### Backtrace\r\n\r\nIncluding the backtrace by setting `RUST_BACKTRACE=1` does not change anything to the error message.\r\n\r\nI do not know why this problem occured though.\r\n\r\n@rustbot modify labels: +regression-from-stable-to-{channel} -regression-untriaged\r\n-->\r\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103141/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103141/timeline", "performed_via_github_app": null, "state_reason": "completed"}