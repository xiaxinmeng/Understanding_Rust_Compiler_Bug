{"url": "https://api.github.com/repos/rust-lang/rust/issues/108933", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/108933/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/108933/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/108933/events", "html_url": "https://github.com/rust-lang/rust/issues/108933", "id": 1616856338, "node_id": "I_kwDOAAsO6M5gX0US", "number": 108933, "title": "Projections fail to unify projections in related obligations", "user": {"login": "AnthonyMikh", "id": 19252795, "node_id": "MDQ6VXNlcjE5MjUyNzk1", "avatar_url": "https://avatars.githubusercontent.com/u/19252795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnthonyMikh", "html_url": "https://github.com/AnthonyMikh", "followers_url": "https://api.github.com/users/AnthonyMikh/followers", "following_url": "https://api.github.com/users/AnthonyMikh/following{/other_user}", "gists_url": "https://api.github.com/users/AnthonyMikh/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnthonyMikh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnthonyMikh/subscriptions", "organizations_url": "https://api.github.com/users/AnthonyMikh/orgs", "repos_url": "https://api.github.com/users/AnthonyMikh/repos", "events_url": "https://api.github.com/users/AnthonyMikh/events{/privacy}", "received_events_url": "https://api.github.com/users/AnthonyMikh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 149689562, "node_id": "MDU6TGFiZWwxNDk2ODk1NjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-associated-items", "name": "A-associated-items", "color": "f7e101", "default": false, "description": "Area: Associated items such as associated types and consts."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 5260993605, "node_id": "LA_kwDOAAsO6M8AAAABOZRkRQ", "url": "https://api.github.com/repos/rust-lang/rust/labels/fixed-by-next-solver", "name": "fixed-by-next-solver", "color": "93CE7D", "default": false, "description": "Fixed by the next-generation trait solver, `-Ztrait-solver=next`"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-03-09T10:05:21Z", "updated_at": "2023-04-05T17:25:33Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I tried [this code](https://play.rust-lang.org/?code=trait%20Add%3CRhs%3E%20%7B%0A%20%20%20%20type%20Sum%3B%0A%7D%0A%0Aimpl%20Add%3C%28%29%3E%20for%20%28%29%20%7B%0A%20%20%20%20type%20Sum%20%3D%20%28%29%3B%0A%7D%0A%0Atype%20Unit%20%3D%20%3C%28%29%20as%20Add%3C%28%29%3E%3E%3A%3ASum%3B%0A%0Atrait%20Trait%3CC%3E%20%7B%0A%20%20%20%20type%20Output%3B%0A%7D%0A%0Afn%20f%3CT%3E%28%29%0Awhere%0A%20%20%20%20T%3A%20Trait%3C%28%29%3E%2C%0A%20%20%20%20%3CT%20as%20Trait%3C%28%29%3E%3E%3A%3AOutput%3A%20Sized%2C%0A%7B%7D%0A%0Afn%20g%3CT%3E%28%29%0Awhere%0A%20%20%20%20T%3A%20Trait%3CUnit%3E%2C%0A%20%20%20%20%3CT%20as%20Trait%3C%28%29%3E%3E%3A%3AOutput%3A%20Sized%2C%0A%7B%7D%0A%0Afn%20h%3CT%3E%28%29%0Awhere%0A%20%20%20%20T%3A%20Trait%3C%28%29%3E%2C%0A%20%20%20%20%3CT%20as%20Trait%3CUnit%3E%3E%3A%3AOutput%3A%20Sized%2C%0A%7B%7D):\r\n\r\n```rust\r\ntrait Add<Rhs> {\r\n    type Sum;\r\n}\r\n\r\nimpl Add<()> for () {\r\n    type Sum = ();\r\n}\r\n\r\ntype Unit = <() as Add<()>>::Sum;\r\n\r\ntrait Trait<C> {\r\n    type Output;\r\n}\r\n\r\nfn f<T>()\r\nwhere\r\n    T: Trait<()>,\r\n    <T as Trait<()>>::Output: Sized,\r\n{}\r\n\r\nfn g<T>()\r\nwhere\r\n    T: Trait<Unit>,\r\n    <T as Trait<()>>::Output: Sized,\r\n{}\r\n\r\nfn h<T>()\r\nwhere\r\n    T: Trait<()>,\r\n    <T as Trait<Unit>>::Output: Sized,\r\n{}\r\n```\r\n\r\nFunction `g` is `f` with `()` replaced with `Unit` in first where clause, while function `h` is `f` with `()` replaced with `Unit` in second where clause. Since `Unit` is effectively a type alias for `()`, I expected all three functions to compile.\r\n\r\nInstead, the compiler complains about `g`:\r\n\r\n```\r\nerror[E0277]: the trait bound `T: Trait<()>` is not satisfied\r\n  --> src/lib.rs:25:1\r\n   |\r\n25 | / fn g<T>()\r\n26 | | where\r\n27 | |     T: Trait<Unit>,\r\n28 | |     <T as Trait<()>>::Output: Sized,\r\n   | |____________________________________^ the trait `Trait<()>` is not implemented for `T`\r\n   |\r\nhelp: consider further restricting this bound\r\n   |\r\n27 |     T: Trait<Unit> + Trait<()>,\r\n   |                    +++++++++++\r\n\r\nerror[E0277]: the trait bound `T: Trait<()>` is not satisfied\r\n  --> src/lib.rs:25:4\r\n   |\r\n25 | fn g<T>()\r\n   |    ^ the trait `Trait<()>` is not implemented for `T`\r\n   |\r\nhelp: consider further restricting this bound\r\n   |\r\n27 |     T: Trait<Unit> + Trait<()>,\r\n   |                    +++++++++++\r\n```\r\n\r\nThe compiler suggests adding `Trait<()>` on `T`, which should not be necessary since `Trait<Unit>` has exactly the same meaning as `Trait<()>` (and it actually works that way for `h`). Having `Unit` type alias is not essential, inlining it yields the same error.\r\n\r\n(Also it complains about the same unsatisfied bound twice, but it is less of an issue, I guess)\r\n\r\n### Meta\r\n\r\nI used the latest stable at the moment, 1.67.1, but it can also be reproduced on the latest beta (`2023-03-06 b955c8271da80a1af8a1`) and latest nigthly (`2023-03-06 b955c8271da80a1af8a1`) at the moment.\r\n\r\nProbably related to #43049.\r\n\r\n@rustbot label: +A-associated-items", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/108933/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/108933/timeline", "performed_via_github_app": null, "state_reason": null}