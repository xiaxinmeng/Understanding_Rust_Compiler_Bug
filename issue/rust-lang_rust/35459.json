{"url": "https://api.github.com/repos/rust-lang/rust/issues/35459", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/35459/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/35459/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/35459/events", "html_url": "https://github.com/rust-lang/rust/issues/35459", "id": 169796945, "node_id": "MDU6SXNzdWUxNjk3OTY5NDU=", "number": 35459, "title": "[question: python extension] how can I write extension(FFI) library to python3 with Rust", "user": {"login": "cdluminate", "id": 5723047, "node_id": "MDQ6VXNlcjU3MjMwNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/5723047?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cdluminate", "html_url": "https://github.com/cdluminate", "followers_url": "https://api.github.com/users/cdluminate/followers", "following_url": "https://api.github.com/users/cdluminate/following{/other_user}", "gists_url": "https://api.github.com/users/cdluminate/gists{/gist_id}", "starred_url": "https://api.github.com/users/cdluminate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cdluminate/subscriptions", "organizations_url": "https://api.github.com/users/cdluminate/orgs", "repos_url": "https://api.github.com/users/cdluminate/repos", "events_url": "https://api.github.com/users/cdluminate/events{/privacy}", "received_events_url": "https://api.github.com/users/cdluminate/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-08-07T13:43:49Z", "updated_at": "2016-08-08T00:05:26Z", "closed_at": "2016-08-08T00:05:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm still learning rust and I'd like to try writing extension in rust for python.\nI succeed with some hacks, but that makes me more confused.\n\nI wrote this code:\n\n```\npub fn kernel (s: &'static str) -> i32 {  // [1]\n  println!(\"arg string [{}] len [{}]\", s, s.len());\n  42\n}\n```\n\nI compiled it with\n\n```\n$ rustc --crate-type dylib x.rs\n```\n\nthen I found the kernel function entrace point with binutil\n\n```\n$ nm libx.so | ack kernel\n0000000000383108 d _ZN1x6kernel15__STATIC_FMTSTR17h8dbf7ea278fab1c2E\n00000000000b4020 T _ZN1x6kernel17h696f1b75bfc331c3E\n```\n\nafter that I wrote such an python3 script\n\n```\n$ cat confuse.py \nimport ctypes\nx = ctypes.CDLL('./libx.so')\nmsg = \"Hello Rust Library\".encode(\"UTF-8\")\n#print(x._ZN1x6kernel17h696f1b75bfc331c3E(msg)) # segfault\nprint(x._ZN1x6kernel17h696f1b75bfc331c3E(msg, len(msg))) // [2]\n```\n\nand it works\n\n```\n$ python3 confuse.py \narg string [Hello Rust Library] len [18]\n42\n```\n\nAccording to mark `//[1]` from the rust code we know the kernel function definition is `kernel(string)` instead of `kernel(string, string_size)`, but what actually works is the later.\n\nMy question is:  \n1. How hacky is it to call Rust library function with FFI/CFFI ?  \n2. What's the recommended way to write extension library in rust for python? I searched but found nearly nothing... Is it to use crate `libc` ? (e.g. https://github.com/dgrunwald/rust-cpython/blob/master/python3-sys/examples/version.rs)\n", "closed_by": {"login": "Aatch", "id": 342416, "node_id": "MDQ6VXNlcjM0MjQxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aatch", "html_url": "https://github.com/Aatch", "followers_url": "https://api.github.com/users/Aatch/followers", "following_url": "https://api.github.com/users/Aatch/following{/other_user}", "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions", "organizations_url": "https://api.github.com/users/Aatch/orgs", "repos_url": "https://api.github.com/users/Aatch/repos", "events_url": "https://api.github.com/users/Aatch/events{/privacy}", "received_events_url": "https://api.github.com/users/Aatch/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/35459/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/35459/timeline", "performed_via_github_app": null, "state_reason": "completed"}