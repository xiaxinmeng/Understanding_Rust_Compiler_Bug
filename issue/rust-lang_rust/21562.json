{"url": "https://api.github.com/repos/rust-lang/rust/issues/21562", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21562/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21562/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21562/events", "html_url": "https://github.com/rust-lang/rust/issues/21562", "id": 55321220, "node_id": "MDU6SXNzdWU1NTMyMTIyMA==", "number": 21562, "title": "ICE: unimplemented const autoref AutoUnsafe(...", "user": {"login": "goertzenator", "id": 605072, "node_id": "MDQ6VXNlcjYwNTA3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/605072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goertzenator", "html_url": "https://github.com/goertzenator", "followers_url": "https://api.github.com/users/goertzenator/followers", "following_url": "https://api.github.com/users/goertzenator/following{/other_user}", "gists_url": "https://api.github.com/users/goertzenator/gists{/gist_id}", "starred_url": "https://api.github.com/users/goertzenator/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goertzenator/subscriptions", "organizations_url": "https://api.github.com/users/goertzenator/orgs", "repos_url": "https://api.github.com/users/goertzenator/repos", "events_url": "https://api.github.com/users/goertzenator/events{/privacy}", "received_events_url": "https://api.github.com/users/goertzenator/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-01-23T19:23:23Z", "updated_at": "2015-05-07T15:25:15Z", "closed_at": "2015-05-07T15:25:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "I get the ICE below when I compile this fragment of code:\n\n``` rust\nstatic FUNCS: [ErlNifFunc; 1] = [\n    ErlNifFunc{ name:     \"native_add\\0\",\n                arity:    2,\n                function: native_add,\n                flags:    0,\n              }\n];\n\n#[no_mangle]\npub extern \"C\" fn nif_init() -> *const ErlNifEntry {\n    static ENTRY: ErlNifEntry = ErlNifEntry{\n        major : NIF_MAJOR_VERSION,\n        minor : NIF_MINOR_VERSION,\n        name : \"rustnif\\0\",\n        num_of_funcs : 1,\n        funcs : &FUNCS,     <-------- ICE here\n        load :    None,\n        reload :  None,\n        upgrade : None,\n        unload :  None,\n        vm_variant : \"beam.vanilla\\0\",\n        options: 0,\n    };\n\n    &ENTRY\n}\n```\n\nThe above structs are defined here: https://github.com/goertzenator/rustertest/blob/995b9f2cf484cd753e2818adb95ec8ad5370456c/src/lib.rs\n\nThe above fragment is part of https://github.com/goertzenator/rustertest/tree/995b9f2cf484cd753e2818adb95ec8ad5370456c\n\nThat crate depends on https://github.com/goertzenator/ruster/tree/e1bf38e30f1bcf2caf17080ed57b7cdc70ff182f\n\nAnd _that_ crate requires erlang-17.4 to be installed.\n\n```\n$ RUST_BACKTRACE=1 cargo build --verbose \n   Compiling ruster v0.0.1 (file:///home/goertzen/rustertest)\n     Running `rustc ../ruster/build.rs --crate-name build-script-build --crate-type bin -C prefer-dynamic -g --out-dir /home/goertzen/rustertest/target/build/ruster-5d949bf2a9438c3e --emit=dep-info,link -L dependency=/home/goertzen/rustertest/target/deps -L dependency=/home/goertzen/rustertest/target/deps`\n../ruster/build.rs:14:22: 14:32 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:14   let dst = Path::new(os::getenv(\"OUT_DIR\").unwrap());\n                                            ^~~~~~~~~~\n../ruster/build.rs:14:12: 14:21 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:14   let dst = Path::new(os::getenv(\"OUT_DIR\").unwrap());\n                                  ^~~~~~~~~\n../ruster/build.rs:15:52: 15:60 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:15   Command::new(escript).arg(\"gen_api.erl\").arg(dst).status().unwrap();\n                                                                          ^~~~~~~~\n../ruster/build.rs:15:43: 15:51 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:15   Command::new(escript).arg(\"gen_api.erl\").arg(dst).status().unwrap();\n                                                                 ^~~~~~~~\n../ruster/build.rs:15:24: 15:42 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:15   Command::new(escript).arg(\"gen_api.erl\").arg(dst).status().unwrap();\n                                              ^~~~~~~~~~~~~~~~~~\n../ruster/build.rs:15:2: 15:14 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/build.rs:15   Command::new(escript).arg(\"gen_api.erl\").arg(dst).status().unwrap();\n                        ^~~~~~~~~~~~\n     Running `/home/goertzen/rustertest/target/build/ruster-5d949bf2a9438c3e/build-script-build`\n     Running `rustc ../ruster/src/lib.rs --crate-name ruster --crate-type lib -g -C metadata=5d949bf2a9438c3e -C extra-filename=-5d949bf2a9438c3e --out-dir /home/goertzen/rustertest/target/deps --emit=dep-info,link -L dependency=/home/goertzen/rustertest/target/deps -L dependency=/home/goertzen/rustertest/target/deps`\n../ruster/src/lib.rs:4:1: 4:19 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/src/lib.rs:4 extern crate libc;\n                       ^~~~~~~~~~~~~~~~~~\n../ruster/src/lib.rs:5:1: 5:19 warning: use of unstable item, #[warn(unstable)] on by default\n../ruster/src/lib.rs:5 extern crate core;\n                       ^~~~~~~~~~~~~~~~~~\n../ruster/src/raw.rs:48:13: 48:17 warning: use of unstable item: will be overhauled with new lifetime rules; see RFC 458, #[warn(unstable)] on by default\n../ruster/src/raw.rs:48 unsafe impl Sync for ErlNifFunc {}\n                                    ^~~~\n../ruster/src/raw.rs:69:13: 69:17 warning: use of unstable item: will be overhauled with new lifetime rules; see RFC 458, #[warn(unstable)] on by default\n../ruster/src/raw.rs:69 unsafe impl Sync for ErlNifEntry {}\n                                    ^~~~\n   Compiling rustertest v0.0.1 (file:///home/goertzen/rustertest)\n     Running `rustc src/lib.rs --crate-name rustertest --crate-type dylib -g -C metadata=4f82dbe309ba1762 -C extra-filename=-4f82dbe309ba1762 --out-dir /home/goertzen/rustertest/target --emit=dep-info,link -L dependency=/home/goertzen/rustertest/target -L dependency=/home/goertzen/rustertest/target/deps --extern ruster=/home/goertzen/rustertest/target/deps/libruster-5d949bf2a9438c3e.rlib`\nsrc/lib.rs:2:1: 2:19 warning: use of unstable item, #[warn(unstable)] on by default\nsrc/lib.rs:2 extern crate core;\n             ^~~~~~~~~~~~~~~~~~\nsrc/lib.rs:6:5: 6:23 warning: unused import, #[warn(unused_imports)] on by default\nsrc/lib.rs:6 use core::marker::Sync;\n                 ^~~~~~~~~~~~~~~~~~\nsrc/lib.rs:95:11: 95:17 error: internal compiler error: unimplemented const autoref AutoUnsafe(MutImmutable, Some(Box(AutoUnsize(UnsizeLength(1u)))))\nsrc/lib.rs:95           funcs : &FUNCS,\n                                ^~~~~~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:123\n\nstack backtrace:\n   1:     0x7fe039c2b000 - sys::backtrace::write::h7e8ba1fc274cc36epRt\n   2:     0x7fe039c4c9e0 - failure::on_fail::h823798930ebe140a64z\n   3:     0x7fe039bbb7b0 - rt::unwind::begin_unwind_inner::ha4a8df6010104da6ZJz\n   4:     0x7fe034825330 - rt::unwind::begin_unwind::h2017061421562134061\n   5:     0x7fe0348252c0 - diagnostic::SpanHandler::span_bug::h26a451e055cae458CYF\n   6:     0x7fe037d10810 - session::Session::span_bug::h64d8052083ced862Ebr\n   7:     0x7fe038c787e0 - trans::consts::const_expr::h94628210c8390bc6T3n\n   8:     0x7fe038c7fd80 - trans::consts::const_expr_unadjusted::unboxed_closure.43028\n   9:     0x7fe038c7fb90 - vec::Vec<T>.FromIterator<T>::from_iter::h7269795553161279336\n  10:     0x7fe038c7fa80 - trans::consts::const_expr_unadjusted::unboxed_closure.43026\n  11:     0x7fe038c7a580 - trans::consts::const_expr_unadjusted::h129554d528e2e7e9Meo\n  12:     0x7fe038c787e0 - trans::consts::const_expr::h94628210c8390bc6T3n\n  13:     0x7fe038bb3480 - trans::base::get_item_val::hd9784892acf07040s3u\n  14:     0x7fe038c2a480 - trans::expr::trans_def::h982a9743604bd027RIi\n  15:     0x7fe038c11910 - trans::expr::trans_unadjusted::hb6ffa8ee55ffe7847ji\n  16:     0x7fe038bcb3d0 - trans::expr::trans::hde666e6a090eadc0xCh\n  17:     0x7fe038c2d770 - trans::expr::trans_addr_of::h957baa9beeb8dce62Kj\n  18:     0x7fe038c11910 - trans::expr::trans_unadjusted::hb6ffa8ee55ffe7847ji\n  19:     0x7fe038bcb3d0 - trans::expr::trans::hde666e6a090eadc0xCh\n  20:     0x7fe038bca1e0 - trans::expr::trans_into::h1a40b70708c7d89d3yh\n  21:     0x7fe038bca7e0 - trans::controlflow::trans_block::h28afa8af906ef58bQ3d\n  22:     0x7fe038c94c80 - trans::base::trans_closure::h9a0d2c21a0e18266U0t\n  23:     0x7fe038bb5dd0 - trans::base::trans_fn::hc26bd010ed3bb393zbu\n  24:     0x7fe038bc68e0 - trans::foreign::trans_rust_fn_with_foreign_abi::h3754480a372f8380UlC\n  25:     0x7fe038bb11f0 - trans::base::trans_item::h1e3916042030bab0Uyu\n  26:     0x7fe038c9bf20 - trans::base::trans_crate::h035c45eac4628807Buv\n  27:     0x7fe03a18ab60 - driver::phase_4_translate_to_llvm::h1b361a483c335af2YMa\n  28:     0x7fe03a16ad70 - driver::compile_input::h8ec974b2bd4afe59Aba\n  29:     0x7fe03a22c4d0 - run_compiler::h0e495a7c10e57aaae5b\n  30:     0x7fe03a22ac40 - thunk::F.Invoke<A, R>::invoke::h12226774702741163622\n  31:     0x7fe03a229ba0 - rt::unwind::try::try_fn::h67848939709837360\n  32:     0x7fe039cb3b90 - rust_try_inner\n  33:     0x7fe039cb3b80 - rust_try\n  34:     0x7fe03a229e50 - thunk::F.Invoke<A, R>::invoke::h15720675569063176780\n  35:     0x7fe039c3a680 - sys::thread::thread_start::h2ac456e96ea03cedcJw\n  36:     0x7fe03403f0c0 - start_thread\n  37:     0x7fe03985bf89 - __clone\n  38:                0x0 - <unknown>\n\nCould not compile `rustertest`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/lib.rs --crate-name rustertest --crate-type dylib -g -C metadata=4f82dbe309ba1762 -C extra-filename=-4f82dbe309ba1762 --out-dir /home/goertzen/rustertest/target --emit=dep-info,link -L dependency=/home/goertzen/rustertest/target -L dependency=/home/goertzen/rustertest/target/deps --extern ruster=/home/goertzen/rustertest/target/deps/libruster-5d949bf2a9438c3e.rlib` (status=101)\n\n$ uname -a\nLinux ubuntu64 3.13.0-40-generic #69-Ubuntu SMP Thu Nov 13 17:53:56 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n\n$ rustc --version\nrustc 1.0.0-nightly (8903c21d6 2015-01-15 22:42:58 +0000)\n\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21562/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21562/timeline", "performed_via_github_app": null, "state_reason": "completed"}