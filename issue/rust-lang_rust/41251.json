{"url": "https://api.github.com/repos/rust-lang/rust/issues/41251", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/41251/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/41251/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/41251/events", "html_url": "https://github.com/rust-lang/rust/issues/41251", "id": 221319497, "node_id": "MDU6SXNzdWUyMjEzMTk0OTc=", "number": 41251, "title": "[incremental] remove unnecessary passes", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 419557634, "node_id": "MDU6TGFiZWw0MTk1NTc2MzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-medium", "name": "E-medium", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Medium / intermediate"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2017-04-12T16:29:18Z", "updated_at": "2017-04-21T16:40:36Z", "closed_at": "2017-04-21T16:40:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a sub-issue of #40746. The follow list of tasks are all executed for side-effects. I believe they can all be straight-up **removed** (that is, we just don't create a task at all). The idea is to remove the call to `with_task` or `in_task` as well as the associated  `DepNode` variant and see what happens -- if you get assertion failures, it may mean that they are writing to shared state, in which case we'll want to keep the task and refactor it in some other way. \r\n\r\nAn example PR is https://github.com/rust-lang/rust/pull/41063. See e.g. [the first commit](https://github.com/rust-lang/rust/pull/41063/commits/768e7078785dd418968f26d79b1ff323403999ef) which removed the `CheckLoops` stuff.\r\n\r\n- [x] `src/librustc_passes/loops.rs:53:    let _task = map.dep_graph.in_task(DepNode::CheckLoops);`\r\n- [x] `src/librustc_passes/static_recursion.rs:91:    let _task = hir_map.dep_graph.in_task(DepNode::CheckStaticRecursion);` \r\n- [x] `src/librustc_borrowck/borrowck/mod.rs:64:    tcx.dep_graph.with_task(DepNode::BorrowCheckKrate, tcx, (), check_crate_task);`\r\n- [x] `src/librustc/middle/effect.rs:244:    let _task = tcx.dep_graph.in_task(DepNode::EffectCheck);`\r\n- [x] `src/librustc/middle/liveness.rs:199:    let _task = tcx.dep_graph.in_task(DepNode::Liveness);`\r\n- [x] `src/librustc_typeck/check_unused.rs:65:    let _task = tcx.dep_graph.in_task(DepNode::UnusedTraitCheck);`\r\n- [x] `src/librustc/middle/dead.rs:597:    let _task = tcx.dep_graph.in_task(DepNode::DeadCheck);`\r\n     - this would use the `AccessLevels` query described elsewhere\r\n- [x] `src/librustc_typeck/coherence/mod.rs:135:    let _task = tcx.dep_graph.in_task(DepNode::Coherence);`\r\n- [x] `src/librustc_typeck/coherence/overlap.rs:42:        tcx.dep_graph.in_task(DepNode::CoherenceOverlapCheck(trait_def_id));`\r\n- [x] `src/librustc_typeck/collect.rs:171:        self.tcx.dep_graph.with_task(DepNode::CollectItemSig(def_id), self.tcx, id, op);`\r\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/41251/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/41251/timeline", "performed_via_github_app": null, "state_reason": "completed"}