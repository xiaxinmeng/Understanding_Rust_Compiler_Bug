{"url": "https://api.github.com/repos/rust-lang/rust/issues/35422", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/35422/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/35422/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/35422/events", "html_url": "https://github.com/rust-lang/rust/issues/35422", "id": 169750127, "node_id": "MDU6SXNzdWUxNjk3NTAxMjc=", "number": 35422, "title": "ICE: 'index out of bounds: the len is 0 but the index is 478'", "user": {"login": "phil-opp", "id": 1131315, "node_id": "MDQ6VXNlcjExMzEzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1131315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phil-opp", "html_url": "https://github.com/phil-opp", "followers_url": "https://api.github.com/users/phil-opp/followers", "following_url": "https://api.github.com/users/phil-opp/following{/other_user}", "gists_url": "https://api.github.com/users/phil-opp/gists{/gist_id}", "starred_url": "https://api.github.com/users/phil-opp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phil-opp/subscriptions", "organizations_url": "https://api.github.com/users/phil-opp/orgs", "repos_url": "https://api.github.com/users/phil-opp/repos", "events_url": "https://api.github.com/users/phil-opp/events{/privacy}", "received_events_url": "https://api.github.com/users/phil-opp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-08-06T14:59:42Z", "updated_at": "2017-05-15T00:01:50Z", "closed_at": "2017-05-15T00:01:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I get the following ICE when I try to compile faulty inline assembly:\n\n```\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\n\nnote: run with `RUST_BACKTRACE=1` for a backtrace\n\nthread 'rustc' panicked at 'index out of bounds: the len is 0 but the index is 478', ../src/libcollections/vec.rs:1265\nstack backtrace:\n   1:     0x7f094034f85d - std::sys::backtrace::tracing::imp::write::h29f5fdb9fc0a7395\n   2:     0x7f09403605b1 - std::panicking::default_hook::_{{closure}}::h2cc84f0378700526\n   3:     0x7f094035ea8f - std::panicking::default_hook::hbbe7fa36a995aca0\n   4:     0x7f094035f1fa - std::panicking::rust_panic_with_hook::h105c3d42fcd2fb5e\n   5:     0x7f094035f0b2 - std::panicking::begin_panic::hbf62ea4a5ff3f9de\n   6:     0x7f094035efe0 - std::panicking::begin_panic_fmt::h20f5943904e5791d\n   7:     0x7f094035ef61 - rust_begin_unwind\n   8:     0x7f09403ca76c - core::panicking::panic_fmt::h19323e466869c656\n   9:     0x7f09403ca713 - core::panicking::panic_bounds_check::ha883fe1527ce6884\n  10:     0x7f0938586999 - syntax::parse::token::InternedString::new_from_name::hcb1855d97bd504d3\n  11:     0x7f09384565e7 - _<syntax..ast..Name as core..fmt..Display>::fmt::h40efdc852eb5e792\n  12:     0x7f09403d6517 - core::fmt::write::h955c581c22098b7a\n  13:     0x7f0940368340 - collections::fmt::format::h7ce9e885e67335e3\n  14:     0x7f0938489349 - syntax::codemap::CodeMap::macro_backtrace::hf57d3986470bee83\n  15:     0x7f093848967e - _<syntax..codemap..CodeMap as rustc_errors..CodeMapper>::macro_backtrace::h078d230910a860e7\n  16:     0x7f0938187725 - rustc_errors::emitter::EmitterWriter::render_macro_backtrace_old_school::h9f96ffbaa1ad3024\n  17:     0x7f0938184997 - rustc_errors::emitter::EmitterWriter::emit_message_default::hee6b169a58199b13\n  18:     0x7f093817e9bd - _<rustc_errors..emitter..EmitterWriter as rustc_errors..emitter..Emitter>::emit::hb6bf465c9fd02120\n  19:     0x7f0938190108 - rustc_errors::Handler::emit::h3ea04463a0a06d86\n  20:     0x7f093f228bec - rustc::session::Session::span_err::h612784f93ea5f9a1\n  21:     0x7f093f265355 - rustc_trans::back::write::report_inline_asm::h1f77ab7503333593\n  22:     0x7f093f265453 - rustc_trans::back::write::inline_asm_handler::hd6faec2821c52425\n  23:     0x7f093aa93f46 - _ZN12_GLOBAL__N_19AsmParser11DiagHandlerERKN4llvm12SMDiagnosticEPv\n  24:     0x7f093acf2ccd - _ZNK4llvm9SourceMgr12PrintMessageERNS_11raw_ostreamENS_5SMLocENS0_8DiagKindERKNS_5TwineENS_8ArrayRefINS_7SMRangeEEENS8_INS_7SMFixItEEEb\n  25:     0x7f093acf2e8b - _ZNK4llvm9SourceMgr12PrintMessageENS_5SMLocENS0_8DiagKindERKNS_5TwineENS_8ArrayRefINS_7SMRangeEEENS6_INS_7SMFixItEEEb\n  26:     0x7f093aa89b1e - _ZN12_GLOBAL__N_19AsmParser5ErrorEN4llvm5SMLocERKNS1_5TwineENS1_8ArrayRefINS1_7SMRangeEEE\n  27:     0x7f0939e14951 - _ZN12_GLOBAL__N_112X86AsmParser26MatchAndEmitATTInstructionEN4llvm5SMLocERjRNS1_15SmallVectorImplISt10unique_ptrINS1_18MCParsedAsmOperandESt14default_deleteIS6_EEEERNS1_10MCStreamerERmb\n  28:     0x7f093aaa028a - _ZN12_GLOBAL__N_19AsmParser14parseStatementERNS_18ParseStatementInfoEPN4llvm23MCAsmParserSemaCallbackE\n  29:     0x7f093aaa11ee - _ZN12_GLOBAL__N_19AsmParser3RunEbb\n  30:     0x7f093a1b9694 - _ZNK4llvm10AsmPrinter13EmitInlineAsmENS_9StringRefERKNS_15MCSubtargetInfoERKNS_15MCTargetOptionsEPKNS_6MDNodeENS_9InlineAsm10AsmDialectE\n  31:     0x7f093a1b9e93 - _ZNK4llvm10AsmPrinter13EmitInlineAsmEPKNS_12MachineInstrE\n  32:     0x7f093a1b6972 - _ZN4llvm10AsmPrinter16EmitFunctionBodyEv\n  33:     0x7f0939e1fccd - _ZN4llvm13X86AsmPrinter20runOnMachineFunctionERNS_15MachineFunctionE\n  34:     0x7f093a36c3ca - _ZN4llvm19MachineFunctionPass13runOnFunctionERNS_8FunctionE\n  35:     0x7f093ac48766 - _ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE\n  36:     0x7f093ac487aa - _ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE\n  37:     0x7f093ac4a37e - _ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE\n  38:     0x7f09396edfa5 - LLVMRustWriteOutputFile\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/rustllvm/PassWrapper.cpp:430\n  39:     0x7f093f263e83 - rustc_trans::back::write::write_output_file::h20a888cdcf5e64a6\n  40:     0x7f093f368069 - rustc_trans::back::write::optimize_and_codegen::_{{closure}}::h2f71df715612ebcd\n  41:     0x7f093f26c5fe - rustc_trans::back::write::execute_work_item::ha5e725090b02026b\n  42:     0x7f093f26668f - rustc_trans::back::write::run_passes::h45c122dc65dd4c1d\n  43:     0x7f09408e7bbf - rustc_driver::driver::phase_5_run_llvm_passes::h44a6e789f001637f\n  44:     0x7f09408ce94f - rustc_driver::driver::compile_input::hb4cc34cf85dc1edf\n  45:     0x7f09408f9e82 - rustc_driver::run_compiler::h50f95674bd902ab5\n  46:     0x7f09408458fd - std::panicking::try::call::h4577500a5284c6ff\n  47:     0x7f094036ea56 - __rust_maybe_catch_panic\n  48:     0x7f094085d351 - _<F as alloc..boxed..FnBox<A>>::call_box::h24f3eb0b42327962\n  49:     0x7f094035cd72 - std::sys::thread::Thread::new::thread_start::h8f3bd45211e9f5ea\n  50:     0x7f093786f6f9 - start_thread\n  51:     0x7f093ff9fb5c - clone\n  52:                0x0 - <unknown>\n```\n\n```\n> rustc --version\nrustc 1.12.0-nightly (b30eff7ba 2016-08-05)\n```\n\nI could not find a minimal example yet.\n\nThe biggest problem is that no inline assembly error is shown. Just the above ICE.\n\nOlder nightlies (e.g. `rustc 1.12.0-nightly (b6c1ef374 2016-07-14)`) do it better. They throw the same ICE, but they also output an inline assembly error:\n\n```\nerror: <inline asm>:1:2: error: unknown use of instruction mnemonic without a size suffix\n        add rsp, 8; iretq\n        ^\n\n  --> src/interrupts/mod.rs:83:17\n   |>\n83 |>                 asm!(\"add rsp, 8; iretq\");\n   |>                 ^^^^^^^^^^^^^^^^^^^^^^^^^^\n```\n\n(Using intel syntax without specifying the `intel` option.)\n\nThis error message is completely missing in newer nighlties.\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/35422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/35422/timeline", "performed_via_github_app": null, "state_reason": "completed"}