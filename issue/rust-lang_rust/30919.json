{"url": "https://api.github.com/repos/rust-lang/rust/issues/30919", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30919/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30919/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30919/events", "html_url": "https://github.com/rust-lang/rust/issues/30919", "id": 126751012, "node_id": "MDU6SXNzdWUxMjY3NTEwMTI=", "number": 30919, "title": "[rand] Program segfaults, jemalloc worst hit", "user": {"login": "MagaTailor", "id": 12054457, "node_id": "MDQ6VXNlcjEyMDU0NDU3", "avatar_url": "https://avatars.githubusercontent.com/u/12054457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MagaTailor", "html_url": "https://github.com/MagaTailor", "followers_url": "https://api.github.com/users/MagaTailor/followers", "following_url": "https://api.github.com/users/MagaTailor/following{/other_user}", "gists_url": "https://api.github.com/users/MagaTailor/gists{/gist_id}", "starred_url": "https://api.github.com/users/MagaTailor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MagaTailor/subscriptions", "organizations_url": "https://api.github.com/users/MagaTailor/orgs", "repos_url": "https://api.github.com/users/MagaTailor/repos", "events_url": "https://api.github.com/users/MagaTailor/events{/privacy}", "received_events_url": "https://api.github.com/users/MagaTailor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-01-14T21:23:20Z", "updated_at": "2016-02-08T22:50:44Z", "closed_at": "2016-01-21T17:00:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "The crash happens on ARM Linux, solely with a binary from a `jemalloc` enabled rustc. I normally use rustc builds that rely on pure system allocation so I had no idea the problem was there.\n\n`$ gdb --args target/debug/bfc sample_programs/hello_world.bf`\n\n``` rust\nProgram received signal SIGSEGV, Segmentation fault.\n0x7f6a3778 in rand::cell::Cell<T>::get (self=0x1) at ../src/libcore/cell.rs:195\n195     ../src/libcore/cell.rs: No such file or directory.\n(gdb) bt\n#0  0x7f6a3778 in rand::cell::Cell<T>::get (self=0x1) at ../src/libcore/cell.rs:195\n#1  0x7f6a3750 in rand::rc::RcBoxPtr::strong<alloc::rc::Rc<core::cell::RefCell<rand::reseeding::ReseedingRng<rand::StdRng, rand::ThreadRngReseeder>>>> (self=0xb6ff87d8)\n    at ../src/liballoc/rc.rs:875\n#2  0x7f6a34d8 in rand::rc::RcBoxPtr::inc_strong<alloc::rc::Rc<core::cell::RefCell<rand::reseeding::ReseedingRng<rand::StdRng, rand::ThreadRngReseeder>>>> (self=0xb6ff87d8)\n    at ../src/liballoc/rc.rs:880\n#3  0x7f6a3460 in rand::rc::Rc<T>.Clone::clone (self=0xb6ff87d8) at ../src/liballoc/rc.rs:491\n#4  0x7f6a3a84 in fnfn (t=0xb6ff87d8) at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/rand-0.3.11/src/lib.rs:873\n#5  0x7f6a3894 in rand::thread::local::LocalKey<T>::with<closure,alloc::rc::Rc<core::cell::RefCell<rand::reseeding::ReseedingRng<rand::StdRng, rand::ThreadRngReseeder>>>> (\n    self=0x804a68fc <thread_rng::THREAD_RNG_KEY::h9f347077ce08d3aapgf>, f=...) at ../src/libstd/thread/local.rs:191\n#6  0x7f6a37bc in rand::thread_rng () at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/rand-0.3.11/src/lib.rs:873\n#7  0x7f69a678 in tempfile::util::tmpname () at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/tempfile-1.1.3/src/util.rs:7\n#8  0x7f69e830 in tempfile::named::NamedTempFile::new_in<&std::path::PathBuf> (dir=0xbeffe034)\n    at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/tempfile-1.1.3/src/named.rs:120\n#9  0x7f69e71c in tempfile::named::NamedTempFile::new () at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/tempfile-1.1.3/src/named.rs:114\n#10 0x7f6264d0 in bfc::compile_file (matches=0xbeffeae8) at src/main.rs:210\n#11 0x7f6315e4 in bfc::main () at src/main.rs:276\n#12 0x7f6c5d8c in sys_common::unwind::try::try_fn::h15347629866114009016 ()\n#13 0x7f6c2ab0 in __rust_try ()\n#14 0x7f6c58f8 in rt::lang_start::hc182d4243c0ca773kmy ()\n#15 0x7f63f20c in main () at /home/odroid/.cargo/registry/src/github.com-48ad6e4054423464/getopts-0.2.14/src/lib.rs:583\n```\n\nTo make sure it wasn't just me, I've used `rustc 1.7.0-dev (dedaebd5a 2016-01-12)` from [RustBuild](https://github.com/warricksothr/RustBuild) this time but I'd managed to hit the bug [earlier](https://github.com/rust-lang/rust/issues/30178#issuecomment-168845756), mistaking it for problems with `-flto` in gcc (**repeat:** there's no crash with `alloc_system`)\n", "closed_by": {"login": "MagaTailor", "id": 12054457, "node_id": "MDQ6VXNlcjEyMDU0NDU3", "avatar_url": "https://avatars.githubusercontent.com/u/12054457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MagaTailor", "html_url": "https://github.com/MagaTailor", "followers_url": "https://api.github.com/users/MagaTailor/followers", "following_url": "https://api.github.com/users/MagaTailor/following{/other_user}", "gists_url": "https://api.github.com/users/MagaTailor/gists{/gist_id}", "starred_url": "https://api.github.com/users/MagaTailor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MagaTailor/subscriptions", "organizations_url": "https://api.github.com/users/MagaTailor/orgs", "repos_url": "https://api.github.com/users/MagaTailor/repos", "events_url": "https://api.github.com/users/MagaTailor/events{/privacy}", "received_events_url": "https://api.github.com/users/MagaTailor/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30919/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30919/timeline", "performed_via_github_app": null, "state_reason": "completed"}