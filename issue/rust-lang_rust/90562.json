{"url": "https://api.github.com/repos/rust-lang/rust/issues/90562", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90562/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90562/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90562/events", "html_url": "https://github.com/rust-lang/rust/issues/90562", "id": 1044706335, "node_id": "I_kwDOAAsO6M4-RPQf", "number": 90562, "title": "Build system fails when wrappers for bootstrap binaries are used", "user": {"login": "paulmenzel", "id": 9318792, "node_id": "MDQ6VXNlcjkzMTg3OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/9318792?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulmenzel", "html_url": "https://github.com/paulmenzel", "followers_url": "https://api.github.com/users/paulmenzel/followers", "following_url": "https://api.github.com/users/paulmenzel/following{/other_user}", "gists_url": "https://api.github.com/users/paulmenzel/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulmenzel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulmenzel/subscriptions", "organizations_url": "https://api.github.com/users/paulmenzel/orgs", "repos_url": "https://api.github.com/users/paulmenzel/repos", "events_url": "https://api.github.com/users/paulmenzel/events{/privacy}", "received_events_url": "https://api.github.com/users/paulmenzel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2021-11-04T12:21:28Z", "updated_at": "2021-11-04T14:28:12Z", "closed_at": "2021-11-04T13:38:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "When building Rust 1.56.1, specifying our own bootstrap binaries, which are wrappers, in the configuration\r\n\r\n    [build]\r\n    cargo = \"/usr/local/package/bin/cargo\"\r\n    rustc = \"/usr/local/package/bin/rustc\"\r\n    rustfmt = \"/usr/local/package/bin/rustfmt\"\r\n\r\nthey are not detected:\r\n\r\n```\r\n$ python3 ./x.py build --exclude src/tools/miri\r\ninfo: looks like you are running this command under `sudo`\r\n      and so in order to preserve your $HOME this will now\r\n      use vendored sources by default.\r\nerror: process didn't exit successfully: `/usr/local/package/bin/rustc -vV` (exit code: 1)\r\n--- stderr\r\n/usr/local/package/bin/rustc : rustc not found\r\n\r\nfailed to run: /usr/local/package/bin/cargo build --manifest-path /pkg/rustc-1.56.1-0/build/rustc-1.56.1-src/src/bootstrap/Cargo.toml --frozen\r\n```\r\n\r\nBut the wrappers work:\r\n\r\n    $ /usr/local/package/bin/rustc --version\r\n    rustc 1.52.1\r\n    $ /usr/local/package/bin/cargo --version\r\n    cargo 1.52.0\r\n    $ more /usr/local/package/bin/rustc\r\n    #! /bin/bash\r\n    cmd=$(basename \"$0\")\r\n    if [ -n \"$PWRAP_rust\" ]; then\r\n      echo \"$0 : $cmd not found\" >&2;\r\n      exit 1\r\n    fi\r\n    . /usr/local/package/lib/rust.profile\r\n    export PWRAP_rust=1\r\n    if ! /usr/sbin/hostconfig 'mxqd' ;then\r\n      rcmd=$(/usr/bin/readlink -f $(/usr/bin/which \"$cmd\"))\r\n      user=$(/usr/bin/id -nu)\r\n      /usr/bin/logger --server log.molgen.mpg.de -t usrlocalpkg \"rust.profile ${cmd} (${rcmd}) ${user}@${HOSTNAME} mx64\"\r\n    fi\r\n    exec \"$cmd\" \"$@\"", "closed_by": {"login": "paulmenzel", "id": 9318792, "node_id": "MDQ6VXNlcjkzMTg3OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/9318792?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulmenzel", "html_url": "https://github.com/paulmenzel", "followers_url": "https://api.github.com/users/paulmenzel/followers", "following_url": "https://api.github.com/users/paulmenzel/following{/other_user}", "gists_url": "https://api.github.com/users/paulmenzel/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulmenzel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulmenzel/subscriptions", "organizations_url": "https://api.github.com/users/paulmenzel/orgs", "repos_url": "https://api.github.com/users/paulmenzel/repos", "events_url": "https://api.github.com/users/paulmenzel/events{/privacy}", "received_events_url": "https://api.github.com/users/paulmenzel/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90562/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90562/timeline", "performed_via_github_app": null, "state_reason": "completed"}