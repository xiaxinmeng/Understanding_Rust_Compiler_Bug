{"url": "https://api.github.com/repos/rust-lang/rust/issues/25700", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25700/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25700/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25700/events", "html_url": "https://github.com/rust-lang/rust/issues/25700", "id": 79392835, "node_id": "MDU6SXNzdWU3OTM5MjgzNQ==", "number": 25700, "title": "ICE: projection error while selecting?", "user": {"login": "Marwes", "id": 957312, "node_id": "MDQ6VXNlcjk1NzMxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/957312?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Marwes", "html_url": "https://github.com/Marwes", "followers_url": "https://api.github.com/users/Marwes/followers", "following_url": "https://api.github.com/users/Marwes/following{/other_user}", "gists_url": "https://api.github.com/users/Marwes/gists{/gist_id}", "starred_url": "https://api.github.com/users/Marwes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Marwes/subscriptions", "organizations_url": "https://api.github.com/users/Marwes/orgs", "repos_url": "https://api.github.com/users/Marwes/repos", "events_url": "https://api.github.com/users/Marwes/events{/privacy}", "received_events_url": "https://api.github.com/users/Marwes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-05-22T10:17:12Z", "updated_at": "2015-06-18T23:28:45Z", "closed_at": "2015-06-18T23:28:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Got an ICE when compiling some code using parser-combinators, unfortunately I am not sure I can decouple the code from using the library so I uploaded a github repo with the file and cargo dependency needed [here](https://github.com/Marwes/projection-error). Just run it with `cargo build` and it should ICE.\n\n``` rust\nextern crate parser_combinators;\n\nuse std::marker::PhantomData;\n\ntrait AstId { type Untyped: Clone; }\n\nimpl AstId for String { type Untyped = String; }\n\npub fn parse_module() {\n    use parser_combinators::primitives::State;\n    use parser_combinators::*;\n\n    struct ParserEnv<Id> {\n        _marker: PhantomData<fn (String) -> Id>\n    }\n\n    impl <Id> ParserEnv<Id>\n        where Id: AstId {\n        fn ident(&self) -> Id::Untyped {\n            panic!()\n        }\n\n        fn record_type(&self, input: State<&'static str>) -> ParseResult<Vec<(Id::Untyped, Id::Untyped)>, &'static str> {\n            many::<Vec<_>, _>(value(self.ident())\n                .and(value(self.ident()))//Remove this line and fix replace the tuple in the return type with Id::Untyped for another ICE\n                .map(|x| x)//Remove this call to map and it compiles\n                ).parse_state(input)\n        }\n    }\n\n    let env: ParserEnv<String> = ParserEnv {\n        _marker: PhantomData\n    };\n    parser(|i| env.record_type(i));\n}\n```\n\n```\nsrc\\lib.rs:1:1: 1:1 error: internal compiler error: projection error while selecting?\nsrc\\lib.rs:1 extern crate parser_combinators;\n             ^\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', C:/bot/slave/nightly-dist-rustc-win-64/build/src/libsyntax\\diagnostic.rs:176\n\nstack backtrace:\n   1:         0x63cb8722 - sys::backtrace::write::h17240dc0eaceafe7Rgs\n   2:         0x63cc1b96 - rt::unwind::register::hf97832460d72cd16gOv\n   3:         0x63c85390 - rt::unwind::begin_unwind_inner::hcf167426fb12ee63qLv\n   4:         0x6e3c9f09 - diagnostic::SpanHandler::span_bug::hff33238cf6a98a20u6B\n   5:         0x6e3c9eaf - diagnostic::SpanHandler::span_bug::hff33238cf6a98a20u6B\n   6:         0x6d4022e2 - session::Session::span_bug::h067231b8894ea4e01nr\n   7:         0x6d6db057 - middle::traits::evaluate_builtin_bound::hadd7218901ef36aacMV\n   8:         0x6d6feebf - middle::ty::closure_upvars::h88bda868b374aa76MK8\n   9:         0x6d5900a5 - middle::ty::type_is_sized::h4fc04eb191053d6fAS5\n  10:         0x6abbe207 - trans::context::CrateContext<'b, 'tcx>::sess::h47ba7f6b66031d03EJt\n  11:         0x6abd59f8 - trans::context::CrateContext<'b, 'tcx>::get_intrinsic::h06903648e28e2397lKt\n  12:         0x6acd54fa - trans::_match::ReassignmentChecker.euv..Delegate<'tcx>::mutate::hc923a533a27d041b5qI\n  13:         0x6abd45e7 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::needs_invoke::h867326256dc0c0ab0xp\n  14:         0x6abe397d - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::push_custom_cleanup_scope_with_debug_loc::h65206fced3061d72K2o\n  15:         0x6abe2073 - trans::datum::Rvalue.KindOps::post_store::h62afad44cee1556apFv\n  16:         0x6abe4234 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::pop_and_trans_custom_cleanup_scope::h4e8777762ff791d0yap\n  17:         0x6ac23851 - trans::context::CrateContext<'b, 'tcx>::fn_pointer_shims::h6740281c1906aee88Nt\n  18:         0x6ac13bcf - trans::datum::Expr.KindOps::is_by_ref::he67898a485dd01554Hv\n  19:         0x6ac28db5 - trans::debuginfo::ast..Expr.ToDebugLoc::debug_loc::h2b8f89cc044a8ffalGz\n  20:         0x6ac25d1c - trans::debuginfo::ast..Expr.ToDebugLoc::debug_loc::h2b8f89cc044a8ffalGz\n  21:         0x6ac85402 - trans::expr::Dest...std..clone..Clone::clone::h2d8a6879a209d263z9z\n  22:         0x6ac5cf95 - trans::context::CrateContext<'b, 'tcx>::check_drop_flag_for_sanity::h93f0f1f9855d31d6CYt\n  23:         0x6abe3c30 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::push_custom_cleanup_scope_with_debug_loc::h65206fced3061d72K2o\n  24:         0x6abe2073 - trans::datum::Rvalue.KindOps::post_store::h62afad44cee1556apFv\n  25:         0x6abe4234 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::pop_and_trans_custom_cleanup_scope::h4e8777762ff791d0yap\n  26:         0x6ac23851 - trans::context::CrateContext<'b, 'tcx>::fn_pointer_shims::h6740281c1906aee88Nt\n  27:         0x6ac13bcf - trans::datum::Expr.KindOps::is_by_ref::he67898a485dd01554Hv\n  28:         0x6ac12533 - trans::datum::Expr.KindOps::is_by_ref::he67898a485dd01554Hv\n  29:         0x6ac2763e - trans::debuginfo::ast..Expr.ToDebugLoc::debug_loc::h2b8f89cc044a8ffalGz\n  30:         0x6ac25d1c - trans::debuginfo::ast..Expr.ToDebugLoc::debug_loc::h2b8f89cc044a8ffalGz\n  31:         0x6ac85402 - trans::expr::Dest...std..clone..Clone::clone::h2d8a6879a209d263z9z\n  32:         0x6ac5cf95 - trans::context::CrateContext<'b, 'tcx>::check_drop_flag_for_sanity::h93f0f1f9855d31d6CYt\n  33:         0x6abe3c30 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::push_custom_cleanup_scope_with_debug_loc::h65206fced3061d72K2o\n  34:         0x6abe2073 - trans::datum::Rvalue.KindOps::post_store::h62afad44cee1556apFv\n  35:         0x6ac30671 - trans::context::CrateContext<'b, 'tcx>::closure_vals::hf48aea36c2fc6b90aVt\n  36:         0x6ac8630c - trans::expr::Dest...std..clone..Clone::clone::h2d8a6879a209d263z9z\n  37:         0x6ac84713 - trans::expr::Dest...std..clone..Clone::clone::h2d8a6879a209d263z9z\n  38:         0x6abc58e5 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::pop_custom_cleanup_scope::h70d9afa64f76b22fG8o\n  39:         0x6ac1fe7f - trans::context::CrateContext<'b, 'tcx>::fn_pointer_shims::h6740281c1906aee88Nt\n  40:         0x6ac25286 - trans::common::ExprOrMethodCall...std..cmp..PartialEq::ne::hc61d8507405d927clds\n  41:         0x6ac8626a - trans::expr::Dest...std..clone..Clone::clone::h2d8a6879a209d263z9z\n  42:         0x6ac5cf95 - trans::context::CrateContext<'b, 'tcx>::check_drop_flag_for_sanity::h93f0f1f9855d31d6CYt\n  43:         0x6ac5cb28 - trans::context::CrateContext<'b, 'tcx>::check_drop_flag_for_sanity::h93f0f1f9855d31d6CYt\n  44:         0x6abe3952 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::push_custom_cleanup_scope_with_debug_loc::h65206fced3061d72K2o\n  45:         0x6abe2073 - trans::datum::Rvalue.KindOps::post_store::h62afad44cee1556apFv\n  46:         0x6abe4234 - trans::cleanup::FunctionContext<'blk, 'tcx>.CleanupMethods<'blk, 'tcx>::pop_and_trans_custom_cleanup_scope::h4e8777762ff791d0yap\n  47:         0x6abe6b99 - trans::base::TransItemVisitor<'a, 'tcx>.Visitor<'v>::visit_item::h0ea287790196486dCbi\n  48:         0x6abf4816 - trans::base::trans_crate::h467a88bab46e74c484i\n  49:         0x6fca8ce6 - driver::phase_4_translate_to_llvm::hac244219d972fac5nOa\n  50:         0x6fc82d31 - driver::compile_input::h8ffd252a42277d1cQba\n  51:         0x6fd352e3 - run_compiler::h7a90a6d5e81af66175b\n  52:         0x6fd32e6f - run::h27aab490c2c97a88N5b\n  53:         0x6fd32429 - run::h27aab490c2c97a88N5b\n  54:         0x63cfb2dc - rust_try\n  55:         0x63cfb2b9 - rust_try\n  56:         0x6fd326a5 - run::h27aab490c2c97a88N5b\n  57:         0x63cbfe54 - sys::process::Command::cwd::h8d65332726b1cb469uu\n  58:         0x776559cd - BaseThreadInitThunk\n\nCould not compile `rust-error`.\n\nTo learn more, run the command again with --verbose.\n```\n\nVersions:\ncargo 0.2.0-nightly (ac61996 2015-05-17) (built 2015-05-18)\n\nrustc 1.2.0-nightly (0cc99f9cc 2015-05-17) (built 2015-05-18)\nbinary: rustc\ncommit-hash: 0cc99f9cc9b59518f618a2c3f5011000e60f922e\ncommit-date: 2015-05-17\nbuild-date: 2015-05-18\nhost: x86_64-pc-windows-gnu\nrelease: 1.2.0-nightly\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25700/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25700/timeline", "performed_via_github_app": null, "state_reason": "completed"}