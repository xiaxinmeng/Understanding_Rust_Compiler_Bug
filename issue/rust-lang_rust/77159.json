{"url": "https://api.github.com/repos/rust-lang/rust/issues/77159", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77159/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77159/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77159/events", "html_url": "https://github.com/rust-lang/rust/issues/77159", "id": 708363506, "node_id": "MDU6SXNzdWU3MDgzNjM1MDY=", "number": 77159, "title": "Adding Op<&T> bound breaks code depending on Op<T> bound", "user": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-09-24T17:54:41Z", "updated_at": "2020-10-09T22:02:31Z", "closed_at": "2020-10-09T22:02:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this code:\r\n\r\n```rust\r\ntrait Op<Arg> { \r\n    fn op (_: Arg); \r\n}\r\n\r\ntrait Trait<'lt>: 'lt + Sized + Op<Self> + Op<&'lt Self> {}\r\n\r\ntrait WithAssoc<'lt> { type Assoc: Trait<'lt>; }\r\n\r\nfn test<'lt, T: WithAssoc<'lt>> (it: T::Assoc) {\r\n    <T::Assoc as Op<_>>::op(it)\r\n}\r\n```\r\n\r\nI expected to see this happen: code compiles\r\n\r\nInstead, this happened: code doesn't compile with the following error:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n  --> src/lib.rs:10:29\r\n   |\r\n10 |     <T::Assoc as Op<_>>::op(it)\r\n   |                             ^^ expected reference, found associated type\r\n   |\r\n   = note:    expected reference `&'lt <T as WithAssoc<'lt>>::Assoc`\r\n           found associated type `<T as WithAssoc<'lt>>::Assoc`\r\nhelp: consider constraining the associated type `<T as WithAssoc<'lt>>::Assoc` to `&'lt <T as WithAssoc<'lt>>::Assoc`\r\n   |\r\n9  | fn test<'lt, T: WithAssoc<'lt, Assoc = &'lt <T as WithAssoc<'lt>>::Assoc>> (it: T::Assoc) {\r\n   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\nhelp: consider borrowing here\r\n   |\r\n10 |     <T::Assoc as Op<_>>::op(&it)\r\n   |                             ^^^\r\n```\r\n\r\n1) `T::Assoc` should implement `Op<T::Assoc>` so the error shouldn't happen\r\n2) Compiler suggests using `T: WithAssoc<'lt, Assoc = &'lt <T as WithAssoc<'lt>>::Assoc>` which is reccursion\r\n3) The code works if\r\n   1. you'll remove `+ Op<&'lt Self>`\r\n   2. you'll use op with explicit type `<T::Assoc as Op<T::Assoc>>::op(it)`\r\n4) There is a weird spacing between `= note:` and `expected reference ...` though this is unrelated to the problem\r\n   \r\nPlayground: [[link]](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=59c0e7831b439a5f6d13eedf73912c18)\r\n\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\ntested on `1.46.0` and `1.48.0-nightly` (2020-09-23 8b4085359ae798dedb05)\r\n", "closed_by": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77159/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77159/timeline", "performed_via_github_app": null, "state_reason": "completed"}