{"url": "https://api.github.com/repos/rust-lang/rust/issues/5885", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/5885/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/5885/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/5885/events", "html_url": "https://github.com/rust-lang/rust/issues/5885", "id": 13196834, "node_id": "MDU6SXNzdWUxMzE5NjgzNA==", "number": 5885, "title": "glibc double-free crash", "user": {"login": "robn", "id": 130670, "node_id": "MDQ6VXNlcjEzMDY3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/130670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robn", "html_url": "https://github.com/robn", "followers_url": "https://api.github.com/users/robn/followers", "following_url": "https://api.github.com/users/robn/following{/other_user}", "gists_url": "https://api.github.com/users/robn/gists{/gist_id}", "starred_url": "https://api.github.com/users/robn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robn/subscriptions", "organizations_url": "https://api.github.com/users/robn/orgs", "repos_url": "https://api.github.com/users/robn/repos", "events_url": "https://api.github.com/users/robn/events{/privacy}", "received_events_url": "https://api.github.com/users/robn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-04-15T12:18:16Z", "updated_at": "2013-06-07T00:17:24Z", "closed_at": "2013-06-07T00:17:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "I don't know how to describe what the problem is, but here's a test case:\n\n``` rust\nfn main() { \n    let s = \"a b c d e f g\";\n    let mut split = ~[];\n    str::each_split_char_nonempty(s, ' ', |bit| {\n        split.push(str::from_slice(bit));\n        true\n    });\n\n    match vec::shift(&mut split) {\n        x => io::println(fmt!(\"first bit: %s\", x)),\n    }\n}\n```\n\n```\nrobn@pyro:~$ rustc -v\nrustc 0.6\nhost: x86_64-unknown-linux-gnu\nrobn@pyro:~$ rustc -o test test.rs\n```\n\nOn run, we get:\n\n```\nrobn@pyro:~$ ./test \nfirst bit: a\n*** glibc detected *** ./test: double free or corruption (fasttop): 0x0000000000822d80 ***\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x76d76)[0x7f28a44f8d76]\n/lib/x86_64-linux-gnu/libc.so.6(cfree+0x6c)[0x7f28a44fdaac]\n/home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so(+0x2c6c9)[0x7f28a531c6c9]\n/home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so(upcall_call_shim_on_c_stack+0x9c)[0x7f28a530d47c]\n/home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN8unstable14exchange_alloc4free16_339db5318526f133_06E+0x53)[0x7f28a5676553]\n./test[0x401a4d]\n./test[0x4019cf]\n./test[0x401790]\n./test[0x404fa0]\n./test(_rust_main+0x2e)[0x4017ee]\n/home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f28a530c474]\n======= Memory map: ========\n00400000-00407000 r-xp 00000000 08:01 2114174                            /home/robn/test\n00606000-00607000 rw-p 00006000 08:01 2114174                            /home/robn/test\n0081e000-0083f000 rw-p 00000000 00:00 0                                  [heap]\n7f289c000000-7f289c021000 rw-p 00000000 00:00 0 \n7f289c021000-7f28a0000000 ---p 00000000 00:00 0 \n7f28a3f76000-7f28a417b000 rw-p 00000000 00:00 0                          [stack:22298]\n7f28a417b000-7f28a4263000 r-xp 00000000 08:01 12756139                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17\n7f28a4263000-7f28a4463000 ---p 000e8000 08:01 12756139                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17\n7f28a4463000-7f28a446b000 r--p 000e8000 08:01 12756139                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17\n7f28a446b000-7f28a446d000 rw-p 000f0000 08:01 12756139                   /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.17\n7f28a446d000-7f28a4482000 rw-p 00000000 00:00 0 \n7f28a4482000-7f28a4602000 r-xp 00000000 08:01 7604731                    /lib/x86_64-linux-gnu/libc-2.13.so\n7f28a4602000-7f28a4802000 ---p 00180000 08:01 7604731                    /lib/x86_64-linux-gnu/libc-2.13.so\n7f28a4802000-7f28a4806000 r--p 00180000 08:01 7604731                    /lib/x86_64-linux-gnu/libc-2.13.so\n7f28a4806000-7f28a4807000 rw-p 00184000 08:01 7604731                    /lib/x86_64-linux-gnu/libc-2.13.so\n7f28a4807000-7f28a480c000 rw-p 00000000 00:00 0 \n7f28a480c000-7f28a4821000 r-xp 00000000 08:01 7604730                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f28a4821000-7f28a4a21000 ---p 00015000 08:01 7604730                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f28a4a21000-7f28a4a22000 rw-p 00015000 08:01 7604730                    /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f28a4a22000-7f28a4aa3000 r-xp 00000000 08:01 7604726                    /lib/x86_64-linux-gnu/libm-2.13.so\n7f28a4aa3000-7f28a4ca2000 ---p 00081000 08:01 7604726                    /lib/x86_64-linux-gnu/libm-2.13.so\n7f28a4ca2000-7f28a4ca3000 r--p 00080000 08:01 7604726                    /lib/x86_64-linux-gnu/libm-2.13.so\n7f28a4ca3000-7f28a4ca4000 rw-p 00081000 08:01 7604726                    /lib/x86_64-linux-gnu/libm-2.13.so\n7f28a4ca4000-7f28a4ca6000 r-xp 00000000 08:01 7604722                    /lib/x86_64-linux-gnu/libdl-2.13.so\n7f28a4ca6000-7f28a4ea6000 ---p 00002000 08:01 7604722                    /lib/x86_64-linux-gnu/libdl-2.13.so\n7f28a4ea6000-7f28a4ea7000 r--p 00002000 08:01 7604722                    /lib/x86_64-linux-gnu/libdl-2.13.so\n7f28a4ea7000-7f28a4ea8000 rw-p 00003000 08:01 7604722                    /lib/x86_64-linux-gnu/libdl-2.13.so\n7f28a4ea8000-7f28a4ebf000 r-xp 00000000 08:01 7604693                    /lib/x86_64-linux-gnu/libpthread-2.13.so\n7f28a4ebf000-7f28a50be000 ---p 00017000 08:01 7604693                    /lib/x86_64-linux-gnu/libpthread-2.13.so\n7f28a50be000-7f28a50bf000 r--p 00016000 08:01 7604693                    /lib/x86_64-linux-gnu/libpthread-2.13.so\n7f28a50bf000-7f28a50c0000 rw-p 00017000 08:01 7604693                    /lib/x86_64-linux-gnu/libpthread-2.13.so\n7f28a50c0000-7f28a50c4000 rw-p 00000000 00:00 0 \n7f28a50c4000-7f28a50cb000 r-xp 00000000 08:01 7604724                    /lib/x86_64-linux-gnu/librt-2.13.so\n7f28a50cb000-7f28a52ca000 ---p 00007000 08:01 7604724                    /lib/x86_64-linux-gnu/librt-2.13.so\n7f28a52ca000-7f28a52cb000 r--p 00006000 08:01 7604724                    /lib/x86_64-linux-gnu/librt-2.13.so\n7f28a52cb000-7f28a52cc000 rw-p 00007000 08:01 7604724                    /lib/x86_64-linux-gnu/librt-2.13.so\n7f28a52d2000-7f28a52d3000 ---p 00000000 00:00 0 \n7f28a52d3000-7f28a52d7000 rw-p 00000000 00:00 0                          [stack:22299]\n7f28a52d7000-7f28a52d8000 ---p 00000000 00:00 0 \n7f28a52d8000-7f28a52f0000 rw-p 00000000 00:00 0 \n7f28a52f0000-7f28a534c000 r-xp 00000000 08:01 5380389                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so\n7f28a534c000-7f28a554b000 ---p 0005c000 08:01 5380389                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so\n7f28a554b000-7f28a554d000 rw-p 0005b000 08:01 5380389                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so\n7f28a554d000-7f28a56dd000 r-xp 00000000 08:01 5380390                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.6.so\n7f28a56dd000-7f28a58dc000 ---p 00190000 08:01 5380390                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.6.so\n7f28a58dc000-7f28a5a58000 rw-p 0018f000 08:01 5380390                    /home/robn/bin/rust/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.6.so\n7f28a5a58000-7f28a5a78000 r-xp 00000000 08:01 7604737                    /lib/x86_64-linux-gnu/ld-2.13.so\n7f28a5c72000-7f28a5c77000 rw-p 00000000 00:00 0 \n7f28a5c77000-7f28a5c78000 r--p 0001f000 08:01 7604737                    /lib/x86_64-linux-gnu/ld-2.13.so\n7f28a5c78000-7f28a5c79000 rw-p 00020000 08:01 7604737                    /lib/x86_64-linux-gnu/ld-2.13.so\n7f28a5c79000-7f28a5c7a000 rw-p 00000000 00:00 0 \n7fff5d48d000-7fff5d604000 rw-p 00000000 00:00 0                          [stack]\n7fff5d70c000-7fff5d70d000 r-xp 00000000 00:00 0                          [vdso]\nffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]\nAborted\n```\n", "closed_by": {"login": "Aatch", "id": 342416, "node_id": "MDQ6VXNlcjM0MjQxNg==", "avatar_url": "https://avatars.githubusercontent.com/u/342416?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aatch", "html_url": "https://github.com/Aatch", "followers_url": "https://api.github.com/users/Aatch/followers", "following_url": "https://api.github.com/users/Aatch/following{/other_user}", "gists_url": "https://api.github.com/users/Aatch/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aatch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aatch/subscriptions", "organizations_url": "https://api.github.com/users/Aatch/orgs", "repos_url": "https://api.github.com/users/Aatch/repos", "events_url": "https://api.github.com/users/Aatch/events{/privacy}", "received_events_url": "https://api.github.com/users/Aatch/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/5885/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/5885/timeline", "performed_via_github_app": null, "state_reason": "completed"}