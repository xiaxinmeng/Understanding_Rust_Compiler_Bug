{"url": "https://api.github.com/repos/rust-lang/rust/issues/25828", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25828/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25828/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25828/events", "html_url": "https://github.com/rust-lang/rust/issues/25828", "id": 81539591, "node_id": "MDU6SXNzdWU4MTUzOTU5MQ==", "number": 25828, "title": "I may have found a bug in rustc", "user": {"login": "delehef", "id": 1153808, "node_id": "MDQ6VXNlcjExNTM4MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1153808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/delehef", "html_url": "https://github.com/delehef", "followers_url": "https://api.github.com/users/delehef/followers", "following_url": "https://api.github.com/users/delehef/following{/other_user}", "gists_url": "https://api.github.com/users/delehef/gists{/gist_id}", "starred_url": "https://api.github.com/users/delehef/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/delehef/subscriptions", "organizations_url": "https://api.github.com/users/delehef/orgs", "repos_url": "https://api.github.com/users/delehef/repos", "events_url": "https://api.github.com/users/delehef/events{/privacy}", "received_events_url": "https://api.github.com/users/delehef/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-05-27T17:19:03Z", "updated_at": "2015-05-27T17:52:46Z", "closed_at": "2015-05-27T17:52:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm playing with parallelism, and rustc gave me this error:\n\n```\nerror: internal compiler error: coherence failed to report ambiguity: cannot locate the impl of the trait `core::marker::Send` for the type `[closure src/main.rs:106:28: 109:10]`\n```\n\nAs I'm not yet really experienced with rust, I'm not really sure it's the compiler fault, but I suppose false positives are better than hidden positives :)\n\nIf I may help you by providing any informations, please do not hesitate to ask.\n\nI tried this code:\n\n```\nstruct ExtendedHSPs {\n    query_pos: i64,\n    bank_pos: i64,\n    extension: i32,\n    score: i32,\n}\n\n[...]\n    let NB_CPU: usize = 4;\n    let total_size: usize = query_candidates.len();\n    let slice_size: usize = total_size/NB_CPU;\n    let (tx, rx) = mpsc::channel();\n\n    for cpu in 0..NB_CPU {\n        let bottom = cpu*slice_size;\n        let top = if cpu+1 == NB_CPU {total_size} else {(cpu+1)*slice_size};\n\n        let my_tx = tx.clone();\n        thread::spawn(move || {\n            let mut my_HSPs = Vec::new();\n            my_tx.send(my_HSPs);\n        });\n    }\n\n    drop(tx);\n    let HSPs: Vec<_> = rx.iter().collect();\n[...]\n```\n## Meta\n\n`rustc --version --verbose`: \n\n```\nrustc 1.1.0-nightly (e5394240a 2015-05-14) (built 2015-05-14)\nbinary: rustc\ncommit-hash: e5394240a295650b567aa406b4a0e1e3a6749a5f\ncommit-date: 2015-05-14\nbuild-date: 2015-05-14\nhost: x86_64-unknown-linux-gnu // <-- Archlinux here\nrelease: 1.1.0-nightly\n```\n\nBacktrace:\n\n```\n\u27e9 env RUST_BACKTRACE=1 cargo rustc\n   Compiling fblast v0.1.0 (file:///XXX)\nsrc/main.rs:106:9: 106:22 error: internal compiler error: coherence failed to report ambiguity: cannot locate the impl of the trait `core::marker::Send` for the type `[closure src/main.rs:106:28: 109:10]`\nsrc/main.rs:106         thread::spawn(move || {\n                        ^~~~~~~~~~~~~\nnote: in expansion of for loop expansion\nsrc/main.rs:101:5: 110:6 note: expansion site\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:170\n\nstack backtrace:\n   1:     0x7fba53543d89 - sys::backtrace::write::h07c95d531f9fe9d4uhs\n   2:     0x7fba5354bd09 - panicking::on_panic::he918792f8f4677b8xXw\n   3:     0x7fba5350bab2 - rt::unwind::begin_unwind_inner::h31a101974d18f246HCw\n   4:     0x7fba508f544d - rt::unwind::begin_unwind::h14624462634262488443\n   5:     0x7fba508f53e2 - diagnostic::SpanHandler::span_bug::hafd58c40d711da9f02B\n   6:     0x7fba514fe073 - middle::traits::error_reporting::report_fulfillment_errors::h1a1d53ad0f7d9f52WTN\n   7:     0x7fba52cafc44 - check::FnCtxt<'a, 'tcx>::select_all_obligations_or_error::hdec1eabcd6932f1e0kp\n   8:     0x7fba52d273f2 - check::check_bare_fn::h1721ecdc067e6448qun\n   9:     0x7fba52d252d2 - check::CheckItemBodiesVisitor<'a, 'tcx>.Visitor<'tcx>::visit_item::h107d6f7848b9ff6btrn\n  10:     0x7fba52de5d8a - check_crate::closure.38895\n  11:     0x7fba52ddf620 - check_crate::h6d6254e7cbd89310ZIC\n  12:     0x7fba53a9adc8 - driver::phase_3_run_analysis_passes::hd8a391a642e4490etGa\n  13:     0x7fba53a7c0cc - driver::compile_input::hb2b273f3b108679aQba\n  14:     0x7fba53b37801 - run_compiler::h0564a7d54aad01e375b\n  15:     0x7fba53b35052 - boxed::F.FnBox<A>::call_box::h13361673564817623969\n  16:     0x7fba53b34619 - rt::unwind::try::try_fn::h2560773790993423171\n  17:     0x7fba535c4a98 - rust_try_inner\n  18:     0x7fba535c4a85 - rust_try\n  19:     0x7fba53b348b4 - boxed::F.FnBox<A>::call_box::h12559150340170776261\n  20:     0x7fba5354aaa1 - sys::thread::Thread::new::thread_start::h9c8d6fd462521d203Iv\n  21:     0x7fba4d5f7353 - start_thread\n  22:     0x7fba5319bbfc - __clone\n  23:                0x0 - <unknown>\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25828/timeline", "performed_via_github_app": null, "state_reason": "completed"}