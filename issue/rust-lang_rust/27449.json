{"url": "https://api.github.com/repos/rust-lang/rust/issues/27449", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27449/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27449/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27449/events", "html_url": "https://github.com/rust-lang/rust/issues/27449", "id": 98505890, "node_id": "MDU6SXNzdWU5ODUwNTg5MA==", "number": 27449, "title": "ICE when comparing two *const Trait for equality", "user": {"login": "Twinklebear", "id": 1522476, "node_id": "MDQ6VXNlcjE1MjI0NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1522476?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Twinklebear", "html_url": "https://github.com/Twinklebear", "followers_url": "https://api.github.com/users/Twinklebear/followers", "following_url": "https://api.github.com/users/Twinklebear/following{/other_user}", "gists_url": "https://api.github.com/users/Twinklebear/gists{/gist_id}", "starred_url": "https://api.github.com/users/Twinklebear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Twinklebear/subscriptions", "organizations_url": "https://api.github.com/users/Twinklebear/orgs", "repos_url": "https://api.github.com/users/Twinklebear/repos", "events_url": "https://api.github.com/users/Twinklebear/events{/privacy}", "received_events_url": "https://api.github.com/users/Twinklebear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-08-01T04:24:19Z", "updated_at": "2015-08-01T16:29:32Z", "closed_at": "2015-08-01T16:29:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey all,\n\nI'm trying to see if two &Trait refer to the same object. It sounds like the correct way to do this is by casting to `*const Trait` and comparing those pointers for equality, however this produces an ICE. Here's a simple [repro on playpen](http://is.gd/c4UIFd) and pasted below:\n\n``` rust\ntrait MyTrait {}\n\nstruct Foo;\nimpl MyTrait for Foo {}\n\nfn main() {\n    let x = Foo;\n    let a = &x;\n    let y = Foo;\n    let z = &y as &MyTrait;\n\n    if a as *const MyTrait == z as *const MyTrait {\n        println!(\"They match\");\n    }\n}\n```\n\nBelow is the output of compiling the reproduction with `RUST_BACKTRACE=1` on `rustc 1.3.0-nightly (4dfe7a16c 2015-07-30)`\n\n```\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'assertion failed: self.appropriate_rvalue_mode(bcx.ccx()) == ByValue', ../src/librustc_trans/trans/datum.rs:767\n\nstack backtrace:\n   1:     0x7fe6e5afa28e - sys::backtrace::write::h40e4abee08c0ae4cCys\n   2:     0x7fe6e5b027f4 - panicking::on_panic::h2d2b781277adb4bfLnx\n   3:     0x7fe6e5ac3ace - rt::unwind::begin_unwind_inner::ha8a0cd4a16a72098o3w\n   4:     0x7fe6e48969a1 - rt::unwind::begin_unwind::h10748794639547756261\n   5:     0x7fe6e49171c4 - trans::datum::Datum<'tcx, K>::to_llscalarish::h18191786700678863130\n   6:     0x7fe6e499223b - trans::expr::trans_binary::h0bd5cb5f100e03c3SvD\n   7:     0x7fe6e4987ffb - trans::expr::trans_unadjusted::hd19df31c310773b8oXB\n   8:     0x7fe6e48d2c49 - trans::expr::trans::hc28cc636bef2e50fYpB\n   9:     0x7fe6e4989bcf - trans::expr::trans_rvalue_dps_unadjusted::he43b91a5a089a8ed4tC\n  10:     0x7fe6e49627de - trans::expr::trans_into::h8c4ef2d012c8a2c0IjB\n  11:     0x7fe6e48f28b3 - trans::controlflow::trans_block::h05d9494ae3fe12b5BWv\n  12:     0x7fe6e48f1666 - trans::base::trans_closure::h3121f3bcc11648c5sDi\n  13:     0x7fe6e48f2ea8 - trans::base::trans_fn::ha3af5a02c0e336d7fNi\n  14:     0x7fe6e48f5fa8 - trans::base::trans_item::h55d2aa0c004afbf9qcj\n  15:     0x7fe6e4902a68 - trans::base::trans_crate::ha1fc42a69e474159uZj\n  16:     0x7fe6e60708d4 - driver::phase_4_translate_to_llvm::hc4ec4f8818648bb75Oa\n  17:     0x7fe6e606ad68 - driver::phase_3_run_analysis_passes::closure.16499\n  18:     0x7fe6e6064fe1 - middle::ty::ctxt<'tcx>::create_and_enter::h11776421653616432545\n  19:     0x7fe6e606000f - driver::phase_3_run_analysis_passes::h8749574581471310871\n  20:     0x7fe6e6044751 - driver::compile_input::h2888e18c0246b44eTba\n  21:     0x7fe6e6129360 - run_compiler::h216b759eb7845cb3A7b\n  22:     0x7fe6e6126f2e - boxed::F.FnBox<A>::call_box::h6091736725415782619\n  23:     0x7fe6e6126859 - rt::unwind::try::try_fn::h7532542645103148343\n  24:     0x7fe6e5b022bf - __rust_try_inner\n  25:     0x7fe6e5b022fa - __rust_try\n  26:     0x7fe6e5aed7a7 - rt::unwind::try::inner_try::hec4722a4abfa91b1hZw\n  27:     0x7fe6e6126a78 - boxed::F.FnBox<A>::call_box::h7421094806661540209\n  28:     0x7fe6e5b01411 - sys::thread::Thread::new::thread_start::h0036aa54802cb8d7X8v\n  29:     0x7fe6df71d0da - start_thread\n  30:     0x7fe6e575390c - __clone\n  31:                0x0 - <unknown>\n```\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27449/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27449/timeline", "performed_via_github_app": null, "state_reason": "completed"}