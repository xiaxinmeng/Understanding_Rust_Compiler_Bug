{"url": "https://api.github.com/repos/rust-lang/rust/issues/50481", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50481/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50481/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50481/events", "html_url": "https://github.com/rust-lang/rust/issues/50481", "id": 320586380, "node_id": "MDU6SXNzdWUzMjA1ODYzODA=", "number": 50481, "title": "Rustbuild: changing and testing libcore results in \"found possibly newer version of crate `std` which `rand` depends on\"", "user": {"login": "LukasKalbertodt", "id": 7419664, "node_id": "MDQ6VXNlcjc0MTk2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7419664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasKalbertodt", "html_url": "https://github.com/LukasKalbertodt", "followers_url": "https://api.github.com/users/LukasKalbertodt/followers", "following_url": "https://api.github.com/users/LukasKalbertodt/following{/other_user}", "gists_url": "https://api.github.com/users/LukasKalbertodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasKalbertodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasKalbertodt/subscriptions", "organizations_url": "https://api.github.com/users/LukasKalbertodt/orgs", "repos_url": "https://api.github.com/users/LukasKalbertodt/repos", "events_url": "https://api.github.com/users/LukasKalbertodt/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasKalbertodt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 593503757, "node_id": "MDU6TGFiZWw1OTM1MDM3NTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-infra", "name": "T-infra", "color": "bfd4f2", "default": false, "description": "Relevant to the infrastructure team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2018-05-06T11:58:00Z", "updated_at": "2019-08-16T18:35:16Z", "closed_at": "2019-08-16T18:35:16Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I tried testing `libcore` with the changes of #50466, which enables way faster testing of libcore and libstd.\r\n\r\nWhen I execute `./x.py test --stage 0 --no-doc src/libcore` the first time, everything works fine. If I then change test-code in `libcore/tests`, only the tests are rebuild and everything works (awesome!). But if I change `libcore` directly, it tries to rebuild a few things and then has a problem with the crate `rand`:\r\n\r\n```\r\n$ ./x.py test --stage 0 --no-doc src/libcore --test-args time\r\nUpdating only changed submodules\r\nSubmodules updated in 0.02 seconds\r\n    Finished dev [unoptimized] target(s) in 0.0 secs\r\nBuilding stage0 std artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n   Compiling core v0.0.0 (file:///home/lukas/dev/rust/src/libcore)\r\n   Compiling compiler_builtins v0.0.0 (file:///home/lukas/dev/rust/src/rustc/compiler_builtins_shim)\r\n   Compiling libc v0.0.0 (file:///home/lukas/dev/rust/src/rustc/libc_shim)\r\n   Compiling alloc v0.0.0 (file:///home/lukas/dev/rust/src/liballoc)\r\n   Compiling std_unicode v0.0.0 (file:///home/lukas/dev/rust/src/libstd_unicode)\r\n   Compiling unwind v0.0.0 (file:///home/lukas/dev/rust/src/libunwind)\r\n   Compiling alloc_system v0.0.0 (file:///home/lukas/dev/rust/src/liballoc_system)\r\n   Compiling panic_abort v0.0.0 (file:///home/lukas/dev/rust/src/libpanic_abort)\r\n   Compiling alloc_jemalloc v0.0.0 (file:///home/lukas/dev/rust/src/liballoc_jemalloc)\r\n   Compiling rustc_lsan v0.0.0 (file:///home/lukas/dev/rust/src/librustc_lsan)\r\n   Compiling panic_unwind v0.0.0 (file:///home/lukas/dev/rust/src/libpanic_unwind)\r\n   Compiling rustc_asan v0.0.0 (file:///home/lukas/dev/rust/src/librustc_asan)\r\n   Compiling rustc_msan v0.0.0 (file:///home/lukas/dev/rust/src/librustc_msan)\r\n   Compiling rustc_tsan v0.0.0 (file:///home/lukas/dev/rust/src/librustc_tsan)\r\n   Compiling std v0.0.0 (file:///home/lukas/dev/rust/src/libstd)\r\n    Finished release [optimized] target(s) in 30.15 secs\r\nCopying stage0 std from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding stage0 test artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n   Compiling term v0.0.0 (file:///home/lukas/dev/rust/src/libterm)\r\n   Compiling getopts v0.2.17\r\n   Compiling test v0.0.0 (file:///home/lukas/dev/rust/src/libtest)\r\n    Finished release [optimized] target(s) in 6.58 secs\r\nCopying stage0 test from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nTesting core stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n   Compiling core v0.0.0 (file:///home/lukas/dev/rust/src/libcore)\r\nerror[E0460]: found possibly newer version of crate `std` which `rand` depends on\r\n  --> libcore/../libcore/tests/lib.rs:53:1\r\n   |\r\n53 | extern crate rand;\r\n   | ^^^^^^^^^^^^^^^^^^\r\n   |\r\n   = note: perhaps that crate needs to be recompiled?\r\n   = note: the following crate versions were found:\r\n           crate `std`: /home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/libstd-5f3a747b9ee6cbda.rlib\r\n           crate `std`: /home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0-sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-5f3a747b9ee6cbda.rlib\r\n           crate `std`: /home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0-sysroot/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-5f3a747b9ee6cbda.so\r\n           crate `std`: /home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/libstd-5f3a747b9ee6cbda.so\r\n           crate `rand`: /home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0-std/x86_64-unknown-linux-gnu/release/deps/librand-89787ed220814c67.rlib\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0460`.\r\nerror: Could not compile `core`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\n\r\n\r\ncommand did not execute successfully: \"/home/lukas/dev/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\" \"test\" \"--target\" \"x86_64-unknown-linux-gnu\" \"-j\" \"8\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/home/lukas/dev/rust/src/libstd/Cargo.toml\" \"--lib\" \"--bins\" \"--examples\" \"--tests\" \"--benches\" \"-p\" \"core\" \"--\" \"time\"\r\nexpected success, got: exit code: 101\r\n\r\n\r\nfailed to run: /home/lukas/dev/rust/build/bootstrap/debug/bootstrap test --stage 0 --no-doc src/libcore --test-args time\r\nBuild completed unsuccessfully in 0:00:44\r\n```\r\n\r\nNote that I can simply run `x.py clean && x.py test --stage 0 --no-doc src/libcore` and everything works again (and it doesn't even takes that much longer). But I guess this `rand` problem shouldn't occur anyway? The problem always occurs when performing the steps as described above.\r\n\r\nCC @kennytm ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50481/reactions", "total_count": 6, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50481/timeline", "performed_via_github_app": null, "state_reason": "completed"}