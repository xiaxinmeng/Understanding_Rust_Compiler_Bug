{"url": "https://api.github.com/repos/rust-lang/rust/issues/37828", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37828/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37828/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37828/events", "html_url": "https://github.com/rust-lang/rust/issues/37828", "id": 190055279, "node_id": "MDU6SXNzdWUxOTAwNTUyNzk=", "number": 37828, "title": "ICE with codegen-units>1", "user": {"login": "linuskr", "id": 11837602, "node_id": "MDQ6VXNlcjExODM3NjAy", "avatar_url": "https://avatars.githubusercontent.com/u/11837602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linuskr", "html_url": "https://github.com/linuskr", "followers_url": "https://api.github.com/users/linuskr/followers", "following_url": "https://api.github.com/users/linuskr/following{/other_user}", "gists_url": "https://api.github.com/users/linuskr/gists{/gist_id}", "starred_url": "https://api.github.com/users/linuskr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linuskr/subscriptions", "organizations_url": "https://api.github.com/users/linuskr/orgs", "repos_url": "https://api.github.com/users/linuskr/repos", "events_url": "https://api.github.com/users/linuskr/events{/privacy}", "received_events_url": "https://api.github.com/users/linuskr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-11-17T14:03:10Z", "updated_at": "2016-11-21T16:26:16Z", "closed_at": "2016-11-21T16:23:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "Since i think the previous nightly compiling xml-rs crashes with an internal compiler error when using more than one codegen-units. My rustc version is\r\n```\r\nrustc --version --verbose\r\nrustc 1.15.0-nightly (43006fcea 2016-11-15)\r\nbinary: rustc\r\ncommit-hash: 43006fcea0066a935b657fff9ccef56983cbf56c\r\ncommit-date: 2016-11-15\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.15.0-nightly\r\nLLVM version: 3.9\r\n```\r\nTrying to compile `xml-rs-0.3.4` with `codegen-units = 2` results in\r\n```\r\nRunning `rustc src/lib.rs --crate-name xml --crate-type lib -C codegen-units=2 -g -C metadata=e99a30aecca1ecbd --out-dir /home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debu\r\ng/deps --emit=dep-info,link -L dependency=/home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debug/deps --extern bitflags=/home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debug/d\r\neps/libbitflags-0e272044714c8076.rlib`\r\nerror: internal compiler error: ../src/librustc_trans/callee.rs:608: expected fn item type, found [closure@src/name.rs:228:34: 228:42]\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:424\r\nstack backtrace:\r\n   1:     0x7fdfeea9617a - std::sys::imp::backtrace::tracing::imp::write::h944c02ac40aee2d7\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n   2:     0x7fdfeeaa501f - std::panicking::default_hook::{{closure}}::h6875a2976258b020\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:247\r\n   3:     0x7fdfeeaa4bbd - std::panicking::default_hook::h88ffbc5922643264\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:257\r\n   4:     0x7fdfeeaa54c7 - std::panicking::rust_panic_with_hook::ha5aed1dfc0e220e3\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:451\r\n   5:     0x7fdfe75af55a - std::panicking::begin_panic::h264cdc75d51b518b\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:413\r\n   6:     0x7fdfe75c011d - rustc_errors::Handler::bug::h620f7270292f0095\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_errors/lib.rs:424\r\n   7:     0x7fdfebe8df21 - rustc::session::opt_span_bug_fmt::{{closure}}::h4a9b70c3df8b4b3a\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:771\r\n   8:     0x7fdfebe8dd3e - rustc::session::opt_span_bug_fmt::h7d83586c6e2c7ae6\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1048\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:767\r\n   9:     0x7fdfebe8d9a2 - rustc::session::bug_fmt::he2d2f00a4afa9d1e\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:751\r\n  10:     0x7fdfee18a385 - rustc_trans::callee::get_fn::heb6f4992e525f6d0\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/callee.rs:608\r\n  11:     0x7fdfee184d39 - rustc_trans::callee::Callee::trait_method::h8013a3eaf19993ae\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/callee.rs:263\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/callee.rs:150\r\n  12:     0x7fdfee183b4e - rustc_trans::callee::Callee::def::h3b8e0afadf9d53fa\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/callee.rs:96\r\n  13:     0x7fdfee1d746f - rustc_trans::mir::block::<impl rustc_trans::mir::MirContext<'bcx, 'tcx>>::trans_block::h5297e1a9e17de5f2\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/mir/block.rs:411\r\n  14:     0x7fdfee1d40a6 - rustc_trans::mir::trans_mir::h66a6eca5084c2485\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/mir/mod.rs:302\r\n  15:     0x7fdfee1f3889 - rustc_trans::trans_item::TransItem::define::h88bbe0179f734cd1\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/base.rs:1055\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/trans_item.rs:86\r\n  16:     0x7fdfee16fe8b - rustc_trans::base::trans_crate::h6e0b0bf1b66798ce\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/base.rs:1635\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/dep_graph/graph.rs:77\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_trans/base.rs:1633\r\n  17:     0x7fdfeee55571 - rustc_driver::driver::phase_4_translate_to_llvm::h48ed91c172294403\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:1040\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/util/common.rs:38\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:1038\r\n  18:     0x7fdfeee262c0 - rustc_driver::driver::compile_input::{{closure}}::hf13172fc4e5a2f4d\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:206\r\n  19:     0x7fdfeee43b3e - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h97a3a12d948df547\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:994\r\n  20:     0x7fdfeee3ce8d - rustc_driver::driver::phase_3_run_analysis_passes::hb0ad9de18d423e67\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1019\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/thread/local.rs:245\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1016\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1003\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/thread/local.rs:245\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1000\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:789\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:869\r\n  21:     0x7fdfeee24614 - rustc_driver::driver::compile_input::h8e119234b60571d5\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:173\r\n  22:     0x7fdfeee69b30 - rustc_driver::run_compiler::hbdfc4f84e2e0f4b9\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:222\r\n  23:     0x7fdfeed85858 - std::panicking::try::do_call::hf679f17bf3b43b0b\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:1141\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:138\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:1075\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panic.rs:295\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:356\r\n  24:     0x7fdfeeaafa0a - __rust_maybe_catch_panic\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libpanic_unwind/lib.rs:97\r\n  25:     0x7fdfeeda93e8 - <F as alloc::boxed::FnBox<A>>::call_box::h506fb5d7b8891cd4\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:332\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/panic.rs:351\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/thread/mod.rs:287\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:595\r\n  26:     0x7fdfeeaa3e94 - std::sys::imp::thread::Thread::new::thread_start::h8084b1107992ae5b\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:605\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/sys_common/thread.rs:21\r\n                        at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libstd/sys/unix/thread.rs:84\r\n  27:     0x7fdfe6d5b453 - start_thread\r\n  28:     0x7fdfee76b7de - __GI___clone\r\n  29:                0x0 - <unknown>\r\n\r\nerror: Could not compile `xml-rs`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc src/lib.rs --crate-name xml --crate-type lib -C codegen-units=2 -g -C metadata=e99a30aecca1ecbd --out-dir /home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debug/deps --emit=dep-info,link -L dependency=/home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debug/deps --extern bitflags=/home/linus/Dokumente/rust-zeug/xml-rs-0.3.4/target/debug/deps/libbitflags-0e272044714c8076.rlib` (exit code: 101)\r\n```\r\n`codegen-units = 1` successfully compiles, and choosing a different amount results in crashes at different closures. I don't really have the time to find a minimal test case, but it seems to crash at closures in functions that are marked `#[inline]`.", "closed_by": {"login": "linuskr", "id": 11837602, "node_id": "MDQ6VXNlcjExODM3NjAy", "avatar_url": "https://avatars.githubusercontent.com/u/11837602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/linuskr", "html_url": "https://github.com/linuskr", "followers_url": "https://api.github.com/users/linuskr/followers", "following_url": "https://api.github.com/users/linuskr/following{/other_user}", "gists_url": "https://api.github.com/users/linuskr/gists{/gist_id}", "starred_url": "https://api.github.com/users/linuskr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/linuskr/subscriptions", "organizations_url": "https://api.github.com/users/linuskr/orgs", "repos_url": "https://api.github.com/users/linuskr/repos", "events_url": "https://api.github.com/users/linuskr/events{/privacy}", "received_events_url": "https://api.github.com/users/linuskr/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37828/timeline", "performed_via_github_app": null, "state_reason": "completed"}