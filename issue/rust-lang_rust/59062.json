{"url": "https://api.github.com/repos/rust-lang/rust/issues/59062", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59062/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59062/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59062/events", "html_url": "https://github.com/rust-lang/rust/issues/59062", "id": 419173233, "node_id": "MDU6SXNzdWU0MTkxNzMyMzM=", "number": 59062, "title": "Llvm memory corruption on duplicate static with one being weak and the other not", "user": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-03-10T11:05:03Z", "updated_at": "2020-10-27T15:16:19Z", "closed_at": "2020-10-27T15:16:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\r\n#![feature(linkage)]\r\n\r\nfn main() {\r\n    extern {\r\n        #[linkage = \"weak\"]\r\n        static mut ABC: *const u8;\r\n    }\r\n\r\n    {\r\n        #[no_mangle]\r\n        static mut ABC: *const u8 = 1 as *const u8;\r\n    }\r\n\r\n    unsafe { assert_eq!(ABC as usize, 0); }\r\n}\r\n```\r\n\r\n```\r\n$ rustc -V\r\nrustc 1.35.0-nightly (26b4cb484 2019-03-09)\r\n$ uname\r\nDarwin\r\n```\r\n\r\n```\r\n(lldb) continue \r\nProcess 35161 resuming\r\nrustc(35161,0x70000a0b9000) malloc: Incorrect checksum for freed object 0x10477a648: probably modified after being freed.\r\nCorrupt value: 0x10476e348\r\nrustc(35161,0x70000a0b9000) malloc: *** set a breakpoint in malloc_error_break to debug\r\nProcess 35161 stopped\r\n* thread #3, name = 'rustc', stop reason = signal SIGABRT\r\n    frame #0: 0x00007fff6db9223e libsystem_kernel.dylib`__pthread_kill + 10\r\nlibsystem_kernel.dylib`__pthread_kill:\r\n->  0x7fff6db9223e <+10>: jae    0x7fff6db92248            ; <+20>\r\n    0x7fff6db92240 <+12>: movq   %rax, %rdi\r\n    0x7fff6db92243 <+15>: jmp    0x7fff6db8c3b7            ; cerror_nocancel\r\n    0x7fff6db92248 <+20>: retq   \r\nTarget 0: (rustc) stopped.\r\n(lldb) bt\r\n* thread #3, name = 'rustc', stop reason = signal SIGABRT\r\n  * frame #0: 0x00007fff6db9223e libsystem_kernel.dylib`__pthread_kill + 10\r\n    frame #1: 0x00007fff6dc48c1c libsystem_pthread.dylib`pthread_kill + 285\r\n    frame #2: 0x00007fff6dafb1c9 libsystem_c.dylib`abort + 127\r\n    frame #3: 0x00007fff6dc0a6e2 libsystem_malloc.dylib`malloc_vreport + 545\r\n    frame #4: 0x00007fff6dc1e86c libsystem_malloc.dylib`malloc_zone_error + 184\r\n    frame #5: 0x00007fff6dc037fd libsystem_malloc.dylib`tiny_malloc_from_free_list + 1302\r\n    frame #6: 0x00007fff6dc02d71 libsystem_malloc.dylib`tiny_malloc_should_clear + 273\r\n    frame #7: 0x00007fff6dc02bac libsystem_malloc.dylib`szone_malloc_should_clear + 66\r\n    frame #8: 0x00007fff6dc01807 libsystem_malloc.dylib`malloc_zone_malloc + 103\r\n    frame #9: 0x00007fff6dc01783 libsystem_malloc.dylib`malloc + 24\r\n    frame #10: 0x00007fff6b178f48 libc++abi.dylib`operator new(unsigned long) + 40\r\n    frame #11: 0x0000000107bec390 librustc_codegen_llvm-llvm.dylib`llvm::ConstantExpr::getGetElementPtr(llvm::Type*, llvm::Constant*, llvm::ArrayRef<llvm::Value*>, bool, llvm::Optional<unsigned int>, llvm::Type*) + 512\r\n    frame #12: 0x0000000107bcf41e librustc_codegen_llvm-llvm.dylib`llvm::ConstantFoldCastInstruction(unsigned int, llvm::Constant*, llvm::Type*) + 2542\r\n    frame #13: 0x0000000107beadd1 librustc_codegen_llvm-llvm.dylib`llvm::ConstantExpr::getBitCast(llvm::Constant*, llvm::Type*, bool) + 49\r\n    frame #14: 0x00000001060bda39 librustc_codegen_llvm-llvm.dylib`rustc_codegen_llvm::common::_$LT$impl$u20$rustc_codegen_ssa..traits..consts..ConstMethods$LT$$u27$tcx$GT$$u20$for$u20$rustc_codegen_llvm..context..CodegenCx$LT$$u27$ll$C$$u20$$u27$tcx$GT$$GT$::scalar_to_backend::hb9970d6ac4556680 + 857\r\n    frame #15: 0x000000010614b287 librustc_codegen_llvm-llvm.dylib`rustc_codegen_llvm::consts::const_alloc_to_llvm::hc6f89f6f6f2b6384 + 583\r\n    frame #16: 0x00000001060bddce librustc_codegen_llvm-llvm.dylib`rustc_codegen_llvm::common::_$LT$impl$u20$rustc_codegen_ssa..traits..consts..ConstMethods$LT$$u27$tcx$GT$$u20$for$u20$rustc_codegen_llvm..context..CodegenCx$LT$$u27$ll$C$$u20$$u27$tcx$GT$$GT$::from_const_alloc::hb5d0fa58a4020612 + 62\r\n    frame #17: 0x000000010603890c librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::mir::place::_$LT$impl$u20$rustc_codegen_ssa..mir..FunctionCx$LT$$u27$a$C$$u20$$u27$tcx$C$$u20$Bx$GT$$GT$::codegen_place::h44996edc5371a87c + 2540\r\n    frame #18: 0x000000010603a66e librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::mir::rvalue::_$LT$impl$u20$rustc_codegen_ssa..mir..FunctionCx$LT$$u27$a$C$$u20$$u27$tcx$C$$u20$Bx$GT$$GT$::codegen_rvalue_operand::h5599c6533b14adb2 + 926\r\n    frame #19: 0x0000000106030acb librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::mir::block::_$LT$impl$u20$rustc_codegen_ssa..mir..FunctionCx$LT$$u27$a$C$$u20$$u27$tcx$C$$u20$Bx$GT$$GT$::codegen_block::h104600d0adb65100 + 347\r\n    frame #20: 0x000000010602f870 librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::mir::codegen_mir::he842e8c595cfa704 + 8240\r\n    frame #21: 0x00000001060d6fe4 librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::base::codegen_instance::h73f92f7e3d01c258 + 1348\r\n    frame #22: 0x000000010603d73d librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::mono_item::MonoItemExt::define::haa6bfa9d184054c4 + 189\r\n    frame #23: 0x0000000106056ec7 librustc_codegen_llvm-llvm.dylib`rustc_codegen_llvm::base::compile_codegen_unit::module_codegen::h3e4c5ff338f1448b (.llvm.16361522435159248487) + 455\r\n    frame #24: 0x00000001061244eb librustc_codegen_llvm-llvm.dylib`rustc::dep_graph::graph::DepGraph::with_task::h660ec10a08aa9f9a + 603\r\n    frame #25: 0x0000000106056bc3 librustc_codegen_llvm-llvm.dylib`rustc_codegen_llvm::base::compile_codegen_unit::h3b905527d3f3a9f9 + 227\r\n    frame #26: 0x00000001060d3b54 librustc_codegen_llvm-llvm.dylib`rustc_codegen_ssa::base::codegen_crate::h420f27a98bb393ae + 4340\r\n    frame #27: 0x00000001061576b5 librustc_codegen_llvm-llvm.dylib`_$LT$rustc_codegen_llvm..LlvmCodegenBackend$u20$as$u20$rustc_codegen_utils..codegen_backend..CodegenBackend$GT$::codegen_crate::h2e3d5cd849f274bc + 69\r\n    frame #28: 0x00000001003c6947 librustc_driver-301a124b745201e8.dylib`rustc::util::common::time::h8da44bf652bb10f6 + 135\r\n    frame #29: 0x00000001004490b1 librustc_driver-301a124b745201e8.dylib`rustc_driver::driver::phase_4_codegen::h757fd88c254ce434 + 145\r\n    frame #30: 0x0000000100455d68 librustc_driver-301a124b745201e8.dylib`_$LT$std..thread..local..LocalKey$LT$T$GT$$GT$::with::heeb33436a88e3ad3 + 1128\r\n    frame #31: 0x00000001003b3fad librustc_driver-301a124b745201e8.dylib`rustc::ty::context::TyCtxt::create_and_enter::hec6ceb910270a9f3 + 7837\r\n    frame #32: 0x0000000100447571 librustc_driver-301a124b745201e8.dylib`rustc_driver::driver::compile_input::h6990b09d0f6362f8 + 15073\r\n    frame #33: 0x00000001003db63f librustc_driver-301a124b745201e8.dylib`rustc_driver::run_compiler_with_pool::hf083b87556d84788 + 4207\r\n    frame #34: 0x00000001003b6c5c librustc_driver-301a124b745201e8.dylib`_$LT$scoped_tls..ScopedKey$LT$T$GT$$GT$::set::h491a5289543275da + 316\r\n    frame #35: 0x00000001003da4c9 librustc_driver-301a124b745201e8.dylib`rustc_driver::run_compiler::h18229f76a609e57e + 377\r\n    frame #36: 0x00000001003cb802 librustc_driver-301a124b745201e8.dylib`syntax::with_globals::hfed16e71d5f06e09 + 418\r\n    frame #37: 0x0000000104217f3f libstd-a3808d1e8214de12.dylib`__rust_maybe_catch_panic + 31\r\n    frame #38: 0x000000010038aa8e librustc_driver-301a124b745201e8.dylib`_$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$::call_box::h6badfbe39ce107a7 + 126\r\n    frame #39: 0x0000000104216d1c libstd-a3808d1e8214de12.dylib`std::sys::unix::thread::Thread::new::thread_start::hea24a7d87921ef37 + 140\r\n    frame #40: 0x00007fff6dc46305 libsystem_pthread.dylib`_pthread_body + 126\r\n    frame #41: 0x00007fff6dc4926f libsystem_pthread.dylib`_pthread_start + 70\r\n    frame #42: 0x00007fff6dc45415 libsystem_pthread.dylib`thread_start + 13\r\n(lldb) \r\n```", "closed_by": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59062/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59062/timeline", "performed_via_github_app": null, "state_reason": "completed"}