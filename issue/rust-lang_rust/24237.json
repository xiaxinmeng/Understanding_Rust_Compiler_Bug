{"url": "https://api.github.com/repos/rust-lang/rust/issues/24237", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24237/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24237/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24237/events", "html_url": "https://github.com/rust-lang/rust/issues/24237", "id": 67401587, "node_id": "MDU6SXNzdWU2NzQwMTU4Nw==", "number": 24237, "title": "Leverage atomically setting CLOEXEC where possible", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-04-09T16:38:40Z", "updated_at": "2018-02-28T01:44:41Z", "closed_at": "2016-02-06T17:13:54Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "After #24034 lands we will be setting `CLOEXEC` on all file descriptors on unix in the standard library. Currently we do so in a nonatomic fashion, however, so it's possible to continue to leak file descriptors into children if a thread is concurrently forking.\n\nMany platforms have methods of creating `CLOEXEC` file descriptors atomically, but many of the APIs are quite new and they need to be properly detected at runtime. For example, the current instances of `fd.set_cloexec()` that need to be migrated are listed below. A reminder of our minimum platform requirements are linux 2.6.18 and OSX 10.7.\n- [x] `File::open` - this should specify the `O_CLOEXEC` flag. This flag was added in linux 2.6.23 and appears to exist on OSX 10.7. #27971\n- [x] `Socket::new` - this should be specify the `SOCK_CLOEXEC` flag in the `type` argument (second). This flag was only added in linux 2.6.27 and does not exist on OSX. #31417\n- [x] `Socket::accept` - this should be replaced with a call to `accept4`. This system call was only added in linux 2.6.28 and does not exist on OSX. #31417\n- [x] `Socket::duplicate` - this should be replaced with `dup3` (linux 2.6.27, not on OSX) or `F_DUPFD_CLOEXEC` (linux 2.6.24, appears to exist on OSX 10.7). #27980\n- [x] `anon_pipe` - this could be replaced with `pipe2` on linux 2.6.27 and perhaps `socketpair` on OSX (not confirmed). #31417\n\nThe hard part about this bug is figuring out if it's possible to avoid compile-time detection of these functions (and instead rely on runtime detection). \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24237/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24237/timeline", "performed_via_github_app": null, "state_reason": "completed"}