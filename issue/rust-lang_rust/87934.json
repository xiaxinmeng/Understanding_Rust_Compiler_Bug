{"url": "https://api.github.com/repos/rust-lang/rust/issues/87934", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/87934/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/87934/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/87934/events", "html_url": "https://github.com/rust-lang/rust/issues/87934", "id": 966455621, "node_id": "MDU6SXNzdWU5NjY0NTU2MjE=", "number": 87934, "title": "Adding an option to force compiling a crate as PIE (instead of PIC)", "user": {"login": "hlopko", "id": 814566, "node_id": "MDQ6VXNlcjgxNDU2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/814566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hlopko", "html_url": "https://github.com/hlopko", "followers_url": "https://api.github.com/users/hlopko/followers", "following_url": "https://api.github.com/users/hlopko/following{/other_user}", "gists_url": "https://api.github.com/users/hlopko/gists{/gist_id}", "starred_url": "https://api.github.com/users/hlopko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hlopko/subscriptions", "organizations_url": "https://api.github.com/users/hlopko/orgs", "repos_url": "https://api.github.com/users/hlopko/repos", "events_url": "https://api.github.com/users/hlopko/events{/privacy}", "received_events_url": "https://api.github.com/users/hlopko/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2021-08-11T10:48:12Z", "updated_at": "2021-10-31T19:23:28Z", "closed_at": "2021-10-31T19:23:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi all,\r\n\r\nAFAIK we always compile crates (`--crate-type=lib`) in `relocation-model=pic` as PIC (we call `LLVMRustSetModulePICLevel` in https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_llvm/src/context.rs#L183). Only when we are building a binary crate we compile using PIE (https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_llvm/src/context.rs#L187).\r\n\r\nThis is a reasonable default, PIC objects can be used for both executables and shared libraries. PIE objects can only be used for executables, but PIE code can be faster than PIC code. \r\n\r\nWe would like introduce a way to build crates as PIE in performance-critical scenarios where we know we won't need to produce shared libraries. Even further, cargo could detect that it's only building an executable and it could choose to build crates as PIE by default (but this is outside of the scope of this issue).\r\n\r\nAn obvious solution is to add a command line flag and check its value in https://github.com/rust-lang/rust/blob/master/compiler/rustc_codegen_llvm/src/context.rs#L186. Would that be the best way to implement this? Would it be a welcomed change?\r\n\r\nThank you and have a lovely day!\r\n", "closed_by": {"login": "hlopko", "id": 814566, "node_id": "MDQ6VXNlcjgxNDU2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/814566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hlopko", "html_url": "https://github.com/hlopko", "followers_url": "https://api.github.com/users/hlopko/followers", "following_url": "https://api.github.com/users/hlopko/following{/other_user}", "gists_url": "https://api.github.com/users/hlopko/gists{/gist_id}", "starred_url": "https://api.github.com/users/hlopko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hlopko/subscriptions", "organizations_url": "https://api.github.com/users/hlopko/orgs", "repos_url": "https://api.github.com/users/hlopko/repos", "events_url": "https://api.github.com/users/hlopko/events{/privacy}", "received_events_url": "https://api.github.com/users/hlopko/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/87934/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/87934/timeline", "performed_via_github_app": null, "state_reason": "completed"}