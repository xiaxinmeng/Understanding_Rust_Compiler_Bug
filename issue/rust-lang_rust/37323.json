{"url": "https://api.github.com/repos/rust-lang/rust/issues/37323", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37323/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37323/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37323/events", "html_url": "https://github.com/rust-lang/rust/issues/37323", "id": 184483800, "node_id": "MDU6SXNzdWUxODQ0ODM4MDA=", "number": 37323, "title": "Internal compiler error \"node_id_to_type: no type for node\" with save-analysis", "user": {"login": "evestera", "id": 4187449, "node_id": "MDQ6VXNlcjQxODc0NDk=", "avatar_url": "https://avatars.githubusercontent.com/u/4187449?v=4", "gravatar_id": "", "url": "https://api.github.com/users/evestera", "html_url": "https://github.com/evestera", "followers_url": "https://api.github.com/users/evestera/followers", "following_url": "https://api.github.com/users/evestera/following{/other_user}", "gists_url": "https://api.github.com/users/evestera/gists{/gist_id}", "starred_url": "https://api.github.com/users/evestera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/evestera/subscriptions", "organizations_url": "https://api.github.com/users/evestera/orgs", "repos_url": "https://api.github.com/users/evestera/repos", "events_url": "https://api.github.com/users/evestera/events{/privacy}", "received_events_url": "https://api.github.com/users/evestera/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-10-21T13:25:02Z", "updated_at": "2017-12-24T18:10:33Z", "closed_at": "2017-06-24T09:32:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "Compiling the code below with `rustc point2.rs -Zsave-analysis` resulted in an internal compiler error. \n\nI've tried to minimize the code. Removing either the derive, the other two structs or fixing the lifetime error in `NestedA` makes the panic disappear.\n## Code\n\n``` rust\n#[derive(Debug)]\nstruct Point {\n}\n\nstruct NestedA<'a, 'b> {\n    x: &'a NestedB<'b>\n}\n\nstruct NestedB<'a> {\n    x: &'a i32,\n}\n\nfn main() {\n}\n```\n## Output with backtrace\n\n```\nerror[E0491]: in type `&'a mut NestedB<'b>`, reference has a longer lifetime than the data it references\n --> point2.rs:6:5\n  |\n6 |     x: &'a mut NestedB<'b>\n  |     ^^^^^^^^^^^^^^^^^^^^^^\n  |\nnote: the pointer is valid for the lifetime 'a as defined on the struct at 5:0\n --> point2.rs:5:1\n  |\n5 | struct NestedA<'a, 'b> {\n  | ^\nnote: but the referenced data is only valid for the lifetime 'b as defined on the struct at 5:0\n --> point2.rs:5:1\n  |\n5 | struct NestedA<'a, 'b> {\n  | ^\n\nerror: internal compiler error: ../src/librustc/ty/mod.rs:2097: node_id_to_type: no type for node `pat Point {  } (id=46)`\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\n\nnote: run with `RUST_BACKTRACE=1` for a backtrace\n\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:656\nstack backtrace:\n   1:        0x106869608 - std::sys::backtrace::tracing::imp::write::h22f199c1dbb72ba2\n   2:        0x106876f2f - std::panicking::default_hook::{{closure}}::h9a389c462b6a22dd\n   3:        0x106874355 - std::panicking::default_hook::h852b4223c1c00c59\n   4:        0x106874a76 - std::panicking::rust_panic_with_hook::hcd9d05f53fa0dafc\n   5:        0x1067425da - std::panicking::begin_panic::h2f463d37998ebeba\n   6:        0x10675294a - rustc_errors::Handler::bug::haca77c19c882b432\n   7:        0x1036f72cc - rustc::session::opt_span_bug_fmt::{{closure}}::hfeb850fbe828b399\n   8:        0x1036298c9 - rustc::session::opt_span_bug_fmt::h46e45438a860a75e\n   9:        0x10362967a - rustc::session::bug_fmt::hde22f071bf5a80ea\n  10:        0x1036ac0e5 - rustc::ty::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::node_id_to_type::h73d18361623a52d0\n  11:        0x1032b8264 - <rustc_save_analysis::dump_visitor::DumpVisitor<'l, 'tcx, 'll, D>>::process_pat::h3b459ce9f62d7503\n  12:        0x103292ace - syntax::visit::walk_expr::h740e88e7b04dea4f\n  13:        0x1032ae27e - <rustc_save_analysis::dump_visitor::DumpVisitor<'l, 'tcx, 'll, D>>::process_method::h4f6b66158471b107\n  14:        0x1032bcc29 - <rustc_save_analysis::dump_visitor::DumpVisitor<'l, 'tcx, 'll, D>>::process_impl_item::h48d1756270c266fa\n  15:        0x1032d49b5 - <rustc_save_analysis::dump_visitor::DumpVisitor<'l, 'tcx, 'll, D> as syntax::visit::Visitor>::visit_item::hfd68472f19fd8d39\n  16:        0x1032ee1ca - rustc_save_analysis::process_crate::h2b636e6f9af828ac\n  17:        0x10272769b - <rustc_driver::RustcDefaultCalls as rustc_driver::CompilerCalls<'a>>::build_controller::{{closure}}::{{closure}}::hcab3ae4dff1970b7\n  18:        0x10272c4a1 - <rustc_driver::RustcDefaultCalls as rustc_driver::CompilerCalls<'a>>::build_controller::{{closure}}::h146db60594d89824\n  19:        0x102728b0f - rustc_driver::driver::compile_input::{{closure}}::h9162a2fa292aeb3f\n  20:        0x10271c513 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h1928c4704cfe9c61\n  21:        0x1026f0284 - rustc_driver::driver::phase_3_run_analysis_passes::he578df6b8805151c\n  22:        0x1026d952a - rustc_driver::driver::compile_input::h5b63ccd49eeeb98b\n  23:        0x102702789 - rustc_driver::run_compiler::h98c7274e7cb1d11d\n  24:        0x102643558 - std::panicking::try::do_call::h99ed0da044e497c3\n  25:        0x1068774ea - __rust_maybe_catch_panic\n  26:        0x102661dcf - <F as alloc::boxed::FnBox<A>>::call_box::hbdd5a14cd8e33b97\n  27:        0x106873624 - std::sys::thread::Thread::new::thread_start::h50b05608a499d2b2\n  28:     0x7fff8e037059 - _pthread_body\n  29:     0x7fff8e036fd6 - _pthread_start\n```\n## Meta\n\n```\nrustc 1.14.0-nightly (16eeeac78 2016-10-18)\nbinary: rustc\ncommit-hash: 16eeeac783d2ede28e09f2a433c612dea309fe33\ncommit-date: 2016-10-18\nhost: x86_64-apple-darwin\nrelease: 1.14.0-nightly\nLLVM version: 3.9\n```\n\nAlso occurs with stable (but exact output above is from nightly):\n\n```\nrustc 1.12.1 (d4f39402a 2016-10-19)\nbinary: rustc\ncommit-hash: d4f39402a0c2c2b94ec0375cd7f7f6d7918113cd\ncommit-date: 2016-10-19\nhost: x86_64-apple-darwin\nrelease: 1.12.1\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37323/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37323/timeline", "performed_via_github_app": null, "state_reason": "completed"}