{"url": "https://api.github.com/repos/rust-lang/rust/issues/61302", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61302/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61302/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61302/events", "html_url": "https://github.com/rust-lang/rust/issues/61302", "id": 449575390, "node_id": "MDU6SXNzdWU0NDk1NzUzOTA=", "number": 61302, "title": "In save-analysis, enum variant ref ids are inconsistent to def ids", "user": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 632580625, "node_id": "MDU6TGFiZWw2MzI1ODA2MjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-save-analysis", "name": "A-save-analysis", "color": "f7e101", "default": false, "description": "Area: saving results of analyses such as inference and borrowck results to a file."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-05-29T03:04:56Z", "updated_at": "2020-06-11T14:52:26Z", "closed_at": "2020-06-11T14:52:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In rls/vscode, if you right-click on an enum name, it shows you all its uses. If you right click on a name of one of its variants, there are no uses shown despite there being some.\r\n\r\nThis doesn't seem to be fault of rls. Apparently the save-analysis info fed to rls is wrong. See the output presented here. In the defs table, the `Foo` enum has index 12 while the `Foo::Bar` variant has index 13. In the refs table, the correct index 12 is used to reference the enum, but the enum variant is referenced with index 14 which doesn't even exist in the defs table.\r\n\r\n```\r\n$ cargo new save-analysis-demo\r\n$ cd save-analysis-demo\r\n$ cat src/main.rs\r\nenum Foo {\r\n        Bar,\r\n}\r\nfn main() {\r\n        let v = Foo::Bar;\r\n}\r\n$ RUSTFLAGS=\"-Z save-analysis\" cargo +nightly check\r\n$ cat target/debug/deps/save-analysis/save_analysis_demo-*.json  | jq '.defs'\r\n[...]\r\n  {\r\n    \"kind\": \"TupleVariant\",\r\n    \"id\": {\r\n      \"krate\": 0,\r\n      \"index\": 13\r\n    },\r\n    \"span\": {\r\n      \"file_name\": \"src/main.rs\",\r\n      \"byte_start\": 12,\r\n      \"byte_end\": 15,\r\n      \"line_start\": 2,\r\n      \"line_end\": 2,\r\n      \"column_start\": 2,\r\n      \"column_end\": 5\r\n    },\r\n    \"name\": \"Bar\",\r\n    \"qualname\": \"::Foo::Bar\",\r\n    \"value\": \"Foo::Bar\",\r\n    \"parent\": {\r\n      \"krate\": 0,\r\n      \"index\": 12\r\n    },\r\n    \"children\": [],\r\n    \"decl_id\": null,\r\n    \"docs\": \"\",\r\n    \"sig\": null,\r\n    \"attributes\": []\r\n  },\r\n  {\r\n    \"kind\": \"Enum\",\r\n    \"id\": {\r\n      \"krate\": 0,\r\n      \"index\": 12\r\n    },\r\n    \"span\": {\r\n      \"file_name\": \"src/main.rs\",\r\n      \"byte_start\": 5,\r\n      \"byte_end\": 8,\r\n      \"line_start\": 1,\r\n      \"line_end\": 1,\r\n      \"column_start\": 6,\r\n      \"column_end\": 9\r\n    },\r\n    \"name\": \"Foo\",\r\n    \"qualname\": \"::Foo\",\r\n    \"value\": \"Foo::{Bar}\",\r\n    \"parent\": null,\r\n    \"children\": [\r\n      {\r\n        \"krate\": 0,\r\n        \"index\": 13\r\n      }\r\n    ],\r\n    \"decl_id\": null,\r\n    \"docs\": \"\",\r\n    \"sig\": null,\r\n    \"attributes\": []\r\n  },\r\n[...]\r\n$ cat target/debug/deps/save-analysis/save_analysis_demo-*.json  | jq '.refs'\r\n[\r\n  {\r\n    \"kind\": \"Variable\",\r\n    \"span\": {\r\n      \"file_name\": \"src/main.rs\",\r\n      \"byte_start\": 45,\r\n      \"byte_end\": 48,\r\n      \"line_start\": 5,\r\n      \"line_end\": 5,\r\n      \"column_start\": 15,\r\n      \"column_end\": 18\r\n    },\r\n    \"ref_id\": {\r\n      \"krate\": 0,\r\n      \"index\": 14\r\n    }\r\n  },\r\n  {\r\n    \"kind\": \"Type\",\r\n    \"span\": {\r\n      \"file_name\": \"src/main.rs\",\r\n      \"byte_start\": 40,\r\n      \"byte_end\": 43,\r\n      \"line_start\": 5,\r\n      \"line_end\": 5,\r\n      \"column_start\": 10,\r\n      \"column_end\": 13\r\n    },\r\n    \"ref_id\": {\r\n      \"krate\": 0,\r\n      \"index\": 12\r\n    }\r\n  }\r\n]\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61302/timeline", "performed_via_github_app": null, "state_reason": "completed"}