{"url": "https://api.github.com/repos/rust-lang/rust/issues/89368", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89368/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89368/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89368/events", "html_url": "https://github.com/rust-lang/rust/issues/89368", "id": 1011146028, "node_id": "I_kwDOAAsO6M48RN0s", "number": 89368, "title": "slice::align_to does not take into account length of the slice", "user": {"login": "jweinst1", "id": 11132902, "node_id": "MDQ6VXNlcjExMTMyOTAy", "avatar_url": "https://avatars.githubusercontent.com/u/11132902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jweinst1", "html_url": "https://github.com/jweinst1", "followers_url": "https://api.github.com/users/jweinst1/followers", "following_url": "https://api.github.com/users/jweinst1/following{/other_user}", "gists_url": "https://api.github.com/users/jweinst1/gists{/gist_id}", "starred_url": "https://api.github.com/users/jweinst1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jweinst1/subscriptions", "organizations_url": "https://api.github.com/users/jweinst1/orgs", "repos_url": "https://api.github.com/users/jweinst1/repos", "events_url": "https://api.github.com/users/jweinst1/events{/privacy}", "received_events_url": "https://api.github.com/users/jweinst1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-09-29T16:02:36Z", "updated_at": "2021-09-29T19:37:45Z", "closed_at": "2021-09-29T19:37:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "The bug is that, the method described [here ](https://doc.rust-lang.org/std/primitive.slice.html#method.align_to) does not depend on the length of the slice itself, rather the memory where the slice is from. This is either a bug, or if intentional, quite misleading. Here is an example of the behavior:\r\n\r\n```rust\r\nfn main() {\r\n    let numbers:[u8;33] = [44, 2, 0, 0, 0, 0, 0, 0, 76, 1, 0, 0, 0, 0, 0, 0, 8, 3, 0, 0, 0, 0, 0, 0, 81, 17, 0, 0, 0, 0, 0, 0, 1];\r\n    let aligned = unsafe { numbers[0..32].align_to::<u64>() };\r\n    println!(\"aligned: {:?}\", aligned);\r\n    \r\n    let numbers2:[u8;32] = [44, 2, 0, 0, 0, 0, 0, 0, 76, 1, 0, 0, 0, 0, 0, 0, 8, 3, 0, 0, 0, 0, 0, 0, 81, 17, 0, 0, 0, 0, 0, 0];\r\n    let aligned2 = unsafe { numbers2[0..32].align_to::<u64>() };\r\n    println!(\"aligned2: {:?}\", aligned2);\r\n}\r\n```\r\n\r\nWhich will print\r\n\r\n```rust\r\naligned: ([44], [5476377146882523138, 576460752303423489, 5836665117072162819], [17, 0, 0, 0, 0, 0, 0])\r\naligned2: ([], [556, 332, 776, 4433], [])\r\n```\r\n\r\nThe expected behavior here should be that the alignment takes place according to the type of the slice and the length of the slice.\r\n\r\nInstead, the `align_to` method is aligning with respect to the memory in which the slice is from.\r\n\r\nIf this is not a bug and actually intentional, my concern here is because this method operates on a slice, it's practically useless as one does not know the alignment of the memory the slice is from just from the slice itself. It would make sense to either very clearly line this out in documentation.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.54.0 (a178d0322 2021-07-26)\r\nbinary: rustc\r\ncommit-hash: a178d0322ce20e33eac124758e837cbd80a6f633\r\ncommit-date: 2021-07-26\r\nhost: x86_64-apple-darwin\r\nrelease: 1.54.0\r\nLLVM version: 12.0.1\r\n```\r\n", "closed_by": {"login": "jweinst1", "id": 11132902, "node_id": "MDQ6VXNlcjExMTMyOTAy", "avatar_url": "https://avatars.githubusercontent.com/u/11132902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jweinst1", "html_url": "https://github.com/jweinst1", "followers_url": "https://api.github.com/users/jweinst1/followers", "following_url": "https://api.github.com/users/jweinst1/following{/other_user}", "gists_url": "https://api.github.com/users/jweinst1/gists{/gist_id}", "starred_url": "https://api.github.com/users/jweinst1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jweinst1/subscriptions", "organizations_url": "https://api.github.com/users/jweinst1/orgs", "repos_url": "https://api.github.com/users/jweinst1/repos", "events_url": "https://api.github.com/users/jweinst1/events{/privacy}", "received_events_url": "https://api.github.com/users/jweinst1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89368/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89368/timeline", "performed_via_github_app": null, "state_reason": "completed"}