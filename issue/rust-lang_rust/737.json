{"url": "https://api.github.com/repos/rust-lang/rust/issues/737", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/737/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/737/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/737/events", "html_url": "https://github.com/rust-lang/rust/issues/737", "id": 1285583, "node_id": "MDU6SXNzdWUxMjg1NTgz", "number": 737, "title": "task-comm-15 fails when run with multiple threads", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2011-07-25T23:47:26Z", "updated_at": "2011-08-18T23:10:49Z", "closed_at": "2011-08-18T23:10:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "With RUST_THREADS=16, task-comm-15 occasionally produces valgrind errors like \n\n```\n==8944== Thread 3:\n==8944== Invalid read of size 4\n==8944==    at 0x4AC73CD: pthread_mutex_lock (pthread_mutex_lock.c:50)\n==8944==    by 0x4A2E415: pthread_mutex_lock (forward.c:182)\n==8944==    by 0x48E0D27: lock_and_signal::lock() (lock_and_signal.cpp:46)\n==8944==    by 0x48E10C1: scoped_lock::scoped_lock(lock_and_signal&) (lock_and_signal.cpp:121)\n==8944==    by 0x48E7BF8: rust_chan::send(void*) (rust_chan.cpp:82)\n==8944==    by 0x48E9D11: upcall_send (rust_upcall.cpp:203)\n==8944==    by 0x8048A24: start (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048DD7: main::spawn_wrapper5 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x48E72B0: task_start_wrapper (rust_task.cpp:128)\n==8944==    by 0xDEADBEEE: ???\n==8944==  Address 0x712bebc is 132 bytes inside a block of size 152 free'd\n==8944==    at 0x48CCC02: free (vg_replace_malloc.c:366)\n==8944==    by 0x48EE42C: rust_srv::free(void*) (rust_srv.cpp:12)\n==8944==    by 0x48F14E1: memory_region::free(void*) (memory_region.cpp:58)\n==8944==    by 0x48EE9D6: rust_kernel::free(void*) (rust_kernel.cpp:213)\n==8944==    by 0x48E95E9: upcall_del_port (rust_internal.h:173)\n==8944==    by 0x8048F88: glue_free11 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048F42: glue_drop10 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048C63: _rust_main (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048FBB: _rust_main_wrap (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0xDEADBEEE: ???\n==8944==\n==8944== Invalid read of size 4\n==8944==    at 0x4AC6DAF: __pthread_mutex_lock_full (pthread_mutex_lock.c:139)\n==8944==    by 0x4A2E415: pthread_mutex_lock (forward.c:182)\n==8944==    by 0x48E0D27: lock_and_signal::lock() (lock_and_signal.cpp:46)\n==8944==    by 0x48E10C1: scoped_lock::scoped_lock(lock_and_signal&) (lock_and_signal.cpp:121)\n==8944==    by 0x48E7BF8: rust_chan::send(void*) (rust_chan.cpp:82)\n==8944==    by 0x48E9D11: upcall_send (rust_upcall.cpp:203)\n==8944==    by 0x8048A24: start (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048DD7: main::spawn_wrapper5 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x48E72B0: task_start_wrapper (rust_task.cpp:128)\n==8944==    by 0xDEADBEEE: ???\n==8944==  Address 0x712bebc is 132 bytes inside a block of size 152 free'd\n==8944==    at 0x48CCC02: free (vg_replace_malloc.c:366)\n==8944==    by 0x48EE42C: rust_srv::free(void*) (rust_srv.cpp:12)\n==8944==    by 0x48F14E1: memory_region::free(void*) (memory_region.cpp:58)\n==8944==    by 0x48EE9D6: rust_kernel::free(void*) (rust_kernel.cpp:213)\n==8944==    by 0x48E95E9: upcall_del_port (rust_internal.h:173)\n==8944==    by 0x8048F88: glue_free11 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048F42: glue_drop10 (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n==8944==    by 0x8048C63: _rust_main (in /home/banderson/Dev/rust/build/test/run-pass/task-comm-15.stage1)\n```\n", "closed_by": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/737/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/737/timeline", "performed_via_github_app": null, "state_reason": "completed"}