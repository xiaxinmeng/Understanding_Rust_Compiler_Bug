{"url": "https://api.github.com/repos/rust-lang/rust/issues/54296", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54296/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54296/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54296/events", "html_url": "https://github.com/rust-lang/rust/issues/54296", "id": 360909474, "node_id": "MDU6SXNzdWUzNjA5MDk0NzQ=", "number": 54296, "title": "Trait resolution in associated types depends on ordering of traits in bounds.", "user": {"login": "Lymia", "id": 483849, "node_id": "MDQ6VXNlcjQ4Mzg0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/483849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lymia", "html_url": "https://github.com/Lymia", "followers_url": "https://api.github.com/users/Lymia/followers", "following_url": "https://api.github.com/users/Lymia/following{/other_user}", "gists_url": "https://api.github.com/users/Lymia/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lymia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lymia/subscriptions", "organizations_url": "https://api.github.com/users/Lymia/orgs", "repos_url": "https://api.github.com/users/Lymia/repos", "events_url": "https://api.github.com/users/Lymia/events{/privacy}", "received_events_url": "https://api.github.com/users/Lymia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-09-17T14:57:28Z", "updated_at": "2022-03-04T20:05:55Z", "closed_at": "2022-03-04T20:05:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[The following code](https://play.rust-lang.org/?gist=accaf19c611e4c88c0fb590161e66cb5&version=stable&mode=debug&edition=2015) fails to compile:\r\n\r\n```rust\r\nuse std::ops::*;\r\npub trait Trait {\r\n    type Num: Sized + Shl<usize, Output = Self::Num> + Shl<u32, Output = Self::Num>;\r\n}\r\npub fn function<T: Trait>(t: T::Num, b: usize) -> T::Num {\r\n  t << b\r\n}\r\n```\r\n\r\nIt gives this error:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n --> src/lib.rs:6:8\r\n  |\r\n6 |   t << b\r\n  |        ^ expected u32, found usize\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\nThis error is cleared if the declaration order of the two `Shl` bounds is reversed, as in [the following code](https://play.rust-lang.org/?gist=bf2dc4b7a4870ecb618bf8c6360ac651&version=stable&mode=debug&edition=2015):\r\n\r\n```rust\r\nuse std::ops::*;\r\npub trait Trait {\r\n    type Num: Sized + Shl<u32, Output = Self::Num> + Shl<usize, Output = Self::Num>;\r\n}\r\npub fn function<T: Trait>(t: T::Num, b: usize) -> T::Num {\r\n  t << b\r\n}\r\n```\r\n\r\nThis bug does not seem to happen when the bound is directly specified in the function, instead of through an associated type. In addition, explicitly calling `Shl::<usize>>::shl` works around the issue.\r\n\r\n---------\r\n\r\nIn addition, there is what seems to be an related issue where trait resolution instead depends on the order that the traits are physically declared in. [This code](https://play.rust-lang.org/?gist=d2ae969bbba1a036d9a6899bf6331d32&version=stable&mode=debug&edition=2015) compiles properly:\r\n\r\n```rust\r\nuse std::ops::*;\r\n\r\npub trait CheckedShl: Sized + Shl<u32, Output = Self> { }\r\npub trait PrimInt: Sized + Shl<usize, Output = Self> { }\r\npub trait Trait {\r\n    type Num: PrimInt + CheckedShl;\r\n}\r\npub fn function<T: Trait>(t: T::Num, b: usize) -> T::Num {\r\n  t << b\r\n}\r\n```\r\n\r\nBut [this code](https://play.rust-lang.org/?gist=1ac713e88e96715c06302004225f0615&version=stable&mode=debug&edition=2015) doesn't:\r\n\r\n```rust\r\nuse std::ops::*;\r\n\r\npub trait PrimInt: Sized + Shl<usize, Output = Self> { }\r\npub trait CheckedShl: Sized + Shl<u32, Output = Self> { }\r\npub trait Trait {\r\n    type Num: PrimInt + CheckedShl;\r\n}\r\npub fn function<T: Trait>(t: T::Num, b: usize) -> T::Num {\r\n  t << b\r\n}\r\n```", "closed_by": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54296/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54296/timeline", "performed_via_github_app": null, "state_reason": "completed"}