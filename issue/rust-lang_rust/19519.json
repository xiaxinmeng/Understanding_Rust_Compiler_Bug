{"url": "https://api.github.com/repos/rust-lang/rust/issues/19519", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19519/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19519/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19519/events", "html_url": "https://github.com/rust-lang/rust/issues/19519", "id": 50934571, "node_id": "MDU6SXNzdWU1MDkzNDU3MQ==", "number": 19519, "title": "Bundled gcc/libraries on windows may cause errors when compiling native code", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2014-12-04T06:49:42Z", "updated_at": "2016-09-10T16:26:11Z", "closed_at": "2015-02-20T16:34:35Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I have just run into a problem when building Cargo that looks like as follows:\n- Cargo relies on a number of libraries from the MinGW installation, so when it downloads a Rust snapshot compiler we delete the `gcc.exe` in the distribution.\n- On Windows, we build libcurl from source using a checked in configure script. This configure script runs against the system gcc.\n- The libcurl configure script detects that `strtok_r` is available on the local system in the `libmingwex.a` library in the `/mingw64/x86_64-w64-mingw32/lib` directory. The configure script detects this by running the system gcc against a test file.\n- When Cargo itself is linked together it uses the system gcc again, but this time it has a `-L` flag to the directory where all the Rust bundled gcc libraries are.\n- It turns out that Rust ships a `libmingwex.a`, and this used instead of the `/mingw64` one. It also turns out that this `libmingwex.a` that we ship does **not** contain `strtok_r`.\n- The linking step for Cargo fails because libcurl expected to find `strtok_r` in `libmingwex.a`, but the wrong `libmingwex.a` was linked in so the symbol was ultimately undefined.\n\nI think we may want an installation option for Rust which opts out of installing the bundled gcc compiler (but we still do it by default) to solve this. cc @vadimcn, @brson.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/19519/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19519/timeline", "performed_via_github_app": null, "state_reason": "completed"}