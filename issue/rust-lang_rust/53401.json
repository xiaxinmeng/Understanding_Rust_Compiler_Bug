{"url": "https://api.github.com/repos/rust-lang/rust/issues/53401", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53401/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53401/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53401/events", "html_url": "https://github.com/rust-lang/rust/issues/53401", "id": 350894468, "node_id": "MDU6SXNzdWUzNTA4OTQ0Njg=", "number": 53401, "title": "type validation failed: encountered undefined bytes at (*.vtable_ptr)[3]", "user": {"login": "denisandroid", "id": 13841983, "node_id": "MDQ6VXNlcjEzODQxOTgz", "avatar_url": "https://avatars.githubusercontent.com/u/13841983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/denisandroid", "html_url": "https://github.com/denisandroid", "followers_url": "https://api.github.com/users/denisandroid/followers", "following_url": "https://api.github.com/users/denisandroid/following{/other_user}", "gists_url": "https://api.github.com/users/denisandroid/gists{/gist_id}", "starred_url": "https://api.github.com/users/denisandroid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/denisandroid/subscriptions", "organizations_url": "https://api.github.com/users/denisandroid/orgs", "repos_url": "https://api.github.com/users/denisandroid/repos", "events_url": "https://api.github.com/users/denisandroid/events{/privacy}", "received_events_url": "https://api.github.com/users/denisandroid/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-08-15T17:23:59Z", "updated_at": "2018-08-30T14:17:03Z", "closed_at": "2018-08-30T14:17:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "When developing the library, I encountered a strange error which does not occur on a stable version of the compiler.\r\n\u041f\u0440\u0438 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438 \u044f \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u043b \u0441\u0442\u0440\u0430\u043d\u043d\u0443\u044e \u043e\u0448\u0438\u0431\u043a\u0443, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043d\u0435 \u0432\u043e\u0437\u043d\u0438\u043a\u0430\u0435\u0442 \u0432 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u043e\u0439 \u0432\u0435\u0440\u0441\u0438\u0438 \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440\u0430.\r\n```rust\r\n\r\n/*\r\n-------------------------\r\nVersions of the compiler:\r\n    NIGHTLY(1.30) 2018-08-14 67390c0c312ca2d8649e\r\n    BETA(1.29) 2018-08-09 d600a945a6b189edd295\r\n\r\nerror[E0080]: this static likely exhibits undefined behavior\r\n  --> src/main.rs:11:1\r\n   |\r\n11 | static mut Test: &'static Test<'static> = &Null;\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ type validation failed: encountered undefined bytes at (*.vtable_ptr)[3]\r\n   |\r\n   = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0080`.\r\nerror: Could not compile `playground`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\n-------------------------\r\nVersions of the compiler:\r\n    STABLE (1.28.0)\r\n\r\n!!Compilation is successful on the playground and on the code and only when using a stable compiler.\r\n!!\u041a\u043e\u043c\u043f\u0438\u043b\u044f\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043d\u0430 \u0438\u0433\u0440\u043e\u0432\u043e\u0439 \u043f\u043b\u043e\u0449\u0430\u0434\u043a\u0435 \u0438 \u0432 \u043a\u043e\u0434\u0435, \u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440\u0430.\r\n\r\n*/\r\n\r\n\r\n//The code was written in the likeness of my library\r\n//\u041a\u043e\u0434 \u0431\u044b\u043b \u043d\u0430\u043f\u0438\u0441\u0430\u043d \u043f\u043e \u043f\u043e\u0434\u043e\u0431\u0438\u044e \u043c\u043e\u0435\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438\r\n\r\n\r\n#[allow(dead_code)]\r\n#[allow(non_upper_case_globals)]\r\nstatic mut STATIC_TRAIT: &'static Test<'static> = &Null;\r\n\r\n\r\nfn main() {\r\n    \r\n}\r\n\r\n\r\n//Basic structure\r\n//\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430\r\npub struct Null;\r\n\r\n//The transformed structure\r\n//\u041f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u043d\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430\r\npub struct Null2;\r\n\r\n\r\n\r\npub trait Test<'a>: Test2<'a> {\r\n    //Basic generalization available through static\r\n    //\u041e\u0441\u043d\u043e\u0432\u043d\u043e\u0435 \u043e\u0431\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u0447\u0435\u0440\u0435\u0437 \u0441\u0442\u0430\u0442\u0438\u043a\u0443\r\n}\r\nimpl<'a> Test2<'a> for Null {}\r\nimpl<'a> Test<'a> for Null {}\r\n\r\nimpl<'a> Test2<'a> for Null2 {}\r\nimpl<'a> Test<'a> for Null2 {}\r\n\r\n\r\n//Generalized transformation. It is impossible to merge with the basic generalization\r\n//\u041e\u0431\u043e\u0431\u0449\u0435\u043d\u043d\u043e\u0435 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u0435. \u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u043b\u0438\u0442\u044c\u0441\u044f \u0441 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c \u043e\u0431\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c\r\npub trait Test2<'a> {\r\n    \r\n    //In real code, the transformation of one structure to another\r\n    //\u0412 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u043c \u043a\u043e\u0434\u0435 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0434\u043d\u043e\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0432 \u0434\u0440\u0443\u0433\u0443\u044e\r\n    fn test() -> Null2 where Self: Sized + Test<'a> {\r\n        Null2\r\n    }\r\n    \r\n}\r\n\r\n//#Ulin 17-18 :)\r\n\r\n\r\n\r\n/*\r\n    Additionally!!!\r\n    \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u043e!!!\r\n    \r\n    ```\r\n    fn test() -> Null2 where Self: Sized + Test<'a> {\r\n        Null2\r\n    }\r\n    ```\r\n    Convert to ->\r\n    \r\n    ```\r\n    fn test() -> Null2 where Self: Test<'a> {\r\n        Null2\r\n    }\r\n    ```\r\n    \r\n    error[E0038]: the trait `Test` cannot be made into an object\r\n  --> src/main.rs:39:1\r\n   |\r\n39 | static mut STATIC_TRAIT: &'static Test<'static> = &Null;\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Test` cannot be made into an object\r\n   |\r\n   = note: method `test` has no receiver\r\n   \r\n   Ie, as I understand it, the compiler scolds itself because of the lack of function??\r\n   \u0422.\u0435., \u043a\u0430\u043a \u044f \u043f\u043e\u043d\u0438\u043c\u0430\u044e, \u043a\u043e\u043c\u043f\u0438\u043b\u044f\u0442\u043e\u0440 \u0440\u0443\u0433\u0430\u0435\u0442 \u0441\u0430\u043c \u0441\u0435\u0431\u044f \u0438\u0437-\u0437\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0438?\r\n*/\r\n\r\n\r\n\r\n\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?gist=b0b7a5e979ef59362e9d235fe7c329d8&version=nightly&mode=debug&edition=2015))", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53401/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53401/timeline", "performed_via_github_app": null, "state_reason": "completed"}