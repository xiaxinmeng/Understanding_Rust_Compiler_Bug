{"url": "https://api.github.com/repos/rust-lang/rust/issues/43765", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43765/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43765/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43765/events", "html_url": "https://github.com/rust-lang/rust/issues/43765", "id": 249067871, "node_id": "MDU6SXNzdWUyNDkwNjc4NzE=", "number": 43765, "title": "string fmt bug on nightly", "user": {"login": "vitiral", "id": 5587659, "node_id": "MDQ6VXNlcjU1ODc2NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/5587659?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vitiral", "html_url": "https://github.com/vitiral", "followers_url": "https://api.github.com/users/vitiral/followers", "following_url": "https://api.github.com/users/vitiral/following{/other_user}", "gists_url": "https://api.github.com/users/vitiral/gists{/gist_id}", "starred_url": "https://api.github.com/users/vitiral/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vitiral/subscriptions", "organizations_url": "https://api.github.com/users/vitiral/orgs", "repos_url": "https://api.github.com/users/vitiral/repos", "events_url": "https://api.github.com/users/vitiral/events{/privacy}", "received_events_url": "https://api.github.com/users/vitiral/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/37", "html_url": "https://github.com/rust-lang/rust/milestone/37", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/37/labels", "id": 2628348, "node_id": "MDk6TWlsZXN0b25lMjYyODM0OA==", "number": 37, "title": "1.20", "description": "", "creator": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 6, "state": "closed", "created_at": "2017-07-07T20:45:56Z", "updated_at": "2017-10-19T19:37:34Z", "due_on": "2017-08-31T07:00:00Z", "closed_at": "2017-08-28T14:19:42Z"}, "comments": 6, "created_at": "2017-08-09T15:21:38Z", "updated_at": "2017-08-23T06:06:28Z", "closed_at": "2017-08-23T06:06:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I develop [artifact](https://github.com/vitiral/artifact) on nightly and publish using stable, so I am sensitive to changes that happen in nightly but not stable.\r\n\r\n\r\nRight now the `fmt` functionality seems to be partially broken on nightly. [this commit](https://github.com/vitiral/artifact/commit/6c0f823dd0d8ee9b3a1162cd66e229bddecd8817) fails the unit test (running `cargo test`) `cmd::tests::test_ls::test_cmd_check`:\r\n\r\n\r\n\r\n```\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.                                                                                                                            \r\nstack backtrace:                                                                                                                                                                                                   \r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace                                                                                                                                                     \r\n             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49                                                                                                                                        \r\n   1: std::sys_common::backtrace::_print                                                                                                                                                                           \r\n             at /checkout/src/libstd/sys_common/backtrace.rs:71                                                                                                                                                   \r\n   2: std::panicking::default_hook::{{closure}}                                                                                                                                                                    \r\n             at /checkout/src/libstd/sys_common/backtrace.rs:60                                                                                                                                                    \r\n             at /checkout/src/libstd/panicking.rs:380                                                                                                                                                              \r\n   3: std::panicking::default_hook                                                                                                                                                                                 \r\n             at /checkout/src/libstd/panicking.rs:390                                                                                                                                                             \r\n   4: std::panicking::rust_panic_with_hook                                                                                                                                                                        \r\n             at /checkout/src/libstd/panicking.rs:610                                                    \r\n   5: std::panicking::begin_panic                                                                                                                                                                                  \r\n             at /checkout/src/libstd/panicking.rs:571                                                                                                                                                              \r\n   6: std::panicking::begin_panic_fmt                                                                                                                                                                              \r\n             at /checkout/src/libstd/panicking.rs:521                                                                                                                                                              \r\n   7: artifact_app::cmd::tests::test_ls::test_cmd_check                                                                                                                                                            \r\n             at src/cmd/tests/test_ls.rs:260                                                                                                                                                                      \r\n   8: <F as test::FnBox<T>>::call_box                                                                                                                                                                              \r\n             at /checkout/src/libtest/lib.rs:1477                                                                                                                                                                  \r\n             at /checkout/src/libcore/ops/function.rs:143                                                                                                                                                          \r\n             at /checkout/src/libtest/lib.rs:138                                                                                                                                                                   \r\n   9: __rust_maybe_catch_panic                                                                                                                                                                                     \r\n             at /checkout/src/libpanic_unwind/lib.rs:98                                                                                                                                                            \r\n                                                                                             \r\n                                                                                                                                                                                                                   \r\nfailures:                                                                                                                                                                                                          \r\n    cmd::tests::test_ls::test_cmd_check                                                                                                                                                                            \r\n                                                                                                                                                                                                                   \r\ntest result: FAILED. 34 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out                                                                                                                                    \r\n                                                                                                                                                                                                                  \r\nerror: test failed, to rerun pass '--lib'               \r\n```\r\n\r\n\r\nThe test prints the expected/result. That printout is:\r\n```\r\nDebug Result:                                                                                                                                                                                                      \r\n                                                                                                                                                                                                                  \r\nFound partof names that do not exist:                                                                                                                                                                              \r\n- REQ-invalid-parts [../../reqs/foo.toml]: {REQ-DNE}                                                                                                                                                               \r\n                                                                                                                                                                                                                   \r\nArtifacts partof contains at least one recursive reference:                                                                                                                                                        \r\n- SPC-unresolvable              : [SPC-UNRESOLVABLE-1-1]                                                                                                                                                          \r\n- SPC-unresolvable-1            : [SPC-UNRESOLVABLE]                                                                                                                                                              \r\n- SPC-unresolvable-1-1          : [SPC-UNRESOLVABLE-1]                                                   \r\n                                                                                                                                                                                                                   \r\nFound implementation links in the code that do not exist:                                                                                                                                                          \r\n- ../../fake:                                                                                                                                                                                                      \r\n  - [42] SPC-dne                                                                                                                                                                                                   \r\n                                                                                                                                                                                                                   \r\nHanging artifacts found (top-level but not partof a higher type):                                                                                                                                                 \r\n- ../../reqs/foo.toml: TST-line                                                                                                                                                                                    \r\n                                                                                                                                                                                                                   \r\nRepr Result:                                                                                                                                                                                                       \r\n\\x1b[1;31m\\nFound partof names that do not exist:\\n\\x1b[0m\\x1b[31m- REQ-invalid-parts [../../reqs/foo.toml]: {REQ-DNE}\\n\\x1b[0m\\x1b[1;31m\\nArtifacts partof contains at least one recursive reference:\\n\\x1b[0m- SP\r\nC-unresolvable              : [SPC-UNRESOLVABLE-1-1]\\n- SPC-unresolvable-1            : [SPC-UNRESOLVABLE]\\n- SPC-unresolvable-1-1          : [SPC-UNRESOLVABLE-1]\\n\\x1b[1;31m\\nFound implementation links in the c\r\node that do not exist:\\n\\x1b[0m\\x1b[31m- ../../fake:\\n\\x1b[0m\\x1b[31m  - [42]\\x1b[0m SPC-dne\\n\\x1b[1;31m\\nHanging artifacts found (top-level but not partof a higher type):\\n\\x1b[0m- ../../reqs/foo.toml: TST-line\r\n\\n\\n                                                                                         \r\n--Result Repr DONE\r\n```\r\n\r\n```\r\nDebug Expected:                                                                                                                                                                                                    \r\n                                                                                                                                                                                                                   \r\nFound partof names that do not exist:                                                                                                                                                                              \r\n- REQ-invalid-parts [../../reqs/foo.toml]: {REQ-DNE}                                                                                                                                                               \r\n                                                                                                                                                                                                                  \r\nArtifacts partof contains at least one recursive reference:                                                                                                                                                        \r\n- SPC-unresolvable              : [SPC-UNRESOLVABLE-1-1]                                                                                                                                                           \r\n- SPC-unresolvable-1            : [SPC-UNRESOLVABLE]                                                                                                                                                               \r\n- SPC-unresolvable-1-1          : [SPC-UNRESOLVABLE-1]                                                                                                                                                             \r\n                                                                                                                                                                                                                  \r\nFound implementation links in the code that do not exist:                                                                                                                                                         \r\n- ../../fake:                                                                                            \r\n  - [42] SPC-dne                                                                                                                                                                                                   \r\n                                                                                                                                                                                                                   \r\nHanging artifacts found (top-level but not partof a higher type):                                                                                                                                                  \r\n- ../../reqs/foo.toml           : TST-line                                                                                                                                                                         \r\n                                                                                                                                                                                                                   \r\nRepr Expected:                                                                                                                                                                                                    \r\n\\x1b[1;31m\\nFound partof names that do not exist:\\n\\x1b[0m\\x1b[31m- REQ-invalid-parts [../../reqs/foo.toml]: {REQ-DNE}\\n\\x1b[0m\\x1b[1;31m\\nArtifacts partof contains at least one recursive reference:\\n\\x1b[0m- SP\r\nC-unresolvable              : [SPC-UNRESOLVABLE-1-1]\\n- SPC-unresolvable-1            : [SPC-UNRESOLVABLE]\\n- SPC-unresolvable-1-1          : [SPC-UNRESOLVABLE-1]\\n\\x1b[1;31m\\nFound implementation links in the c\r\node that do not exist:\\n\\x1b[0m\\x1b[31m- ../../fake:\\n\\x1b[0m\\x1b[31m  - [42]\\x1b[0m SPC-dne\\n\\x1b[1;31m\\nHanging artifacts found (top-level but not partof a higher type):\\n\\x1b[0m- ../../reqs/foo.toml          \r\n : TST-line\\n\\n                                                                                                                                                                                                    \r\n--Expected Repr DONE\r\n```\r\n\r\nThe difference between the two (that I can spot) is these two lines:\r\n```\r\n# result\r\n- ../../reqs/foo.toml: TST-line\r\n# expected                                                                                                                                         \r\n- ../../reqs/foo.toml           : TST-line\r\n```\r\n\r\nI went into the code to find what generates this formatting, it is in `src/cmd/check.rs` line 234:\r\n```\r\n            write!(\r\n                msg,\r\n                \"- {:<30}: {}\\n\",\r\n                utils::relative_path(p, cwd).display(),\r\n                h\r\n            ).unwrap();\r\n```\r\n\r\nOddly, there is a very similar line of code that is used to generate the `Artifacts partof contains at least one recursive reference:` section of the output. That line of code is in the same file, line 159:\r\n```\r\nwrite!(msg, \"- {:<30}: {:?}\\n\", name.to_string(), partof).unwrap();\r\n```\r\n\r\nThat line works, the other one doesn't. Why? That I have no clue about...\r\n\r\n## Meta\r\n\r\nThis passes (running `cargo test`) on \r\n```\r\n$ rustc --version --verbose   \r\nrustc 1.19.0 (0ade33941 2017-07-17)                 \r\nbinary: rustc             \r\ncommit-hash: 0ade339411587887bf01bcfa2e9ae4414c8900d4                                                    \r\ncommit-date: 2017-07-17   \r\nhost: x86_64-unknown-linux-gnu                      \r\nrelease: 1.19.0           \r\nLLVM version: 4.0\r\n```\r\n\r\nAnd fails on\r\n```\r\n$ rustc --version --verbose                                                                                                                                                           \r\nrustc 1.21.0-nightly (cbbe17aa7 2017-08-07)                                                                                                                                                                       \r\nbinary: rustc\r\ncommit-hash: cbbe17aa7f13f9568a652c2180de03fa6881b86a\r\ncommit-date: 2017-08-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.21.0-nightly\r\nLLVM version: 4.0\r\n\r\n# and fails for this as well\r\n$ rustc --version                                                                                                                                                                     \r\nrustc 1.21.0-nightly (b75d1f0ce 2017-08-02)\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43765/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43765/timeline", "performed_via_github_app": null, "state_reason": "completed"}