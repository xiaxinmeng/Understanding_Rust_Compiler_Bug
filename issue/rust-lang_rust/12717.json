{"url": "https://api.github.com/repos/rust-lang/rust/issues/12717", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12717/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12717/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12717/events", "html_url": "https://github.com/rust-lang/rust/issues/12717", "id": 28828267, "node_id": "MDU6SXNzdWUyODgyODI2Nw==", "number": 12717, "title": "Lifetime Pointer to Lifetime Closure Bug", "user": {"login": "bvssvni", "id": 1743862, "node_id": "MDQ6VXNlcjE3NDM4NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1743862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bvssvni", "html_url": "https://github.com/bvssvni", "followers_url": "https://api.github.com/users/bvssvni/followers", "following_url": "https://api.github.com/users/bvssvni/following{/other_user}", "gists_url": "https://api.github.com/users/bvssvni/gists{/gist_id}", "starred_url": "https://api.github.com/users/bvssvni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bvssvni/subscriptions", "organizations_url": "https://api.github.com/users/bvssvni/orgs", "repos_url": "https://api.github.com/users/bvssvni/repos", "events_url": "https://api.github.com/users/bvssvni/events{/privacy}", "received_events_url": "https://api.github.com/users/bvssvni/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2014-03-05T21:38:48Z", "updated_at": "2014-12-15T10:42:36Z", "closed_at": "2014-12-15T10:42:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was told in the IRC channel the bug is Test::new missing a \"'a\" and should give the same warning as Test2::new.\n\n``` rust\nrustc 0.10-pre (0a5138c 2014-03-04 13:16:41 -0800)\n\n/// A struct with borrowed pointer to a closure.\n/// This is to be able to reuse the closure then struct runs out of scope.\n\npub struct Test<'a> {\n    f: &'a 'a ||\n}\n\nimpl<'a> Test<'a> {\n        // This should give the same warning as Test2.\n    pub fn new(f: &'a ||) -> Test<'a> {\n        Test { f: f }\n    }\n}\n\npub struct Test2<'a> {\n    f: Option<&'a 'a ||>\n}\n\nimpl<'a> Test2<'a> {\n    pub fn new(f: &'a ||) -> Test2<'a> {\n        Test2 { f: Some(f) }\n    }\n}\n\nfn main() {\n    let x = || println!(\"hello!\");\n\n    // Works\n    (*Test::new(&x).f)();\n\n    // Fails\n    (*Test2::new(&x).f.unwrap())();\n}\n\n\nCompiler error:\noptionclosure.rs:21:3: 21:23 error: cannot infer an appropriate lifetime for region in type/impl due to conflicting requirements\noptionclosure.rs:21         Test2 { f: Some(f) }\n                            ^~~~~~~~~~~~~~~~~~~~\noptionclosure.rs:21:14: 21:21 note: first, the lifetime cannot outlive the call at 21:13...\noptionclosure.rs:21         Test2 { f: Some(f) }\n                                       ^~~~~~~\noptionclosure.rs:21:14: 21:21 note: ...so that return value is valid for the call\noptionclosure.rs:21         Test2 { f: Some(f) }\n                                       ^~~~~~~\noptionclosure.rs:20:37: 22:3 note: but, the lifetime must be valid for the lifetime &'a  as defined on the block at 20:36...\noptionclosure.rs:20     pub fn new(f: &'a ||) -> Test2<'a> {\noptionclosure.rs:21         Test2 { f: Some(f) }\noptionclosure.rs:22     }\noptionclosure.rs:21:3: 21:23 note: ...so that types are compatible (expected `Test2<'a>` but found `Test2<>`)\noptionclosure.rs:21         Test2 { f: Some(f) }\n```\n", "closed_by": {"login": "bvssvni", "id": 1743862, "node_id": "MDQ6VXNlcjE3NDM4NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1743862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bvssvni", "html_url": "https://github.com/bvssvni", "followers_url": "https://api.github.com/users/bvssvni/followers", "following_url": "https://api.github.com/users/bvssvni/following{/other_user}", "gists_url": "https://api.github.com/users/bvssvni/gists{/gist_id}", "starred_url": "https://api.github.com/users/bvssvni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bvssvni/subscriptions", "organizations_url": "https://api.github.com/users/bvssvni/orgs", "repos_url": "https://api.github.com/users/bvssvni/repos", "events_url": "https://api.github.com/users/bvssvni/events{/privacy}", "received_events_url": "https://api.github.com/users/bvssvni/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12717/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12717/timeline", "performed_via_github_app": null, "state_reason": "completed"}