{"url": "https://api.github.com/repos/rust-lang/rust/issues/69222", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69222/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69222/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69222/events", "html_url": "https://github.com/rust-lang/rust/issues/69222", "id": 566017963, "node_id": "MDU6SXNzdWU1NjYwMTc5NjM=", "number": 69222, "title": "Building rustc in Clang 9.0 error: invalid argument '-std=c++11' not allowed with 'C'", "user": {"login": "konimex", "id": 15692230, "node_id": "MDQ6VXNlcjE1NjkyMjMw", "avatar_url": "https://avatars.githubusercontent.com/u/15692230?v=4", "gravatar_id": "", "url": "https://api.github.com/users/konimex", "html_url": "https://github.com/konimex", "followers_url": "https://api.github.com/users/konimex/followers", "following_url": "https://api.github.com/users/konimex/following{/other_user}", "gists_url": "https://api.github.com/users/konimex/gists{/gist_id}", "starred_url": "https://api.github.com/users/konimex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/konimex/subscriptions", "organizations_url": "https://api.github.com/users/konimex/orgs", "repos_url": "https://api.github.com/users/konimex/repos", "events_url": "https://api.github.com/users/konimex/events{/privacy}", "received_events_url": "https://api.github.com/users/konimex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 593503757, "node_id": "MDU6TGFiZWw1OTM1MDM3NTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-infra", "name": "T-infra", "color": "bfd4f2", "default": false, "description": "Relevant to the infrastructure team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-17T02:16:29Z", "updated_at": "2021-05-27T06:40:46Z", "closed_at": "2021-05-27T06:40:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello, I'm trying to build a pure-LLVM Rust (no linking to `libgcc_s.so` at all). Building rust with `clang` set as `cc` in `target.x86_64-unknown-linux-musl` returns failure since Clang (the C compiler) doesn't allow `std=c++11`.\r\n\r\nHere's my `config.toml`:\r\n```toml\r\n[llvm]\r\nlink-shared = true\r\n\r\n[build]\r\nbuild = \"x86_64-unknown-linux-musl\"\r\nhost = [ \"x86_64-unknown-linux-musl\" ]\r\ntarget = [ \"x86_64-unknown-linux-musl\" ]\r\ndocs = false\r\nextended = true\r\nsubmodules = false\r\npython = \"python3\"\r\nlocked-deps = true\r\nvendor = true\r\n\r\n[install]\r\nprefix = \"/usr\"\r\n\r\n[rust]\r\nchannel = \"stable\"\r\nrpath = false\r\ncodegen-units = 1\r\ndebuginfo-level = 0\r\nbacktrace = false\r\njemalloc = false\r\ncodegen-tests = false\r\nllvm-libunwind = true\r\n\r\n[target.x86_64-unknown-linux-musl]\r\ncc = \"clang\"\r\ncxx = \"clang++\"\r\nlinker = \"clang\"\r\nllvm-config = \"/usr/bin/llvm-config\"\r\ncrt-static = false\r\n```\r\n\r\nHere are the relevant bits of the log:\r\n```\r\nBuilding stage0 std artifacts (x86_64-unknown-linux-musl -> x86_64-unknown-linux-musl)\r\n   Compiling cc v1.0.47\r\n   Compiling core v0.0.0 (/home/koni/.cache/kiss/build-20469/rust/src/libcore)\r\n   Compiling libc v0.2.64\r\n   Compiling autocfg v0.1.6\r\n   Compiling std v0.0.0 (/home/koni/.cache/kiss/build-20469/rust/src/libstd)\r\n   Compiling hashbrown v0.6.2\r\n   Compiling compiler_builtins v0.1.22\r\n   Compiling unwind v0.0.0 (/home/koni/.cache/kiss/build-20469/rust/src/libunwind)\r\n   Compiling backtrace-sys v0.1.32\r\n   Compiling rustc-std-workspace-core v1.99.0 (/home/koni/.cache/kiss/build-20469/rust/src/tools/rustc-std-workspace-core)\r\nerror: failed to run custom build command for `unwind v0.0.0 (/home/koni/.cache/kiss/build-20469/rust/src/libunwind)`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/release/build/unwind-078e32742eabfcea/build-script-build` (exit code: 1)\r\n--- stdout\r\ncargo:rerun-if-changed=build.rs\r\ncargo:rustc-link-search=native=/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/x86_64-unknown-linux-musl/release/build/unwind-ab6a3e65ec86ddbe/out\r\nrunning: \"clang\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-I\" \"../llvm-project/libunwind/include\" \"-std=c99\" \"-std=c++11\" \"-nostdinc++\" \"-fno-exceptions\" \"-fno-rtti\" \"-fstrict-aliasing\" \"-funwind-tables\" \"-D__LITTLE_ENDIAN__=1\" \"-o\" \"/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/x86_64-unknown-linux-musl/release/build/unwind-ab6a3e65ec86ddbe/out/../llvm-project/libunwind/src/Unwind-EHABI.o\" \"-c\" \"../llvm-project/libunwind/src/Unwind-EHABI.cpp\"\r\nexit code: 0\r\nrunning: \"clang\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-I\" \"../llvm-project/libunwind/include\" \"-std=c99\" \"-std=c++11\" \"-nostdinc++\" \"-fno-exceptions\" \"-fno-rtti\" \"-fstrict-aliasing\" \"-funwind-tables\" \"-D__LITTLE_ENDIAN__=1\" \"-o\" \"/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/x86_64-unknown-linux-musl/release/build/unwind-ab6a3e65ec86ddbe/out/../llvm-project/libunwind/src/Unwind-seh.o\" \"-c\" \"../llvm-project/libunwind/src/Unwind-seh.cpp\"\r\nexit code: 0\r\nrunning: \"clang\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-I\" \"../llvm-project/libunwind/include\" \"-std=c99\" \"-std=c++11\" \"-nostdinc++\" \"-fno-exceptions\" \"-fno-rtti\" \"-fstrict-aliasing\" \"-funwind-tables\" \"-D__LITTLE_ENDIAN__=1\" \"-o\" \"/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/x86_64-unknown-linux-musl/release/build/unwind-ab6a3e65ec86ddbe/out/../llvm-project/libunwind/src/Unwind-sjlj.o\" \"-c\" \"../llvm-project/libunwind/src/Unwind-sjlj.c\"\r\ncargo:warning=error: invalid argument '-std=c++11' not allowed with 'C'\r\nexit code: 1\r\n\r\n--- stderr\r\n\r\n\r\nerror occurred: Command \"clang\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"--target=x86_64-unknown-linux-musl\" \"-I\" \"../llvm-project/libunwind/include\" \"-std=c99\" \"-std=c++11\" \"-nostdinc++\" \"-fno-exceptions\" \"-fno-rtti\" \"-fstrict-aliasing\" \"-funwind-tables\" \"-D__LITTLE_ENDIAN__=1\" \"-o\" \"/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0-std/x86_64-unknown-linux-musl/release/build/unwind-ab6a3e65ec86ddbe/out/../llvm-project/libunwind/src/Unwind-sjlj.o\" \"-c\" \"../llvm-project/libunwind/src/Unwind-sjlj.c\" with args \"clang\" did not execute successfully (status code exit code: 1).\r\n\r\n\r\n\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\ncommand did not execute successfully: \"/home/koni/.cache/kiss/build-20469/rust/build/x86_64-unknown-linux-musl/stage0/bin/cargo\" \"build\" \"-Zconfig-profile\" \"--target\" \"x86_64-unknown-linux-musl\" \"-Zbinary-dep-depinfo\" \"-j\" \"4\" \"--release\" \"--locked\" \"--frozen\" \"--features\" \"panic-unwind llvm-libunwind compiler-builtins-c\" \"--manifest-path\" \"/home/koni/.cache/kiss/build-20469/rust/src/libtest/Cargo.toml\" \"--message-format\" \"json-render-diagnostics\"\r\nexpected success, got: exit code: 101\r\nfailed to run: /home/koni/.cache/kiss/build-20469/rust/build/bootstrap/debug/bootstrap build -j 4\r\nBuild completed unsuccessfully in 0:01:09\r\n```\r\n\r\nThanks.\r\n\r\nA complete log is available here:\r\nhttp://termbin.com/ex3p", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69222/timeline", "performed_via_github_app": null, "state_reason": "completed"}