{"url": "https://api.github.com/repos/rust-lang/rust/issues/27333", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27333/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27333/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27333/events", "html_url": "https://github.com/rust-lang/rust/issues/27333", "id": 97540901, "node_id": "MDU6SXNzdWU5NzU0MDkwMQ==", "number": 27333, "title": "LLVM crash with SIMD types and inline asm", "user": {"login": "cesarb", "id": 31324, "node_id": "MDQ6VXNlcjMxMzI0", "avatar_url": "https://avatars.githubusercontent.com/u/31324?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cesarb", "html_url": "https://github.com/cesarb", "followers_url": "https://api.github.com/users/cesarb/followers", "following_url": "https://api.github.com/users/cesarb/following{/other_user}", "gists_url": "https://api.github.com/users/cesarb/gists{/gist_id}", "starred_url": "https://api.github.com/users/cesarb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cesarb/subscriptions", "organizations_url": "https://api.github.com/users/cesarb/orgs", "repos_url": "https://api.github.com/users/cesarb/repos", "events_url": "https://api.github.com/users/cesarb/events{/privacy}", "received_events_url": "https://api.github.com/users/cesarb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 91598611, "node_id": "MDU6TGFiZWw5MTU5ODYxMQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inline-assembly", "name": "A-inline-assembly", "color": "f7e101", "default": false, "description": "Area: inline asm!(..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-07-27T19:44:53Z", "updated_at": "2020-05-24T13:40:57Z", "closed_at": "2020-05-24T13:40:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I wrote some code which extracts the two halves of a u64x4, calls some arm neon inline assembly on each half, and combines them again. Trying to compile that code for arm crashes the compiler deep in the LLVM code.\n\nI had previously used the exact same inline assembly without any problem, but I rewrote the surrounding code (previously, the two halves were already kept separate as a pair of u64x2).\n\nThe crashing code can be found at https://github.com/cesarb/blake2-rfc/commit/36708b280cc19f5305d45cf3aac7b2dd825d194a (the working code with the same inline asm can be found two commits before that one). Unfortunately, I failed to extract a reduced testcase; the crash only happens when the code is inlined inside the rest of the BLAKE2 core. The crash location within the LLVM code seems to point to some register allocation issue.\n\nTo reproduce the crash, you need a nightly rustc configured for cross-compiling to android, checkout that commit, and run the following command: `cargo build -v --release --features=\"bench simd_asm\" --target=arm-linux-androideabi` (the offending code is gated by the \"simd_asm\" feature in the `Cargo.toml`).\n\nExpected result: compile correctly so I can copy and modify the rustc command line to add a `-C target-cpu=cortex-a9 -C target-feature=+neon` and run the tests and benchmarks on my phone.\n\nWhat happens: `Process didn't exit successfully: [...] (signal: 4)` (which is SIGILL according to `kill -l`). Using `rust-gdb` reveals the crash is deep within the LLVM code.\n\nVersions:\n\n```\nrustc 1.3.0-dev (eefd6b2c1 2015-07-27)\nbinary: rustc\ncommit-hash: eefd6b2c12c8257c85f2121d7f5a3694b192e755\ncommit-date: 2015-07-27\nhost: x86_64-unknown-linux-gnu\nrelease: 1.3.0-dev\n```\n\n```\ncargo 0.4.0 (1ce0146 2015-07-27) (built 2015-07-27)\n```\n", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27333/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27333/timeline", "performed_via_github_app": null, "state_reason": "completed"}