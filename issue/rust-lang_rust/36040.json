{"url": "https://api.github.com/repos/rust-lang/rust/issues/36040", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36040/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36040/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36040/events", "html_url": "https://github.com/rust-lang/rust/issues/36040", "id": 173599600, "node_id": "MDU6SXNzdWUxNzM1OTk2MDA=", "number": 36040, "title": "Conservative impl trait does not seem to work with anonymous types", "user": {"login": "MaikKlein", "id": 1994306, "node_id": "MDQ6VXNlcjE5OTQzMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1994306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaikKlein", "html_url": "https://github.com/MaikKlein", "followers_url": "https://api.github.com/users/MaikKlein/followers", "following_url": "https://api.github.com/users/MaikKlein/following{/other_user}", "gists_url": "https://api.github.com/users/MaikKlein/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaikKlein/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaikKlein/subscriptions", "organizations_url": "https://api.github.com/users/MaikKlein/orgs", "repos_url": "https://api.github.com/users/MaikKlein/repos", "events_url": "https://api.github.com/users/MaikKlein/events{/privacy}", "received_events_url": "https://api.github.com/users/MaikKlein/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-08-27T14:50:55Z", "updated_at": "2016-08-27T17:11:05Z", "closed_at": "2016-08-27T17:11:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\n#![feature(conservative_impl_trait)]\ntrait UniqueObj\n    where Self: std::marker::Sized {\n    fn create_handle(&self) -> Handle<Self>;\n    fn accept_handle(&self, handle: &Handle<Self>);\n}\nstruct Handle<Owner> {\n    _m: marker::PhantomData<Owner>\n}\n\nstruct Container<T> {\n    _m: marker::PhantomData<T>\n}\n\nimpl<T> UniqueObj for Container<T>\n    where T: marker::Sized {\n\n    fn create_handle(&self) -> Handle<Self> {\n        Handle{_m: marker::PhantomData}\n    }\n\n    fn accept_handle(&self, handle: &Handle<Self>){\n    }\n}\n\nfn create_container() -> impl UniqueObj {\n    struct Anon{}\n    let f: Container<Anon> = Container{ _m: marker::PhantomData };\n    f\n}\n\nfn main() {\n    let c = create_container();\n    let c1 = create_container();\n    let handle = c.create_handle();\n    c.accept_handle(&handle);\n    c1.accept_handle(&handle); // Should be a compile error\n}\n```\n\n[playpen](https://play.rust-lang.org/?gist=9e2469798d91f973d5724c02fdc64622&version=nightly&backtrace=0)\nBasically what I was trying to do was to bind a handle to a specific instantiation of a container. It should not be allowed to pass handle from one container to another container. \n\nSo I had the idea of using the new `impl syntax` in combination with an anonymous type. Here `create_container()` should return a different type for every instantiation, at least the way I understand it. But I am still able to pass `handle` into both containers.\n\n`fn accept_handle(&self, handle: &Handle<Self>);` should accept `Handle<Container<Anon>>` which it does but the `Anon` should be a different `Anon` for `c` and `c1`.\n\nIs this a bug?\n\nI am on `rustc 1.13.0-nightly (e07dd59ea 2016-08-25)`\n", "closed_by": {"login": "MaikKlein", "id": 1994306, "node_id": "MDQ6VXNlcjE5OTQzMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1994306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MaikKlein", "html_url": "https://github.com/MaikKlein", "followers_url": "https://api.github.com/users/MaikKlein/followers", "following_url": "https://api.github.com/users/MaikKlein/following{/other_user}", "gists_url": "https://api.github.com/users/MaikKlein/gists{/gist_id}", "starred_url": "https://api.github.com/users/MaikKlein/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MaikKlein/subscriptions", "organizations_url": "https://api.github.com/users/MaikKlein/orgs", "repos_url": "https://api.github.com/users/MaikKlein/repos", "events_url": "https://api.github.com/users/MaikKlein/events{/privacy}", "received_events_url": "https://api.github.com/users/MaikKlein/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36040/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36040/timeline", "performed_via_github_app": null, "state_reason": "completed"}