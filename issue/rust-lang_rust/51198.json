{"url": "https://api.github.com/repos/rust-lang/rust/issues/51198", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51198/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51198/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51198/events", "html_url": "https://github.com/rust-lang/rust/issues/51198", "id": 327542135, "node_id": "MDU6SXNzdWUzMjc1NDIxMzU=", "number": 51198, "title": "Command's Debug impl has incorrect shell escaping", "user": {"login": "comex", "id": 47517, "node_id": "MDQ6VXNlcjQ3NTE3", "avatar_url": "https://avatars.githubusercontent.com/u/47517?v=4", "gravatar_id": "", "url": "https://api.github.com/users/comex", "html_url": "https://github.com/comex", "followers_url": "https://api.github.com/users/comex/followers", "following_url": "https://api.github.com/users/comex/following{/other_user}", "gists_url": "https://api.github.com/users/comex/gists{/gist_id}", "starred_url": "https://api.github.com/users/comex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/comex/subscriptions", "organizations_url": "https://api.github.com/users/comex/orgs", "repos_url": "https://api.github.com/users/comex/repos", "events_url": "https://api.github.com/users/comex/events{/privacy}", "received_events_url": "https://api.github.com/users/comex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-05-30T01:35:58Z", "updated_at": "2019-08-13T11:11:42Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On Unix, the Debug impl for Command prints the command using quotes around each argument, e.g.\r\n\r\n    \"ls\" \"-la\" \"\\\"foo \\\"\"\r\n\r\nThe use of spaces as a delimiter suggests that the output is suitable to be passed to a shell.  While it's debatable whether users should be depending on any specific debug representation, in practice, at least rustc itself uses it for user-facing output (when passing `-Z print-link-args`).\r\n\r\nThere are two problems with this:\r\n\r\n1. It's insecure!  The quoting is performed, via the `Debug` impl for `CStr`, by `ascii::escape_default`, whose escaping rules are\r\n\r\n   > chosen with a bias toward producing literals that are legal in a variety of languages, including C++11 and similar C-family languages.\r\n\r\n   However, this does not include escaping the characters $, \\`, and !, which have a special meaning within double quotes in Unix shell syntax.  So, for example:\r\n   ```rust\r\n   let mut cmd = Command::new(\"foo\");\r\n   cmd.arg(\"`echo 123`\");\r\n   println!(\"{:?}\", cmd);\r\n   ```\r\n   prints\r\n   ```\r\n   \"foo\" \"`echo 123`\"\r\n   ```\r\n   but if you run that in a shell, it won't produce the same behavior as the original command.\r\n\r\n2. It's noisy.  In a long command line like those produced by `-Z print-link-args`, most arguments don't contain any characters that need to be quoted or escaped, and the output is long enough without unnecessary quotes.\r\n\r\nCargo uses the `shell-escape` crate for this purpose; perhaps that code can be copied into libstd.\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51198/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51198/timeline", "performed_via_github_app": null, "state_reason": null}