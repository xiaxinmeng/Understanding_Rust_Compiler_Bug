{"url": "https://api.github.com/repos/rust-lang/rust/issues/59030", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59030/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59030/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59030/events", "html_url": "https://github.com/rust-lang/rust/issues/59030", "id": 418974006, "node_id": "MDU6SXNzdWU0MTg5NzQwMDY=", "number": 59030, "title": "Struct field initialization code order matters", "user": {"login": "kaikalii", "id": 13109248, "node_id": "MDQ6VXNlcjEzMTA5MjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/13109248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kaikalii", "html_url": "https://github.com/kaikalii", "followers_url": "https://api.github.com/users/kaikalii/followers", "following_url": "https://api.github.com/users/kaikalii/following{/other_user}", "gists_url": "https://api.github.com/users/kaikalii/gists{/gist_id}", "starred_url": "https://api.github.com/users/kaikalii/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kaikalii/subscriptions", "organizations_url": "https://api.github.com/users/kaikalii/orgs", "repos_url": "https://api.github.com/users/kaikalii/repos", "events_url": "https://api.github.com/users/kaikalii/events{/privacy}", "received_events_url": "https://api.github.com/users/kaikalii/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-03-08T21:59:30Z", "updated_at": "2019-03-08T22:05:03Z", "closed_at": "2019-03-08T22:05:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "Consider this struct:\r\n```rust\r\nstruct Foo {\r\n    s: String,\r\n    metric: u64,\r\n}\r\n```\r\nIn order to determine the metric, I might have some function:\r\n```rust\r\nfn s_metric(s: &str) -> u64 {\r\n    // Probably something less trivial than this\r\n    s.len() as u64\r\n}\r\n```\r\nIf I want to initialize a `Foo`, writing the initialization for each field in the same order as the definition will not work:\r\n```rust\r\nfn main() {\r\n    let s = String::new();\r\n    let foo = Foo {\r\n        s,\r\n        metric: s_metric(&s),\r\n    };\r\n}\r\n```\r\nThis gives the error:\r\n```\r\nerror[E0382]: borrow of moved value: `s`\r\n  --> src\\main.rs:14:26\r\n   |\r\n13 |         s,\r\n   |         - value moved here\r\n14 |         metric: s_metric(&s),\r\n   |                          ^^ value borrowed here after move\r\n   |\r\n   = note: move occurs because `s` has type `std::string::String`, which does not implement the `Copy` trait\r\n```\r\nReordering the field initializers fixes this error:\r\n```rust\r\nfn main() {\r\n    let s = String::new();\r\n    let foo = Foo {\r\n        metric: s_metric(&s),\r\n        s,\r\n    };\r\n}\r\n```\r\nI know that this is a very small thing, but should which order you write the field initializers really matter? It seems like figuring this out should be part of NLL or something similar. \r\n\r\nI have considered that that are cases where letting the compiler figure this order out for you without changing the semantics of the code might be very compicated if not impossible. Is this the case?", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59030/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59030/timeline", "performed_via_github_app": null, "state_reason": "completed"}