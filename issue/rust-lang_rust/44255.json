{"url": "https://api.github.com/repos/rust-lang/rust/issues/44255", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44255/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44255/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44255/events", "html_url": "https://github.com/rust-lang/rust/issues/44255", "id": 254753429, "node_id": "MDU6SXNzdWUyNTQ3NTM0Mjk=", "number": 44255, "title": "Compiler panics when an array is initialized with length of a certain associated constant", "user": {"login": "TurkeyMcMac", "id": 28828704, "node_id": "MDQ6VXNlcjI4ODI4NzA0", "avatar_url": "https://avatars.githubusercontent.com/u/28828704?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TurkeyMcMac", "html_url": "https://github.com/TurkeyMcMac", "followers_url": "https://api.github.com/users/TurkeyMcMac/followers", "following_url": "https://api.github.com/users/TurkeyMcMac/following{/other_user}", "gists_url": "https://api.github.com/users/TurkeyMcMac/gists{/gist_id}", "starred_url": "https://api.github.com/users/TurkeyMcMac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TurkeyMcMac/subscriptions", "organizations_url": "https://api.github.com/users/TurkeyMcMac/orgs", "repos_url": "https://api.github.com/users/TurkeyMcMac/repos", "events_url": "https://api.github.com/users/TurkeyMcMac/events{/privacy}", "received_events_url": "https://api.github.com/users/TurkeyMcMac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-09-01T21:15:47Z", "updated_at": "2019-03-13T01:29:24Z", "closed_at": "2019-03-13T01:29:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was playing around with the new associated constants trying to make type-level integers. Creating an array with a length defined by `Five` works, but creating one with the product of `Multiply` as a length causes the compiler to panic.\r\n\r\nThis is the code I tried to run:\r\n```rust\r\nuse std::marker::PhantomData;\r\n\r\nfn main() {\r\n    let _arr = [1; <Multiply<Five, Five>>::VAL]; // The compiler finds this scary for some reason.\r\n}\r\n\r\ntrait TypeVal<T> {\r\n    const VAL: T;\r\n}\r\n\r\nstruct Five;\r\n\r\nimpl TypeVal<usize> for Five {\r\n    const VAL: usize = 5;\r\n}\r\n\r\nstruct Multiply<N, M> {\r\n    _n: PhantomData<N>,\r\n    _m: PhantomData<M>,\r\n}\r\n\r\nimpl<N, M> TypeVal<usize> for Multiply<N, M>\r\n    where N: TypeVal<usize>,\r\n          M: TypeVal<usize>,\r\n{\r\n    const VAL: usize = N::VAL * M::VAL;\r\n}\r\n```\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.20.0 (f3d6973f4 2017-08-27)\r\nbinary: rustc\r\ncommit-hash: f3d6973f41a7d1fb83029c9c0ceaf0f5d4fd7208\r\ncommit-date: 2017-08-27\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.20.0\r\nLLVM version: 4.0\r\n```\r\nBacktrace:\r\n```\r\nthread 'rustc' panicked at 'internal error: entered unreachable code', /checkout/src/librustc_mir/hair/cx/mod.rs:140:8\r\nstack backtrace:\r\n   0:     0x7f0518299d13 - std::sys::imp::backtrace::tracing::imp::unwind_backtrace::hcdf51e4c9dc54357\r\n                               at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7f0518294524 - std::sys_common::backtrace::_print::h9da91fd31a37d0f1\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:71\r\n   2:     0x7f05182a7333 - std::panicking::default_hook::{{closure}}::h46820a72bf0cb624\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:60\r\n                               at /checkout/src/libstd/panicking.rs:380\r\n   3:     0x7f05182a703a - std::panicking::default_hook::h4c1ef1cc83189c8e\r\n                               at /checkout/src/libstd/panicking.rs:390\r\n   4:     0x7f05182a77f7 - std::panicking::rust_panic_with_hook::h99016f44bdcb8544\r\n                               at /checkout/src/libstd/panicking.rs:611\r\n   5:     0x7f05160699fa - std::panicking::begin_panic_new::h20bde0fa96b5baa3\r\n   6:     0x7f05160df42c - rustc_mir::hair::cx::Cx::fatal_const_eval_err::hf97cdba7fc5f66cd\r\n   7:     0x7f05160e3be8 - rustc_mir::hair::cx::expr::make_mirror_unadjusted::hbe391e56243cb2db\r\n   8:     0x7f05160dfda8 - rustc_mir::hair::cx::expr::<impl rustc_mir::hair::Mirror<'tcx> for &'tcx rustc::hir::Expr>::make_mirror::h4821ea617bc41d74\r\n   9:     0x7f05160c6b96 - <rustc_mir::hair::ExprRef<'tcx> as rustc_mir::build::into::EvalInto<'tcx>>::eval_into::h40e42cf42cf544dd\r\n  10:     0x7f05160cbed5 - rustc_mir::build::matches::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::expr_into_pattern::h4a9bcd58a09e3d5d\r\n  11:     0x7f05160d1814 - rustc_mir::build::scope::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::in_scope::h81e04d3bdbceb472\r\n  12:     0x7f05160b83d0 - rustc_mir::build::block::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::ast_block_stmts::hafef382cef3e8204\r\n  13:     0x7f05160d1b99 - rustc_mir::build::scope::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::in_scope::hc808f0a51c457ee5\r\n  14:     0x7f05160d170b - rustc_mir::build::scope::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::in_opt_scope::hd179717c8f13dbe1\r\n  15:     0x7f05160c1796 - rustc_mir::build::expr::into::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::into_expr::h111f38b2b7786042\r\n  16:     0x7f05160c6bbf - <rustc_mir::hair::ExprRef<'tcx> as rustc_mir::build::into::EvalInto<'tcx>>::eval_into::h40e42cf42cf544dd\r\n  17:     0x7f05160c11cd - rustc_mir::build::expr::into::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::into_expr::h111f38b2b7786042\r\n  18:     0x7f05160c6bbf - <rustc_mir::hair::ExprRef<'tcx> as rustc_mir::build::into::EvalInto<'tcx>>::eval_into::h40e42cf42cf544dd\r\n  19:     0x7f05160c11cd - rustc_mir::build::expr::into::<impl rustc_mir::build::Builder<'a, 'gcx, 'tcx>>::into_expr::h111f38b2b7786042\r\n  20:     0x7f0516114bdc - rustc_mir::transform::mir_const::h44528d9ec6133f0c\r\n  21:     0x7f051534640f - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_const<'tcx>>::try_get_with::{{closure}}::run_provider::hbd2ca39015d187b6\r\n  22:     0x7f051512f1da - rustc::dep_graph::graph::DepGraph::with_task::h296e6bba1fa15a03\r\n  23:     0x7f0515346940 - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_const<'tcx>>::try_get::h11e76ae1dcdda37d\r\n  24:     0x7f05153805ba - rustc::ty::maps::TyCtxtAt::mir_const::hdaca076bb4373d8e\r\n  25:     0x7f051537d1c6 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::mir_const::h12dfe73edca72c4f\r\n  26:     0x7f0516115aea - rustc_mir::transform::mir_validated::h4ab61ba27ff483ec\r\n  27:     0x7f051534773f - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_validated<'tcx>>::try_get_with::{{closure}}::run_provider::h4e5b76b3ab5f815f\r\n  28:     0x7f051512f1da - rustc::dep_graph::graph::DepGraph::with_task::h296e6bba1fa15a03\r\n  29:     0x7f0515347c70 - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_validated<'tcx>>::try_get::h89ca9fc9b1475a29\r\n  30:     0x7f05153806fa - rustc::ty::maps::TyCtxtAt::mir_validated::ha53b8d1b04be8f61\r\n  31:     0x7f051537d1f6 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::mir_validated::hd499970927ef8808\r\n  32:     0x7f0517c304ca - rustc_borrowck::borrowck::borrowck::h0d64b1bfc871d914\r\n  33:     0x7f051512eeb4 - rustc::dep_graph::graph::DepGraph::with_task::h1ba8376c1cfaccee\r\n  34:     0x7f05153523df - rustc::ty::maps::<impl rustc::ty::maps::queries::borrowck<'tcx>>::try_get::hfdf892ac1155f936\r\n  35:     0x7f051537d532 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::borrowck::h9e740c44bdab1305\r\n  36:     0x7f0517c30367 - rustc_borrowck::borrowck::check_crate::h0d548219b93e53b4\r\n  37:     0x7f051863b014 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h5664029733f1f6d5\r\n  38:     0x7f051862efb0 - rustc_driver::driver::phase_3_run_analysis_passes::hf53b3e845cb6e837\r\n  39:     0x7f0518616d76 - rustc_driver::driver::compile_input::h26cfd26116d1d14c\r\n  40:     0x7f0518654ce1 - rustc_driver::run_compiler::h8741b5aff2ed69fc\r\n  41:     0x7f051857f21f - std::sys_common::backtrace::__rust_begin_short_backtrace::h4e951eb2de4f99f0\r\n  42:     0x7f05182d6d4c - __rust_maybe_catch_panic\r\n                               at /checkout/src/libpanic_unwind/lib.rs:98\r\n  43:     0x7f05185b0900 - <F as alloc::boxed::FnBox<A>>::call_box::h140b04f7a2d92fc5\r\n  44:     0x7f05182a627b - std::sys::imp::thread::Thread::new::thread_start::h10fad04495d944f7\r\n                               at /checkout/src/liballoc/boxed.rs:661\r\n                               at /checkout/src/libstd/sys_common/thread.rs:21\r\n                               at /checkout/src/libstd/sys/unix/thread.rs:84\r\n  45:     0x7f05135596b9 - start_thread\r\n  46:     0x7f0517f4f3dc - clone\r\n  47:                0x0 - <unknown>\r\n```\r\nI hope this is helpful.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44255/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44255/timeline", "performed_via_github_app": null, "state_reason": "completed"}