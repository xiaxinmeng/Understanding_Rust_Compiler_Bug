{"url": "https://api.github.com/repos/rust-lang/rust/issues/42561", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42561/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42561/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42561/events", "html_url": "https://github.com/rust-lang/rust/issues/42561", "id": 234774363, "node_id": "MDU6SXNzdWUyMzQ3NzQzNjM=", "number": 42561, "title": "add an `is_aligned` intrinsic to rust", "user": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2017-06-09T09:39:07Z", "updated_at": "2017-06-13T16:34:41Z", "closed_at": "2017-06-13T16:34:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This intrinsic takes a raw pointer and an alignment and checks whether the pointer is aligned wrt the given alignment. Implementations like miri can use this to always return false, if the requested alignment is bigger than the alignment given at creation of the allocation that the pointer points into.\r\n\r\nIn the future platforms which don't require alignment can return true unconditionally, which will probably allow more optimizations to trigger on those platforms.\r\n\r\nThe signature of the intrinsic can either be `fn<T>(* const T, usize)` or just `fn<T>(* const T)` where the latter obtains the alignment to be checked from the pointee type.\r\n\r\nMost platforms should simply generate `(ptr as usize) & ((1 << (align - 1) - 1) == 0`\r\n\r\nAn example of such a check in the stdlib is https://github.com/rust-lang/rust/blob/f09576c4a41727a8d10bbfd8fd3fb2e10e1be3b3/src/libcore/str/mod.rs#L1433 which is part of utf8 checking. Without such an intrinsic, miri can never do utf8 checking.\r\n\r\nDoes a change like this require an rfc?", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42561/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42561/timeline", "performed_via_github_app": null, "state_reason": "completed"}