{"url": "https://api.github.com/repos/rust-lang/rust/issues/106929", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/106929/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/106929/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/106929/events", "html_url": "https://github.com/rust-lang/rust/issues/106929", "id": 1534598153, "node_id": "I_kwDOAAsO6M5beBwJ", "number": 106929, "title": "First complains on wrong types and wrong arguments count and then complains that the function doesn't exist", "user": {"login": "safinaskar", "id": 859494, "node_id": "MDQ6VXNlcjg1OTQ5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/859494?v=4", "gravatar_id": "", "url": "https://api.github.com/users/safinaskar", "html_url": "https://github.com/safinaskar", "followers_url": "https://api.github.com/users/safinaskar/followers", "following_url": "https://api.github.com/users/safinaskar/following{/other_user}", "gists_url": "https://api.github.com/users/safinaskar/gists{/gist_id}", "starred_url": "https://api.github.com/users/safinaskar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/safinaskar/subscriptions", "organizations_url": "https://api.github.com/users/safinaskar/orgs", "repos_url": "https://api.github.com/users/safinaskar/repos", "events_url": "https://api.github.com/users/safinaskar/events{/privacy}", "received_events_url": "https://api.github.com/users/safinaskar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-01-16T09:31:22Z", "updated_at": "2023-06-06T15:15:03Z", "closed_at": "2023-05-30T16:04:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\r\n\r\n```Rust\r\n// Here is (somewhat) minimal reproducer extracted from actual code\r\n// https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=1dd13c8cc5daee9cb6a14c5ee5cdefac\r\n\r\n/*async fn post(client: &reqwest::Client, key: &ring::hmac::Key, body: &[(String, String)]) -> Result<String, Box<dyn std::error::Error>> {\r\n    todo!();\r\n}*/\r\n\r\n#[tokio::main]\r\nasync fn main() -> Result<(), Box<dyn std::error::Error>> {\r\n    let client = reqwest::Client::new();\r\n    let key = ring::hmac::Key::new(todo!(), todo!());\r\n    post(&client, &key, &[\r\n        (\"\".to_owned(), \"\".to_owned()),\r\n    ]).await?;\r\n    return Ok(());\r\n}\r\n```\r\n\r\n\r\n### Current output\r\n\r\n```text\r\nCompiling playground v0.0.1 (/playground)\r\nwarning: unreachable expression\r\n --> src/main.rs:8:45\r\n  |\r\n8 |     let key = ring::hmac::Key::new(todo!(), todo!());\r\n  |                                    -------  ^^^^^^^ unreachable expression\r\n  |                                    |\r\n  |                                    any code following this expression is unreachable\r\n  |\r\n  = note: `#[warn(unreachable_code)]` on by default\r\n  = note: this warning originates in the macro `todo` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror[E0277]: the trait bound `&Key: IntoUrl` is not satisfied\r\n    --> src/main.rs:9:5\r\n     |\r\n9    | /     post(&client, &key, &[\r\n10   | |         (\"\".to_owned(), \"\".to_owned()),\r\n11   | |     ]).await?;\r\n     | |______^ the trait `IntoUrl` is not implemented for `&Key`\r\n     |\r\n     = help: the following other types implement trait `IntoUrl`:\r\n               &'a String\r\n               &'a str\r\n               String\r\n               Url\r\nnote: required by a bound in `reqwest::Client::post`\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.11.13/src/async_impl/client.rs:1431:20\r\n     |\r\n1431 |     pub fn post<U: IntoUrl>(&self, url: U) -> RequestBuilder {\r\n     |                    ^^^^^^^ required by this bound in `reqwest::Client::post`\r\n\r\nerror[E0061]: this function takes 1 argument but 2 arguments were supplied\r\n    --> src/main.rs:9:5\r\n     |\r\n9    |       post(&client, &key, &[\r\n     |  _____^^^^________________-\r\n10   | |         (\"\".to_owned(), \"\".to_owned()),\r\n11   | |     ]).await?;\r\n     | |_____- argument of type `&[(String, String); 1]` unexpected\r\n     |\r\nnote: associated function defined here\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/reqwest-0.11.13/src/async_impl/client.rs:1431:12\r\n     |\r\n1431 |     pub fn post<U: IntoUrl>(&self, url: U) -> RequestBuilder {\r\n     |            ^^^^\r\nhelp: remove the extra argument\r\n     |\r\n9    |     post(&key)(&client, &key, &[\r\n     |         ++++++\r\n\r\nerror[E0425]: cannot find function `post` in this scope\r\n --> src/main.rs:9:5\r\n  |\r\n9 |     post(&client, &key, &[\r\n  |     ^^^^ not found in this scope\r\n  |\r\nhelp: use the `.` operator to call the method `post` on `&reqwest::Client`\r\n  |\r\n9 ~     (&client).post(&key, &[\r\n10+         (\"\".to_owned(), \"\".to_owned()),\r\n11~     ]).await?;\r\n  |\r\n\r\nerror[E0277]: `reqwest::RequestBuilder` is not a future\r\n  --> src/main.rs:11:7\r\n   |\r\n9  | /     post(&client, &key, &[\r\n10 | |         (\"\".to_owned(), \"\".to_owned()),\r\n11 | |     ]).await?;\r\n   | |      -^^^^^^\r\n   | |      ||\r\n   | |      |`reqwest::RequestBuilder` is not a future\r\n   | |______|help: remove the `.await`\r\n   |        this call returns `reqwest::RequestBuilder`\r\n   |\r\n   = help: the trait `Future` is not implemented for `reqwest::RequestBuilder`\r\n   = note: reqwest::RequestBuilder must be a future or must implement `IntoFuture` to be awaited\r\n   = note: required for `reqwest::RequestBuilder` to implement `IntoFuture`\r\n\r\nSome errors have detailed explanations: E0061, E0277, E0425.\r\nFor more information about an error, try `rustc --explain E0061`.\r\nwarning: `playground` (bin \"playground\") generated 1 warning\r\nerror: could not compile `playground` due to 4 previous errors; 1 warning emitted\r\n```\r\n\r\n\r\n### Desired output\r\n\r\nI think errors should be in other order\r\n\r\n\r\n### Rationale and extra context\r\n\r\nProvided code is minimal reproducer extracted from actual code from my project.\r\n\r\nIn some point I had function `post` in my code called from `main`. But then I commented `post` and forgot about that. Then I run compiler and saw these very strange error messages. I usually read compiler errors from begin to end. The first error said that I have no `&Key: IntoUrl` satisfied. This is very strange. Why I should have `&Key: IntoUrl` satisfied? I stared at this very strange error for some time. And then I decided to see other error messages. And then I suddenly saw error message (at 3rd place) that `post` is not defined at all! At this moment I understood that `post` is commented (remember: my actual code is big, so it is easy to miss this).\r\n\r\nSo, the problem is so: rustc is simply too smart. Rustc should simply complain that `post` is not defined. But rustc goes further and \"fixes\" it and then complains that `post` is called with wrong number of arguments and that bounds are not satisfied. And moreover rustc gives error messages in wrong order: first complains that traits are not satisfied and argument number is wrong and then complains that there is no `post` at all!\r\n\r\nRemember: I usually read first error message only and ignore the rest.\r\n\r\nRustc version is 1.66.1 stable\r\n\r\n### Other cases\r\n\r\n_No response_\r\n\r\n### Anything else?\r\n\r\n_No response_", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/106929/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/106929/timeline", "performed_via_github_app": null, "state_reason": "completed"}