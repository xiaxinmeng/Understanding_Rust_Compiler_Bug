{"url": "https://api.github.com/repos/rust-lang/rust/issues/102603", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/102603/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/102603/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/102603/events", "html_url": "https://github.com/rust-lang/rust/issues/102603", "id": 1393916537, "node_id": "I_kwDOAAsO6M5TFXp5", "number": 102603, "title": "(Resolved by downgrade) `internal compiler error: unexpected panic` while running `cargo doc` on `rustc 1.66.0-nightly (9c56d9d6f 2022-09-29) running on x86_64-unknown-linux-gnu` on crate `nom`", "user": {"login": "nathan-at-least", "id": 4369700, "node_id": "MDQ6VXNlcjQzNjk3MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/4369700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathan-at-least", "html_url": "https://github.com/nathan-at-least", "followers_url": "https://api.github.com/users/nathan-at-least/followers", "following_url": "https://api.github.com/users/nathan-at-least/following{/other_user}", "gists_url": "https://api.github.com/users/nathan-at-least/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathan-at-least/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathan-at-least/subscriptions", "organizations_url": "https://api.github.com/users/nathan-at-least/orgs", "repos_url": "https://api.github.com/users/nathan-at-least/repos", "events_url": "https://api.github.com/users/nathan-at-least/events{/privacy}", "received_events_url": "https://api.github.com/users/nathan-at-least/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2022-10-02T22:17:54Z", "updated_at": "2022-10-04T16:24:32Z", "closed_at": "2022-10-04T16:24:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\n\nI have created [a stand-alone crate on github](https://github.com/nathan-at-least/rustc-internal-bug-nightly-2022-09-30-cargo-doc) which reliably reproduces the internal compiler error on my system. The readme in that crate includes `rustup` version as well as `cargo --version` from inside and outside the repo which has a `rust-toolchain.toml`.\n\nThis is recreated with:\n\n1. `cargo new`\n2. Editing `rust-toolchain.toml` with `channel = \"nightly-2022-09-30\"`\n3. Adding the dependencies from my original crate into `Cargo.toml`\n4. Running `cargo doc`\n\n### Meta\n`rustc --version --verbose`:\n```\nrustc 1.66.0-nightly (9c56d9d6f 2022-09-29)\nbinary: rustc\ncommit-hash: 9c56d9d6fec6262bbb1549cfe466a812ae2c6523\ncommit-date: 2022-09-29\nhost: x86_64-unknown-linux-gnu\nrelease: 1.66.0-nightly\nLLVM version: 15.0.0\n```\n\n### Error output\n\n```\n$ RUST_BACKTRACE=1 cargo doc\n Documenting nom v5.1.2                                                                                                                                                                           \n    Checking proc-macro-error v1.0.4                                                             \n    Checking atty v0.2.14\n    Checking heck v0.4.0                                                                         \n Documenting either v1.8.0\n Documenting heck v0.4.0                                                                         \n Documenting fnv v1.0.7\n Documenting os_str_bytes v6.3.0                                                                                                                                                                  \n    Checking fastrand v1.8.0\n    Checking strsim v0.10.0                                                                      \n    Checking termcolor v1.1.3\n    Checking remove_dir_all v0.5.3    \n Documenting ppv-lite86 v0.2.16\n    Checking once_cell v1.15.0\nthread 'rustc' panicked at 'expected non-translatable diagnostic message', compiler/rustc_error_messages/src/lib.rs:347:18\nstack backtrace:         \n   0: rust_begin_unwind\n             at /rustc/9c56d9d6fec6262bbb1549cfe466a812ae2c6523/library/std/src/panicking.rs:556:5\n   1: core::panicking::panic_fmt\n             at /rustc/9c56d9d6fec6262bbb1549cfe466a812ae2c6523/library/core/src/panicking.rs:142:14\n   2: <rustc_error_messages::DiagnosticMessage>::expect_str\n   3: <rustdoc::passes::check_code_block_syntax::BufferEmitter as rustc_errors::emitter::Emitter>::emit_diagnostic                                                                                \n   4: <rustc_errors::HandlerInner>::emit_diagnostic                                                                                                                                               \n   5: <rustc_errors::Handler>::emit_diagnostic                                                                                                                                                    \n   6: <rustc_errors::ErrorGuaranteed as rustc_errors::diagnostic_builder::EmissionGuarantee>::diagnostic_builder_emit_producing_guarantee\n   7: rustc_parse::parser::emit_unclosed_delims                                                  \n   8: rustc_parse::parse_stream_from_source_str\n   9: std::panicking::try::<bool, core::panic::unwind_safe::AssertUnwindSafe<<rustdoc::passes::check_code_block_syntax::SyntaxChecker>::check_rust_syntax::{closure#2}>>\n  10: rustc_driver::catch_fatal_errors::<<rustdoc::passes::check_code_block_syntax::SyntaxChecker>::check_rust_syntax::{closure#2}, bool>\n  11: <rustdoc::passes::check_code_block_syntax::SyntaxChecker as rustdoc::visit::DocVisitor>::visit_item\n  12: <rustdoc::passes::check_code_block_syntax::SyntaxChecker as rustdoc::visit::DocVisitor>::visit_item\n  13: rustdoc::passes::check_code_block_syntax::check_code_block_syntax\n  14: <rustc_session::session::Session>::time::<rustdoc::clean::types::Crate, rustdoc::core::run_global_ctxt::{closure#7}>\n  15: rustdoc::core::run_global_ctxt\n  16: <rustc_session::session::Session>::time::<(rustdoc::clean::types::Crate, rustdoc::config::RenderOptions, rustdoc::formats::cache::Cache), rustdoc::main_options::{closure#0}::{closure#0}::{\nclosure#1}::{closure#0}>\n  17: <rustc_interface::passes::QueryContext>::enter::<rustdoc::main_options::{closure#0}::{closure#0}::{closure#1}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\n  18: <rustc_interface::interface::Compiler>::enter::<rustdoc::main_options::{closure#0}::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\n  19: rustc_span::with_source_map::<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_interface::interface::create_compiler_and_run<core::result::Result<(), rustc_errors::ErrorGuara\nnteed>, rustdoc::main_options::{closure#0}>::{closure#1}>\n  20: rustc_interface::interface::create_compiler_and_run::<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustdoc::main_options::{closure#0}>\n  21: rustdoc::main_options\n  22: <scoped_tls::ScopedKey<rustc_span::SessionGlobals>>::set::<rustdoc::main_args::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\n\nnote: rustc 1.66.0-nightly (9c56d9d6f 2022-09-29) running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: --crate-type lib\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\n Documenting clap_lex v0.3.0\nerror: could not document `nom`\n\nCaused by:\n  process didn't exit successfully: `rustdoc --edition=2018 --crate-type lib --crate-name nom /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/nom-5.1.2/src/lib.rs --cap-lints allow -o /home/user/hack/rustc-internal-bug-nightly-2022-09-30-cargo-doc/target/doc --cfg 'feature=\"alloc\"' --cfg 'feature=\"std\"' --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat -C metadata=b51d37cca3770787 -L dependency=/home/user/hack/rustc-internal-bug-nightly-2022-09-30-cargo-doc/target/debug/deps --extern memchr=/home/user/hack/rustc-internal-bug-nightly-2022-09-30-cargo-doc/target/debug/deps/libmemchr-7dfca3eeb657d49f.rmeta --crate-version 5.1.2 --cfg stable_i128` (exit status: 101)\nwarning: build failed, waiting for other jobs to finish...\n```\n\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"Nilstrieb\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/102603/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/102603/timeline", "performed_via_github_app": null, "state_reason": "completed"}