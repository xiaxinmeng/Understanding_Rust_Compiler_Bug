{"url": "https://api.github.com/repos/rust-lang/rust/issues/48089", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48089/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48089/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48089/events", "html_url": "https://github.com/rust-lang/rust/issues/48089", "id": 295842917, "node_id": "MDU6SXNzdWUyOTU4NDI5MTc=", "number": 48089, "title": "Diagnostics doesn't provide proper explaination as to where type annotations should be added", "user": {"login": "shingtaklam1324", "id": 15098580, "node_id": "MDQ6VXNlcjE1MDk4NTgw", "avatar_url": "https://avatars.githubusercontent.com/u/15098580?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shingtaklam1324", "html_url": "https://github.com/shingtaklam1324", "followers_url": "https://api.github.com/users/shingtaklam1324/followers", "following_url": "https://api.github.com/users/shingtaklam1324/following{/other_user}", "gists_url": "https://api.github.com/users/shingtaklam1324/gists{/gist_id}", "starred_url": "https://api.github.com/users/shingtaklam1324/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shingtaklam1324/subscriptions", "organizations_url": "https://api.github.com/users/shingtaklam1324/orgs", "repos_url": "https://api.github.com/users/shingtaklam1324/repos", "events_url": "https://api.github.com/users/shingtaklam1324/events{/privacy}", "received_events_url": "https://api.github.com/users/shingtaklam1324/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-02-09T11:41:08Z", "updated_at": "2019-12-14T02:08:29Z", "closed_at": "2019-12-14T02:08:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Code\r\n```rust\r\nfn main() {\r\n    let lst: [([i32; 10], bool); 10] = [([0; 10], false); 10];\r\n    lst.sort_by_key(|&(v, _)| v.iter().sum());\r\n    println!(\"{:?}\", lst);\r\n}\r\n```\r\n\r\n## Current Error message\r\n\r\nThis fails compilation (on purpose), and the error message is as below\r\n\r\n```\r\nerror[E0282]: type annotations needed\r\n --> src/main.rs:3:9\r\n  |\r\n3 |     lst.sort_by_key(|&(v, _)| v.iter().sum());\r\n  |         ^^^^^^^^^^^ cannot infer type for `B`\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `playground`.\r\n```\r\n\r\n## Problem\r\n\r\nThe current error message isn't helpful by producing a message with the type `B`, which can be confusing to users, (it comes from te type signature of `fn sort_by_key<B, F>(&mut self, _: F) where B: Ord, F: FnMut(&T) -> B` as `estebank` points out).As well as that, the positions of the arrows implies that the error comes from `.sort_by_key()`, when in fact it comes from the need for type annotations for `.sum()`.\r\n\r\n## Proposed solution\r\n\r\n```\r\nerror[E0282]: type annotations needed\r\n --> src/main.rs:3:9\r\n  |\r\n3 |     lst.sort_by_key(|&(v, _)| v.iter().sum());\r\n  |                               ^^^^^^^^^^^^^^ cannot infer type for `B`\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `playground`.\r\n```\r\n\r\nThe proposed change would be to point to the inside of the function, which would (in my opinion) be clearer to the user that the type annotations are needed inside the function, not with `.sort_by_key()`\r\n\r\n[Playground](https://play.rust-lang.org/?gist=307f49017eb007463fe0566916c2da5e&version=undefined)", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48089/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48089/timeline", "performed_via_github_app": null, "state_reason": "completed"}