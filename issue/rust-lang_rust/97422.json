{"url": "https://api.github.com/repos/rust-lang/rust/issues/97422", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97422/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97422/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97422/events", "html_url": "https://github.com/rust-lang/rust/issues/97422", "id": 1249399641, "node_id": "I_kwDOAAsO6M5KeFNZ", "number": 97422, "title": "Complete incremental hash tracking coverage", "user": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-05-26T10:37:51Z", "updated_at": "2023-02-04T10:40:20Z", "closed_at": "2023-02-04T10:40:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The directory `src/test/incremental/hashes` is used to track the performance of incremental compilation granularity.\n\nEach file is compiled 6 times with different configurations. For each run and each item, the hashes of some queries' results are computed.\nIf a hash stays the same from one run to the next, it is said \"clean\", otherwise it is \"dirty\".\nThe compiler verifies that the set of clean vs. dirty hashes corresponds to what the attributes say (`rustc_clean` annotations all over).\n\nThe weird spacing and comments is meant to stress the `incremental-relative-spans` option, which corresponds to configurations 4, 5, 6.  Those configurations should as close as possible to 1, 2, 3.\n\nThe list of checked queries is defined in `rustc_incremental::persist::dirty_clean`.\n\nThis test suite has grown a bit stale, and has not been updated with new constructs or new queries.  For instance, there is almost no impl-trait and no async.  One objective would be to eventually cover the queries that take a `LocalDefId/DefId` and that end up in metadata.\n\nAs a first step, it would be interesting to cover `mir_for_ctfe`: it is always computed and is a base for `optimized_mir`.  As MIR optimizations get better, `optimized_mir` should get cleaner and cleaner, while `mir_for_ctfe` stays the same.\n\nThis can be done by:\n- adding `label_strs::mir_for_ctfe` in `rustc_incremental::persist::dirty_clean::BASE_MIR`;\n- updating the tests to add `mir_for_ctfe` in the dirty list when appropriate.\n\nDon't hesitate to add other queries that should be checked, or complete the tests with constructs that are not covered (async?).\nI am available on zulip if necessary.\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"InfRandomness\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97422/timeline", "performed_via_github_app": null, "state_reason": "completed"}