{"url": "https://api.github.com/repos/rust-lang/rust/issues/15269", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15269/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15269/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15269/events", "html_url": "https://github.com/rust-lang/rust/issues/15269", "id": 36781681, "node_id": "MDU6SXNzdWUzNjc4MTY4MQ==", "number": 15269, "title": "mutable linear types are modified when I don't think they are (except when in function calls?) [documentation needed, or real bug??]", "user": {"login": "killerswan", "id": 195060, "node_id": "MDQ6VXNlcjE5NTA2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killerswan", "html_url": "https://github.com/killerswan", "followers_url": "https://api.github.com/users/killerswan/followers", "following_url": "https://api.github.com/users/killerswan/following{/other_user}", "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}", "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions", "organizations_url": "https://api.github.com/users/killerswan/orgs", "repos_url": "https://api.github.com/users/killerswan/repos", "events_url": "https://api.github.com/users/killerswan/events{/privacy}", "received_events_url": "https://api.github.com/users/killerswan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-06-30T09:25:12Z", "updated_at": "2015-03-03T17:25:45Z", "closed_at": "2015-03-03T17:09:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From here, again: https://github.com/killerswan/ovid/blob/ad2efdabb2eb834ca7a50cbda5806ccd033d6283/CSVProvider.rs\n\nIn this, `cx` is a `&mut ExtCtxt`, which @brson said was a linear type.  There's something special in how these are handled in function arguments, apparently, which allows cx to be used twice here with `quote_item!` only when the first is inside a function call.  Why?  What is going on?\n\nIf this isn't a bug, do we have it documented somewhere? :D\n\n```\novid $ \novid $ git diff\ndiff --git a/CSVProvider.rs b/CSVProvider.rs\nindex 4fa650f..a19192e 100644\n--- a/CSVProvider.rs\n+++ b/CSVProvider.rs\n@@ -156,16 +156,11 @@ fn provide_csv_given_labels(cx: &mut ExtCtxt, sp: Span, tts: &[Toke\n  */\n\n\n-   fn define_my_csv(cx0: &mut ExtCtxt) -> Option<Gc<syntax::ast::Item>> {\n       let item1: Option<Gc<syntax::ast::Item>>  = quote_item!(cx0,\n          pub struct MyCSV {\n             pub data: Vec<(String)>,\n          }\n       );\n-      return item1;\n-   }\n-\n-   let item1 = define_my_csv(cx);  // Why is this necessary?\n\n    let item2: Option<Gc<syntax::ast::Item>>  = quote_item!(cx,\n       impl MyCSV {\n```\n\n```\novid $ ./build.sh \nCSVProvider.rs:159:63: 159:66 error: unresolved name `cx0`. Did you mean `cx`?\nCSVProvider.rs:159       let item1: Option<Gc<syntax::ast::Item>>  = quote_item!(cx0,\n                                                                                 ^~~\nnote: in expansion of quote_item!\nCSVProvider.rs:159:51: 163:9 note: expansion site\nerror: aborting due to previous error\n```\n", "closed_by": {"login": "kmcallister", "id": 444997, "node_id": "MDQ6VXNlcjQ0NDk5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/444997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmcallister", "html_url": "https://github.com/kmcallister", "followers_url": "https://api.github.com/users/kmcallister/followers", "following_url": "https://api.github.com/users/kmcallister/following{/other_user}", "gists_url": "https://api.github.com/users/kmcallister/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmcallister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmcallister/subscriptions", "organizations_url": "https://api.github.com/users/kmcallister/orgs", "repos_url": "https://api.github.com/users/kmcallister/repos", "events_url": "https://api.github.com/users/kmcallister/events{/privacy}", "received_events_url": "https://api.github.com/users/kmcallister/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/15269/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15269/timeline", "performed_via_github_app": null, "state_reason": "completed"}