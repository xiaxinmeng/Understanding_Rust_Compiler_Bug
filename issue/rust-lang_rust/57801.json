{"url": "https://api.github.com/repos/rust-lang/rust/issues/57801", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57801/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57801/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57801/events", "html_url": "https://github.com/rust-lang/rust/issues/57801", "id": 401330693, "node_id": "MDU6SXNzdWU0MDEzMzA2OTM=", "number": 57801, "title": "Rustc 1.32 segfaults with llvm 7.0.1 while building fd-find and lto=true enabled", "user": {"login": "Mic92", "id": 96200, "node_id": "MDQ6VXNlcjk2MjAw", "avatar_url": "https://avatars.githubusercontent.com/u/96200?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mic92", "html_url": "https://github.com/Mic92", "followers_url": "https://api.github.com/users/Mic92/followers", "following_url": "https://api.github.com/users/Mic92/following{/other_user}", "gists_url": "https://api.github.com/users/Mic92/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mic92/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mic92/subscriptions", "organizations_url": "https://api.github.com/users/Mic92/orgs", "repos_url": "https://api.github.com/users/Mic92/repos", "events_url": "https://api.github.com/users/Mic92/events{/privacy}", "received_events_url": "https://api.github.com/users/Mic92/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-21T12:25:32Z", "updated_at": "2019-01-21T17:03:02Z", "closed_at": "2019-01-21T17:03:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "While binaries by provided by mozilla are compiled against its bundled llvm, distributions such as archlinux, fedora and NixOS link rust against the upstream llvm version.\r\n\r\nAlso the rust project itself don't has this version yet, it might be still useful to track this issue here as it will eventually also affect the project if they ever upgrade llvm.\r\n\r\nSteps to reproduce:\r\n\r\n```\r\n$ cargo --version\r\ncargo 1.32.0\r\n$ rustc --version\r\nrustc 1.32.0\r\n$ cargo install fd-find\r\n....\r\n   Compiling clap v2.32.0\r\n   Compiling parking_lot v0.7.1\r\n   Compiling ctrlc v3.1.1\r\n   Compiling crossbeam-channel v0.3.6\r\n   Compiling fd-find v7.2.0\r\n   Compiling globset v0.4.2\r\n   Compiling ignore v0.4.6\r\nerror: failed to compile `fd-find v7.2.0`, intermediate artifacts can be found at `/tmp/cargo-installCT8S32`\r\n\r\nCaused by:\r\n  Could not compile `fd-find`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name fd /root/.cargo/registry/src/github.com-1ecc6299db9ec823/fd-find-7.2.0/src/main.rs --color always --crate-type bin --emit=dep-info,link -C opt-level=3 -C lto -C codegen-units=1 -C metadata=a3a6a7cb919634a5 -C extra-filename=-a3a6a7cb919634a5 --out-dir /tmp/cargo-installCT8S32/release/deps -L dependency=/tmp/cargo-installCT8S32/release/deps --extern ansi_term=/tmp/cargo-installCT8S32/release/deps/libansi_term-da0b45e138ff353b.rlib --extern atty=/tmp/cargo-installCT8S32/release/deps/libatty-d255fe7ee8d55655.rlib --extern clap=/tmp/cargo-installCT8S32/release/deps/libclap-f83ca700ee891f8b.rlib --extern ctrlc=/tmp/cargo-installCT8S32/release/deps/libctrlc-03b9fe7f29c143b5.rlib --extern humantime=/tmp/cargo-installCT8S32/release/deps/libhumantime-67b9f25c854b0215.rlib --extern ignore=/tmp/cargo-installCT8S32/release/deps/libignore-1259b5bca495d9c6.rlib --extern lazy_static=/tmp/cargo-installCT8S32/release/deps/liblazy_static-7deee2bf7505e8c9.rlib --extern libc=/tmp/cargo-installCT8S32/release/deps/liblibc-e3278554887eedae.rlib --extern num_cpus=/tmp/cargo-installCT8S32/release/deps/libnum_cpus-f24ed7872633de1c.rlib --extern regex=/tmp/cargo-installCT8S32/release/deps/libregex-dcae60647554bb97.rlib --extern regex_syntax=/tmp/cargo-installCT8S32/release/deps/libregex_syntax-16497b92e03853d9.rlib --cap-lints allow` (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n\r\nThis happens both on archlinux ([#61490](https://bugs.archlinux.org/task/61490)) and on NixOS ([#54323](https://github.com/NixOS/nixpkgs/pull/54323#issuecomment-455831637)). Both distributions uses llvm 7.0.1 instead of the llvm version that is provided by rust. The problem goes away when using the vendored llvm source.\r\n\r\nThis is backtrace of the coredump: https://gist.github.com/e337646429c41d93a089aaa45b8d2375\r\n as generated by `gdb rustc core -batch -ex bt`.\r\nThe error suggest that it might be related to generating debugging symbols.\r\n\r\ncc @foutrelis\r\n\r\n*UPDATE*: the error also seems to go away, when I disable lto optimization.\r\n\r\n", "closed_by": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57801/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57801/timeline", "performed_via_github_app": null, "state_reason": "completed"}