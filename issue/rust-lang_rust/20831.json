{"url": "https://api.github.com/repos/rust-lang/rust/issues/20831", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20831/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20831/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20831/events", "html_url": "https://github.com/rust-lang/rust/issues/20831", "id": 53919576, "node_id": "MDU6SXNzdWU1MzkxOTU3Ng==", "number": 20831, "title": "ICE \"internal compiler error: cannot relate bound region\" using associated type in method sig", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 149689562, "node_id": "MDU6TGFiZWwxNDk2ODk1NjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-associated-items", "name": "A-associated-items", "color": "f7e101", "default": false, "description": "Area: Associated items such as associated types and consts."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-01-09T21:53:33Z", "updated_at": "2015-01-16T06:03:18Z", "closed_at": "2015-01-16T06:03:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\nuse std::ops::{Shl, Shr};\nuse std::cell::RefCell;\n\npub trait Subscriber {\n    type Input;\n}\n\npub trait Publisher<'a> {\n    type Output;\n\n    fn subscribe(&mut self, Box<Subscriber<Input=Self::Output> + 'a>);\n\n}\n\npub trait Processor<'a> : Subscriber + Publisher<'a> { }\n\nimpl<'a, P> Processor<'a> for P\nwhere P : Subscriber + Publisher<'a> { }\n\n\nstruct MyStruct<'a> {\n    sub: Box<Subscriber<Input=u64> + 'a>\n}\n\nimpl<'a> Publisher<'a> for MyStruct<'a> {\n    type Output = u64;\n\n    fn subscribe(&mut self, t : Box<Subscriber<Input=<Self as Publisher>::Output> + 'a>) {\n        self.subscriber = t;\n    }\n\n}\n\nfn main() {}\n```\n\nyields:\n\n```\nlunch-box. rustc ~/tmp/rovar.rs\n/home/nmatsakis/tmp/rovar.rs:28:5: 30:6 error: internal compiler error: cannot relate bound region: ReFree(88, BrNamed(DefId { krate: 0u32, node: 96u32 }, 'a)) <= ReLateBound(DebruijnIndex { depth: 3u32\n}, BrAnon(1))\n/home/nmatsakis/tmp/rovar.rs:28     fn subscribe(&mut self, t : Box<Subscriber<Input=<MyStruct<'a> as Publisher>::Output> + 'a>) {\n/home/nmatsakis/tmp/rovar.rs:29         self.subscriber = t;\n/home/nmatsakis/tmp/rovar.rs:30     }\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/nmatsakis/versioned/rust-1/src/libsyntax/diagnostic.rs:123\n```\n\nBacktrace:\n\n```\nstack backtrace:\n   1:     0x7f2b4a0904b0 - sys::backtrace::write::hc33c0f30f6bee48dCzt\n   2:     0x7f2b4a0b26c0 - failure::on_fail::hb963d0c36b10514daPz\n   3:     0x7f2b4a020240 - rt::unwind::begin_unwind_inner::hdae086d0b79f35712tz\n   4:     0x7f2b450aa860 - rt::unwind::begin_unwind::h13484122622889777099\n   5:     0x7f2b450aa7f0 - diagnostic::SpanHandler::span_bug::headb6283b29a226fIRF\n   6:     0x7f2b4848f890 - middle::infer::region_inference::RegionVarBindings<'a, 'tcx>::make_subregion::h4c7a20a638c31a25Kfw\n   7:     0x7f2b4843f920 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::regions::h6359f29cf9bb6e07Xoy\n   8:     0x7f2b4843ddc0 - middle::infer::combine::Combine::substs_variances::h24213547863999897\n   9:     0x7f2b4843dd00 - middle::infer::combine::Combine::substs::h12473875684778725248\n  10:     0x7f2b4843da60 - middle::infer::combine::Combine::trait_refs::h5280693724941496106\n  11:     0x7f2b48442d30 - middle::infer::combine::Combine::projection_tys::h14373726893306599401\n  12:     0x7f2b48426930 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::tys::h22d46133309df1a2Wvy\n  13:     0x7f2b48442bd0 - middle::infer::combine::Combine::projection_predicates::h11220478815809982305\n  14:     0x7f2b48441560 - middle::infer::higher_ranked::C.HigherRankedRelations<'tcx>::higher_ranked_sub::unboxed_closure.73888\n  15:     0x7f2b48440e70 - middle::infer::higher_ranked::C.HigherRankedRelations<'tcx>::higher_ranked_sub::h8741887278504938399\n  16:     0x7f2b484a6130 - result::Result<V, E>.FromIterator<Result<A, E>>::from_iter::Adapter<Iter, E>.Iterator::next::h12275455710249568012\n  17:     0x7f2b484a5eb0 - result::Result<V, E>.FromIterator<Result<A, E>>::from_iter::h4394336484059744225\n  18:     0x7f2b484a5b60 - middle::infer::combine::Combine::existential_bounds::h1684376140490263861\n  19:     0x7f2b48426930 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::tys::h22d46133309df1a2Wvy\n  20:     0x7f2b48426930 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::tys::h22d46133309df1a2Wvy\n  21:     0x7f2b48445960 - middle::infer::combine::Combine::args::h1520184800584367187\n  22:     0x7f2b484457b0 - vec::Vec<T>.FromIterator<T>::from_iter::h7679049291035860243\n  23:     0x7f2b484453a0 - middle::infer::combine::Combine::fn_sigs::h16564086657495642215\n  24:     0x7f2b48443b10 - middle::infer::higher_ranked::C.HigherRankedRelations<'tcx>::higher_ranked_sub::unboxed_closure.73930\n  25:     0x7f2b48443400 - middle::infer::higher_ranked::C.HigherRankedRelations<'tcx>::higher_ranked_sub::h8904585972080634262\n  26:     0x7f2b484a6400 - middle::infer::combine::Combine::bare_fn_tys::h7458720669919803527\n  27:     0x7f2b48426930 - middle::infer::sub::Sub<'f, 'tcx>.Combine<'tcx>::tys::h22d46133309df1a2Wvy\n  28:     0x7f2b484a9320 - middle::infer::InferCtxt<'a, 'tcx>::sub_types::h0c797a62be34ef88KYA\n  29:     0x7f2b484a8e00 - middle::infer::mk_subty::hc58e5329cc8f3127sqA\n  30:     0x7f2b49832d10 - check::compare_method::compare_impl_method::ha3cace0054dac102ZAj\n  31:     0x7f2b4983ebf0 - check::check_item::h94f685b036503098RNk\n  32:     0x7f2b49903c40 - check_crate::unboxed_closure.30436\n  33:     0x7f2b498fe780 - check_crate::h326f19254f8388eauSx\n  34:     0x7f2b4a5dcee0 - driver::phase_3_run_analysis_passes::h21c032817652340ahwa\n  35:     0x7f2b4a5c5c40 - driver::compile_input::h0fc2c0f3b0492b65wba\n  36:     0x7f2b4a694ec0 - thunk::F.Invoke<A, R>::invoke::h7309714978540172785\n  37:     0x7f2b4a693c40 - rt::unwind::try::try_fn::h11574143453518770554\n  38:     0x7f2b4a117b10 - rust_try_inner\n  39:     0x7f2b4a117b00 - rust_try\n  40:     0x7f2b4a693f30 - thunk::F.Invoke<A, R>::invoke::h11037746254120548559\n  41:     0x7f2b4a0a0570 - sys::thread::thread_start::h8705f831408525e7qrw\n  42:     0x7f2b448c70c0 - start_thread\n  43:     0x7f2b49cc3f89 - __clone\n  44:                0x0 - <unknown>\n```\n\nBased on the backtrace, I think that @jroesch's PR will help here.\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20831/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20831/timeline", "performed_via_github_app": null, "state_reason": "completed"}