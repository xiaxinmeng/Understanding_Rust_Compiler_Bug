{"url": "https://api.github.com/repos/rust-lang/rust/issues/65991", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65991/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65991/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65991/events", "html_url": "https://github.com/rust-lang/rust/issues/65991", "id": 515116814, "node_id": "MDU6SXNzdWU1MTUxMTY4MTQ=", "number": 65991, "title": "Tracking issue for dyn upcasting coercion", "user": {"login": "alexreg", "id": 67036, "node_id": "MDQ6VXNlcjY3MDM2", "avatar_url": "https://avatars.githubusercontent.com/u/67036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexreg", "html_url": "https://github.com/alexreg", "followers_url": "https://api.github.com/users/alexreg/followers", "following_url": "https://api.github.com/users/alexreg/following{/other_user}", "gists_url": "https://api.github.com/users/alexreg/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexreg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexreg/subscriptions", "organizations_url": "https://api.github.com/users/alexreg/orgs", "repos_url": "https://api.github.com/users/alexreg/repos", "events_url": "https://api.github.com/users/alexreg/events{/privacy}", "received_events_url": "https://api.github.com/users/alexreg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 583437099, "node_id": "MDU6TGFiZWw1ODM0MzcwOTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-waiting-on-team", "name": "S-waiting-on-team", "color": "d3dddd", "default": false, "description": "Status: Awaiting decision from the relevant subteam (see the T-<team> label)."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 1648796597, "node_id": "MDU6TGFiZWwxNjQ4Nzk2NTk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-trait_upcasting", "name": "F-trait_upcasting", "color": "f9c0cc", "default": false, "description": "`#![feature(trait_upcasting)]`"}, {"id": 3537209768, "node_id": "LA_kwDOAAsO6M7S1Ymo", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-tracking-ready-to-stabilize", "name": "S-tracking-ready-to-stabilize", "color": "4682b4", "default": false, "description": "This is ready to stabilize; it may need a stabilization report and a PR"}], "state": "open", "locked": false, "assignee": {"login": "crlf0710", "id": 451806, "node_id": "MDQ6VXNlcjQ1MTgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/451806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crlf0710", "html_url": "https://github.com/crlf0710", "followers_url": "https://api.github.com/users/crlf0710/followers", "following_url": "https://api.github.com/users/crlf0710/following{/other_user}", "gists_url": "https://api.github.com/users/crlf0710/gists{/gist_id}", "starred_url": "https://api.github.com/users/crlf0710/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crlf0710/subscriptions", "organizations_url": "https://api.github.com/users/crlf0710/orgs", "repos_url": "https://api.github.com/users/crlf0710/repos", "events_url": "https://api.github.com/users/crlf0710/events{/privacy}", "received_events_url": "https://api.github.com/users/crlf0710/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "crlf0710", "id": 451806, "node_id": "MDQ6VXNlcjQ1MTgwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/451806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crlf0710", "html_url": "https://github.com/crlf0710", "followers_url": "https://api.github.com/users/crlf0710/followers", "following_url": "https://api.github.com/users/crlf0710/following{/other_user}", "gists_url": "https://api.github.com/users/crlf0710/gists{/gist_id}", "starred_url": "https://api.github.com/users/crlf0710/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crlf0710/subscriptions", "organizations_url": "https://api.github.com/users/crlf0710/orgs", "repos_url": "https://api.github.com/users/crlf0710/repos", "events_url": "https://api.github.com/users/crlf0710/events{/privacy}", "received_events_url": "https://api.github.com/users/crlf0710/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 32, "created_at": "2019-10-31T02:41:44Z", "updated_at": "2023-06-12T16:22:10Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a tracking issue for [RFC3324](https://github.com/rust-lang/rfcs/pull/3324). Corresponding [MCP](https://github.com/rust-lang/lang-team/issues/98) is here.\r\nThe feature gate for the issue is `#![feature(trait_upcasting)]`.\r\n\r\n### About tracking issues\r\n\r\nTracking issues are used to record the overall progress of implementation.\r\nThey are also used as hubs connecting to other relevant issues, e.g., bugs or open design questions.\r\nA tracking issue is however *not* meant for large scale discussion, questions, or bug reports about a feature.\r\nInstead, open a dedicated issue for the specific matter and add the relevant feature gate label.\r\n\r\n### Steps\r\n\r\n- [x] Implement the experimental feature behind a feature gate.\r\n- [x] Define the semantics explicitly.\r\n- [x] Gathering design docs into initiative repo: https://github.com/rust-lang/dyn-upcasting-coercion-initiative\r\n- [x] Adjust documentation ([see instructions on rustc-dev-guide][doc-guide]) https://github.com/rust-lang/reference/pull/1259\r\n- [ ] Gather data about memory usage? https://github.com/rust-lang/rust/issues/112355\r\n- [ ] Stabilization PR ([see instructions on rustc-dev-guide][stabilization-guide]) https://github.com/rust-lang/rust/pull/101718\r\n\r\n### Previous discussions\r\n* RFC401: https://github.com/rust-lang/rfcs/pull/401\r\n* RFC982: https://github.com/rust-lang/rfcs/pull/982\r\n* RFC-issue2765: https://github.com/rust-lang/rfcs/issues/2765\r\n* MCP: https://github.com/rust-lang/lang-team/issues/98 (Current lang-team MCP)\r\n* Initiative: [Dyn upcasting coercion initiative](https://github.com/rust-lang/dyn-upcasting-coercion-initiative)\r\n* RFC: https://github.com/rust-lang/rfcs/pull/3324\r\n\r\n### Unresolved Questions\r\n* ~~Currently `CoerceUnsized` trait cannot express this case: a smart pointers that wrap a raw pointer and don't guarantee via a custom invariant that it is valid. Maybe a separate `CoerceUnsizedUnsafe` trait is needed. (see https://github.com/rust-lang/rust/pull/88010#issuecomment-898893209).~~\r\n* Should we make upcasting opt-in in some form to limit vtable size by default? The current inclination of the lang-team is \"no\", but it would be useful to gather data on how much supporting upcasting contributors to overall binary size.\r\n* ~~Before stabilizing it we should check that libs-api is ok with upcasting for all dyn-allowed traits in the library, since those we can't change.~~ (addressed by https://github.com/rust-lang/rust/issues/65991#issuecomment-1369970129)\r\n* Should we add an *opt-out* mechanism, and extend library stabilization checklist with \"do we want to opt-out for now\"?\r\n\r\n### Implementation history\r\n* Initial attempt: #60900\r\n* Second attempt:\r\n  * [X] Preparation refactoring: #86291\r\n  * [X] Unify vtable building: #86475\r\n  * [x] Update vtable format: #86461\r\n  * [x] Feature gate implementation: #86264\r\n  * [x] Pointer conversion adjustments: #87515\r\n  * [x] Support multiple occurrence of a target trait with different substsdefs: #88135\r\n  * [x] ~~Unsafety checking for raw dyn pointers: #88010 (not prefered approach, likely will need to do nothing here, but need a design meeting discussion with lang-team)~~ Solution: https://rust-lang.zulipchat.com/#narrow/stream/326132-t-types.2Fmeetings/topic/meeting.202022-09-02.20planning/near/296826711, https://github.com/rust-lang/rust/issues/101336\r\n  * [x] Lint for easing migration: https://github.com/rust-lang/rust/issues/89460\r\n  * [x] Reference changes https://github.com/rust-lang/reference/pull/1259 \r\n  * [x] Mark this feature no longer incomplete and stablize: https://github.com/rust-lang/rust/pull/101718", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65991/reactions", "total_count": 85, "+1": 85, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65991/timeline", "performed_via_github_app": null, "state_reason": null}