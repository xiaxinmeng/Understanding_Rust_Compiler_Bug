{"url": "https://api.github.com/repos/rust-lang/rust/issues/76992", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/76992/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/76992/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/76992/events", "html_url": "https://github.com/rust-lang/rust/issues/76992", "id": 705240658, "node_id": "MDU6SXNzdWU3MDUyNDA2NTg=", "number": 76992, "title": "When linking statically, native libraries should go inside --start-group/--end-group for robustness", "user": {"login": "joshtriplett", "id": 162737, "node_id": "MDQ6VXNlcjE2MjczNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162737?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshtriplett", "html_url": "https://github.com/joshtriplett", "followers_url": "https://api.github.com/users/joshtriplett/followers", "following_url": "https://api.github.com/users/joshtriplett/following{/other_user}", "gists_url": "https://api.github.com/users/joshtriplett/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshtriplett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshtriplett/subscriptions", "organizations_url": "https://api.github.com/users/joshtriplett/orgs", "repos_url": "https://api.github.com/users/joshtriplett/repos", "events_url": "https://api.github.com/users/joshtriplett/events{/privacy}", "received_events_url": "https://api.github.com/users/joshtriplett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2020-09-21T02:19:07Z", "updated_at": "2021-05-29T10:48:03Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "When rustc links rlib libraries, it puts all the libraries inside a `--start-group`/`--end-group` pair, causing the linker to resolve backreferences from a library later in the command line to one earlier in the command line.\r\n\r\nHowever, when rustc links native libraries, it puts libraries on the command line in whatever order it encountered them in code.\r\n\r\nWith shared linking, that works fine. But with static linking, the order has a crucial semantic significance: symbols in a library will get thrown away unless a library listed *previously* on the command line has a corresponding unresolved symbol.\r\n\r\nRust `#[link]` directives don't account for this, and crates in general don't worry about link order, precisely because dynamic linking is the default. When linking statically to multiple libraries, where one depends on another, this is very likely to result in symbol resolution failures at link time. In addition, if libraries have circular references (such as between glibc and libgcc), there is *no* order that will allow the libraries to link without duplicating at least one library, which seems like something `#[link]` directives should not need to account for.\r\n\r\nI would propose that when linking statically, Rust should always put *all* libraries, both rlibs and native libraries, inside one large `--start-group`/`--end-group` pair, which will allow the linker to handle symbol references both backwards and forwards, as well as circular symbol dependencies.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/76992/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/76992/timeline", "performed_via_github_app": null, "state_reason": null}