{"url": "https://api.github.com/repos/rust-lang/rust/issues/12265", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12265/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12265/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12265/events", "html_url": "https://github.com/rust-lang/rust/issues/12265", "id": 27607186, "node_id": "MDU6SXNzdWUyNzYwNzE4Ng==", "number": 12265, "title": "Define ExpansionContext trait for the quote_foo! macros to use", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-02-14T16:29:04Z", "updated_at": "2019-01-24T18:30:06Z", "closed_at": "2019-01-24T18:30:06Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The current `quote_foo!` macros (`quote_expr!`, `quote_pat!`, etc) all inject method calls on the first parameter to the macro invocation, which represents the expansion contexts.\n\nThe method calls are to methods like `cfg` (for getting the `ast::CrateConfig`) and `ident_of` (to map a string to an `ast::Ident`).\n\nBut there is no documentation for these methods, nor any standard trait defining how they should be packaged together to work with an invocation of `quote_foo!`.  (The unit test shows examples of how you might do this; see e.g. the sample code I put on the description for #12264.)\n\nPlus, when you omit the first argument, or plug in a random value for the first argument, the error message you get is less than ideal (since the compiler just complains about one method not existing, and this is one method among many).\n\nMaybe I'm mistaken, but I think we can do better; in particular, if we make the macro expand into something that calls out to another function parameterized over `<C:ExpansionContext>` where the trait-bound defines all the necessarily methods that the macro(s) expect, then we will get much better error messages from the compiler, since the user will see that there is a particular trait that they need to implement on the first argument to the macro.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12265/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12265/timeline", "performed_via_github_app": null, "state_reason": "completed"}