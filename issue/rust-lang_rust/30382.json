{"url": "https://api.github.com/repos/rust-lang/rust/issues/30382", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30382/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30382/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30382/events", "html_url": "https://github.com/rust-lang/rust/issues/30382", "id": 122176509, "node_id": "MDU6SXNzdWUxMjIxNzY1MDk=", "number": 30382, "title": "Document how Rust array/slice types are translated for extern \"C\" functions.", "user": {"login": "briansmith", "id": 16816, "node_id": "MDQ6VXNlcjE2ODE2", "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briansmith", "html_url": "https://github.com/briansmith", "followers_url": "https://api.github.com/users/briansmith/followers", "following_url": "https://api.github.com/users/briansmith/following{/other_user}", "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions", "organizations_url": "https://api.github.com/users/briansmith/orgs", "repos_url": "https://api.github.com/users/briansmith/repos", "events_url": "https://api.github.com/users/briansmith/events{/privacy}", "received_events_url": "https://api.github.com/users/briansmith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 45472092, "node_id": "MDU6TGFiZWw0NTQ3MjA5Mg==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-ffi", "name": "A-ffi", "color": "f7e101", "default": false, "description": "Area: Foreign Function Interface (FFI)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2015-12-15T02:12:58Z", "updated_at": "2022-11-02T21:40:29Z", "closed_at": "2016-01-26T22:30:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Currently I write:\n\n``` rust\nextern {\n    fn X25519(out_shared_key: *mut u8/*[32]*/, private_key: *const u8/*[32]*/,\n              peers_public_value: *const u8/*[32]*/) -> libc::c_int;\n}\n```\n\nI would like to write:\n\n``` rust\nextern {\n    fn X25519(out_shared_key: &mut [u8;32], private_key: &[u8;32],\n              peers_public_value: &[u8;32]) -> libc::c_int;\n}\n```\n\nThe C declaration is:\n\n``` c\nint X25519(uint8_t out_shared_key[32], const uint8_t private_key[32],\n           const uint8_t peers_public_value[32]);\n```\n\nwhich is equivalent to:\n\n``` c\nint X25519(uint8_t *out_shared_key, const uint8_t *private_key,\n           const uint8_t *peers_public_value);\n```\n\nThe second form of the Rust ffi declaration is safer because it makes it clear that the function doesn't accept NULL pointers and it also makes it clear how long the input arrays are expected to be. However, the Rust reference doesn't document how it translates a reference to a slice or array to a C type, so using the second form is undefined behavior. I would like the Rust Reference to be amended to make it clear that it will call translate references to arrays/slices by passing the result of `as_ptr`/`as_mut_ptr` to the C function.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30382/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30382/timeline", "performed_via_github_app": null, "state_reason": "completed"}