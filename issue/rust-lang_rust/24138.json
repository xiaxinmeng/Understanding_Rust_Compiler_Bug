{"url": "https://api.github.com/repos/rust-lang/rust/issues/24138", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24138/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24138/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24138/events", "html_url": "https://github.com/rust-lang/rust/issues/24138", "id": 66771295, "node_id": "MDU6SXNzdWU2Njc3MTI5NQ==", "number": 24138, "title": "Rustc panics on division of f64 and i32", "user": {"login": "dmner", "id": 953077, "node_id": "MDQ6VXNlcjk1MzA3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/953077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmner", "html_url": "https://github.com/dmner", "followers_url": "https://api.github.com/users/dmner/followers", "following_url": "https://api.github.com/users/dmner/following{/other_user}", "gists_url": "https://api.github.com/users/dmner/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmner/subscriptions", "organizations_url": "https://api.github.com/users/dmner/orgs", "repos_url": "https://api.github.com/users/dmner/repos", "events_url": "https://api.github.com/users/dmner/events{/privacy}", "received_events_url": "https://api.github.com/users/dmner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-04-07T04:20:56Z", "updated_at": "2015-05-13T17:29:55Z", "closed_at": "2015-05-13T17:29:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "Tried to find a simple example from my horrible scratch code, the code shouldn't compile due to the division of int and float but the compiler panics instead of erroring out.\n\nI tried this code:\n\n```\nextern crate time;\n\nfn main() {\n    let max = 10;\n    let mut total : f64 = 0.0;\n    for i in 1..max {\n        let start_time = time::precise_time_ns();\n        // operation here\n        let end_time = time::precise_time_ns();\n        let duration = (end_time - start_time) as f64 / 1000000.0;\n        println!(\"Time diff: {} ms\", duration);\n        total += duration;\n    }\n    println!(\"Avg: {}\", total / max);\n}\n```\n\nI expected to see this happen: warning about the division such as:\n\n```\nerror: the trait `core::ops::Div<_>` is not implemented for the type `f64` [E0277]\n```\n\nThat error occurs if you remove the for loop.\n\nInstead, this happened: rustc panicked\n\n```\nerror: internal compiler error: Impl DefId { krate: 2, node: 42138 } was matchable against Obligation(predicate=Binder(TraitPredicate(core::ops::Div<_>)),depth=1) but now is not\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', C:/bot/slave/nightly-dist-rustc-win-64/build/src/libsyntax\\diagnostic.rs:190\n```\n## Meta\n\n`rustc --version --verbose`:\n\n```\nrustc 1.0.0-nightly (083b8a404 2015-04-05) (built 2015-04-05)\nbinary: rustc\ncommit-hash: 083b8a40413eb3dfec7430150b8895f6c8bbafca\ncommit-date: 2015-04-05\nbuild-date: 2015-04-05\nhost: x86_64-pc-windows-gnu\nrelease: 1.0.0-nightly\n```\n\nBacktrace:\n\n```\nstack backtrace:\n   1:         0x7120a6f3 - sys::backtrace::write::h44450b400aabf2c7DUC\n   2:         0x7121fc81 - rt::unwind::register::hf93dcfca71eaeedaBtI\n   3:         0x711836e0 - rt::unwind::begin_unwind_inner::h1c26c49e466c04e9LqI\n   4:           0x6f4e29 - diagnostic::SpanHandler::span_bug::h13d9b44f0a605030nnB\n   5:           0x6f5465 - diagnostic::Handler::bug::hb88abd22760a97693sB\n   6:          0x1081af1 - middle::ty::substd_enum_variants::h652b7145d0050673Vq7\n   7:          0x1081373 - middle::ty::substd_enum_variants::h652b7145d0050673Vq7\n   8:          0x10637b7 - middle::ty::TraitPredicate<'tcx>.RegionEscape::has_regions_escaping_depth::h4332861124e51a36iR9\n   9:          0x10386c8 - middle::traits::select::SelectionContext<'cx, 'tcx>::select::h5152e335d3335b0b3NQ\n  10:          0x1047018 - middle::traits::select::SelectionContext<'cx, 'tcx>::closure_typer::h2ad939045ad278ffONQ\n  11:          0x1045277 - middle::ty::Predicate<'tcx>...std..cmp..PartialEq::ne::hb9348ef9ca6483fdT92\n  12:          0x103f626 - middle::ty::Predicate<'tcx>...std..cmp..PartialEq::ne::hb9348ef9ca6483fdT92\n  13:          0x103d7b7 - middle::ty::ProjectionPredicate<'tcx>...std..clone..Clone::clone::ha5e6eda673804f45iv3\n  14:          0x10348cf - middle::traits::fulfill::FulfillmentContext<'tcx>::select_new_obligations::h18d2468924b2bc20xDO\n  15:          0x1033f2b - middle::traits::fulfill::FulfillmentContext<'tcx>::select_where_possible::h43612618c609155c6DO\n  16:          0x16947de - check::FnCtxt<'a, 'tcx>.ty..ClosureTyper<'tcx>::closure_upvars::h4d2d960d8f47db518Hn\n  17:          0x16caee6 - check::LvaluePreference...std..fmt..Debug::fmt::h8786612addfd7375tMp\n  18:          0x17401c1 - check::callee::CallResolution<'tcx>.Repr<'tcx>::repr::h04de2749584f8541lqm\n  19:          0x17950bf - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  20:          0x1791ea1 - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  21:          0x177688b - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  22:          0x17804d8 - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  23:          0x177bb14 - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  24:          0x168468b - check::FnCtxt<'a, 'tcx>.ty..ClosureTyper<'tcx>::closure_upvars::h4d2d960d8f47db518Hn\n  25:          0x1795635 - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  26:          0x1760a08 - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  27:          0x1734829 - check::callee::CallResolution<'tcx>.DeferredCallResolution<'tcx>::resolve::hcc66066c231187905rm\n  28:          0x1730f8f - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::hb45c2700a7bbe868pVo\n  29:          0x172f0dd - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::hb45c2700a7bbe868pVo\n  30:          0x175d18a - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  31:          0x1734829 - check::callee::CallResolution<'tcx>.DeferredCallResolution<'tcx>::resolve::hcc66066c231187905rm\n  32:          0x1730f8f - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::hb45c2700a7bbe868pVo\n  33:          0x172f0dd - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::hb45c2700a7bbe868pVo\n  34:          0x179b84b - check::UnresolvedTypeAction...std..clone..Clone::clone::h4af893540a13f8a1lQp\n  35:          0x174d1c1 - check::GatherLocalsVisitor<'a, 'tcx>.Visitor<'tcx>::visit_item::hceaf85db2079e370EZn\n  36:          0x172b502 - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::hb45c2700a7bbe868pVo\n  37:          0x174849f - check::CheckItemTypesVisitor<'a, 'tcx>.Visitor<'tcx>::visit_ty::h052b2547f6a9f346sMn\n  38:          0x17425a2 - check::CheckItemTypesVisitor<'a, 'tcx>.Visitor<'tcx>::visit_item::h3825f10c694ef4b96Ln\n  39:          0x1814d98 - check_crate::h0c1ffccf36595c1a1oC\n  40:          0x180f18c - check_crate::h0c1ffccf36595c1a1oC\n  41:         0x652df97b - driver::phase_3_run_analysis_passes::h4f4155770758209cgGa\n  42:         0x652c2c72 - driver::compile_input::h26f65b3844aecdf5Qba\n  43:         0x65376df3 - run_compiler::hbef16719e0bfa262S4b\n  44:         0x65374bff - run::hb658b94f918c924fy4b\n  45:         0x65373fda - run::hb658b94f918c924fy4b\n  46:         0x7125946c - rust_try\n  47:         0x71259449 - rust_try\n  48:         0x653742c1 - run::hb658b94f918c924fy4b\n  49:         0x712139d4 - sys::tcp::TcpListener::bind::h2dcec942e16be4c4OSG\n  50:     0x7ffa967b13d2 - BaseThreadInitThunk\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24138/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24138/timeline", "performed_via_github_app": null, "state_reason": "completed"}