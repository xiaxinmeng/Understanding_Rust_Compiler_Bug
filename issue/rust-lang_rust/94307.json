{"url": "https://api.github.com/repos/rust-lang/rust/issues/94307", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94307/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94307/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94307/events", "html_url": "https://github.com/rust-lang/rust/issues/94307", "id": 1148620405, "node_id": "I_kwDOAAsO6M5Edo51", "number": 94307, "title": "unused_lifetimes lint has false positives with GATs", "user": {"login": "kahomayo", "id": 74737340, "node_id": "MDQ6VXNlcjc0NzM3MzQw", "avatar_url": "https://avatars.githubusercontent.com/u/74737340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kahomayo", "html_url": "https://github.com/kahomayo", "followers_url": "https://api.github.com/users/kahomayo/followers", "following_url": "https://api.github.com/users/kahomayo/following{/other_user}", "gists_url": "https://api.github.com/users/kahomayo/gists{/gist_id}", "starred_url": "https://api.github.com/users/kahomayo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kahomayo/subscriptions", "organizations_url": "https://api.github.com/users/kahomayo/orgs", "repos_url": "https://api.github.com/users/kahomayo/repos", "events_url": "https://api.github.com/users/kahomayo/events{/privacy}", "received_events_url": "https://api.github.com/users/kahomayo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1485960423, "node_id": "MDU6TGFiZWwxNDg1OTYwNDIz", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_associated_types", "name": "F-generic_associated_types", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_associated_types)]` a.k.a. GATs"}, {"id": 3307663436, "node_id": "MDU6TGFiZWwzMzA3NjYzNDM2", "url": "https://api.github.com/repos/rust-lang/rust/labels/GATs-triaged", "name": "GATs-triaged", "color": "e88000", "default": false, "description": "Issues using the `generic_associated_types` feature that have been triaged"}, {"id": 3942537418, "node_id": "LA_kwDOAAsO6M7q_ljK", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-lint-single_use_lifetimes", "name": "F-lint-single_use_lifetimes", "color": "f9c0cc", "default": false, "description": "`single_use_lifetimes` lint"}], "state": "closed", "locked": false, "assignee": {"login": "chansuke", "id": 501052, "node_id": "MDQ6VXNlcjUwMTA1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/501052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chansuke", "html_url": "https://github.com/chansuke", "followers_url": "https://api.github.com/users/chansuke/followers", "following_url": "https://api.github.com/users/chansuke/following{/other_user}", "gists_url": "https://api.github.com/users/chansuke/gists{/gist_id}", "starred_url": "https://api.github.com/users/chansuke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chansuke/subscriptions", "organizations_url": "https://api.github.com/users/chansuke/orgs", "repos_url": "https://api.github.com/users/chansuke/repos", "events_url": "https://api.github.com/users/chansuke/events{/privacy}", "received_events_url": "https://api.github.com/users/chansuke/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "chansuke", "id": 501052, "node_id": "MDQ6VXNlcjUwMTA1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/501052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chansuke", "html_url": "https://github.com/chansuke", "followers_url": "https://api.github.com/users/chansuke/followers", "following_url": "https://api.github.com/users/chansuke/following{/other_user}", "gists_url": "https://api.github.com/users/chansuke/gists{/gist_id}", "starred_url": "https://api.github.com/users/chansuke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chansuke/subscriptions", "organizations_url": "https://api.github.com/users/chansuke/orgs", "repos_url": "https://api.github.com/users/chansuke/repos", "events_url": "https://api.github.com/users/chansuke/events{/privacy}", "received_events_url": "https://api.github.com/users/chansuke/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2022-02-23T21:55:00Z", "updated_at": "2022-06-19T23:34:02Z", "closed_at": "2022-06-19T23:34:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "The `unused_lifetimes` lint can be incorrectly triggered both by declaring and by implementing GATs. \r\n\r\nDeclaring a GAT with an unconstrained lifetime causes the lint to fire ([Playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=906033d3864d7b30ba35b14f9d7a378c)):\r\n\r\n```rust\r\n#![feature(generic_associated_types)]\r\n#![warn(unused_lifetimes)]\r\n\r\ntrait Foo {\r\n    // This GAT triggers the lint:\r\n    type X<'x>;\r\n    // Using the lifetime in an associated function does not avoid the lint.\r\n    fn make_x<'a>(_x: &'a()) -> Self::X<'a>;\r\n    fn make_x_elide(_x: &()) -> Self::X<'_>;\r\n}\r\n```\r\n\r\nThis code should be accepted (or maybe produce a lint about a lack of constraints on `'x`). Right now, it produces warnings about unused lifetimes. Note that there is no way to elide the lifetime (as the lint suggests) and that removing the lifetime breaks the API for implementors and users.\r\n\r\n```\r\nwarning: lifetime parameter `'x` never used\r\n --> src/lib.rs:6:12\r\n  |\r\n6 |     type X<'x>;\r\n  |           -^^- help: elide the unused lifetime\r\n  |\r\n```\r\n\r\nImplementing a GAT without using a lifetime causes the lint to fire:\r\n\r\n```rust\r\nimpl Foo for () {\r\n    type X<'x> = u8;\r\n    fn make_x<'a>(_x: &'a ()) -> u8 { 0 }\r\n    fn make_x_elide(_x: &()) -> u8 { 0 }\r\n}\r\n```\r\n\r\nThis code should be accepted, as there is no way for the implementor to elide the lifetime here (`'_` is reserved and omitting the `<'x>` is a lifetime mismatch). Using the lifetime in the type would alter the meaning of the code and may break consumers.\r\n\r\n```\r\nwarning: lifetime parameter `'x` never used\r\n  --> src/lib.rs:13:12\r\n   |\r\n13 |     type X<'x> = u8;\r\n   |           -^^- help: elide the unused lifetime\r\n```\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.61.0-nightly (68369a041 2022-02-22)\r\nbinary: rustc\r\ncommit-hash: 68369a041cea809a87e5bd80701da90e0e0a4799\r\ncommit-date: 2022-02-22\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.61.0-nightly\r\nLLVM version: 14.0.0\r\n```\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"chansuke\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94307/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94307/timeline", "performed_via_github_app": null, "state_reason": "completed"}