{"url": "https://api.github.com/repos/rust-lang/rust/issues/47059", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47059/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47059/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47059/events", "html_url": "https://github.com/rust-lang/rust/issues/47059", "id": 285073046, "node_id": "MDU6SXNzdWUyODUwNzMwNDY=", "number": 47059, "title": "Value borrowed in argument not unborrowed prior to parent function call", "user": {"login": "GavrielPlotke", "id": 5597718, "node_id": "MDQ6VXNlcjU1OTc3MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/5597718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GavrielPlotke", "html_url": "https://github.com/GavrielPlotke", "followers_url": "https://api.github.com/users/GavrielPlotke/followers", "following_url": "https://api.github.com/users/GavrielPlotke/following{/other_user}", "gists_url": "https://api.github.com/users/GavrielPlotke/gists{/gist_id}", "starred_url": "https://api.github.com/users/GavrielPlotke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GavrielPlotke/subscriptions", "organizations_url": "https://api.github.com/users/GavrielPlotke/orgs", "repos_url": "https://api.github.com/users/GavrielPlotke/repos", "events_url": "https://api.github.com/users/GavrielPlotke/events{/privacy}", "received_events_url": "https://api.github.com/users/GavrielPlotke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-29T10:50:18Z", "updated_at": "2019-10-17T18:43:04Z", "closed_at": "2019-10-17T18:43:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "A simple vector borrow to read a value, when done as an argument to a push to that vector fails compile\r\n```\r\nfn main() {\r\n\tlet mut v = vec![1,1,2,4,5,10];\r\n\tlet old = 3;    \r\n\tv.push(v[old]);        // Why does this fail the borrow checker?!\r\n//\tlet v_next = v[old];   // When doing the argument calculation separately\r\n//\tv.push(v_next);        // compiles fine?!\r\n\tprintln!(\"Vector = {:?}\", v);\r\n}\r\n```\r\nI expect the above code to compile, but it fails (see below).\r\nWhen I comment out the offending line, and uncomment the two lines below it (which are logically equivalent) it does compile and run correctly.\r\nThe compiler should be smart enough to see that all items temporarily borrowed in the computation of an argument are un-borrowed prior to the each subsequent argument, and prior to the execution of the parent function.\r\n```\r\nerror[E0502]: cannot borrow `v` as immutable because it is also borrowed as mutable\r\n --> src/main.rs:4:9\r\n  |\r\n4 |     v.push(v[old]);        // Why does this fail the borrow checker?!\r\n  |     -      ^     - mutable borrow ends here\r\n  |     |      |\r\n  |     |      immutable borrow occurs here\r\n  |     mutable borrow occurs here\r\n```\r\n\r\n## Meta\r\nOn both stable and nightly on https://play.rust-lang.org/ as of 12/29/2017", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47059/timeline", "performed_via_github_app": null, "state_reason": "completed"}