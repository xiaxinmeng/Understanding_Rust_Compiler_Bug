{"url": "https://api.github.com/repos/rust-lang/rust/issues/71635", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/71635/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/71635/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/71635/events", "html_url": "https://github.com/rust-lang/rust/issues/71635", "id": 608225309, "node_id": "MDU6SXNzdWU2MDgyMjUzMDk=", "number": 71635, "title": "Unhelpful error message, and endless loop in cargo, when a procedural macro overflows its stack", "user": {"login": "hiddenhare", "id": 43314166, "node_id": "MDQ6VXNlcjQzMzE0MTY2", "avatar_url": "https://avatars.githubusercontent.com/u/43314166?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hiddenhare", "html_url": "https://github.com/hiddenhare", "followers_url": "https://api.github.com/users/hiddenhare/followers", "following_url": "https://api.github.com/users/hiddenhare/following{/other_user}", "gists_url": "https://api.github.com/users/hiddenhare/gists{/gist_id}", "starred_url": "https://api.github.com/users/hiddenhare/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hiddenhare/subscriptions", "organizations_url": "https://api.github.com/users/hiddenhare/orgs", "repos_url": "https://api.github.com/users/hiddenhare/repos", "events_url": "https://api.github.com/users/hiddenhare/events{/privacy}", "received_events_url": "https://api.github.com/users/hiddenhare/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}, {"id": 1659943986, "node_id": "MDU6TGFiZWwxNjU5OTQzOTg2", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-verbose", "name": "D-verbose", "color": "c9f7a3", "default": false, "description": "Too much output caused by a single piece of incorrect code"}, {"id": 1839565265, "node_id": "MDU6TGFiZWwxODM5NTY1MjY1", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-terse", "name": "D-terse", "color": "c9f7a3", "default": false, "description": "A diagnostic that doesn't give enough information about the problem at hand"}, {"id": 2079070889, "node_id": "MDU6TGFiZWwyMDc5MDcwODg5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-proc-macros", "name": "A-proc-macros", "color": "f7e101", "default": false, "description": "Area: Procedural macros"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-28T10:59:20Z", "updated_at": "2023-03-27T04:50:40Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Using `rustc 1.44.0-nightly (b2e36e6c2 2020-04-22)` on Windows 10.\r\n\r\nCreate a proc-macro crate `crate0` with these contents:\r\n\r\n\textern crate proc_macro;\r\n\tuse proc_macro::TokenStream;\r\n\r\n\t#[proc_macro]\r\n\tpub fn overflow_stack(item: TokenStream) -> TokenStream {\r\n\t    fn recurse(i: u64) {\r\n\t    \tif i < std::u64::MAX {\r\n\t    \t    recurse(i + 1);\r\n\t    \t}\r\n\t    }\r\n\r\n\t    recurse(0);\r\n\t    item\r\n\t}\r\n\r\nAnd a binary crate `crate1` with these contents:\r\n\r\n\t#![feature(proc_macro_hygiene)]\r\n\r\n\tfn main() {\r\n\t    crate0::overflow_stack!();\r\n\t}\r\n\r\n`cargo build` for `crate1` will produce this error message:\r\n\r\n    thread 'rustc' has overflowed its stack\r\n    error: could not compile `crate1`.\r\n    \r\n    Caused by:\r\n      process didn't exit successfully: `rustc {...a long list of arguments follows...}`\r\n\r\nWhen a stack-overflow bug is introduced into a procedural macro by making changes to one of the procedural macro's local dependencies, this error message is not helpful for localising the bug. (I experienced this today, and wasted some time thinking that I had triggered an ICE.)\r\n\r\nI also experienced an endless loop in `cargo build` triggered by that same stack overflow, but I haven't been able to isolate a test-case.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/71635/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/71635/timeline", "performed_via_github_app": null, "state_reason": null}