{"url": "https://api.github.com/repos/rust-lang/rust/issues/31907", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31907/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31907/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31907/events", "html_url": "https://github.com/rust-lang/rust/issues/31907", "id": 136622725, "node_id": "MDU6SXNzdWUxMzY2MjI3MjU=", "number": 31907, "title": "Doc-tests not compiled ok when setted as `no_run` on target x86_64-unknown-linux-musl", "user": {"login": "zitsen", "id": 3772803, "node_id": "MDQ6VXNlcjM3NzI4MDM=", "avatar_url": "https://avatars.githubusercontent.com/u/3772803?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zitsen", "html_url": "https://github.com/zitsen", "followers_url": "https://api.github.com/users/zitsen/followers", "following_url": "https://api.github.com/users/zitsen/following{/other_user}", "gists_url": "https://api.github.com/users/zitsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/zitsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zitsen/subscriptions", "organizations_url": "https://api.github.com/users/zitsen/orgs", "repos_url": "https://api.github.com/users/zitsen/repos", "events_url": "https://api.github.com/users/zitsen/events{/privacy}", "received_events_url": "https://api.github.com/users/zitsen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-02-26T07:52:39Z", "updated_at": "2016-03-16T10:41:41Z", "closed_at": "2016-03-15T18:29:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "To list usage in documents, add a example in the `lib.rs` documents with mark `no_run`. It's ok when\ntarget not setted(it's `x86_64-unknown-linux-gnu`), but failed on target `x86_64-unknown-linux-musl`:\n\nI tried this code:\n\n```\ncargo new doc-tests-no-run-bug\n```\n\nsrc/lib.rs:\n\n`````` rust\n//! ```no_run\n//! extern crate doc_tests_no_run_bug;\n//! fn main() {\n//!   assert!(false);\n//! }\n//! ```\n\n#[cfg(test)]\nmod test {\n    #[test]\n    fn it_works() {\n    }\n}\n``````\n\ndefault test is ok:\n\n```\n# Run: cargo test\n     Running target/debug/doc_tests_no_run_bug-cffd3fd286caef08\n\nrunning 1 test\ntest test::it_works ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured\n\n   Doc-tests doc-tests-no-run-bug\n\nrunning 1 test\ntest _0 ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured\n\n```\n\nTest it on target `x86_64-unknown-linux-musl`:\n\n```\ncargo test --target=x86_64-unknown-linux-musl\n```\n\nDoc-tests should not run as I expected, but it fails as this: \n\n```\nrunning 1 test\ntest test::it_works ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured\n\n   Doc-tests doc-tests-no-run-bug\n\nrunning 1 test\ntest _0 ... FAILED\n\nfailures:\n\n---- _0 stdout ----\n    <anon>:1:1: 1:35 error: couldn't find crate `doc_tests_no_run_bug` with expected target triple x86_64-unknown-linux-gnu [E0461]\n<anon>:1 extern crate doc_tests_no_run_bug;\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<anon>:1:1: 1:35 note: crate `doc_tests_no_run_bug`, path #1, triple x86_64-unknown-linux-musl: /home/mypath/doc-tests-no-run-bug/target/x86_64-unknown-linux-musl/debug/libdoc_tests_no_run_bug.rlib\nerror: aborting due to previous error\nthread '_0' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:607\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\nthread '_0' panicked at 'couldn't compile the test', ../src/librustdoc/test.rs:280\n\n\nfailures:\n    _0\n\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured\n```\n## Meta\n\n`rustc --version --verbose`:\n\n```\nrustc 1.8.0-dev (798ce4ab5 2016-02-25)\nbinary: rustc\ncommit-hash: 798ce4ab59ab2ca84caacc4472499409a8516db3\ncommit-date: 2016-02-25\nhost: x86_64-unknown-linux-gnu\nrelease: 1.8.0-dev\n```\n\nBacktrace: \n\n```\nRUST_BACKTRACE=1 cargo test --target=x86_64-unknown-linux-musl\n```\n\nResult:\n\n```\n   Compiling doc-tests-no-run-bug v0.1.0 (file:///xxx/doc-tests-no-run-bug)\n\n     Running target/x86_64-unknown-linux-musl/debug/doc_tests_no_run_bug-cffd3fd286caef08\n\nrunning 1 test\ntest test::it_works ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured\n\n   Doc-tests doc-tests-no-run-bug\n\nrunning 1 test\ntest _0 ... FAILED\n\nfailures:\n\n---- _0 stdout ----\n    <anon>:1:1: 1:35 error: couldn't find crate `doc_tests_no_run_bug` with expected target triple x86_64-unknown-linux-gnu [E0461]\n<anon>:1 extern crate doc_tests_no_run_bug;\n         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<anon>:1:1: 1:35 note: crate `doc_tests_no_run_bug`, path #1, triple x86_64-unknown-linux-musl: /xxx/doc-tests-no-run-bug/target/x86_64-unknown-linux-musl/debug/libdoc_tests_no_run_bug.rlib\nerror: aborting due to previous error\nthread '_0' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:607\nstack backtrace:\n   1:     0x7fadd9059fd0 - sys::backtrace::tracing::imp::write::hd6d99fcaca6f3487qru\n   2:     0x7fadd9062f9b - panicking::default_handler::_$u7b$$u7b$closure$u7d$$u7d$::closure.43421\n   3:     0x7fadd9062af3 - panicking::default_handler::hd56ae5efa8870fb8eZy\n   4:     0x7fadd902b90c - sys_common::unwind::begin_unwind_inner::hddffc5a57d251d30fgt\n   5:     0x7fadd4d14297 - sys_common::unwind::begin_unwind::h8186529389946867416\n   6:     0x7fadd4d14170 - errors::Handler::abort_if_errors::ha1e2ef558ecc9b01lVd\n   7:     0x7fadd7848a23 - loader::Context<'a>::report_load_errs::hf989e542067ac336cTl\n   8:     0x7fadd7845b8f - loader::Context<'a>::load_library_crate::hd4c66c69e84d8b3fySl\n   9:     0x7fadd7844909 - creader::CrateReader<'a>::resolve_crate::h542e175397ef02b3g3j\n  10:     0x7fadd783f40e - creader::LocalCrateReader<'a, 'b>.Visitor<'hir>::visit_item::hfa765e8eb352b635QCj\n  11:     0x7fadd7851b9e - creader::LocalCrateReader<'a, 'b>::read_crates::h7df930f9047d0fd8Gvk\n  12:     0x7fadd8888bad - driver::phase_3_run_analysis_passes::h16257317625067277007\n  13:     0x7fadd885cdaa - driver::compile_input::ha4ae3a60f7db99f6Bca\n  14:     0x7fadd96f715f - sys_common::unwind::try::try_fn::h3639206756227387971\n  15:     0x7fadd90578fb - __rust_try\n  16:     0x7fadd904ff2d - sys_common::unwind::inner_try::h3542d60f67fb7f36hdt\n  17:     0x7fadd96f36dd - test::runtest::haef3dfd286ad2a757tu\n  18:     0x7fadd96f7e26 - boxed::F.FnBox<A>::call_box::h7907733678206165708\n  19:     0x7fadd1b6686b - sys_common::unwind::try::try_fn::h17857959527288479610\n  20:     0x7fadd90578fb - __rust_try\n  21:     0x7fadd904ff2d - sys_common::unwind::inner_try::h3542d60f67fb7f36hdt\n  22:     0x7fadd1b66bea - boxed::F.FnBox<A>::call_box::h17375982074145669126\n  23:     0x7fadd9061560 - sys::thread::Thread::new::thread_start::h59456e26addaa3d3yWx\n  24:     0x7fadd1240181 - start_thread\n  25:     0x7fadd8cd047c - __clone\n  26:                0x0 - <unknown>\nthread '_0' panicked at 'couldn't compile the test', ../src/librustdoc/test.rs:280\nstack backtrace:\n   1:     0x7fadd9059fd0 - sys::backtrace::tracing::imp::write::hd6d99fcaca6f3487qru\n   2:     0x7fadd9062f9b - panicking::default_handler::_$u7b$$u7b$closure$u7d$$u7d$::closure.43421\n   3:     0x7fadd9062af3 - panicking::default_handler::hd56ae5efa8870fb8eZy\n   4:     0x7fadd902b90c - sys_common::unwind::begin_unwind_inner::hddffc5a57d251d30fgt\n   5:     0x7fadd953a2ff - sys_common::unwind::begin_unwind::h15274598743891702961\n   6:     0x7fadd96f529a - test::runtest::haef3dfd286ad2a757tu\n   7:     0x7fadd96f7e26 - boxed::F.FnBox<A>::call_box::h7907733678206165708\n   8:     0x7fadd1b6686b - sys_common::unwind::try::try_fn::h17857959527288479610\n   9:     0x7fadd90578fb - __rust_try\n  10:     0x7fadd904ff2d - sys_common::unwind::inner_try::h3542d60f67fb7f36hdt\n  11:     0x7fadd1b66bea - boxed::F.FnBox<A>::call_box::h17375982074145669126\n  12:     0x7fadd9061560 - sys::thread::Thread::new::thread_start::h59456e26addaa3d3yWx\n  13:     0x7fadd1240181 - start_thread\n  14:     0x7fadd8cd047c - __clone\n  15:                0x0 - <unknown>\n\n\nfailures:\n    _0\n\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured\n\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31907/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31907/timeline", "performed_via_github_app": null, "state_reason": "completed"}