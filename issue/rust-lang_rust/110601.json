{"url": "https://api.github.com/repos/rust-lang/rust/issues/110601", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110601/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110601/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110601/events", "html_url": "https://github.com/rust-lang/rust/issues/110601", "id": 1676727248, "node_id": "I_kwDOAAsO6M5j8NPQ", "number": 110601, "title": "hir typeck overwrites multiple defining uses of the same opaque", "user": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472502130, "node_id": "MDU6TGFiZWwxNDcyNTAyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-type_alias_impl_trait", "name": "F-type_alias_impl_trait", "color": "f9c0cc", "default": false, "description": "`#[feature(type_alias_impl_trait)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-04-20T13:26:50Z", "updated_at": "2023-05-25T11:41:26Z", "closed_at": "2023-05-25T11:41:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\r\n#![feature(type_alias_impl_trait)]\r\ntype Tait<T> = impl Sized;\r\n\r\nfn foo<T, U>(x: T) {\r\n    loop {\r\n        break;\r\n        let _: Tait<U> = String::new();\r\n    }\r\n    let _: Tait<T> = x;\r\n}\r\n```\r\nthis passes but should error. The issue is that when writing the opaque type into the `TypeckResults` we drop the previous entry without comparing them for equality.\r\n\r\nhttps://github.com/rust-lang/rust/blob/7e23d180c1db42941b3bd32542a899e9eee7cbcb/compiler/rustc_hir_typeck/src/writeback.rs#L587\r\n\r\nnormally this would get caught by borrowck which does handle them correctly, however `Tait<U>` is defined in unreachable code so mir borrowck does not catch this.\r\n\r\nwe do explicitly check that the opaques from unreachable code are equal to the reachable ones but this check uses the opaques from hir typeck which means we again ignore `Tait<U>` there.", "closed_by": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110601/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110601/timeline", "performed_via_github_app": null, "state_reason": "completed"}