{"url": "https://api.github.com/repos/rust-lang/rust/issues/57528", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57528/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57528/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57528/events", "html_url": "https://github.com/rust-lang/rust/issues/57528", "id": 398446632, "node_id": "MDU6SXNzdWUzOTg0NDY2MzI=", "number": 57528, "title": "Confusing first/second mutable borrow occurs here diagnostic in NLL", "user": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867465998, "node_id": "MDU6TGFiZWw4Njc0NjU5OTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-diagnostics", "name": "NLL-diagnostics", "color": "f799ea", "default": false, "description": "Working torwads the \"diagnostic parity\" goal"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-11T20:49:05Z", "updated_at": "2019-03-20T19:31:00Z", "closed_at": "2019-03-20T19:30:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "After https://github.com/rust-lang/rust/pull/56113 we figured with @nikomatsakis that the output of `src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.rs` in NLL is not ideal.\r\n\r\n```rust\r\nfn main() {\r\n    let mut x = 1;\r\n    let mut addr = vec![];\r\n    loop {\r\n        match 1 {\r\n            1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n            2 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n            _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\noutputs:\r\n\r\n```\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:13:30\r\n   |\r\nLL |             1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                    ----      ^^^^^^ second mutable borrow occurs here\r\n   |                    |\r\n   |                    first borrow later used here\r\n...\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ------ first mutable borrow occurs here\r\n\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:15:30\r\n   |\r\nLL |             1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                    ---- first borrow later used here\r\nLL |             //[mir]~^ ERROR [E0499]\r\nLL |             2 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ^^^^^^ second mutable borrow occurs here\r\nLL |             //[mir]~^ ERROR [E0499]\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ------ first mutable borrow occurs here\r\n\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:17:30\r\n   |\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ^^^^^^ mutable borrow starts here in previous iteration of loop\r\n\r\nerror: aborting due to 3 previous errors\r\n\r\nFor more information about this error, try `rustc --explain E0499`.\r\n```\r\n\r\nin NLL mode.\r\n\r\nIn particular the mention of first and second is weird. Why the `_ =>` arm is the first one?. Is that clear to the user?. There are several errors in the test also. Is it better to mix the fact that you're mutably borrowing something in `_ =>` and the mutably borrowing in `1 =>`? or is it better and easier to just state that both borrows are inside of the loop?.", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57528/timeline", "performed_via_github_app": null, "state_reason": "completed"}