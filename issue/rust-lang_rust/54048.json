{"url": "https://api.github.com/repos/rust-lang/rust/issues/54048", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54048/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54048/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54048/events", "html_url": "https://github.com/rust-lang/rust/issues/54048", "id": 358266904, "node_id": "MDU6SXNzdWUzNTgyNjY5MDQ=", "number": 54048, "title": "-C remark=loop-vectorize doesn't point to the source line", "user": {"login": "GabrielMajeri", "id": 3010346, "node_id": "MDQ6VXNlcjMwMTAzNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/3010346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GabrielMajeri", "html_url": "https://github.com/GabrielMajeri", "followers_url": "https://api.github.com/users/GabrielMajeri/followers", "following_url": "https://api.github.com/users/GabrielMajeri/following{/other_user}", "gists_url": "https://api.github.com/users/GabrielMajeri/gists{/gist_id}", "starred_url": "https://api.github.com/users/GabrielMajeri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GabrielMajeri/subscriptions", "organizations_url": "https://api.github.com/users/GabrielMajeri/orgs", "repos_url": "https://api.github.com/users/GabrielMajeri/repos", "events_url": "https://api.github.com/users/GabrielMajeri/events{/privacy}", "received_events_url": "https://api.github.com/users/GabrielMajeri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-09-08T05:41:31Z", "updated_at": "2020-06-11T17:38:06Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was trying to use `-C remark` to understand why a loop didn't get vectorized. You can [see the simple example code on godbolt](https://rust.godbolt.org/z/KHuX1A).\r\n\r\n```rust\r\nfn simple_loop(values: &[u32; 1024]) -> u32 {\r\n    values.into_iter().fold(0, |acc, i| { /* something */ })\r\n}\r\n```\r\n\r\nThe loop itself isn't very important, the issue is with what the remark message says:\r\n\r\n```\r\nnote: optimization analysis for loop-vectorize at /checkout/src/libcore/slice/mod.rs:2431:20: ...\r\n```\r\nAs you can see, instead of saying something like `at <source_file>:2:5: ...`, it points to a method in the standard library. In this case, there was only one iterator loop in the file, but it quickly becomes impossible to determine which loop it refers to if there are multiple ones.\r\n\r\nA temporary solution is to give up on Rust's iterators and use a primitive `while` loop to get an accurate indication:\r\n\r\n```rust\r\nlet mut i = 0;\r\nwhile i < 1024 { /* ... */ }\r\n```\r\n\r\nNow the message becomes:\r\n\r\n```rust\r\nnote: optimization analysis for loop-vectorize at <source>:14:4: ...\r\n```\r\n\r\nSo it's easier to determine which loop it was referring to.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54048/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54048/timeline", "performed_via_github_app": null, "state_reason": null}