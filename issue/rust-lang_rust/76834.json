{"url": "https://api.github.com/repos/rust-lang/rust/issues/76834", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/76834/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/76834/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/76834/events", "html_url": "https://github.com/rust-lang/rust/issues/76834", "id": 703476995, "node_id": "MDU6SXNzdWU3MDM0NzY5OTU=", "number": 76834, "title": "SIGSEGV when using \"m\" or \"R\" modifier in llvm_asm! of mips target", "user": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 91598611, "node_id": "MDU6TGFiZWw5MTU5ODYxMQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inline-assembly", "name": "A-inline-assembly", "color": "f7e101", "default": false, "description": "Area: inline asm!(..)"}, {"id": 106552066, "node_id": "MDU6TGFiZWwxMDY1NTIwNjY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-MIPS", "name": "O-MIPS", "color": "6e6ec0", "default": false, "description": "Target: MIPS processors"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-09-17T10:48:33Z", "updated_at": "2020-09-17T12:42:43Z", "closed_at": "2020-09-17T12:37:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Was digging around how to add `asm!` support for mips target.\r\nI got the Segmentation fault when using \"m\" or \"R\" modifiers.\r\n\r\nI tried this code: https://rust.godbolt.org/z/eKvW61\r\n\r\n**source.rs**\r\n```rust\r\n#![feature(llvm_asm)]\r\n\r\nextern \"C\" {\r\n    fn extern_func();\r\n}\r\n\r\npub unsafe fn foo3() -> usize {\r\n    let mut a: usize;\r\n    llvm_asm!(\"la $$v0, $0\" : \"={v0}\"(a) : \"m\"(extern_func));\r\n    a\r\n}\r\n```\r\n\r\nRun:\r\n```bash\r\nrustc --edition=2018 source.rs \\\r\n  --crate-type lib --emit=dep-info,metadata,link \\\r\n  -C embed-bitcode=no -C debuginfo=2 \\\r\n  --target mips-unknown-linux-gnu\r\n```\r\n\r\nI expected to see this happen: Compile succeed or error about things gone wrong\r\n\r\nInstead, this happened: Compiler returns `signal: 11, SIGSEGV: invalid memory reference`.\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.48.0-nightly (6af1bdda5 2020-09-15)\r\nbinary: rustc\r\ncommit-hash: 6af1bdda54abc9e919fc1137411dfc4311e05649\r\ncommit-date: 2020-09-15\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.48.0-nightly\r\nLLVM version: 11.0\r\n```\r\n\r\n`clang -v`: clang version 11.0.0 (https://github.com/rust-lang/llvm-project.git 45790d79496be37fbce6ec57abad5af8fa7a34d7)\r\n`gcc -v`: gcc version 10.2.0 (GCC) \r\n`as --version`: GNU assembler (GNU Binutils for Debian) 2.28\r\n`llvm-as --version`: LLVM version 11.0.0-rust-dev\r\n\r\n<details><summary>Backtrace by running \"bt full\" in rust-gdb</summary>\r\n<p>\r\n\r\n  ```gdb\r\n  #0  0x00007fffefb2fab0 in llvm::DataLayout::getAlignment(llvm::Type*, bool) const () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #1  0x00007ffff01dab30 in llvm::SelectionDAGBuilder::visitInlineAsm(llvm::CallBase const&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #2  0x00007ffff01b9917 in llvm::SelectionDAGBuilder::visit(llvm::Instruction const&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #3  0x00007ffff027970e in llvm::SelectionDAGISel::SelectBasicBlock(llvm::ilist_iterator<llvm::ilist_detail::node_options<llvm::Instruction, false, false, void>, false, true>, llvm::ilist_iterator<llvm::ilist_detail::node_options<llvm::Instruction, false, false, void>, fal\r\n  se, true>, bool&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #4  0x00007ffff02789a3 in llvm::SelectionDAGISel::SelectAllBasicBlocks(llvm::Function const&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #5  0x00007ffff0275b36 in llvm::SelectionDAGISel::runOnMachineFunction(llvm::MachineFunction&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #6  0x00007ffff1b7c5e1 in llvm::MipsSEDAGToDAGISel::runOnMachineFunction(llvm::MachineFunction&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #7  0x00007fffefde2a5e in llvm::MachineFunctionPass::runOnFunction(llvm::Function&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #8  0x00007fffefbbe242 in llvm::FPPassManager::runOnFunction(llvm::Function&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #9  0x00007fffefbc4c53 in llvm::FPPassManager::runOnModule(llvm::Module&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #10 0x00007fffefbbec9a in llvm::legacy::PassManagerImpl::run(llvm::Module&) () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-11-rust-1.48.0-nightly.so\r\n  No symbol table info available.\r\n  #11 0x00007ffff3f53bd0 in LLVMRustWriteOutputFile () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #12 0x00007ffff3ee5a4c in rustc_codegen_llvm::back::write::write_output_file::h4e3fcf4f4a5f505a () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #13 0x00007ffff3eea2b7 in rustc_codegen_llvm::back::write::codegen::h68c2b779abf521e7 () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #14 0x00007ffff3ecf89b in rustc_codegen_ssa::back::write::finish_intra_module_work::h53e3a5ca114d6eae () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #15 0x00007ffff3ec99b4 in rustc_codegen_ssa::back::write::execute_work_item::hdba53778fe3e2ebd () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #16 0x00007ffff3e1334f in std::sys_common::backtrace::__rust_begin_short_backtrace::h60c4da468da1185a () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #17 0x00007ffff3e1c525 in core::ops::function::FnOnce::call_once$u7b$$u7b$vtable.shim$u7d$$u7d$::h50f6eccab5571e88 () from /home/lzutao/.rustup/toolchains/nightly-2020-09-16-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-2184b4d68f87ffe7.so\r\n  No symbol table info available.\r\n  #18 0x00007ffff31b861a in _$LT$alloc..boxed..Box$LT$F$GT$$u20$as$u20$core..ops..function..FnOnce$LT$A$GT$$GT$::call_once::h462e787c72080422 () at /rustc/6af1bdda54abc9e919fc1137411dfc4311e05649/library/alloc/src/boxed.rs:1042\r\n  No locals.\r\n  #19 _$LT$alloc..boxed..Box$LT$F$GT$$u20$as$u20$core..ops..function..FnOnce$LT$A$GT$$GT$::call_once::hd438caf7b24ea9a1 () at /rustc/6af1bdda54abc9e919fc1137411dfc4311e05649/library/alloc/src/boxed.rs:1042\r\n  No locals.\r\n  #20 std::sys::unix::thread::Thread::new::thread_start::h653bd369f002a164 () at library/std/src/sys/unix/thread.rs:87\r\n  No locals.\r\n  #21 0x00007ffff2efb4a4 in start_thread (arg=0x7fffebb7f700) at pthread_create.c:456\r\n          __res = <optimized out>\r\n          pd = 0x7fffebb7f700\r\n          now = <optimized out>\r\n          unwind_buf = {\r\n            cancel_jmp_buf = {{\r\n                jmp_buf = {140737148090112, 8377257002447776601, 140737085684830, 140737085684831, 140737145991168, 3, -8377212402486367399, -8377228550589666471},\r\n                mask_was_saved = 0\r\n              }},\r\n            priv = {\r\n              pad = {0x0, 0x0, 0x0, 0x0},\r\n              data = {\r\n                prev = 0x0,\r\n                cleanup = 0x0,\r\n                canceltype = 0\r\n              }\r\n            }\r\n          }\r\n          not_first_call = <optimized out>\r\n          pagesize_m1 = <optimized out>\r\n          sp = <optimized out>\r\n          freesize = <optimized out>\r\n          __PRETTY_FUNCTION__ = \"start_thread\"\r\n  #22 0x00007ffff2831d0f in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:97\r\n  No locals.\r\n  ```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/76834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/76834/timeline", "performed_via_github_app": null, "state_reason": "completed"}