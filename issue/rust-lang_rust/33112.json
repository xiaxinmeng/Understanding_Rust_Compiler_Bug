{"url": "https://api.github.com/repos/rust-lang/rust/issues/33112", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/33112/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/33112/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/33112/events", "html_url": "https://github.com/rust-lang/rust/issues/33112", "id": 149837015, "node_id": "MDU6SXNzdWUxNDk4MzcwMTU=", "number": 33112, "title": "MSVC: Cleanups are run on all faults, like segfaults", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-04-20T17:39:43Z", "updated_at": "2016-05-10T04:32:07Z", "closed_at": "2016-05-10T04:32:07Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "For example:\n\n``` rust\nstruct Bomb;\n\nimpl Drop for Bomb {\n        fn drop(&mut self) {\n                println!(\"foo\");\n        }\n}\n\nfn main() {\n        let _a = Bomb;\n        foo();\n}\n\nfn foo() {\n        unsafe { *(0 as *mut i32) = 0; }\n}\n```\n\nOn Unix this doesn't print anything where as on Windows it will print `foo`. While initially intentional I'm thinking that this may seem like a bad idea now.\n\nThis is happening because in Windows faults like segfaults (or illegal instructions) all go through the same error handling mechanism that normal program exceptions go through. Our cleanups (aka drop code) are registered using [`cleanuppad` instructions](http://llvm.org/docs/LangRef.html#cleanuppad-instruction) with no extra arguments which essentially means \"run this cleanup for all exceptions\".\n\nThis... may or may not be memory safe. I'd personally find it surprising that we keep running code after a segfault or illegal instruction, I'd prefer Unix's semantics where no more Rust code is run at least.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/33112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/33112/timeline", "performed_via_github_app": null, "state_reason": "completed"}