{"url": "https://api.github.com/repos/rust-lang/rust/issues/90177", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90177/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90177/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90177/events", "html_url": "https://github.com/rust-lang/rust/issues/90177", "id": 1033888503, "node_id": "I_kwDOAAsO6M49n-L3", "number": 90177, "title": "ICE with trait objects and HRTBs", "user": {"login": "patrick-gu", "id": 55641350, "node_id": "MDQ6VXNlcjU1NjQxMzUw", "avatar_url": "https://avatars.githubusercontent.com/u/55641350?v=4", "gravatar_id": "", "url": "https://api.github.com/users/patrick-gu", "html_url": "https://github.com/patrick-gu", "followers_url": "https://api.github.com/users/patrick-gu/followers", "following_url": "https://api.github.com/users/patrick-gu/following{/other_user}", "gists_url": "https://api.github.com/users/patrick-gu/gists{/gist_id}", "starred_url": "https://api.github.com/users/patrick-gu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/patrick-gu/subscriptions", "organizations_url": "https://api.github.com/users/patrick-gu/orgs", "repos_url": "https://api.github.com/users/patrick-gu/repos", "events_url": "https://api.github.com/users/patrick-gu/events{/privacy}", "received_events_url": "https://api.github.com/users/patrick-gu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2021-10-22T19:31:21Z", "updated_at": "2021-11-05T00:46:25Z", "closed_at": "2021-11-05T00:39:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\n\r\n```Rust\r\ntrait Base<'f> {\r\n    type Assoc;\r\n\r\n    fn do_something(&self);\r\n}\r\n\r\ntrait ForAnyLifetime: for<'f> Base<'f> {}\r\n\r\nimpl<T> ForAnyLifetime for T where T: for<'f> Base<'f> {}\r\n\r\ntrait CanBeDynamic: ForAnyLifetime + for<'f> Base<'f, Assoc = ()> {}\r\n\r\nfn foo(a: &dyn CanBeDynamic) {\r\n    a.do_something();\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=faf907e6ab7e37b0df4fc838abf13b25))\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.56.0 (09c42c458 2021-10-18)\r\nbinary: rustc\r\ncommit-hash: 09c42c45858d5f3aedfa670698275303a3d19afa\r\ncommit-date: 2021-10-18\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.56.0\r\nLLVM version: 13.0.0\r\n```\r\n\r\nThis is also present in beta and nightly versions, but it is not present on 1.55.0 stable.\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: compiler\\rustc_trait_selection\\src\\traits\\mod.rs:755:9: Failed to find info for expected trait in vtable\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', compiler\\rustc_errors\\src\\lib.rs:1147:9\r\nstack backtrace:\r\n(see the backtrace section for the full backtrace)\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.0 (09c42c458 2021-10-18) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C linker=C:\\Program Files\\LLVM\\bin\\lld-link.exe -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [typeck] type-checking `foo`\r\n#1 [typeck_item_bodies] type-checking all item bodies\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `rust_ice`\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n   0:     0x7ffc97f07a9e - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h07cd892bde293768\r\n   1:     0x7ffc97f3268a - core::fmt::write::h29abf31093ab5935\r\n   2:     0x7ffc97efac88 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::h40386600605061bb\r\n   3:     0x7ffc97f0b586 - std::panicking::take_hook::he03d4c8985881b36\r\n   4:     0x7ffc97f0b074 - std::panicking::take_hook::he03d4c8985881b36\r\n   5:     0x7ffc8b17a525 - <tracing_subscriber::fmt::format::json::WriteAdaptor as std::io::Write>::flush::hde67080ba3658306\r\n   6:     0x7ffc97f0be99 - std::panicking::rust_panic_with_hook::h806e5bba08cf7c42\r\n   7:     0x7ffc8f7814c0 - <rustc_errors::styled_buffer::StyledChar as core::fmt::Debug>::fmt::h0f7f115d95d6e009\r\n   8:     0x7ffc8f781449 - <rustc_errors::styled_buffer::StyledChar as core::fmt::Debug>::fmt::h0f7f115d95d6e009\r\n   9:     0x7ffc8fa53bd1 - rustc_query_system::query::job::report_cycle::h9a6203922a678bda\r\n  10:     0x7ffc8f7af1b0 - <rustc_errors::json::Diagnostic::from_errors_diagnostic::BufWriter as std::io::Write>::flush::h4514f0044ddd3ee4\r\n  11:     0x7ffc8f7b7265 - rustc_errors::HandlerInner::emit_diagnostic::he222b80642dd446e\r\n  12:     0x7ffc8f7b4d12 - rustc_errors::Handler::bug::h2c8c5efa855ae4be\r\n  13:     0x7ffc8f49e3a7 - rustc_middle::ty::structural_impls::<impl core::fmt::Debug for rustc_middle::ty::closure::UpvarBorrow>::fmt::hd678a25acca54787\r\n  14:     0x7ffc8f49c660 - rustc_middle::ty::consts::valtree::ValTree::zst::h8aa8eda0b4c752ce\r\n  15:     0x7ffc8f49c603 - rustc_middle::ty::consts::valtree::ValTree::zst::h8aa8eda0b4c752ce\r\n  16:     0x7ffc8f49e2d9 - rustc_middle::ty::structural_impls::<impl core::fmt::Debug for rustc_middle::ty::closure::UpvarBorrow>::fmt::hd678a25acca54787\r\n  17:     0x7ffc8fa4a2c7 - rustc_middle::util::bug::bug_fmt::hdc415a5169316300\r\n  18:     0x7ffc8f2ebd5e - rustc_trait_selection::traits::impossible_predicates::h6168446ca8ba4d2c\r\n  19:     0x7ffc8f2face6 - <rustc_trait_selection::traits::select::TraitObligationStack as core::fmt::Debug>::fmt::h42371074e4d717d0\r\n  20:     0x7ffc8f3013aa - rustc_trait_selection::traits::select::SelectionContext::select::hca123c58bc622ce1 \r\n  21:     0x7ffc8f28d42e - <rustc_trait_selection::traits::fulfill::FulfillmentContext as rustc_infer::traits::engine::TraitEngine>::normalize_projection_type::h90c75a2320931b77\r\n  22:     0x7ffc8f28ba9e - rustc_trait_selection::traits::fulfill::FulfillProcessor::progress_changed_obligations::hc42fb10a0d8c0dcc\r\n  23:     0x7ffc8f2d5458 - <rustc_trait_selection::traits::specialize::OverlapError as core::fmt::Debug>::fmt::hab9f03740d18f5e8\r\n  24:     0x7ffc8f289ffc - rustc_trait_selection::traits::fulfill::FulfillmentContext::new_ignoring_regions::h39d25fbf849faa7e\r\n  25:     0x7ffc8f28a9e4 - <rustc_trait_selection::traits::fulfill::FulfillmentContext as rustc_infer::traits::engine::TraitEngine>::select_with_constness_where_possible::h14ff21ddcf1865f6\r\n  26:     0x7ffc8d842fcb - rustc_typeck::check::fn_ctxt::_impl::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::structurally_resolved_type::h713d93049989fe32\r\n  27:     0x7ffc8d84234a - rustc_typeck::check::fn_ctxt::_impl::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::structurally_resolved_type::h713d93049989fe32\r\n  28:     0x7ffc8d827516 - rustc_typeck::check::demand::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_for_cast::h4bd4dec8c57ead7f\r\n  29:     0x7ffc8d8863b6 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::he4c4873ab2d8c9f3\r\n  30:     0x7ffc8d847408 - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_stmt::h466a803b691a6b63\r\n  31:     0x7ffc8d847ea1 - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_block_no_value::he72514003acfb9d8\r\n  32:     0x7ffc8d8863b6 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::he4c4873ab2d8c9f3\r\n  33:     0x7ffc8d831357 - rustc_typeck::check::demand::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_for_cast::h4bd4dec8c57ead7f\r\n  34:     0x7ffc8da65f41 - rustc_typeck::check::check::check_wf_new::hdffafb8990846ac0\r\n  35:     0x7ffc8d9ae4cc - <<dyn rustc_typeck::astconv::AstConv>::create_substs_for_ast_path::SubstsForAstPathCtxt as rustc_typeck::astconv::CreateSubstsForGenericArgsCtxt>::inferred_kind::h930fec7b8dca6715\r\n  36:     0x7ffc8d8b1443 - rustc_typeck::check::provide::h6a0f4ba684d1e07c\r\n  37:     0x7ffc8e8fc306 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  38:     0x7ffc8e89e643 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  39:     0x7ffc8e9c6be9 - rustc_query_impl::on_disk_cache::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_query_impl::on_disk_cache::CacheDecoder>::error::hbd644ab6b1f9b216\r\n  40:     0x7ffc8e6a434a - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  41:     0x7ffc8e61110f - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  42:     0x7ffc8e9519e1 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h43f6f7a6dd139d2e\r\n  43:     0x7ffc8d9190db - <rustc_typeck::check::PlaceOp as core::fmt::Debug>::fmt::h2be515651766726e\r\n  44:     0x7ffc8d8b7873 - <rustc_typeck::check::CheckItemTypesVisitor as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_item::h7580caa56f13530b\r\n  45:     0x7ffc8e90261b - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  46:     0x7ffc8e8a9776 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  47:     0x7ffc8e9cf92b - rustc_query_impl::on_disk_cache::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_query_impl::on_disk_cache::CacheDecoder>::error::hbd644ab6b1f9b216\r\n  48:     0x7ffc8e6c2469 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  49:     0x7ffc8e57fc28 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  50:     0x7ffc8e95191f - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h43f6f7a6dd139d2e\r\n  51:     0x7ffc8d91bbd8 - <rustc_typeck::check::PlaceOp as core::fmt::Debug>::fmt::h2be515651766726e\r\n  52:     0x7ffc8d8eb212 - rustc_typeck::check_crate::h60ac79a04151c346\r\n  53:     0x7ffc8b2b8e42 - rustc_interface::passes::analysis::ha6bb758b7871ca78\r\n  54:     0x7ffc8e9004cb - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  55:     0x7ffc8e8b49ed - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::he71a7fa6f0493805\r\n  56:     0x7ffc8e9cf085 - rustc_query_impl::on_disk_cache::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_query_impl::on_disk_cache::CacheDecoder>::error::hbd644ab6b1f9b216\r\n  57:     0x7ffc8e6aca6b - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  58:     0x7ffc8e54803e - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::h6dcd24be3bf40fc6\r\n  59:     0x7ffc8e94d02c - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h43f6f7a6dd139d2e\r\n  60:     0x7ffc8b1d0a1b - <rustc_ast::ast::Item as rustc_ast::ast_like::AstLike>::attrs::h46107129069754a8   \r\n  61:     0x7ffc8b199215 - rustc_driver::pretty::print_after_hir_lowering::hf8699be6512bcdbc\r\n  62:     0x7ffc8b1d22b7 - <rustc_ast::ast::Item as rustc_ast::ast_like::AstLike>::attrs::h46107129069754a8   \r\n  63:     0x7ffc8b19dd90 - <tracing_subscriber::util::TryInitError as core::fmt::Display>::fmt::h9a86ae0cce8205b9\r\n  64:     0x7ffc8b19a018 - rustc_driver::pretty::print_after_hir_lowering::hf8699be6512bcdbc\r\n  65:     0x7ffc8b18e8fd - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h80a36c605c7f9e5b\r\n  66:     0x7ffc97f1a1cc - std::sys::windows::thread::Thread::new::h1fb620a4b45ff0e1\r\n  67:     0x7ffcfb057034 - BaseThreadInitThunk\r\n  68:     0x7ffcfb542651 - RtlUserThreadStart\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90177/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90177/timeline", "performed_via_github_app": null, "state_reason": "completed"}