{"url": "https://api.github.com/repos/rust-lang/rust/issues/42811", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42811/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42811/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42811/events", "html_url": "https://github.com/rust-lang/rust/issues/42811", "id": 237656099, "node_id": "MDU6SXNzdWUyMzc2NTYwOTk=", "number": 42811, "title": "error: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)", "user": {"login": "su8", "id": 29376083, "node_id": "MDQ6VXNlcjI5Mzc2MDgz", "avatar_url": "https://avatars.githubusercontent.com/u/29376083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/su8", "html_url": "https://github.com/su8", "followers_url": "https://api.github.com/users/su8/followers", "following_url": "https://api.github.com/users/su8/following{/other_user}", "gists_url": "https://api.github.com/users/su8/gists{/gist_id}", "starred_url": "https://api.github.com/users/su8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/su8/subscriptions", "organizations_url": "https://api.github.com/users/su8/orgs", "repos_url": "https://api.github.com/users/su8/repos", "events_url": "https://api.github.com/users/su8/events{/privacy}", "received_events_url": "https://api.github.com/users/su8/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-06-21T20:33:26Z", "updated_at": "2017-06-21T21:19:20Z", "closed_at": "2017-06-21T21:19:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "The Rust language is new to me, and I cannot find information how to solve the issue with libc's crate. Performed **cargo install libc** and in my $HOME dir there is a .cargo directory with the installed libc.\r\n\r\n```bash\r\nerror: main function not found\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n --> mylib2.rs:1:1\r\n  |\r\n1 | extern crate libc;\r\n  | ^^^^^^^^^^^^^^^^^^\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n --> mylib2.rs:3:12\r\n  |\r\n3 | use libc::{c_char, uint8_t};\r\n  |            ^^^^^^\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n --> mylib2.rs:3:20\r\n  |\r\n3 | use libc::{c_char, uint8_t};\r\n  |                    ^^^^^^^\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n --> mylib2.rs:7:43\r\n  |\r\n7 | pub extern fn theme_song_generate(length: uint8_t) -> *mut c_char {\r\n  |                                           ^^^^^^^\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n --> mylib2.rs:7:60\r\n  |\r\n7 | pub extern fn theme_song_generate(length: uint8_t) -> *mut c_char {\r\n  |                                                            ^^^^^^\r\n\r\nerror: use of unstable library feature 'libc': use `libc` from crates.io (see issue #27783)\r\n  --> mylib2.rs:15:39\r\n   |\r\n15 | pub extern fn theme_song_free(s: *mut c_char) {\r\n   |                                       ^^^^^^\r\n\r\nerror: aborting due to 7 previous errors\r\n```\r\n\r\n**mylib2.rs**\r\n\r\n```rust\r\nextern crate libc;\r\n\r\nuse libc::{c_char, uint8_t};\r\nuse std::ffi::CString;\r\n\r\n#[no_mangle]\r\npub extern fn theme_song_generate(length: uint8_t) -> *mut c_char {\r\n    let mut song = String::from(\"Hello World\");\r\n\r\n    let c_str_song = CString::new(song).unwrap();\r\n    c_str_song.into_raw()\r\n}\r\n\r\n#[no_mangle]\r\npub extern fn theme_song_free(s: *mut c_char) {\r\n    unsafe {\r\n        if s.is_null() { return }\r\n        CString::from_raw(s)\r\n    };\r\n}\r\n```\r\n\r\nC code **test.c**\r\n\r\n```c\r\n#include <stdio.h>\r\n#include <stdint.h>\r\n\r\nextern char *\r\ntheme_song_generate(uint8_t length);\r\n\r\nextern void\r\ntheme_song_free(char *);\r\n\r\nint main(void) {\r\n  char *song = theme_song_generate(5);\r\n  printf(\"%s\\n\", song);\r\n  theme_song_free(song);\r\n}\r\n```\r\n\r\nCommand to create object file `rustc --emit=obj mylib2.rs`", "closed_by": {"login": "su8", "id": 29376083, "node_id": "MDQ6VXNlcjI5Mzc2MDgz", "avatar_url": "https://avatars.githubusercontent.com/u/29376083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/su8", "html_url": "https://github.com/su8", "followers_url": "https://api.github.com/users/su8/followers", "following_url": "https://api.github.com/users/su8/following{/other_user}", "gists_url": "https://api.github.com/users/su8/gists{/gist_id}", "starred_url": "https://api.github.com/users/su8/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/su8/subscriptions", "organizations_url": "https://api.github.com/users/su8/orgs", "repos_url": "https://api.github.com/users/su8/repos", "events_url": "https://api.github.com/users/su8/events{/privacy}", "received_events_url": "https://api.github.com/users/su8/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42811/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42811/timeline", "performed_via_github_app": null, "state_reason": "completed"}