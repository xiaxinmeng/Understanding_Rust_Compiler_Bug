{"url": "https://api.github.com/repos/rust-lang/rust/issues/26009", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26009/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26009/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26009/events", "html_url": "https://github.com/rust-lang/rust/issues/26009", "id": 85091969, "node_id": "MDU6SXNzdWU4NTA5MTk2OQ==", "number": 26009, "title": "New error metadata system required.", "user": {"login": "michaelsproul", "id": 4452260, "node_id": "MDQ6VXNlcjQ0NTIyNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelsproul", "html_url": "https://github.com/michaelsproul", "followers_url": "https://api.github.com/users/michaelsproul/followers", "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}", "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions", "organizations_url": "https://api.github.com/users/michaelsproul/orgs", "repos_url": "https://api.github.com/users/michaelsproul/repos", "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelsproul/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-06-04T13:06:54Z", "updated_at": "2015-06-20T19:29:40Z", "closed_at": "2015-06-20T19:29:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It'd be nice to hang on to the [error index](http://doc.rust-lang.org/error-index.html) in the Rust 1.2 release... currently it's disabled due to the flakiness of the metadata collation system (see #25706).\n\nAmongst the issues with the previous implementation:\n- Unsynchronised concurrent access of files, leading to the use of malformed JSON data.\n- No way to determine the freshness of metadata files.\n- Failure to write files (not thoroughly investigated). Probably related to stale files hanging around.\n\nBefore I go ahead and implement a crazy new system, I just want to check the sanity of my design:\n- Alter the `__build_diagnostic_array!` invocations so that the identifier used for diagnostics arrays is something unlikely to be used elsewhere. This step isn't strictly necessary, as the current name `DIAGNOSTICS` is already quite unique.\n- Register an internal lint (i.e. one that only runs against the compiler's source) that extracts error metadata from every item with the unique name used by `__build_diagnostic_array!`. Here we run into the same potential concurrency problem as before, because crates can be compiled in parallel. As long as the lint doesn't attempt to check uniqueness by reading files for _other_ crates, the parallel writes to separate per-crate files should be ok. E.g. when running the lint against `librustc_typeck`, dump metadata to `tmp/extended-errors/librustc_typeck.json`. What worries me about this step is that it is essentially the same as dumping metadata from the `__build_diagnostic_array!` without uniqueness-checks, which we tried **unsuccessfully** (that's the unknown error).\n- In the error-index-generator - which runs once all crates have been compiled - we can check uniqueness.\n\nI still feel like this is very similar to the previous, failing system, and would like to alter it more drastically if anyone has any ideas...\n\ncc @pnkfelix @alexcrichton @Manishearth \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26009/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26009/timeline", "performed_via_github_app": null, "state_reason": "completed"}