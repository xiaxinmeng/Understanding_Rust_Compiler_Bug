{"url": "https://api.github.com/repos/rust-lang/rust/issues/34131", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34131/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34131/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34131/events", "html_url": "https://github.com/rust-lang/rust/issues/34131", "id": 158809868, "node_id": "MDU6SXNzdWUxNTg4MDk4Njg=", "number": 34131, "title": "Make `--export-dynamic` the default option when linking executables.", "user": {"login": "Parakleta", "id": 11205202, "node_id": "MDQ6VXNlcjExMjA1MjAy", "avatar_url": "https://avatars.githubusercontent.com/u/11205202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Parakleta", "html_url": "https://github.com/Parakleta", "followers_url": "https://api.github.com/users/Parakleta/followers", "following_url": "https://api.github.com/users/Parakleta/following{/other_user}", "gists_url": "https://api.github.com/users/Parakleta/gists{/gist_id}", "starred_url": "https://api.github.com/users/Parakleta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Parakleta/subscriptions", "organizations_url": "https://api.github.com/users/Parakleta/orgs", "repos_url": "https://api.github.com/users/Parakleta/repos", "events_url": "https://api.github.com/users/Parakleta/events{/privacy}", "received_events_url": "https://api.github.com/users/Parakleta/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-06-07T01:21:21Z", "updated_at": "2022-05-15T14:48:56Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "With `#[no_mangle] pub fn` Rust exports a dynamic symbol for the defined function in an executable, but this behaviour is somewhat magical and not transitive.\n\nIf `--export-dynamic` is made the default then all symbols that are marked as visible in any dependency of the executable will also be exported as a dynamic symbol.  This is important for libraries that support plugins where the plugin needs to be able to call back into a function defined in the library.  The case I am dealing with is Lua plugins which must have access to the Lua runtime functions when loaded, but presumably the same issues exist for other pluggable libraries (for example SQLite loadable extensions).\n\nSo long as Rust correctly manage its symbol visibility, and authors of static libraries correctly manage the symbol visibility of the C functions in their libraries, this change should have no down-sides.\n\nI believe currently Rust does not quite manage symbol visibility correctly because it leaves every local absolute symbol visible.  I'm not sure if there is a reason for this or it is just an oversight, but this would probably need to be resolved.\n\nOn the issue of the `#[no_mangle] pub fn` I'm not sure why this behaviour is not transitive, but I believe this issue should also be fixed.  I may not be using it correctly, but I cannot seem to make a `#[no_mangle] pub fn` from a dependency appear in the symbol table of an executable.\n\nI believe this is related to issue #27541.\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34131/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34131/timeline", "performed_via_github_app": null, "state_reason": null}