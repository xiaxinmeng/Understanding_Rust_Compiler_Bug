{"url": "https://api.github.com/repos/rust-lang/rust/issues/38730", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38730/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38730/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38730/events", "html_url": "https://github.com/rust-lang/rust/issues/38730", "id": 198215176, "node_id": "MDU6SXNzdWUxOTgyMTUxNzY=", "number": 38730, "title": "Rustc crashed, nightly and phf", "user": {"login": "Dentosal", "id": 2204863, "node_id": "MDQ6VXNlcjIyMDQ4NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/2204863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dentosal", "html_url": "https://github.com/Dentosal", "followers_url": "https://api.github.com/users/Dentosal/followers", "following_url": "https://api.github.com/users/Dentosal/following{/other_user}", "gists_url": "https://api.github.com/users/Dentosal/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dentosal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dentosal/subscriptions", "organizations_url": "https://api.github.com/users/Dentosal/orgs", "repos_url": "https://api.github.com/users/Dentosal/repos", "events_url": "https://api.github.com/users/Dentosal/events{/privacy}", "received_events_url": "https://api.github.com/users/Dentosal/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-12-31T03:19:24Z", "updated_at": "2016-12-31T15:26:13Z", "closed_at": "2016-12-31T05:36:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Rustc crashed. I don't know if the bug is in rustc or in phf crate, but I'm submitting a bug report here since rustc shouldn't crash anyways, right?\r\n\r\nsrc/main.rs\r\n\r\n```rust\r\n#![feature(plugin)]\r\n#![plugin(phf_macros)]\r\n\r\nextern crate phf;\r\n\r\npub static TEST: phf::Map<&'static str, ()> = phf_map! {\r\n    Signature:: => ()\r\n};\r\n\r\nfn main() {}\r\n```\r\n\r\nCargo.toml\r\n\r\n```toml\r\n[package]\r\nname = \"reproducing_bug\"\r\nversion = \"0.1.0\"\r\nauthors = [\"Hannes Karppila <hannes.karppila@gmail.com>\"]\r\n\r\n[dependencies]\r\nphf = \"0.7.*\"\r\nphf_macros = \"0.7.*\"\r\n```\r\n\r\nI expected to see this happen: No crash, but a syntax error\r\n\r\nInstead, this happened: Rustc crashed\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.16.0-nightly (4ecc85beb 2016-12-28)\r\nbinary: rustc\r\ncommit-hash: 4ecc85beb339aa8089d936e450b0d800bdf580ae\r\ncommit-date: 2016-12-28\r\nhost: x86_64-apple-darwin\r\nrelease: 1.16.0-nightly\r\nLLVM version: 3.9\r\n```\r\n\r\nBacktrace: (`$ RUST_BACKTRACE=1 cargo run --verbose`)\r\n\r\n```\r\n       Fresh phf_shared v0.7.20\r\n       Fresh libc v0.2.18\r\n       Fresh phf v0.7.20\r\n       Fresh rand v0.3.15\r\n       Fresh phf_generator v0.7.20\r\n       Fresh phf_macros v0.7.20\r\n   Compiling reproducing_bug v0.1.0 (file:///Users/Hannes/codes/rust/2/minimal_reproduce)\r\n     Running `rustc --crate-name reproducing_bug src/main.rs --crate-type bin -g -C metadata=876b28311dab6b77 -C extra-filename=-876b28311dab6b77 --out-dir /Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps --emit=dep-info,link -L dependency=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps --extern phf_macros=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps/libphf_macros-af33d2f4f2cea9b3.dylib --extern phf=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps/libphf-b7085cc37d7a6d9f.rlib`\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: Diagnostic { level: Fatal, message: \"expected identifier, found `=>`\", code: None, span: MultiSpan { primary_spans: [Span { lo: BytePos(136), hi: BytePos(138), expn_id: ExpnId(4294967295) }], span_labels: [] }, children: [] }', /Users/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-mac/build/src/libcore/result.rs:845\r\nstack backtrace:\r\n   1:        0x1075de57c - std::sys::imp::backtrace::tracing::imp::write::h36c82bddc32ee014\r\n   2:        0x1075eabee - std::panicking::default_hook::{{closure}}::h5befc2c9c6395cdf\r\n   3:        0x1075ea793 - std::panicking::default_hook::hc066c0e0f8dcf194\r\n   4:        0x1075eb0b6 - std::panicking::rust_panic_with_hook::hb2f44ed7df6389fd\r\n   5:        0x1075eaf54 - std::panicking::begin_panic::h98e44359ade7bd0a\r\n   6:        0x1075eae72 - std::panicking::begin_panic_fmt::hb5af1180f1c36e1d\r\n   7:        0x1075eadd7 - rust_begin_unwind\r\n   8:        0x1076272b0 - core::panicking::panic_fmt::h37d320d6d0d8b0d4\r\n   9:        0x10823d3c8 - core::result::unwrap_failed::h876af85011fc2863\r\n  10:        0x10822d8f7 - <core::result::Result<T, E>>::unwrap::hedb659003fcc10ed\r\n  11:        0x1082a2a66 - phf_macros::parse_map::hb30158bf62d13777\r\n  12:        0x1082a15fc - phf_macros::expand_phf_map::he99af7a44deaaf58\r\n  13:        0x103940b35 - <F as syntax::ext::base::TTMacroExpander>::expand::h506e0c549ee35b59\r\n  14:        0x106fdbf0c - syntax::ext::expand::MacroExpander::expand_invoc::h73bee7937f28f5a7\r\n  15:        0x106fd8bb0 - syntax::ext::expand::MacroExpander::expand::h688156ccf1139ecc\r\n  16:        0x106fd8149 - syntax::ext::expand::MacroExpander::expand_crate::h0fd8b508eb533b15\r\n  17:        0x102c5586b - rustc_driver::driver::phase_2_configure_and_expand::{{closure}}::h50ad681d9c143607\r\n  18:        0x102c4dc43 - rustc_driver::driver::phase_2_configure_and_expand::h7572e3a30b4fb045\r\n  19:        0x102c4795b - rustc_driver::driver::compile_input::h288ea94170be9057\r\n  20:        0x102c907eb - rustc_driver::run_compiler::ha8e57199bffb1089\r\n  21:        0x102ba0158 - std::panicking::try::do_call::h4527918aedb10721\r\n  22:        0x1075edcaa - __rust_maybe_catch_panic\r\n  23:        0x102bca7e3 - <F as alloc::boxed::FnBox<A>>::call_box::hf4f3e505436bf553\r\n  24:        0x1075e9d24 - std::sys::imp::thread::Thread::new::thread_start::h0986e95fd3be13c5\r\n  25:     0x7fff91e7a99c - _pthread_body\r\n  26:     0x7fff91e7a919 - _pthread_start\r\n\r\nerror: Could not compile `reproducing_bug`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name reproducing_bug src/main.rs --crate-type bin -g -C metadata=876b28311dab6b77 -C extra-filename=-876b28311dab6b77 --out-dir /Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps --emit=dep-info,link -L dependency=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps --extern phf_macros=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps/libphf_macros-af33d2f4f2cea9b3.dylib --extern phf=/Users/Hannes/codes/rust/2/minimal_reproduce/target/debug/deps/libphf-b7085cc37d7a6d9f.rlib` (exit code: 101)\r\n```", "closed_by": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38730/timeline", "performed_via_github_app": null, "state_reason": "completed"}