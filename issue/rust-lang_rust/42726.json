{"url": "https://api.github.com/repos/rust-lang/rust/issues/42726", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42726/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42726/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42726/events", "html_url": "https://github.com/rust-lang/rust/issues/42726", "id": 236690837, "node_id": "MDU6SXNzdWUyMzY2OTA4Mzc=", "number": 42726, "title": "rustdoc runs some markdown tests twice", "user": {"login": "ollie27", "id": 7189418, "node_id": "MDQ6VXNlcjcxODk0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7189418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ollie27", "html_url": "https://github.com/ollie27", "followers_url": "https://api.github.com/users/ollie27/followers", "following_url": "https://api.github.com/users/ollie27/following{/other_user}", "gists_url": "https://api.github.com/users/ollie27/gists{/gist_id}", "starred_url": "https://api.github.com/users/ollie27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ollie27/subscriptions", "organizations_url": "https://api.github.com/users/ollie27/orgs", "repos_url": "https://api.github.com/users/ollie27/repos", "events_url": "https://api.github.com/users/ollie27/events{/privacy}", "received_events_url": "https://api.github.com/users/ollie27/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 602425123, "node_id": "MDU6TGFiZWw2MDI0MjUxMjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-dev-tools", "name": "T-dev-tools", "color": "bfd4f2", "default": false, "description": "Relevant to the dev-tools subteam, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-17T23:52:45Z", "updated_at": "2017-07-07T08:13:31Z", "closed_at": "2017-07-07T08:13:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Running `rustdoc --test` with 1.18.0 and nightly on the following markdown file:\r\n\r\n````markdown\r\n# Foo\r\n\r\n```\r\nfail1\r\n```\r\n\r\n```\r\nfail2\r\n```\r\n\r\nbar\r\n```\r\nfail3\r\n```\r\n````\r\n\r\nProduces the following:\r\n\r\n<details>\r\n\r\n<summary>output</summary>\r\n\r\n```\r\nrunning 5 tests\r\ntest foo.md - Foo (line 3) ... FAILED\r\ntest foo.md - Foo (line 7) ... FAILED\r\ntest foo.md - Foo (line 12) ... FAILED\r\ntest foo.md - Foo (line 8) ... FAILED\r\ntest foo.md - Foo (line 3) ... FAILED\r\n\r\nfailures:\r\n\r\n---- foo.md - Foo (line 3) stdout ----\r\n        error[E0425]: cannot find value `fail1` in this scope\r\n --> <anon>:2:1\r\n  |\r\n2 | fail1\r\n  | ^^^^^ not found in this scope\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src\\librustc\\session\\mod.rs:218\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\n---- foo.md - Foo (line 7) stdout ----\r\n        error[E0425]: cannot find value `fail2` in this scope\r\n --> <anon>:2:1\r\n  |\r\n2 | fail2\r\n  | ^^^^^ not found in this scope\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src\\librustc\\session\\mod.rs:218\r\n\r\n---- foo.md - Foo (line 12) stdout ----\r\n        error[E0425]: cannot find value `fail3` in this scope\r\n --> <anon>:2:1\r\n  |\r\n2 | fail3\r\n  | ^^^^^ not found in this scope\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src\\librustc\\session\\mod.rs:218\r\n\r\n---- foo.md - Foo (line 8) stdout ----\r\n        error[E0425]: cannot find value `fail2` in this scope\r\n --> <anon>:2:1\r\n  |\r\n2 | fail2\r\n  | ^^^^^ not found in this scope\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src\\librustc\\session\\mod.rs:218\r\n\r\n---- foo.md - Foo (line 3) stdout ----\r\n        error[E0425]: cannot find value `fail1` in this scope\r\n --> <anon>:2:1\r\n  |\r\n2 | fail1\r\n  | ^^^^^ not found in this scope\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src\\librustc\\session\\mod.rs:218\r\n\r\n\r\nfailures:\r\n    foo.md - Foo (line 12)\r\n    foo.md - Foo (line 3)\r\n    foo.md - Foo (line 3)\r\n    foo.md - Foo (line 7)\r\n    foo.md - Foo (line 8)\r\n\r\ntest result: FAILED. 0 passed; 5 failed; 0 ignored; 0 measured; 0 filtered out\r\n```\r\n\r\n</details>\r\n\r\nThe first 2 tests are run twice (one with the wrong line number though). The last test is only run once. It looks as though it's running all the tests found by hoedown and all the tests run by pulldown-cmark. I'm pretty sure this wasn't the intention of #41290 and #41431 cc. @GuillaumeGomez. Note that this doesn't happen for tests in rust files.\r\n\r\nThis is also technically a stable to stable regression because the following file passes `rustdoc --test` on 1.17.0 but not on 1.18.0 or later:\r\n\r\n````markdown\r\n# Foo\r\n\r\nbar\r\n```\r\nfail3\r\n```\r\n````", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42726/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42726/timeline", "performed_via_github_app": null, "state_reason": "completed"}