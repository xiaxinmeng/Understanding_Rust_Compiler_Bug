{"url": "https://api.github.com/repos/rust-lang/rust/issues/38868", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38868/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38868/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38868/events", "html_url": "https://github.com/rust-lang/rust/issues/38868", "id": 199137221, "node_id": "MDU6SXNzdWUxOTkxMzcyMjE=", "number": 38868, "title": "error: internal compiler error: ../src/librustc_typeck/check/dropck.rs:644", "user": {"login": "wyklq", "id": 5118557, "node_id": "MDQ6VXNlcjUxMTg1NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5118557?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wyklq", "html_url": "https://github.com/wyklq", "followers_url": "https://api.github.com/users/wyklq/followers", "following_url": "https://api.github.com/users/wyklq/following{/other_user}", "gists_url": "https://api.github.com/users/wyklq/gists{/gist_id}", "starred_url": "https://api.github.com/users/wyklq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wyklq/subscriptions", "organizations_url": "https://api.github.com/users/wyklq/orgs", "repos_url": "https://api.github.com/users/wyklq/repos", "events_url": "https://api.github.com/users/wyklq/events{/privacy}", "received_events_url": "https://api.github.com/users/wyklq/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-01-06T07:02:14Z", "updated_at": "2017-03-03T07:11:06Z", "closed_at": "2017-03-03T07:11:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\npub struct List<T> {\r\n    head: Link<T>,\r\n}\r\n\r\ntype Link<T> = Option<Box<Node<T>>>;\r\n\r\nstruct Node<T> {\r\n    elem: T,\r\n    next: Link<T>,\r\n}\r\n\r\nimpl<i32> List<i32> {\r\n    pub fn new() -> Self {\r\n        List { head: None }\r\n    }\r\n\r\n    pub fn push(&mut self, elem: i32) {\r\n        let new_node = Box::new(Node {\r\n            elem: elem,\r\n            next: self.head.take(),\r\n        });\r\n\r\n        self.head = Some(new_node);\r\n    }\r\n    pub fn pop(&mut self) -> Option<i32> {\r\n        self.head.take().map(|node| {\r\n            let node = *node;\r\n            self.head = node.next;\r\n            node.elem\r\n        })\r\n    }\r\n}\r\n\r\nimpl Drop for List<i32> {\r\n    fn drop(&mut self) {\r\n        let mut cur_link = self.head.take();\r\n        while let Some(mut boxed_node) = cur_link {\r\n            cur_link = boxed_node.next.take();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n#[cfg(test)]\r\nmod test {\r\n    use super::List;\r\n\r\n    #[test]\r\n    fn basics() {\r\n        let mut list = List::new();\r\n\r\n        // Check empty list behaves right\r\n        assert_eq!(list.pop(), None);\r\n\r\n        // Populate list\r\n        list.push(1);\r\n        list.push(2);\r\n        list.push(3);\r\n\r\n        // Check normal removal\r\n        assert_eq!(list.pop(), Some(3));\r\n        assert_eq!(list.pop(), Some(2));\r\n\r\n        // Push some more just to make sure nothing's corrupted\r\n        list.push(4);\r\n        list.push(5);\r\n\r\n        // Check normal removal\r\n        assert_eq!(list.pop(), Some(5));\r\n        assert_eq!(list.pop(), Some(4));\r\n\r\n        // Check exhaustion\r\n        assert_eq!(list.pop(), Some(1));\r\n        assert_eq!(list.pop(), None);\r\n    }\r\n}\r\n```\r\nI'd like to see if this works or not - just implement a specific type of a generic. \r\nHowever, the following compilation error happened, which brings me here:\r\n\r\n> error: internal compiler error: ../src/librustc_typeck/check/dropck.rs:644: substs for an impl must map types to TyParam\r\n> note: the compiler unexpectedly panicked. this is a bug.\r\n> note: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n> note: run with `RUST_BACKTRACE=1` for a backtrace\r\n> \r\n> thread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:424\r\n> stack backtrace:\r\n>    1:     0x7fb5b6e327aa - std::sys::imp::backtrace::tracing::imp::write::h917062bce4ff48c3\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:42\r\n>    2:     0x7fb5b6e4494f - std::panicking::default_hook::{{closure}}::h0bacac31b5ed1870\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:247\r\n>    3:     0x7fb5b6e411a5 - std::panicking::default_hook::h5897799da33ece67\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:257\r\n>    4:     0x7fb5b6e418b7 - std::panicking::rust_panic_with_hook::h109e116a3a861224\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:451\r\n>    5:     0x7fb5b327b3ba - std::panicking::begin_panic::h7ee1a5d23402297a\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:413\r\n>    6:     0x7fb5b328c64d - rustc_errors::Handler::bug::hcb152875f06770ca\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_errors/lib.rs:424\r\n>    7:     0x7fb5b42ceec1 - rustc::session::opt_span_bug_fmt::{{closure}}::hac6e8f2df662620f\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:770\r\n>    8:     0x7fb5b420762e - rustc::session::opt_span_bug_fmt::he7e61f6adc55e29d\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1057\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:766\r\n>    9:     0x7fb5b4207292 - rustc::session::bug_fmt::h995c6792d8929834\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:750\r\n>   10:     0x7fb5b67b23c7 - rustc_typeck::check::dropck::revise_self_ty::{{closure}}::h6e990da16bfc798b\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/dropck.rs:644\r\n>   11:     0x7fb5b66c483a - rustc::ty::subst::<impl rustc::ty::Slice<rustc::ty::subst::Kind<'tcx>>>::fill_item::h8c0c6b3650a643fa\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/subst.rs:215\r\n>   12:     0x7fb5b66f98df - rustc_typeck::check::dropck::iterate_over_potentially_unsafe_regions_in_type::hf27b94c5cbeb9fef\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/subst.rs:182\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/dropck.rs:615\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/dropck.rs:558\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/dropck.rs:415\r\n>   13:     0x7fb5b66f8e33 - rustc_typeck::check::dropck::check_safety_of_destructor_if_necessary::h16dcd6dd761b7c2c\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/dropck.rs:287\r\n>   14:     0x7fb5b670c00c - rustc_typeck::check::regionck::RegionCtxt::check_safety_of_rvalue_destructor_if_necessary::hf4c077992bb4034d\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/regionck.rs:1002\r\n>   15:     0x7fb5b670aaff - <rustc_typeck::check::regionck::RegionCtxt<'a, 'gcx, 'tcx> as rustc::hir::intravisit::Visitor<'v>>::visit_expr::hbc45bb71eeb408fd\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/regionck.rs:596\r\n>   16:     0x7fb5b67093df - rustc_typeck::check::regionck::RegionCtxt::visit_fn_body::h694b854703d3b296\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/<syntax macros>:2\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/hir/intravisit.rs:113\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/regionck.rs:308\r\n>   17:     0x7fb5b6708a72 - rustc_typeck::check::regionck::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::regionck_fn::h4c3bf45fc5b0b67f\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/regionck.rs:151\r\n>   18:     0x7fb5b674be2e - rustc_typeck::check::check_bare_fn::hcf6cfb2ab5a6420e\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:566\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:410\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/infer/mod.rs:523\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1028\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/thread/local.rs:245\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1025\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:862\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/infer/mod.rs:523\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:410\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:548\r\n>   19:     0x7fb5b674ec57 - rustc_typeck::check::check_item_body::he3880201f44aba3c\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:834\r\n>   20:     0x7fb5b6749c15 - rustc_typeck::check::check_item_bodies::h60f6e46e6083a923\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:469\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/dep_graph/visit.rs:46\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/hir/mod.rs:445\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/dep_graph/visit.rs:57\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/mod.rs:2844\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:490\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/session/mod.rs:222\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/check/mod.rs:488\r\n>   21:     0x7fb5b67aef5f - rustc_typeck::check_crate::h49660caa41b9699c\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/lib.rs:366\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/util/common.rs:38\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_typeck/lib.rs:366\r\n>   22:     0x7fb5b71f7d9e - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h5a9a7c8e1b6dbe3a\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:891\r\n>   23:     0x7fb5b71d5d10 - rustc_driver::driver::phase_3_run_analysis_passes::h823704ee01fd0a1e\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1028\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/thread/local.rs:245\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1025\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1012\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/thread/local.rs:245\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:1009\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc/ty/context.rs:797\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:869\r\n>   24:     0x7fb5b71be974 - rustc_driver::driver::compile_input::h66a0adaf05fab85d\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/driver.rs:173\r\n>   25:     0x7fb5b71e8d30 - rustc_driver::run_compiler::hafe7bbfedf95a825\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:222\r\n>   26:     0x7fb5b711db48 - std::panicking::try::do_call::h5ff5e568cb9cce51\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:1138\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:138\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/librustc_driver/lib.rs:1072\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panic.rs:295\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:356\r\n>   27:     0x7fb5b6e4c85a - __rust_maybe_catch_panic\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libpanic_unwind/lib.rs:97\r\n>   28:     0x7fb5b713d7a8 - <F as alloc::boxed::FnBox<A>>::call_box::h92e2f4ed0df1d5b6\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panicking.rs:332\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/panic.rs:351\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/thread/mod.rs:287\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:595\r\n>   29:     0x7fb5b6e40474 - std::sys::imp::thread::Thread::new::thread_start::ha102a6120fc52763\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/liballoc/boxed.rs:605\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys_common/thread.rs:21\r\n>                         at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libstd/sys/unix/thread.rs:84\r\n>   30:     0x7fb5afda9183 - start_thread\r\n>   31:     0x7fb5b6af337c - clone\r\n>   32:                0x0 - <unknown>", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38868/timeline", "performed_via_github_app": null, "state_reason": "completed"}