{"url": "https://api.github.com/repos/rust-lang/rust/issues/12827", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12827/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12827/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12827/events", "html_url": "https://github.com/rust-lang/rust/issues/12827", "id": 29194118, "node_id": "MDU6SXNzdWUyOTE5NDExOA==", "number": 12827, "title": "Flaky stderr of child processes with libgreen", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-03-11T16:32:08Z", "updated_at": "2014-04-24T18:26:27Z", "closed_at": "2014-04-24T18:26:27Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "These two programs replicate the flakiness which I've seen on bors for the past few months. This flakiness can also be seen on travis.\n\nThis test only fails on linux, not on OSX. It also only fails once every 2000 child processes or so.\n\n``` rust\n// foo.rs\nuse std::io::Process;\nuse std::str;\n\nfn main() {\n    static N: int = 10;\n    let (tx, rx) = channel();\n    for _ in range(0, N) {\n        let tx = tx.clone();\n        spawn(proc() {\n            let p = Process::output(\"./bar\", []).unwrap();\n            assert!(p.status.matches_exit_status(101), \"{}\", p.status);\n            let out = str::from_utf8(p.output).unwrap();\n            if out != \"\" {\n                println!(\"{}\", out);\n            }\n            assert_eq!(str::from_utf8(p.error).unwrap(),\n                       \"task '<main>' failed at 'test', bar.rs:2\\n\");\n            tx.send(());\n        });\n    }\n    drop(tx);\n    for _ in range(0, N) { rx.recv() }\n}\n\n\n// bar.rs\nfn main() {\n    fail!(\"test\");\n}\n```\n\nIt's key that within one instance of `foo` many instances of `bar` are run in parallel. I'm not quite sure why just yet.\n\n```\n$ for i in {0..1000}; do echo $i; ./foo || break; done\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\ntask '<unnamed>' failed at 'assertion failed: `(left == right) && (right == left)` (left: `task '<main>' failed at '\ntest', `, right: `task '<main>' failed at 'test', bar.rs:2\n`)', foo.rs:12\ntask '<main>' failed at 'receiving on a closed channel', /home/alex/rust/src/libstd/comm/mod.rs:507\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12827/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12827/timeline", "performed_via_github_app": null, "state_reason": "completed"}