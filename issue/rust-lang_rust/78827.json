{"url": "https://api.github.com/repos/rust-lang/rust/issues/78827", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78827/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78827/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78827/events", "html_url": "https://github.com/rust-lang/rust/issues/78827", "id": 738153446, "node_id": "MDU6SXNzdWU3MzgxNTM0NDY=", "number": 78827, "title": "Linking a static C library does not include all symbols", "user": {"login": "Firstyear", "id": 271005, "node_id": "MDQ6VXNlcjI3MTAwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/271005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Firstyear", "html_url": "https://github.com/Firstyear", "followers_url": "https://api.github.com/users/Firstyear/followers", "following_url": "https://api.github.com/users/Firstyear/following{/other_user}", "gists_url": "https://api.github.com/users/Firstyear/gists{/gist_id}", "starred_url": "https://api.github.com/users/Firstyear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Firstyear/subscriptions", "organizations_url": "https://api.github.com/users/Firstyear/orgs", "repos_url": "https://api.github.com/users/Firstyear/repos", "events_url": "https://api.github.com/users/Firstyear/events{/privacy}", "received_events_url": "https://api.github.com/users/Firstyear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2020-11-07T03:35:33Z", "updated_at": "2020-11-19T22:32:05Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This relates to #15460. On 1.47 stable and 1.48 nightly, when using cc/cbindgen, if a symbol in the C file is not used by the .rs file, then it is not in the resulting cdylib. It is possible to force the symbol to be included by \"calling\" it as show in https://github.com/rust-lang/rust/issues/19321 .\r\n\r\nThe linked repository is able to reproduce this. Testing on OpenSUSE tumbleweed (fully patched with gcc10). After `cargo build` then the resulting libdemo.so does not contain the symbol `wrapper_add`. \r\n\r\nThis appears to be a regression since #15460 which was intended to resolve this behaviour. I appreciate your advice on this, thanks,\r\n\r\nhttps://github.com/Firstyear/demo_r_link\r\n\r\nEDIT: Worth noting in wrapper.c that it does not need to link to any R libs, and that SEXP is a typdef to `typedef struct SEXPREC *SEXP;`", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78827/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78827/timeline", "performed_via_github_app": null, "state_reason": null}