{"url": "https://api.github.com/repos/rust-lang/rust/issues/84284", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84284/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84284/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84284/events", "html_url": "https://github.com/rust-lang/rust/issues/84284", "id": 860550235, "node_id": "MDU6SXNzdWU4NjA1NTAyMzU=", "number": 84284, "title": "`stdin().read(&mut [u8])` reads insufficient data", "user": {"login": "bczhc", "id": 49330580, "node_id": "MDQ6VXNlcjQ5MzMwNTgw", "avatar_url": "https://avatars.githubusercontent.com/u/49330580?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bczhc", "html_url": "https://github.com/bczhc", "followers_url": "https://api.github.com/users/bczhc/followers", "following_url": "https://api.github.com/users/bczhc/following{/other_user}", "gists_url": "https://api.github.com/users/bczhc/gists{/gist_id}", "starred_url": "https://api.github.com/users/bczhc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bczhc/subscriptions", "organizations_url": "https://api.github.com/users/bczhc/orgs", "repos_url": "https://api.github.com/users/bczhc/repos", "events_url": "https://api.github.com/users/bczhc/events{/privacy}", "received_events_url": "https://api.github.com/users/bczhc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-04-18T01:29:45Z", "updated_at": "2021-04-19T13:37:16Z", "closed_at": "2021-04-18T01:38:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a file with enough size to read, but when I use `stdin().read(...)`, I found the read size it returned has wrong result. \r\n\r\nCode:\r\n```rust\r\nfn main() {\r\n    let mut f = stdin();\r\n    let mut buf: [u8; 3] = [0, 0, 0];\r\n    let mut c = 0;\r\n    loop {\r\n        let i = f.read(&mut buf).unwrap();\r\n        if i == 0 { break; }\r\n        println!(\"{} {}\", i, c);\r\n        c += 1;\r\n    }   \r\n}\r\n```\r\nCommand: `cat some-file | ./main`\r\n\r\nThe output will look like this:\r\n>3 1\r\n>\r\n>3 2\r\n>\r\n>3 3\r\n>\r\n>... Omit a lot of 3s\r\n>\r\n>3 2729\r\n>\r\n>2 2730 // here: it reads only two bytes but not the expected 3\r\n>\r\n>3 2731\r\n>\r\n>3 2731\r\n>\r\n> ...\r\n>\r\n>2 5461 // same here\r\n>\r\n>3\r\n>\r\n>3\r\n>\r\n>...\r\n\r\nCommand: `cat some-file | ./main | grep \"2 \"`\r\nOutput:\r\n>2 2730\r\n>\r\n>2 5461\r\n>\r\n>2 8192\r\n>\r\n>2 10923\r\n>\r\n>2 13654\r\n>\r\n>2 16385\r\n>\r\n>2 19116\r\n>\r\n>2 21847\r\n>\r\n>2 24578\r\n>\r\n>2 27309\r\n>\r\n>2 30040\r\n>\r\n>...\r\n\r\nI don't know whether it's a bug or there is another right way to read bytes from stdin so that the case above can be avoided.\r\n\r\nRustc version: 1.51.0", "closed_by": {"login": "bczhc", "id": 49330580, "node_id": "MDQ6VXNlcjQ5MzMwNTgw", "avatar_url": "https://avatars.githubusercontent.com/u/49330580?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bczhc", "html_url": "https://github.com/bczhc", "followers_url": "https://api.github.com/users/bczhc/followers", "following_url": "https://api.github.com/users/bczhc/following{/other_user}", "gists_url": "https://api.github.com/users/bczhc/gists{/gist_id}", "starred_url": "https://api.github.com/users/bczhc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bczhc/subscriptions", "organizations_url": "https://api.github.com/users/bczhc/orgs", "repos_url": "https://api.github.com/users/bczhc/repos", "events_url": "https://api.github.com/users/bczhc/events{/privacy}", "received_events_url": "https://api.github.com/users/bczhc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84284/timeline", "performed_via_github_app": null, "state_reason": "completed"}