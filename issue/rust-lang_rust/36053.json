{"url": "https://api.github.com/repos/rust-lang/rust/issues/36053", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36053/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36053/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36053/events", "html_url": "https://github.com/rust-lang/rust/issues/36053", "id": 173613990, "node_id": "MDU6SXNzdWUxNzM2MTM5OTA=", "number": 36053, "title": "Type inference ICE: `assertion failed: !self.obligations_in_snapshot.get()`", "user": {"login": "Stebalien", "id": 310393, "node_id": "MDQ6VXNlcjMxMDM5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/310393?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stebalien", "html_url": "https://github.com/Stebalien", "followers_url": "https://api.github.com/users/Stebalien/followers", "following_url": "https://api.github.com/users/Stebalien/following{/other_user}", "gists_url": "https://api.github.com/users/Stebalien/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stebalien/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stebalien/subscriptions", "organizations_url": "https://api.github.com/users/Stebalien/orgs", "repos_url": "https://api.github.com/users/Stebalien/repos", "events_url": "https://api.github.com/users/Stebalien/events{/privacy}", "received_events_url": "https://api.github.com/users/Stebalien/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2016-08-27T20:28:24Z", "updated_at": "2016-09-15T16:58:37Z", "closed_at": "2016-09-15T16:58:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Type inference is barfing on:\n\n``` rust\nuse std::iter::once;\nfn main() {\n    once::<&str>(\"str\").fuse().filter(|a: &str| true).count();\n}\n```\n\nThis only happens to iterators over ~~`&str`s~~ types with lifetime parameters and only happens when fused, mapped or filtered, than \"operated\" on (e.g., counted).\n\nThe following works:\n\n```\nuse std::iter::once;\nuse std::marker::PhantomData;\n\nstruct Test(&'static str);\n\nfn main() {\n    once(Test(\"asdf\")).fuse().filter(|_| true).count();\n}\n```\n\nTrace:\n\n``` rust\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\n\nnote: run with `RUST_BACKTRACE=1` for a backtrace\n\nthread 'rustc' panicked at 'assertion failed: !self.obligations_in_snapshot.get()', ../src/librustc/infer/mod.rs:892\nstack backtrace:\n   1:      0x385616e5833 - std::sys::backtrace::tracing::imp::write::h482d45d91246faa2\n   2:      0x385616f611d - std::panicking::default_hook::_{{closure}}::h89158f66286b674e\n   3:      0x385616f466d - std::panicking::default_hook::h9e30d428ee3b0c43\n   4:      0x385616f4d68 - std::panicking::rust_panic_with_hook::h2224f33fb7bf2f4c\n   5:      0x3855e7daf2f - std::panicking::begin_panic::h6da27a7ee15843ce\n   6:      0x3855e9365e2 - rustc::infer::InferCtxt::rollback_to::ha2f21524af8937ee\n   7:      0x3855fea7ca3 - rustc_typeck::check::method::probe::ProbeContext::consider_candidates::_{{closure}}::hd73cab1de5c62a79\n   8:      0x3855fdebe5c - rustc_typeck::check::method::probe::ProbeContext::consider_candidates::hc4fd590b3d2a253e\n   9:      0x3855fdebb77 - rustc_typeck::check::method::probe::ProbeContext::pick_method::ha1525cf018083b3f\n  10:      0x3855fdeb0ca - rustc_typeck::check::method::probe::ProbeContext::pick_core::h8fe845d303e00275\n  11:      0x3855fea4ecc - rustc_typeck::check::method::probe::_<impl rustc_typeck..check..FnCtxt<'a, 'gcx, 'tcx>>::probe_method::_{{closure}}::h4cc364b0888ee90b\n  12:      0x3855fde7fda - rustc_typeck::check::method::probe::_<impl rustc_typeck..check..FnCtxt<'a, 'gcx, 'tcx>>::probe_method::h5bcb89eaeb8b15c2\n  13:      0x3855fdf278c - rustc_typeck::check::method::_<impl rustc_typeck..check..FnCtxt<'a, 'gcx, 'tcx>>::lookup_method::ha4b60fa1e48e18d1\n  14:      0x3855fe4c2df - rustc_typeck::check::FnCtxt::check_expr_with_expectation_and_lvalue_pref::h057aec20877fc49f\n  15:      0x3855fe4ed90 - rustc_typeck::check::FnCtxt::check_stmt::h0a693585a954d704\n  16:      0x3855fe4f177 - rustc_typeck::check::FnCtxt::check_block_with_expected::he043b17dca8afd62\n  17:      0x3855fe2245f - rustc_typeck::check::check_fn::hd55e09cd766201af\n  18:      0x3855fe20c1d - rustc_typeck::check::check_bare_fn::h56d8f43b26a6d362\n  19:      0x3855fe240a9 - rustc_typeck::check::check_item_body::h7d7e664619f18e7f\n  20:      0x3855fe1e088 - rustc_typeck::check::check_item_bodies::h7d884d53a15202d6\n  21:      0x3855fe89f53 - rustc_typeck::check_crate::h8ec8b2f490f5dc28\n  22:      0x38561ad739e - rustc_driver::driver::phase_3_run_analysis_passes::_{{closure}}::h45e03cee16dcf298\n  23:      0x38561a2ca9f - rustc::ty::context::TyCtxt::create_and_enter::h0021bc4caf3a2e06\n  24:      0x38561a9dfb4 - rustc_driver::driver::compile_input::hd9ecc57abd3cba85\n  25:      0x38561ac40ad - rustc_driver::run_compiler::h184264500271cc39\n  26:      0x38561a05b63 - std::panicking::try::do_call::h17a7a17ad7240c5c\n  27:      0x38561704336 - __rust_maybe_catch_panic\n  28:      0x38561a22f59 - _<F as alloc..boxed..FnBox<A>>::call_box::h95ef76c8d48c6f60\n  29:      0x385616f2ba0 - std::sys::thread::Thread::new::thread_start::he0bf102845911132\n  30:      0x38559b60453 - start_thread\n  31:      0x385613437de - __GI___clone\n  32:                0x0 - <unknown>\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36053/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36053/timeline", "performed_via_github_app": null, "state_reason": "completed"}