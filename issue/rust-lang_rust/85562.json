{"url": "https://api.github.com/repos/rust-lang/rust/issues/85562", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85562/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85562/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85562/events", "html_url": "https://github.com/rust-lang/rust/issues/85562", "id": 898330122, "node_id": "MDU6SXNzdWU4OTgzMzAxMjI=", "number": 85562, "title": "1.52.1 LLVM 12 on 32-bit mips has intrinsics problems", "user": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-21T18:57:19Z", "updated_at": "2021-05-21T22:19:43Z", "closed_at": "2021-05-21T22:19:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "LLVM intrinsics text output seems to be getting corrupted on mipsel 32-bit with LLVM 12 - but it is fine on LLVM 11.\r\n\r\nWe have run the build twice to try to rule out possible hardware issues - [build 1](https://buildd.debian.org/status/fetch.php?pkg=rustc&arch=mipsel&ver=1.52.1%2Bdfsg1-1%7Eexp3&stamp=1621613899&raw=0), [build 2](https://buildd.debian.org/status/fetch.php?pkg=rustc&arch=mipsel&ver=1.52.1%2Bdfsg1-1%7Eexp3&stamp=1621522597&raw=0)\r\n\r\nThe issue causes LLVM intrinsics-related FileCheck tests to fail, with error messages like:\r\n\r\n~~~~\r\n/<<PKGBUILDDIR>>/src/test/codegen/call-llvm-intrinsics.rs:26:12: error: CHECK: expected string not found in input\r\n // CHECK: call float @llvm.sqrt.f32(float 4.000000e+00\r\n           ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/call-llvm-intrinsics/call-llvm-intrinsics.ll:1:1: note: scanning from here\r\n; ModuleID = 'call_llvm_intrinsics.3a1fbbbh-cgu.0'\r\n^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/call-llvm-intrinsics/call-llvm-intrinsics.ll:21:2: note: possible intended match here\r\n call void @llvm.lifetime.start.00G8(i64 8, i8* %1)\r\n ^\r\n~~~~\r\n\r\n~~~~\r\n/<<PKGBUILDDIR>>/src/test/codegen/consts.rs:46:12: error: CHECK: expected string not found in input\r\n // CHECK: memcpy.p0i8.p0i8.i{{(32|64)}}(i8* align 2 %1, i8* align 2 getelementptr inbounds (<{ [8 x i8] }>, <{ [8 x i8] }>* [[LOW_HIGH]], i32 0, i32 0, i32 0), i{{(32|64)}} 8, i1 false)\r\n           ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/consts/consts.ll:37:28: note: scanning from here\r\ndefine i64 @low_align_const() unnamed_addr #0 {\r\n                           ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/consts/consts.ll:37:28: note: with \"LOW_HIGH\" equal to \"@alloc16\"\r\ndefine i64 @low_align_const() unnamed_addr #0 {\r\n                           ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/consts/consts.ll:41:18: note: possible intended match here\r\n call void @llvm.memcpy.00G8.00G8.G32(i8* align 2 %1, i8* align 2 getelementptr inbounds (<{ [8 x i8] }>, <{ [8 x i8] }>* @alloc16, i32 0, i32 0, i32 0), i32 8, i1 false)\r\n                 ^\r\n/<<PKGBUILDDIR>>/src/test/codegen/consts.rs:54:12: error: CHECK: expected string not found in input\r\n // CHECK: memcpy.p0i8.p0i8.i{{(32|64)}}(i8* align 4 %1, i8* align 4 getelementptr inbounds (<{ [8 x i8] }>, <{ [8 x i8] }>* [[LOW_HIGH]], i32 0, i32 0, i32 0), i{{(32|64)}} 8, i1 false)\r\n           ^\r\n~~~~\r\n\r\n~~~~\r\n/<<PKGBUILDDIR>>/src/test/codegen/intrinsics/nearby.rs:9:12: error: CHECK: expected string not found in input\r\n // CHECK: llvm.nearbyint.f32\r\n           ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/intrinsics/nearby/nearby.ll:7:27: note: scanning from here\r\ndefine float @nearbyintf32(float %a) unnamed_addr #0 {\r\n                          ^\r\n/<<PKGBUILDDIR>>/build/mipsel-unknown-linux-gnu/test/codegen/intrinsics/nearby/nearby.ll:9:24: note: possible intended match here\r\n %0 = tail call float @llvm.nearbyint.toH(float %a)\r\n                       ^\r\n~~~~\r\n\r\nNote that the output contains function mangled type strings like \".00G8\" and \".toH\" which are not legitimate values for a mangled type string (see https://github.com/llvm/llvm-project/blob/5b6cae5524905bc43cfc21a515f828528d1f2e68/llvm/lib/IR/Function.cpp#L777), pointing to a memory corruption bug either in LLVM 12 or rustc.\r\n\r\nInvestigation is ongoing, will update.", "closed_by": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85562/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85562/timeline", "performed_via_github_app": null, "state_reason": "completed"}