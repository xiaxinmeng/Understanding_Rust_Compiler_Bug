{"url": "https://api.github.com/repos/rust-lang/rust/issues/4545", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4545/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4545/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4545/events", "html_url": "https://github.com/rust-lang/rust/issues/4545", "id": 10130951, "node_id": "MDU6SXNzdWUxMDEzMDk1MQ==", "number": 4545, "title": "ICE with crate & polymorphic constructor function", "user": {"login": "rntz", "id": 16143, "node_id": "MDQ6VXNlcjE2MTQz", "avatar_url": "https://avatars.githubusercontent.com/u/16143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rntz", "html_url": "https://github.com/rntz", "followers_url": "https://api.github.com/users/rntz/followers", "following_url": "https://api.github.com/users/rntz/following{/other_user}", "gists_url": "https://api.github.com/users/rntz/gists{/gist_id}", "starred_url": "https://api.github.com/users/rntz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rntz/subscriptions", "organizations_url": "https://api.github.com/users/rntz/orgs", "repos_url": "https://api.github.com/users/rntz/repos", "events_url": "https://api.github.com/users/rntz/events{/privacy}", "received_events_url": "https://api.github.com/users/rntz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2013-01-19T23:28:43Z", "updated_at": "2014-06-16T21:56:22Z", "closed_at": "2013-10-11T06:56:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In somelib.rc:\n\n```\n#[crate_type = \"lib\"];\n#[link(name=\"somelib\", vers=\"0.0\")];\npub struct S<T>(Option<T>);\npub fn mk<T>() -> S<T> { S(None) }\n```\n\nIn client.rs:\n\n```\nextern mod somelib;\nfn main() { somelib::mk::<int>(); }\n```\n\nDo the following:\n\n```\n$ rustc somelib.rc\n$ rustc -L. client.rs\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\n```\n\nNotes:\n- Does not require Option. `pub struct S<T>(~[T])` or `pub struct S,T>(())` also\n  cause ICEs.\n- Requires polymorphism; `pub struct S(())` does not cause an ICE.\n\nBacktrace follows:\n\n```\nrust: task failed at 'lookup_item: id not found: 8', /home/rntz/s/rust/src/librustc/metadata/decoder.rs:137\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fae9e3b7b8b]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e359)[0x7fae9e3cb359]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7fae9e3ba340]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xaf0cb)[0x7fae9fc070cb]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x3f4be)[0x7fae9fb974be]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x753604)[0x7fae9ed4d604]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN8metadata7decoder18maybe_get_item_ast14_6bb9245fa0cf33_06E+0x19f)[0x7fae9ed52c3f]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN8metadata7csearch18maybe_get_item_ast17_c51398c1464d7ab83_06E+0x8d)[0x7fae9e7065ad]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans6inline24maybe_instantiate_inline16_1ffff7ac8aaa2a43_06E+0x3e6)[0x7fae9e6e1926]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans8type_use13type_uses_for16_5ac4ed03f596ec23_06E+0x789)[0x7fae9e71b0d9]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans8type_use13mark_for_expr17_f4783860c9d7bf183_06E+0x7a7)[0x7fae9e8bff77]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2caedc)[0x7fae9e8c4edc]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2cab00)[0x7fae9e8c4b00]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2cd6de)[0x7fae9e8c76de]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x2cd5c0)[0x7fae9e8c75c0]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans8type_use11handle_body16_5ed46d80c4588b43_06E+0x9e3)[0x7fae9e8bbb63]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans8type_use13type_uses_for16_5ac4ed03f596ec23_06E+0x33cf)[0x7fae9e71dd1f]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans12monomorphize14monomorphic_fn16_8985345158b2c843_06E+0x317)[0x7fae9e715807]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans6callee25trans_fn_ref_with_vtables17_26759f80cc3ed23e3_06E+0xf7c)[0x7fae9e7c9b8c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bd9ac)[0x7fae9edb79ac]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans6callee12trans_fn_ref16_46d37cdacaf94123_06E+0xa7)[0x7fae9e7c65d7]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans6callee5trans17_786028e87c1cc5683_06E+0x367)[0x7fae9e7c38e7]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x1de86c)[0x7fae9e7d886c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10with_scope16_f9b697c7991b8983_06E+0x440)[0x7fae9e79c2f0]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans6callee10trans_call16_eee8f00cb2019183_06E+0x249)[0x7fae9e7cc219]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x1eaa26)[0x7fae9e7e4a26]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4expr10trans_into16_7ae31c4cdcb7bf53_06E+0x69e)[0x7fae9e75afee]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_stmt16_72d83e6f13c2d973_06E+0x3d2)[0x7fae9e75a3f2]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans11controlflow11trans_block15_1f115d54efa2fe3_06E+0x17d)[0x7fae9e75895d]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base13trans_closure16_d015ca2d85785843_06E+0x568)[0x7fae9e83c018]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base8trans_fn17_83f45d8ff2c06e823_06E+0x441)[0x7fae9e7151c1]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_item16_512ccd6bccce7a33_06E+0xd28)[0x7fae9e70bae8]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base9trans_mod17_597f5c6c2c7fa77f3_06E+0x8f)[0x7fae9e84208f]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base11trans_crate16_70f4efaa4968de53_06E+0x1182)[0x7fae9e85eac2]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bd9ac)[0x7fae9edb79ac]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver12compile_upto17_4eb9d92e36712a653_06E+0x2664)[0x7fae9ed7db24]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bd9ac)[0x7fae9edb79ac]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver13compile_input16_3e3367fb7931f913_06E+0xbd)[0x7fae9ed802ad]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN12run_compiler16_40a563e0db358373_06E+0x2592)[0x7fae9edb0732]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bd9ac)[0x7fae9edb79ac]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bc6c3)[0x7fae9edb66c3]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bb72c)[0x7fae9edb572c]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x87e6d)[0x7fae9fbdfe6d]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xc3580)[0x7fae9fc1b580]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fae9e3b83f4]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/rntz/s/rust/src/librustc/rustc.rc:427\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fae9e3b7b8b]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e359)[0x7fae9e3cb359]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7fae9e3ba340]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xaf0cb)[0x7fae9fc070cb]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x3f4be)[0x7fae9fb974be]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xc3580)[0x7fae9fc1b580]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN7monitor16_1cfefc35869d0533_06E+0x29be)[0x7fae9edb46fe]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(+0x7bd9ac)[0x7fae9edb79ac]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.6.so(_ZN4main16_2fb85b4a659c4103_06E+0x86)[0x7fae9edb75b6]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fae9e3b83f4]\nrust: domain main @0x690610 root task failed\nrust: task failed at 'killed', /home/rntz/s/rust/src/libcore/task/mod.rs:577\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fae9e3b7b8b]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e359)[0x7fae9e3cb359]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7fae9e3ba340]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xaf0cb)[0x7fae9fc070cb]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x3f4be)[0x7fae9fb974be]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN4task5yield17_56812fae66173efd3_06E+0xbd)[0x7fae9fbc8b1d]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x9d8f6)[0x7fae9fbf58f6]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xc3580)[0x7fae9fc1b580]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN7private11weaken_task17_7a7c4fd2a577a8a53_06E+0xd9)[0x7fae9fbf5739]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x9d62b)[0x7fae9fbf562b]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x98203)[0x7fae9fbf0203]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x87e6d)[0x7fae9fbdfe6d]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xc3580)[0x7fae9fc1b580]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fae9e3b83f4]\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4545/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4545/timeline", "performed_via_github_app": null, "state_reason": "completed"}