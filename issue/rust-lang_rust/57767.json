{"url": "https://api.github.com/repos/rust-lang/rust/issues/57767", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57767/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57767/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57767/events", "html_url": "https://github.com/rust-lang/rust/issues/57767", "id": 401057339, "node_id": "MDU6SXNzdWU0MDEwNTczMzk=", "number": 57767, "title": "`rustdoc --test` that passes with Rust 1.31.0 and fails with Rust 1.32.0, involving `use` paths", "user": {"login": "carols10cents", "id": 193874, "node_id": "MDQ6VXNlcjE5Mzg3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/193874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carols10cents", "html_url": "https://github.com/carols10cents", "followers_url": "https://api.github.com/users/carols10cents/followers", "following_url": "https://api.github.com/users/carols10cents/following{/other_user}", "gists_url": "https://api.github.com/users/carols10cents/gists{/gist_id}", "starred_url": "https://api.github.com/users/carols10cents/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carols10cents/subscriptions", "organizations_url": "https://api.github.com/users/carols10cents/orgs", "repos_url": "https://api.github.com/users/carols10cents/repos", "events_url": "https://api.github.com/users/carols10cents/events{/privacy}", "received_events_url": "https://api.github.com/users/carols10cents/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-01-20T03:02:14Z", "updated_at": "2019-01-20T18:40:48Z", "closed_at": "2019-01-20T18:40:48Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I'm not sure what changed in here, but a [contributor to the book just discovered we have a doctest that passed with stable 1.31.0 and fails to compile with stable 1.32.0](https://github.com/rust-lang/book/issues/1776).\r\n\r\nIf I extract the code into a library and remove the rustdoc specific bits (the code hiding `#`s), it compiles successfully with both Rust 1.31.0 and Rust 1.32.0, so I suspect something with rustdoc to be the cause? I'm not entirely sure though. \r\n\r\nI looked for recent PRs and issues and didn't find anything that looked relevant, other than uniform path stabilization, and I hope it's not that.\r\n\r\nThis is the one test from the book extracted for reproduction (but still within a markdown file as it is in the book because that seems important):\r\n\r\n````\r\n# Rustdoc Weirdness Example\r\n\r\nHere is the doc test that passes with Rust 1.31.0 and fails with Rust 1.32.0:\r\n\r\n```rust\r\n//! # Art\r\n//!\r\n//! A library for modeling artistic concepts.\r\n\r\npub mod kinds {\r\n    /// The primary colors according to the RYB color model.\r\n    pub enum PrimaryColor {\r\n        Red,\r\n        Yellow,\r\n        Blue,\r\n    }\r\n\r\n    /// The secondary colors according to the RYB color model.\r\n    pub enum SecondaryColor {\r\n        Orange,\r\n        Green,\r\n        Purple,\r\n    }\r\n}\r\n\r\npub mod utils {\r\n    use crate::kinds::*;\r\n\r\n    /// Combines two primary colors in equal amounts to create\r\n    /// a secondary color.\r\n    pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -> SecondaryColor {\r\n        // --snip--\r\n#         SecondaryColor::Orange\r\n    }\r\n}\r\n# fn main() {}\r\n```\r\n\r\nWeird, right???\r\n\r\n````\r\n\r\n\r\nTo reproduce, put this text into `something.md`. If you use Rust 1.31.0 and run `rustdoc --test something.md`, it results in 1 test passing. If you use Rust 1.32.0 and run `rustdoc --test something.md`, it can't compile the test and results in these compiler errors:\r\n\r\n```\r\n---- src/ch14-02-publishing-to-crates-io.md - Rustdoc_Weirdness_Example (line 5) stdout ----\r\nerror[E0432]: unresolved import `crate::kinds`\r\n  --> src/ch14-02-publishing-to-crates-io.md:27:16\r\n   |\r\n24 |     use crate::kinds::*;\r\n   |                ^^^^^ maybe a missing `extern crate kinds;`?\r\n\r\nerror[E0433]: failed to resolve: use of undeclared type or module `SecondaryColor`\r\n  --> src/ch14-02-publishing-to-crates-io.md:33:9\r\n   |\r\n30 |         SecondaryColor::Orange\r\n   |         ^^^^^^^^^^^^^^ use of undeclared type or module `SecondaryColor`\r\n\r\nerror[E0412]: cannot find type `PrimaryColor` in this scope\r\n  --> src/ch14-02-publishing-to-crates-io.md:31:20\r\n   |\r\n28 |     pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -> SecondaryColor {\r\n   |                    ^^^^^^^^^^^^ not found in this scope\r\n\r\nerror[E0412]: cannot find type `PrimaryColor` in this scope\r\n  --> src/ch14-02-publishing-to-crates-io.md:31:38\r\n   |\r\n28 |     pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -> SecondaryColor {\r\n   |                                      ^^^^^^^^^^^^ not found in this scope\r\n\r\nerror[E0412]: cannot find type `SecondaryColor` in this scope\r\n  --> src/ch14-02-publishing-to-crates-io.md:31:55\r\n   |\r\n28 |     pub fn mix(c1: PrimaryColor, c2: PrimaryColor) -> SecondaryColor {\r\n   |                                                       ^^^^^^^^^^^^^^ not found in this scope\r\n\r\nthread 'src/ch14-02-publishing-to-crates-io.md - Rustdoc_Weirdness_Example (line 5)' panicked at 'couldn't compile the test', src/librustdoc/test.rs:323:13\r\n```\r\n\r\n\r\n", "closed_by": {"login": "carols10cents", "id": 193874, "node_id": "MDQ6VXNlcjE5Mzg3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/193874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carols10cents", "html_url": "https://github.com/carols10cents", "followers_url": "https://api.github.com/users/carols10cents/followers", "following_url": "https://api.github.com/users/carols10cents/following{/other_user}", "gists_url": "https://api.github.com/users/carols10cents/gists{/gist_id}", "starred_url": "https://api.github.com/users/carols10cents/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carols10cents/subscriptions", "organizations_url": "https://api.github.com/users/carols10cents/orgs", "repos_url": "https://api.github.com/users/carols10cents/repos", "events_url": "https://api.github.com/users/carols10cents/events{/privacy}", "received_events_url": "https://api.github.com/users/carols10cents/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57767/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57767/timeline", "performed_via_github_app": null, "state_reason": "completed"}