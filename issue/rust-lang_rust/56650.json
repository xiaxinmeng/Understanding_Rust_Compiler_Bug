{"url": "https://api.github.com/repos/rust-lang/rust/issues/56650", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/56650/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/56650/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/56650/events", "html_url": "https://github.com/rust-lang/rust/issues/56650", "id": 389049444, "node_id": "MDU6SXNzdWUzODkwNDk0NDQ=", "number": 56650, "title": "rustc_llvm fails to build if source directory contains whitespace", "user": {"login": "CarePackage17", "id": 5157010, "node_id": "MDQ6VXNlcjUxNTcwMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5157010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CarePackage17", "html_url": "https://github.com/CarePackage17", "followers_url": "https://api.github.com/users/CarePackage17/followers", "following_url": "https://api.github.com/users/CarePackage17/following{/other_user}", "gists_url": "https://api.github.com/users/CarePackage17/gists{/gist_id}", "starred_url": "https://api.github.com/users/CarePackage17/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CarePackage17/subscriptions", "organizations_url": "https://api.github.com/users/CarePackage17/orgs", "repos_url": "https://api.github.com/users/CarePackage17/repos", "events_url": "https://api.github.com/users/CarePackage17/events{/privacy}", "received_events_url": "https://api.github.com/users/CarePackage17/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}], "state": "open", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2018-12-09T18:23:27Z", "updated_at": "2023-04-01T20:02:37Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hi all,\r\n\r\nI have followed the instructions to build Rust on Windows with the MSVC toolchain (note: this issue is not windows specific) and hit a build error in rustc_llvm; here's the output:\r\n```\r\nerror: failed to run custom build command for `rustc_llvm v0.0.0 (C:\\Users\\Krzysztof Lesiak\\Desktop\\devel\\rust\\src\\librustc_llvm)`\r\nprocess didn't exit successfully: `C:\\Users\\Krzysztof Lesiak\\Desktop\\devel\\rust\\build\\x86_64-pc-windows-msvc\\stage0-codegen\\release\\build\\rustc_llvm-9e0bf274131fe14d\\build-script-build` (exit code: 101)\r\n--- stdout\r\ncargo:rerun-if-changed=C:\\Users\\Krzysztof Lesiak\\Desktop\\devel\\rust\\build\\x86_64-pc-windows-msvc\\llvm\\bin\\llvm-config.exe\r\ncargo:rerun-if-env-changed=LLVM_CONFIG\r\ncargo:rustc-cfg=llvm_component=\"aarch64\"\r\ncargo:rustc-cfg=llvm_component=\"arm\"\r\ncargo:rustc-cfg=llvm_component=\"asmparser\"\r\ncargo:rustc-cfg=llvm_component=\"bitreader\"\r\ncargo:rustc-cfg=llvm_component=\"bitwriter\"\r\ncargo:rustc-cfg=llvm_component=\"hexagon\"\r\ncargo:rustc-cfg=llvm_component=\"instrumentation\"\r\ncargo:rustc-cfg=llvm_component=\"interpreter\"\r\ncargo:rustc-cfg=llvm_component=\"ipo\"\r\ncargo:rustc-cfg=llvm_component=\"linker\"\r\ncargo:rustc-cfg=llvm_component=\"lto\"\r\ncargo:rustc-cfg=llvm_component=\"mcjit\"\r\ncargo:rustc-cfg=llvm_component=\"mips\"\r\ncargo:rustc-cfg=llvm_component=\"msp430\"\r\ncargo:rustc-cfg=llvm_component=\"nvptx\"\r\ncargo:rustc-cfg=llvm_component=\"powerpc\"\r\ncargo:rustc-cfg=llvm_component=\"sparc\"\r\ncargo:rustc-cfg=llvm_component=\"systemz\"\r\ncargo:rustc-cfg=llvm_component=\"x86\"\r\ncargo:rerun-if-changed-env=LLVM_RUSTLLVM\r\ncargo:rerun-if-changed=../rustllvm\\RustWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm\\rustllvm.h\r\ncargo:rerun-if-changed=../rustllvm\\README\r\ncargo:rerun-if-changed=../rustllvm\\PassWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm\\llvm-rebuild-trigger\r\ncargo:rerun-if-changed=../rustllvm\\Linker.cpp\r\ncargo:rerun-if-changed=../rustllvm\\ArchiveWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm\\.editorconfig\r\nTARGET = Some(\"x86_64-pc-windows-msvc\")\r\nOPT_LEVEL = Some(\"2\")\r\nHOST = Some(\"x86_64-pc-windows-msvc\")\r\nCXX_x86_64-pc-windows-msvc = None\r\nCXX_x86_64_pc_windows_msvc = None\r\nHOST_CXX = None\r\nCXX = None\r\nCXXFLAGS_x86_64-pc-windows-msvc = None\r\nCXXFLAGS_x86_64_pc_windows_msvc = None\r\nHOST_CXXFLAGS = None\r\nCXXFLAGS = None\r\nDEBUG = Some(\"false\")\r\nrunning: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Community\\\\VC\\\\Tools\\\\MSVC\\\\14.16.27023\\\\bin\\\\HostX64\\\\x64\\\\cl.exe\" \"/nologo\" \"/MT\" \"/O2\" \"-IC:\\\\Users\\\\Krzysztof\" \"Lesiak\\\\Desktop\\\\devel\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\llvm\\\\include\" \"/nologo\" \"/MT\" \"/Zc:inline\" \"/Zc:strictStrings\" \"/Oi\" \"/Zc:rvalueCast\" \"/W4\" \"-wd4141\" \"-wd4146\" \"-wd4180\" \"-wd4244\" \"-wd4258\" \"-wd4267\" \"-wd4291\" \"-wd4345\" \"-wd4351\" \"-wd4355\" \"-wd4456\" \"-wd4457\" \"-wd4458\" \"-wd4459\" \"-wd4503\" \"-wd4624\" \"-wd4722\" \"-wd4800\" \"-wd4100\" \"-wd4127\" \"-wd4512\" \"-wd4505\" \"-wd4610\" \"-wd4510\" \"-wd4702\" \"-wd4245\" \"-wd4706\" \"-wd4310\" \"-wd4701\" \"-wd4703\" \"-wd4389\" \"-wd4611\" \"-wd4805\" \"-wd4204\" \"-wd4577\" \"-wd4091\" \"-wd4592\" \"-wd4319\" \"-wd4324\" \"-w14062\" \"-we4238\" \"/nologo\" \"/MT\" \"/EHs-c-\" \"/GR-\" \"-D_CRT_SECURE_NO_DEPRECATE\" \"-D_CRT_SECURE_NO_WARNINGS\" \"-D_CRT_NONSTDC_NO_DEPRECATE\" \"-D_CRT_NONSTDC_NO_WARNINGS\" \"-D_SCL_SECURE_NO_DEPRECATE\" \"-D_SCL_SECURE_NO_WARNINGS\" \"-DUNICODE\" \"-D_UNICODE\" \"-D__STDC_CONSTANT_MACROS\" \"-D__STDC_FORMAT_MACROS\" \"-D__STDC_LIMIT_MACROS\" \"/DLLVM_COMPONENT_AARCH64\" \"/DLLVM_COMPONENT_ARM\" \"/DLLVM_COMPONENT_ASMPARSER\" \"/DLLVM_COMPONENT_BITREADER\" \"/DLLVM_COMPONENT_BITWRITER\" \"/DLLVM_COMPONENT_HEXAGON\" \"/DLLVM_COMPONENT_INSTRUMENTATION\" \"/DLLVM_COMPONENT_INTERPRETER\" \"/DLLVM_COMPONENT_IPO\" \"/DLLVM_COMPONENT_LINKER\" \"/DLLVM_COMPONENT_LTO\" \"/DLLVM_COMPONENT_MCJIT\" \"/DLLVM_COMPONENT_MIPS\" \"/DLLVM_COMPONENT_MSP430\" \"/DLLVM_COMPONENT_NVPTX\" \"/DLLVM_COMPONENT_POWERPC\" \"/DLLVM_COMPONENT_SPARC\" \"/DLLVM_COMPONENT_SYSTEMZ\" \"/DLLVM_COMPONENT_X86\" \"/DLLVM_RUSTLLVM\" \"/FoC:\\\\Users\\\\Krzysztof Lesiak\\\\Desktop\\\\devel\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-codegen\\\\x86_64-pc-windows-msvc\\\\release\\\\build\\\\rustc_llvm-16916bb4d00807d7\\\\out\\\\../rustllvm\\\\PassWrapper.o\" \"/c\" \"../rustllvm/PassWrapper.cpp\"\r\ncargo:warning=cl : Command line warning D9024 : unrecognized source file type 'Lesiak\\Desktop\\devel\\rust\\build\\x86_64-pc-windows-msvc\\llvm\\include', object file assumed\r\ncargo:warning=cl : Command line warning D9027 : source file 'Lesiak\\Desktop\\devel\\rust\\build\\x86_64-pc-windows-msvc\\llvm\\include' ignored\r\nPassWrapper.cpp\r\nc:\\users\\krzysztof lesiak\\desktop\\devel\\rust\\src\\rustllvm\\rustllvm.h(11): fatal error C1083: Cannot open include file: 'llvm-c/BitReader.h': No such file or directory\r\nexit code: 2\r\n```\r\n\r\nWhen inspecting the first `/I` argument to `cl.exe` the build script seems to have problems with the space in my user name and breaks up the path so the compiler can't find `BitReader.h` as a result.\r\n\r\nEdit: The offending code is in `librustc_llvm/build.rs` line 139:\r\n```\r\n    for flag in cxxflags.split_whitespace() {\r\n        // Ignore flags like `-m64` when we're doing a cross build\r\n        if is_crossed && flag.starts_with(\"-m\") {\r\n            continue;\r\n        }\r\n\r\n        // -Wdate-time is not supported by the netbsd cross compiler\r\n        if is_crossed && target.contains(\"netbsd\") && flag.contains(\"date-time\") {\r\n            continue;\r\n        }\r\n\r\n        cfg.flag(flag);\r\n    }\r\n```\r\n\r\nI'm not quite sure how to fix it myself; something like the Args iterator from std::env would do the job, but I've got no idea how to obtain it here.\r\n\r\nEdit2: I just noticed something weird, the `/Fo` argument also contains my username and it seems to have been correctly escaped there.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/56650/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/56650/timeline", "performed_via_github_app": null, "state_reason": null}