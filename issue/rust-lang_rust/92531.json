{"url": "https://api.github.com/repos/rust-lang/rust/issues/92531", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92531/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92531/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92531/events", "html_url": "https://github.com/rust-lang/rust/issues/92531", "id": 1092760050, "node_id": "I_kwDOAAsO6M5BIjHy", "number": 92531, "title": "Confusing error message with moving a value within a nested for loop", "user": {"login": "alexschrod", "id": 767490, "node_id": "MDQ6VXNlcjc2NzQ5MA==", "avatar_url": "https://avatars.githubusercontent.com/u/767490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexschrod", "html_url": "https://github.com/alexschrod", "followers_url": "https://api.github.com/users/alexschrod/followers", "following_url": "https://api.github.com/users/alexschrod/following{/other_user}", "gists_url": "https://api.github.com/users/alexschrod/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexschrod/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexschrod/subscriptions", "organizations_url": "https://api.github.com/users/alexschrod/orgs", "repos_url": "https://api.github.com/users/alexschrod/repos", "events_url": "https://api.github.com/users/alexschrod/events{/privacy}", "received_events_url": "https://api.github.com/users/alexschrod/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1839565265, "node_id": "MDU6TGFiZWwxODM5NTY1MjY1", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-terse", "name": "D-terse", "color": "c9f7a3", "default": false, "description": "A diagnostic that doesn't give enough information about the problem at hand"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-03T19:26:37Z", "updated_at": "2022-01-03T19:30:22Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I had code similar to the below (which is a minimal reproduction version of the original code), and its error was very confusing to me, enough so that I had to ask about what was wrong with it on the Rust discord, and even then it took a little while before anyone could get through to me what was even wrong.\r\n\r\nGiven the following code: <https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=c437992df178c2e794b09b37cc3b2ea3>\r\n\r\n```rust\r\nlet foos = vec![String::from(\"hello\"), String::from(\"world\")];\r\nlet bars = vec![\"world\"];\r\n\r\nlet mut baz = vec![];\r\nlet mut qux = vec![];\r\n\r\nfor foo in foos {\r\n    for bar in &bars {\r\n        if foo == *bar {\r\n            baz.push(foo);\r\n            continue;\r\n        }\r\n    }\r\n    \r\n    qux.push(foo);\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0382]: borrow of moved value: `foo`\r\n  --> src/main.rs:10:16\r\n   |\r\n8  |     for foo in foos {\r\n   |         ---\r\n   |         |\r\n   |         this reinitialization might get skipped\r\n   |         move occurs because `foo` has type `String`, which does not implement the `Copy` trait\r\n9  |         for bar in &bars {\r\n10 |             if foo == *bar {\r\n   |                ^^^ value borrowed here after move\r\n11 |                 baz.push(foo);\r\n   |                          --- value moved here, in previous iteration of loop\r\n```\r\n\r\nThe problem was that I meant to `continue` the outer loop, but I had forgotten that I was inside an inner loop. What made it all the more confusing is that it points to `foo` in the outer loop and says \"this reinitialization might get skipped,\" which baffled me, because I couldn't ever imagine a loop variable *not* being reinitialized when the next iteration comes around.\r\n\r\nSo the combination of \"value moved here, in previous iteration of loop\" combined with \"this reinitialization might get skipped\" made no sense to me.\r\n\r\nI'm not really sure how this could be improved, but the fact that there are two loops involved makes this diagnostic confusing in my opinion. It might make sense to detect that such a situation is going on and be more careful about the wording, by saying something like \"in previous iteration of inner loop.\"", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92531/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92531/timeline", "performed_via_github_app": null, "state_reason": null}