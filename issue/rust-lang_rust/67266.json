{"url": "https://api.github.com/repos/rust-lang/rust/issues/67266", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67266/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67266/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67266/events", "html_url": "https://github.com/rust-lang/rust/issues/67266", "id": 537253191, "node_id": "MDU6SXNzdWU1MzcyNTMxOTE=", "number": 67266, "title": "SystemTime::now should use GetSystemTimePreciseAsFileTime where available", "user": {"login": "dbregman", "id": 2189115, "node_id": "MDQ6VXNlcjIxODkxMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2189115?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbregman", "html_url": "https://github.com/dbregman", "followers_url": "https://api.github.com/users/dbregman/followers", "following_url": "https://api.github.com/users/dbregman/following{/other_user}", "gists_url": "https://api.github.com/users/dbregman/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbregman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbregman/subscriptions", "organizations_url": "https://api.github.com/users/dbregman/orgs", "repos_url": "https://api.github.com/users/dbregman/repos", "events_url": "https://api.github.com/users/dbregman/events{/privacy}", "received_events_url": "https://api.github.com/users/dbregman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-12-12T22:43:34Z", "updated_at": "2020-03-16T14:49:09Z", "closed_at": "2020-03-16T14:49:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "The current implementation of std::time::SystemTime::now on Windows uses the GetSystemTimeAsFileTime function. This function has relatively poor resolution, between 1-16ms depending on the system, which is unacceptable for many real-world applications.\r\n\r\nGetSystemTimePreciseAsFileTime on the other hand has a resolution between 1us and 100ns. This extra precision comes at a small performance cost[1], but it is still an extremely lightweight function call. I measured it at 20ns/call on my system. I believe GetSystemTimePreciseAsFileTime should be preferred whenever it is available (Windows Vista and higher)\r\n\r\nThere seems to be some FUD out there surrounding this function, however Microsoft recommends using this function in this fairly recent article [2] Quote:\r\n> When you need UTC-synchronized time stamps with a resolution of 1 microsecond or better, choose GetSystemTimePreciseAsFileTime \r\n\r\nSee also: Same issue was identified and fixed a couple years ago in the .net runtime: [3]\r\n\r\n[1] https://devblogs.microsoft.com/oldnewthing/20170921-00/?p=97057\r\n[2] https://docs.microsoft.com/en-us/windows/win32/sysinfo/acquiring-high-resolution-time-stamps. \r\n[3] https://github.com/dotnet/coreclr/pull/9736\r\n", "closed_by": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67266/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67266/timeline", "performed_via_github_app": null, "state_reason": "completed"}