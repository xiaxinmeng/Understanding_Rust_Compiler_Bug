{"url": "https://api.github.com/repos/rust-lang/rust/issues/104262", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104262/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104262/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104262/events", "html_url": "https://github.com/rust-lang/rust/issues/104262", "id": 1444608096, "node_id": "I_kwDOAAsO6M5WGvhg", "number": 104262, "title": "1.64 treats `as` casts from non-Copy enums as not moving the LHS", "user": {"login": "cbiffle", "id": 45247, "node_id": "MDQ6VXNlcjQ1MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/45247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbiffle", "html_url": "https://github.com/cbiffle", "followers_url": "https://api.github.com/users/cbiffle/followers", "following_url": "https://api.github.com/users/cbiffle/following{/other_user}", "gists_url": "https://api.github.com/users/cbiffle/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbiffle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbiffle/subscriptions", "organizations_url": "https://api.github.com/users/cbiffle/orgs", "repos_url": "https://api.github.com/users/cbiffle/repos", "events_url": "https://api.github.com/users/cbiffle/events{/privacy}", "received_events_url": "https://api.github.com/users/cbiffle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-11-10T21:46:04Z", "updated_at": "2022-11-11T18:15:12Z", "closed_at": "2022-11-11T18:15:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This code is (rightfully) rejected by at least 1.57 - 1.63, accepted by 1.64, and rejected again by 1.65.\r\n\r\n```rust\r\nenum Foo {\r\n    A = 1,\r\n}\r\n\r\nfn main() {\r\n    let a = Foo::A;\r\n    let b = a as u8;\r\n    let c = a as u8;\r\n}\r\n```\r\n\r\nIn compiler versions other than 1.64, the second `a as u8` assignment is rejected, since `a` is not `Copy` and was previously moved into the `as u8` operation that created `b`. On 1.64 it's silently tolerated.\r\n\r\nThis does not, as far as I can tell, affect `as` conversions other non-`Copy` types, though I could only come up with one example (`&mut` can be `as`-converted without being `Copy`). It also appears to be specific to `as` conversions -- attempting to move the value twice without casting triggers the compiler warning you'd expect.\r\n\r\nIt's possible this is already covered by an existing bug report, since it appears to be fixed in 1.65, but I couldn't find one, and wanted to make sure there was a paper trail in case this surprises anyone else. We've got a repo pinned to 1.64 that contains some incorrect code being admitted by this bug. (The closest thing we could find is #91161.)\r\n\r\nThanks to @jgallagher for help tracking this down.", "closed_by": {"login": "cbiffle", "id": 45247, "node_id": "MDQ6VXNlcjQ1MjQ3", "avatar_url": "https://avatars.githubusercontent.com/u/45247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cbiffle", "html_url": "https://github.com/cbiffle", "followers_url": "https://api.github.com/users/cbiffle/followers", "following_url": "https://api.github.com/users/cbiffle/following{/other_user}", "gists_url": "https://api.github.com/users/cbiffle/gists{/gist_id}", "starred_url": "https://api.github.com/users/cbiffle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cbiffle/subscriptions", "organizations_url": "https://api.github.com/users/cbiffle/orgs", "repos_url": "https://api.github.com/users/cbiffle/repos", "events_url": "https://api.github.com/users/cbiffle/events{/privacy}", "received_events_url": "https://api.github.com/users/cbiffle/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104262/reactions", "total_count": 6, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104262/timeline", "performed_via_github_app": null, "state_reason": "completed"}