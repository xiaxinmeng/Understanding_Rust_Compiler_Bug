{"url": "https://api.github.com/repos/rust-lang/rust/issues/100558", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100558/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100558/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100558/events", "html_url": "https://github.com/rust-lang/rust/issues/100558", "id": 1338474571, "node_id": "I_kwDOAAsO6M5Px4BL", "number": 100558, "title": "Memory leaks detected when using rustc_interface.", "user": {"login": "MediosZ", "id": 24819143, "node_id": "MDQ6VXNlcjI0ODE5MTQz", "avatar_url": "https://avatars.githubusercontent.com/u/24819143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MediosZ", "html_url": "https://github.com/MediosZ", "followers_url": "https://api.github.com/users/MediosZ/followers", "following_url": "https://api.github.com/users/MediosZ/following{/other_user}", "gists_url": "https://api.github.com/users/MediosZ/gists{/gist_id}", "starred_url": "https://api.github.com/users/MediosZ/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MediosZ/subscriptions", "organizations_url": "https://api.github.com/users/MediosZ/orgs", "repos_url": "https://api.github.com/users/MediosZ/repos", "events_url": "https://api.github.com/users/MediosZ/events{/privacy}", "received_events_url": "https://api.github.com/users/MediosZ/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-08-15T03:03:14Z", "updated_at": "2022-11-11T17:29:57Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\nI was trying to use `rustc_interface`, but when building with `RUSTFLAGS=\"-Z sanitizer=address\"`, I get some memory leaks.\r\n\r\n### Code\r\n\r\n```Rust\r\n#![feature(rustc_private)]\r\n#![feature(let_else)]\r\n#![feature(once_cell)]\r\nextern crate rustc_driver;\r\nextern crate rustc_interface;\r\nextern crate rustc_session;\r\nextern crate rustc_span;\r\nuse rustc_driver::{args, diagnostics_registry, handle_options};\r\nuse rustc_interface::interface;\r\nuse rustc_session::config::{self, Input};\r\nuse rustc_session::DiagnosticOutput;\r\nuse std::env;\r\nuse std::process;\r\nuse std::str;\r\n\r\nfn run_compiler(at_args: &[String]) -> interface::Result<()> {\r\n    let args = args::arg_expand_all(at_args);\r\n    let Some(matches) = handle_options(&args) else { return Ok(()) };\r\n    let sopts = config::build_session_options(&matches);\r\n    let config = interface::Config {\r\n        opts: sopts,\r\n        crate_cfg: Default::default(),\r\n        input: Input::Str {\r\n            name: rustc_span::FileName::Custom(\"main\".into()),\r\n            input: \"fn main(){}\".into(),\r\n        },\r\n        input_path: None,\r\n        output_file: None,\r\n        output_dir: None,\r\n        file_loader: None,\r\n        diagnostic_output: DiagnosticOutput::Default,\r\n        lint_caps: Default::default(),\r\n        parse_sess_created: None,\r\n        register_lints: None,\r\n        override_queries: None,\r\n        make_codegen_backend: None,\r\n        registry: diagnostics_registry(),\r\n        // stderr: None, // Option<Arc<Mutex<Vec<u8>>>>\r\n        crate_check_cfg: Default::default(),\r\n    };\r\n\r\n    interface::run_compiler(config, |compiler| Ok(()))\r\n}\r\n\r\nfn main() {\r\n    let out = process::Command::new(\"rustc\")\r\n        .arg(\"--print=sysroot\")\r\n        .current_dir(\".\")\r\n        .output()\r\n        .unwrap();\r\n    let sysroot = str::from_utf8(&out.stdout).unwrap().trim();\r\n    let mut args = env::args_os()\r\n        .enumerate()\r\n        .map(|(i, arg)| {\r\n            arg.into_string()\r\n                .unwrap_or_else(|arg| format!(\"argument {} is not valid Unicode: {:?}\", i, arg))\r\n        })\r\n        .collect::<Vec<_>>();\r\n    args.push(\"--sysroot\".into());\r\n    args.push(sysroot.into());\r\n    if let Err(e) = run_compiler(&args) {\r\n        println!(\"{:?}\", e);\r\n    }\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0-nightly (34a6cae28 2022-08-09)\r\nbinary: rustc\r\ncommit-hash: 34a6cae28e7013ff0e640026a8e46f315426829d\r\ncommit-date: 2022-08-09\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.65.0-nightly\r\nLLVM version: 14.0.6\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n=================================================================\r\n==2174334==ERROR: LeakSanitizer: detected memory leaks\r\n\r\nDirect leak of 2848 byte(s) in 2 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n\r\nIndirect leak of 20477 byte(s) in 19 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n\r\nIndirect leak of 560 byte(s) in 2 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n    #2 0x7f2f7dcec297  (<unknown module>)\r\n\r\nIndirect leak of 71 byte(s) in 1 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n    #2 0x6080000043bf  (<unknown module>)\r\n    #3 0x7f2f7dcec327  (<unknown module>)\r\n\r\nIndirect leak of 25 byte(s) in 1 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n    #2 0x61b00001187f  (<unknown module>)\r\n\r\nIndirect leak of 25 byte(s) in 1 object(s) allocated from:\r\n    #0 0x55d3db1c8eee  (/home/tric/codebase/invoker2/test/target/debug/invoker2+0x81eee) (BuildId: 479c9c7cb2cc6d57950aea5f023db8ac6245a09e)\r\n    #1 0x7f2f824120e7  (/home/tric/codebase/invoker2/test/target/debug/libLLVM-14-rust-1.65.0-nightly.so+0x23220e7)\r\n    #2 0x61b00001117f  (<unknown module>)\r\n\r\nSUMMARY: AddressSanitizer: 24006 byte(s) leaked in 26 allocation(s).\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\nHere's the log of `valgrind --tool=memcheck --leak-check=full`.\r\n<details><summary><strong>Valgrind</strong></summary>\r\n<p>\r\n\r\n```\r\n==2176649== Memcheck, a memory error detector\r\n==2176649== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==2176649== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==2176649== Command: ./invoker2\r\n==2176649== \r\n--2176649-- WARNING: Serious error when reading debug info\r\n--2176649-- When reading debug info from /home/tric/codebase/invoker2/test/target/debug/lib/libstd-1d51e5d3b7e10e45.so:\r\n--2176649-- Ignoring non-Dwarf2/3/4 block in .debug_info\r\n--2176649-- WARNING: Serious error when reading debug info\r\n--2176649-- When reading debug info from /home/tric/codebase/invoker2/test/target/debug/lib/libstd-1d51e5d3b7e10e45.so:\r\n--2176649-- parse_CU_Header: is neither DWARF2 nor DWARF3 nor DWARF4\r\n==2176649== Syscall param statx(file_name) points to unaddressable byte(s)\r\n==2176649==    at 0x877588E: statx (statx.c:29)\r\n==2176649==    by 0x855A64B: statx (weak.rs:176)\r\n==2176649==    by 0x855A64B: std::sys::unix::fs::try_statx (fs.rs:161)\r\n==2176649==    by 0x855358D: std::sys::unix::fs::lstat (fs.rs:1430)\r\n==2176649==    by 0x6C5DDA4: _RNvNtCsgHufEcNId2d_13rustc_session6config21build_session_options (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x12B789: invoker2::run_compiler (main.rs:19)\r\n==2176649==    by 0x12C06D: invoker2::main (main.rs:62)\r\n==2176649==    by 0x12CB4A: core::ops::function::FnOnce::call_once (function.rs:248)\r\n==2176649==    by 0x15E85D: std::sys_common::backtrace::__rust_begin_short_backtrace (backtrace.rs:122)\r\n==2176649==    by 0x147990: std::rt::lang_start::{{closure}} (rt.rs:145)\r\n==2176649==    by 0x852D159: call_once<(), (dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe)> (function.rs:280)\r\n==2176649==    by 0x852D159: do_call<&(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe), i32> (panicking.rs:492)\r\n==2176649==    by 0x852D159: try<i32, &(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe)> (panicking.rs:456)\r\n==2176649==    by 0x852D159: catch_unwind<&(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe), i32> (panic.rs:137)\r\n==2176649==    by 0x852D159: {closure#2} (rt.rs:128)\r\n==2176649==    by 0x852D159: do_call<std::rt::lang_start_internal::{closure_env#2}, isize> (panicking.rs:492)\r\n==2176649==    by 0x852D159: try<isize, std::rt::lang_start_internal::{closure_env#2}> (panicking.rs:456)\r\n==2176649==    by 0x852D159: catch_unwind<std::rt::lang_start_internal::{closure_env#2}, isize> (panic.rs:137)\r\n==2176649==    by 0x852D159: std::rt::lang_start_internal (rt.rs:128)\r\n==2176649==    by 0x14795F: std::rt::lang_start (rt.rs:144)\r\n==2176649==    by 0x12C14B: main (in /home/tric/codebase/invoker2/test/target/debug/invoker2)\r\n==2176649==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\r\n==2176649== \r\n==2176649== Syscall param statx(buf) points to unaddressable byte(s)\r\n==2176649==    at 0x877588E: statx (statx.c:29)\r\n==2176649==    by 0x855A64B: statx (weak.rs:176)\r\n==2176649==    by 0x855A64B: std::sys::unix::fs::try_statx (fs.rs:161)\r\n==2176649==    by 0x855358D: std::sys::unix::fs::lstat (fs.rs:1430)\r\n==2176649==    by 0x6C5DDA4: _RNvNtCsgHufEcNId2d_13rustc_session6config21build_session_options (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x12B789: invoker2::run_compiler (main.rs:19)\r\n==2176649==    by 0x12C06D: invoker2::main (main.rs:62)\r\n==2176649==    by 0x12CB4A: core::ops::function::FnOnce::call_once (function.rs:248)\r\n==2176649==    by 0x15E85D: std::sys_common::backtrace::__rust_begin_short_backtrace (backtrace.rs:122)\r\n==2176649==    by 0x147990: std::rt::lang_start::{{closure}} (rt.rs:145)\r\n==2176649==    by 0x852D159: call_once<(), (dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe)> (function.rs:280)\r\n==2176649==    by 0x852D159: do_call<&(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe), i32> (panicking.rs:492)\r\n==2176649==    by 0x852D159: try<i32, &(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe)> (panicking.rs:456)\r\n==2176649==    by 0x852D159: catch_unwind<&(dyn core::ops::function::Fn<(), Output=i32> + core::marker::Sync + core::panic::unwind_safe::RefUnwindSafe), i32> (panic.rs:137)\r\n==2176649==    by 0x852D159: {closure#2} (rt.rs:128)\r\n==2176649==    by 0x852D159: do_call<std::rt::lang_start_internal::{closure_env#2}, isize> (panicking.rs:492)\r\n==2176649==    by 0x852D159: try<isize, std::rt::lang_start_internal::{closure_env#2}> (panicking.rs:456)\r\n==2176649==    by 0x852D159: catch_unwind<std::rt::lang_start_internal::{closure_env#2}, isize> (panic.rs:137)\r\n==2176649==    by 0x852D159: std::rt::lang_start_internal (rt.rs:128)\r\n==2176649==    by 0x14795F: std::rt::lang_start (rt.rs:144)\r\n==2176649==    by 0x12C14B: main (in /home/tric/codebase/invoker2/test/target/debug/invoker2)\r\n==2176649==  Address 0x0 is not stack'd, malloc'd or (recently) free'd\r\n==2176649== \r\n==2176649== Thread 2 rustc:\r\n==2176649== Mismatched free() / delete / delete []\r\n==2176649==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0x6B26AF1: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649==    by 0x14B8B8: scoped_tls::ScopedKey<T>::set (lib.rs:137)\r\n==2176649==    by 0x14241A: rustc_span::create_session_globals_then (lib.rs:112)\r\n==2176649==  Address 0xdb19380 is 0 bytes inside a block of size 31 alloc'd\r\n==2176649==    at 0x483BE63: operator new(unsigned long) (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0xB92A8DC: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >::reserve(unsigned long) (basic_string.tcc:293)\r\n==2176649==    by 0xBB954C4: std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > llvm::detail::join_impl<llvm::StringRef*>(llvm::StringRef*, llvm::StringRef*, llvm::StringRef, std::forward_iterator_tag) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0xBB94D4B: llvm::Triple::normalize[abi:cxx11](llvm::StringRef) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0x6B26AB9: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649== \r\n==2176649== Mismatched free() / delete / delete []\r\n==2176649==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0x6B26E56: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649==    by 0x14B8B8: scoped_tls::ScopedKey<T>::set (lib.rs:137)\r\n==2176649==    by 0x14241A: rustc_span::create_session_globals_then (lib.rs:112)\r\n==2176649==  Address 0xdb194a0 is 0 bytes inside a block of size 25 alloc'd\r\n==2176649==    at 0x483BE63: operator new(unsigned long) (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0xB0812CA: llvm::Twine::str[abi:cxx11]() const (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0xB6A8145: llvm::Triple::Triple(llvm::Twine const&) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0x6B26DFF: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649== \r\n==2176649== Mismatched free() / delete / delete []\r\n==2176649==    at 0x483CA3F: free (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0x6B26EC6: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649==    by 0x14B8B8: scoped_tls::ScopedKey<T>::set (lib.rs:137)\r\n==2176649==    by 0x14241A: rustc_span::create_session_globals_then (lib.rs:112)\r\n==2176649==  Address 0xdb193e0 is 0 bytes inside a block of size 25 alloc'd\r\n==2176649==    at 0x483BE63: operator new(unsigned long) (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0xB0813B4: llvm::Twine::str[abi:cxx11]() const (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0xB6A8145: llvm::Triple::Triple(llvm::Twine const&) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0x6B26AD7: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649== \r\n==2176649== \r\n==2176649== HEAP SUMMARY:\r\n==2176649==     in use at exit: 328,145 bytes in 2,980 blocks\r\n==2176649==   total heap usage: 6,765 allocs, 3,785 frees, 1,125,688 bytes allocated\r\n==2176649== \r\n==2176649== Thread 1:\r\n==2176649== 12,003 (1,424 direct, 10,579 indirect) bytes in 1 blocks are definitely lost in loss record 2,972 of 2,977\r\n==2176649==    at 0x483BE63: operator new(unsigned long) (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0xBB23DAE: llvm::RegisterTargetMachine<llvm::X86TargetMachine>::Allocator(llvm::Target const&, llvm::Triple const&, llvm::StringRef, llvm::StringRef, llvm::TargetOptions const&, llvm::Optional<llvm::Reloc::Model>, llvm::Optional<llvm::CodeModel::Model>, llvm::CodeGenOpt::Level, bool) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0x6B26E35: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F67E: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649==    by 0x14B8B8: scoped_tls::ScopedKey<T>::set (lib.rs:137)\r\n==2176649== \r\n==2176649== 12,003 (1,424 direct, 10,579 indirect) bytes in 1 blocks are definitely lost in loss record 2,973 of 2,977\r\n==2176649==    at 0x483BE63: operator new(unsigned long) (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==2176649==    by 0xBB23DAE: llvm::RegisterTargetMachine<llvm::X86TargetMachine>::Allocator(llvm::Target const&, llvm::Triple const&, llvm::StringRef, llvm::StringRef, llvm::TargetOptions const&, llvm::Optional<llvm::Reloc::Model>, llvm::Optional<llvm::CodeModel::Model>, llvm::CodeGenOpt::Level, bool) (in /home/tric/codebase/invoker2/test/target/debug/lib/libLLVM-14-rust-1.65.0-nightly.so)\r\n==2176649==    by 0x6B26E35: LLVMRustCreateTargetMachine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B267EA: _RNCNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write22target_machine_factory0B7_ (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6B263D0: _RNvNtNtCs3dyaHbfeQ3u_18rustc_codegen_llvm4back5write35create_informational_target_machine (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759E21: _RNvNtCs3dyaHbfeQ3u_18rustc_codegen_llvm9llvm_util15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x6759DEE: _RNvXs5_Cs3dyaHbfeQ3u_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCs1C19M0O5Eu8_17rustc_codegen_ssa6traits7backend14CodegenBackend15target_features (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681F700: _RNvNtCsclqcKDHWTRY_15rustc_interface4util17add_configuration (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x681E415: _RNvNtCsclqcKDHWTRY_15rustc_interface4util14create_session (in /home/tric/codebase/invoker2/test/target/debug/lib/librustc_driver-950cb4c9aa916d94.so)\r\n==2176649==    by 0x15A110: rustc_interface::interface::create_compiler_and_run (interface.rs:283)\r\n==2176649==    by 0x159C02: rustc_interface::interface::run_compiler::{{closure}} (interface.rs:339)\r\n==2176649==    by 0x14B8B8: scoped_tls::ScopedKey<T>::set (lib.rs:137)\r\n==2176649== \r\n==2176649== LEAK SUMMARY:\r\n==2176649==    definitely lost: 2,848 bytes in 2 blocks\r\n==2176649==    indirectly lost: 21,158 bytes in 24 blocks\r\n==2176649==      possibly lost: 0 bytes in 0 blocks\r\n==2176649==    still reachable: 304,139 bytes in 2,954 blocks\r\n==2176649==         suppressed: 0 bytes in 0 blocks\r\n==2176649== Reachable blocks (those to which a pointer was found) are not shown.\r\n==2176649== To see them, rerun with: --leak-check=full --show-leak-kinds=all\r\n==2176649== \r\n==2176649== For lists of detected and suppressed errors, rerun with: -s\r\n==2176649== ERROR SUMMARY: 10 errors from 7 contexts (suppressed: 0 from 0)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100558/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100558/timeline", "performed_via_github_app": null, "state_reason": null}