{"url": "https://api.github.com/repos/rust-lang/rust/issues/18068", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18068/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18068/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18068/events", "html_url": "https://github.com/rust-lang/rust/issues/18068", "id": 45889980, "node_id": "MDU6SXNzdWU0NTg4OTk4MA==", "number": 18068, "title": "ICE handling an error in a test assertion within a module hierarchy", "user": {"login": "milibopp", "id": 3098430, "node_id": "MDQ6VXNlcjMwOTg0MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/3098430?v=4", "gravatar_id": "", "url": "https://api.github.com/users/milibopp", "html_url": "https://github.com/milibopp", "followers_url": "https://api.github.com/users/milibopp/followers", "following_url": "https://api.github.com/users/milibopp/following{/other_user}", "gists_url": "https://api.github.com/users/milibopp/gists{/gist_id}", "starred_url": "https://api.github.com/users/milibopp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/milibopp/subscriptions", "organizations_url": "https://api.github.com/users/milibopp/orgs", "repos_url": "https://api.github.com/users/milibopp/repos", "events_url": "https://api.github.com/users/milibopp/events{/privacy}", "received_events_url": "https://api.github.com/users/milibopp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-10-15T16:36:15Z", "updated_at": "2014-10-15T16:51:31Z", "closed_at": "2014-10-15T16:51:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I ran across this issue in a project of mine and reduced it down to this piece of code\n\n``` rust\nmod bla {\n    static a: int = 8;\n    static b: int = 15;\n\n    pub struct Blah {\n        n: int,\n    }\n\n    #[cfg(test)]\n    mod test {\n        #[test]\n        fn blah() {\n            assert!(4, 4);\n        }\n    }\n}\n```\n\nThe `assert!` was supposed to be an `assert_eq!` but the compiler (nightly from [here](http://pkgbuild.com/~thestinger)) did not correctly handle this mistake, see the output at the end. Interestingly, reducing the code by any item in there (for instance removing one of the statics) makes the problem disappear for me.\n\nOutput from `env RUST_BACKTRACE=1 rustc minimal.rs --test`:\n\n```\n<std macros>:8:12: 13:22 error: mismatched types: expected `bool`, found `<generic integer #0>` (expected bool, found integral variable)\n<std macros>:8         if !$cond {\n<std macros>:9             fail!($($arg),+)\n<std macros>:10         }\n<std macros>:11     );\n<std macros>:12 )\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'index out of bounds: the len is 12 but the index is 12', /build/rust-git/src/rust/src/libsyntax/lib.rs:1\n\nstack backtrace:\n   1:     0x7fba2c8ab170 - rt::backtrace::imp::write::ha825cce1cddc389agDq\n   2:     0x7fba2c8ae2a0 - <unknown>\n   3:     0x7fba30e73fc0 - unwind::begin_unwind_inner::h01acaf0722d3a0dcGxd\n   4:     0x7fba30e73b00 - unwind::begin_unwind_fmt::hd77050bbaff40fbf8ud\n   5:     0x7fba30e73ac0 - rust_begin_unwind\n   6:     0x7fba30eb8870 - failure::fail_fmt::hcf9a19210f91bcb2iqk\n   7:     0x7fba30eb8710 - failure::fail_bounds_check::h3e0462beb4b0994bRok\n   8:     0x7fba2d8357f0 - codemap::FileMap::get_line::h3251902685d7d1fcuEE\n   9:     0x7fba2d869f00 - <unknown>\n  10:     0x7fba2d867170 - diagnostic::EmitterWriter.Emitter::emit::h4f620ecc0b6e25d1cbG\n  11:     0x7fba2d831f90 - diagnostic::SpanHandler::span_err::h904c17bb08755141GHF\n  12:     0x7fba31953130 - middle::typeck::infer::InferCtxt<'a, 'tcx>::type_error_message_str_with_expected::h28e241d9792db621rqe\n  13:     0x7fba319d1a80 - middle::typeck::infer::InferCtxt<'a, 'tcx>::type_error_message::h2f89a7fa9535606dKwe\n  14:     0x7fba319577f0 - middle::typeck::check::demand::suptype::h26116ec44ed362a8XDP\n  15:     0x7fba319e2230 - <unknown>\n  16:     0x7fba319d6af0 - <unknown>\n  17:     0x7fba319d6af0 - <unknown>\n  18:     0x7fba31a26e80 - middle::typeck::check::check_stmt::heda85553c2fd1ae2HzY\n  19:     0x7fba319a2d00 - <unknown>\n  20:     0x7fba3199ed80 - <unknown>\n  21:     0x7fba3199eac0 - <unknown>\n  22:     0x7fba3199a400 - middle::typeck::check::check_item::heedcea379da809f9qpT\n  23:     0x7fba3199cdc0 - <unknown>\n  24:     0x7fba3199cdc0 - <unknown>\n  25:     0x7fba3199e590 - middle::typeck::check::check_item_types::hfb0ce29ab63b752dJ4S\n  26:     0x7fba314b97f0 - <unknown>\n  27:     0x7fba31c53f70 - middle::typeck::check_crate::h60d0dea4982ab4b3LVk\n  28:     0x7fba31cbaf10 - driver::driver::phase_3_run_analysis_passes::h6903d2aabf420ba3Evx\n  29:     0x7fba31cb5670 - driver::driver::compile_input::hc12755189cb69b42qcx\n  30:     0x7fba31d3f350 - <unknown>\n  31:     0x7fba31d3f200 - <unknown>\n  32:     0x7fba314d3300 - <unknown>\n  33:     0x7fba314d30e0 - <unknown>\n  34:     0x7fba311b7120 - <unknown>\n  35:     0x7fba30ec6930 - <unknown>\n  36:     0x7fba30ec6920 - rust_try\n  37:     0x7fba30e71880 - unwind::try::hf9c599c9be5283d3omd\n  38:     0x7fba30e71700 - task::Task::run::h0d53feb23e600be92Bc\n  39:     0x7fba311b6e60 - <unknown>\n  40:     0x7fba30e72fd0 - <unknown>\n  41:     0x7fba2bc54250 - start_thread\n  42:     0x7fba30b4c3b9 - clone\n  43:                0x0 - <unknown>\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18068/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18068/timeline", "performed_via_github_app": null, "state_reason": "completed"}