{"url": "https://api.github.com/repos/rust-lang/rust/issues/83281", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83281/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83281/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83281/events", "html_url": "https://github.com/rust-lang/rust/issues/83281", "id": 835267328, "node_id": "MDU6SXNzdWU4MzUyNjczMjg=", "number": 83281, "title": "AVR: u32 and u64 behaves like u16 and u32", "user": {"login": "ThisIsRex", "id": 49415741, "node_id": "MDQ6VXNlcjQ5NDE1NzQx", "avatar_url": "https://avatars.githubusercontent.com/u/49415741?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThisIsRex", "html_url": "https://github.com/ThisIsRex", "followers_url": "https://api.github.com/users/ThisIsRex/followers", "following_url": "https://api.github.com/users/ThisIsRex/following{/other_user}", "gists_url": "https://api.github.com/users/ThisIsRex/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThisIsRex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThisIsRex/subscriptions", "organizations_url": "https://api.github.com/users/ThisIsRex/orgs", "repos_url": "https://api.github.com/users/ThisIsRex/repos", "events_url": "https://api.github.com/users/ThisIsRex/events{/privacy}", "received_events_url": "https://api.github.com/users/ThisIsRex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1884641928, "node_id": "MDU6TGFiZWwxODg0NjQxOTI4", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AVR", "name": "O-AVR", "color": "6e6ec0", "default": false, "description": "Target: AVR processors (ATtiny, ATmega, etc.)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-18T21:13:43Z", "updated_at": "2022-05-24T14:42:00Z", "closed_at": "2022-05-24T14:42:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "I found out that i32 and u32 behaves like i16 and u16\r\nAnd i64 and u64 like i32 and u32\r\n\r\nI wrote the following code to represent the problem:\r\n```let mut counter_u16 = 0u16;\r\nlet mut counter_u32 = 0u32;\r\nlet mut counter_u64 = 0u64;\r\nlet mut counter_u64_2 = 0u64;\r\n\r\nloop {\r\n\tdelay_ms(1000);\r\n\r\n\tcounter_u16 = counter_u16.wrapping_add(10000);\r\n\tcounter_u32 = counter_u32.wrapping_add(10000);\r\n\tcounter_u64 = counter_u64.wrapping_add(10000);\r\n\tcounter_u64_2 = counter_u64_2.wrapping_add(1_000_000_000);\r\n\r\n\tufmt::uwriteln!(&mut serial, \"u16: {}\", counter_u16).void_unwrap();\r\n\tufmt::uwriteln!(&mut serial, \"u32: {}\", counter_u32).void_unwrap(); //overflow after 65535\r\n\tufmt::uwriteln!(&mut serial, \"u64>2^16?: {}\", counter_u64 > 65535).void_unwrap();\r\n\tufmt::uwriteln!(&mut serial, \"u64>2^32?: {}\", counter_u64 > 4294967295).void_unwrap(); //overflow after 4294967295\r\n\r\n        //FLASH ERROR\r\n        ufmt::uwriteln!(&mut serial, \"u64: {}\", counter_u64).void_unwrap();\r\n}\r\n```\r\n\r\nAlso if i'll write the code for displaying u64, avr-gcc can't flash the .elf file:\r\n\r\n```\r\nerror: linking with `avr-gcc` failed: exit code: 1\r\n  |\r\n  = note: \"avr-gcc\" \"-mmcu=atmega328p\" \"-Wl,--as-needed\" \"-L\" \"C:\\\\Users\\\\Admin\\\\.rustup\\\\toolchains\\\\nightly-2021-01-07-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\avr-atmega328p\\\\lib\" \"O:\\\\R\\\\Coding\\\\Rust\\\\test-proj\\\\target\\\\avr-atmega328p\\\\debug\\\\deps\\\\test-proj-6349af4f4221cee8.panic_halt-db131e4b002c16b4.panic_halt.7laydq1v-cgu.0.rcgu.o.rcgu.o\" \"-o\" \"O:\\\\R\\\\Coding\\\\Rust\\\\test-proj\\\\target\\\\avr-atmega328p\\\\debug\\\\deps\\\\test-proj-6349af4f4221cee8.elf\" \"-Wl,--gc-sections\" \"-L\" \"O:\\\\R\\\\Coding\\\\Rust\\\\test-proj\\\\target\\\\avr-atmega328p\\\\debug\\\\deps\" \"-L\" \"O:\\\\R\\\\Coding\\\\Rust\\\\test-proj\\\\target\\\\debug\\\\deps\" \"-L\" \"C:\\\\Users\\\\Admin\\\\.rustup\\\\toolchains\\\\nightly-2021-01-07-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\avr-atmega328p\\\\lib\" \"-Wl,--start-group\" \"-Wl,--end-group\" \"-Wl,-Bstatic\" \"O:\\\\R\\\\Coding\\\\Rust\\\\test-proj\\\\target\\\\avr-atmega328p\\\\debug\\\\deps\\\\libcompiler_builtins-e902a06b00d14d7b.rlib\" \"-Wl,-Bdynamic\" \"-lgcc\"\r\n  = note: O:\\R\\Coding\\Rust\\test-proj\\target\\avr-atmega328p\\debug\\deps\\libcompiler_builtins-e902a06b00d14d7b.rlib(compiler_builtins-e902a06b00d14d7b.compiler_builtins.6kkuomye-cgu.7.rcgu.o): In function `compiler_builtins::int::shift::Ashl::ashl::h9dce3f4bd92dda5f':\r\n          C:\\Users\\Admin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.36\\src\\int\\shift.rs:(.text._ZN17compiler_builtins3int5shift4Ashl4ashl17h9dce3f4bd92dda5fE+0x150): undefined reference to `core::panicking::panic::hf53d0fffb6d21a9a'\r\n          O:\\R\\Coding\\Rust\\test-proj\\target\\avr-atmega328p\\debug\\deps\\libcompiler_builtins-e902a06b00d14d7b.rlib(compiler_builtins-e902a06b00d14d7b.compiler_builtins.6kkuomye-cgu.7.rcgu.o): In function `compiler_builtins::int::shift::Ashl::ashl::hceca1513a0a8cd5c':\r\n          C:\\Users\\Admin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.36\\src\\int\\shift.rs:(.text._ZN17compiler_builtins3int5shift4Ashl4ashl17hceca1513a0a8cd5cE+0x198): undefined reference to `core::panicking::panic::hf53d0fffb6d21a9a'\r\n          O:\\R\\Coding\\Rust\\test-proj\\target\\avr-atmega328p\\debug\\deps\\libcompiler_builtins-e902a06b00d14d7b.rlib(compiler_builtins-e902a06b00d14d7b.compiler_builtins.6kkuomye-cgu.7.rcgu.o): In function `compiler_builtins::int::shift::Lshr::lshr::h6706166a532fb8de':\r\n          C:\\Users\\Admin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.36\\src\\int\\shift.rs:(.text._ZN17compiler_builtins3int5shift4Lshr4lshr17h6706166a532fb8deE+0x1f8): undefined reference to `core::panicking::panic::hf53d0fffb6d21a9a'\r\n          O:\\R\\Coding\\Rust\\test-proj\\target\\avr-atmega328p\\debug\\deps\\libcompiler_builtins-e902a06b00d14d7b.rlib(compiler_builtins-e902a06b00d14d7b.compiler_builtins.6kkuomye-cgu.1.rcgu.o): In function `compiler_builtins::int::specialized_div_rem::u64_div_rem::h60f8b0912293273a':\r\n          C:\\Users\\Admin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.36\\src\\int\\specialized_div_rem\\delegate.rs:(.text._ZN17compiler_builtins3int19specialized_div_rem11u64_div_rem17h60f8b0912293273aE+0x125c): undefined reference to `core::panicking::panic::hf53d0fffb6d21a9a'\r\n          O:\\R\\Coding\\Rust\\test-proj\\target\\avr-atmega328p\\debug\\deps\\libcompiler_builtins-e902a06b00d14d7b.rlib(compiler_builtins-e902a06b00d14d7b.compiler_builtins.6kkuomye-cgu.1.rcgu.o): In function `compiler_builtins::int::specialized_div_rem::u32_div_rem::h9023690cd40b9b7f':\r\n          C:\\Users\\Admin\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.36\\src\\int\\specialized_div_rem\\norm_shift.rs:(.text._ZN17compiler_builtins3int19specialized_div_rem11u32_div_rem17h9023690cd40b9b7fE+0x718): undefined reference to `core::panicking::panic::hf53d0fffb6d21a9a'\r\n          collect2.exe: error: ld returned 1 exit status\r\n\r\n\r\nerror: aborting due to previous error; 38 warnings emitted\r\n\r\nerror: could not compile `test-proj`\r\n\r\n```\r\n\r\nI use `nightly-2021-01-07` version because a newer one fails with `Not supported instr` error", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83281/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83281/timeline", "performed_via_github_app": null, "state_reason": "completed"}