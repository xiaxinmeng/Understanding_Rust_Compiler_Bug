{"url": "https://api.github.com/repos/rust-lang/rust/issues/26046", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26046/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26046/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26046/events", "html_url": "https://github.com/rust-lang/rust/issues/26046", "id": 85670307, "node_id": "MDU6SXNzdWU4NTY3MDMwNw==", "number": 26046, "title": "Opaque error message when typechecking closure", "user": {"login": "rozbb", "id": 752802, "node_id": "MDQ6VXNlcjc1MjgwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/752802?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rozbb", "html_url": "https://github.com/rozbb", "followers_url": "https://api.github.com/users/rozbb/followers", "following_url": "https://api.github.com/users/rozbb/following{/other_user}", "gists_url": "https://api.github.com/users/rozbb/gists{/gist_id}", "starred_url": "https://api.github.com/users/rozbb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rozbb/subscriptions", "organizations_url": "https://api.github.com/users/rozbb/orgs", "repos_url": "https://api.github.com/users/rozbb/repos", "events_url": "https://api.github.com/users/rozbb/events{/privacy}", "received_events_url": "https://api.github.com/users/rozbb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2015-06-06T01:22:02Z", "updated_at": "2017-06-08T11:05:18Z", "closed_at": "2017-06-08T11:05:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "**UPDATE:** Mentoring instructions found [in this comment below](https://github.com/rust-lang/rust/issues/26046#issuecomment-305868200).\r\n\r\n----\r\n\r\nThe following code fails because the closure moves out of `vec`, and anything implementing `Fn` only gets a reference to its environment (i.e can't move `self`)\r\n\r\n``` rust\r\nfn get_closure() -> Box<Fn() -> Vec<u8>> {\r\n    let vec = vec![1u8, 2u8];\r\n\r\n    let closure = move || {\r\n        vec\r\n    };\r\n\r\n    Box::new(closure)\r\n}\r\n```\r\n\r\nA simple fix that would allow the closure to properly implement `Fn` is to replace `vec` with `vec.clone()` inside the closure. The error message, however, is of no help:\r\n\r\n```\r\nerror: the trait `core::ops::Fn<()>` is not implemented for the type `[closure <anon>:6:24: 8:6]` [E0277]\r\n<line #> Box::new(closure)\r\n         ^~~~~~~~~~~~~~~~~\r\n```\r\n\r\nIn cases where the closure is more complex than this trivial example, the error message is no more descriptive than above, making it much more difficult to debug.\r\n\r\nI would like to see something more along the lines of:\r\n\r\n```\r\nerror: the trait `core::ops::Fn<()>` is not implemented for the type `[closure <anon>:6:24: 8:6]`\r\n<line #> note: closure moves out of environment: vec\r\n                                                 ^~~\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26046/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26046/timeline", "performed_via_github_app": null, "state_reason": "completed"}