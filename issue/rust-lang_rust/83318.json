{"url": "https://api.github.com/repos/rust-lang/rust/issues/83318", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83318/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83318/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83318/events", "html_url": "https://github.com/rust-lang/rust/issues/83318", "id": 836760799, "node_id": "MDU6SXNzdWU4MzY3NjA3OTk=", "number": 83318, "title": "Migration for or patterns", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 419557634, "node_id": "MDU6TGFiZWw0MTk1NTc2MzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-medium", "name": "E-medium", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Medium / intermediate"}, {"id": 1506199886, "node_id": "MDU6TGFiZWwxNTA2MTk5ODg2", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-or_patterns", "name": "F-or_patterns", "color": "f9c0cc", "default": false, "description": "`#![feature(or_patterns)]`"}], "state": "closed", "locked": false, "assignee": {"login": "hi-rustin", "id": 29879298, "node_id": "MDQ6VXNlcjI5ODc5Mjk4", "avatar_url": "https://avatars.githubusercontent.com/u/29879298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hi-rustin", "html_url": "https://github.com/hi-rustin", "followers_url": "https://api.github.com/users/hi-rustin/followers", "following_url": "https://api.github.com/users/hi-rustin/following{/other_user}", "gists_url": "https://api.github.com/users/hi-rustin/gists{/gist_id}", "starred_url": "https://api.github.com/users/hi-rustin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hi-rustin/subscriptions", "organizations_url": "https://api.github.com/users/hi-rustin/orgs", "repos_url": "https://api.github.com/users/hi-rustin/repos", "events_url": "https://api.github.com/users/hi-rustin/events{/privacy}", "received_events_url": "https://api.github.com/users/hi-rustin/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "hi-rustin", "id": 29879298, "node_id": "MDQ6VXNlcjI5ODc5Mjk4", "avatar_url": "https://avatars.githubusercontent.com/u/29879298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hi-rustin", "html_url": "https://github.com/hi-rustin", "followers_url": "https://api.github.com/users/hi-rustin/followers", "following_url": "https://api.github.com/users/hi-rustin/following{/other_user}", "gists_url": "https://api.github.com/users/hi-rustin/gists{/gist_id}", "starred_url": "https://api.github.com/users/hi-rustin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hi-rustin/subscriptions", "organizations_url": "https://api.github.com/users/hi-rustin/orgs", "repos_url": "https://api.github.com/users/hi-rustin/repos", "events_url": "https://api.github.com/users/hi-rustin/events{/privacy}", "received_events_url": "https://api.github.com/users/hi-rustin/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2021-03-20T09:06:40Z", "updated_at": "2021-04-02T17:38:57Z", "closed_at": "2021-04-02T17:38:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "As part of the `|` patterns work ([tracking issue]), we plan to change the meaning of the `$x:pat` matcher in macros within the 2021 Edition. The current plan of record is:\r\n\r\n* The `pat2015` matcher will match legacy patterns, which exclude the `|` character.\r\n* The `pat2021` matcher will match new patterns, which include the `|` character.\r\n* The `pat` matcher will be equivalent to `pat2021` from Rust 2021 forward, and equivalent to `pat2015` on older editions, since past crater runs (e.g., [1] and [2]) found significant and complex breakage from just changing `pat` to `pat2021` uniformly.\r\n\r\n[tracking issue]: https://github.com/rust-lang/rust/issues/54883\r\n[1]: https://github.com/rust-lang/rust/pull/78935#issuecomment-735050394\r\n[2]: https://github.com/rust-lang/rust/pull/78935#issuecomment-740696077\r\n\r\nThe goal of this issue is to issue a useful lint that suggests that converting `$x:pat` to `$x:pat2015` if converting to Rust 2021 could cause breakage. We don't want to do this for *all* `$x:pat` usages, however, because the vast majority would benefit from being `$x:pat2021`. \r\n\r\n### Examples where lint should trigger\r\n\r\nHere is an example of a macro that we DO want to convert ([source](https://github.com/JonasJebing/rust_match_any/blob/0fa72c02d4211b4edd513fc8d53f98a40caf9aca/src/lib.rs#L104-L113)):\r\n\r\n```rust\r\n#[macro_export]\r\nmacro_rules! match_any {\r\n    ( $expr:expr , $( $( $pat:pat )|+ => $expr_arm:expr ),+ ) => {\r\n        match $expr {\r\n            $(\r\n                $( $pat => $expr_arm, )+\r\n            )+\r\n        }\r\n    };\r\n}\r\n```\r\n\r\nHere is another example ([source](https://github.com/ratel-rust/ratel-core/blob/76f1b93e68cb6b0fadd89fddee70ea9084de3b55/core/src/tokenizer.rs#L13-L23)):\r\n\r\n```rust\r\n/// Helper macro for declaring byte-handler functions with correlating constants.\r\n/// This becomes handy due to a lookup table present below.\r\nmacro_rules! define_handlers {\r\n    { $(const $static_name:ident: $name:ident |$tok:pat, $byte:pat| $code:block)* } => {\r\n        $(\r\n            fn $name($tok: &mut Tokenizer, $byte: u8) -> Result<Token> $code\r\n\r\n            const $static_name: fn(&mut Tokenizer, u8) -> Result<Token> = $name;\r\n        )*\r\n    }\r\n}\r\n```\r\n\r\n\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"hi-rustin\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83318/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83318/timeline", "performed_via_github_app": null, "state_reason": "completed"}