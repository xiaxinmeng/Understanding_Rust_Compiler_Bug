{"url": "https://api.github.com/repos/rust-lang/rust/issues/91809", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91809/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91809/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91809/events", "html_url": "https://github.com/rust-lang/rust/issues/91809", "id": 1077643365, "node_id": "I_kwDOAAsO6M5AO4hl", "number": 91809, "title": "Regression in compile time when optimizing for size", "user": {"login": "crawford", "id": 368848, "node_id": "MDQ6VXNlcjM2ODg0OA==", "avatar_url": "https://avatars.githubusercontent.com/u/368848?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crawford", "html_url": "https://github.com/crawford", "followers_url": "https://api.github.com/users/crawford/followers", "following_url": "https://api.github.com/users/crawford/following{/other_user}", "gists_url": "https://api.github.com/users/crawford/gists{/gist_id}", "starred_url": "https://api.github.com/users/crawford/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crawford/subscriptions", "organizations_url": "https://api.github.com/users/crawford/orgs", "repos_url": "https://api.github.com/users/crawford/repos", "events_url": "https://api.github.com/users/crawford/events{/privacy}", "received_events_url": "https://api.github.com/users/crawford/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1168029555, "node_id": "MDU6TGFiZWwxMTY4MDI5NTU1", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-hang", "name": "I-hang", "color": "e10c02", "default": false, "description": "Issue: The compiler never terminates, due to infinite loops, deadlock, livelock, etc."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2021-12-11T20:38:04Z", "updated_at": "2022-02-24T11:42:20Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "After updating to Rust 1.57, I'm seeing a huge increase in compilation time for an embedded project that I'm working on. The code is unfortunately not open source, but I'm hoping I can provide enough information here to work around that. If I've forgotten to include anything or made bad assumptions, please let me know.\r\n\r\nI don't have specific numbers for the slowdown because I haven't waiting long enough for the compilation to finish, but I can say that what used to take ~90 seconds for a full build is now taking more than 10 minutes. The project targets thumbv7em-none-eabihf and is optimized for size. Here are the profiles defined in the cargo manifest:\r\n\r\n```toml\r\n[profile.dev]\r\npanic = \"abort\"\r\ncodegen-units = 1\r\ndebug = true\r\nopt-level = \"s\"\r\nlto = false\r\n\r\n[profile.release]\r\npanic = \"abort\"\r\ncodegen-units = 1\r\ndebug = true\r\nlto = true\r\nopt-level = \"s\"\r\n```\r\n\r\nHere's the interesting thing: we have seen no increase in compilation time when building the main binary. It's the tests that are actually exhibiting the behavior. The tests target x86_64-unknown-linux-gnu and are built with `cargo test`. If I remove `opt-level = \"s\"` from the profiles, I'm able to build the tests just as quickly as before.\r\n\r\nI bisected the nightlies and determined that this slowdown seems to have been introduced into nightly-2021-10-14; nightly-2021-10-13 and 1.56.1 don't exhibit this behavior.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91809/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91809/timeline", "performed_via_github_app": null, "state_reason": null}