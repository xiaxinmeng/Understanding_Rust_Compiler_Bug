{"url": "https://api.github.com/repos/rust-lang/rust/issues/46964", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46964/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46964/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46964/events", "html_url": "https://github.com/rust-lang/rust/issues/46964", "id": 284289378, "node_id": "MDU6SXNzdWUyODQyODkzNzg=", "number": 46964, "title": "compiler crash on innocent-looking match", "user": {"login": "idubrov", "id": 434788, "node_id": "MDQ6VXNlcjQzNDc4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/434788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/idubrov", "html_url": "https://github.com/idubrov", "followers_url": "https://api.github.com/users/idubrov/followers", "following_url": "https://api.github.com/users/idubrov/following{/other_user}", "gists_url": "https://api.github.com/users/idubrov/gists{/gist_id}", "starred_url": "https://api.github.com/users/idubrov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/idubrov/subscriptions", "organizations_url": "https://api.github.com/users/idubrov/orgs", "repos_url": "https://api.github.com/users/idubrov/repos", "events_url": "https://api.github.com/users/idubrov/events{/privacy}", "received_events_url": "https://api.github.com/users/idubrov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-23T06:20:44Z", "updated_at": "2018-01-21T15:04:43Z", "closed_at": "2018-01-21T15:04:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "the compiler unexpectedly panicked. this is a bug.\r\n\r\nI tried this code (hyper = \"0.11.9\"):\r\n\r\n```rust\r\nextern crate hyper;\r\n\r\npub fn crash(mime: &hyper::mime::Mime) -> bool {\r\n  match (mime.subtype(), mime.suffix()) {\r\n    (_, Some(hyper::mime::JSON)) => true,\r\n    (hyper::mime::JSON, None) => true,\r\n    _ => false,\r\n  }\r\n}\r\n```\r\n\r\nI expected to see this happen: code compiles (two top branches are incompatible)\r\n\r\nInstead, this happened: compiler crashed; re-ordering two top branches fixes the issue\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.24.0-nightly (5165ee9e2 2017-12-22)\r\nbinary: rustc\r\ncommit-hash: 5165ee9e209e0e70d89946ccbb7e90b9c0c3a7ac\r\ncommit-date: 2017-12-22\r\nhost: x86_64-apple-darwin\r\nrelease: 1.24.0-nightly\r\nLLVM version: 4.0\r\n```\r\n\r\nBacktrace:\r\n\r\n```\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.24.0-nightly (5165ee9e2 2017-12-22) running on x86_64-apple-darwin\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'assertion failed: rows.iter().all(|r| r.len() == v.len())', src/librustc_const_eval/_match.rs:596:4\r\nstack backtrace:\r\n   0:        0x11385781b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h6748dc16a2d8df2e\r\n   1:        0x113866fae - std::sys_common::backtrace::print::hc1ecb1e5559e6c33\r\n   2:        0x113861410 - std::panicking::default_hook::{{closure}}::hb04e69910a65792e\r\n   3:        0x11386110a - std::panicking::default_hook::h1ca336fe29972357\r\n   4:        0x113861876 - std::panicking::rust_panic_with_hook::h02eae9f31985336e\r\n   5:        0x1116feba1 - std::panicking::begin_panic::h0170dac5d8645b28\r\n   6:        0x1116f50fa - rustc_const_eval::_match::is_useful::h23e3cdc562cbb328\r\n   7:        0x1116f62b2 - rustc_const_eval::_match::is_useful_specialized::h3f912ded1cb5a78e\r\n   8:        0x1116e6b7c - <core::iter::Map<I, F> as core::iter::iterator::Iterator>::try_fold::h8379d8eb0a7a9f77\r\n   9:        0x1116f5320 - rustc_const_eval::_match::is_useful::h23e3cdc562cbb328\r\n  10:        0x1116f62b2 - rustc_const_eval::_match::is_useful_specialized::h3f912ded1cb5a78e\r\n  11:        0x1116e6b7c - <core::iter::Map<I, F> as core::iter::iterator::Iterator>::try_fold::h8379d8eb0a7a9f77\r\n  12:        0x1116f5320 - rustc_const_eval::_match::is_useful::h23e3cdc562cbb328\r\n  13:        0x1116f62b2 - rustc_const_eval::_match::is_useful_specialized::h3f912ded1cb5a78e\r\n  14:        0x1116e6b7c - <core::iter::Map<I, F> as core::iter::iterator::Iterator>::try_fold::h8379d8eb0a7a9f77\r\n  15:        0x1116f5320 - rustc_const_eval::_match::is_useful::h23e3cdc562cbb328\r\n  16:        0x1116fcc67 - rustc_const_eval::check_match::check_arms::hf0b2a24697c406ea\r\n  17:        0x1116f4302 - rustc_const_eval::_match::MatchCheckCtxt::create_and_enter::h8ecb2ffcfac97c79\r\n  18:        0x1116fc6f5 - <rustc_const_eval::check_match::MatchVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_expr::h5dc4813f83674f01\r\n  19:        0x1116fc4ee - <rustc_const_eval::check_match::MatchVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_expr::h5dc4813f83674f01\r\n  20:        0x1116fc860 - <rustc_const_eval::check_match::MatchVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_body::h8627b10027254cdf\r\n  21:        0x1116ff24d - rustc::session::Session::track_errors::he6d05d19e503027d\r\n  22:        0x1116fc2a8 - rustc_const_eval::check_match::check_match::h581d60f966dd70ec\r\n  23:        0x112015dee - rustc::dep_graph::graph::DepGraph::with_task_impl::he4debb199688f723\r\n  24:        0x111d3054a - rustc_errors::Handler::track_diagnostics::he3d49a14b2f2a05b\r\n  25:        0x111c209f0 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::h3e96520081b37b2e\r\n  26:        0x11208ad8e - rustc::ty::maps::<impl rustc::ty::maps::queries::check_match<'tcx>>::force::h9b0cabeb54488ef9\r\n  27:        0x11208b46a - rustc::ty::maps::<impl rustc::ty::maps::queries::check_match<'tcx>>::try_get::h168429d15c730e8b\r\n  28:        0x111ec85e0 - rustc::ty::maps::TyCtxtAt::check_match::h1e0137c83b27f485\r\n  29:        0x111c721b3 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::check_match::h395b3ef7e5d51eb3\r\n  30:        0x1116fc029 - rustc::hir::intravisit::Visitor::visit_nested_body::hc3711ac4cbc2ecf6\r\n  31:        0x11170dedf - rustc::hir::Crate::visit_all_item_likes::hafcfad702b50d9ac\r\n  32:        0x1116fc1cf - rustc_const_eval::check_match::check_crate::hfadb55aaa16d50c3\r\n  33:        0x10d3ccbc6 - <std::thread::local::LocalKey<T>>::with::h0f69a10298329fdf\r\n  34:        0x10d3cf7cc - <std::thread::local::LocalKey<T>>::with::hb51817b52c5d173a\r\n  35:        0x10d41c95e - rustc::ty::context::TyCtxt::create_and_enter::h0fc228efc283eb64\r\n  36:        0x10d396952 - rustc_driver::driver::compile_input::h82abb659e9ffafec\r\n  37:        0x10d3f9d6d - rustc_driver::run_compiler::h4102658971d5220d\r\n  38:        0x10d351d31 - std::sys_common::backtrace::__rust_begin_short_backtrace::ha73cd560ba1185a4\r\n  39:        0x1138913ae - __rust_maybe_catch_panic\r\n  40:        0x10d32b84d - <F as alloc::boxed::FnBox<A>>::call_box::h4a09b2de7d586e97\r\n  41:        0x113850247 - std::sys_common::thread::start_thread::h4cededf2a7a0e7f8\r\n  42:        0x11386a688 - std::sys::unix::thread::Thread::new::thread_start::hc0d8e233205f2988\r\n  43:     0x7fff995e293a - _pthread_body\r\n  44:     0x7fff995e2886 - _pthread_start\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46964/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46964/timeline", "performed_via_github_app": null, "state_reason": "completed"}