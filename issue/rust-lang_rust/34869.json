{"url": "https://api.github.com/repos/rust-lang/rust/issues/34869", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34869/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34869/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34869/events", "html_url": "https://github.com/rust-lang/rust/issues/34869", "id": 165948809, "node_id": "MDU6SXNzdWUxNjU5NDg4MDk=", "number": 34869, "title": "Mac - linking error (dyld: Symbol not found: __cg_jpeg_resync_to_restart) in beta but not stable", "user": {"login": "compressed", "id": 28634, "node_id": "MDQ6VXNlcjI4NjM0", "avatar_url": "https://avatars.githubusercontent.com/u/28634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compressed", "html_url": "https://github.com/compressed", "followers_url": "https://api.github.com/users/compressed/followers", "following_url": "https://api.github.com/users/compressed/following{/other_user}", "gists_url": "https://api.github.com/users/compressed/gists{/gist_id}", "starred_url": "https://api.github.com/users/compressed/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compressed/subscriptions", "organizations_url": "https://api.github.com/users/compressed/orgs", "repos_url": "https://api.github.com/users/compressed/repos", "events_url": "https://api.github.com/users/compressed/events{/privacy}", "received_events_url": "https://api.github.com/users/compressed/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-07-16T21:39:10Z", "updated_at": "2018-12-01T09:29:14Z", "closed_at": "2016-07-17T17:15:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "This came up in https://github.com/sgrif/pq-sys/issues/1. It seems when trying to run/test anything using beta or later this crate fails to run (not build) with the below error.\n\nNote: I don't have `DYLD_LIBRARY_PATH` set as an env var anywhere. It seems to be picking up the wrong `libJPEG.dylib` in beta (`/usr/local/lib`) instead of in the OSX library location (`/System/Library/Frameworks/ImageIO.framework/Resources/...`). In part, I believe this to be due do the fact that the `pg-sql` crate is adding `native=/usr/local/lib` via `-L` because that's where the postgresql libraries from homebrew end up being installed. Curiously though, this linking problem **does not** occur on stable, leading me to believe it is resolving to the proper `libJPEG.dylib` instead of the one in `/usr/local/lib`.\n\nRunning OSX 10.11.5.\n\nAlso, not sure if related or not, but I tried the workaround specified in https://github.com/rust-lang/rust/issues/34754, `codegen-units=1`, but it did not eliminate the error.\n\nBeta (or nightly):\n\n```\n~/D/pq-sys git:master \u276f\u276f\u276f rustup override set beta\ninfo: using existing install for 'beta-x86_64-apple-darwin'\ninfo: override toolchain for '/Users/chris/Documents/pq-sys' set to 'beta-x86_64-apple-darwin'\n\n  beta-x86_64-apple-darwin unchanged - rustc 1.11.0-beta.1 (8dc253bcf 2016-07-05)\n\n~/D/pq-sys git:master \u276f\u276f\u276f cargo test --verbose\n   Compiling pq-sys v0.2.1 (file:///Users/chris/Documents/pq-sys)\n   Compiling libc v0.2.14\n     Running `rustc build.rs --crate-name build_script_build --crate-type bin -g --out-dir /Users/chris/Documents/pq-sys/target/debug/build/pq-sys-683de9b8454d5f4b --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps`\n     Running `rustc /Users/chris/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.14/src/lib.rs --crate-name libc --crate-type lib -g --cfg feature=\\\"use_std\\\" --cfg feature=\\\"default\\\" -C metadata=1f3392fe1afd1313 -C extra-filename=-1f3392fe1afd1313 --out-dir /Users/chris/Documents/pq-sys/target/debug/deps --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps --cap-lints allow`\n     Running `/Users/chris/Documents/pq-sys/target/debug/build/pq-sys-683de9b8454d5f4b/build-script-build`\n     Running `rustc src/lib.rs --crate-name pq_sys -g --test -C metadata=5b5cdff68186daa5 -C extra-filename=-5b5cdff68186daa5 --out-dir /Users/chris/Documents/pq-sys/target/debug --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps --extern libc=/Users/chris/Documents/pq-sys/target/debug/deps/liblibc-1f3392fe1afd1313.rlib -L native=/usr/local/lib`\n     Running `rustc src/lib.rs --crate-name pq_sys --crate-type lib -g --out-dir /Users/chris/Documents/pq-sys/target/debug --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps --extern libc=/Users/chris/Documents/pq-sys/target/debug/deps/liblibc-1f3392fe1afd1313.rlib -L native=/usr/local/lib`\n     Running `/Users/chris/Documents/pq-sys/target/debug/pq_sys-5b5cdff68186daa5`\ndyld: Symbol not found: __cg_jpeg_resync_to_restart\n  Referenced from: /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO\n  Expected in: /usr/local/lib/libJPEG.dylib\n in /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO\nerror: Process didn't exit successfully: `/Users/chris/Documents/pq-sys/target/debug/pq_sys-5b5cdff68186daa5` (signal: 5, SIGTRAP: trace/breakpoint trap)\n\nCaused by:\n  Process didn't exit successfully: `/Users/chris/Documents/pq-sys/target/debug/pq_sys-5b5cdff68186daa5` (signal: 5, SIGTRAP: trace/breakpoint trap)\n~/D/pq-sys git:master \u276f\u276f\u276f\n```\n\nStable:\n\n```\n~/D/pq-sys git:master \u276f\u276f\u276f rustup override set stable\ninfo: using existing install for 'stable-x86_64-apple-darwin'\ninfo: override toolchain for '/Users/chris/Documents/pq-sys' set to 'stable-x86_64-apple-darwin'\n\n  stable-x86_64-apple-darwin unchanged - rustc 1.10.0 (cfcb716cf 2016-07-03)\n\n~/D/pq-sys git:master \u276f\u276f\u276f cargo test --verbose\n       Fresh libc v0.2.14\n   Compiling pq-sys v0.2.1 (file:///Users/chris/Documents/pq-sys)\n     Running `rustc build.rs --crate-name build_script_build --crate-type bin -g --out-dir /Users/chris/Documents/pq-sys/target/debug/build/pq-sys-683de9b8454d5f4b --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps`\n     Running `/Users/chris/Documents/pq-sys/target/debug/build/pq-sys-683de9b8454d5f4b/build-script-build`\n     Running `rustc src/lib.rs --crate-name pq_sys --crate-type lib -g --out-dir /Users/chris/Documents/pq-sys/target/debug --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps --extern libc=/Users/chris/Documents/pq-sys/target/debug/deps/liblibc-1f3392fe1afd1313.rlib -L native=/usr/local/lib`\n     Running `rustc src/lib.rs --crate-name pq_sys --crate-type lib -g --test -C metadata=5b5cdff68186daa5 -C extra-filename=-5b5cdff68186daa5 --out-dir /Users/chris/Documents/pq-sys/target/debug --emit=dep-info,link -L dependency=/Users/chris/Documents/pq-sys/target/debug -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps --extern libc=/Users/chris/Documents/pq-sys/target/debug/deps/liblibc-1f3392fe1afd1313.rlib -L native=/usr/local/lib`\n     Running `/Users/chris/Documents/pq-sys/target/debug/pq_sys-5b5cdff68186daa5`\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured\n\n   Doc-tests pq_sys\n     Running `rustdoc --test /Users/chris/Documents/pq-sys/src/lib.rs --crate-name pq_sys -L dependency=/Users/chris/Documents/pq-sys/target/debug/deps -L dependency=/Users/chris/Documents/pq-sys/target/debug -L native=/usr/local/lib --extern libc=/Users/chris/Documents/pq-sys/target/debug/deps/liblibc-1f3392fe1afd1313.rlib --extern pq_sys=/Users/chris/Documents/pq-sys/target/debug/libpq_sys.rlib`\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured\n```\n\nI'm not sure of a smaller set to replicate. In order to get into this situation on a mac, you need to have done the following:\n1. `brew install postgres`\n2. `brew install libjpeg`. This will add `/usr/local/lib/libjpeg.dylib` which beta ends up linking to.\n\nAlso related otool output:\n\n```\n~/D/pq-sys git:master \u276f\u276f\u276f otool -L /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO\n/System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO:\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/Accelerate.framework/Versions/A/Accelerate (compatibility version 1.0.0, current version 4.0.0)\n    /System/Library/Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics (compatibility version 64.0.0, current version 600.0.0)\n    /System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices (compatibility version 1.0.0, current version 48.0.0)\n    /System/Library/PrivateFrameworks/AppleVPA.framework/Versions/A/AppleVPA (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/Foundation.framework/Versions/C/Foundation (compatibility version 300.0.0, current version 1259.0.0)\n    /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 1258.1.0)\n    /System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices (compatibility version 1.0.0, current version 728.10.0)\n    /System/Library/PrivateFrameworks/AppleJPEG.framework/Versions/A/AppleJPEG (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libJPEG.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libTIFF.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libPng.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libGIF.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libJP2.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /System/Library/Frameworks/ImageIO.framework/Versions/A/Resources/libRadiance.dylib (compatibility version 1.0.0, current version 1.0.0)\n    /usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0)\n    /usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.5)\n    /System/Library/Frameworks/IOSurface.framework/Versions/A/IOSurface (compatibility version 1.0.0, current version 1.0.0)\n    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.1.0)\n    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)\n```\n", "closed_by": {"login": "compressed", "id": 28634, "node_id": "MDQ6VXNlcjI4NjM0", "avatar_url": "https://avatars.githubusercontent.com/u/28634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compressed", "html_url": "https://github.com/compressed", "followers_url": "https://api.github.com/users/compressed/followers", "following_url": "https://api.github.com/users/compressed/following{/other_user}", "gists_url": "https://api.github.com/users/compressed/gists{/gist_id}", "starred_url": "https://api.github.com/users/compressed/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compressed/subscriptions", "organizations_url": "https://api.github.com/users/compressed/orgs", "repos_url": "https://api.github.com/users/compressed/repos", "events_url": "https://api.github.com/users/compressed/events{/privacy}", "received_events_url": "https://api.github.com/users/compressed/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34869/timeline", "performed_via_github_app": null, "state_reason": "completed"}