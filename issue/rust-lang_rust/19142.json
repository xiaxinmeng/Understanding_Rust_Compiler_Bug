{"url": "https://api.github.com/repos/rust-lang/rust/issues/19142", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19142/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19142/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19142/events", "html_url": "https://github.com/rust-lang/rust/issues/19142", "id": 49556765, "node_id": "MDU6SXNzdWU0OTU1Njc2NQ==", "number": 19142, "title": "ICE: With `writeln!` after recent changes in std::fmt", "user": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-11-20T14:20:05Z", "updated_at": "2014-11-21T04:22:00Z", "closed_at": "2014-11-20T15:09:46Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### STR\n\n``` rust\nuse std::fmt::Show;\nuse std::io::PipeStream;\n\nstruct Program {\n    stdin: PipeStream,\n}\n\nimpl Program {\n    fn send<T: Show>(&mut self, line: T) -> &mut Program {\n        // OK\n        //match writeln!(&mut self.stdin, \"{}\", line) {\n        // ICE\n        match writeln!(self.stdin, \"{}\", line) {\n            Err(_) => panic!(),\n            Ok(_) => self,\n        }\n    }\n}\n\nfn main() {}\n```\n### Output\n\n``` rust\ntask 'rustc' panicked at 'index out of bounds: the len is 6 but the index is 6', /var/tmp/paludis/build/dev-lang-rust-scm/work/rust-scm/src/libsyntax/lib.rs:1\n\nstack backtrace:\n   1:     0x7f7ac0e18a30 - rt::backtrace::imp::write::h2b9052e6d9bc7115y9s\n   2:     0x7f7ac0e1bbd0 - <unknown>\n   3:     0x7f7ac15bdea0 - unwind::begin_unwind_inner::h045530faf4b26040nbd\n   4:     0x7f7ac15bdb20 - unwind::begin_unwind_fmt::hbb3cb48652ded377y8c\n   5:     0x7f7ac15bdae0 - rust_begin_unwind\n   6:     0x7f7ac15fa590 - panicking::panic_fmt::hc3aa7deba1f6ed540Nl\n   7:     0x7f7ac15ff980 - panicking::panic_bounds_check::h40d1ef7dd63df707yMl\n   8:     0x7f7abec8bba0 - codemap::FileMap::get_line::haca5f2812f60e330m4E\n   9:     0x7f7abecba5c0 - <unknown>\n  10:     0x7f7abecb6fe0 - diagnostic::EmitterWriter.Emitter::emit::h8944016a574210b0lrG\n  11:     0x7f7abecb5860 - diagnostic::Handler::emit::hef6d94e096dac3f1F8F\n  12:     0x7f7abec88380 - diagnostic::SpanHandler::span_err::he4174115bd82cc5fEWF\n  13:     0x7f7ac00875d0 - middle::typeck::infer::InferCtxt<'a, 'tcx>::type_error_message_str_with_expected::h0350e4ffa557951e6rF\n  14:     0x7f7abffd1cc0 - middle::typeck::infer::InferCtxt<'a, 'tcx>::type_error_message::h216c2650f9e1a343qxF\n  15:     0x7f7abffdb420 - <unknown>\n  16:     0x7f7abffdb420 - <unknown>\n  17:     0x7f7ac0011ca0 - middle::typeck::check::check_decl_local::hba8b231eaafb10e9vao\n  18:     0x7f7ac0011e60 - middle::typeck::check::check_stmt::ha5de4679bb4bc747vco\n  19:     0x7f7abff93bc0 - <unknown>\n  20:     0x7f7abffdb420 - <unknown>\n  21:     0x7f7abfec6f70 - middle::typeck::check::_match::check_match::h4e3330be3e1c359eyz8\n  22:     0x7f7abffdb420 - <unknown>\n  23:     0x7f7abff93bc0 - <unknown>\n  24:     0x7f7abff6b9b0 - <unknown>\n  25:     0x7f7abff904c0 - <unknown>\n  26:     0x7f7abff96bd0 - <unknown>\n  27:     0x7f7abff8c2b0 - middle::typeck::check::check_item::hd604129538ea4d11VQi\n  28:     0x7f7abff90150 - middle::typeck::check::check_item_types::h1a3e4c15e3ead8aeXvi\n  29:     0x7f7ac0333c60 - <unknown>\n  30:     0x7f7ac0332e70 - middle::typeck::check_crate::he5192d314e6838dfhdM\n  31:     0x7f7ac1ab8bf0 - driver::driver::phase_3_run_analysis_passes::he238813c217c3b94efS\n  32:     0x7f7ac1aada10 - driver::driver::compile_input::h117f94c1b348a398YVR\n  33:     0x7f7ac1b323d0 - <unknown>\n  34:     0x7f7ac1b322c0 - <unknown>\n  35:     0x7f7ac193ef30 - <unknown>\n  36:     0x7f7ac193ed20 - <unknown>\n  37:     0x7f7ac1e52b70 - <unknown>\n  38:     0x7f7ac160cfe0 - <unknown>\n  39:     0x7f7ac160cfd0 - rust_try\n  40:     0x7f7ac15bb800 - unwind::try::h03ead95328113b2fIZc\n  41:     0x7f7ac15bb690 - task::Task::run::hed7dc0cf620a0172y5b\n  42:     0x7f7ac1e528b0 - <unknown>\n  43:     0x7f7ac15bceb0 - <unknown>\n  44:     0x7f7abc08a1d0 - start_thread\n  45:     0x7f7ac12941b9 - clone\n  46:                0x0 - <unknown>\n```\n### Version\n\n[Equivalent code](https://github.com/japaric/criterion.rs/blob/99c41b394b84d962c557d4ac15aa71bae6b31fcb/src/program.rs#L31-36) was compiling with:\n\n``` rust\nrustc 0.13.0-nightly (e09d98603 2014-11-18 23:51:43 +0000)\n```\n\nBut now it's ICEing on: 1d81776\n\nI think #19040 may have introduced the ICE.\n\ncc @alexcrichton \n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/19142/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19142/timeline", "performed_via_github_app": null, "state_reason": "completed"}