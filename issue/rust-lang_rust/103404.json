{"url": "https://api.github.com/repos/rust-lang/rust/issues/103404", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103404/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103404/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103404/events", "html_url": "https://github.com/rust-lang/rust/issues/103404", "id": 1419387437, "node_id": "I_kwDOAAsO6M5UmiIt", "number": 103404, "title": "macOS 12.6 shows leaks in macOS runtime under LeakSan", "user": {"login": "lopopolo", "id": 860434, "node_id": "MDQ6VXNlcjg2MDQzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/860434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lopopolo", "html_url": "https://github.com/lopopolo", "followers_url": "https://api.github.com/users/lopopolo/followers", "following_url": "https://api.github.com/users/lopopolo/following{/other_user}", "gists_url": "https://api.github.com/users/lopopolo/gists{/gist_id}", "starred_url": "https://api.github.com/users/lopopolo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lopopolo/subscriptions", "organizations_url": "https://api.github.com/users/lopopolo/orgs", "repos_url": "https://api.github.com/users/lopopolo/repos", "events_url": "https://api.github.com/users/lopopolo/events{/privacy}", "received_events_url": "https://api.github.com/users/lopopolo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-10-22T16:22:52Z", "updated_at": "2022-10-23T00:08:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried compiling https://github.com/artichoke/intaglio under leaksan on macOS with the following command:\r\n\r\n```\r\ncargo-bisect-rustc --script '/usr/bin/env' -- RUSTFLAGS=\"-Z sanitizer=leak\" cargo test --target x86_64-apple-darwin\r\n```\r\n\r\nAnd saw leaks going back to at least nightly-2022-08-19 on macOS version:\r\n\r\n```console\r\n$ sw_vers\r\nProductName:    macOS\r\nProductVersion: 12.6\r\nBuildVersion:   21G115\r\n```\r\n\r\nThe leaks appear to be in the macOS runtime itself. I run LeakSan in CI weekly and did not previously observe failures. I suspect something changed on the macOS side.\r\n\r\nA failing runner on GitHub Actions has this version:\r\n\r\n```\r\nCurrent runner version: '2.298.2'\r\nOperating System\r\n  macOS\r\n  12.6\r\n  21G115\r\nRunner Image\r\n  Image: macos-12\r\n  Version: 20221018.2\r\n  Included Software: https://github.com/actions/runner-images/blob/macOS-12/20221018.2/images/macos/macos-12-Readme.md\r\n  Image Release: https://github.com/actions/runner-images/releases/tag/macOS-12%2F20221018.2\r\nRunner Image Provisioner\r\n  2.0.91.1\r\n```\r\n\r\nA passing run has this version:\r\n\r\n```\r\nCurrent runner version: '2.298.2'\r\nOperating System\r\n  macOS\r\n  11.7\r\n  20G817\r\nRunner Image\r\n  Image: macos-11\r\n  Version: 20221010.1\r\n  Included Software: https://github.com/actions/runner-images/blob/macOS-11/20221010.1/images/macos/macos-11-Readme.md\r\n  Image Release: https://github.com/actions/runner-images/releases/tag/macOS-11%2F20221010.1\r\nRunner Image Provisioner\r\n  2.0.78.1\r\n```\r\n\r\nI expected to see this happen: no leaks to match the behavior under Linux.\r\n\r\nInstead, this happened:\r\n\r\n```\r\n=================================================================\r\n==4169==ERROR: LeakSanitizer: detected memory leaks\r\n\r\nDirect leak of 1888 byte(s) in 59 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab0e55 in map_images_nolock+0x1607 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #5 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #6 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #7 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x164b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #9 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #10 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #11 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x1894) (BuildId: 8e7d2b41940d33718d5b07f6bc4119ae32000000200000000100000000060c00)\r\n    #12 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #13 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #14 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #15 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079af4e3 in start+0x183 (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nDirect leak of 1888 byte(s) in 59 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab2c35 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x[154](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:155) (libobjc.A.dylib:x86_64+0x4c35) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804ab0e55 in map_images_nolock+0x1607 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #5 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #6 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #7 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #9 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x164b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #10 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #11 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #12 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x1894) (BuildId: 8e7d2b41940d33718d5b07f6bc4119ae32000000200000000100000000060c00)\r\n    #13 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #14 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #15 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #23 0x1079af4e3 in start+0x183 (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nDirect leak of 160 byte(s) in 5 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab2c35 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x154 (libobjc.A.dylib:x86_64+0x4c35) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x7ff804ab0e55 in map_images_nolock+0x[160](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:161)7 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #5 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #6 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #7 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #9 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #10 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x[164](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:165)b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #11 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #12 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #13 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x1894) (BuildId: 8e7d2b41940d33718d5b07f6bc4119ae32000000200000000100000000060c00)\r\n    #14 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #15 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #23 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #24 0x1079af4e3 in start+0x183 (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nDirect leak of 160 byte(s) in 5 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804ab0e55 in map_images_nolock+0x1607 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #5 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #6 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #7 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #9 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x164b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #10 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #11 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #12 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x1894) (BuildId: 8e7d2b41940d33718d5b07f6bc4119ae32000000200000000100000000060c00)\r\n    #13 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #14 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #15 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #23 0x1079af4e3 in start+0x[183](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:184) (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nDirect leak of 32 byte(s) in 1 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab2c35 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x154 (libobjc.A.dylib:x86_64+0x4c35) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #5 0x7ff804ab0e55 in map_images_nolock+0x1607 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #6 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #7 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #9 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #10 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #11 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x164b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #12 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #13 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #14 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x[189](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:190)4) (BuildId: 8e7d2b4[194](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:195)0d33718d5b07f6bc4119ae3[200](https://github.com/artichoke/intaglio/actions/runs/3303829495/jobs/5452222456#step:4:201)0000200000000100000000060c00)\r\n    #15 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #23 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #24 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #25 0x1079af4e3 in start+0x183 (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nDirect leak of 32 byte(s) in 1 object(s) allocated from:\r\n    #0 0x10537095d in wrap_calloc+0x5d (librustc-nightly_rt.lsan.dylib:x86_64+0xa95d) (BuildId: 5a1df1c722913855ae3c0ce51ec19461240000001000000000070a0000010c00)\r\n    #1 0x7ff804ab2b69 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x88 (libobjc.A.dylib:x86_64+0x4b69) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #2 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #3 0x7ff804ab2c12 in realizeClassWithoutSwift(objc_class*, objc_class*)+0x131 (libobjc.A.dylib:x86_64+0x4c12) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #4 0x7ff804ab0e55 in map_images_nolock+0x1607 (libobjc.A.dylib:x86_64+0x2e55) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #5 0x7ff804aaf7e5 in map_images+0x42 (libobjc.A.dylib:x86_64+0x17e5) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #6 0x1079b91fa in invocation function for block in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x112 (dyld:x86_64+0xf1fa) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #7 0x1079b46c8 in dyld4::RuntimeState::withLoadersReadLock(void () block_pointer)+0x28 (dyld:x86_64+0xa6c8) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #8 0x1079b90e1 in dyld4::RuntimeState::setObjCNotifiers(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x51 (dyld:x86_64+0xf0e1) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #9 0x1079ccd44 in dyld4::APIs::_dyld_objc_notify_register(void (*)(unsigned int, char const* const*, mach_header const* const*), void (*)(char const*, mach_header const*), void (*)(char const*, mach_header const*))+0x4e (dyld:x86_64+0x22d44) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #10 0x7ff804aaf64b in _objc_init+0x4fc (libobjc.A.dylib:x86_64+0x164b) (BuildId: e633b9d0768631f692b1451e39bcf65332000000200000000100000000060c00)\r\n    #11 0x7ff804a69992 in _os_object_init+0xc (libdispatch.dylib:x86_64+0x2992) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #12 0x7ff804a771b7 in libdispatch_init+0x136 (libdispatch.dylib:x86_64+0x101b7) (BuildId: 1a04b38076e43e4bb0fc9837533d021d32000000200000000100000000060c00)\r\n    #13 0x7ff80fe12894 in libSystem_initializer+0xed (libSystem.B.dylib:x86_64+0x1894) (BuildId: 8e7d2b41940d33718d5b07f6bc4119ae32000000200000000100000000060c00)\r\n    #14 0x1079bee4e in invocation function for block in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0xb5 (dyld:x86_64+0x14e4e) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #15 0x1079e5aac in invocation function for block in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0xf1 (dyld:x86_64+0x3baac) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #16 0x1079dce25 in invocation function for block in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0x22c (dyld:x86_64+0x32e25) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #17 0x1079abdb2 in dyld3::MachOFile::forEachLoadCommand(Diagnostics&, void (load_command const*, bool&) block_pointer) const+0x80 (dyld:x86_64+0x1db2) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #18 0x1079dcbb6 in dyld3::MachOFile::forEachSection(void (dyld3::MachOFile::SectionInfo const&, bool, bool&) block_pointer) const+0xb2 (dyld:x86_64+0x32bb6) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #19 0x1079e5603 in dyld3::MachOAnalyzer::forEachInitializer(Diagnostics&, dyld3::MachOAnalyzer::VMAddrConverter const&, void (unsigned int) block_pointer, void const*) const+0x1d1 (dyld:x86_64+0x3b603) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #20 0x1079bed81 in dyld4::Loader::findAndRunAllInitializers(dyld4::RuntimeState&) const+0x8f (dyld:x86_64+0x14d81) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #21 0x1079c5659 in dyld4::PrebuiltLoader::runInitializers(dyld4::RuntimeState&) const+0x1d (dyld:x86_64+0x1b659) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #22 0x1079d276d in dyld4::APIs::runAllInitializersForMain()+0x25 (dyld:x86_64+0x2876d) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #23 0x1079b038c in dyld4::prepare(dyld4::APIs&, dyld3::MachOAnalyzer const*)+0xd72 (dyld:x86_64+0x638c) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n    #24 0x1079af4e3 in start+0x183 (dyld:x86_64+0x54e3) (BuildId: 71febccdd9dc359999712b3407c588a832000000200000000100000000060c00)\r\n\r\nSUMMARY: LeakSanitizer: 4160 byte(s) leaked in 130 allocation(s).\r\nerror: test failed, to rerun pass `--lib`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/Users/runner/work/intaglio/intaglio/target/x86_64-apple-darwin/debug/deps/intaglio-59a85121b073d1da` (exit status: 23)\r\n```\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n```console\r\n$ rustc +nightly --version --verbose\r\nrustc 1.66.0-nightly (5c8bff74b 2022-10-21)\r\nbinary: rustc\r\ncommit-hash: 5c8bff74bc1c52bef0c79f3689bb227f51f3e82d\r\ncommit-date: 2022-10-21\r\nhost: x86_64-apple-darwin\r\nrelease: 1.66.0-nightly\r\nLLVM version: 15.0.2\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103404/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103404/timeline", "performed_via_github_app": null, "state_reason": null}