{"url": "https://api.github.com/repos/rust-lang/rust/issues/68936", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68936/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68936/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68936/events", "html_url": "https://github.com/rust-lang/rust/issues/68936", "id": 561837689, "node_id": "MDU6SXNzdWU1NjE4Mzc2ODk=", "number": 68936, "title": "Tests in panic=abort can hang if test spawns a subprocess", "user": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 630810559, "node_id": "MDU6TGFiZWw2MzA4MTA1NTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-libtest", "name": "A-libtest", "color": "f7e101", "default": false, "description": "Area: #[test] related"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-02-07T19:49:00Z", "updated_at": "2020-08-14T01:10:33Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If a test (running in a subprocess, because panic=abort) spawns a sub-subprocess which inherits its stdout or stderr handles, and the sub-subprocess does not exit when the test does, the test framework will hang. This is because [`wait_with_output`](https://github.com/rust-lang/rust/blob/fb29dfcc9ada6ed10308b6e7f405569f61a9af0b/src/libstd/process.rs#L1469-L1491) waits for all stdio handles to be closed.\r\n\r\n```\r\nlibtest runner         (waits for unit test stdio to close)\r\n       |\r\n       |  Stdio::piped\r\n       |\r\nunit test process      (exits, but stdio is now shared with subproc)\r\n      ||\r\n      ||  Stdio::inherit\r\n      ||\r\n\"leaked\" subprocess    (sticks around forever)\r\n```\r\n\r\nSome tests spawn subprocesses, and it can be hard (particularly with panic=abort) to ensure that they are all cleaned up when the test succeeds or fails. In these cases, it would be best not to hang. Hanging is unexpected, and hard to debug.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68936/timeline", "performed_via_github_app": null, "state_reason": null}