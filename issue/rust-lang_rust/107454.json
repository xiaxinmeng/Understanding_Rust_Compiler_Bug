{"url": "https://api.github.com/repos/rust-lang/rust/issues/107454", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107454/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107454/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107454/events", "html_url": "https://github.com/rust-lang/rust/issues/107454", "id": 1561431226, "node_id": "I_kwDOAAsO6M5dEYy6", "number": 107454, "title": "ICE with inner function `#[test_case]`", "user": {"login": "Evryon75", "id": 79467907, "node_id": "MDQ6VXNlcjc5NDY3OTA3", "avatar_url": "https://avatars.githubusercontent.com/u/79467907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Evryon75", "html_url": "https://github.com/Evryon75", "followers_url": "https://api.github.com/users/Evryon75/followers", "following_url": "https://api.github.com/users/Evryon75/following{/other_user}", "gists_url": "https://api.github.com/users/Evryon75/gists{/gist_id}", "starred_url": "https://api.github.com/users/Evryon75/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Evryon75/subscriptions", "organizations_url": "https://api.github.com/users/Evryon75/orgs", "repos_url": "https://api.github.com/users/Evryon75/repos", "events_url": "https://api.github.com/users/Evryon75/events{/privacy}", "received_events_url": "https://api.github.com/users/Evryon75/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3921860029, "node_id": "LA_kwDOAAsO6M7pwtW9", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-has-mcve", "name": "S-has-mcve", "color": "862eff", "default": false, "description": "A Minimal Complete and Verifiable Example has been found for this issue"}], "state": "closed", "locked": false, "assignee": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2023-01-29T19:36:57Z", "updated_at": "2023-03-20T08:44:03Z", "closed_at": "2023-03-20T08:44:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Minimized\n\n```rust\nfn init() {\n    #[test_case]\n    fn function27() {}\n}\n```\n\n# Original report\n\nThis happens when a test function is declared inside another function, the one where the tests start running to be precise, using a custom testing framework in a no_std environment.\n\n+ link: https://github.com/Evryon75/Clarissa/blob/rust-error/src/main.rs\n+ at lines: 31 [function declared outside] , 40 [comment of function declared inside]\n+ I checked with the latest version of the nightly channel, and could not find any related issues\n\n```rust\nthread 'rustc' panicked at 'expected Item', compiler\\rustc_expand\\src\\base.rs:148:18\nstack backtrace:\n\n   0:     0x7ffd3cc89da2 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h51cbe37f66a51707\n   1:     0x7ffd3ccc5b0b - core::fmt::write::h5c78deaf4d8a1717\n   2:     0x7ffd3cc7ce3a - <std::io::IoSlice as core::fmt::Debug>::fmt::he493d27c141d515f\n   3:     0x7ffd3cc89aeb - std::sys::common::alloc::realloc_fallback::h8441730297e6dd3d\n   4:     0x7ffd3cc8d499 - std::panicking::default_hook::h1fc51507de475e03\n   5:     0x7ffd3cc8d11b - std::panicking::default_hook::h1fc51507de475e03\n   6:     0x7ffd256910cf - rustc_driver[f6c6ae1dae99c3a4]::describe_lints\n   7:     0x7ffd3cc8ddff - std::panicking::rust_panic_with_hook::h9b4ec48ed01143e7\n   8:     0x7ffd3cc8db1b - <std::panicking::begin_panic_handler::StrPanicPayload as core::panic::BoxMeUp>::get::hafe6d61d6276438c\n   9:     0x7ffd3cc8aa9f - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h51cbe37f66a51707\n  10:     0x7ffd3cc8d810 - rust_begin_unwind\n  11:     0x7ffd3ccfb9a5 - core::panicking::panic_fmt::h60c5d107fadefb54\n  12:     0x7ffd228566ff - <rustc_expand[d208009879dd3b2d]::base::Annotatable>::expect_item\n  13:     0x7ffd25484a57 - <rustc_builtin_macros[3f8ae38c2d7d73a1]::format::PositionUsedAs as core[ac0928afaaba8a6b]::fmt::Debug>::fmt\n  14:     0x7ffd239eea5e - <rustc_expand[d208009879dd3b2d]::expand::MacroExpander>::fully_expand_fragment\n  15:     0x7ffd2284e0c9 - <rustc_expand[d208009879dd3b2d]::expand::MacroExpander>::expand_crate\n  16:     0x7ffd229a8e4c - rustc_interface[eee0500530781d4a]::interface::parse_check_cfg\n  17:     0x7ffd229cdc02 - rustc_interface[eee0500530781d4a]::passes::configure_and_expand\n  18:     0x7ffd22998531 - <rustc_interface[eee0500530781d4a]::queries::Queries>::expansion\n  19:     0x7ffd229990d5 - <rustc_interface[eee0500530781d4a]::queries::Queries>::global_ctxt\n  20:     0x7ffd227ad48d - rustc_driver[f6c6ae1dae99c3a4]::args::arg_expand_all\n  21:     0x7ffd2279133c - <rustc_data_structures[cc058e1d54c120e6]::temp_dir::MaybeTempDir>::new\n  22:     0x7ffd227acc77 - rustc_driver[f6c6ae1dae99c3a4]::args::arg_expand_all\n  23:     0x7ffd2279ae63 - <rustc_data_structures[cc058e1d54c120e6]::temp_dir::MaybeTempDir>::new\n  24:     0x7ffd227934ad - <rustc_data_structures[cc058e1d54c120e6]::temp_dir::MaybeTempDir>::new\n  25:     0x7ffd3cca057c - std::sys::windows::thread::Thread::new::hf27b16c8cd567952\n  26:     0x7ffdc2f57614 - BaseThreadInitThunk\n  27:     0x7ffdc40626a1 - RtlUserThreadStart\n\nerror: internal compiler error: unexpected panic\n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\n\nnote: rustc 1.69.0-nightly (1e225413a 2023-01-28) running on x86_64-pc-windows-msvc\n\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental=[REDACTED] -Z unstable-options\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\n```\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"Ezrashaw\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107454/timeline", "performed_via_github_app": null, "state_reason": "completed"}