{"url": "https://api.github.com/repos/rust-lang/rust/issues/25875", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25875/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25875/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25875/events", "html_url": "https://github.com/rust-lang/rust/issues/25875", "id": 82226325, "node_id": "MDU6SXNzdWU4MjIyNjMyNQ==", "number": 25875, "title": "Using macro with literal patterns in other macro fails", "user": {"login": "waucka", "id": 2433972, "node_id": "MDQ6VXNlcjI0MzM5NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2433972?v=4", "gravatar_id": "", "url": "https://api.github.com/users/waucka", "html_url": "https://github.com/waucka", "followers_url": "https://api.github.com/users/waucka/followers", "following_url": "https://api.github.com/users/waucka/following{/other_user}", "gists_url": "https://api.github.com/users/waucka/gists{/gist_id}", "starred_url": "https://api.github.com/users/waucka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/waucka/subscriptions", "organizations_url": "https://api.github.com/users/waucka/orgs", "repos_url": "https://api.github.com/users/waucka/repos", "events_url": "https://api.github.com/users/waucka/events{/privacy}", "received_events_url": "https://api.github.com/users/waucka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-05-29T02:49:45Z", "updated_at": "2018-12-27T16:16:07Z", "closed_at": "2018-12-27T16:16:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Code\n\n``` rust\nfn foo1(x: &str) {\n        println!(\"foo1({})\", x);\n}\n\nfn foo2(x: &str) {\n        println!(\"foo2({})\", x);\n}\n\nmacro_rules! wtf {\n        (1) => (foo1);\n        (2) => (foo2);\n}\n\nmacro_rules! wtf_foo {\n        ($x:expr, $num:expr) => {\n                wtf!($num)($x);\n        }\n}\n\nfn main() {\n        //Fails\n        wtf_foo!(\"one\", 1);\n        //Works\n        wtf!(1)(\"one\");\n}\n```\n## Output\n\n```\n$ rustc foo.rs \nfoo.rs:16:8: 17:12 error: no rules expected the token `1`\nfoo.rs:16               wtf!($num)($x);\n                             ^~~~\n```\n## Expected Output\n\n```\n$ rustc foo.rs \nfoo.rs:5:1: 7:2 warning: function is never used: `foo2`, #[warn(dead_code)] on by default\nfoo.rs:5 fn foo2(x: &str) {\nfoo.rs:6        println!(\"foo2({})\", x);\nfoo.rs:7 }\n$ ./foo\nfoo1(one)\nfoo1(one)\n```\n## Other\n\nThis works fine, so the problem appears to be limited to literal patterns (not sure if that's the right term):\n\n``` rust\nmacro_rules! print_stuff_for_real {\n        ($x:expr) => (println!(\"Printing stuff: {}\", $x));\n}\n\nmacro_rules! print_stuff {\n        ($x:expr) => (print_stuff_for_real!($x));\n}\n\nfn main() {\n        print_stuff!(\"stuff\");\n}\n\n```\n## Meta\n\nI used two versions of rustc; they behaved identically.\n\n```\nrustc 1.0.0 (a59de37e9 2015-05-13) (built 2015-05-14)\nbinary: rustc\ncommit-hash: a59de37e99060162a2674e3ff45409ac73595c0e\ncommit-date: 2015-05-13\nbuild-date: 2015-05-14\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0\n```\n\n```\nrustc 1.2.0-nightly (f76d9bcfc 2015-05-28) (built 2015-05-28)\nbinary: rustc\ncommit-hash: f76d9bcfc2c269452522fbbe19f66fe653325646\ncommit-date: 2015-05-28\nbuild-date: 2015-05-28\nhost: x86_64-unknown-linux-gnu\nrelease: 1.2.0-nightly\n```\n", "closed_by": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25875/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25875/timeline", "performed_via_github_app": null, "state_reason": "completed"}