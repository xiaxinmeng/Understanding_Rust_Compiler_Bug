{"url": "https://api.github.com/repos/rust-lang/rust/issues/109918", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109918/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109918/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109918/events", "html_url": "https://github.com/rust-lang/rust/issues/109918", "id": 1652970494, "node_id": "I_kwDOAAsO6M5ihlP-", "number": 109918, "title": "x86-interrupt calling convention with error code is broken on x86_64-unknown-none", "user": {"login": "SamZhang3", "id": 56181108, "node_id": "MDQ6VXNlcjU2MTgxMTA4", "avatar_url": "https://avatars.githubusercontent.com/u/56181108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SamZhang3", "html_url": "https://github.com/SamZhang3", "followers_url": "https://api.github.com/users/SamZhang3/followers", "following_url": "https://api.github.com/users/SamZhang3/following{/other_user}", "gists_url": "https://api.github.com/users/SamZhang3/gists{/gist_id}", "starred_url": "https://api.github.com/users/SamZhang3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SamZhang3/subscriptions", "organizations_url": "https://api.github.com/users/SamZhang3/orgs", "repos_url": "https://api.github.com/users/SamZhang3/repos", "events_url": "https://api.github.com/users/SamZhang3/events{/privacy}", "received_events_url": "https://api.github.com/users/SamZhang3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301991, "node_id": "MDU6TGFiZWw1NTMwMTk5MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86", "name": "O-x86", "color": "6e6ec0", "default": false, "description": "Target: x86 processors"}, {"id": 55302148, "node_id": "MDU6TGFiZWw1NTMwMjE0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86_64", "name": "O-x86_64", "color": "6e6ec0", "default": false, "description": "Target: x64 processors"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 4288196623, "node_id": "LA_kwDOAAsO6M7_mLAP", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-abi", "name": "A-abi", "color": "f7e101", "default": false, "description": "Area: Concerning the \"application binary interface\" between functions."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-04-04T00:28:46Z", "updated_at": "2023-05-18T00:25:10Z", "closed_at": "2023-05-18T00:25:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nSee [this godbolt link](https://godbolt.org/z/nPK5Ks3ev).\r\n\r\nAt line 177 of the generated assembly, it loads the address `rsp + 176` and passes it to the `core::fmt::ArgumentV1::new_debug` function. The offset 176 is incorrect since the data pushed to the stack in lines 166-175, the 40-byte stack frame pushed during the interrupt, and the 8-byte error code are only 128 bytes total, so the address will point to something random below the interrupt stack frame on the stack.\r\n\r\nThis does not occur if the error code argument is removed: see [godbolt](https://godbolt.org/z/Y95K75oes). Here, an additional `sub rsp, 80` instruction appears at line 175 after saving registers, and the offset used at line 177 is correct (skipping the 80 bytes plus the 72 from the 9 saved registers, for 152 bytes total).\r\n\r\nExperimenting with custom target JSON specifications instead of x86_64-unknown-none, it appears that the bug disappears when the `\"stack-probes\": {\"kind\": \"inline-or-call\", ...}` part of the specification is removed.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109918/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109918/timeline", "performed_via_github_app": null, "state_reason": "completed"}