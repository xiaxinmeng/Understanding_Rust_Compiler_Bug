{"url": "https://api.github.com/repos/rust-lang/rust/issues/39636", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39636/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39636/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39636/events", "html_url": "https://github.com/rust-lang/rust/issues/39636", "id": 206080144, "node_id": "MDU6SXNzdWUyMDYwODAxNDQ=", "number": 39636, "title": "incr. comp.: Attribute errors when compiling crate with serde_derive.", "user": {"login": "belgum", "id": 16122562, "node_id": "MDQ6VXNlcjE2MTIyNTYy", "avatar_url": "https://avatars.githubusercontent.com/u/16122562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/belgum", "html_url": "https://github.com/belgum", "followers_url": "https://api.github.com/users/belgum/followers", "following_url": "https://api.github.com/users/belgum/following{/other_user}", "gists_url": "https://api.github.com/users/belgum/gists{/gist_id}", "starred_url": "https://api.github.com/users/belgum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/belgum/subscriptions", "organizations_url": "https://api.github.com/users/belgum/orgs", "repos_url": "https://api.github.com/users/belgum/repos", "events_url": "https://api.github.com/users/belgum/events{/privacy}", "received_events_url": "https://api.github.com/users/belgum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-02-08T02:47:05Z", "updated_at": "2017-05-24T15:30:28Z", "closed_at": "2017-05-24T15:30:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm running into an issue with incremental compilation where compiling the below code and then compiling it again with the `#[serde(tag = \"variant\")]` tag removed causes an ICE  (it also fails if the steps are reversed i.e. compile first without and then with the attribute).\r\n\r\n```\r\nextern crate serde;\r\n#[macro_use]\r\nextern crate serde_derive;\r\nextern crate serde_json;\r\n\r\n#[derive(Deserialize)]\r\n#[serde(tag = \"variant\")] // if this attribute is added or removed after an incr comp build it causes an ICE\r\nenum A {\r\n    A1 { x: usize },\r\n}\r\n\r\nfn main() {\r\n    // The below line also seems necessary to trigger the ICE\r\n    let a: A = serde_json::from_str(\"\").unwrap();\r\n}\r\n```\r\nAnd the backtrace from the compiler:\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /Users/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-mac/build/src/libcore/option.rs:323\r\nstack backtrace:\r\n   1:        0x10fa145ec - std::sys::imp::backtrace::tracing::imp::write::hf587afb8e94ad165\r\n   2:        0x10fa2104e - std::panicking::default_hook::{{closure}}::haf3443cb412055ce\r\n   3:        0x10fa20bf3 - std::panicking::default_hook::h742f925bfab3bbfa\r\n   4:        0x10fa21507 - std::panicking::rust_panic_with_hook::h6f06ff8d28a94df6\r\n   5:        0x10fa213b4 - std::panicking::begin_panic::h7b9167ba3324cfae\r\n   6:        0x10fa212d2 - std::panicking::begin_panic_fmt::hb5f8f1fe0fe23e28\r\n   7:        0x10fa21237 - rust_begin_unwind\r\n   8:        0x10fa5ee40 - core::panicking::panic_fmt::he6eb92dab4407c61\r\n   9:        0x10fa5ed44 - core::panicking::panic::h16db271caf2c9025\r\n  10:        0x10aeba3e1 - rustc_incremental::persist::load::decode_dep_graph::hd9a1e8a507634d7f\r\n  11:        0x10aeb0c8f - rustc_incremental::persist::load::load_dep_graph::h5f726d61d7f24d69\r\n  12:        0x10aa1301a - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h46c275184428de94\r\n  13:        0x10aa065da - rustc_driver::driver::phase_3_run_analysis_passes::h9f46d8470c4871d9\r\n  14:        0x10a9f5ba0 - rustc_driver::driver::compile_input::h550b23c65a0bc968\r\n  15:        0x10aa3d24e - rustc_driver::run_compiler::h65867e99dfb91e54\r\n  16:        0x10a9550d8 - std::panicking::try::do_call::hdfa57184047b194c\r\n  17:        0x10fa2411a - __rust_maybe_catch_panic\r\n  18:        0x10a97db33 - <F as alloc::boxed::FnBox<A>>::call_box::h7af5270adbc74627\r\n  19:        0x10fa20174 - std::sys::imp::thread::Thread::new::thread_start::h4ad0b40513420e9c\r\n  20:     0x7fff89ee799c - _pthread_body\r\n  21:     0x7fff89ee7919 - _pthread_start\r\n```\r\n\r\nI'm running `rustc 1.17.0-nightly (c49d10207 2017-02-07)` and `cargo-0.18.0-nightly (de2919f 2017-02-06)` on OS X 10.11.6", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39636/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39636/timeline", "performed_via_github_app": null, "state_reason": "completed"}