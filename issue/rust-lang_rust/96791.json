{"url": "https://api.github.com/repos/rust-lang/rust/issues/96791", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96791/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96791/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96791/events", "html_url": "https://github.com/rust-lang/rust/issues/96791", "id": 1228434785, "node_id": "I_kwDOAAsO6M5JOG1h", "number": 96791, "title": "Misleading error for missing comma/semicolon in array literal", "user": {"login": "LyricLy", "id": 8314814, "node_id": "MDQ6VXNlcjgzMTQ4MTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8314814?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LyricLy", "html_url": "https://github.com/LyricLy", "followers_url": "https://api.github.com/users/LyricLy/followers", "following_url": "https://api.github.com/users/LyricLy/following{/other_user}", "gists_url": "https://api.github.com/users/LyricLy/gists{/gist_id}", "starred_url": "https://api.github.com/users/LyricLy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LyricLy/subscriptions", "organizations_url": "https://api.github.com/users/LyricLy/orgs", "repos_url": "https://api.github.com/users/LyricLy/repos", "events_url": "https://api.github.com/users/LyricLy/events{/privacy}", "received_events_url": "https://api.github.com/users/LyricLy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1183099971, "node_id": "MDU6TGFiZWwxMTgzMDk5OTcx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-suggestion-diagnostics", "name": "A-suggestion-diagnostics", "color": "f7e101", "default": false, "description": "Area: suggestions generated by the compiler applied by cargo fix"}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}, {"id": 1596299768, "node_id": "MDU6TGFiZWwxNTk2Mjk5NzY4", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-invalid-suggestion", "name": "D-invalid-suggestion", "color": "c9f7a3", "default": false, "description": "A structured suggestion resulting in incorrect code"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-05-06T22:32:28Z", "updated_at": "2022-08-04T23:56:07Z", "closed_at": "2022-08-04T23:56:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nGiven the following code: [Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=fe39659ce1a843c7ead370daa0e36414)\r\n\r\n```rust\r\nfn main() {\r\n    let v = [1\r\n    2];\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror: expected `;`, found `2`\r\n --> test.rs:2:15\r\n  |\r\n2 |     let v = [1\r\n  |               ^ help: add `;` here\r\n3 |     2];\r\n  |     - unexpected token\r\n\r\nerror: expected one of `.`, `;`, `?`, `}`, or an operator, found `]`\r\n --> test.rs:3:6\r\n  |\r\n3 |     2];\r\n  |      ^ expected one of `.`, `;`, `?`, `}`, or an operator\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the output should look like:\r\n\r\n```\r\nerror: expected one of `,`, `.`, `;`, `?`, `]`, or an operator, found `2`\r\n --> test.rs:3:5\r\n  |\r\n2 |     let v = [1\r\n  |               -\r\n  |               |\r\n  |               expected one of `,`, `.`, `;`, `?`, `]`, or an operator\r\n3 |     2];\r\n  |     ^ unexpected token\r\n```\r\n\r\nThe error implies that `;` is the only valid token at the end of the second line, and that the third line is being considered a separate statement from the second line, probably due to a consequence of the fault-tolerant parsing machinery.\r\n\r\nReasonable output is given when the newline is removed or there is more than 2 elements:\r\n```\r\nerror: expected one of `,`, `.`, `;`, `?`, `]`, or an operator, found `2`\r\n --> test.rs:2:16\r\n  |\r\n2 |     let v = [1 2\r\n  |                ^ expected one of `,`, `.`, `;`, `?`, `]`, or an operator\r\n\r\nerror: aborting due to previous error\r\n```\r\n```\r\nerror: expected one of `,`, `.`, `?`, `]`, or an operator, found `3`\r\n --> test.rs:3:5\r\n  |\r\n2 |     let v = [1, 2\r\n  |                  -\r\n  |                  |\r\n  |                  expected one of `,`, `.`, `?`, `]`, or an operator\r\n  |                  help: missing `,`\r\n3 |     3];\r\n  |     ^ unexpected token\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\nThis should be fixed because it is confusing in less clear situations such as the following, especially where someone might expect the comma to be implicit due to the behaviour of `match`.\r\n```rust\r\nlet v = [\r\n    {\r\n        1\r\n    }\r\n    {\r\n        2\r\n    }\r\n];\r\n```\r\n\r\nThis happens in every edition and on both stable and nightly.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96791/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96791/timeline", "performed_via_github_app": null, "state_reason": "completed"}