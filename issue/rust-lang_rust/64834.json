{"url": "https://api.github.com/repos/rust-lang/rust/issues/64834", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/64834/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/64834/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/64834/events", "html_url": "https://github.com/rust-lang/rust/issues/64834", "id": 499304867, "node_id": "MDU6SXNzdWU0OTkzMDQ4Njc=", "number": 64834, "title": "Segfault when using rust inside a go program", "user": {"login": "joelwurtz", "id": 90466, "node_id": "MDQ6VXNlcjkwNDY2", "avatar_url": "https://avatars.githubusercontent.com/u/90466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joelwurtz", "html_url": "https://github.com/joelwurtz", "followers_url": "https://api.github.com/users/joelwurtz/followers", "following_url": "https://api.github.com/users/joelwurtz/following{/other_user}", "gists_url": "https://api.github.com/users/joelwurtz/gists{/gist_id}", "starred_url": "https://api.github.com/users/joelwurtz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joelwurtz/subscriptions", "organizations_url": "https://api.github.com/users/joelwurtz/orgs", "repos_url": "https://api.github.com/users/joelwurtz/repos", "events_url": "https://api.github.com/users/joelwurtz/events{/privacy}", "received_events_url": "https://api.github.com/users/joelwurtz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-27T08:17:42Z", "updated_at": "2019-09-29T02:04:07Z", "closed_at": "2019-09-29T02:01:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "This is really a weird bug that occurs on one of our program, i managed to make a reproducable example under this repository: https://github.com/joelwurtz/segfault-golang-with-rust\r\n\r\nThis only happens when calling a specific function on the https://github.com/servo/html5ever library with a specific parameter, and i also make an issue on this library: https://github.com/servo/html5ever/issues/393\r\n\r\nHowever i'm wondering if the bug is not coming from rust-lang\r\n\r\nWhat it does:\r\n\r\n * We create a static library (on the musl target)\r\n * We compile this static library on go with musl gcc \r\n * We create a signal channel **before** calling the exposed api\r\n * We call this function after which cause the segfault (which happens on the `LocalName::from(&*attribute_name)` on the https://github.com/servo/html5ever library call with a not defined local name\r\n\r\nThis result in a segfault 100% of the time\r\n\r\nThere are some workaround for this:\r\n\r\n * Adding the attribute into the local_names.txt file will fix the problem\r\n * Calling the exposed API **before** creating the signal handler will fix the problem\r\n\r\nI really don't know what happens inside and it's really difficult to trace it due to the way of compiling this.\r\n\r\nI'm wondering if using compiler_builtins in 0.1.19 version will help tracing this bug due to https://github.com/rust-lang/compiler-builtins/commit/985a43095c82822e928e08ba3d12fad90ef8d59e\r\n\r\nIf you also have insight on how i can produce a better debugging log i will gladly do it.", "closed_by": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/64834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/64834/timeline", "performed_via_github_app": null, "state_reason": "completed"}