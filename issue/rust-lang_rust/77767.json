{"url": "https://api.github.com/repos/rust-lang/rust/issues/77767", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77767/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77767/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77767/events", "html_url": "https://github.com/rust-lang/rust/issues/77767", "id": 718423085, "node_id": "MDU6SXNzdWU3MTg0MjMwODU=", "number": 77767, "title": "Code bloat from monomorphization of methods applied to arrays", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 1049491442, "node_id": "MDU6TGFiZWwxMDQ5NDkxNDQy", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-heavy", "name": "I-heavy", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to binary size of generated code."}, {"id": 2238476604, "node_id": "MDU6TGFiZWwyMjM4NDc2NjA0", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-fmt", "name": "A-fmt", "color": "f7e101", "default": false, "description": "Area: std::fmt"}, {"id": 3425147156, "node_id": "LA_kwDOAAsO6M7MJ5kU", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-array", "name": "A-array", "color": "f7e101", "default": false, "description": "Area: [T; N]"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-10-09T21:07:24Z", "updated_at": "2023-03-07T05:34:56Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following talks about `Debug::fmt`, but is likely true of a lot more methods applied to arrays.\r\nTake the following code:\r\n```\r\nfn main() {\r\n    let a = [1, 2, 3];\r\n    let b = [1, 2, 3, 4];\r\n    let c = [1, 2, 3, 4, 5];\r\n    let d = [1, 2, 3, 4, 5, 6];\r\n    println!(\"{:?}\", a);\r\n    println!(\"{:?}\", b);\r\n    println!(\"{:?}\", c);\r\n    println!(\"{:?}\", d);\r\n}\r\n```\r\nCompiled with --release, you end up with 4 different functions for `core::array::<impl core::fmt::Debug for [T; N]>::fmt` (BTW, shouldn't they each have their N replaced by the actual number?). To add insult to injury, each of these have their loops unrolled, so the longer the array, the larger the function, up to 59 (!).\r\nAlmost ironically, building with `-C opt-level=1` generates 4 functions that create a slice and a separate, common, `fmt` function for it.\r\nThis is one of these cases where you'd probably want a `#[inline(never)]` at the call site in `core::array::<impl core::fmt::Debug for [T; N]>::fmt` if that were possible.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77767/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77767/timeline", "performed_via_github_app": null, "state_reason": null}