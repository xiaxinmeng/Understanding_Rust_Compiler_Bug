{"url": "https://api.github.com/repos/rust-lang/rust/issues/64651", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/64651/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/64651/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/64651/events", "html_url": "https://github.com/rust-lang/rust/issues/64651", "id": 496635222, "node_id": "MDU6SXNzdWU0OTY2MzUyMjI=", "number": 64651, "title": "Invalid `unreachable_code` in `async fn`.", "user": {"login": "Bunogi", "id": 15606718, "node_id": "MDQ6VXNlcjE1NjA2NzE4", "avatar_url": "https://avatars.githubusercontent.com/u/15606718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bunogi", "html_url": "https://github.com/Bunogi", "followers_url": "https://api.github.com/users/Bunogi/followers", "following_url": "https://api.github.com/users/Bunogi/following{/other_user}", "gists_url": "https://api.github.com/users/Bunogi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bunogi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bunogi/subscriptions", "organizations_url": "https://api.github.com/users/Bunogi/orgs", "repos_url": "https://api.github.com/users/Bunogi/repos", "events_url": "https://api.github.com/users/Bunogi/events{/privacy}", "received_events_url": "https://api.github.com/users/Bunogi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-09-21T09:21:17Z", "updated_at": "2019-09-21T12:29:11Z", "closed_at": "2019-09-21T12:29:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "From Rust `nightly-2019-09-16` to `nightly-2019-06-18`, something has caused the following code to start throwing an unreachable expression warning. Changing it from an `async fn` to an `fn` throws no warnings.\r\n\r\n```rust\r\nasync fn read_until(r: &mut std::net::TcpStream, byte: u8) -> io::Result<Vec<u8>> {\r\n    let mut buffer = Vec::new();\r\n    let mut single = [0; 1];\r\n    loop {\r\n        r.read(&mut single)?;\r\n        buffer.push(single[0]);\r\n        if single[0] == byte {\r\n            return Ok(buffer);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```\r\nerror: unreachable expression\r\n  --> src/main.rs:4:83\r\n   |\r\n4  |   async fn read_until(r: &mut std::net::TcpStream, byte: u8) -> io::Result<Vec<u8>> {\r\n   |  ___________________________________________________________________________________^\r\n5  | |     let mut buffer = Vec::new();\r\n6  | |     let mut single = [0; 1];\r\n7  | |     loop {\r\n...  |\r\n13 | |     }\r\n14 | | }\r\n   | |_^\r\nnote: lint level defined here\r\n  --> src/main.rs:3:8\r\n   |\r\n3  | #[deny(unreachable_code)]\r\n   |        ^^^^^^^^^^^^^^^^\r\n```\r\n\r\nA more recent nightly(2019-09-21) specifies the warning more closely:\r\n```\r\nwarning: unreachable expression\r\n  --> src/main.rs:3:83\r\n   |\r\n3  |   async fn read_until(r: &mut std::net::TcpStream, byte: u8) -> io::Result<Vec<u8>> {\r\n   |  ___________________________________________________________________________________^\r\n4  | |     let mut buffer = Vec::new();\r\n5  | |     let mut single = [0; 1];\r\n6  | |     loop {\r\n...  |\r\n12 | |     }\r\n13 | | }\r\n   | |_^\r\n   |\r\n   = note: `#[warn(unreachable_code)]` on by default\r\nnote: any code following this expression is unreachable\r\n  --> src/main.rs:6:5\r\n   |\r\n6  | /     loop {\r\n7  | |         r.read(&mut single)?;\r\n8  | |         buffer.push(single[0]);\r\n9  | |         if single[0] == byte {\r\n10 | |             return Ok(buffer);\r\n11 | |         }\r\n12 | |     }\r\n   | |_____^\r\n```\r\n```\r\n$: rustc --version --verbose\r\nrustc 1.39.0-nightly (7efe1c6e6 2019-09-17)\r\nbinary: rustc\r\ncommit-hash: 7efe1c6e678a263b9464f2e7f06f552b4d4db5a5\r\ncommit-date: 2019-09-17\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.39.0-nightly\r\nLLVM version: 9.0\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/64651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/64651/timeline", "performed_via_github_app": null, "state_reason": "completed"}