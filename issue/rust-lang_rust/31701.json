{"url": "https://api.github.com/repos/rust-lang/rust/issues/31701", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31701/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31701/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31701/events", "html_url": "https://github.com/rust-lang/rust/issues/31701", "id": 133946071, "node_id": "MDU6SXNzdWUxMzM5NDYwNzE=", "number": 31701, "title": "Not sufficiently useful error message when FnMut is needed instead of Fn", "user": {"login": "eugene-bulkin", "id": 3990681, "node_id": "MDQ6VXNlcjM5OTA2ODE=", "avatar_url": "https://avatars.githubusercontent.com/u/3990681?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eugene-bulkin", "html_url": "https://github.com/eugene-bulkin", "followers_url": "https://api.github.com/users/eugene-bulkin/followers", "following_url": "https://api.github.com/users/eugene-bulkin/following{/other_user}", "gists_url": "https://api.github.com/users/eugene-bulkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/eugene-bulkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eugene-bulkin/subscriptions", "organizations_url": "https://api.github.com/users/eugene-bulkin/orgs", "repos_url": "https://api.github.com/users/eugene-bulkin/repos", "events_url": "https://api.github.com/users/eugene-bulkin/events{/privacy}", "received_events_url": "https://api.github.com/users/eugene-bulkin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-02-16T10:49:22Z", "updated_at": "2020-02-11T20:48:26Z", "closed_at": "2020-02-11T20:48:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "This code:\n\n``` rust\nfn counter() -> Box<Fn() -> usize> {\n    let mut x = 0;\n    Box::new(move || {\n        x += 1;\n        x\n    })\n}\n```\n\nresults in [the following error messages](https://play.rust-lang.org/?gist=7381046af7c70d49d344&version=stable) in stable:\n\n```\n<anon>:4:9: 4:15 error: cannot assign to captured outer variable in an `Fn` closure\n<anon>:4         x += 1;\n                 ^~~~~~\n<anon>:3:14: 6:6 help: consider changing this closure to take self by mutable reference\n<anon>:3     Box::new(move || {\n<anon>:4         x += 1;\n<anon>:5         x\n<anon>:6     })\n```\n\nThe problem here is that we're using `Fn()` instead of `FnMut()`, but the phrase \"consider changing this closure to take self by mutable reference\" is not particularly useful in telling us that that specifically is the problem. That is, the fact that we cannot assign to the captured outer variable is because we are trying to return `Box<Fn() -> usize>` instead of `Box<FnMut() -> usize>`, but that's not immediately clear from the original error message.\n\nI'm not _entirely_ sure how this would be rectified, but at the very least mentioning `FnMut` somewhere would be useful. @eddyb mentioned that this issue was \"because a bound/trait object of `Fn()` was used but only `FnMut()` allows mutable borrows\", so I think some variation on that would be reasonably sufficient to clarify the error.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31701/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31701/timeline", "performed_via_github_app": null, "state_reason": "completed"}