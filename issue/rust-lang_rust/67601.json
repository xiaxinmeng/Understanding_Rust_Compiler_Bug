{"url": "https://api.github.com/repos/rust-lang/rust/issues/67601", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67601/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67601/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67601/events", "html_url": "https://github.com/rust-lang/rust/issues/67601", "id": 542319363, "node_id": "MDU6SXNzdWU1NDIzMTkzNjM=", "number": 67601, "title": "Regression in Servo: \"internal compiler error: mutable allocation in constant\"", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 900795185, "node_id": "MDU6TGFiZWw5MDA3OTUxODU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-eval", "name": "A-const-eval", "color": "f7e101", "default": false, "description": "Area: constant evaluation (mir interpretation)"}], "state": "closed", "locked": false, "assignee": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2019-12-25T10:47:18Z", "updated_at": "2020-01-15T19:40:43Z", "closed_at": "2020-01-15T19:40:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://community-tc.services.mozilla.com/tasks/bdytAYuMTdWK1kbybZ6FWA/runs/0/logs/https%3A%2F%2Fcommunity-tc.services.mozilla.com%2Fapi%2Fqueue%2Fv1%2Ftask%2FbdytAYuMTdWK1kbybZ6FWA%2Fruns%2F0%2Fartifacts%2Fpublic%2Flogs%2Flive.log#L1943\r\n\r\n```rust\r\n   --> /repo/target/debug/build/script-a3d7e9e184a37789/out/Bindings/ANGLEInstancedArraysBinding.rs:852:61\r\n    |\r\n852 |   const sMethods_specs: &'static [&'static[JSFunctionSpec]] = &[\r\n    |  _____________________________________________________________^\r\n853 | | &[\r\n854 | |     JSFunctionSpec {\r\n855 | |         name: b\"drawArraysInstancedANGLE\\0\" as *const u8 as *const libc::c_char,\r\n...   |\r\n882 | |\r\n883 | | ];\r\n    | |_^\r\n```\r\n\r\n(Many other occurrences)\r\n\r\n```rust\r\nerror: internal compiler error: mutable allocation in constant\r\n    --> /repo/target/debug/build/script-a3d7e9e184a37789/out/Bindings/XRWebGLLayerBinding.rs:1088:64\r\n     |\r\n1088 |   const sAttributes_specs: &'static [&'static[JSPropertySpec]] = &[\r\n     |  ________________________________________________________________^\r\n1089 | | &[\r\n1090 | |     JSPropertySpec {\r\n1091 | |         name: b\"context\\0\" as *const u8 as *const libc::c_char,\r\n...    |\r\n1203 | |\r\n1204 | | ];\r\n     | |_^\r\nthread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:349:17\r\nstack backtrace:\r\n   0: backtrace::backtrace::libunwind::trace\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88\r\n   1: backtrace::backtrace::trace_unsynchronized\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/mod.rs:66\r\n   2: std::sys_common::backtrace::_print_fmt\r\n             at src/libstd/sys_common/backtrace.rs:77\r\n   3: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n             at src/libstd/sys_common/backtrace.rs:59\r\n   4: core::fmt::write\r\n             at src/libcore/fmt/mod.rs:1057\r\n   5: std::io::Write::write_fmt\r\n             at src/libstd/io/mod.rs:1426\r\n   6: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:62\r\n   7: std::sys_common::backtrace::print\r\n             at src/libstd/sys_common/backtrace.rs:49\r\n   8: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/panicking.rs:195\r\n   9: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\n  10: rustc_driver::report_ice\r\n  11: <alloc::boxed::Box<F> as core::ops::function::Fn<A>>::call\r\n             at /rustc/a9c1c04e986dbf610be8cbe6a8107f90b4db61ce/src/liballoc/boxed.rs:1029\r\n  12: proc_macro::bridge::client::<impl proc_macro::bridge::Bridge>::enter::{{closure}}::{{closure}}\r\n             at /rustc/a9c1c04e986dbf610be8cbe6a8107f90b4db61ce/src/libproc_macro/bridge/client.rs:305\r\n  13: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:476\r\n  14: std::panicking::begin_panic\r\n  15: <rustc_errors::HandlerInner as core::ops::drop::Drop>::drop\r\n  16: core::ptr::real_drop_in_place\r\n  17: core::ptr::real_drop_in_place\r\n  18: core::ptr::real_drop_in_place\r\n  19: rustc_interface::interface::run_compiler_in_existing_thread_pool\r\n  20: std::thread::local::LocalKey<T>::with\r\n  21: scoped_tls::ScopedKey<T>::set\r\n  22: syntax::with_globals\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nerror: internal compiler error: unexpected panic\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\nnote: rustc 1.42.0-nightly (a9c1c04e9 2019-12-24) running on x86_64-unknown-linux-gnu\r\nnote: compiler flags: -C debuginfo=2 -C link-args=-fuse-ld=gold --crate-type rlib\r\nnote: some of the compiler flags provided by cargo are hidden\r\nquery stack during panic:\r\nend of query stack\r\nerror: could not compile `script`.\r\n```\r\n\r\nThe crate uses `#![feature(const_fn)]`.\r\n\r\nExample of one of the affected `const` items:\r\n\r\n```rust\r\nconst sMethods_specs: &'static [&'static[JSFunctionSpec]] = &[\r\n&[\r\n    JSFunctionSpec {\r\n        name: b\"getViewport\\0\" as *const u8 as *const libc::c_char,\r\n        call: JSNativeWrapper { \r\n            // `generic_method` is a free function\r\n            op: Some(generic_method),\r\n            // getViewport_methodinfo is a const item\r\n            info: &getViewport_methodinfo as *const _ as *const JSJitInfo\r\n        },\r\n        nargs: 1,\r\n        flags: (JSPROP_ENUMERATE) as u16,\r\n        selfHostedName: 0 as *const libc::c_char\r\n    },\r\n    JSFunctionSpec {\r\n        name: 0 as *const libc::c_char,\r\n        call: JSNativeWrapper { \r\n            op: None, \r\n            info: 0 as *const JSJitInfo\r\n        },\r\n        nargs: 0,\r\n        flags: 0,\r\n        selfHostedName: 0 as *const libc::c_char\r\n    }\r\n]\r\n];\r\n```\r\n\r\nDefinitions of types involved:\r\n\r\n```rust\r\npub struct JSFunctionSpec {\r\n    pub name: *const i8,\r\n    pub call: JSNativeWrapper,\r\n    pub nargs: u16,\r\n    pub flags: u16,\r\n    pub selfHostedName: *const i8,\r\n}\r\npub struct JSNativeWrapper {\r\n    pub op: Option<unsafe extern \"C\" fn(*mut JSContext, u32, *mut Value) -> bool>,\r\n    pub info: *const JSJitInfo,\r\n}\r\npub struct JSJitInfo {\r\n    pub call: *const c_void,\r\n    pub protoID: u16,\r\n    pub depth: u16,\r\n    pub _bitfield_1: u32,\r\n}\r\n```\r\n\r\nRegression range:\r\n\r\ngit log --merges --oneline 9ae6cedb8...a9c1c04e9 \r\na9c1c04e986 Auto merge of #67241 - mark-i-m:simplify-borrow_check-3, r=matthewjasper\r\nf6dca76be55 Auto merge of #66221 - ohadravid:doc-constants, r=Dylan-DPC\r\n84d8f9ddd38 Auto merge of #67579 - RalfJung:miri, r=RalfJung\r\n625375400cd Auto merge of #67575 - Centril:rollup-feikoir, r=Centril\r\na76d67f22f0 Rollup merge of #67572 - aidanhs:aphs-choco-direct-cdn, r=Mark-Simulacrum\r\n20d5df91f46 Rollup merge of #67569 - Mark-Simulacrum:opt-char-encode, r=oli-obk\r\n75b27ef59cd Rollup merge of #67561 - euclio:remove-description, r=jonas-schievink\r\na75968a7829 Rollup merge of #67551 - ldm0:E0627, r=Dylan-DPC\r\nd130e8d5509 Rollup merge of #67547 - GuillaumeGomez:cleanup-err-codes, r=Dylan-DPC\r\n07effe18b01 Rollup merge of #67543 - JohnTitor:regression-tests, r=Centril\r\n1ac8fc76d4b Rollup merge of #67337 - oli-obk:no_mut_static_ref_from_const, r=RalfJung\r\na4cd03dee2b Auto merge of #66296 - Centril:bindings_after_at-init, r=pnkfelix\r\n\r\n\r\nThe error message appears to be from https://github.com/rust-lang/rust/pull/67337, cc @oli-obk \r\n\r\nIf this (modulo ICE vs proper diagnostic) is not a rustc bug, I don\u2019t understand what change we\u2019re supposed to make to this code. I don\u2019t see any heap allocation or mutability happening.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67601/timeline", "performed_via_github_app": null, "state_reason": "completed"}