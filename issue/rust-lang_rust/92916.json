{"url": "https://api.github.com/repos/rust-lang/rust/issues/92916", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92916/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92916/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92916/events", "html_url": "https://github.com/rust-lang/rust/issues/92916", "id": 1104268022, "node_id": "I_kwDOAAsO6M5B0cr2", "number": 92916, "title": "rustdoc: make tests easier to understand and fix", "user": {"login": "jsha", "id": 220205, "node_id": "MDQ6VXNlcjIyMDIwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/220205?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsha", "html_url": "https://github.com/jsha", "followers_url": "https://api.github.com/users/jsha/followers", "following_url": "https://api.github.com/users/jsha/following{/other_user}", "gists_url": "https://api.github.com/users/jsha/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsha/subscriptions", "organizations_url": "https://api.github.com/users/jsha/orgs", "repos_url": "https://api.github.com/users/jsha/repos", "events_url": "https://api.github.com/users/jsha/events{/privacy}", "received_events_url": "https://api.github.com/users/jsha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-01-15T01:43:14Z", "updated_at": "2022-01-15T18:33:02Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Rustdoc's tests fail easily, and it's not always easy to figure out _why_ they are failing and how to fix them. That presents a barrier to participation, which we should fix. Some ideas:\r\n\r\nFor the XPath tests:\r\n - When we fail to find a match, we should print what part of the XPath expression (if any) matched, and what part failed to match.\r\n - If we got a partial path match, we should print a summary of the elements at the next level below.\r\n - If we find the appropriate element but fail the text match, we should print the actual text we found (with some limit, say 100 characters).\r\n  - Failed tests should print the full path to the HTML file, so people can check against it.\r\n  - We should offer a command line tool that can take an HTML file and an XPath expression, and run a match without the full overhead of building and running the tests.\r\n\r\nFor the browser UI tests: We should offer a debugging mode, accessible from x.py, for instance:\r\n\r\n```\r\n./x.py test src/test/rustdoc-gui/anchors.goml  --debug\r\n```\r\n\r\nThis should (a) turn on headless mode, (b) turn on --show-text, and (c) stop on assertion errors, but leave the browser open so the user can evaluate what went wrong.\r\n\r\nIn general:\r\n\r\nIn the [Rustdoc overview](https://rustc-dev-guide.rust-lang.org/rustdoc.html) we should include instructions for installing all tools that are used when locally debugging tests: node, npm, tidy, and configuring a git pager with `git config --global core.pager less`.\r\n\r\nWe should also consider whether the \"diff against nightly\" is useful to show whenever an XPath test fails. Personally I've never used it; I've also heard people say they want it. It obscures the \"normal\" error output. Maybe it should be a debugging flag?\r\n\r\n@pierwill, you recently worked on getting rustdoc tests to pass after a big change. Do you have any thoughts on what might have made it a better process?", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92916/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92916/timeline", "performed_via_github_app": null, "state_reason": null}