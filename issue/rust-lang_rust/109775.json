{"url": "https://api.github.com/repos/rust-lang/rust/issues/109775", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109775/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109775/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109775/events", "html_url": "https://github.com/rust-lang/rust/issues/109775", "id": 1647816650, "node_id": "I_kwDOAAsO6M5iN6_K", "number": 109775, "title": "Nightly segfaults when compiling Zenoh with non-zero `opt-level`", "user": {"login": "p-avital", "id": 6801863, "node_id": "MDQ6VXNlcjY4MDE4NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/6801863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/p-avital", "html_url": "https://github.com/p-avital", "followers_url": "https://api.github.com/users/p-avital/followers", "following_url": "https://api.github.com/users/p-avital/following{/other_user}", "gists_url": "https://api.github.com/users/p-avital/gists{/gist_id}", "starred_url": "https://api.github.com/users/p-avital/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/p-avital/subscriptions", "organizations_url": "https://api.github.com/users/p-avital/orgs", "repos_url": "https://api.github.com/users/p-avital/repos", "events_url": "https://api.github.com/users/p-avital/events{/privacy}", "received_events_url": "https://api.github.com/users/p-avital/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2023-03-30T15:06:35Z", "updated_at": "2023-04-06T12:39:13Z", "closed_at": "2023-04-06T12:15:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nBuilding [Zenoh](https://github.com/eclipse-zenoh/zenoh) in release mode with a freshly updated nightly fails with a SIGSEGV (or STATUS_ACCESS_VIOLATION on Windows). This doesn't occur on `stable` or `beta`, or when building with any profile that has `opt-level=0`.\r\n\r\nI stumbled upon this while trying to measure the performance impact of #109706, which branches from `master` at 82bfda848e28d7616c7045d7ced8cee88d2d1a8f and suffers from the same issue.\r\n\r\n### Reproduction\r\nI don't know why, but the problem only appears on `zenoh` (that I'm aware of): `cargo +nightly build --release -p zenoh --lib` fails, while any other crate within the same repo works (provided they don't depend on `zenoh`)?\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.70.0-nightly (17c116721 2023-03-29)\r\nbinary: rustc\r\ncommit-hash: 17c11672167827b0dd92c88ef69f24346d1286dd\r\ncommit-date: 2023-03-29\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.70.0-nightly\r\nLLVM version: 16.0.0\r\n```\r\nThe same issue arises with the same version of nightly on Windows.\r\n\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nCaused by:\r\n  process didn't exit successfully: \r\n  `rustc \r\n    --crate-name zenoh \r\n    --edition=2018 \r\n    zenoh/src/lib.rs \r\n    --error-format=json \r\n    --json=diagnostic-rendered-ansi,artifacts,future-incompat \r\n    --diagnostic-width=114 \r\n    --crate-type lib \r\n    --emit=dep-info,metadata,link \r\n    -C opt-level=3 \r\n    -C panic=abort \r\n    -C linker-plugin-lto \r\n    -C codegen-units=1 \r\n    -C metadata=0031528ae864209c \r\n    -C extra-filename=-0031528ae864209c \r\n    --out-dir /home/pavital/git/rust/zenoh/target/release/deps\r\n    -L dependency=/home/pavital/git/rust/zenoh/target/release/deps\r\n    --extern async_global_executor=/home/pavital/git/rust/zenoh/target/release/deps/libasync_global_executor-1ff61112e28e1cbe.rmeta\r\n    --extern async_std=/home/pavital/git/rust/zenoh/target/release/deps/libasync_std-988e36f19cc5e2ed.rmeta\r\n    --extern async_trait=/home/pavital/git/rust/zenoh/target/release/deps/libasync_trait-93e7e0bbadac263e.so\r\n    --extern base64=/home/pavital/git/rust/zenoh/target/release/deps/libbase64-ea1eeec642ade256.rmeta\r\n    --extern env_logger=/home/pavital/git/rust/zenoh/target/release/deps/libenv_logger-8ccda1eafc995615.rmeta\r\n    --extern event_listener=/home/pavital/git/rust/zenoh/target/release/deps/libevent_listener-3cc31ad51f48aeba.rmeta\r\n    --extern flume=/home/pavital/git/rust/zenoh/target/release/deps/libflume-0da401bed33d29f8.rmeta\r\n    --extern form_urlencoded=/home/pavital/git/rust/zenoh/target/release/deps/libform_urlencoded-1115dac3759b1eb9.rmeta\r\n    --extern futures=/home/pavital/git/rust/zenoh/target/release/deps/libfutures-aeea74045a0a57a3.rmeta\r\n    --extern git_version=/home/pavital/git/rust/zenoh/target/release/deps/libgit_version-6d4abc185706ef2a.rmeta\r\n    --extern hex=/home/pavital/git/rust/zenoh/target/release/deps/libhex-bb0526b7e1586bc0.rmeta\r\n    --extern lazy_static=/home/pavital/git/rust/zenoh/target/release/deps/liblazy_static-fb13441a6070ae9c.rmeta\r\n    --extern log=/home/pavital/git/rust/zenoh/target/release/deps/liblog-19ee123d01638ee4.rmeta\r\n    --extern ordered_float=/home/pavital/git/rust/zenoh/target/release/deps/libordered_float-f568c8820d0c7ab9.rmeta\r\n    --extern petgraph=/home/pavital/git/rust/zenoh/target/release/deps/libpetgraph-e0fdf141ecd952f4.rmeta\r\n    --extern rand=/home/pavital/git/rust/zenoh/target/release/deps/librand-4e2123fd0a11d27b.rmeta\r\n    --extern regex=/home/pavital/git/rust/zenoh/target/release/deps/libregex-beca65602df09da3.rmeta\r\n    --extern serde=/home/pavital/git/rust/zenoh/target/release/deps/libserde-0fb1376baeee33d4.rmeta\r\n    --extern serde_json=/home/pavital/git/rust/zenoh/target/release/deps/libserde_json-a53251bca4e05b29.rmeta\r\n    --extern socket2=/home/pavital/git/rust/zenoh/target/release/deps/libsocket2-82cb53684de5bbe7.rmeta\r\n    --extern stop_token=/home/pavital/git/rust/zenoh/target/release/deps/libstop_token-a05424a00cf2bbf4.rmeta\r\n    --extern uhlc=/home/pavital/git/rust/zenoh/target/release/deps/libuhlc-b2b1cc63d4b7b253.rmeta\r\n    --extern uuid=/home/pavital/git/rust/zenoh/target/release/deps/libuuid-ba935db1ddb3f729.rmeta\r\n    --extern vec_map=/home/pavital/git/rust/zenoh/target/release/deps/libvec_map-7a8f92fcd8ca5e85.rmeta\r\n    --extern zenoh_buffers=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_buffers-084660677c4f0082.rmeta\r\n    --extern zenoh_cfg_properties=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_cfg_properties-628750cc8b8f4b9b.rmeta\r\n    --extern zenoh_codec=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_codec-a47eb37f50ae40e2.rmeta\r\n    --extern zenoh_collections=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_collections-342b78e0301634a0.rmeta\r\n    --extern zenoh_config=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_config-6294abe5fa7c190e.rmeta\r\n    --extern zenoh_core=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_core-08b193df4349611e.rmeta\r\n    --extern zenoh_crypto=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_crypto-445a326e5ed1c9f1.rmeta\r\n    --extern zenoh_link=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_link-1e8bcec95b945ac3.rmeta\r\n    --extern zenoh_macros=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_macros-075096dd04145b56.so\r\n    --extern zenoh_plugin_trait=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_plugin_trait-ae545a53b834ba08.rmeta\r\n    --extern zenoh_protocol=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_protocol-c05ff2f9ec9e06d3.rmeta\r\n    --extern zenoh_result=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_result-2846391fcffcb2a9.rmeta\r\n    --extern zenoh_sync=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_sync-e3e8a288f21b29c4.rmeta\r\n    --extern zenoh_transport=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_transport-f45b981e4d814715.rmeta\r\n    --extern zenoh_util=/home/pavital/git/rust/zenoh/target/release/deps/libzenoh_util-81eff5acfd2db5b9.rmeta`\r\n  (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109775/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109775/timeline", "performed_via_github_app": null, "state_reason": "completed"}