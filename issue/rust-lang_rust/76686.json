{"url": "https://api.github.com/repos/rust-lang/rust/issues/76686", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/76686/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/76686/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/76686/events", "html_url": "https://github.com/rust-lang/rust/issues/76686", "id": 700653263, "node_id": "MDU6SXNzdWU3MDA2NTMyNjM=", "number": 76686, "title": "btree_map::OccupiedEntry: Send regression", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 166999014, "node_id": "MDU6TGFiZWwxNjY5OTkwMTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-collections", "name": "A-collections", "color": "f7e101", "default": false, "description": "Area: std::collections."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1966877457, "node_id": "MDU6TGFiZWwxOTY2ODc3NDU3", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-critical", "name": "P-critical", "color": "eb6420", "default": false, "description": "Critical priority"}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/75", "html_url": "https://github.com/rust-lang/rust/milestone/75", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/75/labels", "id": 5804350, "node_id": "MDk6TWlsZXN0b25lNTgwNDM1MA==", "number": 75, "title": "1.48.0", "description": "", "creator": {"login": "Dylan-DPC-zz", "id": 12371125, "node_id": "MDQ6VXNlcjEyMzcxMTI1", "avatar_url": "https://avatars.githubusercontent.com/u/12371125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC-zz", "html_url": "https://github.com/Dylan-DPC-zz", "followers_url": "https://api.github.com/users/Dylan-DPC-zz/followers", "following_url": "https://api.github.com/users/Dylan-DPC-zz/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC-zz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC-zz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC-zz/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC-zz/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC-zz/repos", "events_url": "https://api.github.com/users/Dylan-DPC-zz/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC-zz/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 628, "state": "closed", "created_at": "2020-08-24T15:11:39Z", "updated_at": "2021-02-05T02:09:05Z", "due_on": "2020-11-18T08:00:00Z", "closed_at": "2020-12-10T18:36:41Z"}, "comments": 4, "created_at": "2020-09-13T21:38:27Z", "updated_at": "2020-09-20T13:07:06Z", "closed_at": "2020-09-20T13:07:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "The code below does not compile on new versions of `rustc` (bisect below)\r\n\r\n```rust\r\nuse std::collections::{btree_map::Entry, BTreeMap};\r\nuse std::thread::spawn;\r\n\r\nfn main() {\r\n    let map = BTreeMap::<i32, i32>::new();\r\n    let map = Box::leak(Box::new(map));\r\n\r\n    match map.entry(1) {\r\n        Entry::Occupied(entry) => {\r\n            spawn(move || {\r\n                entry.get();\r\n            });\r\n        }\r\n        _ => (),\r\n    }\r\n}\r\n\r\n```\r\n\r\n```\r\nerror[E0277]: `NonNull<BTreeMap<i32, i32>>` cannot be sent between threads safely\r\n   --> src/main.rs:10:13\r\n    |\r\n10  |               spawn(move || {\r\n    |  _____________^^^^^_-\r\n    | |             |\r\n    | |             `NonNull<BTreeMap<i32, i32>>` cannot be sent between threads safely\r\n11  | |                 entry.get();\r\n12  | |             });\r\n    | |_____________- within this `[closure@src/main.rs:10:19: 12:14 entry:std::collections::btree_map::OccupiedEntry<'_, i32, i32>]`\r\n    | \r\n   ::: /home/antek/.local/opt/rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/thread/mod.rs:596:8\r\n    |\r\n596 |       F: Send + 'static,\r\n    |          ---- required by this bound in `spawn`\r\n    |\r\n    = help: within `[closure@src/main.rs:10:19: 12:14 entry:std::collections::btree_map::OccupiedEntry<'_, i32, i32>]`, the trait `Send` is not implemented for `NonNull<BTreeMap<i32, i32>>`\r\n    = note: required because it appears within the type `alloc::collections::btree::borrow::DormantMutRef<'_, BTreeMap<i32, i32>>`\r\n    = note: required because it appears within the type `std::collections::btree_map::OccupiedEntry<'_, i32, i32>`\r\n    = note: required because it appears within the type `[closure@src/main.rs:10:19: 12:14 entry:std::collections::btree_map::OccupiedEntry<'_, i32, i32>]`\r\n```\r\n\r\n### Bisect\r\nsearched nightlies: from nightly-2020-09-11 to nightly-2020-09-12\r\nregressed nightly: nightly-2020-09-12\r\nsearched commits: from https://github.com/rust-lang/rust/commit/a1947b3f9e2831e2060bc42f0c78e4a2bb67930a to https://github.com/rust-lang/rust/commit/99111606fcda4fdb0646e4f7ee0f6cbcb76fb84a\r\nregressed commit: https://github.com/rust-lang/rust/commit/ee04f9a4dac3e72914862e9f2046eee70aedcbfd\r\n\r\n<details>\r\n<summary>bisected with <a href='https://github.com/rust-lang/cargo-bisect-rustc'>cargo-bisect-rustc</a> v0.5.2</summary>\r\n\r\n\r\nHost triple: x86_64-unknown-linux-gnu\r\nReproduce with:\r\n```bash\r\ncargo bisect-rustc --start 2020-09-11 \r\n```\r\n</details>", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/76686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/76686/timeline", "performed_via_github_app": null, "state_reason": "completed"}