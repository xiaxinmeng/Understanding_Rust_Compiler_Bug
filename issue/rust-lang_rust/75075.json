{"url": "https://api.github.com/repos/rust-lang/rust/issues/75075", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75075/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75075/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75075/events", "html_url": "https://github.com/rust-lang/rust/issues/75075", "id": 671697373, "node_id": "MDU6SXNzdWU2NzE2OTczNzM=", "number": 75075, "title": "There is no cross-platform way to use `include_*!`", "user": {"login": "Shnatsel", "id": 291257, "node_id": "MDQ6VXNlcjI5MTI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/291257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Shnatsel", "html_url": "https://github.com/Shnatsel", "followers_url": "https://api.github.com/users/Shnatsel/followers", "following_url": "https://api.github.com/users/Shnatsel/following{/other_user}", "gists_url": "https://api.github.com/users/Shnatsel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Shnatsel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Shnatsel/subscriptions", "organizations_url": "https://api.github.com/users/Shnatsel/orgs", "repos_url": "https://api.github.com/users/Shnatsel/repos", "events_url": "https://api.github.com/users/Shnatsel/events{/privacy}", "received_events_url": "https://api.github.com/users/Shnatsel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2020-08-02T21:58:29Z", "updated_at": "2022-03-09T15:47:34Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Build scripts place their output in a folder created by Cargo. The path to it is passed in the environment variable `OUT_DIR` both to the build script and the main code. Since the file is placed in the directory, we need to add the path separator and then the name of the file. There seems to be no way to call `include_bytes!` with a platform-agnostic path separator, inserting `/` or `\\` depending on the host OS.\r\n\r\nThis works but is not portable: `include_bytes!(concat!(env!(\"OUT_DIR\"), \"/myfile\"));`\r\n\r\nThis doesn't work: `include_bytes!(concat!(env!(\"OUT_DIR\"), std::path::MAIN_SEPARATOR, \"myfile\"));` because `MAIN_SEPARATOR` is not a literal, and `concat!` only eats literals.\r\n\r\nI've tried to to assemble a `String` in `const fn`, but that doesn't work either because `String::push()` requires a mutable borrow which are unsable in `const fn`.\r\n\r\n`#[cfg(unix)]` and `#[cfg(windows)]` **sort of** work, but break on cross-compilation because [these `cfg` attributes look at the _target_ OS](https://doc.rust-lang.org/reference/conditional-compilation.html#unix-and-windows), and we need to add a separator that works on the _host_ OS.\r\n\r\nIt's weird that this is either impossible to accomplish or the way to do so is very obscure. I'd expect this to be a relatively common operation.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.46.0-beta.2 (6f959902b 2020-07-23)\r\nbinary: rustc\r\ncommit-hash: 6f959902b3103c49ca981fbc01871589c3498489\r\ncommit-date: 2020-07-23\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.46.0-beta.2\r\nLLVM version: 10.0\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75075/reactions", "total_count": 15, "+1": 13, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75075/timeline", "performed_via_github_app": null, "state_reason": null}