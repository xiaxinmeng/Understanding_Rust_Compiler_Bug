{"url": "https://api.github.com/repos/rust-lang/rust/issues/71498", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/71498/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/71498/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/71498/events", "html_url": "https://github.com/rust-lang/rust/issues/71498", "id": 606080213, "node_id": "MDU6SXNzdWU2MDYwODAyMTM=", "number": 71498, "title": "Bug or documentation issue with target.<target_triple>.llvm-config", "user": {"login": "jschwe", "id": 55576758, "node_id": "MDQ6VXNlcjU1NTc2NzU4", "avatar_url": "https://avatars.githubusercontent.com/u/55576758?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jschwe", "html_url": "https://github.com/jschwe", "followers_url": "https://api.github.com/users/jschwe/followers", "following_url": "https://api.github.com/users/jschwe/following{/other_user}", "gists_url": "https://api.github.com/users/jschwe/gists{/gist_id}", "starred_url": "https://api.github.com/users/jschwe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jschwe/subscriptions", "organizations_url": "https://api.github.com/users/jschwe/orgs", "repos_url": "https://api.github.com/users/jschwe/repos", "events_url": "https://api.github.com/users/jschwe/events{/privacy}", "received_events_url": "https://api.github.com/users/jschwe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-24T06:42:13Z", "updated_at": "2020-04-25T13:52:36Z", "closed_at": "2020-04-25T13:52:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nBuilding rust fails when using the following config.toml:\r\n\r\n```config.toml\r\n[target.x86_64-unknown-linux-gnu]\r\nllvm-config = \"/usr/lib/llvm-10/bin/llvm-config\"\r\n```\r\n\r\nI expected for the build to use the llvm installed via apt as [mentioned here](https://rustc-dev-guide.rust-lang.org/building/suggested.html#building-with-system-llvm) and [here](https://github.com/rust-lang/rust/blob/45c7838089576552391237bb41cdd3d46582d3e5/config.toml.example#L484)\r\n\r\nInstead, this happened: \r\n`error: expected a table, but found a string for `target.x86_64-unknown-linux-gnu.llvm-config` in /home/vagrant/.cargo/config.toml`\r\n\r\nWhen editing the config to contain a table:\r\n```config.toml\r\n[target.x86_64-unknown-linux-gnu]\r\nllvm-config = { abcdefg = \"/usr/lib/llvm-10/bin/llvm-config\" }\r\n```\r\nThe error then disappears, but the build proceeds to check out and build llvm from source.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nrust master branch at commit:\r\n```\r\n45c7838089576552391237bb41cdd3d46582d3e5\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\nI tested this in a fresh ubuntu bionic box using vagrant, provisioned as follows:\r\n<details><summary>Provisioning</summary>\r\n<p>\r\n\r\n```\r\n# apt-get update && apt-get upgrade -y\r\n# apt-get install -y git build-essential curl pkg-config libssl-dev \r\n#  apt-get install -y python\r\n# bash -c \"$(wget -O - https://apt.llvm.org/llvm.sh)\"\r\n$ mkdir ~/.cargo\r\n$ cp /vagrant/config.toml ~/.cargo/config.toml\r\n$ git clone git@github.com:rust-lang/rust.git\r\n$ cd rust\r\n$ ./x.py build\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<details><summary>build_output</summary>\r\n<p>\r\n\r\n```\r\nUpdating only changed submodules\r\nUpdating submodule src/tools/rust-installer\r\nSubmodule 'src/rust-installer' (https://github.com/rust-lang/rust-installer.git) registered for path 'src/tools/rust-installer'\r\nCloning into '/home/vagrant/rust/src/tools/rust-installer'...\r\nremote: Enumerating objects: 27, done.        \r\nremote: Counting objects: 100% (27/27), done.        \r\nremote: Compressing objects: 100% (22/22), done.        \r\nremote: Total 796 (delta 7), reused 13 (delta 4), pack-reused 769        \r\nReceiving objects: 100% (796/796), 245.41 KiB | 848.00 KiB/s, done.\r\nResolving deltas: 100% (484/484), done.\r\nSubmodule path 'src/tools/rust-installer': checked out '9f66c14c3f91a48a118c7817f434167b311c3515'\r\nUpdating submodule src/doc/nomicon\r\nSubmodule 'src/doc/nomicon' (https://github.com/rust-lang/nomicon.git) registered for path 'src/doc/nomicon'\r\nCloning into '/home/vagrant/rust/src/doc/nomicon'...\r\nremote: Enumerating objects: 70, done.        \r\nremote: Counting objects: 100% (70/70), done.        \r\nremote: Compressing objects: 100% (58/58), done.        \r\nremote: Total 1760 (delta 35), reused 29 (delta 12), pack-reused 1690        \r\nReceiving objects: 100% (1760/1760), 1.11 MiB | 1.07 MiB/s, done.\r\nResolving deltas: 100% (1157/1157), done.\r\nSubmodule path 'src/doc/nomicon': checked out '6eb24d6e9c0773d4aee68ed5fca121ce3cdf676a'\r\nUpdating submodule src/tools/cargo\r\nSubmodule 'src/tools/cargo' (https://github.com/rust-lang/cargo.git) registered for path 'src/tools/cargo'\r\nCloning into '/home/vagrant/rust/src/tools/cargo'...\r\nremote: Enumerating objects: 91, done.        \r\nremote: Counting objects: 100% (91/91), done.        \r\nremote: Compressing objects: 100% (64/64), done.        \r\nremote: Total 71643 (delta 33), reused 63 (delta 27), pack-reused 71552        \r\nReceiving objects: 100% (71643/71643), 26.36 MiB | 3.56 MiB/s, done.\r\nResolving deltas: 100% (51731/51731), done.\r\nSubmodule path 'src/tools/cargo': checked out '8751eb3010d4cdb5329b5a6bd2b6d765c95b0dca'\r\nUpdating submodule src/doc/reference\r\nSubmodule 'src/doc/reference' (https://github.com/rust-lang/reference.git) registered for path 'src/doc/reference'\r\nCloning into '/home/vagrant/rust/src/doc/reference'...\r\nremote: Enumerating objects: 14, done.        \r\nremote: Counting objects: 100% (14/14), done.        \r\nremote: Compressing objects: 100% (9/9), done.        \r\nremote: Total 7123 (delta 9), reused 6 (delta 5), pack-reused 7109        \r\nReceiving objects: 100% (7123/7123), 3.01 MiB | 2.72 MiB/s, done.\r\nResolving deltas: 100% (5136/5136), done.\r\nSubmodule path 'src/doc/reference': checked out '3ce94caed4cf967106c51ae86be5e098f7875f11'\r\nUpdating submodule src/doc/book\r\nSubmodule 'src/doc/book' (https://github.com/rust-lang/book.git) registered for path 'src/doc/book'\r\nCloning into '/home/vagrant/rust/src/doc/book'...\r\nremote: Enumerating objects: 30329, done.        \r\nremote: Total 30329 (delta 0), reused 0 (delta 0), pack-reused 30329        \r\nReceiving objects: 100% (30329/30329), 34.71 MiB | 3.50 MiB/s, done.\r\nResolving deltas: 100% (21471/21471), done.\r\nSubmodule path 'src/doc/book': checked out 'f5db319e0b19c22964398d56bc63103d669e1bba'\r\nUpdating submodule src/tools/rls\r\nSubmodule 'src/tools/rls' (https://github.com/rust-lang/rls.git) registered for path 'src/tools/rls'\r\nCloning into '/home/vagrant/rust/src/tools/rls'...\r\nremote: Enumerating objects: 11080, done.        \r\nremote: Total 11080 (delta 0), reused 0 (delta 0), pack-reused 11080        \r\nReceiving objects: 100% (11080/11080), 8.62 MiB | 2.49 MiB/s, done.\r\nResolving deltas: 100% (7228/7228), done.\r\nSubmodule path 'src/tools/rls': checked out '7de2a1f299f8744ffe109139f9f1fdf28bfec909'\r\nUpdating submodule src/tools/clippy\r\nSubmodule 'src/tools/clippy' (https://github.com/rust-lang/rust-clippy.git) registered for path 'src/tools/clippy'\r\nCloning into '/home/vagrant/rust/src/tools/clippy'...\r\nremote: Enumerating objects: 1, done.        \r\nremote: Counting objects: 100% (1/1), done.        \r\nremote: Total 61414 (delta 0), reused 1 (delta 0), pack-reused 61413        \r\nReceiving objects: 100% (61414/61414), 21.89 MiB | 2.44 MiB/s, done.\r\nResolving deltas: 100% (47680/47680), done.\r\nSubmodule path 'src/tools/clippy': checked out '891e1a859b52486936e021235fdc36fbdd9b4100'\r\nUpdating submodule src/tools/rustfmt\r\nSubmodule 'src/tools/rustfmt' (https://github.com/rust-lang/rustfmt.git) registered for path 'src/tools/rustfmt'\r\nCloning into '/home/vagrant/rust/src/tools/rustfmt'...\r\nremote: Enumerating objects: 51, done.        \r\nremote: Counting objects: 100% (51/51), done.        \r\nremote: Compressing objects: 100% (43/43), done.        \r\nremote: Total 30595 (delta 9), reused 18 (delta 4), pack-reused 30544        \r\nReceiving objects: 100% (30595/30595), 10.86 MiB | 2.46 MiB/s, done.\r\nResolving deltas: 100% (22297/22297), done.\r\nSubmodule path 'src/tools/rustfmt': checked out 'a5cb5d26833cfda6fa2ed35735448953f728bd5e'\r\nUpdating submodule src/tools/miri\r\nSubmodule 'src/tools/miri' (https://github.com/rust-lang/miri.git) registered for path 'src/tools/miri'\r\nCloning into '/home/vagrant/rust/src/tools/miri'...\r\nremote: Enumerating objects: 34, done.        \r\nremote: Counting objects: 100% (34/34), done.        \r\nremote: Compressing objects: 100% (24/24), done.        \r\nremote: Total 22046 (delta 12), reused 27 (delta 9), pack-reused 22012        \r\nReceiving objects: 100% (22046/22046), 5.78 MiB | 3.69 MiB/s, done.\r\nResolving deltas: 100% (14861/14861), done.\r\nSubmodule path 'src/tools/miri': checked out '26baf87e4300386910f9db7545edf784dbec88f0'\r\nUpdating submodule src/doc/rust-by-example\r\nSubmodule 'src/doc/rust-by-example' (https://github.com/rust-lang/rust-by-example.git) registered for path 'src/doc/rust-by-example'\r\nCloning into '/home/vagrant/rust/src/doc/rust-by-example'...\r\nremote: Enumerating objects: 75, done.        \r\nremote: Counting objects: 100% (75/75), done.        \r\nremote: Compressing objects: 100% (54/54), done.        \r\nremote: Total 327576 (delta 32), reused 44 (delta 20), pack-reused 327501        \r\nReceiving objects: 100% (327576/327576), 136.16 MiB | 4.14 MiB/s, done.\r\nResolving deltas: 100% (253322/253322), done.\r\nSubmodule path 'src/doc/rust-by-example': checked out 'c106d1683c3a2b0960f0f0fb01728cbb19807332'\r\nUpdating submodule src/stdarch\r\nSubmodule 'src/stdarch' (https://github.com/rust-lang/stdarch.git) registered for path 'src/stdarch'\r\nCloning into '/home/vagrant/rust/src/stdarch'...\r\nremote: Enumerating objects: 120, done.        \r\nremote: Counting objects: 100% (120/120), done.        \r\nremote: Compressing objects: 100% (88/88), done.        \r\nremote: Total 17788 (delta 53), reused 58 (delta 30), pack-reused 17668        \r\nReceiving objects: 100% (17788/17788), 6.25 MiB | 2.57 MiB/s, done.\r\nResolving deltas: 100% (14374/14374), done.\r\nSubmodule path 'src/stdarch': checked out 'b00ecbeb268ee97cef9fa9b2375e6f6cf0864db2'\r\nUpdating submodule src/doc/rustc-dev-guide\r\nSubmodule 'src/doc/rustc-dev-guide' (https://github.com/rust-lang/rustc-dev-guide.git) registered for path 'src/doc/rustc-dev-guide'\r\nCloning into '/home/vagrant/rust/src/doc/rustc-dev-guide'...\r\nremote: Enumerating objects: 149, done.        \r\nremote: Counting objects: 100% (149/149), done.        \r\nremote: Compressing objects: 100% (98/98), done.        \r\nremote: Total 5281 (delta 88), reused 58 (delta 49), pack-reused 5132        \r\nReceiving objects: 100% (5281/5281), 3.35 MiB | 3.04 MiB/s, done.\r\nResolving deltas: 100% (3765/3765), done.\r\nSubmodule path 'src/doc/rustc-dev-guide': checked out '7adfab42bab045a848126895c2f1e09927c1331a'\r\nUpdating submodule src/doc/edition-guide\r\nSubmodule 'src/doc/edition-guide' (https://github.com/rust-lang/edition-guide.git) registered for path 'src/doc/edition-guide'\r\nCloning into '/home/vagrant/rust/src/doc/edition-guide'...\r\nremote: Enumerating objects: 38, done.        \r\nremote: Counting objects: 100% (38/38), done.        \r\nremote: Compressing objects: 100% (25/25), done.        \r\nremote: Total 4527 (delta 17), reused 22 (delta 11), pack-reused 4489        \r\nReceiving objects: 100% (4527/4527), 4.00 MiB | 3.17 MiB/s, done.\r\nResolving deltas: 100% (3272/3272), done.\r\nSubmodule path 'src/doc/edition-guide': checked out '8204c1d123472cd17f0c1c5c77300ae802eb0271'\r\nUpdating submodule src/llvm-project\r\nSubmodule 'src/llvm-project' (https://github.com/rust-lang/llvm-project.git) registered for path 'src/llvm-project'\r\nCloning into '/home/vagrant/rust/src/llvm-project'...\r\nremote: Enumerating objects: 23105, done.        \r\nremote: Counting objects: 100% (23105/23105), done.        \r\nremote: Compressing objects: 100% (3022/3022), done.        \r\nremote: Total 3710175 (delta 22659), reused 20083 (delta 20083), pack-reused 3687070        \r\nReceiving objects: 100% (3710175/3710175), 789.32 MiB | 4.16 MiB/s, done.\r\nResolving deltas: 100% (2997730/2997730), done.\r\nSubmodule path 'src/llvm-project': checked out '9f9da27fbdb0ba7d887f8d2521e082f12b009417'\r\nUpdating submodule src/doc/embedded-book\r\nSubmodule 'src/doc/embedded-book' (https://github.com/rust-embedded/book.git) registered for path 'src/doc/embedded-book'\r\nCloning into '/home/vagrant/rust/src/doc/embedded-book'...\r\nremote: Enumerating objects: 61, done.        \r\nremote: Counting objects: 100% (61/61), done.        \r\nremote: Compressing objects: 100% (21/21), done.        \r\nremote: Total 1865 (delta 34), reused 57 (delta 34), pack-reused 1804        \r\nReceiving objects: 100% (1865/1865), 1.81 MiB | 2.41 MiB/s, done.\r\nResolving deltas: 100% (1141/1141), done.\r\nSubmodule path 'src/doc/embedded-book': checked out '668fb07b6160b9c468f598e839c1e044db65de30'\r\nSubmodules updated in 402.20 seconds\r\ndownloading https://static.rust-lang.org/dist/2020-03-12/rust-std-beta-x86_64-unknown-linux-gnu.tar.gz\r\n######################################################################### 100.0%\r\nextracting /home/vagrant/rust/build/cache/2020-03-12/rust-std-beta-x86_64-unknown-linux-gnu.tar.gz\r\ndownloading https://static.rust-lang.org/dist/2020-03-12/rustc-beta-x86_64-unknown-linux-gnu.tar.gz\r\n######################################################################### 100.0%\r\nextracting /home/vagrant/rust/build/cache/2020-03-12/rustc-beta-x86_64-unknown-linux-gnu.tar.gz\r\ndownloading https://static.rust-lang.org/dist/2020-03-12/cargo-beta-x86_64-unknown-linux-gnu.tar.gz\r\n######################################################################### 100.0%\r\nextracting /home/vagrant/rust/build/cache/2020-03-12/cargo-beta-x86_64-unknown-linux-gnu.tar.gz\r\ndownloading https://static.rust-lang.org/dist/2020-01-31/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.gz\r\n######################################################################### 100.0%\r\nextracting /home/vagrant/rust/build/cache/2020-01-31/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.gz\r\nerror: expected a table, but found a string for `target.x86_64-unknown-linux-gnu.llvm-config` in /home/vagrant/.cargo/config.toml\r\nfailed to run: /home/vagrant/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo build --manifest-path /home/vagrant/rust/src/bootstrap/Cargo.toml\r\nBuild completed unsuccessfully in 0:07:00\r\n\r\n```\r\n\r\n</p>\r\n</details>", "closed_by": {"login": "jschwe", "id": 55576758, "node_id": "MDQ6VXNlcjU1NTc2NzU4", "avatar_url": "https://avatars.githubusercontent.com/u/55576758?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jschwe", "html_url": "https://github.com/jschwe", "followers_url": "https://api.github.com/users/jschwe/followers", "following_url": "https://api.github.com/users/jschwe/following{/other_user}", "gists_url": "https://api.github.com/users/jschwe/gists{/gist_id}", "starred_url": "https://api.github.com/users/jschwe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jschwe/subscriptions", "organizations_url": "https://api.github.com/users/jschwe/orgs", "repos_url": "https://api.github.com/users/jschwe/repos", "events_url": "https://api.github.com/users/jschwe/events{/privacy}", "received_events_url": "https://api.github.com/users/jschwe/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/71498/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/71498/timeline", "performed_via_github_app": null, "state_reason": "completed"}