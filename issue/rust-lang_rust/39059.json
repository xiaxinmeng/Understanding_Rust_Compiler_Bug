{"url": "https://api.github.com/repos/rust-lang/rust/issues/39059", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39059/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39059/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39059/events", "html_url": "https://github.com/rust-lang/rust/issues/39059", "id": 200792073, "node_id": "MDU6SXNzdWUyMDA3OTIwNzM=", "number": 39059, "title": "Removal of the lang feature gate tests whitelist", "user": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2017-01-14T09:11:48Z", "updated_at": "2017-03-09T10:52:48Z", "closed_at": "2017-03-09T10:41:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "PR #38914 has added a tidy check for gate tests in compile-fail for all unstable lang features, helping ensure that they are actually unstable. See also issue #22820.\r\n\r\nTo be recognized as gate test for a specific feature, tests either need to follow a naming scheme `feature-gate-NAME-OF-THE-FEAT.rs` or include a `// gate-test-NAME-OF-THE-FEAT` comment. For most of the currently present features, I could easily find matching tests in the test suite. Sadly, [there is still a whitelist](https://github.com/rust-lang/rust/blob/6fe23719feb20c25a8b2693d1f196e72d8da9af5/src/tools/tidy/src/features.rs#L168-L175) of currently 20 features for which it tolerates that it can't detect any gate tests.\r\n\r\nThe goal is to eliminate that whitelist, which this issue is tracking.\r\n\r\nThe features on the whitelist fall into the following categories:\r\n\r\n**Has already tests, they just need to be marked (found this out only on a second look):**\r\n\r\n* [x] `more_struct_aliases` \u2192 marked by PR #39243\r\n* [x] `custom_attribute` \u2192 marked by PR #39243\r\n* [x] `default_type_parameter_fallback` \u2192 marked by PR #39243\r\n* [x] `use_extern_macros` \u2192 marked by PR #39243\r\n* [x] `quote` \u2192 marked by PR #39250\r\n* [x] `macro_reexport` \u2192 marked by PR #39250\r\n* [x] `inclusive_range_syntax` \u2192 marked by PR #40031\r\n\r\n**Used nowhere in the codebase. Remove?**\r\n\r\n*got all removed by PR #39071*\r\n\r\n* [x] `safe_suggestion`\r\n* [x] `pushpop_unsafe`\r\n\r\n**Needs a test (or I just haven't found a suiting test to mark, even on second look):**\r\n\r\n* [x] `cfg_target_has_atomic` \u2192 got a test by #40150\r\n* [x] `simd` \u2192 got a test by #40101\r\n* [x] `abi_ptx`\u2192 got a test by #40168\r\n* [x] `const_indexing` \u2192 got a test by PR #39700\r\n* [x] `stmt_expr_attributes` \u2192 got a test by PR #40252\r\n* [x] `unwind_attributes` \u2192 got a test by PR #40279\r\n* [x] `static_recursion` \u2192 got a test by PR #39834\r\n* [x] `cfg_target_thread_local` \u2192 got a test by PR #40279\r\n* [x] `unboxed_closures` \u2192 got a test by PR #40047\r\n* [x] `staged_api` \u2192 got a test by PR #39772\r\n\r\n**Don't know what to do with this one. Any ideas?**\r\n\r\n* [x] `reflect` \u2192 removed by PR #39075\r\n\r\nThe \"Needs a test\" section is a good place for beginners to help out!\r\n\r\nYou basically need to:\r\n\r\n0. if you haven't already, read `CONTRIBUTING.md` and `COMPILER_TESTS.md`\r\n1. search in the `src/test/run-pass` suite for tests of that feature\r\n2. copy one of those tests over to the compile-fail suite\r\n3. rename it appropriately (`feature-gate-FEAT-NAME.rs`) and remove the `#![feature(...)]` line\r\n4. remove the feature from the whitelist\r\n5. test locally (`./x.py test src/tools/tidy` and `./x.py test src/test/compile-fail --test-args feature-gate-FEAT-NAME`)\r\n5. submit a PR!\r\n\r\nIt would also be very good if you searched the `compile-fail` testsuite for already existing gate tests and mark those instead. A good place to look is the PR that introduced that feature, they usually also add gate tests.\r\n\r\nYou can help out in the \"Has already tests\" section as well. Here, contributing is even easier!\r\n\r\nYou'll need to:\r\n\r\n0. read `CONTRIBUTING.md` and `COMPILER_TESTS.md` (second one is not strictly required, but it never harms :D)\r\n1. add a line with `// gate-test-FEATURE_NAME` to the files that were mentioned above\r\n2. remove the feature from the whitelist\r\n3. test locally (`./x.py test src/tools/tidy`, since you only added comments)\r\n4. submit a PR!\r\n\r\nIf you need help, ask in this thread. Also, its best to prevent duplicate work, so it would be nice if you could announce that you work on some of the items. Thanks in advance!", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39059/timeline", "performed_via_github_app": null, "state_reason": "completed"}