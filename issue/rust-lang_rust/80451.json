{"url": "https://api.github.com/repos/rust-lang/rust/issues/80451", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80451/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80451/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80451/events", "html_url": "https://github.com/rust-lang/rust/issues/80451", "id": 775552561, "node_id": "MDU6SXNzdWU3NzU1NTI1NjE=", "number": 80451, "title": "Cross-compilation x86_64-unknown-freebsd -> aarch64-unknown-freebsd failing at the Vendoring step fo `ar`: \"failed to sync\", \"failed to write `vendor/ar/.cargo-checksum.json`\"", "user": {"login": "nguiard", "id": 8525852, "node_id": "MDQ6VXNlcjg1MjU4NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/8525852?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nguiard", "html_url": "https://github.com/nguiard", "followers_url": "https://api.github.com/users/nguiard/followers", "following_url": "https://api.github.com/users/nguiard/following{/other_user}", "gists_url": "https://api.github.com/users/nguiard/gists{/gist_id}", "starred_url": "https://api.github.com/users/nguiard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nguiard/subscriptions", "organizations_url": "https://api.github.com/users/nguiard/orgs", "repos_url": "https://api.github.com/users/nguiard/repos", "events_url": "https://api.github.com/users/nguiard/events{/privacy}", "received_events_url": "https://api.github.com/users/nguiard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-12-28T19:26:53Z", "updated_at": "2021-10-12T01:58:36Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "So I'm actually not sure that this is cross-compilation related, it appears when vendoring `ar` at the `x.py dist` step on a FreeBSD12.1-RELEASE-p1 VM. Kinda looks like a maybe simple `No such file or directory`, however I'm very new to building Rust so I'm not sure. Probably the most relevant output would be:\r\n\r\n(last lines of output from `x.py dist`):\r\n```\r\n[...]\r\n   Vendoring anyhow v1.0.32 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.32) to vendor/anyhow-1.0.32\r\n   Vendoring anyhow v1.0.34 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.34) to vendor/anyhow\r\n   Vendoring anymap v0.12.1 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anymap-0.12.1) to vendor/anymap\r\n   Vendoring ar v0.8.0 (https://github.com/bjorn3/rust-ar.git?branch=do_not_remove_cg_clif_ranlib#de9ab0e5) (/home/nicolas/.cargo/git/checkouts/rust-ar-9b35aff8ad678e06/de9ab0e) to vendor/ar\r\nerror: failed to sync\r\n\r\nCaused by:\r\n  failed to write `vendor/ar/.cargo-checksum.json`\r\n\r\nCaused by:\r\n  No such file or directory (os error 2)\r\n\r\n\r\ncommand did not execute successfully: \"/usr/home/nicolas/Projects/rust/buildrust/rust/build/x86_64-unknown-freebsd/stage0/bin/cargo\" \"vendor\" \"--sync\" \"/usr/home/nicolas/Projects/rust/buildrust/rust/./src/tools/rust-analyzer/Cargo.toml\" \"/usr/home/nicolas/Projects/rust/buildrust/rust/./compiler/rustc_codegen_cranelift/Cargo.toml\"\r\nexpected success, got: exit code: 101\r\n\r\n\r\nfailed to run: /usr/home/nicolas/Projects/rust/buildrust/rust/build/bootstrap/debug/bootstrap dist --config aarch64.toml -j 16\r\nBuild completed unsuccessfully in 0:07:05\r\n```\r\n\r\nMaybe that's sufficient for you guys to get an idea of the problem?\r\n\r\n### Much more (maybe unnecessary) details:\r\n\r\nI'm trying to cross-compile on a FreeBSD 12.1-RELEASE-p1 (x86_64) VM for aarch64-unknown-freebsd. More precisely, I am trying to, at the same time, get a (x86_64 -> aarch64) and an (aarch64 -> aarch64) rustc, both compiled on x86_64-unknown-freebsd.\r\n\r\nMy build environment appears to be mostly set up right at this point, as most of the build is working, but I'm having a hard time completing it. I am unsure if the best place to ask is here or on the FreeBSD mailing lists.\r\n\r\nIt seems the build actually produced the `rustc` and `std` lib. I tested running both the x86_64 and aarch64 produced `rustc` with `rustc --version` on their respective platforms, and they run.\r\n\r\n### My steps\r\n\r\nAfter setting up the FreeBSD build environment for aarch64 approximately as indicated [here](https://gist.github.com/dumbbell/b587da50ef014078da9e732a4331ebad) (approximately because the doc is a bit dated), the `build` step works fine with this command:\r\n```\r\nCC_aarch64_unknown_freebsd=aarch64-unknown-freebsd-clang \\\r\nCXX_aarch64_unknown_freebsd=aarch64-unknown-freebsd-clang++ \\\r\npython3.7 ./x.py build --config aarch64.toml -j 16\r\n```\r\n\r\nMy `aarch64.toml` mostly follows the document linked, but that document dates from a few years back, so I had to modify the config a bit to overcome the first build issues.\r\n```toml\r\nchangelog-seen = 2\r\n\r\n[build]\r\n\r\nhost = [\"x86_64-unknown-freebsd\", \"aarch64-unknown-freebsd\"]\r\n\r\ntarget = [\"aarch64-unknown-freebsd\"]\r\n\r\nsubmodules = false\r\n\r\n[llvm]\r\nldflags = \"-lz\"\r\n\r\n[rust]\r\nchannel = \"nightly\"\r\n\r\n# I commented this out. It was used in the doc linked above but made the compilation fail quickly\r\n# saying that \"host\" was not expected here.\r\n# The author talks about two patches he provided that I've been unable to find them. However, as\r\n# the article is a bit old I figured maybe I'd try just commenting the block out, and it got me way further\r\n# into the compilation.\r\n#[host.aarch64-unknown-freebsd]\r\n#cc = \"aarch64-unknown-freebsd-clang\"\r\n#cxx = \"aarch64-unknown-freebsd-clang++\"\r\n\r\n[target.aarch64-unknown-freebsd]\r\ncc = \"aarch64-unknown-freebsd-clang\"\r\ncxx = \"aarch64-unknown-freebsd-clang++\"\r\n```\r\n\r\nThe `dist` step:\r\n\r\n```\r\nCC_aarch64_unknown_freebsd=aarch64-unknown-freebsd-clang \\\r\nCXX_aarch64_unknown_freebsd=aarch64-unknown-freebsd-clang++ \\\r\npython3.7 ./x.py build --config aarch64.toml -j 16\r\n```\r\n\r\nProduces this output:\r\n\r\n```\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.20s\r\nGenerating unstable book md files (aarch64-unknown-freebsd)\r\nBuilding stage0 tool unstable-book-gen (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.19s\r\nBuilding stage0 tool rustbook (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.23s\r\nRustbook (aarch64-unknown-freebsd) - unstable-book\r\nGenerating unstable book md files (x86_64-unknown-freebsd)\r\nBuilding stage0 std artifacts (x86_64-unknown-freebsd -> x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.19s\r\nCopying stage0 std from stage0 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd /\r\nx86_64-unknown-freebsd)\r\nBuilding stage0 compiler artifacts (x86_64-unknown-freebsd -> x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.30s\r\nCopying stage0 rustc from stage0 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd\r\n/ x86_64-unknown-freebsd)\r\nAssembling stage1 compiler (x86_64-unknown-freebsd)\r\nBuilding stage1 std artifacts (x86_64-unknown-freebsd -> x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.20s\r\nCopying stage1 std from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd /\r\nx86_64-unknown-freebsd)\r\nBuilding stage1 compiler artifacts (x86_64-unknown-freebsd -> x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.31s\r\nCopying stage1 rustc from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd\r\n/ x86_64-unknown-freebsd)\r\nAssembling stage2 compiler (x86_64-unknown-freebsd)\r\nDocumenting standalone (aarch64-unknown-freebsd)\r\nBuilding rustdoc for stage2 (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.20s\r\nDocumenting book redirect pages (aarch64-unknown-freebsd)\r\nDocumenting stage2 std (aarch64-unknown-freebsd)\r\nBuilding stage1 std artifacts (x86_64-unknown-freebsd -> aarch64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.20s\r\nCopying stage1 std from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd /\r\naarch64-unknown-freebsd)\r\nUplifting stage1 std (x86_64-unknown-freebsd -> aarch64-unknown-freebsd)\r\nCopying stage2 std from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd /\r\naarch64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.45s\r\n    Finished release [optimized] target(s) in 0.38s\r\n    Finished release [optimized] target(s) in 0.50s\r\n    Finished release [optimized] target(s) in 0.36s\r\n    Finished release [optimized] target(s) in 0.39s\r\nDocumenting stage2 compiler (x86_64-unknown-freebsd)\r\n        skipping - compiler/librustdoc docs disabled\r\nDocumenting stage2 compiler (aarch64-unknown-freebsd)\r\n        skipping - compiler/librustdoc docs disabled\r\nDocumenting stage2 rustdoc (x86_64-unknown-freebsd)\r\n        skipping - compiler/librustdoc docs disabled\r\nDocumenting stage2 rustdoc (aarch64-unknown-freebsd)\r\n        skipping - compiler/librustdoc docs disabled\r\nDocumenting error index (x86_64-unknown-freebsd)\r\nBuilding stage1 tool error_index_generator (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.22s\r\nDocumenting error index (aarch64-unknown-freebsd)\r\nGenerating lint docs (x86_64-unknown-freebsd)\r\nUplifting stage1 std (x86_64-unknown-freebsd -> x86_64-unknown-freebsd)\r\nCopying stage2 std from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd /\r\nx86_64-unknown-freebsd)\r\nBuilding stage0 tool lint-docs (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.17s\r\nRustbook (x86_64-unknown-freebsd) - rustc\r\nGenerating lint docs (aarch64-unknown-freebsd)\r\nRustbook (aarch64-unknown-freebsd) - rustc\r\nBuilding stage0 tool fabricate (x86_64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.21s\r\nDist rust-docs-nightly-aarch64-unknown-freebsd\r\n        finished in 32.044 seconds\r\nDist rustc-nightly-x86_64-unknown-freebsd\r\n        finished in 39.535 seconds\r\nBuilding stage1 compiler artifacts (x86_64-unknown-freebsd -> aarch64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.38s\r\nCopying stage1 rustc from stage1 (x86_64-unknown-freebsd -> x86_64-unknown-freebsd\r\n/ aarch64-unknown-freebsd)\r\nAssembling stage2 compiler (aarch64-unknown-freebsd)\r\nBuilding rustdoc for stage2 (aarch64-unknown-freebsd)\r\n    Finished release [optimized] target(s) in 0.21s\r\nDist rustc-nightly-aarch64-unknown-freebsd\r\n        finished in 37.977 seconds\r\nDist rust-std-nightly-aarch64-unknown-freebsd\r\n        finished in 19.648 seconds\r\nDist rustc-dev-nightly-x86_64-unknown-freebsd\r\n        finished in 109.446 seconds\r\nDist rustc-dev-nightly-aarch64-unknown-freebsd\r\n        finished in 99.895 seconds\r\nDist rust-src-nightly\r\n        finished in 7.656 seconds\r\n   Vendoring addr2line v0.13.0 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/addr2line-0.13.0) to vendor/addr2line-0.13.0\r\n   Vendoring addr2line v0.14.0 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/addr2line-0.14.0) to vendor/addr2line\r\n   Vendoring adler v0.2.3 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/adler-0.2.3) to vendor/adler\r\n   Vendoring aho-corasick v0.7.13 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/aho-corasick-0.7.13) to vendor/aho-corasick\r\n   Vendoring ammonia v3.1.0 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/ammonia-3.1.0) to vendor/ammonia\r\n   Vendoring annotate-snippets v0.6.1 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/annotate-snippets-0.6.1) to vendor/annotate-snippets-0.6.1\r\n   Vendoring annotate-snippets v0.8.0 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/annotate-snippets-0.8.0) to vendor/annotate-snippets\r\n   Vendoring ansi_term v0.11.0 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/ansi_term-0.11.0) to vendor/ansi_term-0.11.0\r\n   Vendoring ansi_term v0.12.1 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/ansi_term-0.12.1) to vendor/ansi_term\r\n   Vendoring anyhow v1.0.32 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.32) to vendor/anyhow-1.0.32\r\n   Vendoring anyhow v1.0.34 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.34) to vendor/anyhow\r\n   Vendoring anymap v0.12.1 (/home/nicolas/.cargo/registry/src/github.com-1ecc6299db9ec823/anymap-0.12.1) to vendor/anymap\r\n   Vendoring ar v0.8.0 (https://github.com/bjorn3/rust-ar.git?branch=do_not_remove_cg_clif_ranlib#de9ab0e5) (/home/nicolas/.cargo/git/checkouts/rust-ar-9b35aff8ad678e06/de9ab0e) to vendor/ar\r\nerror: failed to sync\r\n\r\nCaused by:\r\n  failed to write `vendor/ar/.cargo-checksum.json`\r\n\r\nCaused by:\r\n  No such file or directory (os error 2)\r\n\r\n\r\ncommand did not execute successfully: \"/usr/home/nicolas/Projects/rust/buildrust/rust/build/x86_64-unknown-freebsd/stage0/bin/cargo\" \"vendor\" \"--sync\" \"/usr/home/nicolas/Projects/rust/buildrust/rust/./src/tools/rust-analyzer/Cargo.toml\" \"/usr/home/nicolas/Projects/rust/buildrust/rust/./compiler/rustc_codegen_cranelift/Cargo.toml\"\r\nexpected success, got: exit code: 101\r\n\r\n\r\nfailed to run: /usr/home/nicolas/Projects/rust/buildrust/rust/build/bootstrap/debug/bootstrap dist --config aarch64.toml -j 16\r\nBuild completed unsuccessfully in 0:07:05\r\n```\r\n\r\nThanks a lot for your time. Any idea?\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80451/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80451/timeline", "performed_via_github_app": null, "state_reason": null}