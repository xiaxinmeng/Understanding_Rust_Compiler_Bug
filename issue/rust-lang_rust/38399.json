{"url": "https://api.github.com/repos/rust-lang/rust/issues/38399", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38399/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38399/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38399/events", "html_url": "https://github.com/rust-lang/rust/issues/38399", "id": 195938524, "node_id": "MDU6SXNzdWUxOTU5Mzg1MjQ=", "number": 38399, "title": "Internal compiler error for windows OsStrExt", "user": {"login": "novacrazy", "id": 4708645, "node_id": "MDQ6VXNlcjQ3MDg2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/4708645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/novacrazy", "html_url": "https://github.com/novacrazy", "followers_url": "https://api.github.com/users/novacrazy/followers", "following_url": "https://api.github.com/users/novacrazy/following{/other_user}", "gists_url": "https://api.github.com/users/novacrazy/gists{/gist_id}", "starred_url": "https://api.github.com/users/novacrazy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/novacrazy/subscriptions", "organizations_url": "https://api.github.com/users/novacrazy/orgs", "repos_url": "https://api.github.com/users/novacrazy/repos", "events_url": "https://api.github.com/users/novacrazy/events{/privacy}", "received_events_url": "https://api.github.com/users/novacrazy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-12-15T22:56:55Z", "updated_at": "2016-12-16T02:28:15Z", "closed_at": "2016-12-16T02:28:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "The code that produces the internal compiler error\r\n```rust\r\n//main.rs\r\n\r\nuse std::os::windows::ffi::OsStrExt;\r\nuse std::ffi::OsStr;\r\n\r\npub fn to_wstring(s: &str) -> Vec<u16> {\r\n    OsStr::new(str).encode_wide().chain(Some(0).into_iter()).collect()\r\n}\r\n\r\nfn main() {}\r\n```\r\n`pub` on `to_wstring` doesn't make a difference, nor does removing the `chain` part.\r\n\r\nHere is the error:\r\n```\r\nE:\\code\\projects\\2016\\test-case>cargo build\r\n   Compiling test-case v0.1.0 (file:///E:/code/projects/2016/test-case)\r\nerror: internal compiler error: ../src/librustc_typeck\\check/mod.rs:4396: unexpected definition: PrimTy(TyStr)\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:423\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\nerror: Could not compile `test-case`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n## Meta\r\nRust version:\r\n```\r\nrustc 1.15.0-nightly (daf8c1dfc 2016-12-05)\r\nbinary: rustc\r\ncommit-hash: daf8c1dfce3b448fc581cc319f64632ec22bd0e1\r\ncommit-date: 2016-12-05\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.15.0-nightly\r\nLLVM version: 3.9\r\n```\r\n\r\nAnd here is the backtrace:\r\n```\r\n0:     0x7ff9fc2802ea - std::panicking::Location::line::h9363ce800e842170\r\n1:     0x7ff9fc27f774 - std::panicking::Location::line::h9363ce800e842170\r\n2:     0x7ff9fc2831cd - std::panicking::rust_panic_with_hook::hc790e47d4ecc86cd\r\n3:     0x7ffa209f2670 - <unknown>\r\n4:     0x7ffa20a0b09e - rustc_errors::Handler::bug::h620f7270292f0095\r\n5:     0x7ff9f49c5e25 - rustc::session::bug_fmt::he2d2f00a4afa9d1e\r\n6:     0x7ff9f49c5c5a - rustc::session::bug_fmt::he2d2f00a4afa9d1e\r\n7:     0x7ff9f49c53cc - rustc::session::bug_fmt::he2d2f00a4afa9d1e\r\n8:     0x7ff9fa349d1a - rustc_typeck::check::FnCtxt::instantiate_value_path::h4229ac945aebfa55\r\n9:     0x7ff9fa334356 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n10:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n11:     0x7ff9fa3260ce - rustc_typeck::check::FnCtxt::field_ty::h3fce8b0238020251\r\n12:     0x7ff9fa2f6ce7 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_call::h762a25d0c9a1f5b4\r\n13:     0x7ff9fa2f5cd3 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt<'a, 'gcx, 'tcx>>::check_call::h762a25d0c9a1f5b4\r\n14:     0x7ff9fa3340fd - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n15:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n16:     0x7ff9fa3337a4 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n17:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n18:     0x7ff9fa3337a4 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n19:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n20:     0x7ff9fa3337a4 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n21:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n22:     0x7ff9fa3484f3 - rustc_typeck::check::FnCtxt::check_block_no_value::h3ac235dc3eaa76c3\r\n23:     0x7ff9fa33326e - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n24:     0x7ff9fa332d81 - rustc_typeck::check::FnCtxt::check_struct_path::h1ff2872963f8985c\r\n25:     0x7ff9fa312c1d - <rustc_typeck::coherence::orphan::OrphanChecker<'cx, 'tcx> as rustc::hir::itemlikevisit::ItemLikeVisitor<'v>>::visit_impl_item::habbc901b4cfa4531\r\n26:     0x7ff9fa310f57 - rustc_typeck::check::check_drop_impls::hb6e6926f4342f9e2\r\n27:     0x7ff9fa3152e1 - rustc_typeck::check::check_item_body::h1e039ede2f960fb9\r\n28:     0x7ff9fa30dbbd - rustc_typeck::check::check_item_bodies::hd22adb7703cc56d7\r\n29:     0x7ff9fa39a500 - rustc_typeck::check_crate::h92f6bdfe03b6afba\r\n30:     0x7ff9fe24c98e - rustc_driver::driver::count_nodes::h84f03318ea2320a8\r\n31:     0x7ff9fe1a5bcf - <unknown>\r\n32:     0x7ff9fe228932 - rustc_driver::driver::compile_input::h8e119234b60571d5\r\n33:     0x7ff9fe279f27 - rustc_driver::run_compiler::h57c4f233cd1a0c04\r\n34:     0x7ff9fe15da1e - <unknown>\r\n35:     0x7ff9fc285bf1 - _rust_maybe_catch_panic\r\n36:     0x7ff9fe187794 - <unknown>\r\n37:     0x7ff9fc27d86e - std::sys::imp::thread::Thread::new::hd990f5dcc0d4bad9\r\n38:     0x7ffa3d3e8363 - BaseThreadInitThunk\r\n```", "closed_by": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38399/timeline", "performed_via_github_app": null, "state_reason": "completed"}