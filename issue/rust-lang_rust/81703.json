{"url": "https://api.github.com/repos/rust-lang/rust/issues/81703", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81703/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81703/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81703/events", "html_url": "https://github.com/rust-lang/rust/issues/81703", "id": 800253276, "node_id": "MDU6SXNzdWU4MDAyNTMyNzY=", "number": 81703, "title": "Rust and Wasm problems when trying to access a file", "user": {"login": "AndreaEsposit", "id": 54411648, "node_id": "MDQ6VXNlcjU0NDExNjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/54411648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreaEsposit", "html_url": "https://github.com/AndreaEsposit", "followers_url": "https://api.github.com/users/AndreaEsposit/followers", "following_url": "https://api.github.com/users/AndreaEsposit/following{/other_user}", "gists_url": "https://api.github.com/users/AndreaEsposit/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreaEsposit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreaEsposit/subscriptions", "organizations_url": "https://api.github.com/users/AndreaEsposit/orgs", "repos_url": "https://api.github.com/users/AndreaEsposit/repos", "events_url": "https://api.github.com/users/AndreaEsposit/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreaEsposit/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-03T11:47:58Z", "updated_at": "2021-02-03T14:30:15Z", "closed_at": "2021-02-03T14:29:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have been trying to create/read/edit a file though a WebAssembly module originally written in Rust, but it is not working.\r\n\r\nThe code looks like this(src/lib.rs): \r\n```\r\n#[no_mangle]\r\npub fn write() -> Result<(), io::Error> {\r\n    let mut file = File::create(\"./foo.txt\")?;\r\n    file.write_all(b\"Hello, world!\")?;\r\n    Ok(())\r\n}\r\n#[no_mangle]\r\npub extern \"C\" fn hello() -> (){\r\n    let err = write();\r\n    match err {\r\n        Ok(()) => print!(\"Managed\"),\r\n        Err(_e) => print!(\"Didn't manage\");\r\n    }\r\n}\r\n``` \r\nThis is my cargo.toml:\r\n``` \r\n[package]\r\nname = \"rust_write\"\r\nversion = \"0.1.0\"\r\nedition =\"2018\"\r\n\r\n[lib]\r\ncrate-type = [\"cdylib\"]\r\n```\r\nI am using rustc 1.51.0-nightly, and I compiled the file with this command ```cargo build --target wasm32-wasi```. \r\nThe Wa. module will not work either with wasmtime CLI ( ```wasmtime --dir=. --invoke hello rust_write.wasm ```) or  embedded, however if I remove the ```crate-type = [\"cdylib\"]``` from ```cargo.toml``` and write the exact same hello function as a main function in ````src/main.rs```, then it works without problems. \r\n\r\nCould it be that the issue is that ```_start``` is not called when you directly --invoke the hello function.\r\n\r\nAm I intended to not be able to access files if I am using a WASI library, or is it a bug? \r\nAm I just straight up doing something wrong when I compile?\r\n\r\n", "closed_by": {"login": "AndreaEsposit", "id": 54411648, "node_id": "MDQ6VXNlcjU0NDExNjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/54411648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreaEsposit", "html_url": "https://github.com/AndreaEsposit", "followers_url": "https://api.github.com/users/AndreaEsposit/followers", "following_url": "https://api.github.com/users/AndreaEsposit/following{/other_user}", "gists_url": "https://api.github.com/users/AndreaEsposit/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreaEsposit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreaEsposit/subscriptions", "organizations_url": "https://api.github.com/users/AndreaEsposit/orgs", "repos_url": "https://api.github.com/users/AndreaEsposit/repos", "events_url": "https://api.github.com/users/AndreaEsposit/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreaEsposit/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81703/timeline", "performed_via_github_app": null, "state_reason": "completed"}