{"url": "https://api.github.com/repos/rust-lang/rust/issues/23398", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23398/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23398/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23398/events", "html_url": "https://github.com/rust-lang/rust/issues/23398", "id": 61883784, "node_id": "MDU6SXNzdWU2MTg4Mzc4NA==", "number": 23398, "title": "compiler allowed referencing &mut self from inside a move + Send closure (caused SEGV)", "user": {"login": "carllerche", "id": 6180, "node_id": "MDQ6VXNlcjYxODA=", "avatar_url": "https://avatars.githubusercontent.com/u/6180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carllerche", "html_url": "https://github.com/carllerche", "followers_url": "https://api.github.com/users/carllerche/followers", "following_url": "https://api.github.com/users/carllerche/following{/other_user}", "gists_url": "https://api.github.com/users/carllerche/gists{/gist_id}", "starred_url": "https://api.github.com/users/carllerche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carllerche/subscriptions", "organizations_url": "https://api.github.com/users/carllerche/orgs", "repos_url": "https://api.github.com/users/carllerche/repos", "events_url": "https://api.github.com/users/carllerche/events{/privacy}", "received_events_url": "https://api.github.com/users/carllerche/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-03-15T19:02:03Z", "updated_at": "2015-03-16T01:18:32Z", "closed_at": "2015-03-16T01:18:32Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Ok, so I believe that this may be a compiler bug. If it isn't, then I misunderstood something that changed recently (removing 'static from Send) and the library does have some unsafe code, though it isn't directly related to the bit that is causing problems (I think).\n\nThe compiler allowed referencing `&mut self` from inside a `move` + `Send` closure that ends up getting moved off the stack and lives longer than the original lifetime, so the `&mut self` is no longer valid and causes a crash.\n\nThe illegal reference is here: https://github.com/carllerche/syncbox/blob/how-did-this-compile/src/util/async/sequence.rs#L149\n\nThe `move` is 7 lines above. The `receive` function is defined here: https://github.com/carllerche/syncbox/blob/how-did-this-compile/src/util/async/mod.rs#L107-L108. It's only marked as `Send` and not `Send + 'static` because the compiler permitted it, so I am not entirely sure if it is a compiler bug vs. something related to unsafe code I have in the implementation...\n", "closed_by": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23398/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23398/timeline", "performed_via_github_app": null, "state_reason": "completed"}