{"url": "https://api.github.com/repos/rust-lang/rust/issues/61264", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61264/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61264/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61264/events", "html_url": "https://github.com/rust-lang/rust/issues/61264", "id": 449281268, "node_id": "MDU6SXNzdWU0NDkyODEyNjg=", "number": 61264, "title": "Rust 1.35.0 x86_64-unknown-linux-musl has multiple definition of `__errno_location`", "user": {"login": "oherrala", "id": 89251, "node_id": "MDQ6VXNlcjg5MjUx", "avatar_url": "https://avatars.githubusercontent.com/u/89251?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oherrala", "html_url": "https://github.com/oherrala", "followers_url": "https://api.github.com/users/oherrala/followers", "following_url": "https://api.github.com/users/oherrala/following{/other_user}", "gists_url": "https://api.github.com/users/oherrala/gists{/gist_id}", "starred_url": "https://api.github.com/users/oherrala/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oherrala/subscriptions", "organizations_url": "https://api.github.com/users/oherrala/orgs", "repos_url": "https://api.github.com/users/oherrala/repos", "events_url": "https://api.github.com/users/oherrala/events{/privacy}", "received_events_url": "https://api.github.com/users/oherrala/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-05-28T13:50:05Z", "updated_at": "2020-04-21T22:52:24Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "This is breakage between 1.34(.2) and 1.35.0.\r\n\r\n1.34 worked fine, 1.35 not any more. We are building `x86_64-unknown-linux-musl` using musl 1.1.22 (with clang).\r\n\r\n```\r\n/opt/musl/lib/libc.a(__errno_location.lo): In function `___errno_location': src/errno/__errno_location.c:(.text.__errno_location+0x0): multiple definition of `__errno_location'\r\n/tmp/rustcHiVA0H/liblibc-a19d328d73c1ea73.rlib(__errno_location.lo):__errno_location.c:(.text.__errno_location+0x0): first defined here\r\n\r\n```\r\n\r\nThe following Dockerfile can be used to demonstrate the issue. It's quite long because of building both `musl` and `libressl` for Musl compilation.\r\n\r\n```dockerfile\r\nFROM rust:1.35.0\r\n#         ^-- 1.35.0 build breaks, 1.34.2 here and build is good\r\n\r\nENV TARGET=x86_64-unknown-linux-musl\r\n\r\nARG LIBRESSL=libressl-2.9.1\r\nARG MUSL=musl-1.1.22\r\n\r\nARG DEBIAN_FRONTEND=noninteractive\r\nRUN apt -y update && \\\r\n    apt -y install clang && \\\r\n    rustup target install ${TARGET}\r\n\r\nRUN printf '[target.x86_64-unknown-linux-musl]\\nlinker = \"musl-clang\"\\n' >/usr/local/cargo/config\r\n\r\nWORKDIR /work\r\n\r\nRUN curl -fO https://www.musl-libc.org/releases/${MUSL}.tar.gz && \\\r\n    tar zxf ${MUSL}.tar.gz && \\\r\n    cd ${MUSL} && \\\r\n    ./configure CC=clang CFLAGS=\"-fPIC\" --prefix=/opt/musl --enable-shared=no && \\\r\n    make V=1 -j4 && \\\r\n    make V=1 install\r\n\r\nENV PATH=/opt/musl/bin:$PATH\r\n\r\n# We do Musl build hence point to correct tool\r\nENV CC_x86_64_unknown_linux_musl=musl-clang\r\n\r\n# Musl is missing some kernel specific header files. Do symbolic links to fix\r\n# this.\r\nRUN \\\r\n    ln -s /usr/include/linux /opt/musl/include/ && \\\r\n    ln -s /usr/include/x86_64-linux-gnu/asm /opt/musl/include/ && \\\r\n    ln -s /usr/include/asm-generic /opt/musl/include/\r\n\r\nRUN curl -fO https://ftp.openbsd.org/pub/OpenBSD/LibreSSL/${LIBRESSL}.tar.gz && \\\r\n    tar zxf ${LIBRESSL}.tar.gz && \\\r\n    cd ${LIBRESSL} && \\\r\n    ./configure CC=musl-clang LD=musl-clang CFLAGS=\"-fPIC\" --prefix=/opt/libressl --enable-shared=no --sysconfdir=/etc && \\\r\n    make V=1 -j4 && make -j4 check && \\\r\n    make install\r\n\r\nENV X86_64_UNKNOWN_LINUX_MUSL_OPENSSL_LIB_DIR=/opt/libressl/lib\r\nENV X86_64_UNKNOWN_LINUX_MUSL_OPENSSL_INCLUDE_DIR=/opt/libressl/include\r\n\r\n# cargo-outdated is innocent crate, it's just to trigger the error in build\r\nRUN cargo install --target=$TARGET cargo-outdated\r\n```\r\n\r\nThis error seem to happen with some, but not all crates. For example `cargo-outdated` triggers the error while linking but building `bindgen` works fine.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61264/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61264/timeline", "performed_via_github_app": null, "state_reason": null}