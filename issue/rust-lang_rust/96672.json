{"url": "https://api.github.com/repos/rust-lang/rust/issues/96672", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96672/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96672/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96672/events", "html_url": "https://github.com/rust-lang/rust/issues/96672", "id": 1224061800, "node_id": "I_kwDOAAsO6M5I9bNo", "number": 96672, "title": "Rust 1.60 segmentation fault related to const generics", "user": {"login": "NickHu", "id": 450276, "node_id": "MDQ6VXNlcjQ1MDI3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/450276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NickHu", "html_url": "https://github.com/NickHu", "followers_url": "https://api.github.com/users/NickHu/followers", "following_url": "https://api.github.com/users/NickHu/following{/other_user}", "gists_url": "https://api.github.com/users/NickHu/gists{/gist_id}", "starred_url": "https://api.github.com/users/NickHu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NickHu/subscriptions", "organizations_url": "https://api.github.com/users/NickHu/orgs", "repos_url": "https://api.github.com/users/NickHu/repos", "events_url": "https://api.github.com/users/NickHu/events{/privacy}", "received_events_url": "https://api.github.com/users/NickHu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2022-05-03T12:58:20Z", "updated_at": "2022-06-16T16:47:03Z", "closed_at": "2022-05-13T00:54:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\n\r\n### Code\r\n\r\nI tried this code:\r\n\r\n```\r\nnix build github:homotopy-io/homotopy-rs?rev=0cc608109c699f7fac2e7979f2f0d440ac4ac786\r\n```\r\n\r\nI expected to see this happen: successful compilation\r\n\r\nInstead, this happened:\r\n\r\n```\r\n@nix { \"action\": \"setPhase\", \"phase\": \"unpackPhase\" }\r\nunpacking sources\r\nunpacking source archive /nix/store/v4fmilsv73fjm9gy6ggvdlkds4m8a9af-source\r\nsource root is source\r\n@nix { \"action\": \"setPhase\", \"phase\": \"patchPhase\" }\r\npatching sources\r\n@nix { \"action\": \"setPhase\", \"phase\": \"configurePhase\" }\r\nconfiguring\r\n[naersk] cargo_version (read): 1.60.0 (d1fd9fe 2022-03-01)\r\n[naersk] cargo_message_format (set): json-diagnostic-rendered-ansi\r\n[naersk] cargo_release: --release\r\n[naersk] cargo_options: \r\n[naersk] cargo_build_options: $cargo_release -j \"$NIX_BUILD_CORES\" --message-format=$cargo_message_format -p homotopy-web\r\n[naersk] cargo_test_options: $cargo_release -j \"$NIX_BUILD_CORES\"\r\n[naersk] RUST_TEST_THREADS: 32\r\n[naersk] cargo_bins_jq_filter: select(.reason == \"compiler-artifact\" and .executable != null and .profile.test == false)\r\n[naersk] cargo_build_output_json (created): /build/tmp.AMfM0fmYyn\r\n[naersk] crate_sources: /nix/store/hjmyjcasiifgnpm0s0ss264ry3100iq8-crates-io\r\n[naersk] RUSTFLAGS: \r\n[naersk] CARGO_BUILD_RUSTFLAGS: \r\n[naersk] CARGO_BUILD_RUSTFLAGS (updated): --remap-path-prefix /nix/store/hjmyjcasiifgnpm0s0ss264ry3100iq8-crates-io=/sources\r\n[naersk] pre-installing dep /nix/store/4risald0r359aliark65q2fmhif5ml0j-homotopy-web-deps-0.1.2\r\n@nix { \"action\": \"setPhase\", \"phase\": \"buildPhase\" }\r\nbuilding\r\ncargo build $cargo_release -j \"$NIX_BUILD_CORES\" --message-format=$cargo_message_format -p homotopy-web\r\n\u001b[0m\u001b[0m\u001b[1m\u001b[32m   Compiling\u001b[0m homotopy-common v0.1.0 (/build/source/homotopy-common)\r\n\u001b[0m\u001b[0m\u001b[1m\u001b[32m   Compiling\u001b[0m homotopy-core v0.1.0 (/build/source/homotopy-core)\r\n\u001b[0m\u001b[0m\u001b[1m\u001b[32m   Compiling\u001b[0m homotopy-graphics v0.1.0 (/build/source/homotopy-graphics)\r\n\u001b[0m\u001b[0m\u001b[1m\u001b[32m   Compiling\u001b[0m homotopy-web v0.1.2 (/build/source/homotopy-web)\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x4b3d23)[0x7ffff469bd23]\r\n/nix/store/ayrsyv7npr0lcbann4k9lxr19x813f0z-glibc-2.34-115/lib/libc.so.6(+0x41100)[0x7ffff3cab100]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(_ZN4llvm10BasicBlockC1ERNS_11LLVMContextERKNS_5TwineEPNS_8FunctionEPS0_+0xc5)[0x7ffff132a075]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x2707510)[0x7ffff0f23510]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x27008af)[0x7ffff0f1c8af]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(_ZN4llvm11simplifyCFGEPNS_10BasicBlockERKNS_19TargetTransformInfoEPNS_14DomTreeUpdaterERKNS_18SimplifyCFGOptionsENS_8ArrayRefINS_6WeakVHEEE+0x2315)[0x7ffff0ed8965]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x26b7bc5)[0x7ffff0ed3bc5]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x26b529a)[0x7ffff0ed129a]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x2387229)[0x7ffff0ba3229]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(_ZN4llvm27ModuleToFunctionPassAdaptor3runERNS_6ModuleERNS_15AnalysisManagerIS1_JEEE+0x329)[0x7ffff1aa7659]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(+0x328b31d)[0x7ffff1aa731d]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libLLVM-14-rust-1.60.0-stable.so(_ZN4llvm11PassManagerINS_6ModuleENS_15AnalysisManagerIS1_JEEEJEE3runERS1_RS3_+0x144)[0x7ffff19285c4]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x23dfef1)[0x7ffff65c7ef1]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x23cdb54)[0x7ffff65b5b54]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x23ce0a1)[0x7ffff65b60a1]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x2365d7d)[0x7ffff654dd7d]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x238380f)[0x7ffff656b80f]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/librustc_driver-75e5f32fc3580f6c.so(+0x2372bc7)[0x7ffff655abc7]\r\n/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/lib/libstd-8d61b92a0a02f53a.so(rust_metadata_std_cd3cf6af28dff6de+0xa7d03)[0x7ffff3f21d03]\r\n/nix/store/ayrsyv7npr0lcbann4k9lxr19x813f0z-glibc-2.34-115/lib/libc.so.6(+0x89eb2)[0x7ffff3cf3eb2]\r\n/nix/store/ayrsyv7npr0lcbann4k9lxr19x813f0z-glibc-2.34-115/lib/libc.so.6(+0x10c31c)[0x7ffff3d7631c]\r\n\u001b[0m\u001b[0m\u001b[1m\u001b[31merror\u001b[0m\u001b[1m:\u001b[0m could not compile `homotopy-web`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/nix/store/v1kdj5bb8pp5bb3pk23s96nfbfpic6f0-rust-minimal-1.60.0/bin/rustc --crate-name homotopy_web --edition=2021 homotopy-web/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type cdylib --crate-type rlib --emit=dep-info,link -C opt-level=3 --cfg 'feature=\"console_error_panic_hook\"' --cfg 'feature=\"default\"' -C metadata=d0edfb7c13dcde66 --out-dir /build/source/target/wasm32-unknown-unknown/release/deps --target wasm32-unknown-unknown -L dependency=/build/source/target/wasm32-unknown-unknown/release/deps -L dependency=/build/source/target/release/deps --extern arrayvec=/build/source/target/wasm32-unknown-unknown/release/deps/libarrayvec-064facd1d3b4ac08.rlib --extern closure=/build/source/target/wasm32-unknown-unknown/release/deps/libclosure-22ef8d2fe5957b87.rlib --extern console_error_panic_hook=/build/source/target/wasm32-unknown-unknown/release/deps/libconsole_error_panic_hook-2057c4514695902f.rlib --extern euclid=/build/source/target/wasm32-unknown-unknown/release/deps/libeuclid-3dae85bc5bb07a71.rlib --extern gloo=/build/source/target/wasm32-unknown-unknown/release/deps/libgloo-b43aad26b340de48.rlib --extern gloo_timers=/build/source/target/wasm32-unknown-unknown/release/deps/libgloo_timers-bc23fdea00850d70.rlib --extern homotopy_common=/build/source/target/wasm32-unknown-unknown/release/deps/libhomotopy_common-0ba795d2fc24788e.rlib --extern homotopy_core=/build/source/target/wasm32-unknown-unknown/release/deps/libhomotopy_core-5b86ed58e29945d8.rlib --extern homotopy_graphics=/build/source/target/wasm32-unknown-unknown/release/deps/libhomotopy_graphics-5b9942fcbc1b42fd.rlib --extern im=/build/source/target/wasm32-unknown-unknown/release/deps/libim-f68605f388142b72.rlib --extern instant=/build/source/target/wasm32-unknown-unknown/release/deps/libinstant-15f531c8d8e23534.rlib --extern js_sys=/build/source/target/wasm32-unknown-unknown/release/deps/libjs_sys-d892199c945c5dfe.rlib --extern log=/build/source/target/wasm32-unknown-unknown/release/deps/liblog-f0424ddc1a3d06f8.rlib --extern lyon_path=/build/source/target/wasm32-unknown-unknown/release/deps/liblyon_path-4c1b5b611b75ca6b.rlib --extern obake=/build/source/target/wasm32-unknown-unknown/release/deps/libobake-5427d7eb3090cf45.rlib --extern palette=/build/source/target/wasm32-unknown-unknown/release/deps/libpalette-087ea92923972b9c.rlib --extern paste=/build/source/target/release/deps/libpaste-9f4ba831280a7332.so --extern quote=/build/source/target/wasm32-unknown-unknown/release/deps/libquote-0bea2f79134eb277.rlib --extern rmp_serde=/build/source/target/wasm32-unknown-unknown/release/deps/librmp_serde-104a28574bf452c8.rlib --extern serde=/build/source/target/wasm32-unknown-unknown/release/deps/libserde-8cef68772708519b.rlib --extern syn=/build/source/target/wasm32-unknown-unknown/release/deps/libsyn-fc3acf24a1e49ab3.rlib --extern thiserror=/build/source/target/wasm32-unknown-unknown/release/deps/libthiserror-033ceb9e6bdfab8c.rlib --extern ultraviolet=/build/source/target/wasm32-unknown-unknown/release/deps/libultraviolet-40630f624adb9f9d.rlib --extern wasm_bindgen=/build/source/target/wasm32-unknown-unknown/release/deps/libwasm_bindgen-a75edcdc1a8fc987.rlib --extern wasm_logger=/build/source/target/wasm32-unknown-unknown/release/deps/libwasm_logger-235f2a8f6828be52.rlib --extern web_sys=/build/source/target/wasm32-unknown-unknown/release/deps/libweb_sys-96345e1705e5ba46.rlib --extern yew=/build/source/target/wasm32-unknown-unknown/release/deps/libyew-e97f053b58fd785b.rlib --extern yew_agent=/build/source/target/wasm32-unknown-unknown/release/deps/libyew_agent-af8da546ff0d9932.rlib --extern yew_macro=/build/source/target/release/deps/libyew_macro-967187fef99f778d.so --remap-path-prefix /nix/store/hjmyjcasiifgnpm0s0ss264ry3100iq8-crates-io=/sources` (signal: 11, SIGSEGV: invalid memory reference)\r\n[naersk] cargo returned with exit code 101, exiting\r\n```\r\n\r\n### Version it worked on\r\n\r\nIt most recently worked on ([`nix build  github:homotopy-io/homotopy-rs?rev=5ba852c72a3e552d3668233a14fd9769dea0797e`](https://github.com/homotopy-io/homotopy-rs/commit/5ba852c72a3e552d3668233a14fd9769dea0797e)):\r\n\r\n```\r\nrustc 1.59.0 (9d1b2106e 2022-02-23)\r\nbinary: rustc\r\ncommit-hash: 9d1b2106e23b1abd32fce1f17267604a5102f57a\r\ncommit-date: 2022-02-23\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.59.0\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Version with regression\r\n\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.60.0 (7737e0b5c 2022-04-04)\r\nbinary: rustc\r\ncommit-hash: 7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c\r\ncommit-date: 2022-04-04\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.60.0\r\nLLVM version: 14.0.0\r\n```\r\n\r\n### Other information\r\n\r\nWe've determined that https://github.com/homotopy-io/homotopy-rs/blob/0cc608109c699f7fac2e7979f2f0d440ac4ac786/homotopy-web/src/app/workspace.rs#L101 is the culprit; either removing that line or replacing `<0>` with `<1>` both fix the compiler crashing (although this does not produce the code we want).\r\n\r\nThis looks like it's possibly related to the LLVM version.\r\n\r\n@rustbot modify labels: +regression-from-stable-to-stable -regression-untriaged\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96672/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96672/timeline", "performed_via_github_app": null, "state_reason": "completed"}