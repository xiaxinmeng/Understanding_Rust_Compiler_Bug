{"url": "https://api.github.com/repos/rust-lang/rust/issues/97517", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97517/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97517/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97517/events", "html_url": "https://github.com/rust-lang/rust/issues/97517", "id": 1251880497, "node_id": "I_kwDOAAsO6M5Kni4x", "number": 97517, "title": "ICE with Unreachable patterns and Incremental compilation", "user": {"login": "Julian-Wollersberger", "id": 24991778, "node_id": "MDQ6VXNlcjI0OTkxNzc4", "avatar_url": "https://avatars.githubusercontent.com/u/24991778?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Julian-Wollersberger", "html_url": "https://github.com/Julian-Wollersberger", "followers_url": "https://api.github.com/users/Julian-Wollersberger/followers", "following_url": "https://api.github.com/users/Julian-Wollersberger/following{/other_user}", "gists_url": "https://api.github.com/users/Julian-Wollersberger/gists{/gist_id}", "starred_url": "https://api.github.com/users/Julian-Wollersberger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Julian-Wollersberger/subscriptions", "organizations_url": "https://api.github.com/users/Julian-Wollersberger/orgs", "repos_url": "https://api.github.com/users/Julian-Wollersberger/repos", "events_url": "https://api.github.com/users/Julian-Wollersberger/events{/privacy}", "received_events_url": "https://api.github.com/users/Julian-Wollersberger/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-05-29T12:49:05Z", "updated_at": "2022-06-14T20:27:23Z", "closed_at": "2022-06-14T20:27:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Minimized Code\r\n\r\n```Rust\r\nfn main() {\r\n    const BOO: &[u8; 0] = &[];\r\n    match &[] {\r\n        [] => (),\r\n        BOO => (), // unreachable pattern\r\n        b\"\" => (), // unreachable pattern\r\n    }\r\n}\r\n```\r\n\r\n### Summary\r\n\r\nI got this ICE when compiling one of the UI test files ( [slice-pattern-const.rs](https://github.com/rust-lang/rust/blob/0f06824013761ed6829887019033f1001e68f623/src/test/ui/pattern/usefulness/slice-pattern-const.rs) ) as a normal cargo project.\r\nHow can that be? Well, compiler flags are different than in the test suit. The culprit turns out to be incremental compilation.\r\n\r\nThe following ICEs:\r\n* `rustc main.rs -C incremental=true`\r\n* `cargo check`\r\n\r\nThe following works as expected:\r\n* `rustc main.rs`\r\n* `cargo build --release`\r\n\r\n.\r\n\r\nThere is a fun bonus bug in here:\r\n* `cargo clean ; cargo check`\r\n* delete the line `b\"\" => (),` \r\n* run `cargo check` \r\n* add that line again. \r\n* Now `cargo check` **doesn't** ICE anymore, on the original code.\r\n\r\n\r\n### Affected versions\r\nThe bug report is made with `rustc 1.63.0-nightly (1fede1753 2022-05-28)`, but this ICE seems to be very old.\r\n\r\nOutput of `cargo bisect-rustc --preserve --prompt --end=2021-09-11 --start=2020-01-01`:\r\n```\r\n[...]\r\nsearched toolchains nightly-2020-01-01 through nightly-2021-09-11\r\n\r\n\r\n********************************************************************************\r\nRegression in nightly-2020-10-26\r\n********************************************************************************\r\n\r\nfetching https://static.rust-lang.org/dist/2020-10-25/channel-rust-nightly-git-commit-hash.txt\r\nnightly manifest 2020-10-25: 40 B / 40 B [=======================================================] 100.00 % 57.27 KB/s converted 2020-10-25 to ffa2e7ae8fbf9badc035740db949b9dae271c29f\r\nfetching https://static.rust-lang.org/dist/2020-10-26/channel-rust-nightly-git-commit-hash.txt\r\nnightly manifest 2020-10-26: 40 B / 40 B [=======================================================] 100.00 % 81.40 KB/s converted 2020-10-26 to 4760b8fb886a3702ae11bfa7868d495b2675b5ed\r\nlooking for regression commit between 2020-10-25 and 2020-10-26\r\ncloning rust repository\r\nfetching (via local git) commits from ffa2e7ae8fbf9badc035740db949b9dae271c29f to 4760b8fb886a3702ae11bfa7868d495b2675b5ed\r\nopening existing repository at \"rust.git\"\r\nFound origin remote under name `origin`\r\nrefreshing repository at \"rust.git\"\r\nlooking up first commit\r\nlooking up second commit\r\nchecking that commits are by bors and thus have ci artifacts...\r\nfinding bors merge commits\r\nfound 11 bors merge commits in the specified range\r\n  commit[0] 2020-10-24UTC: Auto merge of #77255 - Aaron1011:feature/collect-attr-tokens, r=petrochenkov\r\n  commit[1] 2020-10-24UTC: Auto merge of #78334 - jonas-schievink:rollup-z0gzbmm, r=jonas-schievink\r\n  commit[2] 2020-10-25UTC: Auto merge of #78310 - ebroto:clippyup, r=Manishearth\r\n  commit[3] 2020-10-25UTC: Auto merge of #77526 - RalfJung:dont-promote-unions, r=lcnr\r\n  commit[4] 2020-10-25UTC: Auto merge of #77398 - wesleywiser:measureme_0_8, r=Mark-Simulacrum\r\n  commit[5] 2020-10-25UTC: Auto merge of #77546 - lcnr:impl-trait-closure, r=eddyb\r\n  commit[6] 2020-10-25UTC: Auto merge of #77476 - tgnottingham:buffered_siphasher128, r=nnethercote\r\n  commit[7] 2020-10-25UTC: Auto merge of #78350 - JohnTitor:rollup-vbbm5wf, r=JohnTitor\r\n  commit[8] 2020-10-25UTC: Auto merge of #78253 - Aaron1011:bump-llvm-deadarg, r=cuviper\r\n  commit[9] 2020-10-25UTC: Auto merge of #77901 - jonas-schievink:unignore-test-36710, r=Mark-Simulacrum\r\n  commit[10] 2020-10-25UTC: Auto merge of #78179 - RalfJung:miri-comments, r=oli-obk\r\nERROR: no CI builds available between ffa2e7ae8fbf9badc035740db949b9dae271c29f and 4760b8fb886a3702ae11bfa7868d495b2675b5ed within last 167 days\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n    Checking tempdir v0.1.0 (D:\\Dokumente\\Rust\\fuzzing-rustc\\repos\\Second ICE\\tempdir)\r\nthread 'rustc' panicked at 'forcing query with already existing `DepNode`\r\n- query-key: ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: UserFacing, constness: NotConst }, value: Val(Scalar(alloc5), &[u8; 0]) }\r\n- dep-node: deref_mir_constant(f274d09d4d410170-67b2b755964a310a)', /rustc/1fede1753c33f4ce0660ad9b8edbd618d9733daf\\compiler\\rustc_query_system\\src\\dep_graph\\graph.rs:300:9\r\nstack backtrace:\r\n   0:     0x7ff9cf899b4f - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h58508b3f8525c109\r\n   1:     0x7ff9cf8d4e5a - core::fmt::write::h00a3e95c7c04103e\r\n   2:     0x7ff9cf88c009 - <std::io::IoSlice as core::fmt::Debug>::fmt::h7884a9e95f1b1022\r\n   3:     0x7ff9cf89d43b - std::panicking::default_hook::h3f8dbc57d7df9994\r\n   4:     0x7ff9cf89d0bb - std::panicking::default_hook::h3f8dbc57d7df9994\r\n   5:     0x7ff9b77ef2d6 - <rustc_metadata[b2f2848d139875d1]::rmeta::encoder::EncodeContext as rustc_serialize[979d5f7f20b036c4]::serialize::Encoder>::emit_raw_bytes\r\n   6:     0x7ff9cf89dbe2 - std::panicking::rust_panic_with_hook::he403a961d6bd3e59\r\n   7:     0x7ff9cf89d97d - <std::panicking::begin_panic_handler::StrPanicPayload as core::panic::BoxMeUp>::get::h9b9722e75b45b376\r\n   8:     0x7ff9cf89a787 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h58508b3f8525c109\r\n   9:     0x7ff9cf89d659 - rust_begin_unwind\r\n  10:     0x7ff9cf908935 - core::panicking::panic_fmt::hcf4174d66c865fdf\r\n  11:     0x7ff9bb0919f4 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  12:     0x7ff9bb028c80 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  13:     0x7ff9bacbdff6 - <rustc_query_impl[fcbe4ce9962e1e39]::Queries as rustc_middle[c72282b761ffb2ca]::ty::query::QueryEngine>::try_mark_green\r\n  14:     0x7ff9ba74ce4b - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::PatternError as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  15:     0x7ff9ba742450 - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::PatternError as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  16:     0x7ff9ba7303be - <rustc_mir_build[6ed738a698dde9b0]::build::NeedsTemporary as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  17:     0x7ff9ba72c236 - <rustc_mir_build[6ed738a698dde9b0]::build::NeedsTemporary as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  18:     0x7ff9ba6d50bb - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::check_match::MatchVisitor as rustc_hir[58843d480a0d6ffd]::intravisit::Visitor>::visit_param\r\n  19:     0x7ff9ba6dfc8c - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::check_match::LetSource as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  20:     0x7ff9ba6d2cff - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::check_match::MatchVisitor as rustc_hir[58843d480a0d6ffd]::intravisit::Visitor>::visit_expr\r\n  21:     0x7ff9ba6d2991 - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::check_match::MatchVisitor as rustc_hir[58843d480a0d6ffd]::intravisit::Visitor>::visit_expr\r\n  22:     0x7ff9ba6d2447 - <rustc_mir_build[6ed738a698dde9b0]::thir::pattern::deconstruct_pat::Fields as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  23:     0x7ff9bad84651 - <&[(rustc_middle[c72282b761ffb2ca]::middle::exported_symbols::ExportedSymbol, rustc_middle[c72282b761ffb2ca]::middle::exported_symbols::SymbolExportInfo)] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  24:     0x7ff9bb0b35a7 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  25:     0x7ff9baf6f3d7 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  26:     0x7ff9bb010a9b - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  27:     0x7ff9b794ca29 - <rustc_interface[dd9c94d8fc04b103]::passes::boxed_resolver::BoxedResolver>::to_resolver_outputs\r\n  28:     0x7ff9b78fc4d3 - <rustc_interface[dd9c94d8fc04b103]::queries::Linker>::link\r\n  29:     0x7ff9b78ff64b - <rustc_interface[dd9c94d8fc04b103]::queries::Linker>::link\r\n  30:     0x7ff9b78e8a20 - rustc_interface[dd9c94d8fc04b103]::passes::analysis\r\n  31:     0x7ff9bad852de - <&[(rustc_middle[c72282b761ffb2ca]::middle::exported_symbols::ExportedSymbol, rustc_middle[c72282b761ffb2ca]::middle::exported_symbols::SymbolExportInfo)] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  32:     0x7ff9bb0c45bf - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  33:     0x7ff9baf9f924 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  34:     0x7ff9bb061c06 - <&[rustc_middle[c72282b761ffb2ca]::thir::abstract_const::Node] as rustc_serialize[979d5f7f20b036c4]::serialize::Decodable<rustc_query_impl[fcbe4ce9962e1e39]::on_disk_cache::CacheDecoder>>::decode\r\n  35:     0x7ff9b77a96cf - <rustc_driver[2389871ec3bd2ddd]::args::Error as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  36:     0x7ff9b77853a9 - <rustc_mir_dataflow[3acb063bbaa902c6]::impls::liveness::MaybeLiveLocals as rustc_mir_dataflow[3acb063bbaa902c6]::framework::AnalysisDomain>::initialize_start_block\r\n  37:     0x7ff9b77fbf75 - <rustc_driver[2389871ec3bd2ddd]::Compilation as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  38:     0x7ff9b77a5b70 - <rustc_mir_dataflow[3acb063bbaa902c6]::impls::liveness::MaybeLiveLocals as rustc_mir_dataflow[3acb063bbaa902c6]::framework::AnalysisDomain>::initialize_start_block\r\n  39:     0x7ff9b777d8a7 - <rustc_mir_dataflow[3acb063bbaa902c6]::impls::liveness::MaybeLiveLocals as rustc_mir_dataflow[3acb063bbaa902c6]::framework::AnalysisDomain>::initialize_start_block\r\n  40:     0x7ff9b77ebc16 - <rustc_metadata[b2f2848d139875d1]::rmeta::encoder::EncodeContext as rustc_serialize[979d5f7f20b036c4]::serialize::Encoder>::emit_raw_bytes\r\n  41:     0x7ff9b77ae7f8 - <rustc_driver[2389871ec3bd2ddd]::args::Error as core[97cc336334fd47ab]::fmt::Debug>::fmt\r\n  42:     0x7ff9cf8aee2c - std::sys::windows::thread::Thread::new::h811e7c4461002a6b\r\n  43:     0x7ffa33f754e0 - BaseThreadInitThunk\r\n  44:     0x7ffa350e485b - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.63.0-nightly (1fede1753 2022-05-28) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type bin -C embed-bitcode=no -C debuginfo=2 -C incremental\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [deref_mir_constant] deref constant\r\n#1 [check_match] match-checking `main`\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `tempdir`\r\n```\r\n\r\n", "closed_by": {"login": "Julian-Wollersberger", "id": 24991778, "node_id": "MDQ6VXNlcjI0OTkxNzc4", "avatar_url": "https://avatars.githubusercontent.com/u/24991778?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Julian-Wollersberger", "html_url": "https://github.com/Julian-Wollersberger", "followers_url": "https://api.github.com/users/Julian-Wollersberger/followers", "following_url": "https://api.github.com/users/Julian-Wollersberger/following{/other_user}", "gists_url": "https://api.github.com/users/Julian-Wollersberger/gists{/gist_id}", "starred_url": "https://api.github.com/users/Julian-Wollersberger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Julian-Wollersberger/subscriptions", "organizations_url": "https://api.github.com/users/Julian-Wollersberger/orgs", "repos_url": "https://api.github.com/users/Julian-Wollersberger/repos", "events_url": "https://api.github.com/users/Julian-Wollersberger/events{/privacy}", "received_events_url": "https://api.github.com/users/Julian-Wollersberger/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97517/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97517/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}