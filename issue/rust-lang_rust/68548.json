{"url": "https://api.github.com/repos/rust-lang/rust/issues/68548", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68548/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68548/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68548/events", "html_url": "https://github.com/rust-lang/rust/issues/68548", "id": 555159228, "node_id": "MDU6SXNzdWU1NTUxNTkyMjg=", "number": 68548, "title": "Segmentation fault when building instrumented std and with memory sanitizer", "user": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-01-26T00:34:22Z", "updated_at": "2021-02-25T02:56:24Z", "closed_at": "2020-01-26T16:08:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "cc #68539 \r\n\r\nConsider this snippet:\r\n\r\n```rust\r\nfn main() {\r\n    println!(\"Hello, world!\");\r\n}\r\n```\r\nI got segmentation fault when building instrumented std:\r\n```console\r\n% env RUSTFLAGS=\"-Zsanitizer=memory -Cllvm-args=-msan-track-origins=2\" cargo -Zbuild-std build --target x86_64-unknown-linux-gnu\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.08s\r\n% rust-gdb -q /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check                                           \r\nReading symbols from /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check...done.\r\n(gdb) r\r\nStarting program: /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check \r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n__sanitizer::internal_memset(void*, int, unsigned long) () at /checkout/src/llvm-project/compiler-rt/lib/sanitizer_common/sanitizer_libc.cc:93\r\n93      /checkout/src/llvm-project/compiler-rt/lib/sanitizer_common/sanitizer_libc.cc: No such file or directory.\r\n(gdb) quit\r\n\r\n % valgrind -q /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check \r\n==11856== Invalid write of size 1\r\n==11856==    at 0x1CFD50: __sanitizer::internal_memset(void*, int, unsigned long) (src/llvm-project/compiler-rt/lib/sanitizer_common/sanitizer_libc.cc:93)\r\n==11856==    by 0x32601E: std::sys::unix::args::imp::ARGV_INIT_ARRAY::init_wrapper (args.rs:114)\r\n==11856==    by 0x62E1E4: __libc_csu_init (in /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check)\r\n==11856==    by 0x48C6029: (below main) (libc-start.c:264)\r\n==11856==  Address 0x501ffefffd20 is not stack'd, malloc'd or (recently) free'd\r\n==11856== \r\n==11856== \r\n==11856== Process terminating with default action of signal 11 (SIGSEGV)\r\n==11856==  Access not within mapped region at address 0x501FFEFFFD20\r\n==11856==    at 0x1CFD50: __sanitizer::internal_memset(void*, int, unsigned long) (src/llvm-project/compiler-rt/lib/sanitizer_common/sanitizer_libc.cc:93)\r\n==11856==    by 0x32601E: std::sys::unix::args::imp::ARGV_INIT_ARRAY::init_wrapper (args.rs:114)\r\n==11856==    by 0x62E1E4: __libc_csu_init (in /home/lzutao/.cargo/target_dir/x86_64-unknown-linux-gnu/debug/check)\r\n==11856==    by 0x48C6029: (below main) (libc-start.c:264)\r\n==11856==  If you believe this happened as a result of a stack\r\n==11856==  overflow in your program's main thread (unlikely but\r\n==11856==  possible), you can try to increase the size of the\r\n==11856==  main thread stack using the --main-stacksize= flag.\r\n==11856==  The main thread stack size used in this run was 8388608.\r\n```\r\n\r\n---\r\n\r\nMeta:\r\n* rustc 1.42.0-nightly (c2d141df5 2020-01-24)\r\n\r\n_Originally posted by @lzutao in https://github.com/rust-lang/rust/issues/68539#issuecomment-578456832_", "closed_by": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68548/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68548/timeline", "performed_via_github_app": null, "state_reason": "completed"}