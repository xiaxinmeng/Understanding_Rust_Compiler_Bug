{"url": "https://api.github.com/repos/rust-lang/rust/issues/69983", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69983/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69983/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69983/events", "html_url": "https://github.com/rust-lang/rust/issues/69983", "id": 580767034, "node_id": "MDU6SXNzdWU1ODA3NjcwMzQ=", "number": 69983, "title": "help text for `Send` trait bound mismatch is misleading", "user": {"login": "davepacheco", "id": 532688, "node_id": "MDQ6VXNlcjUzMjY4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/532688?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davepacheco", "html_url": "https://github.com/davepacheco", "followers_url": "https://api.github.com/users/davepacheco/followers", "following_url": "https://api.github.com/users/davepacheco/following{/other_user}", "gists_url": "https://api.github.com/users/davepacheco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davepacheco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davepacheco/subscriptions", "organizations_url": "https://api.github.com/users/davepacheco/orgs", "repos_url": "https://api.github.com/users/davepacheco/repos", "events_url": "https://api.github.com/users/davepacheco/events{/privacy}", "received_events_url": "https://api.github.com/users/davepacheco/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 1596299768, "node_id": "MDU6TGFiZWwxNTk2Mjk5NzY4", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-invalid-suggestion", "name": "D-invalid-suggestion", "color": "c9f7a3", "default": false, "description": "A structured suggestion resulting in incorrect code"}], "state": "closed", "locked": false, "assignee": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-03-13T18:18:06Z", "updated_at": "2020-03-30T02:04:01Z", "closed_at": "2020-03-30T02:04:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "This is a small issue but it cost me a fair bit of time and I thought an improvement here could help other new users.\r\n\r\nSummary: when a caller tries to invoke a function with a trait bound that includes `Send`, but the caller's value is not `Send`, the error message says:\r\n\r\n> \"error[E0277]: `T` cannot be sent between threads safely\"\r\n\r\nThe problem here isn't (necessarily) that `T` cannot be sent between threads safely, but more precisely that the function expected `T: Send` and got plain `T`.\r\n\r\nIt might not be obvious how this can be so misleading, but as a relatively new user, I thought Rust was telling me that something in my code was trying to send a value between threads and additionally that the value actually couldn't be sent between threads safely.  Often times neither of those was the case.  You can easily generate this error with single-threaded code and concrete types that all implement `Send`.   In my case, often I'd forgotten to put `Send` on a trait bounds of the caller, or I'd erroneously put `Send` on a trait bound of the callee.  Really, this error is just a simple trait bound mismatch.  Just from my experience, it looks like this message is special-cased for `Send` in order to provide more useful information for someone who might not be familiar with `Send` -- which is great.  I think that information probably belongs in a \"note\" though, and the error should be precise about what actually happened instead of inferring too much (incorrectly, in some cases).\r\n\r\nFor trait bound mismatches involving types other than `Send`, the message is more precise:\r\n\r\n```\r\nuse std::fmt::Debug;\r\n\r\ntrait TheTrait: Debug  {}\r\ntrait OtherTrait: Debug {}\r\n\r\n#[derive(Debug)]\r\nstruct TheStruct {}\r\nimpl TheTrait for TheStruct {}\r\n\r\nfn func1<T: TheTrait>(t: T)\r\n{\r\n    func2(t);\r\n}\r\n\r\nfn func2<T: OtherTrait>(t: T)\r\n{\r\n    eprintln!(\"{:?}\", t);\r\n}\r\n\r\nfn main()\r\n{\r\n    let instance = TheStruct {};\r\n    func1(instance);\r\n}\r\n```\r\n\r\nHere's that example [in the playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=18b7138f639edba237b1295c5e7f615e).  The error message is:\r\n\r\n```\r\nerror[E0277]: the trait bound `T: OtherTrait` is not satisfied\r\n  --> src/main.rs:12:11\r\n   |\r\n10 | fn func1<T: TheTrait>(t: T)\r\n   |          -- help: consider further restricting this bound: `T: OtherTrait +`\r\n11 | {\r\n12 |     func2(t);\r\n   |           ^ the trait `OtherTrait` is not implemented for `T`\r\n...\r\n15 | fn func2<T: OtherTrait>(t: T)\r\n   |    -----    ---------- required by this bound in `func2`\r\n```\r\n\r\nwhich is pretty clear and precise about the problem.  Here's a similar example where the trait bound is `Send`:\r\n\r\n```\r\nuse std::fmt::Debug;\r\n\r\ntrait TheTrait: Debug  {}\r\n\r\n#[derive(Debug)]\r\nstruct TheStruct {}\r\nimpl TheTrait for TheStruct {}\r\n\r\nfn func1<T: TheTrait>(t: T)\r\n{\r\n    func2(t);\r\n}\r\n\r\nfn func2<T: TheTrait + Send>(t: T)\r\n{\r\n    eprintln!(\"{:?}\", t);\r\n}\r\n\r\nfn main()\r\n{\r\n    let instance = TheStruct {};\r\n    func1(instance);\r\n}\r\n```\r\n\r\nHere's that one [on the playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ff324fd5cf68b629b32e5490de6b7246).\r\n\r\nNow the error message is:\r\n\r\n```\r\nerror[E0277]: `T` cannot be sent between threads safely\r\n  --> src/main.rs:11:11\r\n   |\r\n9  | fn func1<T: TheTrait>(t: T)\r\n   |          -- help: consider further restricting this bound: `T: std::marker::Send +`\r\n10 | {\r\n11 |     func2(t);\r\n   |           ^ `T` cannot be sent between threads safely\r\n...\r\n14 | fn func2<T: TheTrait + Send>(t: T)\r\n   |    -----               ---- required by this bound in `func2`\r\n   |\r\n   = help: the trait `std::marker::Send` is not implemented for `T`\r\n```\r\n\r\nThis is the same error code (E0277) and the \"help\" text is right but the summary message isn't.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69983/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69983/timeline", "performed_via_github_app": null, "state_reason": "completed"}