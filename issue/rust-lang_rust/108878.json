{"url": "https://api.github.com/repos/rust-lang/rust/issues/108878", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/108878/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/108878/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/108878/events", "html_url": "https://github.com/rust-lang/rust/issues/108878", "id": 1614199001, "node_id": "I_kwDOAAsO6M5gNrjZ", "number": 108878, "title": "Builds on *-unknown-linux-musl that link to C libaries produce broken binaries", "user": {"login": "WhyNotHugo", "id": 730811, "node_id": "MDQ6VXNlcjczMDgxMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/730811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WhyNotHugo", "html_url": "https://github.com/WhyNotHugo", "followers_url": "https://api.github.com/users/WhyNotHugo/followers", "following_url": "https://api.github.com/users/WhyNotHugo/following{/other_user}", "gists_url": "https://api.github.com/users/WhyNotHugo/gists{/gist_id}", "starred_url": "https://api.github.com/users/WhyNotHugo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WhyNotHugo/subscriptions", "organizations_url": "https://api.github.com/users/WhyNotHugo/orgs", "repos_url": "https://api.github.com/users/WhyNotHugo/repos", "events_url": "https://api.github.com/users/WhyNotHugo/events{/privacy}", "received_events_url": "https://api.github.com/users/WhyNotHugo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2022-11-20T02:43:55Z", "updated_at": "2023-06-08T00:46:56Z", "closed_at": "2023-06-08T00:46:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Problem\r\n\r\nI'm trying to build the following minimal example:\r\n\r\n```rs\r\nfn main() {\r\n    _ = xkbcommon::xkb::Context::new(0);\r\n    println!(\"Hello, world!\");\r\n}\r\n```\r\n\r\nI'm buildling on `aarch64-unknown-linux-musl`, and my target is `aarch64-unknown-linux-musl` (e.g.: there's no cross-compiling going on here).\r\n\r\nThe above builds fine, but the resulting binary fails to run:\r\n\r\n```\r\n> cargo run  \r\n   Compiling libc v0.2.137\r\n   Compiling memmap2 v0.5.7\r\n   Compiling xkbcommon v0.5.0\r\n   Compiling hello v0.1.0 (/home/user/hello)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 6.67s\r\n     Running `target/debug/hello`\r\nerror: could not execute process `target/debug/hello` (never executed)\r\n\r\nCaused by:\r\n  No such file or directory (os error 2)\r\n```\r\n\r\nThe resulting binary is clearly linked against glibc, which is not present here:\r\n\r\n```rs\r\n> ldd target/debug/hello\r\n\t/lib/ld-linux-aarch64.so.1 (0xffffacf0b000)\r\n\tlibxkbcommon.so.0 => /usr/lib/libxkbcommon.so.0 (0xffffacebc000)\r\n\tlibc.musl-aarch64.so.1 => /lib/ld-linux-aarch64.so.1 (0xffffacf0b000)\r\n> readelf -l target/debug/hello\r\n\r\nElf file type is EXEC (Executable file)\r\nEntry point 0x405328\r\nThere are 9 program headers, starting at offset 64\r\n\r\nProgram Headers:\r\n  Type           Offset             VirtAddr           PhysAddr\r\n                 FileSiz            MemSiz              Flags  Align\r\n  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040\r\n                 0x00000000000001f8 0x00000000000001f8  R      0x8\r\n  INTERP         0x0000000000000238 0x0000000000400238 0x0000000000400238\r\n                 0x000000000000001b 0x000000000000001b  R      0x1\r\n      [Requesting program interpreter: /lib/ld-linux-aarch64.so.1]\r\n  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000\r\n                 0x00000000000581dc 0x00000000000581dc  R E    0x10000\r\n  LOAD           0x0000000000058e28 0x0000000000468e28 0x0000000000468e28\r\n                 0x0000000000007338 0x0000000000008e40  RW     0x10000\r\n  DYNAMIC        0x000000000005fcb0 0x000000000046fcb0 0x000000000046fcb0\r\n                 0x00000000000001f0 0x00000000000001f0  RW     0x8\r\n  TLS            0x000000000005d758 0x000000000046d758 0x000000000046d758\r\n                 0x0000000000000028 0x0000000000000050  R      0x8\r\n  GNU_EH_FRAME   0x0000000000056124 0x0000000000456124 0x0000000000456124\r\n                 0x000000000000132c 0x000000000000132c  R      0x4\r\n  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000\r\n                 0x0000000000000000 0x0000000000000000  RW     0x10\r\n  GNU_RELRO      0x0000000000058e28 0x0000000000468e28 0x0000000000468e28\r\n                 0x00000000000071d8 0x00000000000071d8  R      0x1\r\n\r\n Section to Segment mapping:\r\n  Segment Sections...\r\n   00     \r\n   01     .interp \r\n   02     .interp .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .text .fini .rodata .debug_gdb_scripts .eh_frame_hdr .gcc_except_table \r\n   03     .eh_frame .tdata .init_array .fini_array .data.rel.ro .dynamic .got .data .bss \r\n   04     .dynamic \r\n   05     .tdata .tbss \r\n   06     .eh_frame_hdr \r\n   07     \r\n   08     .eh_frame .tdata .init_array .fini_array .data.rel.ro .dynamic .got \r\n```\r\n\r\n### Steps\r\n\r\n```sh\r\nrustup default nightly\r\nmkdir lalala\r\ncd lalala\r\ncargo init\r\ncargo add xkbcommon\r\ncat > src/main.rs <<EOF\r\nfn main() {\r\n    _ = xkbcommon::xkb::Context::new(0);\r\n    println!(\"Hello, world!\");\r\n}\r\nEOF\r\ncargo run\r\n```\r\n\r\n### Possible Solution(s)\r\n\r\nNot sure, I think there's something wrong with the binaries that rustup ships.\r\n\r\n### Notes\r\n\r\nUsing cargo/rust/etc from Alpine repositories works fine. It's the binaries pulled by rustup that are faulty somehow.\r\n\r\nOriginally reported at the library I was trying to use (https://github.com/rust-x-bindings/xkbcommon-rs/issues/37), but eventually realised it seems to be an issue with the binaries that `rustup` pulls.\r\n\r\n### Rustup version\r\n\r\n```console\r\nrustup 1.25.1 :: v20220715+1493 (394daf022 2022-08-03) dirty 2 modifications\r\ninfo: This is the version for the rustup toolchain manager, not the rustc compiler.\r\ninfo: The currently active `rustc` version is `rustc 1.65.0 (897e37553 2022-11-02)`\r\n```\r\n\r\n\r\n### Installed toolchains\r\n\r\n```console\r\nDefault host: aarch64-unknown-linux-musl\r\nrustup home:  /home/user/.rustup\r\n\r\nstable-aarch64-unknown-linux-musl (default)\r\nrustc 1.65.0 (897e37553 2022-11-02)\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/108878/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/108878/timeline", "performed_via_github_app": null, "state_reason": "completed"}