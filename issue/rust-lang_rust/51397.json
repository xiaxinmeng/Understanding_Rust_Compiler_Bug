{"url": "https://api.github.com/repos/rust-lang/rust/issues/51397", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51397/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51397/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51397/events", "html_url": "https://github.com/rust-lang/rust/issues/51397", "id": 329915113, "node_id": "MDU6SXNzdWUzMjk5MTUxMTM=", "number": 51397, "title": "Segfault during clippy lint (SIGSEGV, invalid memory reference; armv7 32bit toolchain)", "user": {"login": "0ndorio", "id": 1611081, "node_id": "MDQ6VXNlcjE2MTEwODE=", "avatar_url": "https://avatars.githubusercontent.com/u/1611081?v=4", "gravatar_id": "", "url": "https://api.github.com/users/0ndorio", "html_url": "https://github.com/0ndorio", "followers_url": "https://api.github.com/users/0ndorio/followers", "following_url": "https://api.github.com/users/0ndorio/following{/other_user}", "gists_url": "https://api.github.com/users/0ndorio/gists{/gist_id}", "starred_url": "https://api.github.com/users/0ndorio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/0ndorio/subscriptions", "organizations_url": "https://api.github.com/users/0ndorio/orgs", "repos_url": "https://api.github.com/users/0ndorio/repos", "events_url": "https://api.github.com/users/0ndorio/events{/privacy}", "received_events_url": "https://api.github.com/users/0ndorio/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-06T15:18:32Z", "updated_at": "2019-01-11T11:31:31Z", "closed_at": "2019-01-11T11:31:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "One of our build agents (a `RaspberryPi 3B`, 64bit) with a 32bit raspberian image which uses the `rustc-arm7-unknown-gnueabihf` tool-chain triggered a reproducible segfault (`signal: 11, SIGSEV, invalid memory reference`). This always happens during the compilation of the projects dependencies in its clippy build step. Neither release/debug build, test or check crashed, all of them went through without any further problems. Based on some further investigation we also discovered, that the segfault disappears as soon as we build clippy in debug mode instead of release (which might be an indication that this a compiler issue).\r\n\r\nWe could reproduced the crash on the following crates: `libc`, `num-traits`, `rustc-serialize`, and `nom`.\r\n\r\n**How to reproduce (Install clippy in release profile):**\r\n```\r\n> cargo +nightly install --git https://github.com/rust-lang-nursery/rust-clippy.git clippy --force\r\n> git clone https://github.com/rust-num/num-traits.git\r\n> cd num_traits\r\n> cargo +nightly clippy --verbose\r\n```\r\n\r\n**How to workaround (Install clippy in debug profile):**\r\n```\r\n> cargo +nightly install --git https://github.com/rust-lang-nursery/rust-clippy.git clippy --force --debug\r\n> git clone https://github.com/rust-num/num-traits.git\r\n> cd num_traits\r\n> cargo +nightly clippy --verbose\r\n```\r\n\r\n## Meta\r\n\r\nCompiler Version\r\n```\r\n$ rustc +nightly --version\r\nrustc 1.28.0-nightly (4a9c58c6b 2018-06-05)\r\n```\r\n\r\nClippy version\r\n```\r\n$ cargo +nightly clippy --version\r\n0.0.207\r\n```\r\n\r\nHardware: RasberryPi 3B\r\n\r\n```\r\n$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Raspbian\r\nDescription:    Raspbian GNU/Linux 9.1 (stretch)\r\nRelease:        9.1\r\nCodename:       stretch\r\n```\r\n\r\n```\r\n$ cat /proc/cpuinfo \r\nprocessor       : 0\r\nmodel name      : ARMv7 Processor rev 4 (v7l)\r\nBogoMIPS        : 38.40\r\nFeatures        : half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt vfpd32 lpae evtstrm crc32 \r\nCPU implementer : 0x41\r\nCPU architecture: 7\r\nCPU variant     : 0x0\r\nCPU part        : 0xd03\r\nCPU revision    : 4\r\n\r\n[...]\r\n\r\nHardware        : BCM2835\r\nRevision        : a02082\r\nSerial          : 000000001e1429c7\r\n```\r\n\r\n## Backtrace & GDB-Output\r\n\r\nDebugging Commands:\r\n```\r\n> env LD_LIBRARY_PATH=/root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib CARGO_MANIFEST_DIR=`pwd` gdb /root/.cargo/bin/clippy-driver\r\n\r\n(gdb) r rustc --crate-name libc /root/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.41/src/lib.rs --crate-type lib --emit=dep-info,metadata -C debuginfo=2 --cfg feature=\\\"default\\\" --cfg feature=\\\"use_std\\\" -C metadata=a2b464cd6bb14ead -C extra-filename=-a2b464cd6bb14ead --out-dir /buildbot/linter_build/target/debug/deps -L dependency=/buildbot/linter_build/target/debug/deps --cap-lints allow\r\n```\r\n\r\nOutput:\r\n```\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x006f9164 in _$LT$clippy_lints..returns..ReturnPass$u20$as$u20$rustc..lint..EarlyLintPass$GT$::check_block::h341954932d19f1df ()\r\n```\r\n\r\nBacktrace:\r\n```\r\n(gdb) backtrace\r\n#0  0x006a8184 in _$LT$clippy_lints..returns..ReturnPass$u20$as$u20$rustc..lint..EarlyLintPass$GT$::check_block::h341954932d19f1df ()\r\n#1  0x7645d2c4 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_block::h2795ee2d37980edf ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#2  0x7645b9c8 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_fn::hee0698e1826f883f ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#3  0x76667fd0 in syntax::visit::walk_impl_item::hfaa9b645dda39c05 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#4  0x7645e73c in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_impl_item::h5aeafb0773399100 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#5  0x7666fd74 in syntax::visit::walk_item::hf37513a8129b0825 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#6  0x7645ab54 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_item::h517943006cb3b893 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#7  0x7645cd2c in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_mod::h9b80153825c3a249 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#8  0x7666faf0 in syntax::visit::walk_item::hf37513a8129b0825 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#9  0x7645ab54 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_item::h517943006cb3b893 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#10 0x7645cd2c in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_mod::h9b80153825c3a249 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#11 0x7666faf0 in syntax::visit::walk_item::hf37513a8129b0825 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#12 0x7645ab54 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_item::h517943006cb3b893 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#13 0x7645cd2c in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_mod::h9b80153825c3a249 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#14 0x7666faf0 in syntax::visit::walk_item::hf37513a8129b0825 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#15 0x7645ab54 in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_item::h517943006cb3b893 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#16 0x7645cd2c in _$LT$rustc..lint..context..EarlyContext$LT$$u27$a$GT$$u20$as$u20$syntax..visit..Visitor$LT$$u27$a$GT$$GT$::visit_mod::h9b80153825c3a249 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#17 0x7645f8b8 in rustc::lint::context::check_ast_crate::h3dfcdea4e58d66d8 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc-26f0f99d8a2a636b.so\r\n#18 0x76e52344 in rustc::util::common::time::h678f7070bc19bef7 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc_driver-c164348a3b010dbc.so\r\n#19 0x76e67864 in rustc_driver::driver::phase_2_configure_and_expand::hb009c5161d9687b2 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc_driver-c164348a3b010dbc.so\r\n#20 0x76e639b0 in rustc_driver::driver::compile_input::haf0a00d295fd205b ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc_driver-c164348a3b010dbc.so\r\n#21 0x76ed5f2c in rustc_driver::run_compiler_with_pool::h0a004f4819a231e4 ()\r\n   from /root/.rustup/toolchains/nightly-armv7-unknown-linux-gnueabihf/lib/librustc_driver-c164348a3b010dbc.so\r\n#22 0x00000000 in ?? ()\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n```", "closed_by": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51397/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51397/timeline", "performed_via_github_app": null, "state_reason": "completed"}