{"url": "https://api.github.com/repos/rust-lang/rust/issues/77112", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77112/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77112/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77112/events", "html_url": "https://github.com/rust-lang/rust/issues/77112", "id": 707477553, "node_id": "MDU6SXNzdWU3MDc0Nzc1NTM=", "number": 77112, "title": "trait selection arbitrarily resolves projection ambiguities", "user": {"login": "benjaminp", "id": 219470, "node_id": "MDQ6VXNlcjIxOTQ3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/219470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benjaminp", "html_url": "https://github.com/benjaminp", "followers_url": "https://api.github.com/users/benjaminp/followers", "following_url": "https://api.github.com/users/benjaminp/following{/other_user}", "gists_url": "https://api.github.com/users/benjaminp/gists{/gist_id}", "starred_url": "https://api.github.com/users/benjaminp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benjaminp/subscriptions", "organizations_url": "https://api.github.com/users/benjaminp/orgs", "repos_url": "https://api.github.com/users/benjaminp/repos", "events_url": "https://api.github.com/users/benjaminp/events{/privacy}", "received_events_url": "https://api.github.com/users/benjaminp/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 149689562, "node_id": "MDU6TGFiZWwxNDk2ODk1NjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-associated-items", "name": "A-associated-items", "color": "f7e101", "default": false, "description": "Area: Associated items such as associated types and consts."}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 631673608, "node_id": "MDU6TGFiZWw2MzE2NzM2MDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-impl-trait", "name": "A-impl-trait", "color": "f7e101", "default": false, "description": "Area: impl Trait. Universally / existentially quantified anonymous types with static dispatch."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-09-23T15:42:26Z", "updated_at": "2020-10-21T04:05:42Z", "closed_at": "2020-10-21T04:05:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\n```rust\r\ntrait Print<T> {\r\n    fn print(self);\r\n}\r\n\r\nimpl Print<char> for () {\r\n    fn print(self) {\r\n        println!(\"char\");\r\n    }\r\n}\r\n\r\nimpl Print<usize> for () {\r\n    fn print(self) {\r\n        println!(\"usize\")\r\n    }\r\n}\r\n\r\nfn make1() -> impl Print<char> + Print<usize> {}\r\n\r\nfn make2() -> impl Print<usize> + Print<char> {}\r\n\r\nfn main() { \r\n    make1().print();\r\n    make2().print();\r\n}\r\n```\r\nThe above program (https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=2e211dacba7209200273bf1bc6a2b77f) prints\r\n```\r\nusize\r\nchar\r\n```\r\nNot only does rustc pick without guidance between ``Print<char>::print`` and ``Print<usize>::print``, but it depends on the ordering of the predicates in the impl traits!\r\n\r\nThis problem happens because trait selection wants to prove that `make1()` implements `Print`. To do that, it arbitrarily selects `Print<usize>` even though the `Print<char>` bound would also suffice at the time of inference. It makes the opposite eager selection for `make2()`.\r\n\r\nThe same problem underlies #66057, where eager selection of projection bounds prevents further inference from removing the ambiguity.\r\n\r\nAnalogous problems exist for associated traits with multiple predicates as they go through the same trait selection code path.", "closed_by": {"login": "benjaminp", "id": 219470, "node_id": "MDQ6VXNlcjIxOTQ3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/219470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benjaminp", "html_url": "https://github.com/benjaminp", "followers_url": "https://api.github.com/users/benjaminp/followers", "following_url": "https://api.github.com/users/benjaminp/following{/other_user}", "gists_url": "https://api.github.com/users/benjaminp/gists{/gist_id}", "starred_url": "https://api.github.com/users/benjaminp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benjaminp/subscriptions", "organizations_url": "https://api.github.com/users/benjaminp/orgs", "repos_url": "https://api.github.com/users/benjaminp/repos", "events_url": "https://api.github.com/users/benjaminp/events{/privacy}", "received_events_url": "https://api.github.com/users/benjaminp/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77112/timeline", "performed_via_github_app": null, "state_reason": "completed"}