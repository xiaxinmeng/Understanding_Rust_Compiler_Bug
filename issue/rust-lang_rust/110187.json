{"url": "https://api.github.com/repos/rust-lang/rust/issues/110187", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110187/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110187/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110187/events", "html_url": "https://github.com/rust-lang/rust/issues/110187", "id": 1662367196, "node_id": "I_kwDOAAsO6M5jFbXc", "number": 110187, "title": "Bitwise ANDs in matches produce incorrect \"non-exhaustive patterns\" error E0004", "user": {"login": "chrisridd", "id": 237257, "node_id": "MDQ6VXNlcjIzNzI1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/237257?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisridd", "html_url": "https://github.com/chrisridd", "followers_url": "https://api.github.com/users/chrisridd/followers", "following_url": "https://api.github.com/users/chrisridd/following{/other_user}", "gists_url": "https://api.github.com/users/chrisridd/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisridd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisridd/subscriptions", "organizations_url": "https://api.github.com/users/chrisridd/orgs", "repos_url": "https://api.github.com/users/chrisridd/repos", "events_url": "https://api.github.com/users/chrisridd/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisridd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-04-11T12:22:48Z", "updated_at": "2023-04-11T16:39:35Z", "closed_at": "2023-04-11T16:39:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this code:\r\n\r\n```rust\r\nfn print_tag_type(byte: u8) -> () {\r\n\tmatch byte & 0b11_0_00000 {\r\n\t\t0b00_0_00000 => println!(\"Universal tag\"),\r\n\t\t0b01_0_00000 => println!(\"Application tag\"),\r\n\t\t0b10_0_00000 => println!(\"Private tag\"),\r\n\t\t0b11_0_00000 => println!(\"Context-specific tag\")\r\n//\t\t_ => println!(\"Context-specific tag\")\r\n\t}\r\n}\r\n```\r\n\r\nI expected to see this happen: it compiles, because the match expression `byte & 0b11_0_00000` can only result in 4 values, each of which matches one arm.\r\n\r\nInstead, this happened: it does not compile and produces:\r\n\r\n```\r\nerror[E0004]: non-exhaustive patterns: `1_u8..=63_u8`, `65_u8..=127_u8`, `129_u8..=191_u8` and 1 more not covered\r\n  --> src/main.rs:10:8\r\n   |\r\n10 |     match byte & 0b11_0_00000 {\r\n   |           ^^^^^^^^^^^^^^^^^^^^^ patterns `1_u8..=63_u8`, `65_u8..=127_u8`, `129_u8..=191_u8` and 1 more not covered\r\n   |\r\n   = note: the matched value is of type `u8`\r\nhelp: ensure that all possible cases are being handled by adding a match arm with a wildcard pattern as shown, or multiple match arms\r\n   |\r\n14 ~         0b11_0_00000 => println!(\"Context-specific tag\"),\r\n15 ~         _ => todo!()\r\n   |\r\n\r\nFor more information about this error, try `rustc --explain E0004`.\r\n```\r\n\r\nThe ranges of 'not covered values' displayed makes it look to me like the bitwise AND is not being used to reduce the number of match arms. The suggested workaround of using \"_\" is OK, but it feels like the compiler's not doing all it could.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.68.2 (9eb3afe9e 2023-03-27) (built from a source tarball)\r\nbinary: rustc\r\ncommit-hash: 9eb3afe9ebe9c7d2b84b71002d44f4a0edac95e0\r\ncommit-date: 2023-03-27\r\nhost: aarch64-apple-darwin\r\nrelease: 1.68.2\r\nLLVM version: 15.0.6\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nNo backtrace is generated.\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110187/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110187/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}