{"url": "https://api.github.com/repos/rust-lang/rust/issues/99854", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/99854/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/99854/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/99854/events", "html_url": "https://github.com/rust-lang/rust/issues/99854", "id": 1320892589, "node_id": "I_kwDOAAsO6M5Ouzit", "number": 99854, "title": "Bad MIR spans", "user": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-07-28T12:57:04Z", "updated_at": "2023-04-05T17:41:37Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "In https://github.com/rust-lang/rust/pull/99780#issuecomment-1197909020, I tried to add an assertion in the span formatting function to validate that the span for the `mir::Body.span` span always contains all spans of MIR statements/terminators.\r\n\r\n```patch\r\ndiff --git a/compiler/rustc_span/src/source_map.rs b/compiler/rustc_span/src/source_map.rs\r\nindex 28381157d50..ad44a0366b5 100644\r\n--- a/compiler/rustc_span/src/source_map.rs\r\n+++ b/compiler/rustc_span/src/source_map.rs\r\n@@ -477,6 +477,8 @@ pub fn span_to_relative_line_string(&self, sp: Span, relative_to: Span) -> Strin\r\n             return self.span_to_embeddable_string(sp);\r\n         }\r\n\r\n+        assert!(relative_to.contains(sp));\r\n+\r\n         let lo_line = lo.line.saturating_sub(offset.line);\r\n         let hi_line = hi.line.saturating_sub(offset.line);\r\n```\r\n\r\nBut this assertion failed for many tests. One such case was for associated constants.\r\n\r\nWe should investigate all the cases where the MIR body span is not fully correct, and add the assertion back in.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/99854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/99854/timeline", "performed_via_github_app": null, "state_reason": "reopened"}