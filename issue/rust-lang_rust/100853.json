{"url": "https://api.github.com/repos/rust-lang/rust/issues/100853", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100853/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100853/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100853/events", "html_url": "https://github.com/rust-lang/rust/issues/100853", "id": 1345557838, "node_id": "I_kwDOAAsO6M5QM5VO", "number": 100853, "title": "Building lld fails on master", "user": {"login": "Ayush1325", "id": 22546812, "node_id": "MDQ6VXNlcjIyNTQ2ODEy", "avatar_url": "https://avatars.githubusercontent.com/u/22546812?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ayush1325", "html_url": "https://github.com/Ayush1325", "followers_url": "https://api.github.com/users/Ayush1325/followers", "following_url": "https://api.github.com/users/Ayush1325/following{/other_user}", "gists_url": "https://api.github.com/users/Ayush1325/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ayush1325/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ayush1325/subscriptions", "organizations_url": "https://api.github.com/users/Ayush1325/orgs", "repos_url": "https://api.github.com/users/Ayush1325/repos", "events_url": "https://api.github.com/users/Ayush1325/events{/privacy}", "received_events_url": "https://api.github.com/users/Ayush1325/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-08-21T18:12:38Z", "updated_at": "2022-08-21T19:04:59Z", "closed_at": "2022-08-21T19:04:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Building lld using the `lld = true` option fails on latest master (31302033095dc75608675cd6f9b884d1692054f0). Here is my `config.toml`:\r\n```toml\r\n# Includes one of the default files in src/bootstrap/defaults\r\nprofile = \"library\"\r\nchangelog-seen = 2\r\n\r\n[llvm]\r\ndownload-ci-llvm = \"if-available\"\r\nccache = \"/bin/ccache\"\r\nninja = true\r\n\r\n# [build]\r\n# target = [\"x86_64-unknown-uefi\"]\r\n\r\n[rust]\r\nlld = true\r\nincremental = true\r\ndeny-warnings = false\r\n\r\n[target.x86_64-unknown-uefi]\r\nlinker = \"rust-lld\"\r\n```\r\n\r\nI am getting the following error output:\r\n```sh\r\nCopying stage0 rustc from stage0 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding LLD for x86_64-unknown-linux-gnu\r\nCMAKE_TOOLCHAIN_FILE_x86_64-unknown-linux-gnu = None\r\nCMAKE_TOOLCHAIN_FILE_x86_64_unknown_linux_gnu = None\r\nHOST_CMAKE_TOOLCHAIN_FILE = None\r\nCMAKE_TOOLCHAIN_FILE = None\r\nCMAKE_PREFIX_PATH_x86_64-unknown-linux-gnu = None\r\nCMAKE_PREFIX_PATH_x86_64_unknown_linux_gnu = None\r\nHOST_CMAKE_PREFIX_PATH = None\r\nCMAKE_PREFIX_PATH = None\r\nCMAKE_x86_64-unknown-linux-gnu = None\r\nCMAKE_x86_64_unknown_linux_gnu = None\r\nHOST_CMAKE = None\r\nCMAKE = None\r\nrunning: \"cmake\" \"/var/home/ayush/Documents/Programming/Rust/rust/src/llvm-project/lld\" \"-G\" \"Ninja\" \"-DCMAKE_INSTALL_MESSAGE=LAZY\" \"-DCMAKE_C_COMPILER_LAUNCHER=/bin/ccache\" \"-DCMAKE_CXX_COMPILER_LAUNCHER=/bin/ccache\" \"-DCMAKE_C_COMPILER=cc\" \"-DCMAKE_CXX_COMPILER=c++\" \"-DCMAKE_ASM_COMPILER=cc\" \"-DCMAKE_C_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64\" \"-DCMAKE_CXX_FLAGS=-ffunction-sections -fdata-sections -fPIC -m64\" \"-DCMAKE_SHARED_LINKER_FLAGS= -Wl,-Bsymbolic -static-libstdc++\" \"-DCMAKE_MODULE_LINKER_FLAGS= -Wl,-Bsymbolic -static-libstdc++\" \"-DCMAKE_EXE_LINKER_FLAGS= -Wl,-Bsymbolic -static-libstdc++\" \"-DLLVM_CONFIG_PATH=/var/home/ayush/Documents/Programming/Rust/rust/build/bootstrap/debug/llvm-config-wrapper\" \"-DLLVM_INCLUDE_TESTS=OFF\" \"-DCMAKE_CXX_STANDARD=14\" \"-DCMAKE_INSTALL_PREFIX=/var/home/ayush/Documents/Programming/Rust/rust/build/x86_64-unknown-linux-gnu/lld\" \"-DCMAKE_ASM_FLAGS= -ffunction-sections -fdata-sections -fPIC -m64\" \"-DCMAKE_BUILD_TYPE=Release\"\r\n-- The C compiler identification is GNU 12.1.1\r\n-- The CXX compiler identification is GNU 12.1.1\r\n-- Detecting C compiler ABI info\r\n-- Detecting C compiler ABI info - done\r\n-- Check for working C compiler: /usr/lib64/ccache/cc - skipped\r\n-- Detecting C compile features\r\n-- Detecting C compile features - done\r\n-- Detecting CXX compiler ABI info\r\n-- Detecting CXX compiler ABI info - done\r\n-- Check for working CXX compiler: /usr/lib64/ccache/c++ - skipped\r\n-- Detecting CXX compile features\r\n-- Detecting CXX compile features - done\r\n-- Found LLVM_CONFIG as /var/home/ayush/Documents/Programming/Rust/rust/build/bootstrap/debug/llvm-config-wrapper\r\nCMake Deprecation Warning at CMakeLists.txt:29 (message):\r\n  Using llvm-config to detect the LLVM installation is deprecated.  The\r\n  installed cmake files should be used instead.  CMake should be able to\r\n  detect your LLVM install automatically, but you can also use LLVM_DIR to\r\n  specify the path containing LLVMConfig.cmake.\r\n\r\n\r\n-- Could NOT find FFI (missing: FFI_LIBRARIES HAVE_FFI_CALL)\r\n-- Performing Test Terminfo_LINKABLE\r\n-- Performing Test Terminfo_LINKABLE - Success\r\n-- Found Terminfo: /usr/lib64/libtinfo.so\r\n-- Found ZLIB: /usr/lib64/libz.so (found version \"1.2.11\")\r\n-- Linker detection: GNU ld\r\n-- Performing Test C_SUPPORTS_FPIC\r\n-- Performing Test C_SUPPORTS_FPIC - Success\r\n-- Performing Test CXX_SUPPORTS_FPIC\r\n-- Performing Test CXX_SUPPORTS_FPIC - Success\r\n-- Building with -fPIC\r\n-- Performing Test C_SUPPORTS_FNO_SEMANTIC_INTERPOSITION\r\n-- Performing Test C_SUPPORTS_FNO_SEMANTIC_INTERPOSITION - Success\r\n-- Performing Test CXX_SUPPORTS_FNO_SEMANTIC_INTERPOSITION\r\n-- Performing Test CXX_SUPPORTS_FNO_SEMANTIC_INTERPOSITION - Success\r\n-- Performing Test SUPPORTS_FVISIBILITY_INLINES_HIDDEN_FLAG\r\n-- Performing Test SUPPORTS_FVISIBILITY_INLINES_HIDDEN_FLAG - Success\r\n-- Performing Test C_SUPPORTS_WERROR_DATE_TIME\r\n-- Performing Test C_SUPPORTS_WERROR_DATE_TIME - Success\r\n-- Performing Test CXX_SUPPORTS_WERROR_DATE_TIME\r\n-- Performing Test CXX_SUPPORTS_WERROR_DATE_TIME - Success\r\n-- Performing Test C_SUPPORTS_WERROR_UNGUARDED_AVAILABILITY_NEW\r\n-- Performing Test C_SUPPORTS_WERROR_UNGUARDED_AVAILABILITY_NEW - Failed\r\n-- Performing Test CXX_SUPPORTS_WERROR_UNGUARDED_AVAILABILITY_NEW\r\n-- Performing Test CXX_SUPPORTS_WERROR_UNGUARDED_AVAILABILITY_NEW - Failed\r\n-- Performing Test CXX_SUPPORTS_MISSING_FIELD_INITIALIZERS_FLAG\r\n-- Performing Test CXX_SUPPORTS_MISSING_FIELD_INITIALIZERS_FLAG - Success\r\n-- Performing Test C_SUPPORTS_IMPLICIT_FALLTHROUGH_FLAG\r\n-- Performing Test C_SUPPORTS_IMPLICIT_FALLTHROUGH_FLAG - Success\r\n-- Performing Test CXX_SUPPORTS_IMPLICIT_FALLTHROUGH_FLAG\r\n-- Performing Test CXX_SUPPORTS_IMPLICIT_FALLTHROUGH_FLAG - Success\r\n-- Performing Test C_SUPPORTS_COVERED_SWITCH_DEFAULT_FLAG\r\n-- Performing Test C_SUPPORTS_COVERED_SWITCH_DEFAULT_FLAG - Failed\r\n-- Performing Test CXX_SUPPORTS_COVERED_SWITCH_DEFAULT_FLAG\r\n-- Performing Test CXX_SUPPORTS_COVERED_SWITCH_DEFAULT_FLAG - Failed\r\n-- Performing Test CXX_SUPPORTS_CLASS_MEMACCESS_FLAG\r\n-- Performing Test CXX_SUPPORTS_CLASS_MEMACCESS_FLAG - Success\r\n-- Performing Test CXX_SUPPORTS_REDUNDANT_MOVE_FLAG\r\n-- Performing Test CXX_SUPPORTS_REDUNDANT_MOVE_FLAG - Success\r\n-- Performing Test CXX_SUPPORTS_PESSIMIZING_MOVE_FLAG\r\n-- Performing Test CXX_SUPPORTS_PESSIMIZING_MOVE_FLAG - Success\r\n-- Performing Test CXX_SUPPORTS_NOEXCEPT_TYPE_FLAG\r\n-- Performing Test CXX_SUPPORTS_NOEXCEPT_TYPE_FLAG - Success\r\n-- Performing Test CXX_WONT_WARN_ON_FINAL_NONVIRTUALDTOR\r\n-- Performing Test CXX_WONT_WARN_ON_FINAL_NONVIRTUALDTOR - Failed\r\n-- Performing Test CXX_SUPPORTS_SUGGEST_OVERRIDE_FLAG\r\n-- Performing Test CXX_SUPPORTS_SUGGEST_OVERRIDE_FLAG - Success\r\n-- Performing Test CXX_WSUGGEST_OVERRIDE_ALLOWS_ONLY_FINAL\r\n-- Performing Test CXX_WSUGGEST_OVERRIDE_ALLOWS_ONLY_FINAL - Success\r\n-- Performing Test C_WCOMMENT_ALLOWS_LINE_WRAP\r\n-- Performing Test C_WCOMMENT_ALLOWS_LINE_WRAP - Failed\r\n-- Performing Test C_SUPPORTS_STRING_CONVERSION_FLAG\r\n-- Performing Test C_SUPPORTS_STRING_CONVERSION_FLAG - Failed\r\n-- Performing Test CXX_SUPPORTS_STRING_CONVERSION_FLAG\r\n-- Performing Test CXX_SUPPORTS_STRING_CONVERSION_FLAG - Failed\r\n-- Performing Test C_SUPPORTS_MISLEADING_INDENTATION_FLAG\r\n-- Performing Test C_SUPPORTS_MISLEADING_INDENTATION_FLAG - Success\r\n-- Performing Test CXX_SUPPORTS_MISLEADING_INDENTATION_FLAG\r\n-- Performing Test CXX_SUPPORTS_MISLEADING_INDENTATION_FLAG - Success\r\n-- Performing Test LINKER_SUPPORTS_COLOR_DIAGNOSTICS\r\n-- Performing Test LINKER_SUPPORTS_COLOR_DIAGNOSTICS - Failed\r\n-- Performing Test C_SUPPORTS_FNO_FUNCTION_SECTIONS\r\n-- Performing Test C_SUPPORTS_FNO_FUNCTION_SECTIONS - Success\r\n-- Performing Test C_SUPPORTS_FFUNCTION_SECTIONS\r\n-- Performing Test C_SUPPORTS_FFUNCTION_SECTIONS - Success\r\n-- Performing Test CXX_SUPPORTS_FFUNCTION_SECTIONS\r\n-- Performing Test CXX_SUPPORTS_FFUNCTION_SECTIONS - Success\r\n-- Performing Test C_SUPPORTS_FDATA_SECTIONS\r\n-- Performing Test C_SUPPORTS_FDATA_SECTIONS - Success\r\n-- Performing Test CXX_SUPPORTS_FDATA_SECTIONS\r\n-- Performing Test CXX_SUPPORTS_FDATA_SECTIONS - Success\r\n-- Looking for os_signpost_interval_begin\r\n-- Looking for os_signpost_interval_begin - not found\r\n-- Performing Test HAVE_CXX_ATOMICS_WITHOUT_LIB\r\n-- Performing Test HAVE_CXX_ATOMICS_WITHOUT_LIB - Success\r\n-- Performing Test HAVE_CXX_ATOMICS64_WITHOUT_LIB\r\n-- Performing Test HAVE_CXX_ATOMICS64_WITHOUT_LIB - Success\r\n-- Performing Test LLVM_HAS_ATOMICS\r\n-- Performing Test LLVM_HAS_ATOMICS - Success\r\n-- LLD version: 14.0.0\r\n-- Found Git: /usr/bin/git (found version \"2.37.2\")\r\nCMake Error at cmake/modules/AddLLD.cmake:63 (llvm_add_tool_symlink):\r\n  Unknown CMake command \"llvm_add_tool_symlink\".\r\nCall Stack (most recent call first):\r\n  tools/lld/CMakeLists.txt:31 (add_lld_symlink)\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/var/home/ayush/Documents/Programming/Rust/rust/build/x86_64-unknown-linux-gnu/lld/build/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/var/home/ayush/Documents/Programming/Rust/rust/build/x86_64-unknown-linux-gnu/lld/build/CMakeFiles/CMakeError.log\".\r\nthread 'main' panicked at '\r\ncommand did not execute successfully, got: exit status: 1\r\n\r\nbuild script failed, must exit now', /var/home/ayush/.cargo/registry/src/github.com-1ecc6299db9ec823/cmake-0.1.48/src/lib.rs:975:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n        finished in 2.476 seconds\r\nBuild completed unsuccessfully in 0:05:43\r\n```\r\n\r\nI was able to build fine until rebasing to master, so I think this might be caused due to llvm update that recently took place.\r\n\r\n# System Information\r\n- OS: Fedora Silverblue 36\r\n- cmake version: 3.22.2\r\n\r\n# Additional Files\r\n- [CMakeError.log](https://github.com/rust-lang/rust/files/9389718/CMakeError.log)\r\n- [CMakeOutput.log](https://github.com/rust-lang/rust/files/9389720/CMakeOutput.log)\r\n\r\n", "closed_by": {"login": "Ayush1325", "id": 22546812, "node_id": "MDQ6VXNlcjIyNTQ2ODEy", "avatar_url": "https://avatars.githubusercontent.com/u/22546812?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ayush1325", "html_url": "https://github.com/Ayush1325", "followers_url": "https://api.github.com/users/Ayush1325/followers", "following_url": "https://api.github.com/users/Ayush1325/following{/other_user}", "gists_url": "https://api.github.com/users/Ayush1325/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ayush1325/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ayush1325/subscriptions", "organizations_url": "https://api.github.com/users/Ayush1325/orgs", "repos_url": "https://api.github.com/users/Ayush1325/repos", "events_url": "https://api.github.com/users/Ayush1325/events{/privacy}", "received_events_url": "https://api.github.com/users/Ayush1325/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100853/timeline", "performed_via_github_app": null, "state_reason": "completed"}