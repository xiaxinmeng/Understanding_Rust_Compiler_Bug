{"url": "https://api.github.com/repos/rust-lang/rust/issues/109892", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109892/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109892/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109892/events", "html_url": "https://github.com/rust-lang/rust/issues/109892", "id": 1652091454, "node_id": "I_kwDOAAsO6M5ieOo-", "number": 109892, "title": "`FnPtr` blanket impls cause \"multiple applicable items in scope\" for unrelated types.", "user": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-04-03T13:37:58Z", "updated_at": "2023-04-04T01:12:21Z", "closed_at": "2023-04-04T01:12:21Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "*Note: the below reduction originally came from a `use num_traits::Float;` + `0.0.max(x)` **in the wild**.*\r\n\r\nI haven't found a way to demonstrate this outside of the \"float inference vars + `Ord` method\" combo, but:\r\n```rust\r\ntrait MyCmp {\r\n    fn cmp(&self) {}\r\n}\r\nimpl MyCmp for f32 {}\r\n\r\nfn main() {\r\n    0.0.cmp();\r\n}\r\n```\r\nworks on stable (`1.68.2`) and beta (`1.69.0-beta.6`), and errors on nightly with:\r\n```\r\nerror[E0034]: multiple applicable items in scope\r\n --> src/main.rs:7:9\r\n  |\r\n7 |     0.0.cmp();\r\n  |         ^^^ multiple `cmp` found\r\n  |\r\nnote: candidate #1 is defined in an impl of the trait `MyCmp` for the type `f32`\r\n --> src/main.rs:2:5\r\n  |\r\n2 |     fn cmp(&self) {}\r\n  |     ^^^^^^^^^^^^^\r\n  = note: candidate #2 is defined in an impl of the trait `Ord` for the type `F`\r\nnote: candidate #3 is defined in the trait `Iterator`\r\n --> /rustc/3a8a131e9509c478ece1c58fe0ea2d49463d2300/library/core/src/iter/traits/iterator.rs:3533:5\r\nhelp: disambiguate the method for candidate #1\r\n  |\r\n7 |     MyCmp::cmp(&0.0);\r\n  |     ~~~~~~~~~~~~~~~~\r\nhelp: disambiguate the method for candidate #2\r\n  |\r\n7 |     Ord::cmp(&0.0);\r\n  |     ~~~~~~~~~~~~~~\r\nhelp: disambiguate the method for candidate #3\r\n  |\r\n7 |     Iterator::cmp(0.0);\r\n  |     ~~~~~~~~~~~~~~~~~~\r\n```\r\n\r\nEven though it doesn't show the source for candidate `#2`, I'm almost certain it's this:\r\nhttps://github.com/rust-lang/rust/blob/f13ccefb5b35af3dbb40a7bbdd64a3216d949664/library/core/src/ptr/mod.rs#L2064-L2070\r\nfrom (cc @lcnr @oli-obk):\r\n* https://github.com/rust-lang/rust/pull/99531\r\n* https://github.com/rust-lang/rust/pull/108080\r\n\r\nOn the original PR I left comments like https://github.com/rust-lang/rust/pull/99531#issuecomment-1194688090, trying to rectify the issues with the original approach, but they didn't go anywhere and the version that one in the end is the (arguably) more fragile original one, that uses blanket `impl`s and works around their unwanted interactions.\r\n\r\nIt's possible in this case all it takes is checking for \"float inference vars\" and making sure they can never be considered to implement `FnPtr`, but I'm worried there might be other edge cases lurking in the shadows.\r\n\r\nAlso, did both of those PRs skip crater? I feel like this shouldn't be that hard to hit in the wild.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109892/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109892/timeline", "performed_via_github_app": null, "state_reason": "completed"}