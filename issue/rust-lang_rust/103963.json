{"url": "https://api.github.com/repos/rust-lang/rust/issues/103963", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103963/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103963/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103963/events", "html_url": "https://github.com/rust-lang/rust/issues/103963", "id": 1435955497, "node_id": "I_kwDOAAsO6M5VlvEp", "number": 103963, "title": "Lint for destructuring a unit struct without binding to a value", "user": {"login": "DesmondWillowbrook", "id": 51814158, "node_id": "MDQ6VXNlcjUxODE0MTU4", "avatar_url": "https://avatars.githubusercontent.com/u/51814158?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DesmondWillowbrook", "html_url": "https://github.com/DesmondWillowbrook", "followers_url": "https://api.github.com/users/DesmondWillowbrook/followers", "following_url": "https://api.github.com/users/DesmondWillowbrook/following{/other_user}", "gists_url": "https://api.github.com/users/DesmondWillowbrook/gists{/gist_id}", "starred_url": "https://api.github.com/users/DesmondWillowbrook/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DesmondWillowbrook/subscriptions", "organizations_url": "https://api.github.com/users/DesmondWillowbrook/orgs", "repos_url": "https://api.github.com/users/DesmondWillowbrook/repos", "events_url": "https://api.github.com/users/DesmondWillowbrook/events{/privacy}", "received_events_url": "https://api.github.com/users/DesmondWillowbrook/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-11-04T11:46:16Z", "updated_at": "2022-11-11T15:29:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Sourced from @dtolnay's [Rust Quiz #25](https://dtolnay.github.io/rust-quiz/25).\r\n\r\n```rust\r\nuse std::fmt::{self, Display};\r\n\r\nstruct S;\r\n\r\nimpl Display for S {\r\n    fn fmt(&self, formatter: &mut fmt::Formatter) -> fmt::Result {\r\n        formatter.write_str(\"1\")\r\n    }\r\n}\r\n\r\nimpl Drop for S {\r\n    fn drop(&mut self) {\r\n        print!(\"2\");\r\n    }\r\n}\r\n\r\nfn f() -> S {\r\n    S\r\n}\r\n\r\nfn main() {\r\n    let S = f();\r\n    print!(\"{}\", S);\r\n}\r\n```\r\n\r\nPrints `212` because the `let S = f();` actually performs an infallible destructuring. This wouldn't be a problem in the case that S was anything but a unit struct, since then you'd have to be explicit about dropping the destructured value. (i.e. `let ComplexStruct (_) = t();`)\r\n\r\nBut since unit structs don't contain anything, destructuring them is ambiguous with direct variable assignment.\r\n\r\nAdding a lint to detect this should help. \r\n\r\nPS. Yes, I checked with `#[clippy::all]`.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103963/timeline", "performed_via_github_app": null, "state_reason": null}