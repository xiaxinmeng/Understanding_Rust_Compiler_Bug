{"url": "https://api.github.com/repos/rust-lang/rust/issues/59122", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59122/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59122/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59122/events", "html_url": "https://github.com/rust-lang/rust/issues/59122", "id": 419774122, "node_id": "MDU6SXNzdWU0MTk3NzQxMjI=", "number": 59122, "title": "Rust 1.33.0 failing UI tests when run with single core", "user": {"login": "ipetkov", "id": 1638690, "node_id": "MDQ6VXNlcjE2Mzg2OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1638690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ipetkov", "html_url": "https://github.com/ipetkov", "followers_url": "https://api.github.com/users/ipetkov/followers", "following_url": "https://api.github.com/users/ipetkov/following{/other_user}", "gists_url": "https://api.github.com/users/ipetkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/ipetkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ipetkov/subscriptions", "organizations_url": "https://api.github.com/users/ipetkov/orgs", "repos_url": "https://api.github.com/users/ipetkov/repos", "events_url": "https://api.github.com/users/ipetkov/events{/privacy}", "received_events_url": "https://api.github.com/users/ipetkov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 632522196, "node_id": "MDU6TGFiZWw2MzI1MjIxOTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-guix", "name": "O-guix", "color": "6e6ec0", "default": false, "description": "Operating system: Guix, https://www.gnu.org/software/guix/"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-12T02:41:34Z", "updated_at": "2022-11-04T22:24:43Z", "closed_at": "2022-11-04T22:24:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm trying to package/build Rust 1.33.0 on Guix and I'm consistently getting some test failures regarding panic messages.\r\n\r\nSeveral run-fail tests check that a `#[test]` with a name like `test_foo` prints a message like `thread 'test_foo' panicked...`, but instead the output will come out as `thread 'main' panicked...`.\r\n\r\nI'm not really sure what can be the cause of the issue, but FWIW we build Rust with the previous stable version already packaged in Guix, and we'll link to our packaged versions of llvm and jemalloc.\r\n\r\nHappy to provide more details as needed; log from the failing test cases is below\r\n\r\n<details>\r\n<pre>\r\n  < Compiletest { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\", mode: \"compile-fail\", suite: \"compile-fail\", path: Some(\"src/test/compile-fail\"), compare_mode: None }\r\n< CompileFail { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\" }\r\nc Assemble { target_compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" } }\r\n> RunFail { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\" }\r\n  > Compiletest { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\", mode: \"run-fail\", suite: \"run-fail\", path: Some(\"src/test/run-fail\"), compare_mode: None }\r\n    c Test { target: \"x86_64-unknown-linux-gnu\", compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c Test { target: \"x86_64-unknown-linux-gnu\", compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c TestHelpers { target: \"x86_64-unknown-linux-gnu\" }\r\n    c TestHelpers { target: \"x86_64-unknown-linux-gnu\" }\r\n    c RemoteCopyLibs { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\" }\r\n    c Assemble { target_compiler: Compiler { stage: 0, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c Compiletest { compiler: Compiler { stage: 0, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\" }\r\n    c Assemble { target_compiler: Compiler { stage: 0, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c Llvm { target: \"x86_64-unknown-linux-gnu\", emscripten: false }\r\n    c Sysroot { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c Libdir { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" }, target: \"x86_64-unknown-linux-gnu\" }\r\n    c Sysroot { compiler: Compiler { stage: 2, host: \"x86_64-unknown-linux-gnu\" } }\r\n    c Llvm { target: \"x86_64-unknown-linux-gnu\", emscripten: false }\r\nCheck compiletest suite=run-fail mode=run-fail (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\nrunning: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage0-tools-bin/compiletest\" \"--compile-lib-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib\" \"--run-lib-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--rustc-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/bin/rustc\" \"--src-base\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail\" \"--build-base\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail\" \"--stage-id\" \"stage2-x86_64-unknown-linux-gnu\" \"--mode\" \"run-fail\" \"--target\" \"x86_64-unknown-linux-gnu\" \"--host\" \"x86_64-unknown-linux-gnu\" \"--llvm-filecheck\" \"/gnu/store/bvnj04sqiwc1gcis29swk6likyc5dw8f-llvm-6.0.1/bin/FileCheck\" \"--host-rustcflags\" \"-Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--target-rustcflags\" \"-Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--docck-python\" \"/gnu/store/g87hamjyipk1j6dfq5pjfzfnfb64spbv-python2-2.7.15/bin/python2\" \"--lldb-python\" \"/gnu/store/g87hamjyipk1j6dfq5pjfzfnfb64spbv-python2-2.7.15/bin/python2\" \"--gdb\" \"/gnu/store/pp6nvrw47ip2r54k4kyk5a8fhyxvhsb8-gdb-8.2/bin/gdb\" \"--verbose\" \"--quiet\" \"--llvm-version\" \"6.0.1\\n\" \"--system-llvm\" \"--cc\" \"\" \"--cxx\" \"\" \"--cflags\" \"\" \"--llvm-components\" \"\" \"--llvm-cxxflags\" \"\" \"--adb-path\" \"adb\" \"--adb-test-dir\" \"/data/tmp/work\" \"--android-cross-path\" \"\"\r\nconfiguration:\r\ncompile_lib_path: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib\"\r\nrun_lib_path: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\"\r\nrustc_path: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/bin/rustc\"\r\nrustdoc_path: None\r\nsrc_base: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail\"\r\nbuild_base: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail\"\r\nstage_id: stage2-x86_64-unknown-linux-gnu\r\nmode: run-fail\r\nrun_ignored: false\r\nfilter: (none)\r\nfilter_exact: false\r\nruntool: (none)\r\nhost-rustcflags: -Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\r\ntarget-rustcflags: -Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\r\ntarget: x86_64-unknown-linux-gnu\r\nhost: x86_64-unknown-linux-gnu\r\nandroid-cross-path: \"\"\r\nadb_path: \"adb\"\r\nadb_test_dir: \"/data/tmp/work\"\r\nadb_device_status: false\r\nar: ar\r\nlinker: None\r\nverbose: true\r\nquiet: true\r\n\r\n\r\n\r\nrunning 143 tests\r\n.................................................................................................... 100/143\r\n........................FF.................\r\nfailures:\r\n\r\n---- [run-fail] run-fail/test-panic.rs stdout ----\r\n\r\n\r\nexecuting \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/bin/rustc\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-panic.rs\" \"--target=x86_64-unknown-linux-gnu\" \"-C\" \"prefer-dynamic\" \"-o\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-panic/a\" \"-Crpath\" \"-O\" \"-Zunstable-options\" \"-Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--test\" \"-L\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-panic/auxiliary\"\r\n------stdout------------------------------\r\n\r\n------stderr------------------------------\r\n\r\n------------------------------------------\r\nexecuting \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-panic/a\"\r\n------stdout------------------------------\r\n\r\nrunning 1 test\r\ntest test_foo ... FAILED\r\n\r\nfailures:\r\n\r\n---- test_foo stdout ----\r\nthread 'main' panicked at 'explicit panic', /tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-panic.rs:8:5\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\n\r\n\r\nfailures:\r\n    test_foo\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out\r\n\r\n\r\n------stderr------------------------------\r\n\r\n------------------------------------------\r\n\r\nerror: error pattern 'thread 'test_foo' panicked at' not found!\r\nstatus: exit code: 101\r\ncommand: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-panic/a\"\r\nstdout:\r\n------------------------------------------\r\n\r\nrunning 1 test\r\ntest test_foo ... FAILED\r\n\r\nfailures:\r\n\r\n---- test_foo stdout ----\r\nthread 'main' panicked at 'explicit panic', /tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-panic.rs:8:5\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\n\r\n\r\nfailures:\r\n    test_foo\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out\r\n\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\n\r\n------------------------------------------\r\n\r\nthread '[run-fail] run-fail/test-panic.rs' panicked at 'explicit panic', src/tools/compiletest/src/runtest.rs:3245:9\r\n\r\n---- [run-fail] run-fail/test-should-fail-bad-message.rs stdout ----\r\n\r\n\r\nexecuting \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/bin/rustc\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-should-fail-bad-message.rs\" \"--target=x86_64-unknown-linux-gnu\" \"-C\" \"prefer-dynamic\" \"-o\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-should-fail-bad-message/a\" \"-Crpath\" \"-O\" \"-Zunstable-options\" \"-Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--test\" \"-L\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-should-fail-bad-message/auxiliary\"\r\n------stdout------------------------------\r\n\r\n------stderr------------------------------\r\n\r\n------------------------------------------\r\nexecuting \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-should-fail-bad-message/a\"\r\n------stdout------------------------------\r\n\r\nrunning 1 test\r\ntest test_foo ... FAILED\r\n\r\nfailures:\r\n\r\n---- test_foo stdout ----\r\nthread 'main' panicked at 'blah', /tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-should-fail-bad-message.rs:9:5\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\nnote: Panic did not include expected string 'foobar'\r\n\r\nfailures:\r\n    test_foo\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out\r\n\r\n\r\n------stderr------------------------------\r\n\r\n------------------------------------------\r\n\r\nerror: error pattern 'thread 'test_foo' panicked at' not found!\r\nstatus: exit code: 101\r\ncommand: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail/test-should-fail-bad-message/a\"\r\nstdout:\r\n------------------------------------------\r\n\r\nrunning 1 test\r\ntest test_foo ... FAILED\r\n\r\nfailures:\r\n\r\n---- test_foo stdout ----\r\nthread 'main' panicked at 'blah', /tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail/test-should-fail-bad-message.rs:9:5\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\nnote: Panic did not include expected string 'foobar'\r\n\r\nfailures:\r\n    test_foo\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out\r\n\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\n\r\n------------------------------------------\r\n\r\nthread '[run-fail] run-fail/test-should-fail-bad-message.rs' panicked at 'explicit panic', src/tools/compiletest/src/runtest.rs:3245:9\r\n\r\n\r\nfailures:\r\n    [run-fail] run-fail/test-panic.rs\r\n    [run-fail] run-fail/test-should-fail-bad-message.rs\r\n\r\ntest result: FAILED. 141 passed; 2 failed; 0 ignored; 0 measured; 0 filtered out\r\n\r\nthread 'main' panicked at 'Some tests failed', src/tools/compiletest/src/main.rs:495:22\r\n\r\n\r\ncommand did not execute successfully: \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage0-tools-bin/compiletest\" \"--compile-lib-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib\" \"--run-lib-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"--rustc-path\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/stage2/bin/rustc\" \"--src-base\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/src/test/run-fail\" \"--build-base\" \"/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/test/run-fail\" \"--stage-id\" \"stage2-x86_64-unknown-linux-gnu\" \"--mode\" \"run-fail\" \"--target\" \"x86_64-unknown-linux-gnu\" \"--host\" \"x86_64-unknown-linux-gnu\" \"--llvm-filecheck\" \"/gnu/store/bvnj04sqiwc1gcis29swk6likyc5dw8f-llvm-6.0.1/bin/FileCheck\" \"--host-rustcflags\" \"-Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--target-rustcflags\" \"-Crpath -O -Zunstable-options  -Lnative=/tmp/guix-build-rust-1.33.0.drv-0/rustc-1.33.0-src/build/x86_64-unknown-linux-gnu/native/rust-test-helpers\" \"--docck-python\" \"/gnu/store/g87hamjyipk1j6dfq5pjfzfnfb64spbv-python2-2.7.15/bin/python2\" \"--lldb-python\" \"/gnu/store/g87hamjyipk1j6dfq5pjfzfnfb64spbv-python2-2.7.15/bin/python2\" \"--gdb\" \"/gnu/store/pp6nvrw47ip2r54k4kyk5a8fhyxvhsb8-gdb-8.2/bin/gdb\" \"--verbose\" \"--quiet\" \"--llvm-version\" \"6.0.1\\n\" \"--system-llvm\" \"--cc\" \"\" \"--cxx\" \"\" \"--cflags\" \"\" \"--llvm-components\" \"\" \"--llvm-cxxflags\" \"\" \"--adb-path\" \"adb\" \"--adb-test-dir\" \"/data/tmp/work\" \"--android-cross-path\" \"\"\r\nexpected success, got: exit code: 101\r\n</pre></details>", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59122/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59122/timeline", "performed_via_github_app": null, "state_reason": "completed"}