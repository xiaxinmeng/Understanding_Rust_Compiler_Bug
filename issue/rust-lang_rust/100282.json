{"url": "https://api.github.com/repos/rust-lang/rust/issues/100282", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100282/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100282/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100282/events", "html_url": "https://github.com/rust-lang/rust/issues/100282", "id": 1332102655, "node_id": "I_kwDOAAsO6M5PZkX_", "number": 100282, "title": "Associated consts in traits interact weirdly with type inference", "user": {"login": "GoldsteinE", "id": 12019211, "node_id": "MDQ6VXNlcjEyMDE5MjEx", "avatar_url": "https://avatars.githubusercontent.com/u/12019211?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GoldsteinE", "html_url": "https://github.com/GoldsteinE", "followers_url": "https://api.github.com/users/GoldsteinE/followers", "following_url": "https://api.github.com/users/GoldsteinE/following{/other_user}", "gists_url": "https://api.github.com/users/GoldsteinE/gists{/gist_id}", "starred_url": "https://api.github.com/users/GoldsteinE/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GoldsteinE/subscriptions", "organizations_url": "https://api.github.com/users/GoldsteinE/orgs", "repos_url": "https://api.github.com/users/GoldsteinE/repos", "events_url": "https://api.github.com/users/GoldsteinE/events{/privacy}", "received_events_url": "https://api.github.com/users/GoldsteinE/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-08-08T16:21:27Z", "updated_at": "2022-08-08T23:02:01Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I tried this code ([playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=243aeffbf1d5aac05edbcbc5ba488d1a)):\r\n\r\n```rust\r\nuse std::marker::PhantomData;\r\n\r\nstruct IsSend<T>(PhantomData<T>);\r\nstruct TaggedBool<T>(bool, PhantomData<T>);\r\n\r\ntrait Helper<T> {\r\n    const VALUE: TaggedBool<T>;\r\n}\r\n\r\nimpl<T, U> Helper<T> for U {\r\n    const VALUE: TaggedBool<T> = TaggedBool(false, PhantomData);\r\n}\r\n\r\nimpl<T: Send> IsSend<T> {\r\n    const VALUE: TaggedBool<T> = TaggedBool(true, PhantomData);\r\n}\r\n\r\nimpl<T> IsSend<T> {\r\n    const fn new(_: &T) -> Self {\r\n        Self(PhantomData)\r\n    }\r\n}\r\n\r\nconst IS_SEND_PTR: bool = {\r\n    // Some value we want to check\r\n    let to_check: *const () = &();\r\n    let mut _checker = IsSend::new(&to_check);\r\n    let tb = IsSend::VALUE;\r\n    // this works:\r\n    // let tb = IsSend::<*const ()>::VALUE;\r\n    _checker.0 = tb.1;\r\n    tb.0\r\n};\r\n\r\nfn main() {\r\n    assert!(!IS_SEND_PTR);\r\n}\r\n```\r\n\r\nI expected this to compile and pass the assertion. \r\nInstead, this happened: compiler successfuly inferred type for `tb`, but for some reason didn\u2019t use the associated constant from trait:\r\n\r\n```\r\nerror[[E0277]](https://doc.rust-lang.org/stable/error-index.html#E0277): `*const ()` cannot be sent between threads safely\r\n  --> src/main.rs:28:14\r\n   |\r\n28 |     let tb = IsSend::VALUE;\r\n   |              ^^^^^^^^^^^^^ `*const ()` cannot be sent between threads safely\r\n   |\r\n   = help: the trait `Send` is not implemented for `*const ()`\r\nnote: required by a bound in `IsSend::<T>::VALUE`\r\n  --> src/main.rs:14:9\r\n   |\r\n14 | impl<T: Send> IsSend<T> {\r\n   |         ^^^^ required by this bound in `IsSend::<T>::VALUE`\r\n15 |     const VALUE: TaggedBool<T> = TaggedBool(true, PhantomData);\r\n   |           ----- required by a bound in this\r\n```\r\n\r\n### Meta\r\n\r\nReplicates on stable, beta and nightly on playground (v1.62.1, v1.63.0-beta9 and 1.65.0-nightly (2022-08-07 d394408fb38c4de61f76) respectively).", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100282/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100282/timeline", "performed_via_github_app": null, "state_reason": null}