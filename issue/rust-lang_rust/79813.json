{"url": "https://api.github.com/repos/rust-lang/rust/issues/79813", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79813/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79813/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79813/events", "html_url": "https://github.com/rust-lang/rust/issues/79813", "id": 758929401, "node_id": "MDU6SXNzdWU3NTg5Mjk0MDE=", "number": 79813, "title": "Tracking Issue for denying trailing semicolons in expression macro bodies", "user": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 3537211190, "node_id": "LA_kwDOAAsO6M7S1Y82", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-tracking-needs-to-bake", "name": "S-tracking-needs-to-bake", "color": "4682b4", "default": false, "description": "This is \"code complete\" but needs time to bake."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-12-07T23:25:38Z", "updated_at": "2023-01-23T20:32:29Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "This is a tracking issue for MCP https://github.com/rust-lang/lang-team/issues/70\r\n\r\n### What is this issue?\r\n\r\nIf you're a crate author who's been linked here, this issue tracks emitting a hard error when a trailing semicolon occurs in a macro used in expression position. See https://github.com/rust-lang/lang-team/issues/70 for some background about the issue.\r\n\r\nIn the future, code like this may stop compiling:\r\n\r\n```rust\r\nmacro_rules! foo {\r\n    () => {\r\n        true;\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let val = match true {\r\n        true => false,\r\n        _ => foo!()\r\n    };\r\n}\r\n```\r\n\r\nIn the above code snippet, `foo!()` is invoked in expression position (in this case, a macro arm). However, `foo!()` expands to the token stream `true;`, which is not a valid expression due to the presence of a trailing semicolon.\r\n\r\nTo make the behavior of macro expansion more consistent, we plan to turn this into a hard error at some point in the future.\r\n\r\nFixing issues in your crate is usually as simple as removing the trailing semicolon from the macro definition.\r\n\r\nCurrently, the associated lint (`semicolon_in_expressions_from_macros`) is set to allow-by-default. As time goes on, we may increase this to warn-by-default.\r\n\r\n\r\n### About tracking issues\r\n\r\nTracking issues are used to record the overall progress of implementation.\r\nThey are also used as hubs connecting to other relevant issues, e.g., bugs or open design questions.\r\nA tracking issue is however *not* meant for large scale discussion, questions, or bug reports about a feature.\r\nInstead, open a dedicated issue for the specific matter and add the relevant feature gate label.\r\n\r\n### Steps\r\n\r\n- [x] Implement the lint: https://github.com/rust-lang/rust/pull/79819\r\n- [X] Do a Crater run to determine the full extent of the impact (https://github.com/rust-lang/rust/pull/81477)\r\n- [X] Fix `lint_node_id` so that we can apply `#[allow]` close to a macro call site (https://github.com/rust-lang/rust/pull/87146)\r\n- [x] When https://github.com/rust-lang/rustfmt/pull/4507 makes it way into a stable release, make the lint warn-by-default\r\n- [x] Mark the lint for inclusion in the cargo future-incompat-report (see https://github.com/rust-lang/rust/issues/71249) (https://github.com/rust-lang/rust/pull/103418)\r\n- [ ] Switch the lint to deny-by-default\r\n- [ ] Consider making the lint a hard error over an edition boundary\r\n\r\n### Unresolved Questions\r\n<!--\r\nInclude any open questions that need to be answered before the feature can be\r\nstabilised.\r\n-->\r\n\r\n### Implementation history\r\n\r\n1. Lint implemented in https://github.com/rust-lang/rust/pull/79819\r\n2. Made warn-by-default in https://github.com/rust-lang/rust/pull/87385\r\n3. Added to future-incompat report in https://github.com/rust-lang/rust/pull/103418\r\n", "closed_by": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79813/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79813/timeline", "performed_via_github_app": null, "state_reason": null}