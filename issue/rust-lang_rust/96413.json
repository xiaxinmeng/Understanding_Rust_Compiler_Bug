{"url": "https://api.github.com/repos/rust-lang/rust/issues/96413", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96413/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96413/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96413/events", "html_url": "https://github.com/rust-lang/rust/issues/96413", "id": 1215147129, "node_id": "I_kwDOAAsO6M5Ibax5", "number": 96413, "title": "std::fmt: Precision via asterisk does not fit documentation when using named or explicit positional arguments", "user": {"login": "EliasHolzmann", "id": 9659253, "node_id": "MDQ6VXNlcjk2NTkyNTM=", "avatar_url": "https://avatars.githubusercontent.com/u/9659253?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EliasHolzmann", "html_url": "https://github.com/EliasHolzmann", "followers_url": "https://api.github.com/users/EliasHolzmann/followers", "following_url": "https://api.github.com/users/EliasHolzmann/following{/other_user}", "gists_url": "https://api.github.com/users/EliasHolzmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/EliasHolzmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EliasHolzmann/subscriptions", "organizations_url": "https://api.github.com/users/EliasHolzmann/orgs", "repos_url": "https://api.github.com/users/EliasHolzmann/repos", "events_url": "https://api.github.com/users/EliasHolzmann/events{/privacy}", "received_events_url": "https://api.github.com/users/EliasHolzmann/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-25T23:21:17Z", "updated_at": "2022-05-02T05:52:01Z", "closed_at": "2022-05-02T05:52:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From the documentation on `std::fmt`, section \"Precision\" (highlighting in bold by me):\r\n\r\n> There are three possible ways to specify the desired precision:\r\n> \r\n> [...]\r\n> \r\n> 3. An asterisk `.*`:\r\n> \r\n>    `.*` means that this `{...}` is associated with two* format inputs rather than one: the first input holds the `usize` precision, and the second holds the value to print. **Note that in this case, if one uses the format string `{<arg>:<spec>.*}`, then the `<arg>` part refers to the *value* to print, and the `precision` must come in the input preceding `<arg>`.**\r\n\r\nThe bold part does not fit the current behavior. Consider the following snippet:\r\n```\r\nfn main() {\r\n    println!(\"{2:.*} {}\", \"foobar\", 1, 2.0);\r\n}\r\n```\r\n[Playground link](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=3ddd7a47216da3385d0476ee4b5a60bb)\r\n\r\nAccording to the documentation, one would expect this program to output `2.0 foobar`. Instead, rustc fails to compile it:\r\n```\r\nerror[[E0308]](https://doc.rust-lang.org/nightly/error-index.html#E0308): mismatched types\r\n   [--> src/main.rs:2:26\r\n](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021#)    |\r\n2   |     println!(\"{2:.*}{}\", \"foobar\", 1, 2.0);\r\n    |     ---------------------^^^^^^^^---------\r\n    |     |                    |\r\n    |     |                    expected `usize`, found `&str`\r\n    |     arguments to this function are incorrect\r\n    |\r\n    = note: expected reference `&usize`\r\n               found reference `&&str`\r\nnote: associated function defined here\r\n    = note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\nAfter glancing at the implementation, it looks to me like in the asterisk case, the precision is always the next implicit positional argument: https://github.com/rust-lang/rust/blob/055bf4ccd521c2c2185166c86951be7be145727c/compiler/rustc_parse_format/src/lib.rs#L577-L585\r\n\r\nThe current implementation determines the argument that will be formatted only after the argument containing the precision. This is the reason why the documentation fits the behavior for implicit positional parameters (like `{:.*}`). However, this doesn't help in the case of explicit positional parameters (like `{42:.*}`) and named parameters (like `{foobar:.*}`) \u2013 the `precision` usually does not come in the input preceding `<arg>`, as stated by the documentation.\r\n\r\nIn my opinion, this is not an implementation bug, but a documentation bug \u2013 the behavior hasn't changed since at least Rust 1.0, see https://godbolt.org/z/xf61oP6hE. It would probably be unwise to change it now as some crates may depend on it. I'd be happy to open a pull request fixing the documentation \u2013 there are a few other things I want to enhance in the `std::fmt` documentation anyway.\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.62.0-nightly (18f314e70 2022-04-24)\r\nbinary: rustc\r\ncommit-hash: 18f314e7027fe7084aaab8620c624a0d7bd29e70\r\ncommit-date: 2022-04-24\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.62.0-nightly\r\nLLVM version: 14.0.1\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96413/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96413/timeline", "performed_via_github_app": null, "state_reason": "completed"}