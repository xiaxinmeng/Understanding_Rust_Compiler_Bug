{"url": "https://api.github.com/repos/rust-lang/rust/issues/73154", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/73154/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/73154/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/73154/events", "html_url": "https://github.com/rust-lang/rust/issues/73154", "id": 634996520, "node_id": "MDU6SXNzdWU2MzQ5OTY1MjA=", "number": 73154, "title": "coercion becomes order dependent for higher-ranked functions", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 1405345617, "node_id": "MDU6TGFiZWwxNDA1MzQ1NjE3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lazy-normalization", "name": "A-lazy-normalization", "color": "f7e101", "default": false, "description": "Area: lazy normalization (tracking issue: #60471)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-08T23:21:44Z", "updated_at": "2022-05-19T12:44:24Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://github.com/rust-lang/rust/pull/72493 revealed an interesting interaction between coercion, the universe transition (https://github.com/rust-lang/rust/issues/56105), and the transition to NLL (https://github.com/rust-lang/rust/issues/57895). What happens in the `old-lub-glb-hr-noteq[12].rs` tests introduced by that PR is:\r\n\r\n* We have to compute the \"coercion LUB\" of `fn('a, 'b) -> 'a` and `fn('a, 'a) -> 'a`. The \"correct answer\" is `fn('a, 'a) -> 'a`. With NLL migration mode, we get a hard error always, but once we enable the NLL mode, our answer depends on the order of the match arms.\r\n* The reason is that the *coercion code* finds that it can create a subtype for either order, so it produces a result that depends on the ordering. That same code introduces a \"equality\" requirement in migration mode that results in an error no matter what. But when those errors are suppressed, we generate NLL, and we only enforce subtyping, which either works or doesn't, depending on what type was chosen.\r\n\r\nHow should we fix this?\r\n\r\n* Keep the error? Unfortunate.\r\n* Extend the leak check so it can distinguish these two types correctly and make the coercion code do a \"evaluate\" that includes a leak check.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/73154/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/73154/timeline", "performed_via_github_app": null, "state_reason": null}