{"url": "https://api.github.com/repos/rust-lang/rust/issues/90718", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90718/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90718/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90718/events", "html_url": "https://github.com/rust-lang/rust/issues/90718", "id": 1048218302, "node_id": "I_kwDOAAsO6M4-eoq-", "number": 90718, "title": "Can I create and use a `*mut` to an uninitialized local?", "user": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2242906716, "node_id": "MDU6TGFiZWwyMjQyOTA2NzE2", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-raw-pointers", "name": "A-raw-pointers", "color": "f7e101", "default": false, "description": "Area: raw pointers, MaybeUninit, NonNull"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2021-11-09T05:53:26Z", "updated_at": "2021-11-13T20:14:00Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[The following code](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=af091e6631ed79d5b4dadfb9c7569ba9) does not compile on current nightly or stable (1.56.1).\r\n\r\n```rust\r\nfn main() {\r\n    let mut x: i32;\r\n    println!(\"{:p}\", std::ptr::addr_of_mut!(x));\r\n}\r\n```\r\n\r\n```\r\nerror[E0381]: borrow of possibly-uninitialized variable: `x`\r\n --> src/main.rs:3:22\r\n  |\r\n3 |     println!(\"{:p}\", std::ptr::addr_of_mut!(x));\r\n  |                      ^^^^^^^^^^^^^^^^^^^^^^^^^ use of possibly-uninitialized `x`\r\n  |\r\n  = note: this error originates in the macro `std::ptr::addr_of_mut` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\nI would expect this to work, since part of the rationale for the `addr_of` macro and raw reference operator (#64490) was to allow creation of pointers to uninitialized memory. On the other hand, I don't think the behavior of locals that are only assigned/accessed indirectly is fully specified (though I don't think my example is UB). Such locals will never be dropped, which might be surprising, and they cannot be used directly, even after being written via the pointer, without encountering the same error.\r\n\r\n`MaybeUninit` is basically always a better choice for these kinds of things, so it shouldn't be of much importance to users. However, we should avoid depending on the illegality of such code inside the compiler\u2013a more complex example arose while discussing region inference\u2013unless we have made a conscious decision to forbid it. Alternatively, if interacting with uninitialized locals is well-defined, we should probably make `addr_of` work on them.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90718/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90718/timeline", "performed_via_github_app": null, "state_reason": null}