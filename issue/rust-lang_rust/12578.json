{"url": "https://api.github.com/repos/rust-lang/rust/issues/12578", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12578/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12578/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12578/events", "html_url": "https://github.com/rust-lang/rust/issues/12578", "id": 28370630, "node_id": "MDU6SXNzdWUyODM3MDYzMA==", "number": 12578, "title": "Attribute for \"swapping\" types in tests, making dependency injecting easier ", "user": {"login": "Valloric", "id": 919444, "node_id": "MDQ6VXNlcjkxOTQ0NA==", "avatar_url": "https://avatars.githubusercontent.com/u/919444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Valloric", "html_url": "https://github.com/Valloric", "followers_url": "https://api.github.com/users/Valloric/followers", "following_url": "https://api.github.com/users/Valloric/following{/other_user}", "gists_url": "https://api.github.com/users/Valloric/gists{/gist_id}", "starred_url": "https://api.github.com/users/Valloric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Valloric/subscriptions", "organizations_url": "https://api.github.com/users/Valloric/orgs", "repos_url": "https://api.github.com/users/Valloric/repos", "events_url": "https://api.github.com/users/Valloric/events{/privacy}", "received_events_url": "https://api.github.com/users/Valloric/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-02-26T21:20:10Z", "updated_at": "2015-01-23T03:09:08Z", "closed_at": "2015-01-23T03:09:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In other languages like C++, Java, C# etc dependency injection can be a big pain; you want your class `Foo` to use class `Bar` in production, but class `MockBar` in tests. This is usually enabled by explicit dependency injection support in class `Foo` (through ctor/setter/interface injection) and the code that uses `Foo`s. It's a fairly big hassle and requires a ton of boilerplate code.\n\nI'd like to see Rust provide compiler-level support for swapping types when `cfg(test)`. Something like this:\n\n``` rust\n#[cfg(test)]\nmod testmod {\n  struct MockBar {\n  ...\n  }\n\n  #[test]\n  #[swap(Bar, MockBar)]\n  fn testfunc() { \n    // Foo::new() now creates MockBars instead of Bars internally\n    let foo = Foo::new();\n    assert_eq!(foo.frobulate(), 5);\n  }\n}\n```\n\nThe idea is to swap any uses of `Bar` with `MockBar` in all the code that's executed through the annotated test function. The beauty lies in not having to mangle the production code just so we can isolate only the parts we want to test. \n\nI'm not sure how difficult it would be to implement this and I don't have this idea fully fleshed out, but the gist should be apparent. It doesn't even have to be an attribute; frankly I don't care _how_ this is implemented as long as I can replace one type with another type that implements the same interface[s] for the purpose of test code _and that I don't have to change the production code to do it._\n\nAny such support should of course only work when `cfg(test)`. Enabling this in production code would IMO be a bad idea.\n\nEDIT: Forgot to mention, being able to swap functions in this way and not just types would make this feature even more awesome.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12578/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12578/timeline", "performed_via_github_app": null, "state_reason": "completed"}