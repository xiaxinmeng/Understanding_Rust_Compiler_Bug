{"url": "https://api.github.com/repos/rust-lang/rust/issues/35658", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/35658/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/35658/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/35658/events", "html_url": "https://github.com/rust-lang/rust/issues/35658", "id": 171035764, "node_id": "MDU6SXNzdWUxNzEwMzU3NjQ=", "number": 35658, "title": "Compiler is overly eager to build following file lock wait", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-08-14T01:00:27Z", "updated_at": "2016-08-15T19:52:45Z", "closed_at": "2016-08-15T19:52:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Steps to reproduce\n1. Run emacs? (It makes and deletes autosave files in the same directories as working file buffers, which may help trigger it.)\n   - `flycheck-rust` may be a contributor.\n2. Iterate over a file and `cargo test` immediately after saving. Success if you see \"waiting for file lock\" in build output.\n3. Observe that build process can't actually get the crate referenced properly (as below).\n### Workaround\n1. Sigh at below output.\n2. `cargo test` again without touching any files.\n3. Observe usual passing tests.\n## Error log\n\nAn example from a project I'm working on:\n\n```\n$ cargo test\n    Blocking waiting for file lock on build directory\n   Compiling wd40 v0.1.0 (file:///Users/talex/git/starfighter/wd40)\n    Finished debug [unoptimized + debuginfo] target(s) in 14.0 secs\n     Running target/debug/deps/wd40-f757f6198b80f6ed\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured\n\n   Doc-tests wd40\n\nrunning 11 tests\ntest account::orders_0 ... FAILED\ntest game::start_level_0 ... FAILED\ntest account::place_order_0 ... FAILED\ntest account::stock_orders_0 ... FAILED\ntest heartbeat_0 ... FAILED\ntest stock::order_cancel_0 ... FAILED\ntest stock::last_quote_0 ... FAILED\ntest stock::order_status_0 ... FAILED\ntest venue::heartbeat_0 ... FAILED\ntest venue::stocks_0 ... FAILED\ntest stock::orderbook_0 ... FAILED\n\nfailures:\n\n---- account::orders_0 stdout ----\n    error: extern location for wd40 does not exist: /Users/talex/git/starfighter/wd40/target/debug/deps/libwd40.rlib\n<anon>:1:1: 1:19 error: can't find crate for `wd40` [E0463]\n<anon>:1 extern crate wd40;\n         ^~~~~~~~~~~~~~~~~~\nerror: aborting due to 2 previous errors\nthread 'account::orders_0' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:674\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\nthread 'account::orders_0' panicked at 'couldn't compile the test', ../src/librustdoc/test.rs:287\n\n---- game::start_level_0 stdout ----\n    error: extern location for wd40 does not exist: /Users/talex/git/starfighter/wd40/target/debug/deps/libwd40.rlib\n<anon>:1:1: 1:19 error: can't find crate for `wd40` [E0463]\n<anon>:1 extern crate wd40;\n         ^~~~~~~~~~~~~~~~~~\nerror: aborting due to 2 previous errors\nthread 'game::start_level_0' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:674\nthread 'game::start_level_0' panicked at 'couldn't compile the test', ../src/librustdoc/test.rs:287\n\nTRUNCATED\n```\n## Meta\n- Rust: rustc 1.12.0-nightly (28ce3e8a5 2016-08-01)\n- OS: Latest OSX\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/35658/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/35658/timeline", "performed_via_github_app": null, "state_reason": "completed"}