{"url": "https://api.github.com/repos/rust-lang/rust/issues/49720", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49720/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49720/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49720/events", "html_url": "https://github.com/rust-lang/rust/issues/49720", "id": 311861168, "node_id": "MDU6SXNzdWUzMTE4NjExNjg=", "number": 49720, "title": "Improve Debug representation of proc_macro::TokenStream", "user": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 632573348, "node_id": "MDU6TGFiZWw2MzI1NzMzNDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-2.0", "name": "A-macros-2.0", "color": "f7e101", "default": false, "description": "Area: declarative macros 2.0, https://github.com/rust-lang/rust/issues/39412"}], "state": "closed", "locked": false, "assignee": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2018-04-06T06:29:50Z", "updated_at": "2018-04-07T11:59:02Z", "closed_at": "2018-04-07T11:59:02Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Currently the Debug representation of the TokenStream corresponding to tokens `[a + 1]` is as follows. This is just delegating to the derived Debug impls of the underlying syntax::tokenstream::TokenStream.\r\n\r\n<details>\r\n<summary><i>Show current Debug representation of <code>[a + 1]</code>...</i></summary>\r\n\r\n```rust\r\nTokenStream {\r\n    kind: Stream(\r\n        [\r\n            TokenStream {\r\n                kind: Tree(\r\n                    Delimited(\r\n                        Span {\r\n                            lo: BytePos(\r\n                                79\r\n                            ),\r\n                            hi: BytePos(\r\n                                86\r\n                            ),\r\n                            ctxt: #0\r\n                        },\r\n                        Delimited {\r\n                            delim: Bracket,\r\n                            tts: ThinTokenStream(\r\n                                Some(\r\n                                    [\r\n                                        TokenStream {\r\n                                            kind: Tree(\r\n                                                Token(\r\n                                                    Span {\r\n                                                        lo: BytePos(\r\n                                                            80\r\n                                                        ),\r\n                                                        hi: BytePos(\r\n                                                            81\r\n                                                        ),\r\n                                                        ctxt: #0\r\n                                                    },\r\n                                                    Ident(\r\n                                                        a#0,\r\n                                                        false\r\n                                                    )\r\n                                                )\r\n                                            )\r\n                                        },\r\n                                        TokenStream {\r\n                                            kind: Tree(\r\n                                                Token(\r\n                                                    Span {\r\n                                                        lo: BytePos(\r\n                                                            82\r\n                                                        ),\r\n                                                        hi: BytePos(\r\n                                                            83\r\n                                                        ),\r\n                                                        ctxt: #0\r\n                                                    },\r\n                                                    BinOp(\r\n                                                        Plus\r\n                                                    )\r\n                                                )\r\n                                            )\r\n                                        },\r\n                                        TokenStream {\r\n                                            kind: Tree(\r\n                                                Token(\r\n                                                    Span {\r\n                                                        lo: BytePos(\r\n                                                            84\r\n                                                        ),\r\n                                                        hi: BytePos(\r\n                                                            85\r\n                                                        ),\r\n                                                        ctxt: #0\r\n                                                    },\r\n                                                    Literal(\r\n                                                        Integer(\r\n                                                            1\r\n                                                        ),\r\n                                                        None\r\n                                                    )\r\n                                                )\r\n                                            )\r\n                                        }\r\n                                    ]\r\n                                )\r\n                            )\r\n                        }\r\n                    )\r\n                )\r\n            }\r\n        ]\r\n    )\r\n}\r\n```\r\n</details>\r\n\r\n---\r\n\r\nIt would be far more helpful to have the Debug for proc_macro::TokenStream line up better with the TokenStream public API. Something like:\r\n\r\n```rust\r\nTokenStream [\r\n    Group {\r\n        delimiter: Bracket,\r\n        stream: TokenStream [\r\n            Term {\r\n                name: \"a\",\r\n                span: #0 bytes(80..81)\r\n            },\r\n            Op {\r\n                op: '+',\r\n                spacing: Alone,\r\n                span: #0 bytes(82..83)\r\n            },\r\n            Literal {\r\n                value: `1`,\r\n                span: #0 bytes(84..85)\r\n            }\r\n        },\r\n        span: #0 bytes(79..86)\r\n    }\r\n]\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49720/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49720/timeline", "performed_via_github_app": null, "state_reason": "completed"}