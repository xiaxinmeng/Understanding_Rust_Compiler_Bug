{"url": "https://api.github.com/repos/rust-lang/rust/issues/112041", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/112041/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/112041/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/112041/events", "html_url": "https://github.com/rust-lang/rust/issues/112041", "id": 1729490904, "node_id": "I_kwDOAAsO6M5nFe_Y", "number": 112041, "title": "A way to disable tail call optimizations in LLVM for arm targets", "user": {"login": "nikarh", "id": 5517011, "node_id": "MDQ6VXNlcjU1MTcwMTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5517011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikarh", "html_url": "https://github.com/nikarh", "followers_url": "https://api.github.com/users/nikarh/followers", "following_url": "https://api.github.com/users/nikarh/following{/other_user}", "gists_url": "https://api.github.com/users/nikarh/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikarh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikarh/subscriptions", "organizations_url": "https://api.github.com/users/nikarh/orgs", "repos_url": "https://api.github.com/users/nikarh/repos", "events_url": "https://api.github.com/users/nikarh/events{/privacy}", "received_events_url": "https://api.github.com/users/nikarh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-05-28T14:18:42Z", "updated_at": "2023-05-29T20:05:06Z", "closed_at": "2023-05-29T20:05:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi, I am the maintainer of Tier 3 target `armv7-sony-vita-newlibeabihf`.\r\n\r\nThere is an issue with tail call optimization causing crashes on this specific target. As an example, this often happens in drop calls, which in System allocator do `libc::free`, or in thread code which calls destroy functions as a last call.\r\n\r\nThe exact cause of the issue is unknown and would be hard to figure out, it might be caused by llvm bug, an issue with opensource SDK used to create a binary for the target platform, or outright hardware limitation. What complicates the analysis most is the fact that there is essentially no way to debug code on this platform.\r\n\r\nSo far the best solution I found for this issue is outright disabling tail and sibling call optimizations in llvm for this platform. With it disabled, there are no crashes regardless of the opt-level. The problem is there is no flag in llvm to disable tail calls on arm.\r\n\r\nWhat would be the best course of action to fix this problem? Should I make a PR to upstream llvm with a flag that allows disabling tail calls on arm, and then get it backported to rust llvm fork?", "closed_by": {"login": "nikarh", "id": 5517011, "node_id": "MDQ6VXNlcjU1MTcwMTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5517011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikarh", "html_url": "https://github.com/nikarh", "followers_url": "https://api.github.com/users/nikarh/followers", "following_url": "https://api.github.com/users/nikarh/following{/other_user}", "gists_url": "https://api.github.com/users/nikarh/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikarh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikarh/subscriptions", "organizations_url": "https://api.github.com/users/nikarh/orgs", "repos_url": "https://api.github.com/users/nikarh/repos", "events_url": "https://api.github.com/users/nikarh/events{/privacy}", "received_events_url": "https://api.github.com/users/nikarh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/112041/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/112041/timeline", "performed_via_github_app": null, "state_reason": "completed"}