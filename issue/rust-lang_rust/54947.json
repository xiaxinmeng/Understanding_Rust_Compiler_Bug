{"url": "https://api.github.com/repos/rust-lang/rust/issues/54947", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54947/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54947/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54947/events", "html_url": "https://github.com/rust-lang/rust/issues/54947", "id": 368490852, "node_id": "MDU6SXNzdWUzNjg0OTA4NTI=", "number": 54947, "title": "Panicking in const context results in peculiar compiler error message", "user": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 268744493, "node_id": "MDU6TGFiZWwyNjg3NDQ0OTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-fn", "name": "A-const-fn", "color": "f7e101", "default": false, "description": "Area: const fn foo(..) {..}. Pure functions which can be applied at compile time."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2018-10-10T04:35:49Z", "updated_at": "2018-10-18T20:04:49Z", "closed_at": "2018-10-18T20:04:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Take this program:\r\n```rust\r\nconst fn foo() -> i32 {\r\n    [1,2,3][42]  // error here\r\n}\r\n\r\nstatic BAR: i32 = foo();\r\n\r\nfn main() {\r\n    println!(\"{}\", BAR)\r\n}\r\n```\r\n\r\nOn nightly it produces this error output:\r\n```\r\nerror: index out of bounds: the len is 3 but the index is 42\r\n --> src/main.rs:2:5\r\n  |\r\n2 |     [1,2,3][42]\r\n  |     ^^^^^^^^^^^\r\n  |\r\n  = note: #[deny(const_err)] on by default\r\n\r\nerror[E0080]: could not evaluate static initializer\r\n --> src/main.rs:2:5\r\n  |\r\n2 |     [1,2,3][42]\r\n  |     ^^^^^^^^^^^ index out of bounds: the len is 3 but the index is 42\r\n...\r\n5 | static BAR: i32 = foo();\r\n  |                   ----- inside call to `foo`\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\nTo some degree the redundancy is understandable, since the first error is in the const fn definition itself while the second is at the use site (and has the additional useful context); perhaps this could be improved somehow. But more noteworthy is the line in the first error message: `note: #[deny(const_err)] on by default`. Sure enough, `#![allow(const_err)]` silences this error. I suspect this is some sort of oversight, because why would we ever want to allow such an error to be silenced? Is this intentional?", "closed_by": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54947/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54947/timeline", "performed_via_github_app": null, "state_reason": "completed"}