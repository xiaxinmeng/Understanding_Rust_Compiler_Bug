{"url": "https://api.github.com/repos/rust-lang/rust/issues/62765", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/62765/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/62765/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/62765/events", "html_url": "https://github.com/rust-lang/rust/issues/62765", "id": 469403593, "node_id": "MDU6SXNzdWU0Njk0MDM1OTM=", "number": 62765, "title": "Document that str, slices, (more?) can't safely straddle allocation boundaries", "user": {"login": "hanna-kruppe", "id": 2311707, "node_id": "MDQ6VXNlcjIzMTE3MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2311707?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hanna-kruppe", "html_url": "https://github.com/hanna-kruppe", "followers_url": "https://api.github.com/users/hanna-kruppe/followers", "following_url": "https://api.github.com/users/hanna-kruppe/following{/other_user}", "gists_url": "https://api.github.com/users/hanna-kruppe/gists{/gist_id}", "starred_url": "https://api.github.com/users/hanna-kruppe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hanna-kruppe/subscriptions", "organizations_url": "https://api.github.com/users/hanna-kruppe/orgs", "repos_url": "https://api.github.com/users/hanna-kruppe/repos", "events_url": "https://api.github.com/users/hanna-kruppe/events{/privacy}", "received_events_url": "https://api.github.com/users/hanna-kruppe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-07-17T19:30:18Z", "updated_at": "2020-03-06T15:18:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Slicing, indexing, and other safe operations on slices and strings pervasively use `<*T>::offset` and APIs built on top of it. These have the requirement that\r\n\r\n> Both the starting and resulting pointer must be either in bounds or one byte past the end of the same allocated object.\r\n\r\nSo if one allocates two pieces of memory and after proper checking miraculously finds they are directly adjacent, one can't safely construct a slice/str/etc. that spans both of these allocations. At least, one can't do very many things with the result it without causing UB from crossing the boundary between the allocations.\r\n\r\nI couldn't find anything documenting this. It should be noted on the unsafe constructors (`from_raw_parts` etc.) at minimum. These already link to `offset`'s documentation but only refer to its \"no larger than isize::MAX\" requirement, with no mention that the other requirements are also relevant. \r\n\r\ncc https://github.com/oberien/str-concat/issues/8\r\ncc @rust-lang/wg-unsafe-code-guidelines \r\n\r\n(Similar issues apply to references-to-arrays and field accesses in aggregates, but this is due to the compiler's codegen for language primitives rather than due to standard library code, so it should go into the UCG and I believe we're more or less covering that already.)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/62765/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/62765/timeline", "performed_via_github_app": null, "state_reason": null}