{"url": "https://api.github.com/repos/rust-lang/rust/issues/40483", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40483/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40483/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40483/events", "html_url": "https://github.com/rust-lang/rust/issues/40483", "id": 213865278, "node_id": "MDU6SXNzdWUyMTM4NjUyNzg=", "number": 40483, "title": "rustc does not understand linker scripts with `GROUP` statements", "user": {"login": "raphaelcohn", "id": 1307097, "node_id": "MDQ6VXNlcjEzMDcwOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1307097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/raphaelcohn", "html_url": "https://github.com/raphaelcohn", "followers_url": "https://api.github.com/users/raphaelcohn/followers", "following_url": "https://api.github.com/users/raphaelcohn/following{/other_user}", "gists_url": "https://api.github.com/users/raphaelcohn/gists{/gist_id}", "starred_url": "https://api.github.com/users/raphaelcohn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/raphaelcohn/subscriptions", "organizations_url": "https://api.github.com/users/raphaelcohn/orgs", "repos_url": "https://api.github.com/users/raphaelcohn/repos", "events_url": "https://api.github.com/users/raphaelcohn/events{/privacy}", "received_events_url": "https://api.github.com/users/raphaelcohn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-13T18:59:46Z", "updated_at": "2017-07-27T18:28:31Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I'm statically linking dpdk (`libdpdk.a`) to a rust rlib via Cargo. The compiler fails with `failed to add native library /Volumes/Source/GitHub/lemonrock/dpdk/components/dpdk-sys/compile-dpdk.conf.d/temporary/destdir/usr/local/lib/libdpdk.a: failed to open archive`. This archive is actually a linker script which contains a `GROUP` statement\\*. Such linker scripts occur when dealing with native C libraries from time-to-time, particularly on libraries only targeting Linux systems (which have historically used the GNU tools which supported them). I also recall them being used in the past for some ?glibc? .so files.\r\n\r\nI'm surprised rustc fails on this - I'd incorrectly assumed it would have just passed the linked argument (`-l static=dpdk`) down to the linker (`cc` in this case). I think rustc should gain some knowledge of these scripts; technically a `GROUP` is supposed to be interpreted as `-Wl,-(` malarky IIRC.\r\n\r\nI have a workaround I can implement via a `build.rs` for now, so this isn't critical to me - just open the linker script and spit out the contents to rustc as a bunch of links - but this probably isn't technically correct as I note above. Note, personally, I'm not a fan of linker scripts, but they have their place, I suppose; for those not authoring exotic alternatives to ELF or writing bare metal, they're handy for listing dependencies of dependencies when static linking. I just wish the original authors had used a different file extension for them...\r\n\r\n\\* FYI, contents of `libdpdk.a`: `GROUP ( librte_acl.a librte_cfgfile.a librte_cmdline.a librte_cryptodev.a librte_distributor.a librte_eal.a librte_efd.a librte_ethdev.a librte_hash.a librte_ip_frag.a librte_jobstats.a librte_kni.a librte_kvargs.a librte_lpm.a librte_mbuf.a librte_mempool.a librte_meter.a librte_net.a librte_pdump.a librte_pipeline.a librte_pmd_af_packet.a librte_pmd_bnxt.a librte_pmd_bond.a librte_pmd_cxgbe.a librte_pmd_e1000.a librte_pmd_ena.a librte_pmd_enic.a librte_pmd_fm10k.a librte_pmd_i40e.a librte_pmd_ixgbe.a librte_pmd_nfp.a librte_pmd_null.a librte_pmd_null_crypto.a librte_pmd_qede.a librte_pmd_ring.a librte_pmd_sfc_efx.a librte_pmd_tap.a librte_pmd_vhost.a librte_pmd_virtio.a librte_pmd_vmxnet3_uio.a librte_port.a librte_power.a librte_reorder.a librte_ring.a librte_sched.a librte_table.a librte_timer.a librte_vhost.a )`", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40483/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40483/timeline", "performed_via_github_app": null, "state_reason": null}