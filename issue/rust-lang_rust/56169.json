{"url": "https://api.github.com/repos/rust-lang/rust/issues/56169", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/56169/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/56169/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/56169/events", "html_url": "https://github.com/rust-lang/rust/issues/56169", "id": 383618897, "node_id": "MDU6SXNzdWUzODM2MTg4OTc=", "number": 56169, "title": "Multiple crates with the same name lead to conflicting `target/doc/crate` directories", "user": {"login": "jturner314", "id": 1836850, "node_id": "MDQ6VXNlcjE4MzY4NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1836850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jturner314", "html_url": "https://github.com/jturner314", "followers_url": "https://api.github.com/users/jturner314/followers", "following_url": "https://api.github.com/users/jturner314/following{/other_user}", "gists_url": "https://api.github.com/users/jturner314/gists{/gist_id}", "starred_url": "https://api.github.com/users/jturner314/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jturner314/subscriptions", "organizations_url": "https://api.github.com/users/jturner314/orgs", "repos_url": "https://api.github.com/users/jturner314/repos", "events_url": "https://api.github.com/users/jturner314/events{/privacy}", "received_events_url": "https://api.github.com/users/jturner314/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-22T17:27:47Z", "updated_at": "2019-06-25T21:28:27Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The new [`rename-dependency` feature](https://github.com/rust-lang/cargo/pull/6319) in Rust 1.31 makes it possible to depend on multiple versions of the same crate. This mostly works fine, but when building docs, the docs of one version overwrite the docs of the other version.\r\n\r\nI'm working on adding support for converting arrays from the `nalgebra` crate to the `ndarray` crate, and I'd like this to work for multiple versions of `nalgebra`. So, I've added this to the `Cargo.toml` of `ndarray`:\r\n\r\n```toml\r\n[dependencies]\r\nnalgebra-crate-0_15 = { package = \"nalgebra\", version = \"0.15\", optional = true }\r\nnalgebra-crate-0_16 = { package = \"nalgebra\", version = \"0.16\", optional = true }\r\n\r\n[features]\r\nnalgebra-0_15 = [\"nalgebra-crate-0_15\"]\r\nnalgebra-0_16 = [\"nalgebra-crate-0_16\"]\r\n```\r\n\r\nIn `lib.rs`, the features are used for conditional compilation:\r\n\r\n```rust\r\n#[cfg(feature = \"nalgebra-0_15\")]\r\nextern crate nalgebra_crate_0_15;\r\n#[cfg(feature = \"nalgebra-0_16\")]\r\nextern crate nalgebra_crate_0_16;\r\n\r\n#[cfg(feature = \"nalgebra-0_15\")]\r\nmod convert_nalgebra_0_15;\r\n#[cfg(feature = \"nalgebra-0_16\")]\r\nmod convert_nalgebra_0_16;\r\n```\r\n\r\nand the `convert_nalgebra_0_15` and `convert_nalgebra_0_16` modules implement the conversions. For example, `convert_nalgebra_0_15` contains\r\n\r\n```rust\r\nuse imp_prelude::*;\r\nuse nalgebra_crate_0_15 as na;\r\n\r\n/// **Requires crate feature `\"nalgebra-0_15\"`**\r\nimpl<A, R, S1, S2> From<na::Matrix<A, R, na::U1, S1>> for ArrayBase<S2, Ix1>\r\nwhere\r\n    A: na::Scalar,\r\n    R: na::Dim,\r\n    S1: na::storage::Storage<A, R, na::U1>,\r\n    S2: DataOwned<Elem = A>,\r\n{\r\n    fn from(vector: na::Matrix<A, R, na::U1, S1>) -> ArrayBase<S2, Ix1> {\r\n        ArrayBase::from_vec(vector.iter().cloned().collect())\r\n    }\r\n}\r\n\r\n// ...\r\n```\r\n\r\n(See the full changes [here](https://github.com/rust-ndarray/ndarray/compare/d1b4027a4ca1fcd11c2b1a417460de3a6f162154..2961c5f08b813647557b8dd6a8083eb332920c2d).)\r\n\r\nWhen I build with `cargo +nightly doc --open --features=nalgebra-0_15,nalgebra-0_16`, I see both implementations as expected in docs of the `ndarray` crate:\r\n\r\n![docs](https://user-images.githubusercontent.com/1836850/48916472-75720080-ee50-11e8-9123-a1b0164ceac5.png)\r\n\r\nThe problem is that both versions of the docs of `nalgebra` are written to the same location, `target/doc/nalgebra`. So, for example, when I click on `Matrix` (a type defined in the `nalgebra` crate), I get taken to `target/doc/nalgebra/base/struct.Matrix.html` regardless of which version of `nalgebra` it corresponds to.\r\n\r\nTo fix this, I would suggest naming the documentation directories according to the names the crates were renamed to. So, there would be `target/doc/nalgebra-crate-0_15` and `target/doc/nalgebra-crate-0_16` directories instead of just a single `target/doc/nalgebra` directory.\r\n\r\n## Meta\r\n\r\n`rustup run nightly rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.32.0-nightly (f1e2fa8f0 2018-11-20)\r\nbinary: rustc\r\ncommit-hash: f1e2fa8f0469aac1ea69dd5b6164e1d198d57934\r\ncommit-date: 2018-11-20\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.32.0-nightly\r\nLLVM version: 8.0\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/56169/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/56169/timeline", "performed_via_github_app": null, "state_reason": null}