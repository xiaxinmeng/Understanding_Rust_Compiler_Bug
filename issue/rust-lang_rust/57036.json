{"url": "https://api.github.com/repos/rust-lang/rust/issues/57036", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57036/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57036/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57036/events", "html_url": "https://github.com/rust-lang/rust/issues/57036", "id": 393426684, "node_id": "MDU6SXNzdWUzOTM0MjY2ODQ=", "number": 57036, "title": "async/await: Sending Waker seems to invalidate it", "user": {"login": "Janonard", "id": 8581431, "node_id": "MDQ6VXNlcjg1ODE0MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/8581431?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Janonard", "html_url": "https://github.com/Janonard", "followers_url": "https://api.github.com/users/Janonard/followers", "following_url": "https://api.github.com/users/Janonard/following{/other_user}", "gists_url": "https://api.github.com/users/Janonard/gists{/gist_id}", "starred_url": "https://api.github.com/users/Janonard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Janonard/subscriptions", "organizations_url": "https://api.github.com/users/Janonard/orgs", "repos_url": "https://api.github.com/users/Janonard/repos", "events_url": "https://api.github.com/users/Janonard/events{/privacy}", "received_events_url": "https://api.github.com/users/Janonard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-12-21T11:31:29Z", "updated_at": "2018-12-30T19:07:53Z", "closed_at": "2018-12-21T18:28:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello everyone!\r\n\r\nI recently started playing around with the new async/await features and wanted to implement a simple channel using the crossbeam channel and the new futures. The crossbeam channel itself isn't futures-aware, neither 0.1 futures nor the new ones, and therefore, I added another internal channel that sends wakers to the sender and when a new value is sent, the sender will wake all enqueued tasks.\r\n\r\nMy code is found in this repo: [https://github.com/Janonard/rust-noopwake-bug](https://github.com/Janonard/rust-noopwake-bug)\r\n\r\nI expect the program to print `42` and then finish, which is often the case, but not always: Sometimes, I get an error saying `thread 'tokio-runtime-worker-2' panicked at 'NoopWake cannot wake'` (backtrace found [here](https://gist.github.com/Janonard/bd7f865654ff5bd4224e28a2d426f21a)) and sometimes a simple `thread 'tokio-runtime-worker-2' panicked at 'called 'Result::unwrap()' on an 'Err' value: ()'` (backtrace found [here](https://gist.github.com/Janonard/e5b346e9842a289e0bf1cfb79ddc8478)). Also, after panicing, the program hangs.\r\n\r\nIs this a bug within rust, tokio or crossbeam or have I simply made something wrong?\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n    rustc 1.33.0-nightly (09d6ab90e 2018-12-20)\r\n    binary: rustc\r\n    commit-hash: 09d6ab90e556bf692ff3f8790d97b3ca4fee94b0\r\n    commit-date: 2018-12-20\r\n    host: x86_64-unknown-linux-gnu\r\n    release: 1.33.0-nightly\r\n    LLVM version: 8.0", "closed_by": {"login": "cramertj", "id": 5963049, "node_id": "MDQ6VXNlcjU5NjMwNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/5963049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cramertj", "html_url": "https://github.com/cramertj", "followers_url": "https://api.github.com/users/cramertj/followers", "following_url": "https://api.github.com/users/cramertj/following{/other_user}", "gists_url": "https://api.github.com/users/cramertj/gists{/gist_id}", "starred_url": "https://api.github.com/users/cramertj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cramertj/subscriptions", "organizations_url": "https://api.github.com/users/cramertj/orgs", "repos_url": "https://api.github.com/users/cramertj/repos", "events_url": "https://api.github.com/users/cramertj/events{/privacy}", "received_events_url": "https://api.github.com/users/cramertj/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57036/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57036/timeline", "performed_via_github_app": null, "state_reason": "completed"}