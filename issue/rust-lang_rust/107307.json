{"url": "https://api.github.com/repos/rust-lang/rust/issues/107307", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107307/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107307/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107307/events", "html_url": "https://github.com/rust-lang/rust/issues/107307", "id": 1557253826, "node_id": "I_kwDOAAsO6M5c0c7C", "number": 107307, "title": "Implementing \"<test_binary> --list --format json\" for use by IDE test explorers / runners", "user": {"login": "parthopdas", "id": 2140460, "node_id": "MDQ6VXNlcjIxNDA0NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/2140460?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parthopdas", "html_url": "https://github.com/parthopdas", "followers_url": "https://api.github.com/users/parthopdas/followers", "following_url": "https://api.github.com/users/parthopdas/following{/other_user}", "gists_url": "https://api.github.com/users/parthopdas/gists{/gist_id}", "starred_url": "https://api.github.com/users/parthopdas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parthopdas/subscriptions", "organizations_url": "https://api.github.com/users/parthopdas/orgs", "repos_url": "https://api.github.com/users/parthopdas/repos", "events_url": "https://api.github.com/users/parthopdas/events{/privacy}", "received_events_url": "https://api.github.com/users/parthopdas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 630810559, "node_id": "MDU6TGFiZWw2MzA4MTA1NTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-libtest", "name": "A-libtest", "color": "f7e101", "default": false, "description": "Area: #[test] related"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-01-25T20:48:15Z", "updated_at": "2023-03-20T05:56:28Z", "closed_at": "2023-03-20T05:56:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[consider the default output of ```cargo new a --lib```]\r\n\r\n## Issue\r\nTest explorers in editors (e.g. VSCode, see pic below) are unable to navigate to test location in the editor from the test explorer.\r\n\r\n## Cause\r\n```cargo test --list -q``` used by the editors to get list of tests do not have the source and line / column info.\r\n\r\n## Description\r\nCurrently ```cargo test --list -q``` shows the following output\r\n```\r\ntests::it_works: test\r\n```\r\n\r\nThis is used by editor extensions e.g. [vscode rust test adapter](https://marketplace.visualstudio.com/items?itemName=swellaby.vscode-rust-test-adapter) to show & run tests from the tests pane in VS Code. e.g.\r\n![image](https://user-images.githubusercontent.com/2140460/214679698-9e34668c-17b4-42c4-a2e2-9e2dcd269684.png)\r\n\r\nWhile it is possible to run and debug the tests from the test explorer, it is not possible to navigate back to the test location as output above is missing that information. E.g. you cannot double click on a test on the test explorer to navigate to its definition in the editor.\r\n\r\nSuggestion is to add the source info to the output of --list as follows\r\n```\r\ntests::it_works: test,<path>|<start_line>|<start_col>|<end_line>|<end_col>\r\n```\r\n## Fix proposal\r\nProposal for fix (& I only have a plan A, happy to receive further guidance) is to update ```test::TestDescAndFn``` as follows\r\n\r\n```rs\r\n// https://github.com/rust-lang/rust/blob/master/library/test/src/types.rs#L118\r\n#[derive(Clone, Debug, PartialEq, Eq, Hash)]\r\npub struct TestDesc {\r\n    pub name: TestName,\r\n    pub ignore: bool,\r\n    pub ignore_message: Option<&'static str>,\r\n    pub should_panic: options::ShouldPanic,\r\n    pub compile_fail: bool,\r\n    pub no_run: bool,\r\n    pub test_type: TestType,\r\n    pub source_path: &'static str,     // <- Added\r\n    pub start_line: i32,               // <- Added\r\n    pub start_column: i32,             // <- Added\r\n    pub end_line: i32,                 // <- Added\r\n    pub end_column: i32,               // <- Added\r\n}\r\n```\r\nOnce this is available, the corresponding changes can be made to [compiler/rustc_builtin_macros/src/test.rs](https://github.com/rust-lang/rust/blob/master/compiler/rustc_builtin_macros/src/test.rs#L251) to emit the above info and then in [library/test/src/console.rs](https://github.com/rust-lang/rust/blob/master/library/test/src/console.rs#L166) to write it out.\r\n\r\n\r\n\r\n\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107307/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107307/timeline", "performed_via_github_app": null, "state_reason": "completed"}