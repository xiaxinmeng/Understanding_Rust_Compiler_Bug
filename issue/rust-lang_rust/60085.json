{"url": "https://api.github.com/repos/rust-lang/rust/issues/60085", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60085/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60085/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60085/events", "html_url": "https://github.com/rust-lang/rust/issues/60085", "id": 434876272, "node_id": "MDU6SXNzdWU0MzQ4NzYyNzI=", "number": 60085, "title": "Link staticlib by another crate", "user": {"login": "urusai88", "id": 13536462, "node_id": "MDQ6VXNlcjEzNTM2NDYy", "avatar_url": "https://avatars.githubusercontent.com/u/13536462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urusai88", "html_url": "https://github.com/urusai88", "followers_url": "https://api.github.com/users/urusai88/followers", "following_url": "https://api.github.com/users/urusai88/following{/other_user}", "gists_url": "https://api.github.com/users/urusai88/gists{/gist_id}", "starred_url": "https://api.github.com/users/urusai88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urusai88/subscriptions", "organizations_url": "https://api.github.com/users/urusai88/orgs", "repos_url": "https://api.github.com/users/urusai88/repos", "events_url": "https://api.github.com/users/urusai88/events{/privacy}", "received_events_url": "https://api.github.com/users/urusai88/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-04-18T17:25:04Z", "updated_at": "2019-04-18T17:29:50Z", "closed_at": "2019-04-18T17:29:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "Its possible to link a staticlib (.lib) by another crate? I have 2 member project, staticlib and bin, trying to link a staticlib by a bin and causing an errors: \r\n```\r\nnote: \"gcc\" \"-Wl,--enable-long-section-names\" \"-fno-use-linker-plugin\" \"-Wl,--nxcompat\" \"-nostdlib\" \"-m64\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\crt2.o\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\rsbegin.o\" \"-L\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.13dj119411nt6ja8.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.1n8ntix6kmabmrtz.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.1yxc66sxl0tis446.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.36yx45ll5hs82nnb.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.4bauw4vjqd6kuj3z.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.4e7dve62k59yw9i7.rcgu.o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.4qnuoghb5i3zvlrn.rcgu.o\" \"-o\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.exe\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\\\\executable-8e08b4ad4e28befe.1ntj5b19f23i6qjm.rcgu.o\" \"-Wl,--gc-sections\" \"-nodefaultlibs\" \"-L\" \"C:\\\\Users\\\\urusai\\\\Documents\\\\dll\\\\target\\\\debug\\\\deps\" \"-L\" \"C:/users/urusai/Documents/dll/target/debug/\" \"-L\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\" \"-Wl,-Bstatic\" \"-Wl,--whole-archive\" \"-lstatic_library\" \"-Wl,--no-whole-archive\" \"-Wl,--start-group\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libstd-984a211d80288824.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libpanic_unwind-7a911a37989a8f8e.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libbacktrace_sys-f1554655fb4ac76e.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libunwind-136e80c5003dd613.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\librustc_demangle-f12ffaf90e6ed16c.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\liblibc-22a7041948c359d0.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\liballoc-98ef138c69f6538e.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\librustc_std_workspace_core-07d7da1c9a9dd28a.rlib\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libcore-5c1ecb291385a21c.rlib\" \"-Wl,--end-group\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\libcompiler_builtins-94e5237d1db3c6d0.rlib\" \"-Wl,-Bdynamic\" \"-ladvapi32\" \"-lws2_32\" \"-luserenv\" \"-Wl,-Bstatic\" \"-lgcc_eh\" \"-lpthread\" \"-Wl,-Bdynamic\" \"-lmingwex\" \"-lmingw32\" \"-lgcc\" \"-lmsvcrt\" \"-lmsvcrt\" \"-luser32\" \"-lkernel32\" \"C:\\\\Users\\\\urusai\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-gnu\\\\lib\\\\rustlib\\\\x86_64-pc-windows-gnu\\\\lib\\\\rsend.o\"\r\n  = note: C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(static_library-3352ef2c215e74d7.4zc37vnnkhnodm4z.rcgu.o):4zc37vnnkhnodm4z:(.text+0x0): multiple definition of `__rust_alloc'\r\n          C:\\Users\\urusai\\Documents\\dll\\target\\debug\\deps\\executable-8e08b4ad4e28befe.1ntj5b19f23i6qjm.rcgu.o:1ntj5b19f23i6qjm:(.text+0x0): first defined here\r\n          C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(static_library-3352ef2c215e74d7.4zc37vnnkhnodm4z.rcgu.o):4zc37vnnkhnodm4z:(.text+0x10): multiple definition of `__rust_dealloc'\r\n          C:\\Users\\urusai\\Documents\\dll\\target\\debug\\deps\\executable-8e08b4ad4e28befe.1ntj5b19f23i6qjm.rcgu.o:1ntj5b19f23i6qjm:(.text+0x10): first defined here\r\n          C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(static_library-3352ef2c215e74d7.4zc37vnnkhnodm4z.rcgu.o):4zc37vnnkhnodm4z:(.text+0x20): multiple definition of `__rust_realloc'\r\n          C:\\Users\\urusai\\Documents\\dll\\target\\debug\\deps\\executable-8e08b4ad4e28befe.1ntj5b19f23i6qjm.rcgu.o:1ntj5b19f23i6qjm:(.text+0x20): first defined here\r\n          C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(static_library-3352ef2c215e74d7.4zc37vnnkhnodm4z.rcgu.o):4zc37vnnkhnodm4z:(.text+0x30): multiple definition of `__rust_alloc_zeroed'\r\n          C:\\Users\\urusai\\Documents\\dll\\target\\debug\\deps\\executable-8e08b4ad4e28befe.1ntj5b19f23i6qjm.rcgu.o:1ntj5b19f23i6qjm:(.text+0x30): first defined here\r\n          C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(clzsi2.o):clzsi2.c:(.text$__clzsi2+0x0): multiple definition of `__clzsi2'\r\n          C:/users/urusai/Documents/dll/target/debug/\\static_library.lib(compiler_builtins-94e5237d1db3c6d0.compiler_builtins.97zb78nm-cgu.0.rcgu.o):C:\\Users\\appveyor\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\compiler_builtins-0.1.5\\src\\int/mod.rs:332: first defined here\r\n          C:\\Users\\urusai\\Documents\\dll\\target\\debug\\deps\\executable-8e08b4ad4e28befe.13dj119411nt6ja8.rcgu.o: In function `executable::main::hb3ae0e5b6ad44402':\r\n          C:\\Users\\urusai\\Documents\\dll/executable\\src/main.rs:9: undefined reference to `sum'\r\n```\r\n\r\nstatic_library:\r\n```toml\r\n[lib]\r\nname = \"static_library\"\r\npath = \"src/lib.rs\"\r\ncrate-type = [\"staticlib\"]\r\n```\r\nexecutable build.rs: \r\n```rust\r\nfn main() {\r\n    println!(\"cargo:rustc-link-search=target/debug/\");\r\n}\r\n```\r\nexecutable main.rs:\r\n```rust\r\n#[link(name = \"static_library\", kind = \"static\")]\r\nextern \"C\" {\r\n    fn sum(a: i32, b: i32) -> i32;\r\n}\r\n\r\nfn main() {\r\n    let res = unsafe { sum(1, 2) };\r\n\r\n    println!(\"Sum is {}\", res)\r\n}\r\n```\r\nstatic_library lib.rs:\r\n```rust\r\nextern \"C\" fn sum(a: i32, b: i32) -> i32 {\r\n    a + b\r\n}\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60085/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60085/timeline", "performed_via_github_app": null, "state_reason": "completed"}