{"url": "https://api.github.com/repos/rust-lang/rust/issues/97296", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97296/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97296/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97296/events", "html_url": "https://github.com/rust-lang/rust/issues/97296", "id": 1244388979, "node_id": "I_kwDOAAsO6M5KK95z", "number": 97296, "title": "Diagnostic regression when rustc cannot specialize (using `min_specialization`)", "user": {"login": "robinmoussu", "id": 6200547, "node_id": "MDQ6VXNlcjYyMDA1NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/6200547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robinmoussu", "html_url": "https://github.com/robinmoussu", "followers_url": "https://api.github.com/users/robinmoussu/followers", "following_url": "https://api.github.com/users/robinmoussu/following{/other_user}", "gists_url": "https://api.github.com/users/robinmoussu/gists{/gist_id}", "starred_url": "https://api.github.com/users/robinmoussu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robinmoussu/subscriptions", "organizations_url": "https://api.github.com/users/robinmoussu/orgs", "repos_url": "https://api.github.com/users/robinmoussu/repos", "events_url": "https://api.github.com/users/robinmoussu/events{/privacy}", "received_events_url": "https://api.github.com/users/robinmoussu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-05-22T22:49:58Z", "updated_at": "2022-05-22T22:49:58Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Note: I\u2019m not sure if anything need to be done since specialization should allow the following code when it will fully be implemented, but currently the quality of the diagnostic is decreased when `min_specialization` is used:\r\n\r\n---\r\n\r\n<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nGiven the following code: [playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=476f816d693378654111678d1a30a757)\r\n\r\n```rust\r\ntrait Trait {\r\n    fn foo() {}\r\n    fn bar() {}\r\n}\r\nstruct Struct<F> {\r\n    f: F,\r\n}\r\n\r\nimpl<F> Trait for Struct<F>\r\nwhere F: FnMut() -> ()\r\n{\r\n    fn foo() {}\r\n}\r\n\r\nimpl<F> Trait for Struct<F>\r\nwhere F: FnOnce() -> ()\r\n{\r\n    fn bar() {}\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n- With `#![feature(min_specialization)]`\r\n\r\n```\r\nerror: cannot specialize on trait `FnMut`\r\n  --> src/lib.rs:11:1\r\n   |\r\n11 | / impl<F> Trait for Struct<F>\r\n12 | | where F: FnMut() -> ()\r\n13 | | {\r\n14 | |     fn foo() {}\r\n15 | | }\r\n   | |_^\r\n```\r\n\r\n- Without (the diagnostic is much better):\r\n\r\n```\r\nerror[[E0119]](https://doc.rust-lang.org/nightly/error-index.html#E0119): conflicting implementations of trait `Trait` for type `Struct<_>`\r\n  --> src/lib.rs:17:1\r\n   |\r\n11 | / impl<F> Trait for Struct<F>\r\n12 | | where F: FnMut() -> ()\r\n13 | | {\r\n14 | |     fn foo() {}\r\n15 | | }\r\n   | |_- first implementation here\r\n16 | \r\n17 | / impl<F> Trait for Struct<F>\r\n18 | | where F: FnOnce() -> ()\r\n19 | | {\r\n20 | |     fn bar() {}\r\n21 | | }\r\n   | |_^ conflicting implementation for `Struct<_>`\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97296/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97296/timeline", "performed_via_github_app": null, "state_reason": null}