{"url": "https://api.github.com/repos/rust-lang/rust/issues/68591", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68591/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68591/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68591/events", "html_url": "https://github.com/rust-lang/rust/issues/68591", "id": 555973639, "node_id": "MDU6SXNzdWU1NTU5NzM2Mzk=", "number": 68591, "title": "current nightly gets OOM'd upon building Diesel example application", "user": {"login": "ejmg", "id": 18218174, "node_id": "MDQ6VXNlcjE4MjE4MTc0", "avatar_url": "https://avatars.githubusercontent.com/u/18218174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ejmg", "html_url": "https://github.com/ejmg", "followers_url": "https://api.github.com/users/ejmg/followers", "following_url": "https://api.github.com/users/ejmg/following{/other_user}", "gists_url": "https://api.github.com/users/ejmg/gists{/gist_id}", "starred_url": "https://api.github.com/users/ejmg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ejmg/subscriptions", "organizations_url": "https://api.github.com/users/ejmg/orgs", "repos_url": "https://api.github.com/users/ejmg/repos", "events_url": "https://api.github.com/users/ejmg/events{/privacy}", "received_events_url": "https://api.github.com/users/ejmg/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-28T04:22:13Z", "updated_at": "2020-01-28T16:18:38Z", "closed_at": "2020-01-28T10:40:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there!\r\n\r\nI've discovered what I believe to be a a bug in the currently build for nightly that results in the build process getting OOM'd on my machine. In under ~20 seconds, I can observe Rust take all available RAM (15gb of 16) before it begins to fill up swap as well (8gb). By the 40 second mark, my desktop is largely frozen and the process gets kill around 60 seconds in or so. \r\n\r\nI haven't timed these builds but can if specific numbers are needed.\r\n\r\nThe specific project being built is the first version of the Diesel demo app found on it's [landing page](https://diesel.rs/guides/getting-started/). Upon switching the contents of my rust-toolchain file to `stable`, the project builds and executes as expected. Here's a link to [my code](https://github.com/ejmg/diesel-demo-OOM). The only thing you'll need to change is the toolchain file to nightly. Like I said, this will OOM on Linux so **be warned**.\r\n\r\nSystem stats:\r\n\r\n- my current version of rustc: `rustc 1.42.0-nightly (8a79d08fa 2020-01-27)`\r\n- my version of linux: `x86_64 Linux 5.4.13-arch1-1`\r\n- OS: Arch Linux\r\n\r\nAs an aside, the demo app uses Diesel `1.0.0`, but I also went ahead and tested it against the most recent released version of `1.4.3` to the same results on nightly.\r\n\r\nUpdate: Here's the output of dmesg for one of the failed attempts to build on nightly:\r\n\r\n```\r\n[240198.230402] oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/user.slice/user-1000.slice/session-1.scope,task=cargo,pid=188300,uid=1000\r\n[240198.230413] Out of memory: Killed process 188300 (cargo) total-vm:34595572kB, anon-rss:14876996kB, file-rss:0kB, shmem-rss:0kB, UID:1000 pgtables:36180kB oom_score_adj:0\r\n[240198.980499] oom_reaper: reaped process 188300 (cargo), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB\r\n```\r\n\r\nSo maybe this is more an issue with Cargo?", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68591/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68591/timeline", "performed_via_github_app": null, "state_reason": "completed"}