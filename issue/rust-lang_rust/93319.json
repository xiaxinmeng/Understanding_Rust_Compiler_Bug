{"url": "https://api.github.com/repos/rust-lang/rust/issues/93319", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93319/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93319/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93319/events", "html_url": "https://github.com/rust-lang/rust/issues/93319", "id": 1114775222, "node_id": "I_kwDOAAsO6M5Cch62", "number": 93319, "title": "Nested functions with `#[no_coverage]` lead to non-obvious results.", "user": {"login": "Swatinem", "id": 580492, "node_id": "MDQ6VXNlcjU4MDQ5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/580492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Swatinem", "html_url": "https://github.com/Swatinem", "followers_url": "https://api.github.com/users/Swatinem/followers", "following_url": "https://api.github.com/users/Swatinem/following{/other_user}", "gists_url": "https://api.github.com/users/Swatinem/gists{/gist_id}", "starred_url": "https://api.github.com/users/Swatinem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Swatinem/subscriptions", "organizations_url": "https://api.github.com/users/Swatinem/orgs", "repos_url": "https://api.github.com/users/Swatinem/repos", "events_url": "https://api.github.com/users/Swatinem/events{/privacy}", "received_events_url": "https://api.github.com/users/Swatinem/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-01-26T08:57:17Z", "updated_at": "2022-01-26T08:57:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The fact that coverage is based on source ranges of function bodies means that an inner functions ranges are being \"shadowed\" by the outer function. When rendered, the source ranges appear to be covered (by the outer function) even though they are not.\r\n\r\nAn example from https://github.com/rust-lang/rust/pull/92695:\r\n\r\n```rust\r\n    pub fn outer(is_true: bool) {\r\n        println!(\"called and covered\");\r\n        inner_not_covered(is_true);\r\n\r\n        #[no_coverage]\r\n        fn inner_not_covered(is_true: bool) {\r\n            if is_true {\r\n                println!(\"called but not covered\");\r\n            } else {\r\n                println!(\"absolutely not covered\");\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\nPretty printing the coverage report looks like this:\r\n\r\n```\r\n   45|      1|    pub fn outer(is_true: bool) {\r\n   46|      1|        println!(\"called and covered\");\r\n   47|      1|        inner_not_covered(is_true);\r\n   48|      1|\r\n   49|      1|        #[no_coverage]\r\n   50|      1|        fn inner_not_covered(is_true: bool) {\r\n   51|      1|            if is_true {\r\n   52|      1|                println!(\"called but not covered\");\r\n   53|      1|            } else {\r\n   54|      1|                println!(\"absolutely not covered\");\r\n   55|      1|            }\r\n   56|      1|        }\r\n   57|      1|    }\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93319/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93319/timeline", "performed_via_github_app": null, "state_reason": null}