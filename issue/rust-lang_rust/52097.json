{"url": "https://api.github.com/repos/rust-lang/rust/issues/52097", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52097/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52097/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52097/events", "html_url": "https://github.com/rust-lang/rust/issues/52097", "id": 338801149, "node_id": "MDU6SXNzdWUzMzg4MDExNDk=", "number": 52097, "title": "Error messages don't \"simplify\" types with default generic params in some cases", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-07-06T04:27:34Z", "updated_at": "2018-07-14T08:26:06Z", "closed_at": "2018-07-14T08:26:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In #50882, adding an `Alloc` parameter to the `Box` type, that defaults to `Global` induces changes to UI tests that are indicative of something that seemed to need improvement in the compiler, namely that when you have a type `Foo<A, B = Bar>`, errors should present `Foo<A>` instead of `Foo<A, Bar>` when they can.\r\n\r\nIt turns out, the compiler does. But not consistently. The following is derived from `src/test/compile-fail/terr-sorts.rs`:\r\n\r\n```rust\r\n#![crate_type = \"lib\"]\r\ntrait Alloc {}\r\nstruct Global;\r\nimpl Alloc for Global {}\r\n\r\nstruct Foo<T, A: Alloc = Global>(T, A);\r\n\r\nstruct foo {\r\n    a: isize,\r\n    b: isize,\r\n}\r\n\r\ntype bar = Foo<foo>;\r\ntype baz = Foo<usize>;\r\n\r\nfn want_foo(f: foo) {}\r\nfn have_bar(b: bar) {\r\n    want_foo(b);\r\n}\r\nfn want_usize(f: usize) {}\r\nfn have_baz(b: baz) {\r\n    want_usize(b);\r\n}\r\n```\r\n\r\n([Playground version](https://play.rust-lang.org/?gist=241a64ca715c7264576b89348faa8558&version=nightly&mode=debug&edition=2015))\r\n\r\nThis yields the following errors:\r\n```\r\nerror[E0308]: mismatched types\r\n  --> src/lib.rs:18:14\r\n   |\r\n18 |     want_foo(b);\r\n   |              ^ expected struct `foo`, found struct `Foo`\r\n   |\r\n   = note: expected type `foo`\r\n              found type `Foo<foo, Global>`\r\n\r\nerror[E0308]: mismatched types\r\n  --> src/lib.rs:22:16\r\n   |\r\n22 |     want_usize(b);\r\n   |                ^ expected usize, found struct `Foo`\r\n   |\r\n   = note: expected type `usize`\r\n              found type `Foo<usize>`\r\n```\r\n\r\nSee how it prints `Foo<foo, Global>` instead of the (imho) desired `Foo<foo>`, but `Foo<usize>`, not `Foo<usize, Global>`.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52097/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52097/timeline", "performed_via_github_app": null, "state_reason": "completed"}