{"url": "https://api.github.com/repos/rust-lang/rust/issues/93211", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93211/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93211/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93211/events", "html_url": "https://github.com/rust-lang/rust/issues/93211", "id": 1111653638, "node_id": "I_kwDOAAsO6M5CQn0G", "number": 93211, "title": "readLink() testcase failed with localized non-english language?", "user": {"login": "m1guelperez", "id": 35203373, "node_id": "MDQ6VXNlcjM1MjAzMzcz", "avatar_url": "https://avatars.githubusercontent.com/u/35203373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m1guelperez", "html_url": "https://github.com/m1guelperez", "followers_url": "https://api.github.com/users/m1guelperez/followers", "following_url": "https://api.github.com/users/m1guelperez/following{/other_user}", "gists_url": "https://api.github.com/users/m1guelperez/gists{/gist_id}", "starred_url": "https://api.github.com/users/m1guelperez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m1guelperez/subscriptions", "organizations_url": "https://api.github.com/users/m1guelperez/orgs", "repos_url": "https://api.github.com/users/m1guelperez/repos", "events_url": "https://api.github.com/users/m1guelperez/events{/privacy}", "received_events_url": "https://api.github.com/users/m1guelperez/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "m1guelperez", "id": 35203373, "node_id": "MDQ6VXNlcjM1MjAzMzcz", "avatar_url": "https://avatars.githubusercontent.com/u/35203373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m1guelperez", "html_url": "https://github.com/m1guelperez", "followers_url": "https://api.github.com/users/m1guelperez/followers", "following_url": "https://api.github.com/users/m1guelperez/following{/other_user}", "gists_url": "https://api.github.com/users/m1guelperez/gists{/gist_id}", "starred_url": "https://api.github.com/users/m1guelperez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m1guelperez/subscriptions", "organizations_url": "https://api.github.com/users/m1guelperez/orgs", "repos_url": "https://api.github.com/users/m1guelperez/repos", "events_url": "https://api.github.com/users/m1guelperez/events{/privacy}", "received_events_url": "https://api.github.com/users/m1guelperez/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "m1guelperez", "id": 35203373, "node_id": "MDQ6VXNlcjM1MjAzMzcz", "avatar_url": "https://avatars.githubusercontent.com/u/35203373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m1guelperez", "html_url": "https://github.com/m1guelperez", "followers_url": "https://api.github.com/users/m1guelperez/followers", "following_url": "https://api.github.com/users/m1guelperez/following{/other_user}", "gists_url": "https://api.github.com/users/m1guelperez/gists{/gist_id}", "starred_url": "https://api.github.com/users/m1guelperez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m1guelperez/subscriptions", "organizations_url": "https://api.github.com/users/m1guelperez/orgs", "repos_url": "https://api.github.com/users/m1guelperez/repos", "events_url": "https://api.github.com/users/m1guelperez/events{/privacy}", "received_events_url": "https://api.github.com/users/m1guelperez/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2022-01-22T18:40:12Z", "updated_at": "2022-06-20T12:04:01Z", "closed_at": "2022-06-20T12:04:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nHey!\r\nI am not sure if this is directly a bug on the compiler test case or if it is my machine's fault.\r\nMy OS is Windows 11 Pro with version: 10.0.22000 Build 22000.\r\nI built the compiler for the first time, set everything up (toolchains, etc.), and never got an error so far.\r\n\r\n```./x.py check``` succeeded instantly as well.\r\nBut as soon as I tried to run the following test, \r\n```./x.py test --stage 0 library/std```\r\n without any changes made to the compiler, 1 test case failed.\r\n\r\nThe test case fn readLink() in: `library\\std\\src\\fs\\tests.rs:839:20` is the problem, or to be more precise, the last assert_eq!in the \n```if cfg!(windows){/.../}```\r\n\nThis won't pass:\r\n```rust\r\n#[test]\r\nfn read_link() {\r\n    if cfg!(windows) {\r\n        // directory symlink\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Users\\All Users\")), Path::new(r\"C:\\ProgramData\"));\r\n        // junction\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Users\\Default User\")), Path::new(r\"C:\\Users\\Default\"));\r\n        // junction with special permissions\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Documents and settings\\\")), Path::new(r\"C:\\Users\"));\r\n    }\r\n    let tmpdir = tmpdir();\r\n    let link = tmpdir.join(\"link\");\r\n    if !got_symlink_permission(&tmpdir) {\r\n        return;\r\n    };\r\n    check!(symlink_file(&\"foo\", &link));\r\n    assert_eq!(check!(fs::read_link(&link)).to_str().unwrap(), \"foo\");\r\n}\r\n```\r\n\r\nThis will pass:\r\n```rust\r\nfn read_link() {\r\n    if cfg!(windows) {\r\n        // directory symlink\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Users\\All Users\")), Path::new(r\"C:\\ProgramData\"));\r\n        // junction\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Users\\Default User\")), Path::new(r\"C:\\Users\\Default\"));\r\n        // junction with special permissions\r\n        assert_eq!(check!(fs::read_link(r\"C:\\Dokumente und Einstellungen\\\")), Path::new(r\"C:\\Users\"));\r\n    }\r\n    let tmpdir = tmpdir();\r\n    let link = tmpdir.join(\"link\");\r\n    if !got_symlink_permission(&tmpdir) {\r\n        return;\r\n    };\r\n    check!(symlink_file(&\"foo\", &link));\r\n    assert_eq!(check!(fs::read_link(&link)).to_str().unwrap(), \"foo\");\r\n}\r\n```\r\n\r\nI expected to see the test pass, but it seems, that if the junction is not called in English, the test will fail.\r\n\r\nInstead, I got the following error (long error below):\r\n```thread 'fs::tests::read_link' panicked at 'fs::read_link(r\"C:\\Documents and settings\\\") failed with: The system cannot find the file specified. (os error 2)', library\\std\\src\\fs\\tests.rs:839:20```\r\n\r\nFinally, I am not sure if this is an \"error\" in the test case or if my windows is broken, because I set the origin language (german) to English.\r\n\r\nI included my cmd output which shows the junction is in german. \r\n**Dokumente und Einstellungen** means **Documents and Settings in German**\r\n\r\n![Junction](https://user-images.githubusercontent.com/35203373/150651231-cc616595-4d1a-45e1-9b0b-d9b6a1327df1.jpg)\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.60.0-nightly (777bb86bc 2022-01-20)\r\nbinary: rustc\r\ncommit-hash: 777bb86bcdbc568be7cff6eeeaaf81a89b4aa50b\r\ncommit-date: 2022-01-20\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.60.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nfailures:\r\n\r\n---- fs::tests::read_link stdout ----\r\nthread 'fs::tests::read_link' panicked at 'fs::read_link(r\"C:\\Documents and settings\\\") failed with: The system cannot find the file specified. (os error 2)', library\\std\\src\\fs\\tests.rs:839:20\r\n\r\n\r\nfailures:\r\n    fs::tests::read_link\r\n\r\ntest result: FAILED. 896 passed; 1 failed; 3 ignored; 0 measured; 0 filtered out; finished in 10.90s\r\n\r\nerror: test failed, to rerun pass '-p std --lib'\r\n\r\n\r\ncommand did not execute successfully: \"\\\\\\\\?\\\\C:\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0\\\\bin\\\\cargo.exe\" \"test\" \"--target\" \"x86_64-pc-windows-msvc\" \"-Zbinary-dep-depinfo\" \"-j\" \"20\" \"--release\" \"--features\" \"panic-unwind backtrace compiler-builtins-c\" \"--manifest-path\" \"C:\\\\rust\\\\library/test/Cargo.toml\" \"-p\" \"std\" \"--\" \"--quiet\"\r\nexpected success, got: exit code: 101\r\n```\r\n\r\n</p>\r\n</details>\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"m1guelperez\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "m1guelperez", "id": 35203373, "node_id": "MDQ6VXNlcjM1MjAzMzcz", "avatar_url": "https://avatars.githubusercontent.com/u/35203373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m1guelperez", "html_url": "https://github.com/m1guelperez", "followers_url": "https://api.github.com/users/m1guelperez/followers", "following_url": "https://api.github.com/users/m1guelperez/following{/other_user}", "gists_url": "https://api.github.com/users/m1guelperez/gists{/gist_id}", "starred_url": "https://api.github.com/users/m1guelperez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m1guelperez/subscriptions", "organizations_url": "https://api.github.com/users/m1guelperez/orgs", "repos_url": "https://api.github.com/users/m1guelperez/repos", "events_url": "https://api.github.com/users/m1guelperez/events{/privacy}", "received_events_url": "https://api.github.com/users/m1guelperez/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93211/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93211/timeline", "performed_via_github_app": null, "state_reason": "completed"}