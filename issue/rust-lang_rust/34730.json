{"url": "https://api.github.com/repos/rust-lang/rust/issues/34730", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34730/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34730/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34730/events", "html_url": "https://github.com/rust-lang/rust/issues/34730", "id": 164641188, "node_id": "MDU6SXNzdWUxNjQ2NDExODg=", "number": 34730, "title": "Gen Image Pixels Data is Very Slow", "user": {"login": "LuoZijun", "id": 717717, "node_id": "MDQ6VXNlcjcxNzcxNw==", "avatar_url": "https://avatars.githubusercontent.com/u/717717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LuoZijun", "html_url": "https://github.com/LuoZijun", "followers_url": "https://api.github.com/users/LuoZijun/followers", "following_url": "https://api.github.com/users/LuoZijun/following{/other_user}", "gists_url": "https://api.github.com/users/LuoZijun/gists{/gist_id}", "starred_url": "https://api.github.com/users/LuoZijun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LuoZijun/subscriptions", "organizations_url": "https://api.github.com/users/LuoZijun/orgs", "repos_url": "https://api.github.com/users/LuoZijun/repos", "events_url": "https://api.github.com/users/LuoZijun/events{/privacy}", "received_events_url": "https://api.github.com/users/LuoZijun/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-07-09T00:53:31Z", "updated_at": "2016-07-09T01:36:46Z", "closed_at": "2016-07-09T01:04:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, the rust gen one rgb pixels data is very slow.\n\n![image](https://cloud.githubusercontent.com/assets/717717/16705072/5ee6cf92-45b2-11e6-8dc8-2e33d17d41bb.png)\n\nHere is rust code:\n\n``` rust\nuse std::time::{Duration, SystemTime};\n\nfn gen_rgb() -> Vec<u8> {\n    let width  = 1440usize;\n    let height = 900usize;\n    let mut pixels: Vec<u8> = Vec::new();\n    // let pixel_width: usize  = 4usize;   // RGB32 (RGBA)\n\n    for h in 0usize..height {\n        for w in 0usize..width {\n            // let idx = h*w*4 + w*4;\n            pixels.push(100u8);\n            pixels.push(150u8);\n            pixels.push(200u8);\n            pixels.push(250u8);\n        }\n    }\n    pixels\n}\n\nfn main (){\n    let now = SystemTime::now();\n    for _ in 0..100{\n        let pixels = gen_rgb();\n    }\n    match now.elapsed() {\n       Ok(elapsed) => println!(\"Elapsed: {}s {}ms\", elapsed.as_secs(), elapsed.subsec_nanos()/1000/1000 ),\n       Err(e)      => println!(\"Error: {:?}\", e)\n    };\n}\n```\n\nthis is C code:\n\n``` c\n\n#include <stdio.h>\n#include <stdint.h>\n#include <time.h>\n\nint gen_rgb(uint8_t pixels[], int width, int height){\n    int     h,w,idx;\n    for (h=0; h<height; h++){\n        for (w=0; w<width; w++){\n            idx = h*w*4 + w*4;\n            pixels[idx]   = 100; // R\n            pixels[idx+1] = 150; // G\n            pixels[idx+2] = 200; // B\n            pixels[idx+3] = 50; // A\n        }\n    }\n    return 1;\n}\n\nint main(int argc, char const *argv[]){\n    time_t  btime, etime;\n\n    int     height=900, width=1440, pixel_width=4;\n    uint8_t pixels[height*width*pixel_width];\n    int     i,ret=0;\n\n    btime = time(NULL);\n\n    for (i=0; i<100; i++){\n        ret = gen_rgb(pixels, width, height);\n    }\n\n    etime = time(NULL);\n    printf(\"time: %.0f s\\n\", difftime(etime, btime)) ;\n    return 0;\n}\n```\n\nthis code will take so many time, about `502827000 ns/ 1 picture` in my MacBookAir.\n", "closed_by": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34730/timeline", "performed_via_github_app": null, "state_reason": "completed"}