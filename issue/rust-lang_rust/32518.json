{"url": "https://api.github.com/repos/rust-lang/rust/issues/32518", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/32518/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/32518/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/32518/events", "html_url": "https://github.com/rust-lang/rust/issues/32518", "id": 143759902, "node_id": "MDU6SXNzdWUxNDM3NTk5MDI=", "number": 32518, "title": "multiple definition link error when using multiple codegen units", "user": {"login": "MagaTailor", "id": 12054457, "node_id": "MDQ6VXNlcjEyMDU0NDU3", "avatar_url": "https://avatars.githubusercontent.com/u/12054457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MagaTailor", "html_url": "https://github.com/MagaTailor", "followers_url": "https://api.github.com/users/MagaTailor/followers", "following_url": "https://api.github.com/users/MagaTailor/following{/other_user}", "gists_url": "https://api.github.com/users/MagaTailor/gists{/gist_id}", "starred_url": "https://api.github.com/users/MagaTailor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MagaTailor/subscriptions", "organizations_url": "https://api.github.com/users/MagaTailor/orgs", "repos_url": "https://api.github.com/users/MagaTailor/repos", "events_url": "https://api.github.com/users/MagaTailor/events{/privacy}", "received_events_url": "https://api.github.com/users/MagaTailor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2016-03-26T23:43:11Z", "updated_at": "2016-03-29T21:27:50Z", "closed_at": "2016-03-29T21:27:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "I wanted to use @dotdash's LLVM assertions patch but now my stage1 libstd fails to link. Probably unrelated but here it is:\n\n``` go\nrustc: arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/libstd\nerror: linking with `cc` failed: exit code: 1\nnote: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-L\" \"/rust-master/arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.1.o\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.2.o\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.3.o\" \"-o\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/libstd-9026086f.so\" \"arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.metadata.o\" \"-Wl,-O1\" \"-nodefaultlibs\" \"-L\" \"arm-unknown-linux-gnueabihf/rt\" \"-L\" \"/rust-master/arm-unknown-linux-gnueabihf/llvm/Release+Asserts/lib\" \"-L\" \"/rust-master/arm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib\" \"-Wl,-Bstatic\" \"-Wl,--whole-archive\" \"-l\" \"backtrace\" \"-Wl,--no-whole-archive\" \"-Wl,-Bdynamic\" \"-l\" \"dl\" \"-l\" \"pthread\" \"-l\" \"gcc_s\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/liballoc-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/librustc_unicode-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/liballoc_system-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/liblibc-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/librand-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.FHfUQVlQsuoG/libcore-9026086f.rlib\" \"-Wl,--no-whole-archive\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-shared\" \"-Wl,-rpath,/home/odroid/rust-nightly-sysalloc-assert/lib/rustlib/arm-unknown-linux-gnueabihf/lib\" \"-Wl,--enable-new-dtags\" \"-s\" \"-l\" \"compiler-rt\"\n```\n\n``` shell\nnote: /tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `_$LT$core..option..Option$LT$T$GT$$GT$::map::h58518f67af9bf04e':\ncollections.0.rs:(.text._ZN38_$LT$core..option..Option$LT$T$GT$$GT$3map17h58518f67af9bf04eE+0x0): multiple definition of `_$LT$core..option..Option$LT$T$GT$$GT$::map::h58518f67af9bf04e'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN38_$LT$core..option..Option$LT$T$GT$$GT$3map17h58518f67af9bf04eE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::new::h0c1cdac7fb2b416c':\ncollections.0.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$3new17h0c1cdac7fb2b416cE+0x0): multiple definition of `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::new::h0c1cdac7fb2b416c'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.3.o:std.3.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$3new17h0c1cdac7fb2b416cE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::ptr::h4e14ee1392d1411e':\ncollections.0.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$3ptr17h4e14ee1392d1411eE+0x0): multiple definition of `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::ptr::h4e14ee1392d1411e'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$3ptr17h4e14ee1392d1411eE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::double::heaf5b97a8495eb9e':\ncollections.0.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$6double17heaf5b97a8495eb9eE+0x0): multiple definition of `_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$::double::heaf5b97a8495eb9e'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.3.o:std.3.rs:(.text._ZN40_$LT$alloc..raw_vec..RawVec$LT$T$GT$$GT$6double17heaf5b97a8495eb9eE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::uninitialized::he8ba150ad18eedcf':\ncollections.0.rs:(.text._ZN4core3mem13uninitialized17he8ba150ad18eedcfE+0x0): multiple definition of `core::mem::uninitialized::he8ba150ad18eedcf'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3mem13uninitialized17he8ba150ad18eedcfE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::uninitialized::hfa1a47f766d26f10':\ncollections.0.rs:(.text._ZN4core3mem13uninitialized17hfa1a47f766d26f10E+0x0): multiple definition of `core::mem::uninitialized::hfa1a47f766d26f10'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.3.o:std.3.rs:(.text._ZN4core3mem13uninitialized17hfa1a47f766d26f10E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::transmute_copy::h5f22bd4094d00101':\ncollections.0.rs:(.text._ZN4core3mem14transmute_copy17h5f22bd4094d00101E+0x0): multiple definition of `core::mem::transmute_copy::h5f22bd4094d00101'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3mem14transmute_copy17h5f22bd4094d00101E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::transmute_copy::h75f84324b8ee3166':\ncollections.0.rs:(.text._ZN4core3mem14transmute_copy17h75f84324b8ee3166E+0x0): multiple definition of `core::mem::transmute_copy::h75f84324b8ee3166'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.3.o:std.3.rs:(.text._ZN4core3mem14transmute_copy17h75f84324b8ee3166E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::forget::h502109c553961f51':\ncollections.0.rs:(.text._ZN4core3mem6forget17h502109c553961f51E+0x0): multiple definition of `core::mem::forget::h502109c553961f51'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3mem6forget17h502109c553961f51E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::size_of::hfb509be3c362d215':\ncollections.0.rs:(.text._ZN4core3mem7size_of17hfb509be3c362d215E+0x0): multiple definition of `core::mem::size_of::hfb509be3c362d215'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3mem7size_of17hfb509be3c362d215E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::mem::align_of::h2a452ce69533a17c':\ncollections.0.rs:(.text._ZN4core3mem8align_of17h2a452ce69533a17cE+0x0): multiple definition of `core::mem::align_of::h2a452ce69533a17c'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3mem8align_of17h2a452ce69533a17cE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::ptr::_$LT$impl$u20$$BP$mut$u20$T$GT$::is_null::h3fe8e4e4a8815d84':\ncollections.0.rs:(.text._ZN4core3ptr31_$LT$impl$u20$$BP$mut$u20$T$GT$7is_null17h3fe8e4e4a8815d84E+0x0): multiple definition of `core::ptr::_$LT$impl$u20$$BP$mut$u20$T$GT$::is_null::h3fe8e4e4a8815d84'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3ptr31_$LT$impl$u20$$BP$mut$u20$T$GT$7is_null17h3fe8e4e4a8815d84E+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::ptr::_$LT$impl$u20$$BP$const$u20$T$GT$::offset::he051aa5e5b8f8bfb':\ncollections.0.rs:(.text._ZN4core3ptr33_$LT$impl$u20$$BP$const$u20$T$GT$6offset17he051aa5e5b8f8bfbE+0x0): multiple definition of `core::ptr::_$LT$impl$u20$$BP$const$u20$T$GT$::offset::he051aa5e5b8f8bfb'\narm-unknown-linux-gnueabihf/stage1/lib/rustlib/arm-unknown-linux-gnueabihf/lib/std-9026086f.0.o:std.0.rs:(.text._ZN4core3ptr33_$LT$impl$u20$$BP$const$u20$T$GT$6offset17he051aa5e5b8f8bfbE+0x0): first defined here\n/tmp/rustc.FHfUQVlQsuoG/libcollections-9026086f.rlib(collections-9026086f.0.o): In function `core::ptr::_$LT$impl$u20$$BP$const$u20$T$GT$::is_null::h630d425861f40502':\ncollections.0.rs:(.text._ZN4core3ptr33_$LT$impl$u20$$BP$const$u20$T$GT$7is_null17h630d425861f40502E+0x0): multiple definition of `core::ptr::_$LT$impl$u20$$BP$const$u20$T$GT$::is_null::h630d425861f40502'\n```\n\nand so on. Configured with `--enable-optimize --disable-jemalloc --enable-llvm-assertions` and `RUSTFLAGS='-C codegen-units=4 -C link-args=-s'`\n\nAre all these errors about memory management  functions? (`--disable-jemalloc` broken again?)\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/32518/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/32518/timeline", "performed_via_github_app": null, "state_reason": "completed"}