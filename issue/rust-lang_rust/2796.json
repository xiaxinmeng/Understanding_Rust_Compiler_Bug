{"url": "https://api.github.com/repos/rust-lang/rust/issues/2796", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2796/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2796/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2796/events", "html_url": "https://github.com/rust-lang/rust/issues/2796", "id": 5419261, "node_id": "MDU6SXNzdWU1NDE5MjYx", "number": 2796, "title": "Implicit borrows and typeclasses interact inconsistently", "user": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2012-07-03T23:39:51Z", "updated_at": "2014-06-16T21:56:33Z", "closed_at": "2012-07-06T22:55:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The interaction between implicit borrows and typeclasses is currently problematic and inconsistent.\n\nSuppose we have the following interface, an implementation of it for vector slices, and a function that is parameterized over the typeclass:\n\n```\niface iterable<A> {\n    fn iterate(blk: fn(A) -> bool);\n}\n\nimpl vec/&<A> of iterable<A> for &[const A] {\n    fn iterate(f: fn(A) -> bool) {\n        vec::each(self, f);\n    }\n}\n\nfn print<A, T: iterable<A>>(x: T) {\n    for x.iterate() |x| { log(error, x); }\n}\n```\n\nThe following code works since `x` will be implicitly borrowed\n\n```\nfn main() {\n    let x = ~[1,2,3];\n    for x.iterate() |x| { log(error, x) }\n}\n```\n\nThis is because `add_candidates_from_scope` in method.rs uses `can_mk_assignty` when matching against impls, which will do a borrow to convert `x` to a slice.\n\nHowever, the following code does not work:\n\n```\nfn main() {\n    let x = ~[1,2,3];\n    print(x);\n}\n```\n\nIt will fail to find an implementation of `iterable` for `[int]/~`. This is because `lookup_vtable` in vtable.rs uses `mk_subty` when matching against impls. I think that `lookup_vtable` basically has to use subtyping and not type assignability: typeclass constraints need not correspond to just the type of an argument expression that we can perform a borrow on.\n\nTo make matters worse, we can't work around this by just writing `impl`s for `~[A]`, since then the first example would fail with an error about multiple methods in scope.\n\nI think probably the right thing to do is to not do implicit borrows on method calls, but I'm not sure.\n", "closed_by": {"login": "msullivan", "id": 340349, "node_id": "MDQ6VXNlcjM0MDM0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/340349?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msullivan", "html_url": "https://github.com/msullivan", "followers_url": "https://api.github.com/users/msullivan/followers", "following_url": "https://api.github.com/users/msullivan/following{/other_user}", "gists_url": "https://api.github.com/users/msullivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/msullivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msullivan/subscriptions", "organizations_url": "https://api.github.com/users/msullivan/orgs", "repos_url": "https://api.github.com/users/msullivan/repos", "events_url": "https://api.github.com/users/msullivan/events{/privacy}", "received_events_url": "https://api.github.com/users/msullivan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2796/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2796/timeline", "performed_via_github_app": null, "state_reason": "completed"}