{"url": "https://api.github.com/repos/rust-lang/rust/issues/33352", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/33352/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/33352/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/33352/events", "html_url": "https://github.com/rust-lang/rust/issues/33352", "id": 152598006, "node_id": "MDU6SXNzdWUxNTI1OTgwMDY=", "number": 33352, "title": "MSVC: Segfaults with opt-level=3 plus unwinding", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-05-02T17:13:39Z", "updated_at": "2018-10-31T20:31:45Z", "closed_at": "2018-10-31T20:31:44Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I've encountered two mysterious segfaults with opt-level=3 so far when porting our build system to rustbuild. Cargo tries to optimize aggressively by passing `-C opt-level=3` in optimized mode, but that had to get dialed back to `-C opt-level=2` in two cases.\n\nOne is [in compiletest](https://github.com/rust-lang/rust/blob/0eb575c702f56735d8bc6c3d76cb4d9bdeb13e84/src/tools/compiletest/Cargo.toml#L7), added in https://github.com/rust-lang/rust/pull/32755, and I believe [these failing logs](https://github.com/rust-lang/rust/pull/32755#issuecomment-210702500) ([cached here](https://gist.github.com/alexcrichton/32ac0b226edf964612dd3033a2ecb770)) are the segfault.\n\nThe next is in stdtest, being modified in https://github.com/rust-lang/rust/pull/33282, erroring [here](https://github.com/rust-lang/rust/pull/33282#issuecomment-215995058), and [cached here](https://gist.github.com/alexcrichton/2e3255ebdd8713a52bb7408ecc570034). The faulting test in std was [`sync::once::tests::poison_bad`](https://github.com/rust-lang/rust/blob/0eb575c702f56735d8bc6c3d76cb4d9bdeb13e84/src/libstd/sync/once.rs#L424).\n\nBoth faults look very related to unwinding, and are likely due to the early support of SEH in LLVM. This may or may not be fixed upstream (not tested), and if it's not we should probably reduce and send a test case upstream. Unfortunately simple minimizations have not succeeded just yet.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/33352/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/33352/timeline", "performed_via_github_app": null, "state_reason": "completed"}