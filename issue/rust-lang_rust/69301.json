{"url": "https://api.github.com/repos/rust-lang/rust/issues/69301", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69301/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69301/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69301/events", "html_url": "https://github.com/rust-lang/rust/issues/69301", "id": 567875362, "node_id": "MDU6SXNzdWU1Njc4NzUzNjI=", "number": 69301, "title": "macros which use $crate:: resolve to the wrong name when the crate is renamed", "user": {"login": "That3Percent", "id": 51517236, "node_id": "MDQ6VXNlcjUxNTE3MjM2", "avatar_url": "https://avatars.githubusercontent.com/u/51517236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/That3Percent", "html_url": "https://github.com/That3Percent", "followers_url": "https://api.github.com/users/That3Percent/followers", "following_url": "https://api.github.com/users/That3Percent/following{/other_user}", "gists_url": "https://api.github.com/users/That3Percent/gists{/gist_id}", "starred_url": "https://api.github.com/users/That3Percent/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/That3Percent/subscriptions", "organizations_url": "https://api.github.com/users/That3Percent/orgs", "repos_url": "https://api.github.com/users/That3Percent/repos", "events_url": "https://api.github.com/users/That3Percent/events{/privacy}", "received_events_url": "https://api.github.com/users/That3Percent/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 239393, "node_id": "MDU6TGFiZWwyMzkzOTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-resolve", "name": "A-resolve", "color": "f7e101", "default": false, "description": "Area: Path resolution"}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2020-02-19T22:02:08Z", "updated_at": "2020-03-14T19:07:11Z", "closed_at": "2020-03-14T19:07:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "A macro using `$crate::` is supposed to be able to see its namespace regardless of whether that crate is a direct dependency of the caller. This is useful for hygienic purposes.\r\n\r\nIf a crate is renamed however:\r\n\r\n```toml\r\nfutures03 = { version = \"0.3.1\", package = \"futures\" }\r\n```\r\nThen the compiler fails to find the correct crate, instead using the name of the package.\r\nUsing the previous import and the following rust code produces an error:\r\n\r\n```rust\r\nasync fn test() {\r\n    futures03::try_join!()\r\n}\r\n```\r\n\r\nThe error produced by cargo check is:\r\n```\r\nfailed to resolve: could not find `futures` in `{{root}}`\r\n```\r\n\r\nThe error shown by rust-analyzer is:\r\n```\r\nfailed to resolve: could not find `core_reexport` in `futures`\r\n```\r\n\r\nOne might try to work around the bug by not renaming the crate. But, doing so presents a problem when importing multiple versions of the same crate under different names (as one may want to do when migrating from futures01 to futures03) since it is not possible to use macros from both crates.\r\n\r\nIn this case `$crate::` should not expand to `::futures::` but expand to `::futures03::` which would fix the bug.", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69301/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69301/timeline", "performed_via_github_app": null, "state_reason": "completed"}