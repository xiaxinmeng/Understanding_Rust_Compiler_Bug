{"url": "https://api.github.com/repos/rust-lang/rust/issues/4638", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4638/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4638/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4638/events", "html_url": "https://github.com/rust-lang/rust/issues/4638", "id": 10329840, "node_id": "MDU6SXNzdWUxMDMyOTg0MA==", "number": 4638, "title": "Restructure the staged build to be simpler", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/9", "html_url": "https://github.com/rust-lang/rust/milestone/9", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/9/labels", "id": 194126, "node_id": "MDk6TWlsZXN0b25lMTk0MTI2", "number": 9, "title": "0.6", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 203, "state": "closed", "created_at": "2012-10-11T18:15:24Z", "updated_at": "2015-01-21T01:43:22Z", "due_on": "2013-03-25T07:00:00Z", "closed_at": "2013-04-02T18:27:52Z"}, "comments": 4, "created_at": "2013-01-25T23:04:26Z", "updated_at": "2013-01-28T23:39:30Z", "closed_at": "2013-01-28T23:39:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm finding I strongly want to do this before #4513.\n\nIt's hard to explain.\n\nOur build artifacts are divided between 'host' and 'target' artifacts, but all host artifacts start out as target artifacts and are 'promoted' to host artifacts.\n\nThe directory structure of our output reflects this:\n\n```\nx86_64-unknown-linux-gnu/\n    bin/ - 'host' binaries. This is where the compiler lives. Copied from a target bin directory\n    lib/ - 'host' libraries. Libs used by the compiler. Copied from a target lib directory\n        rustc/ - The 'target' subdirectory, under which target artifacts (for multiple architectures) are stored\n            ${target}/ - There are as many of these as targets the compiler supports\n                bin/ - Target binaries\n                lib/ - Target libraries\n```\n\nDuring the build, the compiler puts artifacts into the target directories, then at some point, the target artifacts with the same triple as the host artifacts are promoted to the host directories, but the way we do it is complicated.\n\nCurrently the build progresses like so:\n- Download stage0 host artifacts\n- Use stage0 host compiler to build stage0 target artifacts\n- Copy stage0 target artifacts to _stage1_ host artifacts\n- Use stage1 host compiler to build stage1 target artifacts\n- etc.\n\nThe critical problem here is that artifacts are promoted from stage N to stage N + 1. This results in the final output being the result of builds from two different compilers. It was a poor choice.\n\nWhat we are instead going to do is\n- Download stage0 host artifacts\n- Don't do any further work in stage0\n- Use the stage0 host compiler to build the stage1 target artifacts\n- Copy the stage1 target artifacts to stage1 host artifacts\n\nThis should be _much_ simpler to understand and maintain.\n", "closed_by": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4638/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4638/timeline", "performed_via_github_app": null, "state_reason": "completed"}