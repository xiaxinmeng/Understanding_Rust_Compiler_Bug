{"url": "https://api.github.com/repos/rust-lang/rust/issues/52945", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52945/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52945/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52945/events", "html_url": "https://github.com/rust-lang/rust/issues/52945", "id": 346609205, "node_id": "MDU6SXNzdWUzNDY2MDkyMDU=", "number": 52945, "title": "Consider using unreachable_unchecked in hot spots", "user": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 849077850, "node_id": "MDU6TGFiZWw4NDkwNzc4NTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/WG-compiler-performance", "name": "WG-compiler-performance", "color": "c2e0c6", "default": false, "description": "Working group: Compiler Performance"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-08-01T13:51:12Z", "updated_at": "2018-08-14T21:54:21Z", "closed_at": "2018-08-14T21:54:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[`hint::unreachable_unchecked`](https://doc.rust-lang.org/std/hint/fn.unreachable_unchecked.html) is nearly **twice** as fast as its safe counterpart ([benchmarks](https://gist.github.com/ljedrz/8add77d2f7fe00c055a016067873ecea) for 1000 matches):\r\n```\r\ntest bench_unreachable_safe   ... bench:         687 ns/iter (+/- 30)\r\ntest bench_unreachable_unsafe ... bench:         346 ns/iter (+/- 11)\r\n```\r\nIt might be a good idea to use it in hot \ud83d\udd25 spots where we are super sure\u2122\ufe0f we won't ever reach it or with `debug_assert`s right before it.\r\n\r\nI have `ripgrep`ped (a`r`-`g`eed?) for `unreachable!()`s in the compiler (list below) but I don't know which ones are hot enough. If this is a good idea I'd be happy to change them if anyone can advise where this should be considered.\r\n\r\n<details><summary>unreachable!()s</summary>\r\n\r\n- [ ]  liballoc\\borrow.rs:211\r\n- [ ]  liballoc\\raw_vec.rs:424\r\n- [ ]  liballoc\\raw_vec.rs:504\r\n- [ ]  libpanic_unwind\\emcc.rs:49\r\n- [ ]  libproc_macro\\quote.rs:131\r\n- [ ]  libproc_macro\\rustc.rs:182\r\n- [ ]  libproc_macro\\rustc.rs:183\r\n- [ ]  libproc_macro\\rustc.rs:263\r\n- [ ]  librustc_apfloat\\ieee.rs:1759\r\n- [ ]  librustc_codegen_llvm\\intrinsic.rs:1292\r\n- [ ]  librustc_codegen_llvm\\intrinsic.rs:1303\r\n- [ ]  librustc_codegen_llvm\\intrinsic.rs:1368\r\n- [ ]  librustc_codegen_llvm\\intrinsic.rs:1465\r\n- [ ]  librustc_data_structures\\small_vec.rs:98\r\n- [ ]  librustc_driver\\lib.rs:254\r\n- [ ]  librustc_driver\\pretty.rs:914\r\n- [ ]  librustc_driver\\pretty.rs:1065\r\n- [ ]  librustc_driver\\pretty.rs:1117\r\n- [ ]  librustc_driver\\pretty.rs:1123\r\n- [ ]  librustc_driver\\pretty.rs:1153\r\n- [ ]  librustc_errors\\lib.rs:751\r\n- [ ]  librustc_metadata\\encoder.rs:868\r\n- [ ]  librustc_metadata\\locator.rs:429\r\n- [ ]  librustc_plugin\\build.rs:64\r\n- [ ]  librustc_privacy\\lib.rs:385\r\n- [ ]  librustc_resolve\\build_reduced_graph.rs:175\r\n- [ ]  librustc_resolve\\build_reduced_graph.rs:469\r\n- [ ]  librustc_resolve\\build_reduced_graph.rs:508\r\n- [ ]  librustc_resolve\\macros.rs:144\r\n- [ ]  librustc_resolve\\macros.rs:167\r\n- [ ]  librustc_resolve\\macros.rs:515\r\n- [ ]  librustc_resolve\\macros.rs:683\r\n- [ ]  librustc_resolve\\macros.rs:848\r\n- [ ]  librustc_resolve\\resolve_imports.rs:202\r\n- [ ]  librustc_resolve\\resolve_imports.rs:307\r\n- [ ]  librustc_resolve\\resolve_imports.rs:584\r\n- [ ]  librustc_resolve\\resolve_imports.rs:749\r\n- [ ]  librustc_resolve\\lib.rs:1599\r\n- [ ]  librustc_save_analysis\\dump_visitor.rs:514\r\n- [ ]  librustc_typeck\\astconv.rs:386\r\n- [ ]  librustc_typeck\\astconv.rs:1389\r\n- [ ]  librustdoc\\fold.rs:37\r\n- [ ]  libserialize\\json.rs:1734\r\n- [ ]  libstd\\macros.rs:301\r\n- [ ]  libstd\\path.rs:956\r\n- [ ]  libstd\\path.rs:1003\r\n- [ ]  libsyntax_pos\\lib.rs:862\r\n- [ ]  libsyntax_pos\\lib.rs:910\r\n- [ ]  libsyntax\\tokenstream.rs:293\r\n- [ ]  libsyntax\\tokenstream.rs:305\r\n- [ ]  libsyntax\\tokenstream.rs:319\r\n- [ ]  libsyntax\\tokenstream.rs:463\r\n- [ ]  libterm\\win.rs:68\r\n- [ ]  libterm\\win.rs:88\r\n- [ ]  libcore\\iter\\mod.rs:1180\r\n- [ ]  libcore\\iter\\mod.rs:2038\r\n- [ ]  libcompiler_builtins\\src\\arm_linux.rs:30\r\n- [ ]  librustc\\hir\\def_id.rs:107\r\n- [ ]  librustc\\hir\\lowering.rs:3777\r\n- [ ]  librustc\\hir\\print.rs:2060\r\n- [ ]  librustc\\hir\\print.rs:2227\r\n- [ ]  librustc\\lint\\context.rs:305\r\n- [ ]  librustc\\mir\\tcx.rs:311\r\n- [ ]  librustc\\middle\\reachable.rs:374\r\n- [ ]  librustc\\session\\mod.rs:1299\r\n- [ ]  librustc\\traits\\project.rs:174\r\n- [ ]  librustc_borrowck\\borrowck\\mod.rs:731\r\n- [ ]  librustc_codegen_llvm\\back\\lto.rs:200\r\n- [ ]  librustc_codegen_llvm\\mir\\rvalue.rs:586\r\n- [ ]  librustc_codegen_llvm\\mir\\rvalue.rs:672\r\n- [ ]  librustc_codegen_llvm\\mir\\rvalue.rs:766\r\n- [ ]  librustc_codegen_llvm\\mir\\rvalue.rs:781\r\n- [ ]  librustc_codegen_llvm\\mir\\rvalue.rs:796\r\n- [ ]  librustc_data_structures\\obligation_forest\\mod.rs:518\r\n- [ ]  librustc_data_structures\\obligation_forest\\mod.rs:537\r\n- [ ]  librustc_driver\\profile\\mod.rs:139\r\n- [ ]  librustc_driver\\profile\\mod.rs:140\r\n- [ ]  librustc_driver\\profile\\mod.rs:307\r\n- [ ]  librustc_driver\\profile\\mod.rs:310\r\n- [ ]  librustc_incremental\\persist\\dirty_clean.rs:468\r\n- [ ]  librustc_mir\\borrow_check\\error_reporting.rs:368\r\n- [ ]  librustc_mir\\borrow_check\\mod.rs:1204\r\n- [ ]  librustc_mir\\borrow_check\\mod.rs:1753\r\n- [ ]  librustc_mir\\borrow_check\\move_errors.rs:246\r\n- [ ]  librustc_mir\\borrow_check\\mutability_errors.rs:127\r\n- [ ]  librustc_mir\\borrow_check\\mutability_errors.rs:331\r\n- [ ]  librustc_mir\\build\\scope.rs:946\r\n- [ ]  librustc_mir\\transform\\add_moves_for_packed_drops.rs:115\r\n- [ ]  librustc_mir\\transform\\simplify.rs:166\r\n- [ ]  librustc_typeck\\check\\coercion.rs:1271\r\n- [ ]  librustc_typeck\\check\\compare_method.rs:829\r\n- [ ]  librustc_typeck\\check\\compare_method.rs:889\r\n- [ ]  librustc_typeck\\check\\mod.rs:1859\r\n- [ ]  librustc_typeck\\check\\mod.rs:4984\r\n- [ ]  librustc_typeck\\check\\wfcheck.rs:389\r\n- [ ]  libstd\\io\\error.rs:215\r\n- [ ]  libstd\\sync\\rwlock.rs:227\r\n- [ ]  libsyntax\\attr\\builtin.rs:395\r\n- [ ]  libsyntax\\diagnostics\\plugin.rs:48\r\n- [ ]  libsyntax\\diagnostics\\plugin.rs:93\r\n- [ ]  libsyntax\\diagnostics\\plugin.rs:157\r\n- [ ]  libsyntax\\ext\\expand.rs:302\r\n- [ ]  libsyntax\\ext\\expand.rs:424\r\n- [ ]  libsyntax\\ext\\expand.rs:554\r\n- [ ]  libsyntax\\ext\\expand.rs:709\r\n- [ ]  libsyntax\\ext\\expand.rs:898\r\n- [ ]  libsyntax\\ext\\expand.rs:1221\r\n- [ ]  libsyntax\\ext\\expand.rs:1304\r\n- [ ]  libsyntax\\ext\\expand.rs:1416\r\n- [ ]  libsyntax\\ext\\placeholders.rs:103\r\n- [ ]  libsyntax\\print\\pprust.rs:2807\r\n- [ ]  libsyntax\\print\\pprust.rs:3051\r\n- [ ]  libsyntax\\parse\\parser.rs:633\r\n- [ ]  libsyntax\\parse\\parser.rs:2168\r\n- [ ]  libsyntax\\parse\\parser.rs:2708\r\n- [ ]  libsyntax\\parse\\parser.rs:2744\r\n- [ ]  libsyntax\\parse\\parser.rs:4419\r\n- [ ]  libsyntax\\parse\\parser.rs:4427\r\n- [ ]  libsyntax\\parse\\parser.rs:4436\r\n- [ ]  libsyntax\\parse\\parser.rs:5263\r\n- [ ]  libsyntax_ext\\deriving\\debug.rs:125\r\n- [ ]  libterm\\terminfo\\parm.rs:169\r\n- [ ]  libterm\\terminfo\\parm.rs:189\r\n- [ ]  libterm\\terminfo\\parm.rs:230\r\n- [ ]  tools\\linkchecker\\main.rs:249\r\n- [ ]  liballoc\\collections\\btree\\map.rs:167\r\n- [ ]  liballoc\\collections\\btree\\map.rs:982\r\n- [ ]  liballoc\\collections\\btree\\map.rs:1060\r\n- [ ]  liballoc\\collections\\btree\\map.rs:2511\r\n- [ ]  liballoc\\collections\\btree\\node.rs:1428\r\n- [ ]  liballoc\\collections\\btree\\node.rs:1489\r\n- [ ]  liballoc\\collections\\btree\\node.rs:1574\r\n- [ ]  libcore\\num\\dec2flt\\rawfp.rs:301\r\n- [ ]  libcore\\num\\dec2flt\\rawfp.rs:308\r\n- [ ]  librustc\\infer\\error_reporting\\mod.rs:201\r\n- [ ]  librustc\\ty\\query\\on_disk_cache.rs:661\r\n- [ ]  librustc\\ty\\query\\on_disk_cache.rs:754\r\n- [ ]  librustc\\ty\\query\\plumbing.rs:626\r\n- [ ]  librustc_mir\\borrow_check\\nll\\invalidation.rs:440\r\n- [ ]  librustc_target\\abi\\call\\mod.rs:379\r\n- [ ]  libstd\\collections\\hash\\map.rs:804\r\n- [ ]  libstd\\collections\\hash\\map.rs:999\r\n- [ ]  libstd\\collections\\hash\\map.rs:3472\r\n- [ ]  libstd\\collections\\hash\\map.rs:3484\r\n- [ ]  libstd\\collections\\hash\\map.rs:3496\r\n- [ ]  libstd\\collections\\hash\\map.rs:3507\r\n- [ ]  libstd\\collections\\hash\\table.rs:720\r\n- [ ]  libstd\\collections\\hash\\table.rs:761\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:124\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:190\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:212\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:269\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:298\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:337\r\n- [ ]  libstd\\sync\\mpsc\\oneshot.rs:362\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:851\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:898\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:916\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:1206\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:1214\r\n- [ ]  libstd\\sync\\mpsc\\mod.rs:1221\r\n- [ ]  libstd\\sync\\mpsc\\select.rs:386\r\n- [ ]  libstd\\sync\\mpsc\\shared.rs:337\r\n- [ ]  libstd\\sync\\mpsc\\spsc_queue.rs:279\r\n- [ ]  libstd\\sync\\mpsc\\spsc_queue.rs:286\r\n- [ ]  libstd\\sync\\mpsc\\stream.rs:363\r\n- [ ]  libstd\\sync\\mpsc\\stream.rs:392\r\n- [ ]  libstd\\sync\\mpsc\\stream.rs:484\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:126\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:143\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:251\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:267\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:338\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:380\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:412\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:440\r\n- [ ]  libstd\\sync\\mpsc\\sync.rs:441\r\n- [ ]  libstd\\sys\\unix\\fs.rs:507\r\n- [ ]  libstd\\sys\\redox\\os.rs:207\r\n- [ ]  libsyntax\\ext\\tt\\macro_parser.rs:755\r\n- [ ]  libsyntax\\ext\\tt\\macro_rules.rs:196\r\n- [ ]  libsyntax\\parse\\lexer\\mod.rs:1392\r\n- [ ]  libsyntax_ext\\deriving\\generic\\mod.rs:468\r\n- [ ]  libcompiler_builtins\\libm\\src\\math\\rem_pio2_large.rs:465\r\n- [ ]  libstd\\sys\\redox\\syscall\\call.rs:21\r\n</details>", "closed_by": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52945/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52945/timeline", "performed_via_github_app": null, "state_reason": "completed"}