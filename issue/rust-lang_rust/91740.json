{"url": "https://api.github.com/repos/rust-lang/rust/issues/91740", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91740/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91740/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91740/events", "html_url": "https://github.com/rust-lang/rust/issues/91740", "id": 1076723406, "node_id": "I_kwDOAAsO6M5ALX7O", "number": 91740, "title": "Remove `cfg(test)` from `doc_auto_cfg`", "user": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 2406929537, "node_id": "MDU6TGFiZWwyNDA2OTI5NTM3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-rustdoc-ui", "name": "A-rustdoc-ui", "color": "f7e101", "default": false, "description": "Area: rustdoc UI (generated HTML)"}, {"id": 2524183809, "node_id": "MDU6TGFiZWwyNTI0MTgzODA5", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-doc_cfg", "name": "F-doc_cfg", "color": "f9c0cc", "default": false, "description": "`#![feature(doc_cfg)]`"}, {"id": 3609405544, "node_id": "LA_kwDOAAsO6M7XIyho", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-doc_auto_cfg", "name": "F-doc_auto_cfg", "color": "f9c0cc", "default": false, "description": "`#![feature(doc_auto_cfg)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-12-10T11:04:09Z", "updated_at": "2022-01-21T06:20:14Z", "closed_at": "2022-01-21T06:20:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From https://github.com/rust-lang/rust/issues/43781#issuecomment-990466461 and https://github.com/rust-lang/rust/issues/43781#issuecomment-990794133.\r\n\r\nCurrently `#[cfg(any(feature = \"danger\", test))]` shows up as:\r\n<img alt=\"grafik\" width=\"392\" src=\"https://user-images.githubusercontent.com/1645124/145498862-dd978a31-3e11-4429-abc4-2c82094ae608.png\">\r\n\r\nThis seems to be undesired behavior. I'm not familiar with the Rust compiler, but looking through the code lead me to the conclusion that the best way to do this is transform `Attribute`s, removing undesired `cfg`s before passing them to further processing.\r\n\r\nThe current implementation of `doc_hide_cfg` can only remove `cfg`s that have an exact match. `#![doc(cfg_hide(feature = \"x\"))]` can only hide `#[cfg(feature = \"x\")]`, it can't hide `#[cfg(any(feature = \"x\", feature = \"y\"))]` or `#[cfg(all(feature = \"x\", feature = \"y\"))]`. So my impression is that we can't hook into `doc_hide_cfg` to solve this.\r\n\r\nImplementing what I described above could also pave the way to adjust the behaviour of `cfg_hide` and allow it to match for `cfg`s inside `any` and `all`, if this is desired.\r\n\r\nCc https://github.com/rust-lang/rust/issues/43781.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91740/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91740/timeline", "performed_via_github_app": null, "state_reason": "completed"}