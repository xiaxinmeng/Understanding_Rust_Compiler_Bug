{"url": "https://api.github.com/repos/rust-lang/rust/issues/107676", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107676/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107676/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107676/events", "html_url": "https://github.com/rust-lang/rust/issues/107676", "id": 1571204270, "node_id": "I_kwDOAAsO6M5dpqyu", "number": 107676, "title": "x fmt broken on NixOS since stage0 update", "user": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2023-02-05T02:10:32Z", "updated_at": "2023-02-13T00:21:57Z", "closed_at": "2023-02-13T00:21:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`x fmt` is broken on NixOS. Do `./x fmt`:\r\n\r\n```\r\nrustfmt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory\r\n```\r\n\r\n<details>\r\n\r\n```\r\n$ ./x fmt\r\ndownloading https://static.rust-lang.org/dist/2023-01-25/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz\r\n############################################################################################################################## 100,0%\r\nextracting /home/user/src/rust/build/cache/2023-01-25/rust-std-beta-x86_64-unknown-linux-gnu.tar.xz\r\ndownloading https://static.rust-lang.org/dist/2023-01-25/rustc-beta-x86_64-unknown-linux-gnu.tar.xz\r\n############################################################################################################################## 100,0%\r\nextracting /home/user/src/rust/build/cache/2023-01-25/rustc-beta-x86_64-unknown-linux-gnu.tar.xz\r\ndownloading https://static.rust-lang.org/dist/2023-01-25/cargo-beta-x86_64-unknown-linux-gnu.tar.xz\r\n############################################################################################################################## 100,0%\r\nextracting /home/user/src/rust/build/cache/2023-01-25/cargo-beta-x86_64-unknown-linux-gnu.tar.xz\r\ninfo: You seem to be using Nix.\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/bin/rustc\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/bin/rustdoc\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/libexec/rust-analyzer-proc-macro-srv\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/lib/libLLVM-15-rust-1.68.0-beta.so\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/lib/libtest-63b73d86237cbf5d.so\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/lib/librustc_driver-c78d16bcb49dc5d0.so\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/stage0/lib/libstd-b13f8c20834489ed.so\r\nBuilding bootstrap\r\n   Compiling libc v0.2.137\r\n   Compiling memchr v2.5.0\r\n   Compiling proc-macro2 v1.0.46\r\n   Compiling cfg-if v1.0.0\r\n   Compiling typenum v1.15.0\r\n   Compiling unicode-ident v1.0.0\r\n   Compiling version_check v0.9.4\r\n   Compiling syn v1.0.102\r\n   Compiling cc v1.0.73\r\n   Compiling serde_derive v1.0.137\r\n   Compiling generic-array v0.14.5\r\n   Compiling lazy_static v1.4.0\r\n   Compiling regex-automata v0.1.10\r\n   Compiling io-lifetimes v1.0.1\r\n   Compiling serde v1.0.137\r\n   Compiling pkg-config v0.3.25\r\n   Compiling quote v1.0.18\r\n   Compiling log v0.4.17\r\n   Compiling aho-corasick v0.7.18\r\n   Compiling bstr v0.2.17\r\n   Compiling crossbeam-utils v0.8.14\r\n   Compiling rustix v0.36.3\r\n   Compiling lzma-sys v0.1.17\r\n   Compiling regex-syntax v0.6.26\r\n   Compiling same-file v1.0.6\r\n   Compiling serde_json v1.0.81\r\n   Compiling bitflags v1.3.2\r\n   Compiling crypto-common v0.1.3\r\n   Compiling block-buffer v0.10.2\r\n   Compiling once_cell v1.12.0\r\n   Compiling linux-raw-sys v0.1.3\r\n   Compiling fnv v1.0.7\r\n   Compiling thread_local v1.1.4\r\n   Compiling digest v0.10.3\r\n   Compiling walkdir v2.3.2\r\n   Compiling filetime v0.2.16\r\n   Compiling xattr v0.2.3\r\n   Compiling bootstrap v0.0.0 (/home/user/src/rust/src/bootstrap)\r\n   Compiling unicode-width v0.1.9\r\n   Compiling ryu v1.0.10\r\n   Compiling cpufeatures v0.2.5\r\n   Compiling itoa v1.0.2\r\n   Compiling sha2 v0.10.2\r\n   Compiling getopts v0.2.21\r\n   Compiling tar v0.4.38\r\n   Compiling opener v0.5.0\r\n   Compiling object v0.29.0\r\n   Compiling cmake v0.1.48\r\n   Compiling regex v1.5.6\r\n   Compiling build_helper v0.1.0 (/home/user/src/rust/src/tools/build_helper)\r\n   Compiling hex v0.4.3\r\n   Compiling fd-lock v3.0.8\r\n   Compiling globset v0.4.8\r\n   Compiling ignore v0.4.18\r\n   Compiling xz2 v0.1.6\r\n   Compiling toml v0.5.9\r\n    Finished dev [unoptimized] target(s) in 36.94s\r\ndownloading https://static.rust-lang.org/dist/2023-01-30/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz\r\n############################################################################################################################## 100,0%\r\nextracting /home/user/src/rust/build/cache/2023-01-30/rustfmt-nightly-x86_64-unknown-linux-gnu.tar.xz to /home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt\r\ndownloading https://static.rust-lang.org/dist/2023-01-30/rustc-nightly-x86_64-unknown-linux-gnu.tar.xz\r\n############################################################################################################################## 100,0%\r\nextracting /home/user/src/rust/build/cache/2023-01-30/rustc-nightly-x86_64-unknown-linux-gnu.tar.xz to /home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt\r\ninfo: You seem to be using Nix.\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/rustfmt\r\n/nix/store/<hash>-rust-stage0-dependencies\r\nattempting to patch /home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/cargo-fmt\r\n/home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/rustfmt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory\r\nRunning `\"/home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/rustfmt\" \"--config-path\" \"/home/user/src/rust\" \"--edition\" \"2021\" \"--unstable-features\" \"--skip-children\" \"/home/user/src/rust/src/rustdoc-json-types/lib.rs\"` failed.\r\nIf you're running `tidy`, try again with `--bless`. Or, if you just want to format code, run `./x.py fmt` instead.\r\n/home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/rustfmt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory\r\n/home/user/src/rust/build/x86_64-unknown-linux-gnu/rustfmt/bin/rustfmt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory\r\nBuild completed successfully in 0:01:44\r\n```\r\n\r\n</details>\r\n\r\nIt's a regression of the stage 0 update, as it worked fine on 9467f9553197e1dab950bdc842fd407b0ac2d59b, but errors since dc1d9d50fba2f6a1ccab8748a0050cde38253f60 .\r\n\r\nThe description of  #107297 points to a possible cause (highlighting by me):\r\n\r\n>  include the rustc component for the rustfmt pinned nightly toolchain, which is currently necessary **due to rustfmt dynamically linking to that toolchain's librustc_driver and libstd**.\r\n\r\nI suppose we need to run patchelf on more stuff now?\r\n\r\ncc #107547\r\n\r\n@rustbot label T-bootstrap", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107676/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107676/timeline", "performed_via_github_app": null, "state_reason": "completed"}