{"url": "https://api.github.com/repos/rust-lang/rust/issues/56520", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/56520/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/56520/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/56520/events", "html_url": "https://github.com/rust-lang/rust/issues/56520", "id": 387498764, "node_id": "MDU6SXNzdWUzODc0OTg3NjQ=", "number": 56520, "title": "rustc 1.32.0-nightly \"no errors encountered even though `delay_span_bug` issued\"", "user": {"login": "mqudsi", "id": 606923, "node_id": "MDQ6VXNlcjYwNjkyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/606923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mqudsi", "html_url": "https://github.com/mqudsi", "followers_url": "https://api.github.com/users/mqudsi/followers", "following_url": "https://api.github.com/users/mqudsi/following{/other_user}", "gists_url": "https://api.github.com/users/mqudsi/gists{/gist_id}", "starred_url": "https://api.github.com/users/mqudsi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mqudsi/subscriptions", "organizations_url": "https://api.github.com/users/mqudsi/orgs", "repos_url": "https://api.github.com/users/mqudsi/repos", "events_url": "https://api.github.com/users/mqudsi/events{/privacy}", "received_events_url": "https://api.github.com/users/mqudsi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-12-04T22:00:12Z", "updated_at": "2021-02-06T23:42:07Z", "closed_at": "2018-12-07T05:12:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I experienced the following trying to compile a crate with rustc 1.32.0-nightly (0c999ed13 2018-12-03).\r\n\r\nI put up a copy of the code in the state that caused this at [neosmart/securestore-rs@rustc_crash](https://github.com/neosmart/securestore-rs/tree/rustc_crash).\r\n\r\n```\r\nthread 'rustc' panicked at 'index out of bounds: the len is 1 but the index is 1', /rustc/0c999ed132d67bf2520643e9bd619972cf3888ba/src/libcore/slice/mod.rs:2463:10\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\nerror: internal compiler error: cat_expr Errd\r\n   --> securestore/src/lib.rs:76:87\r\n    |\r\n76  |       fn extract_keys(&self, iv: &Option<[u8; shared::IV_SIZE]>) -> Result<Keys, Error> {\r\n    |  _______________________________________________________________________________________^\r\n77  | |         let mut encryption_key = [0u8; shared::KEY_LENGTH];\r\n78  | |         let mut hmac_key = [0u8; shared::KEY_LENGTH];\r\n79  | |\r\n...   |\r\n117 | |         })\r\n118 | |     }\r\n    | |_____^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> securestore/src/lib.rs:80:15\r\n   |\r\n80 |         match &Self {\r\n   |               ^^^^^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> securestore/src/lib.rs:80:16\r\n   |\r\n80 |         match &Self {\r\n   |                ^^^^\r\n\r\nerror: internal compiler error: QualifyAndPromoteConstants: Mir had errors\r\n   --> securestore/src/lib.rs:76:5\r\n    |\r\n76  | /     fn extract_keys(&self, iv: &Option<[u8; shared::IV_SIZE]>) -> Result<Keys, Error> {\r\n77  | |         let mut encryption_key = [0u8; shared::KEY_LENGTH];\r\n78  | |         let mut hmac_key = [0u8; shared::KEY_LENGTH];\r\n79  | |\r\n...   |\r\n117 | |         })\r\n118 | |     }\r\n    | |_____^\r\n\r\nerror: internal compiler error: broken MIR in DefId(0/0:54 ~ securestore[d33c]::{{impl}}[1]::extract_keys[0]) (\"return type\"): bad type [type error]\r\n   --> securestore/src/lib.rs:76:5\r\n    |\r\n76  | /     fn extract_keys(&self, iv: &Option<[u8; shared::IV_SIZE]>) -> Result<Keys, Error> {\r\n77  | |         let mut encryption_key = [0u8; shared::KEY_LENGTH];\r\n78  | |         let mut hmac_key = [0u8; shared::KEY_LENGTH];\r\n79  | |\r\n...   |\r\n117 | |         })\r\n118 | |     }\r\n    | |_____^\r\n\r\nerror: internal compiler error: broken MIR in DefId(0/0:54 ~ securestore[d33c]::{{impl}}[1]::extract_keys[0]) (LocalDecl { mutability: Mut, is_user_variable: None, internal: false, is_block_tail: None, ty: [type error], user_ty: UserTypeProjections { contents: [] }, name: None, source_info: SourceInfo { span: securestore/src/lib.rs:76:5: 118:6, scope: scope[0] }, visibility_scope: scope[0] }): bad type [type error]\r\n   --> securestore/src/lib.rs:76:5\r\n    |\r\n76  | /     fn extract_keys(&self, iv: &Option<[u8; shared::IV_SIZE]>) -> Result<Keys, Error> {\r\n77  | |         let mut encryption_key = [0u8; shared::KEY_LENGTH];\r\n78  | |         let mut hmac_key = [0u8; shared::KEY_LENGTH];\r\n79  | |\r\n...   |\r\n117 | |         })\r\n118 | |     }\r\n    | |_____^\r\n\r\nthread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src/librustc_errors/lib.rs:334:17\r\nstack backtrace:\r\n   0:     0x7fe8be6d5c63 - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h8c27c4880bde890a\r\n                               at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7fe8be6cd378 - std::sys_common::backtrace::_print::h94ad143e1a1f23ce\r\n                               at src/libstd/sys_common/backtrace.rs:71\r\n   2:     0x7fe8be6d26d2 - std::panicking::default_hook::{{closure}}::he4263dcd9a70a0a9\r\n                               at src/libstd/sys_common/backtrace.rs:59\r\n                               at src/libstd/panicking.rs:211\r\n   3:     0x7fe8be6d243d - std::panicking::default_hook::he81ae3ee90693fac\r\n                               at src/libstd/panicking.rs:227\r\n   4:     0x7fe8baea7cd3 - rustc::util::common::panic_hook::h6ff7d65005b5c4d4\r\n   5:     0x7fe8be6d2eb9 - std::panicking::rust_panic_with_hook::h0031c4eeabc83ca7\r\n                               at src/libstd/panicking.rs:495\r\n   6:     0x7fe8b9aee744 - std::panicking::begin_panic::hf7a210e797c2ef35\r\n   7:     0x7fe8b9b00cb4 - <rustc_errors::Handler as core::ops::drop::Drop>::drop::h80f0d43cd8b57bf2\r\n   8:     0x7fe8beab4711 - core::ptr::real_drop_in_place::ha1ba247982bc728d\r\n   9:     0x7fe8beabac34 - rustc_driver::run_compiler_with_pool::h6807732b01150746\r\n  10:     0x7fe8be9f5aa5 - <scoped_tls::ScopedKey<T>>::set::hde11c7bf316bfff6\r\n  11:     0x7fe8beab91ea - rustc_driver::run_compiler::h2dda64ccf7980290\r\n  12:     0x7fe8bea136de - rustc_driver::monitor::{{closure}}::h54c6ce747624f597\r\n  13:     0x7fe8be6ef2e9 - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:102\r\n  14:     0x7fe8bea04070 - <F as alloc::boxed::FnBox<A>>::call_box::h1b30e7f5bf58f422\r\n  15:     0x7fe8be6e280d - std::sys::unix::thread::Thread::new::thread_start::h9ba17bb7e4aabdcb\r\n                               at /rustc/0c999ed132d67bf2520643e9bd619972cf3888ba/src/liballoc/boxed.rs:683\r\n                               at src/libstd/sys_common/thread.rs:24\r\n                               at src/libstd/sys/unix/thread.rs:90\r\n  16:     0x7fe8b8ad76da - start_thread\r\n  17:     0x7fe8be39188e - __clone\r\n  18:                0x0 - <unknown>\r\nthread panicked while panicking. aborting.\r\nerror: Could not compile `securestore`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --edition=2018 --crate-name securestore securestore/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=0749cce87946a744 -C extra-filename=-0749cce87946a744 --out-dir /mnt/d/GIT/securestore-rs/target/debug/deps -C incremental=/mnt/d/GIT/securestore-rs/target/debug/incremental -L dependency=/mnt/d/GIT/securestore-rs/target/debug/deps --extern openssl=/mnt/d/GIT/securestore-rs/target/debug/deps/libopenssl-2e68a25d4040a661.rlib --extern serde=/mnt/d/GIT/securestore-rs/target/debug/deps/libserde-40d2f6e887424bea.rlib --extern serde_derive=/mnt/d/GIT/securestore-rs/target/debug/deps/libserde_derive-f6d311be5ca0118f.so --extern serde_json=/mnt/d/GIT/securestore-rs/target/debug/deps/libserde_json-e41670aa8ec886a9.rlib -C target-cpu=native -C target-feature=+avx2` (signal: 4, SIGILL: illegal instruction)\r\n```", "closed_by": {"login": "mqudsi", "id": 606923, "node_id": "MDQ6VXNlcjYwNjkyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/606923?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mqudsi", "html_url": "https://github.com/mqudsi", "followers_url": "https://api.github.com/users/mqudsi/followers", "following_url": "https://api.github.com/users/mqudsi/following{/other_user}", "gists_url": "https://api.github.com/users/mqudsi/gists{/gist_id}", "starred_url": "https://api.github.com/users/mqudsi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mqudsi/subscriptions", "organizations_url": "https://api.github.com/users/mqudsi/orgs", "repos_url": "https://api.github.com/users/mqudsi/repos", "events_url": "https://api.github.com/users/mqudsi/events{/privacy}", "received_events_url": "https://api.github.com/users/mqudsi/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/56520/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/56520/timeline", "performed_via_github_app": null, "state_reason": "completed"}