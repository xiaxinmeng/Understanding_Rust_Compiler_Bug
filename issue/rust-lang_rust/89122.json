{"url": "https://api.github.com/repos/rust-lang/rust/issues/89122", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89122/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89122/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89122/events", "html_url": "https://github.com/rust-lang/rust/issues/89122", "id": 1001188702, "node_id": "I_kwDOAAsO6M47rO1e", "number": 89122, "title": "Proposal: Change syntax of where clauses on type aliases", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 1485960423, "node_id": "MDU6TGFiZWwxNDg1OTYwNDIz", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_associated_types", "name": "F-generic_associated_types", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_associated_types)]` a.k.a. GATs"}, {"id": 3307663436, "node_id": "MDU6TGFiZWwzMzA3NjYzNDM2", "url": "https://api.github.com/repos/rust-lang/rust/labels/GATs-triaged", "name": "GATs-triaged", "color": "e88000", "default": false, "description": "Issues using the `generic_associated_types` feature that have been triaged"}, {"id": 3455727362, "node_id": "LA_kwDOAAsO6M7N-jcC", "url": "https://api.github.com/repos/rust-lang/rust/labels/GATs-blocking", "name": "GATs-blocking", "color": "e88000", "default": false, "description": "Issues using the `generic_associated_types` feature that block stabilization"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 47, "created_at": "2021-09-20T16:54:37Z", "updated_at": "2023-01-30T19:41:51Z", "closed_at": "2022-03-06T09:30:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[Source](https://rust-lang.github.io/generic-associated-types-initiative/design-discussions/where-the-where.html)\r\n\r\n## Summary\r\n\r\nProposed: to alter the syntax of where clauses on type aliases so that they appear *after* the value:\r\n\r\n```\r\ntype StringMap<K> = BTreeMap<K, String>\r\nwhere\r\n    K: PartialOrd\r\n```\r\n\r\nThis applies both in top-level modules and in trats (associated types, generic or otherwise).\r\n\r\n## Background\r\n\r\nThe current syntax for where to place the \"where clause\" of a generic associated types is awkward. Consider this example ([playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=bdb55a5d5cb17e20d73e22a3f2db0e57)):\r\n\r\n```rust\r\ntrait Iterable {\r\n    type Iter<'a> where Self: 'a;\r\n\r\n    fn iter(&self) -> Self::Iter<'_>;\r\n}\r\n\r\nimpl<T> Iterable for Vec<T> {\r\n    type Iter<'a>\r\n    where \r\n        Self: 'a = <&'a [T] as IntoIterator>::IntoIter;\r\n\r\n    fn iter(&self) -> Self::Iter<'_> {\r\n        self.iter()\r\n    }\r\n}\r\n```\r\n\r\nNote the impl. Most people expect the impl to be written as follows (indeed, the author wrote it this way in the first draft):\r\n\r\n```rust\r\nimpl Iterable for Vec<T> {\r\n    type Iter<'a>  = <&'a [T] as Iterator>::Iter\r\n    where \r\n        Self: 'a;\r\n\r\n    fn iter(&self) -> Self::Iter<'_> {\r\n        self.iter()\r\n    }\r\n}\r\n```\r\n\r\nHowever, this placement of the where clause is in fact rather inconsistent, since the `= <&'a [T] as Iterator>::Iter` is in some sense the \"body\" of the item.\r\n\r\nThe same current syntax is used for where clauses on type aliases ([playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=74eeed1795b693f238150f825a0e8438)):\r\n\r\n```rust\r\ntype Foo<T> where T: Eq = Vec<T>;\r\n\r\nfn main() { }\r\n```\r\n\r\n## Top-level type aliases\r\n\r\nCurrently, we accept where clauses in top-level type aliases, but they are deprecated (warning) and semi-ignored:\r\n\r\n```\r\ntype StringMap<K> where\r\n    K: PartialOrd\r\n= BTreeMap<K, String>\r\n```\r\n\r\nUnder this proposal, this syntax remains, but is deprecated. The newer syntax for type aliases (with `where` coming after the type) would remain feature gated until such time as we enforce the expected semantics.\r\n\r\n## Alternatives\r\n\r\n### Keep the current syntax.\r\n\r\nIn this case, we must settle the question of how we expect it to be formatted (surely not as I have shown it above).\r\n\r\n```rust\r\nimpl<T> Iterable for Vec<T> {\r\n    type Iter<'a> where Self: 'a \r\n        = <&'a [T] as IntoIterator>::IntoIter;\r\n\r\n    fn iter(&self) -> Self::Iter<'_> {\r\n        self.iter()\r\n    }\r\n}\r\n```\r\n\r\n### Accept either\r\n\r\nWhat do we do if both are supplied?", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89122/reactions", "total_count": 106, "+1": 77, "-1": 7, "laugh": 0, "hooray": 0, "confused": 0, "heart": 8, "rocket": 7, "eyes": 7}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89122/timeline", "performed_via_github_app": null, "state_reason": "completed"}