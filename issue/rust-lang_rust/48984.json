{"url": "https://api.github.com/repos/rust-lang/rust/issues/48984", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48984/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48984/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48984/events", "html_url": "https://github.com/rust-lang/rust/issues/48984", "id": 304843843, "node_id": "MDU6SXNzdWUzMDQ4NDM4NDM=", "number": 48984, "title": "ICE: rustc panics on trait bound with array associated type (stable)", "user": {"login": "fspmarshall", "id": 30576607, "node_id": "MDQ6VXNlcjMwNTc2NjA3", "avatar_url": "https://avatars.githubusercontent.com/u/30576607?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fspmarshall", "html_url": "https://github.com/fspmarshall", "followers_url": "https://api.github.com/users/fspmarshall/followers", "following_url": "https://api.github.com/users/fspmarshall/following{/other_user}", "gists_url": "https://api.github.com/users/fspmarshall/gists{/gist_id}", "starred_url": "https://api.github.com/users/fspmarshall/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fspmarshall/subscriptions", "organizations_url": "https://api.github.com/users/fspmarshall/orgs", "repos_url": "https://api.github.com/users/fspmarshall/repos", "events_url": "https://api.github.com/users/fspmarshall/events{/privacy}", "received_events_url": "https://api.github.com/users/fspmarshall/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-03-13T16:39:52Z", "updated_at": "2018-04-29T05:16:21Z", "closed_at": "2018-04-29T05:16:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I came across a compiler error (stable channel) while working with a trait which extends another trait (eg: `trait Dog: Mammal { .. }`).  After some experimenting, it appears the error occurs when the base trait has at least one associated type, and the extending trait specifies the associated type as an array of some kind.  In order to trigger the error, the extending trait must be defined in an external crate, and used to constrain a generic type parameter.\r\n\r\nHere is the simplest replication of the error I could come up with:\r\n\r\ndefine `my_crate` like so:\r\n```rust\r\npub trait Foo { type Item; } // can be any trait w/ an associated type\r\n\r\npub trait Bar: Foo<Item=[u8;1]> {  } // length & type of array does not seem to matter\r\n```\r\n\r\npull in `my_crate` from another crate:\r\n```rust\r\nextern crate my_crate;\r\nuse my_crate::Bar;\r\n\r\nfn do_thing<T: Bar>() { } // bounds on structs and impls also trigger bug\r\n```\r\n\r\nattempting to compile the above generates this error:\r\n\r\n```\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.24.1 (d3ae9a9e0 2018-02-27) running on x86_64-unknown-linux-gnu\r\n\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /checkout/src/libcore/option.rs:335:21\r\n```\r\n\r\nJudging by the [backtrace](https://gist.githubusercontent.com/forrest-marshall/f1364198dcee0b421502c69712894ddf/raw/112fa1245e27552d19062739031e9597af3fc495/rustc-traceback) it seems likely that the offending unwrap is one of [these two](https://github.com/rust-lang/rust/blob/e65547d4fad0425d1db4f33a4d8134bf2cad939e/src/librustc_metadata/decoder.rs#L878-L879), but that is just a guess.\r\n\r\nI've replicated this bug with my local rust install as well as the latest version of the official rust docker image.\r\n\r\nVerbose `rustc` version info for my local install:\r\n\r\n```\r\nrustc 1.24.1 (d3ae9a9e0 2018-02-27)\r\nbinary: rustc\r\ncommit-hash: d3ae9a9e08edf12de0ed82af57ba2a56c26496ea\r\ncommit-date: 2018-02-27\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.24.1\r\nLLVM version: 4.0\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48984/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48984/timeline", "performed_via_github_app": null, "state_reason": "completed"}