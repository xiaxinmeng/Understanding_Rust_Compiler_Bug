{"url": "https://api.github.com/repos/rust-lang/rust/issues/111507", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/111507/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/111507/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/111507/events", "html_url": "https://github.com/rust-lang/rust/issues/111507", "id": 1707610755, "node_id": "I_kwDOAAsO6M5lyBKD", "number": 111507, "title": "Building rust 1.69.0 with LLVM 16, then using that to build firefox 113, results in a crash on startup", "user": {"login": "berolinux", "id": 778765, "node_id": "MDQ6VXNlcjc3ODc2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/778765?v=4", "gravatar_id": "", "url": "https://api.github.com/users/berolinux", "html_url": "https://github.com/berolinux", "followers_url": "https://api.github.com/users/berolinux/followers", "following_url": "https://api.github.com/users/berolinux/following{/other_user}", "gists_url": "https://api.github.com/users/berolinux/gists{/gist_id}", "starred_url": "https://api.github.com/users/berolinux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/berolinux/subscriptions", "organizations_url": "https://api.github.com/users/berolinux/orgs", "repos_url": "https://api.github.com/users/berolinux/repos", "events_url": "https://api.github.com/users/berolinux/events{/privacy}", "received_events_url": "https://api.github.com/users/berolinux/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-05-12T13:08:45Z", "updated_at": "2023-05-31T07:46:36Z", "closed_at": "2023-05-31T07:46:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "Sorry, no small self-contained test case yet...\r\n\r\nIf rust 1.69.0 is built with LLVM 16, and the resulting rust is used to build firefox 113 (with clang 16 for the C and C++ parts), the resulting binary crashes on startup.\r\nThe problem goes away if rust 1.69.0 is built with bundled LLVM instead (still using clang 16 for C/C++ parts).\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.69.0 (84c898d65 2023-04-16) (built from a source tarball)\r\nbinary: rustc\r\ncommit-hash: 84c898d65adf2f39a5a98507f1fe0ce10a2b8dbc\r\ncommit-date: 2023-04-16\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.69.0\r\nLLVM version: 16.0.2\r\n```\r\n\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nThread 1 \"firefox\" received signal SIGSEGV, Segmentation fault.\r\n0x00007ffff3093b27 in style::style_adjuster::StyleAdjuster::adjust::h2df66d511b1d2fd7 () from /usr/lib64/firefox-113.0/libxul.so\r\n(gdb) bt\r\n#0  0x00007ffff3093b27 in style::style_adjuster::StyleAdjuster::adjust::h2df66d511b1d2fd7 () from /usr/lib64/firefox-113.0/libxul.so\r\n#1  0x00007ffff30926bd in style::properties::cascade::cascade_rules::h0859924e6a48a9d4 () from /usr/lib64/firefox-113.0/libxul.so\r\n#2  0x00007ffff30918c1 in style::stylist::Stylist::cascade_style_and_visited::h9917b048e41e23f6 () from /usr/lib64/firefox-113.0/libxul.so\r\n#3  0x00007ffff310dfc1 in Servo_ComputedValues_GetForAnonymousBox () from /usr/lib64/firefox-113.0/libxul.so\r\n#4  0x00007ffff12bd8b4 in nsCSSFrameConstructor::ConstructRootFrame() () from /usr/lib64/firefox-113.0/libxul.so\r\n#5  0x00007ffff127fc1b in mozilla::PresShell::Initialize() () from /usr/lib64/firefox-113.0/libxul.so\r\n#6  0x00007ffff0a4027f in mozilla::dom::PrototypeDocumentContentSink::StartLayout() () from /usr/lib64/firefox-113.0/libxul.so\r\n#7  0x00007ffff0a400b0 in mozilla::dom::PrototypeDocumentContentSink::DoneWalking() () from /usr/lib64/firefox-113.0/libxul.so\r\n#8  0x00007ffff0f9ba4f in mozilla::dom::DocumentL10n::InitialTranslationCompleted(bool) () from /usr/lib64/firefox-113.0/libxul.so\r\n#9  0x00007ffff0fa04b4 in L10nReadyHandler::ResolvedCallback(JSContext*, JS::Handle<JS::Value>, mozilla::ErrorResult&) ()\r\n   from /usr/lib64/firefox-113.0/libxul.so\r\n#10 0x00007ffff0d125dd in mozilla::dom::(anonymous namespace)::PromiseNativeHandlerShim::ResolvedCallback(JSContext*, JS::Handle<JS::Value>, mozilla::ErrorResult&) () from /usr/lib64/firefox-113.0/libxul.so\r\n#11 0x00007ffff0d12896 in mozilla::dom::NativeHandlerCallback(JSContext*, unsigned int, JS::Value*) () from /usr/lib64/firefox-113.0/libxul.so\r\n#12 0x00007ffff250e95a in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct, js::CallReason) ()\r\n   from /usr/lib64/firefox-113.0/libxul.so\r\n#13 0x00007ffff250f0be in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>, js::CallReason) () from /usr/lib64/firefox-113.0/libxul.so\r\n#14 0x00007ffff2651f29 in PromiseReactionJob(JSContext*, unsigned int, JS::Value*) () from /usr/lib64/firefox-113.0/libxul.so\r\n#15 0x00007ffff250e95a in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&, js::MaybeConstruct, js::CallReason) ()\r\n   from /usr/lib64/firefox-113.0/libxul.so\r\n#16 0x00007ffff250f0be in js::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, js::AnyInvokeArgs const&, JS::MutableHandle<JS::Value>, js::CallReason) () from /usr/lib64/firefox-113.0/libxul.so\r\n#17 0x00007ffff25777a6 in JS::Call(JSContext*, JS::Handle<JS::Value>, JS::Handle<JS::Value>, JS::HandleValueArray const&, JS::MutableHandle<JS::Value>) ()\r\n   from /usr/lib64/firefox-113.0/libxul.so\r\n#18 0x00007fffef53fb55 in mozilla::dom::FinalizationRegistryCleanupCallback::Call(mozilla::dom::BindingCallContext&, JS::Handle<JS::Value>, mozilla::ErrorResult&) () from /usr/lib64/firefox-113.0/libxul.so\r\n#19 0x00007fffee4a2d72 in mozilla::PromiseJobRunnable::Run(mozilla::AutoSlowOperation&) () from /usr/lib64/firefox-113.0/libxul.so\r\n#20 0x00007fffee496b8c in mozilla::CycleCollectedJSContext::PerformMicroTaskCheckPoint(bool) () from /usr/lib64/firefox-113.0/libxul.so\r\n#21 0x00007fffee49728d in mozilla::CycleCollectedJSContext::AfterProcessTask(unsigned int) () from /usr/lib64/firefox-113.0/libxul.so\r\n#22 0x00007fffeeb89319 in XPCJSContext::AfterProcessTask(unsigned int) () from /usr/lib64/firefox-113.0/libxul.so\r\n#23 0x00007fffee54acd2 in nsThread::ProcessNextEvent(bool, bool*) () from /usr/lib64/firefox-113.0/libxul.so\r\n#24 0x00007fffee54f47a in NS_ProcessNextEvent(nsIThread*, bool) () from /usr/lib64/firefox-113.0/libxul.so\r\n#25 0x00007fffeeace4b7 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) () from /usr/lib64/firefox-113.0/libxul.so\r\n#26 0x00007fffeea7ced7 in MessageLoop::Run() () from /usr/lib64/firefox-113.0/libxul.so\r\n#27 0x00007ffff0ff3a13 in nsBaseAppShell::Run() () from /usr/lib64/firefox-113.0/libxul.so\r\n#28 0x00007ffff235b071 in nsAppStartup::Run() () from /usr/lib64/firefox-113.0/libxul.so\r\n#29 0x00007ffff2423062 in XREMain::XRE_mainRun() () from /usr/lib64/firefox-113.0/libxul.so\r\n#30 0x00007ffff24237c7 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) () from /usr/lib64/firefox-113.0/libxul.so\r\n#31 0x00007ffff2423c37 in XRE_main(int, char**, mozilla::BootstrapConfig const&) () from /usr/lib64/firefox-113.0/libxul.so\r\n#32 0x000055555557429c in main ()\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/111507/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/111507/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}