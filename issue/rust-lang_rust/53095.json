{"url": "https://api.github.com/repos/rust-lang/rust/issues/53095", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53095/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53095/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53095/events", "html_url": "https://github.com/rust-lang/rust/issues/53095", "id": 347724145, "node_id": "MDU6SXNzdWUzNDc3MjQxNDU=", "number": 53095, "title": "ICE when using 2018 edition and \"use super::\" imports", "user": {"login": "little-arhat", "id": 240531, "node_id": "MDQ6VXNlcjI0MDUzMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/240531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/little-arhat", "html_url": "https://github.com/little-arhat", "followers_url": "https://api.github.com/users/little-arhat/followers", "following_url": "https://api.github.com/users/little-arhat/following{/other_user}", "gists_url": "https://api.github.com/users/little-arhat/gists{/gist_id}", "starred_url": "https://api.github.com/users/little-arhat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/little-arhat/subscriptions", "organizations_url": "https://api.github.com/users/little-arhat/orgs", "repos_url": "https://api.github.com/users/little-arhat/repos", "events_url": "https://api.github.com/users/little-arhat/events{/privacy}", "received_events_url": "https://api.github.com/users/little-arhat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 930400927, "node_id": "MDU6TGFiZWw5MzA0MDA5Mjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-rust-2018-preview", "name": "A-rust-2018-preview", "color": "f7e101", "default": false, "description": "Area: The 2018 edition preview"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-08-05T19:26:17Z", "updated_at": "2019-08-08T13:40:52Z", "closed_at": "2019-08-08T13:40:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "main.rs:\r\n\r\n```rust\r\nuse rand::random;\r\n\r\nmod ttt;\r\nuse crate::ttt::S;\r\n\r\nfn main() {\r\n    let x: u8 = random();\r\n    let mut b = ttt::it::N::new();\r\n    println!(\"Hello, world!: {}/{}\", x, b.s());\r\n}\r\n```\r\n\r\nttt.rs:\r\n\r\n```rust\r\nuse rand;\r\n\r\npub trait S {\r\n    fn s(&mut self) -> u8;\r\n}\r\n\r\npub mod it {\r\n    use super::rand;\r\n    use rand::random;\r\n\r\n    pub struct N;\r\n    impl N {\r\n        pub fn new() -> N {\r\n            N\r\n        }\r\n    }\r\n\r\n    impl super::S for N {\r\n        fn s(&mut self) -> u8 {\r\n            random() * rand::random()\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nCargo.toml:\r\n```toml\r\ncargo-features = [\"edition\"]\r\n\r\n[package]\r\nname = \"ice2018\"\r\nversion = \"0.1.0\"\r\nauthors = [\"R\"]\r\nedition = \"2018\"\r\n\r\n[dependencies]\r\nrand = \"0.5.4\"\r\n```\r\n\r\n(or check out [example project](https://github.com/little-arhat/rust-ice-edition2018-super))\r\n\r\n```\r\n$ cargo -v build\r\n       Fresh rand_core v0.2.1\r\n       Fresh libc v0.2.42\r\n       Fresh rand v0.5.4\r\n   Compiling ice2018 v0.1.0 (file:///Users/r/stuff/ice2018)\r\n     Running `rustc --edition=2018 --crate-name ice2018 src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=b9709535ec05cf3d -C extra-filename=-b9709535ec05cf3d --out-dir /Users/r/stuff/ice2018/target/debug/deps -C incremental=/Users/r/stuff/ice2018/target/debug/incremental -L dependency=/Users/r/stuff/ice2018/target/debug/deps --extern rand=/Users/r/stuff/ice2018/target/debug/deps/librand-d128365fea08090a.rlib`\r\nthread 'main' panicked at 'index out of bounds: the len is 1 but the index is 1', /Users/travis/build/rust-lang/rust/src/libcore/slice/mod.rs:2049:10\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\nerror: internal compiler error: cat_expr Errd\r\n  --> src/ttt.rs:19:31\r\n   |\r\n19 |           fn s(&mut self) -> u8 {\r\n   |  _______________________________^\r\n20 | |             random() * rand::random()\r\n21 | |         }\r\n   | |_________^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> src/ttt.rs:20:13\r\n   |\r\n20 |             random() * rand::random()\r\n   |             ^^^^^^^^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> src/ttt.rs:20:13\r\n   |\r\n20 |             random() * rand::random()\r\n   |             ^^^^^^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> src/ttt.rs:20:24\r\n   |\r\n20 |             random() * rand::random()\r\n   |                        ^^^^^^^^^^^^^^\r\n\r\nerror: internal compiler error: cat_expr Errd\r\n  --> src/ttt.rs:20:24\r\n   |\r\n20 |             random() * rand::random()\r\n   |                        ^^^^^^^^^^^^\r\n\r\nerror: internal compiler error: QualifyAndPromoteConstants: Mir had errors\r\n  --> src/ttt.rs:19:9\r\n   |\r\n19 | /         fn s(&mut self) -> u8 {\r\n20 | |             random() * rand::random()\r\n21 | |         }\r\n   | |_________^\r\n\r\nerror: internal compiler error: broken MIR in DefId(0/0:15 ~ ice2018[e3cf]::ttt[0]::it[0]::{{impl}}[1]::s[0]) (\"return type\"): bad type [type error]\r\n  --> src/ttt.rs:19:9\r\n   |\r\n19 | /         fn s(&mut self) -> u8 {\r\n20 | |             random() * rand::random()\r\n21 | |         }\r\n   | |_________^\r\n\r\nerror: internal compiler error: broken MIR in DefId(0/0:15 ~ ice2018[e3cf]::ttt[0]::it[0]::{{impl}}[1]::s[0]) (LocalDecl { mutability: Mut, is_user_variable: None, internal: false, ty: [type error], name: None, source_info: SourceInfo { span: src/ttt.rs:19:9: 21:10, scope: scope[0] }, visibility_scope: scope[0] }): bad type [type error]\r\n  --> src/ttt.rs:19:9\r\n   |\r\n19 | /         fn s(&mut self) -> u8 {\r\n20 | |             random() * rand::random()\r\n21 | |         }\r\n   | |_________^\r\n\r\nthread 'main' panicked at 'no errors encountered even though `delay_span_bug` issued', librustc_errors/lib.rs:313:17\r\nstack backtrace:\r\n   0:        0x10bf7896f - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h60992a2468d9b34b\r\n   1:        0x10bf513cd - std::sys_common::backtrace::print::h3d595f8bfd7a6552\r\n   2:        0x10bf81183 - std::panicking::default_hook::{{closure}}::h81129c613607866a\r\n   3:        0x10bf80f0c - std::panicking::default_hook::h6f4c35b82282fcbb\r\n   4:        0x10cd592f8 - rustc::util::common::panic_hook::h8c5d4add166a7821\r\n   5:        0x10bf818c8 - std::panicking::rust_panic_with_hook::h4cd3b1a9170dbff2\r\n   6:        0x10bc1ced7 - std::panicking::begin_panic::h36d08fbb286f451f\r\n   7:        0x10bc17703 - <rustc_errors::Handler as core::ops::drop::Drop>::drop::hd231ad19080becf6\r\n   8:        0x109dfdd45 - core::ptr::drop_in_place::hf8d5766926f6093a\r\n   9:        0x109e0a80e - rustc_driver::run_compiler_with_pool::h27c8606590aa1541\r\n  10:        0x109d67e6a - <scoped_tls::ScopedKey<T>>::set::he1de84e3a4811c35\r\n  11:        0x109dd99d5 - syntax::with_globals::hbcdde4ce11e0b04f\r\n  12:        0x109d671ea - <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once::hfeac9fa871456af8\r\n  13:        0x10bf8d7ce - __rust_maybe_catch_panic\r\n  14:        0x109e06fbe - rustc_driver::run::ha2d70362b8d81965\r\n  15:        0x109e14a6d - rustc_driver::main::hb3d6809f2feb6c31\r\n  16:        0x109cfcdf5 - std::rt::lang_start::{{closure}}::hb69b1e67e5ea982e\r\n  17:        0x10bf81287 - std::panicking::try::do_call::hc60531099b955535\r\n  18:        0x10bf8d7ce - __rust_maybe_catch_panic\r\n  19:        0x10bf61e0c - std::rt::lang_start_internal::h4e7f2b40bed38d65\r\n  20:        0x109cfce5b - main\r\nthread panicked while panicking. aborting.\r\nerror: Could not compile `ice2018`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --edition=2018 --crate-name ice2018 src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=b9709535ec05cf3d -C extra-filename=-b9709535ec05cf3d --out-dir /Users/r/stuff/ice2018/target/debug/deps -C incremental=/Users/r/stuff/ice2018/target/debug/incremental -L dependency=/Users/r/stuff/ice2018/target/debug/deps --extern rand=/Users/r/stuff/ice2018/target/debug/deps/librand-d128365fea08090a.rlib` (signal: 4, SIGILL: illegal instruction)\r\n```\r\n```\r\nrustc --version\r\nrustc 1.30.0-nightly (3edb355b7 2018-08-03)\r\n```\r\n```\r\n$ cargo --version\r\ncargo 1.29.0-nightly (15433e8cc 2018-08-02)\r\n```\r\nCan be [fixed](https://github.com/little-arhat/rust-ice-edition2018-super/compare/master...how-to-fix) by removing \"use\" from ttt enclosing module and using rand directly. \r\n\r\nThis is minimized example, ICE happened in a bigger project with different external crate.", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53095/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53095/timeline", "performed_via_github_app": null, "state_reason": "completed"}