{"url": "https://api.github.com/repos/rust-lang/rust/issues/93003", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93003/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93003/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93003/events", "html_url": "https://github.com/rust-lang/rust/issues/93003", "id": 1105881762, "node_id": "I_kwDOAAsO6M5B6mqi", "number": 93003, "title": "src/test/codegen/thread-local.rs will need an update for LLVM 14 after LLVM commit 4796b4ae7bccc7b75a26b666fbd554c49b274404", "user": {"login": "krasimirgg", "id": 29306214, "node_id": "MDQ6VXNlcjI5MzA2MjE0", "avatar_url": "https://avatars.githubusercontent.com/u/29306214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krasimirgg", "html_url": "https://github.com/krasimirgg", "followers_url": "https://api.github.com/users/krasimirgg/followers", "following_url": "https://api.github.com/users/krasimirgg/following{/other_user}", "gists_url": "https://api.github.com/users/krasimirgg/gists{/gist_id}", "starred_url": "https://api.github.com/users/krasimirgg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krasimirgg/subscriptions", "organizations_url": "https://api.github.com/users/krasimirgg/orgs", "repos_url": "https://api.github.com/users/krasimirgg/repos", "events_url": "https://api.github.com/users/krasimirgg/events{/privacy}", "received_events_url": "https://api.github.com/users/krasimirgg/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-17T13:50:49Z", "updated_at": "2022-01-18T09:58:46Z", "closed_at": "2022-01-18T09:58:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It looks like we will need an update to [src/test/codegen/thread-local.rs](https://github.com/rust-lang/rust/blob/master/src/test/codegen/thread-local.rs) for https://github.com/llvm/llvm-project/commit/4796b4ae7bccc7b75a26b666fbd554c49b274404:\r\nExperimental Rust + HEAD LLVM CI: https://buildkite.com/llvm-project/rust-llvm-integrate-prototype/builds/7674#f06ecb09-6dbc-4c96-a6f7-5e27298aba0c:\r\n\r\n```\r\nstderr:\r\n\u00a0 | ------------------------------------------\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/src/test/codegen/thread-local.rs:22:12: error: CHECK: expected string not found in input\r\n\u00a0 | // CHECK: %0 = load i32, i32* bitcast ({{.*}} [[TLS]] to i32*)\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:13:16: note: scanning from here\r\n\u00a0 | define i32 @get() unnamed_addr #0 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:13:16: note: with \"TLS\" equal to \"@_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE\\\\.0\"\r\n\u00a0 | define i32 @get() unnamed_addr #0 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:15:2: note: possible intended match here\r\n\u00a0 | %0 = load i32, i32* @_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE.0, align 4\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/src/test/codegen/thread-local.rs:30:12: error: CHECK: expected string not found in input\r\n\u00a0 | // CHECK: store i32 %0, i32* bitcast ({{.*}} [[TLS]] to i32*)\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:20:17: note: scanning from here\r\n\u00a0 | define void @set(i32 %0) unnamed_addr #1 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:20:17: note: with \"TLS\" equal to \"@_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE\\\\.0\"\r\n\u00a0 | define void @set(i32 %0) unnamed_addr #1 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | ^\r\n\u00a0 | /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll:22:2: note: possible intended match here\r\n\u00a0 | store i32 %0, i32* @_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE.0, align 4, !alias.scope !2, !noalias !5\r\n\u00a0 | ^\r\n\u00a0 | \u00a0\r\n\u00a0 | Input file: /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/build/x86_64-unknown-linux-gnu/test/codegen/thread-local/thread-local.ll\r\n\u00a0 | Check file: /var/lib/buildkite-agent/builds/rust-llvm-integrate/llvm-project/rust-llvm-integrate-prototype/src/test/codegen/thread-local.rs\r\n\u00a0 | \u00a0\r\n\u00a0 | -dump-input=help explains the following input dump.\r\n\u00a0 | \u00a0\r\n\u00a0 | Input was:\r\n\u00a0 | <<<<<<\r\n\u00a0 | .\r\n\u00a0 | .\r\n\u00a0 | .\r\n\u00a0 | 8:\r\n\u00a0 | 9: @_ZN16thread_local_aux1A7__getit3VAL17hc69ea66037fee9ebE = external thread_local local_unnamed_addr global i64\r\n\u00a0 | 10: @_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE.0 = internal thread_local unnamed_addr global i32 1, align 4\r\n\u00a0 | 11:\r\n\u00a0 | 12: ; Function Attrs: mustprogress nofree norecurse nosync nounwind nonlazybind readonly uwtable willreturn\r\n\u00a0 | 13: define i32 @get() unnamed_addr #0 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | check:22'0                    X~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ error: no match found\r\n\u00a0 | check:22'1                                                                                                                                                                                  with \"TLS\" equal to \"@_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE\\\\.0\"\r\n\u00a0 | 14: start:\r\n\u00a0 | check:22'0     ~~~~~~~\r\n\u00a0 | 15:  %0 = load i32, i32* @_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE.0, align 4\r\n\u00a0 | check:22'0     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\u00a0 | check:22'2      ?                                                                                    possible intended match\r\n\u00a0 | 16:  ret i32 %0\r\n\u00a0 | check:22'0     ~~~~~~~~~~~~\r\n\u00a0 | 17: }\r\n\u00a0 | check:22'0     ~~\r\n\u00a0 | 18:\r\n\u00a0 | check:22'0     ~\r\n\u00a0 | 19: ; Function Attrs: mustprogress nofree nosync nounwind nonlazybind uwtable willreturn\r\n\u00a0 | check:22'0     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\u00a0 | 20: define void @set(i32 %0) unnamed_addr #1 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | check:22'0     ~~~~~~~~~~~~~~~~\r\n\u00a0 | check:30'0                     X~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ error: no match found\r\n\u00a0 | check:30'1                                                                                                                                                                                         with \"TLS\" equal to \"@_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE\\\\.0\"\r\n\u00a0 | 21: start:\r\n\u00a0 | check:30'0     ~~~~~~~\r\n\u00a0 | 22:  store i32 %0, i32* @_ZN12thread_local1A7__getit3VAL17h67524106f022e33dE.0, align 4, !alias.scope !2, !noalias !5\r\n\u00a0 | check:30'0     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\u00a0 | check:30'2      ?                                                                                                                 possible intended match\r\n\u00a0 | 23:  ret void\r\n\u00a0 | check:30'0     ~~~~~~~~~~\r\n\u00a0 | 24: }\r\n\u00a0 | check:30'0     ~~\r\n\u00a0 | 25:\r\n\u00a0 | check:30'0     ~\r\n\u00a0 | 26: ; Function Attrs: mustprogress nofree norecurse nosync nounwind nonlazybind readonly uwtable willreturn\r\n\u00a0 | check:30'0     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n\u00a0 | 27: define i64 @get_aux() unnamed_addr #0 personality i32 (i32, i32, i64, %\"unwind::libunwind::_Unwind_Exception\"*, %\"unwind::libunwind::_Unwind_Context\"*)* @rust_eh_personality {\r\n\u00a0 | check:30'0     ~~~~~~~~~~~~~~~~~~~\r\n\u00a0 | .\r\n\u00a0 | .\r\n\u00a0 | .\r\n\u00a0 | >>>>>>\r\n\u00a0 | \u00a0\r\n\u00a0 | ------------------------------------------\r\n\u00a0 | \u00a0\r\n\u00a0 | \u00a0\r\n\u00a0 | \u00a0\r\n\u00a0 | failures:\r\n\u00a0 | [codegen] codegen/thread-local.rs\r\n\u00a0 | \u00a0\r\n\u00a0 | test result: FAILED. 272 passed; 1 failed; 41 ignored; 0 measured; 0 filtered out; finished in 4.37s\r\n```\r\n\r\n@nikic could you please take a look", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93003/timeline", "performed_via_github_app": null, "state_reason": "completed"}