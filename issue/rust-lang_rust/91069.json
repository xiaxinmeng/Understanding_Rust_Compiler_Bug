{"url": "https://api.github.com/repos/rust-lang/rust/issues/91069", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91069/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91069/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91069/events", "html_url": "https://github.com/rust-lang/rust/issues/91069", "id": 1059043701, "node_id": "I_kwDOAAsO6M4_H7l1", "number": 91069, "title": "ICE: Generic traits of associated types of generic structs", "user": {"login": "djkoloski", "id": 7554649, "node_id": "MDQ6VXNlcjc1NTQ2NDk=", "avatar_url": "https://avatars.githubusercontent.com/u/7554649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/djkoloski", "html_url": "https://github.com/djkoloski", "followers_url": "https://api.github.com/users/djkoloski/followers", "following_url": "https://api.github.com/users/djkoloski/following{/other_user}", "gists_url": "https://api.github.com/users/djkoloski/gists{/gist_id}", "starred_url": "https://api.github.com/users/djkoloski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/djkoloski/subscriptions", "organizations_url": "https://api.github.com/users/djkoloski/orgs", "repos_url": "https://api.github.com/users/djkoloski/repos", "events_url": "https://api.github.com/users/djkoloski/events{/privacy}", "received_events_url": "https://api.github.com/users/djkoloski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-11-20T02:57:40Z", "updated_at": "2022-02-12T14:01:10Z", "closed_at": "2022-02-12T14:01:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Source: https://github.com/rkyv/rkyv/issues/221\r\n\r\n### Code\r\n\r\n`lib.rs`\r\n\r\n```Rust\r\npub trait Associate {\r\n    type Associated;\r\n}\r\n\r\npub struct Wrap<'a> {\r\n    pub field: &'a i32,\r\n}\r\n\r\npub trait Create<T> {\r\n    fn create() -> Self;\r\n}\r\n\r\npub fn oh_no<'a, T>()\r\nwhere\r\n    Wrap<'a>: Associate,\r\n    <Wrap<'a> as Associate>::Associated: Create<T>,\r\n{\r\n    <Wrap<'a> as Associate>::Associated::create();\r\n}\r\n```\r\n\r\nIt is worth noting that this code should not compile.\r\n\r\n### Meta\r\n\r\nThis bug occurs in both beta and nightly.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.56.1 (59eed8a2a 2021-11-01)\r\nbinary: rustc\r\ncommit-hash: 59eed8a2aac0230a8b53e89d4e99d55912ba6b35\r\ncommit-date: 2021-11-01\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.56.1\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror: internal compiler error: compiler\\rustc_traits\\src\\normalize_erasing_regions.rs:54:32: could not fully normalize `<Wrap as Associate>::Associated`\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', compiler\\rustc_errors\\src\\lib.rs:1147:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.1 (59eed8a2a 2021-11-01) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [normalize_generic_arg_after_erasing_regions] normalizing `<Wrap as Associate>::Associated`\r\n#1 [mir_drops_elaborated_and_const_checked] elaborating drops for `oh_no`\r\nend of query stack\r\nerror: could not compile `erase_repro`\r\n```\r\n\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nerror: internal compiler error: compiler\\rustc_traits\\src\\normalize_erasing_regions.rs:54:32: could not fully normalize `<Wrap as Associate>::Associated`\r\n\r\nthread 'rustc' panicked at 'Box<dyn Any>', compiler\\rustc_errors\\src\\lib.rs:1147:9\r\nstack backtrace:\r\n   0:     0x7ffea42c7a9e - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h90fc78c6027cfe27\r\n   1:     0x7ffea42f268a - core::fmt::write::h8afcb1031f89d60b\r\n   2:     0x7ffea42bae08 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::hb4b34c43836aedaf\r\n   3:     0x7ffea42cb586 - std::panicking::take_hook::h8b2fe3f8f4cf4b43\r\n   4:     0x7ffea42cb074 - std::panicking::take_hook::h8b2fe3f8f4cf4b43\r\n   5:     0x7ffea486a525 - <serde_json::value::WriterFormatter as std::io::Write>::flush::hc1d196eaca04d7a8\r\n   6:     0x7ffea42cbe99 - std::panicking::rust_panic_with_hook::h844a8dc19bbe524e\r\n   7:     0x7ffea8e82430 - rustc_errors::diagnostic_builder::DiagnosticBuilder::code::h1645263d95f3b09a\r\n   8:     0x7ffea8e823e9 - rustc_errors::diagnostic_builder::DiagnosticBuilder::code::h1645263d95f3b09a\r\n   9:     0x7ffea9157ad1 - rustc_query_system::query::job::report_cycle::h12a555504324913c\r\n  10:     0x7ffea8eb3080 - <rustc_errors::json::Diagnostic::from_errors_diagnostic::BufWriter as std::io::Write>::flush::hf0501cbec5358cf0\r\n  11:     0x7ffea8ebad75 - rustc_errors::HandlerInner::emit_diagnostic::h728ec3ea46d2ed21\r\n  12:     0x7ffea8eb8822 - rustc_errors::Handler::bug::h011b35fa3752efe1\r\n  13:     0x7ffea8ba1ad7 - rustc_middle::ty::structural_impls::<impl core::fmt::Debug for rustc_middle::ty::closure::UpvarBorrow>::fmt::ha3dccab8f654b6b0\r\n  14:     0x7ffea8b9fd90 - rustc_middle::ty::consts::valtree::ValTree::zst::hb53ec78846c4e3d7\r\n  15:     0x7ffea8b9fd33 - rustc_middle::ty::consts::valtree::ValTree::zst::hb53ec78846c4e3d7\r\n  16:     0x7ffea8ba1a09 - rustc_middle::ty::structural_impls::<impl core::fmt::Debug for rustc_middle::ty::closure::UpvarBorrow>::fmt::ha3dccab8f654b6b0\r\n  17:     0x7ffea914e197 - rustc_middle::util::bug::bug_fmt::hb871ea62c9ba791a\r\n  18:     0x7ffea7abf034 - <&chalk_ir::GenericArg<rustc_middle::traits::chalk::RustInterner> as rustc_traits::chalk::lowering::LowerInto<rustc_middle::ty::subst::GenericArg>>::lower_into::hac3acef454f06bed\r\n  19:     0x7ffea7b9e463 - <rustc_traits::chalk::db::RustIrDatabase as chalk_ir::UnificationDatabase<rustc_middle::traits::chalk::RustInterner>>::adt_variance::he39df3eff3cd9e56\r\n  20:     0x7ffea7ff8d0f - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  21:     0x7ffea7fa23e3 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  22:     0x7ffea80d6f9f - rustc_metadata::rmeta::decoder::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_metadata::rmeta::decoder::DecodeContext>::error::h95b02aeeaf1dc4be   \r\n  23:     0x7ffea7c80a96 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  24:     0x7ffea8051deb - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  25:     0x7ffea8c6e181 - rustc_middle::ty::flags::FlagComputation::for_unevaluated_const::hf9370068502c458d\r\n  26:     0x7ffea8c6e3f6 - <rustc_middle::ty::normalize_erasing_regions::NormalizeAfterErasingRegionsFolder as rustc_middle::ty::fold::TypeFolder>::fold_ty::h97ea4149e1d91295\r\n  27:     0x7ffea78bddcb - <rustc_mir::transform::dest_prop::CandidateAssignment as core::fmt::Debug>::fmt::h90783a921d19b6b1\r\n  28:     0x7ffea790e94c - rustc_mir::dataflow::drop_flag_effects::on_all_children_bits::is_terminal_path::h8bbacca9de22ebf2\r\n  29:     0x7ffea763202d - <rustc_mir::transform::elaborate_drops::ElaborateDrops as rustc_mir::transform::MirPass>::run_pass::h2d10c480fb5efb89\r\n  30:     0x7ffea75d1033 - rustc_mir::transform::run_passes::h183bcfaf18b69333\r\n  31:     0x7ffea75da478 - rustc_mir::transform::run_passes::h183bcfaf18b69333\r\n  32:     0x7ffea75d9b00 - rustc_mir::transform::run_passes::h183bcfaf18b69333\r\n  33:     0x7ffea7ff8eaf - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  34:     0x7ffea7fa5623 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  35:     0x7ffea80d801d - rustc_metadata::rmeta::decoder::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_metadata::rmeta::decoder::DecodeContext>::error::h95b02aeeaf1dc4be   \r\n  36:     0x7ffea7cd468a - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  37:     0x7ffea8046d59 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  38:     0x7ffea75dafe9 - rustc_mir::transform::run_passes::h183bcfaf18b69333\r\n  39:     0x7ffea7ff38ef - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  40:     0x7ffea7f92511 - <rustc_span::def_id::DefIndex as rustc_query_impl::profiling_support::SpecIntoSelfProfilingString>::spec_to_self_profile_string::hbb4b4890437407bc\r\n  41:     0x7ffea80d34de - rustc_metadata::rmeta::decoder::__ty_decoder_impl::<impl rustc_serialize::serialize::Decoder for rustc_metadata::rmeta::decoder::DecodeContext>::error::h95b02aeeaf1dc4be   \r\n  42:     0x7ffea7da1403 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  43:     0x7ffea7cbaf39 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  44:     0x7ffea8047200 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  45:     0x7ffea8371ec9 - <rustc_metadata::rmeta::encoder::EncodeContext as rustc_middle::ty::codec::TyEncoder>::encode_alloc_id::h1def24179fdbee6d\r\n  46:     0x7ffea838f396 - <rustc_metadata::rmeta::encoder::ImplVisitor as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_item::h69098d911b1ad348\r\n  47:     0x7ffea83f1505 - <rustc_metadata::rmeta::decoder::DecodeContext as rustc_middle::ty::codec::TyDecoder>::decode_alloc_id::h7b90eba30f514af9\r\n  48:     0x7ffea84cbcf2 - rustc_metadata::rmeta::decoder::cstore_impl::<impl rustc_middle::middle::cstore::CrateStore for rustc_metadata::creader::CStore>::encode_metadata::h7bc78bca2f8068cf        \r\n  49:     0x7ffea8bebaa4 - rustc_middle::ty::context::TyCtxt::encode_metadata::h5ddfe09d2e3d95b9\r\n  50:     0x7ffea49b3c8c - rustc_interface::queries::Queries::ongoing_codegen::h81f3e17d2f79ca80\r\n  51:     0x7ffea48bf413 - regex_syntax::hir::Error::pattern::h26de5cae1e560f3c\r\n  52:     0x7ffea48897b5 - rustc_driver::pretty::print_after_hir_lowering::h8daab7168b9a121b\r\n  53:     0x7ffea48c14c7 - regex_syntax::hir::Error::pattern::h26de5cae1e560f3c\r\n  54:     0x7ffea488dfc0 - <tracing_subscriber::util::TryInitError as core::fmt::Display>::fmt::h6e9774f2c0dd7eb3\r\n  55:     0x7ffea488a248 - rustc_driver::pretty::print_after_hir_lowering::h8daab7168b9a121b\r\n  56:     0x7ffea487e67d - <rustc_driver::Compilation as core::fmt::Debug>::fmt::ha388fa55e25fcec9\r\n  57:     0x7ffea42da1cc - std::sys::windows::thread::Thread::new::h5ab92c811b2297f5\r\n  58:     0x7fff0f967034 - BaseThreadInitThunk\r\n  59:     0x7fff10822651 - RtlUserThreadStart\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.1 (59eed8a2a 2021-11-01) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [normalize_generic_arg_after_erasing_regions] normalizing `<Wrap as Associate>::Associated`\r\n#1 [mir_drops_elaborated_and_const_checked] elaborating drops for `oh_no`\r\n#2 [optimized_mir] optimizing MIR for `oh_no`\r\nend of query stack\r\nerror: could not compile `erase_repro`\r\n```\r\n\r\n</p>\r\n</details>", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91069/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91069/timeline", "performed_via_github_app": null, "state_reason": "completed"}