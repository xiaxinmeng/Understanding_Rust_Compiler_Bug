{"url": "https://api.github.com/repos/rust-lang/rust/issues/92165", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92165/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92165/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92165/events", "html_url": "https://github.com/rust-lang/rust/issues/92165", "id": 1085977628, "node_id": "I_kwDOAAsO6M5AurQc", "number": 92165, "title": "Make sure dead function stubs are always included in the final binary", "user": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 2483744621, "node_id": "MDU6TGFiZWwyNDgzNzQ0NjIx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-code-coverage", "name": "A-code-coverage", "color": "f7e101", "default": false, "description": "Area: Source-based code coverage (-Cinstrument-coverage)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-21T15:55:50Z", "updated_at": "2021-12-21T15:55:50Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Currently, when generating dead function stubs for code coverage, we pick a CGU to put them in by looking for exported symbols which makes it more likely the linker will pull the CGU's object file into the final assembly. However, if the linker doesn't actually need any of the exported symbols in the object file, it won't include it in the final assembly. This matters for code coverage because without the dead function stubs being included in the final binary, the code coverage tools won't know about these functions and it will artificially inflate coverage numbers. \r\n\r\nIn order to truly resolve this, we need to make sure the object file (CGU) containing the dead function stubs is included in the final binary. This will probably require forcing these function symbols to be included via `-u` or `/include` linker args.\r\n\r\n(Created based on discussions in #92142)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92165/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92165/timeline", "performed_via_github_app": null, "state_reason": null}