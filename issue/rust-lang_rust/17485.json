{"url": "https://api.github.com/repos/rust-lang/rust/issues/17485", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/17485/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/17485/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/17485/events", "html_url": "https://github.com/rust-lang/rust/issues/17485", "id": 43670870, "node_id": "MDU6SXNzdWU0MzY3MDg3MA==", "number": 17485, "title": "Assertion failure when locking a mutex in a c thread (linux)", "user": {"login": "blastrock", "id": 1370530, "node_id": "MDQ6VXNlcjEzNzA1MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1370530?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blastrock", "html_url": "https://github.com/blastrock", "followers_url": "https://api.github.com/users/blastrock/followers", "following_url": "https://api.github.com/users/blastrock/following{/other_user}", "gists_url": "https://api.github.com/users/blastrock/gists{/gist_id}", "starred_url": "https://api.github.com/users/blastrock/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blastrock/subscriptions", "organizations_url": "https://api.github.com/users/blastrock/orgs", "repos_url": "https://api.github.com/users/blastrock/repos", "events_url": "https://api.github.com/users/blastrock/events{/privacy}", "received_events_url": "https://api.github.com/users/blastrock/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2014-09-23T19:14:20Z", "updated_at": "2014-10-22T19:19:49Z", "closed_at": "2014-10-21T22:47:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\n\nI get an assertion failure when I try to lock a mutex from a thread created from C++ (I think it is reproducible with c). I made a minimal example here: https://github.com/blastrock/rustcrash\n\nUncompress the archive and type \"make run\". On my machine it finishes with:\n\n```\nfatal runtime error:  assertion failed: !ptr.is_null()\nIllegal instruction \n```\n\nEDIT: Here is the stack trace:\n\n``` gdb\n(gdb) bt\n#0  0x00005555555c39c5 in util::abort::hf673a6fea37897c4eEa ()\n#1  0x00005555555bff79 in local_ptr::compiled::take::h12674065722481156391 ()\n#2  0x00005555555c3006 in lock::failing::h8c52553afcb2a61cC7e ()\n#3  0x00005555555c326a in lock::PoisonOnFail$LT$$x27a$GT$::new::hcfbb39080c770903y9e ()\n#4  0x000055555555c37e in lock::Mutex$LT$T$GT$::lock::h9394655342227765001 ()\n#5  0x000055555555c21b in callback::__rust_abi ()\n#6  0x000055555555c1a3 in callback::h9d49d629a3b51de4faa ()\n#7  0x00007ffff7bd8238 in trigger_callback () from ./liblib.so\n#8  0x00007ffff7bd9699 in void std::_Bind_simple<void (*())()>::_M_invoke<>(std::_Index_tuple<>) () from ./liblib.so\n#9  0x00007ffff7bd95e1 in std::_Bind_simple<void (*())()>::operator()() () from ./liblib.so\n#10 0x00007ffff7bd955e in std::thread::_Impl<std::_Bind_simple<void (*())()> >::_M_run() () from ./liblib.so\n#11 0x00007ffff6c9b8a0 in ?? () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#12 0x00007ffff77b70a4 in start_thread (arg=0x7ffff5fff700) at pthread_create.c:309\n#13 0x00007ffff72d6c2d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n```\n", "closed_by": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/17485/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/17485/timeline", "performed_via_github_app": null, "state_reason": "completed"}