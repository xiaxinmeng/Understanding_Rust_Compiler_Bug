{"url": "https://api.github.com/repos/rust-lang/rust/issues/60512", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60512/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60512/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60512/events", "html_url": "https://github.com/rust-lang/rust/issues/60512", "id": 440128501, "node_id": "MDU6SXNzdWU0NDAxMjg1MDE=", "number": 60512, "title": "undefined symbols when building RLS with monolithic lto", "user": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 632925329, "node_id": "MDU6TGFiZWw2MzI5MjUzMjk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-rls", "name": "A-rls", "color": "f7e101", "default": false, "description": "Area: Rust Language Server (RLS)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-05-03T16:42:49Z", "updated_at": "2022-10-22T17:12:50Z", "closed_at": "2022-10-22T17:12:50Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "````\r\nrustc 1.36.0-nightly (08bfe1612 2019-05-02)\r\nbinary: rustc\r\ncommit-hash: 08bfe16129b0621bc90184f8704523d4929695ef\r\ncommit-date: 2019-05-02\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.36.0-nightly\r\nLLVM version: 8.0\r\n````\r\n````\r\nld -V\r\nLLD 8.0.0 (compatible with GNU linkers)\r\n````\r\n\r\nrepro recipe:\r\n````bash\r\ngit clone https://github.com/rust-lang/rls\r\ncd rls\r\ngit checkout 5b8e99bb61958ca8abcb7c5eda70521726be1065\r\n# update clippy hash to something that builds with nightly\r\nsed -i s/86f73473c8de4598f8ade982dbb9d44f89777c54/8b906f94f38ba07c88e4d19bcc210e655ea4690c/g Cargo.toml\r\n\r\necho \"\r\n[profile.release]\r\ncodegen-units=1\r\nlto=true\r\nincremental=false\r\n\" >> Cargo.toml\r\n\r\n# now build\r\nRUSTC_WRAPPER=\"\" CC=clang CXX=clang++ cargo build --release\r\n````\r\n\r\nI get a consistent failure when rls is being linked (`rls(bin)` target):\r\n````\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o\" \"-o\" \"/tmp/rls/target/release/deps/rls-ba4d500887f8de87\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-Wl,-O1\" \"-nodefaultlibs\" \"-L\" \"/tmp/rls/target/release/deps\" \"-L\" \"/usr/lib\" \"-L\" \"/tmp/rls/target/release/build/libnghttp2-sys-0f04fb532114fad5/out/i/lib\" \"-L\" \"/usr/lib\" \"-L\" \"/tmp/rls/target/release/build/backtrace-sys-cf3460a06886ef3c/out\" \"-L\" \"/tmp/rls/target/release/build/miniz-sys-1d4d53619e322b48/out\" \"-L\" \"/tmp/rls/target/release/build/libgit2-sys-daaa5ad22adabe20/out/build\" \"-L\" \"/tmp/rls/target/release/build/libssh2-sys-49bf77cb5186e542/out/build\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"/tmp/rustcLKMchW/liblibgit2_sys-cb3a420202939a71.rlib\" \"/tmp/rustcLKMchW/liblibssh2_sys-6d20dddaf5e0bee8.rlib\" \"/tmp/rustcLKMchW/libbacktrace_sys-eb137ff19bd49a0f.rlib\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-Bdynamic\" \"-lrustc_driver-ab87e144efaf1bfb\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_interface-e523d8bc6d1a71dd\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_lint-406896c30d5792b8\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_traits-9831ff74d5a84b6a\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_resolve-d6daf0c179a21db1\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_privacy-eef1e72803f525a7\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_typeck-8db033267002a62a\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_plugin-46c05f6b007b7fc7\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_passes-8a783de766a05ee1\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_codegen_ssa-703a1ab99d88c3a1\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_incremental-09e062210db4d0ba\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_borrowck-3d89ea28161ea8c8\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_allocator-d9e56deb19cb05f3\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_save_analysis-63a288bc25e262df\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_codegen_utils-4eb712ba0bb9ff43\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_metadata-c63a54a86b2c1562\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lsyntax_ext-607073418881a6e4\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_mir-844f5a506dadef9d\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc-dcf913ba5a82007d\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lfmt_macros-0e2f62334f416b9d\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_fs_util-07747c0f38ac2e32\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-ltest-c02b8c6109afc6a9\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lterm-2d3648ceb62fb072\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lsyntax-1aed74c92580ce1f\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_target-b32ea452accd0cee\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_errors-8025ed724b843ec4\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lsyntax_pos-b1325962bf0e89f9\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-larena-87ca284af2d62ecf\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_data_structures-115e2e04c93a72ef\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lgraphviz-147bd138db70bf47\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lrustc_cratesio_shim-b78fc3a2ff7eb61c\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lserialize-0bb962434df8d7b6\" \"-Wl,--start-group\" \"-L\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lstd-05a9f6439240b186\" \"-Wl,--end-group\" \"-Wl,-Bstatic\" \"/home/matthias/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-18eba06bdd703a61.rlib\" \"-Wl,-Bdynamic\" \"-lssl\" \"-lcrypto\" \"-lz\" \"-lcurl\" \"-lutil\" \"-lutil\" \"-lutil\" \"-lutil\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\"\r\n  = note: ld: error: undefined symbol: _$LT$log..LevelFilter$u20$as$u20$core..str..FromStr$GT$::from_str::h4ba3a224946c4fc6\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: _$LT$log..LevelFilter$u20$as$u20$core..str..FromStr$GT$::from_str::h4ba3a224946c4fc6\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::set_boxed_logger::h96b9a73ce32eb5f3\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::main_inner::h7904eb8062914920)\r\n\r\n          ld: error: undefined symbol: log::MAX_LOG_LEVEL_FILTER::hc2240f384a301ec4\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::actions::diagnostics::parse_diagnostics::hccaa93f28f5b5707)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::actions::diagnostics::parse_diagnostics::hccaa93f28f5b5707)\r\n\r\n          ld: error: undefined symbol: log::__private_api_log::h5c41cf350a1e4b8b\r\n          >>> referenced by rls.d9czc8ig-cgu.0\r\n          >>>               /tmp/rls/target/release/deps/rls-ba4d500887f8de87.rls.d9czc8ig-cgu.0.rcgu.o:(rls::actions::diagnostics::parse_diagnostics::hccaa93f28f5b5707)\r\n\r\n          ld: error: too many errors emitted, stopping now (use -error-limit=0 to see all errors)\r\n          collect2: error: ld returned 1 exit status\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `rls`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n````", "closed_by": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60512/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60512/timeline", "performed_via_github_app": null, "state_reason": "completed"}