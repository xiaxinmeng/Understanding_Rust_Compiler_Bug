{"url": "https://api.github.com/repos/rust-lang/rust/issues/51647", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51647/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51647/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51647/events", "html_url": "https://github.com/rust-lang/rust/issues/51647", "id": 333890191, "node_id": "MDU6SXNzdWUzMzM4OTAxOTE=", "number": 51647, "title": "undefined reference to 'rust_begin_unwind': {start,end}-group missing when using an allocator", "user": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-06-20T01:08:27Z", "updated_at": "2018-08-28T19:36:41Z", "closed_at": "2018-08-28T19:36:41Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### STR\r\n\r\n``` console\r\n$ cargo clone cortex-m-quickstart --vers 0.3.2\r\n\r\n$ cd cortex-m-quickstart\r\n\r\n$ cat > memory.x <<EOF\r\n/* Linker script for the STM32F103C8T6 */\r\nMEMORY\r\n{\r\n  FLASH : ORIGIN = 0x08000000, LENGTH = 64K\r\n  RAM : ORIGIN = 0x20000000, LENGTH = 20K\r\n}\r\nEOF\r\n\r\n$ # OK, doesn't use an allocator\r\n$ # NOTE depends on arm-none-eabi-gcc being installed\r\n$ cargo build --example hello --target thumbv7m-none-eabi\r\n\r\n$ cargo add alloc-cortex-m --vers 0.3.5\r\n\r\n$ # fails to link\r\n$ cargo build --example allocator --target thumbv7m-none-eabi\r\n  = note: \"arm-none-eabi-gcc\" (..)\r\n  = note: $_/libcore-c8a4409079a3a8cf.rlib(core-c8a4409079a3a8cf.core7-a6f8712c77d6e222f682a36ad1b2802c.rs.rcgu.o): In function `core::panicking::panic_fmt':\r\n          /checkout/src/libcore/panicking.rs:92: undefined reference to `rust_begin_unwind'\r\n```\r\n\r\nAFAICT the issue is that the linker call in the allocator example doesn't include the -Wl,--{start,end}-group flags added in #49316. Linker invocation for each example is shown below:\r\n\r\n<details>\r\n$ cargo rustc --example hello --target thumbv7m-none-eabi -- -Z print-link-args\r\n\"arm-none-eabi-gcc\"\r\n\"-L\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9.16u6js6g0l3k1ic6.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9.3l0398fjltevyo2h.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9.4xq48u46a1pwiqn7.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9.544l4wfz89vbhoea.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9.8xzrsc1ux72v29j.rcgu.o\"\r\n\"-o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/hello-7bcb38c76f2cfcf9\"\r\n\"-Wl,--gc-sections\"\r\n\"-nodefaultlibs\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/debug/deps\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-quickstart-83c2769bb84a5327/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-91d6bcd8221521d0/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-rt-8f472c01bb62b44f/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-rt-8f472c01bb62b44f/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-semihosting-0b565ca91223cdc9/out\"\r\n\"-L\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib\"\r\n\"-Wl,--start-group\"\r\n\"-Wl,-Bstatic\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libpanic_semihosting-5bedc9c7e9038e5a.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m-608790ed92cdaba8.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libvolatile_register-febb9ecda2e1e875.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libvcell-5f0330b175b9171f.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libbare_metal-cd38b616da4ad7a9.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libaligned-65d7a0374e7cc15f.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m_semihosting-2b99179dc7319028.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m_rt-df2a73939030a238.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libr0-0230fc14e4aa7a0c.rlib\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib/libcore-c8a4409079a3a8cf.rlib\"\r\n\"-Wl,--end-group\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib/libcompiler_builtins-a0b503090929f0e3.rlib\"\r\n\"-Wl,-Tlink.x\"\r\n\"-nostartfiles\"\r\n\"-Wl,-Bdynamic\"\r\n\r\n$ cargo build --example allocator --target thumbv7m-none-eabi\r\n\"arm-none-eabi-gcc\"\r\n\"-L\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.12o6z8zowpxdwec2.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.16u6js6g0l3k1ic6.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.181cuta0v63atwcm.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.1im38lueib99jsk0.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.1mvmz58owquyropc.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.1y16o1qfye96o7m0.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.2lyh15q6cjwzy18c.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.2njzq1xnlu88l3yx.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.2oafmlh5ijbov6fd.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.3ayaeypdcro9d6yk.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.3l0398fjltevyo2h.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.48721dc4k5qxei0u.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.49a7n47po4ttqjl7.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.4ezmh1vbs95c5ack.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.4kcm5l1y0r3i2da7.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.4xq48u46a1pwiqn7.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.4yh8x2b62dcih00t.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.51s1w397y42gpez1.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.56dly8q07ws8ucdq.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.8xzrsc1ux72v29j.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.9elsx31vb4it187.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.9fcb3syd3ne5k0n.rcgu.o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.y08g5q2x813c4wx.rcgu.o\"\r\n\"-o\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/examples/allocator-d041c1c8fc06f1f7.crate.allocator.rcgu.o\"\r\n\"-Wl,--gc-sections\"\r\n\"-nodefaultlibs\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/debug/deps\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-quickstart-83c2769bb84a5327/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-91d6bcd8221521d0/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-rt-8f472c01bb62b44f/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-rt-8f472c01bb62b44f/out\"\r\n\"-L\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/build/cortex-m-semihosting-0b565ca91223cdc9/out\"\r\n\"-L\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib\"\r\n\"-Wl,-Bstatic\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libpanic_semihosting-5bedc9c7e9038e5a.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m_semihosting-2b99179dc7319028.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m_rt-df2a73939030a238.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libr0-0230fc14e4aa7a0c.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m-608790ed92cdaba8.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libvolatile_register-febb9ecda2e1e875.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libvcell-5f0330b175b9171f.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libbare_metal-cd38b616da4ad7a9.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libaligned-65d7a0374e7cc15f.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/liballoc_cortex_m-1dc8f624614f3e20.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/liblinked_list_allocator-89856fc389dfa7e0.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libcortex_m-d4954d2588102c99.rlib\"\r\n\"/home/japaric/tmp/cortex-m-quickstart/target/thumbv7m-none-eabi/debug/deps/libvolatile_register-7f8b6601fedcc83f.rlib\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib/liballoc-0cbd0a7c85435046.rlib\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib/libcore-c8a4409079a3a8cf.rlib\"\r\n\"/home/japaric/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/thumbv7m-none-eabi/lib/libcompiler_builtins-a0b503090929f0e3.rlib\"\r\n\"-Wl,-Tlink.x\"\r\n\"-nostartfiles\"\r\n\"-Wl,-Bdynamic\"\r\n</details>\r\n\r\nAdding `-Wl,--{start,end}-group` to the linker invocation for the allocator example fixes the linking error.\r\n\r\nI believe this error started showing up after #50144 landed.\r\n\r\n### Meta\r\n\r\n``` console\r\n$ rustc -V\r\nrustc 1.28.0-nightly (523097979 2018-06-18)\r\n```\r\n\r\ncc @alexcrichton @sfackler ", "closed_by": {"login": "japaric", "id": 5018213, "node_id": "MDQ6VXNlcjUwMTgyMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5018213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/japaric", "html_url": "https://github.com/japaric", "followers_url": "https://api.github.com/users/japaric/followers", "following_url": "https://api.github.com/users/japaric/following{/other_user}", "gists_url": "https://api.github.com/users/japaric/gists{/gist_id}", "starred_url": "https://api.github.com/users/japaric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/japaric/subscriptions", "organizations_url": "https://api.github.com/users/japaric/orgs", "repos_url": "https://api.github.com/users/japaric/repos", "events_url": "https://api.github.com/users/japaric/events{/privacy}", "received_events_url": "https://api.github.com/users/japaric/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51647/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51647/timeline", "performed_via_github_app": null, "state_reason": "completed"}