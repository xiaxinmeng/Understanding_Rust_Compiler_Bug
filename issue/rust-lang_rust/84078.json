{"url": "https://api.github.com/repos/rust-lang/rust/issues/84078", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84078/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84078/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84078/events", "html_url": "https://github.com/rust-lang/rust/issues/84078", "id": 855192037, "node_id": "MDU6SXNzdWU4NTUxOTIwMzc=", "number": 84078, "title": "Deleting enum variant unexpectedly changes behavior in match statement", "user": {"login": "jmikkola", "id": 200415, "node_id": "MDQ6VXNlcjIwMDQxNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/200415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmikkola", "html_url": "https://github.com/jmikkola", "followers_url": "https://api.github.com/users/jmikkola/followers", "following_url": "https://api.github.com/users/jmikkola/following{/other_user}", "gists_url": "https://api.github.com/users/jmikkola/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmikkola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmikkola/subscriptions", "organizations_url": "https://api.github.com/users/jmikkola/orgs", "repos_url": "https://api.github.com/users/jmikkola/repos", "events_url": "https://api.github.com/users/jmikkola/events{/privacy}", "received_events_url": "https://api.github.com/users/jmikkola/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-04-11T01:07:42Z", "updated_at": "2021-04-13T19:04:14Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nThis came up when I was deleting some variants of a rather large enum. The variants were never used (indeed, the compiler warned me that they were unused), so deleting them should be safe. Much to my surprise, this caused test failures. \r\n\r\nUpon closer inspection, it turned out that although my code never _created_ those enum values, it did _match_ them in a `match` statement (which I had not cleaned up). This caused the reference to that variant in the pattern to turn into a variable, which matched everything.\r\n\r\nHere's a simplified example where `B` represents the enum variant[s] deleted.\r\n\r\n**I tried this code:**\r\n\r\n[playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=de11b31273e177377cc31a2466b669e9)\r\n\r\n```rust\r\nenum MyEnum {\r\n    A,\r\n    // B, // the assertion below works if B is uncommented\r\n    C,\r\n}\r\n\r\nfn to_int(my_enum: MyEnum) -> i32 {\r\n    use MyEnum::*;\r\n    match my_enum {\r\n        A => 1,\r\n        B => 2,\r\n        C => 3,\r\n    }\r\n}\r\n\r\nfn main() {\r\n    assert_eq!(3, to_int(MyEnum::C));\r\n}\r\n```\r\n\r\n**I expected to see this happen:**\r\n\r\nWhen removing the variant `B` of the enum, I expected the match statement to fail to compile because it still referenced `B`.\r\n\r\n**Instead, this happened:**\r\n\r\nIt compiled with a warning that the `C` variant is unreachable because `B` matches any pattern.\r\n\r\n----\r\n\r\nThis feels like Rust behaving correctly according to the indented behavior, but the intended behavior is confusing. \r\n\r\nI'm not sure if there is anything useful that could be done about this (perhaps disallow capitalized variables in patterns? or replace the warning with an error?).\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84078/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84078/timeline", "performed_via_github_app": null, "state_reason": null}