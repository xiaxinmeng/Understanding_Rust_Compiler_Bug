{"url": "https://api.github.com/repos/rust-lang/rust/issues/107035", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107035/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107035/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107035/events", "html_url": "https://github.com/rust-lang/rust/issues/107035", "id": 1538131747, "node_id": "I_kwDOAAsO6M5brgcj", "number": 107035, "title": "Debug escaping is confusingly inconsistent", "user": {"login": "dfoxfranke", "id": 4708206, "node_id": "MDQ6VXNlcjQ3MDgyMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/4708206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfoxfranke", "html_url": "https://github.com/dfoxfranke", "followers_url": "https://api.github.com/users/dfoxfranke/followers", "following_url": "https://api.github.com/users/dfoxfranke/following{/other_user}", "gists_url": "https://api.github.com/users/dfoxfranke/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfoxfranke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfoxfranke/subscriptions", "organizations_url": "https://api.github.com/users/dfoxfranke/orgs", "repos_url": "https://api.github.com/users/dfoxfranke/repos", "events_url": "https://api.github.com/users/dfoxfranke/events{/privacy}", "received_events_url": "https://api.github.com/users/dfoxfranke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-01-18T14:51:14Z", "updated_at": "2023-03-27T15:19:51Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "The behaviors of `char::escape_debug`, `str::escape_debug`, and `<str as Debug>::fmt` are confusingly inconsistent with each other, and the inconsistencies are poorly documented.\r\n\r\n```rust\r\nfn main() {\r\n    let wat = \"a\\u{301}'\";\r\n\r\n    println!(\"{:?}\", wat);\r\n    println!(\"\\\"{}\\\"\", wat.escape_debug());\r\n    println!(\r\n        \"\\\"{}\\\"\",\r\n        wat.chars()\r\n            .flat_map(|ch| ch.escape_debug())\r\n            .collect::<String>()\r\n    );\r\n}\r\n```\r\n\r\n```\r\n\"a\\u{301}'\"\r\n\"a\u0301\\'\"\r\n\"a\\u{301}\\'\"\r\n```\r\n\r\nIt seems defensible that `char::escape_debug` escapes single-quotes while `<str as Debug>::fmt` doesn't, since `char_escape_debug` doesn't know whether it's being used to escape a character literal or a string literal. But if a difference is going to exist, it's less defensible that `str::escape_debug` should follow the behavior of `char::escape_debug` rather than the behavior of `<str as Debug>::fmt`.\r\n\r\n`str::escape_debug` and `<str as Debug>::fmt`'s differing behavior on grapheme extenders makes no sense at all. Furthermore, if the escaping of grapheme extenders is going to be position-dependent (a bad idea IMO), then the rule should be that they are unescaped only if they are preceded by an unescaped character. The current rule gives absurd results in cases like\r\n\r\n```rust\r\nfn main() {\r\n    println!(\"{}\", \"\\u{301}\\u{301}\".escape_debug());\r\n}\r\n```\r\n\r\n```\r\n\\u{301}\u0301\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107035/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107035/timeline", "performed_via_github_app": null, "state_reason": null}