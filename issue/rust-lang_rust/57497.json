{"url": "https://api.github.com/repos/rust-lang/rust/issues/57497", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57497/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57497/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57497/events", "html_url": "https://github.com/rust-lang/rust/issues/57497", "id": 397999050, "node_id": "MDU6SXNzdWUzOTc5OTkwNTA=", "number": 57497, "title": "Rust binaries require a too recent glibc", "user": {"login": "konstin", "id": 6826232, "node_id": "MDQ6VXNlcjY4MjYyMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/6826232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/konstin", "html_url": "https://github.com/konstin", "followers_url": "https://api.github.com/users/konstin/followers", "following_url": "https://api.github.com/users/konstin/following{/other_user}", "gists_url": "https://api.github.com/users/konstin/gists{/gist_id}", "starred_url": "https://api.github.com/users/konstin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/konstin/subscriptions", "organizations_url": "https://api.github.com/users/konstin/orgs", "repos_url": "https://api.github.com/users/konstin/repos", "events_url": "https://api.github.com/users/konstin/events{/privacy}", "received_events_url": "https://api.github.com/users/konstin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2019-01-10T20:22:01Z", "updated_at": "2021-09-01T07:05:51Z", "closed_at": "2019-01-17T21:17:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "When rustc builds on a system with a recent glibc version, the binaries require a recent glibc version (2.18). When built on an old system however, they will only require glibc 2.3.\r\n\r\nTo reproduce we can use a simple hello world example, building e.g. on Ubuntu 18.04:\r\n\r\n```\r\ncargo new hello-world\r\ncd hello-world\r\ncargo build --release\r\n```\r\n\r\nLet's look at the required symbols, filtering out glibc 2.2 and 2.3:\r\n\r\n```\r\n$ readelf -Ws target/release/hello-world | grep GLIBC | grep -v GLIBC_2.[23]\r\n    11: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_thread_atexit_impl@GLIBC_2.18 (5)\r\n    47: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND memcpy@GLIBC_2.14 (12)\r\n   537: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_thread_atexit_impl@@GLIBC_2.18\r\n   644: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND memcpy@@GLIBC_2.14\r\n```\r\n\r\nWe see that 2.14 and 2.18 seem to be used. We can confirm that those symbols are indeed required using a cent os 5 docker container:\r\n\r\n```\r\n$ docker run --rm -v $(pwd)/target:/root/target -it quay.io/pypa/manylinux1_x86_64 /root/target/release/hello-world\r\n/root/target/release/hello-world: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by /root/target/release/hello-world)\r\n/root/target/release/hello-world: /lib64/libc.so.6: version `GLIBC_2.18' not found (required by /root/target/release/hello-world)\r\n```\r\n\r\nThis happens even with cent os 7:\r\n\r\n```\r\n$ docker run --rm -it -v $(pwd):/io centos:7 /io/target/release/hello-world\r\n/io/target/release/hello-world: /lib64/libc.so.6: version `GLIBC_2.18' not found (required by /io/target/release/hello-world)\r\n```\r\n\r\nWhen building inside the cent os 5 container on the other hand, none of the above symbols are used and the binary runs just fine in the container.\r\n\r\n### Why does this matter?\r\n\r\nFor my case, it's because I want to produce [manylinux](https://www.python.org/dev/peps/pep-0513/) compliant libraries and binaries. manylinux is a policy defined by python designed to be compatible with virtual any used linux system, which requires that only symbols from glibc <= 2.5 are used. All packages in the python package index must follow that policy, even though the glibc part is currently not automatically enforced. This affects e.g. [milksnake](https://github.com/getsentry/milksnake) and [pyo3](https://github.com/PyO3/pyo3). A newer requirement, called [manylinux2010](https://www.python.org/dev/peps/pep-0571/#the-manylinux2010-policy) is worked on, but it stills require glibc <= 2.12.\r\n\r\nIn general it means that you can't use any modern ci server to produce widely compatible linux-gnu binaries. You always have to build in some ancient docker container instead.\r\n\r\n### Versions\r\n\r\n * `rustc -vV`: `rustc 1.33.0-nightly (8e2063d02 2019-01-07)`\r\n * `cargo -V`: `cargo 1.33.0-nightly (2cf1f5dda 2018-12-11)`\r\n * The quay.io/pypa/manylinux1_x86_64 docker container run cent os 5.11 (Final) with glibc 2.5\r\n * The cent os 7 container is cent os 7.6.1810 with glibc 2.17\r\n\r\nThis issue a bit of a follow-up to #36826.\r\n", "closed_by": {"login": "konstin", "id": 6826232, "node_id": "MDQ6VXNlcjY4MjYyMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/6826232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/konstin", "html_url": "https://github.com/konstin", "followers_url": "https://api.github.com/users/konstin/followers", "following_url": "https://api.github.com/users/konstin/following{/other_user}", "gists_url": "https://api.github.com/users/konstin/gists{/gist_id}", "starred_url": "https://api.github.com/users/konstin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/konstin/subscriptions", "organizations_url": "https://api.github.com/users/konstin/orgs", "repos_url": "https://api.github.com/users/konstin/repos", "events_url": "https://api.github.com/users/konstin/events{/privacy}", "received_events_url": "https://api.github.com/users/konstin/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57497/reactions", "total_count": 25, "+1": 24, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57497/timeline", "performed_via_github_app": null, "state_reason": "completed"}