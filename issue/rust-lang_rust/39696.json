{"url": "https://api.github.com/repos/rust-lang/rust/issues/39696", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39696/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39696/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39696/events", "html_url": "https://github.com/rust-lang/rust/issues/39696", "id": 206576516, "node_id": "MDU6SXNzdWUyMDY1NzY1MTY=", "number": 39696, "title": "What should we do about `#[derive(...)]` on `#[repr(packed)]` structs?", "user": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-02-09T17:37:24Z", "updated_at": "2018-03-27T22:54:59Z", "closed_at": "2018-03-27T22:54:59Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The derived trait instances for packed structs tend to take references to the packed struct fields, which can cause undefined behavior (unaligned loads) and will be detected as unsafe once https://github.com/rust-lang/rust/issues/27060 is fixed. So, code using these derives on packed structs will stop compiling.\r\n\r\nSee also https://github.com/rust-lang/rust/pull/39682 where I fixed impls in a Rust test and https://github.com/rust-lang/rust/pull/39683 where I fixed an impl in rustc.\r\n\r\nShould we:\r\n1. Make derive detect `#[repr(packed)]` (can it?) and change the generated code.\r\n2. Generate the code in a way that *always* works for packed structs (I somewhat doubt this is possible).\r\n3. Do nothing. Let the users deal with manually implementing derivable traits for packed structs.\r\n4. Do something I didn't think of.\r\n\r\ncc @Aatch @bluss @retep998 @rust-lang/compiler ", "closed_by": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39696/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39696/timeline", "performed_via_github_app": null, "state_reason": "completed"}