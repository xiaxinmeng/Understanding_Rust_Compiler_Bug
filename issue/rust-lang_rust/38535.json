{"url": "https://api.github.com/repos/rust-lang/rust/issues/38535", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38535/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38535/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38535/events", "html_url": "https://github.com/rust-lang/rust/issues/38535", "id": 197116662, "node_id": "MDU6SXNzdWUxOTcxMTY2NjI=", "number": 38535, "title": "Type inference regression", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 15, "created_at": "2016-12-22T08:06:28Z", "updated_at": "2016-12-25T17:41:08Z", "closed_at": "2016-12-25T17:41:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Servo compiles with rustc 71c06a56a120a0d5e3b224105ee3e6754f83e5fa 2016-12-18, but not with 439c3128d740af372dae163310f7292e999098e1 2016-12-21. Diff: https://github.com/rust-lang/rust/compare/71c06a56a...439c3128d7\r\n\r\nThe `style` crate fails to build with:\r\n\r\n```rust\r\nerror[E0282]: unable to infer enough type information about `E`\r\n  --> /home/simon/projects/servo/components/style/font_face.rs:65:9\r\n   |\r\n65 |         try!(self.family.to_css(dest));\r\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot infer type for `E`\r\n   |\r\n   = note: type annotations or generic parameter binding required\r\n   = note: this error originates in a macro outside of the current crate\r\n```\r\n\r\nThe `to_css` method being called here is:\r\n\r\n```rust\r\nimpl ToCss for FontFamily {\r\n    fn to_css<W>(&self, dest: &mut W) -> fmt::Result where W: fmt::Write {\r\n        // ...\r\n    }\r\n}\r\n```\r\n\r\nIts return type is `std::fmt::Result` which is `type Result = std::result::Result<(), std::fmt::Error>;`. This call is in another impl of the same method of the same trait:\r\n\r\n```rust\r\nimpl ToCss for FontFaceRule {\r\n    fn to_css<W>(&self, dest: &mut W) -> fmt::Result where W: fmt::Write {\r\n        try!(dest.write_str(\"@font-face { font-family: \"));\r\n        try!(self.family.to_css(dest));\r\n        try!(dest.write_str(\";\"));\r\n\r\n        // ...\r\n    }\r\n}\r\n```\r\n\r\nAdding an explicit type annotation works around this error, but only to uncover another very similar one, then another. The third one was in code generated by serde\u2019s `derive(Serialize)`, so I gave up that approach.\r\n\r\n```rust\r\n        let r: fmt::Result = self.family.to_css(dest);\r\n        try!(r);\r\n```\r\n\r\nSo far I haven\u2019t managed to reduce a test case smaller than \"most of Servo\", sorry.\r\n\r\nI\u2019m suspicious of 6ea1fbb52bc2f82a78d7b592bdfed2b05e6fb666 (which is part of #38099) because it\u2019s commit message mentions inference. I\u2019m not building a compiler #38099 to confirm.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38535/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38535/timeline", "performed_via_github_app": null, "state_reason": "completed"}