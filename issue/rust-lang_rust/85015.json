{"url": "https://api.github.com/repos/rust-lang/rust/issues/85015", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85015/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85015/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85015/events", "html_url": "https://github.com/rust-lang/rust/issues/85015", "id": 878211903, "node_id": "MDU6SXNzdWU4NzgyMTE5MDM=", "number": 85015, "title": "inner macro attributes no longer compile on rust 1.52", "user": {"login": "tylerhawkes", "id": 7120045, "node_id": "MDQ6VXNlcjcxMjAwNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7120045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tylerhawkes", "html_url": "https://github.com/tylerhawkes", "followers_url": "https://api.github.com/users/tylerhawkes/followers", "following_url": "https://api.github.com/users/tylerhawkes/following{/other_user}", "gists_url": "https://api.github.com/users/tylerhawkes/gists{/gist_id}", "starred_url": "https://api.github.com/users/tylerhawkes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tylerhawkes/subscriptions", "organizations_url": "https://api.github.com/users/tylerhawkes/orgs", "repos_url": "https://api.github.com/users/tylerhawkes/repos", "events_url": "https://api.github.com/users/tylerhawkes/events{/privacy}", "received_events_url": "https://api.github.com/users/tylerhawkes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/80", "html_url": "https://github.com/rust-lang/rust/milestone/80", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/80/labels", "id": 6400252, "node_id": "MDk6TWlsZXN0b25lNjQwMDI1Mg==", "number": 80, "title": "1.52.0", "description": null, "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 718, "state": "closed", "created_at": "2021-02-06T10:46:56Z", "updated_at": "2021-08-22T13:10:51Z", "due_on": null, "closed_at": "2021-05-22T17:10:30Z"}, "comments": 2, "created_at": "2021-05-06T23:53:56Z", "updated_at": "2023-01-06T11:58:43Z", "closed_at": "2021-05-07T07:24:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\n\r\n### Code\r\n\r\nI have some proprietary code similar to this that has worked up through rust 1.51. Looking at the linked issues it looks like it should have never compiled in the first place. Whether this is fixed or not, I'll be moving the attributes out to their module definitions so that I can move on.\r\n\r\nCargo.toml:\r\n```toml\r\n[package]\r\nname = \"broken\"\r\nversion = \"0.1.0\"\r\nauthors = [\"Tyler Hawkes\"]\r\nedition = \"2018\"\r\n[dependencies]\r\nis_not = \"*\"\r\n```\r\nsrc/lib.rs\r\n```rust\r\nmod compile;\r\nmod do_not_compile;\r\n#[is_not::is]\r\npub use compile::compile_fn;\r\n#[is_not::not]\r\npub use do_not_compile::compile_fn;\r\n```\r\nsrc/compile.rs (generated by build.rs)\r\n```rust\r\n#![is_not::is]\r\npub fn compile_fn() {\r\n    println!(\"compiled\")\r\n}\r\n```\r\n\r\nsrc/do_not_compile.rs (generated by build.rs)\r\n```rust\r\n#![is_not::not]\r\npub fn compile_fn() {\r\n    println!(\"compiled\")\r\n}\r\n```\r\n\r\nI expected to have the code compile with these 3 warnings (though I don't get them with my other code):\r\n\r\n```\r\nwarning: function is never used: `compile_fn`\r\n --> src/do_not_compile.rs:3:8\r\n  |\r\n3 | pub fn compile_fn() {\r\n  |        ^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(dead_code)]` on by default\r\n\r\nwarning: unused attribute\r\n --> src/compile.rs:1:1\r\n  |\r\n1 | #![is_not::is]\r\n  | ^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(unused_attributes)]` on by default\r\n\r\nwarning: unused attribute\r\n --> src/do_not_compile.rs:1:1\r\n  |\r\n1 | #![is_not::not]\r\n  | ^^^^^^^^^^^^^^^\r\n\r\nwarning: 3 warnings emitted\r\n```\r\n\r\nInstead, the code doesn't compile referencing error E0658\r\n\r\n```\r\nerror[E0658]: inner macro attributes are unstable\r\n --> src/compile.rs:1:4\r\n  |\r\n1 | #![is_not::is]\r\n  |    ^^^^^^^^^^\r\n  |\r\n  = note: see issue #54726 <https://github.com/rust-lang/rust/issues/54726> for more information\r\n\r\nerror[E0658]: non-inline modules in proc macro input are unstable\r\n --> src/lib.rs:1:1\r\n  |\r\n1 | mod compile;\r\n  | ^^^^^^^^^^^^\r\n  |\r\n  = note: see issue #54727 <https://github.com/rust-lang/rust/issues/54727> for more information\r\n\r\nerror[E0658]: inner macro attributes are unstable\r\n --> src/do_not_compile.rs:1:4\r\n  |\r\n1 | #![is_not::not]\r\n  |    ^^^^^^^^^^^\r\n  |\r\n  = note: see issue #54726 <https://github.com/rust-lang/rust/issues/54726> for more information\r\n\r\nerror[E0658]: non-inline modules in proc macro input are unstable\r\n --> src/lib.rs:2:1\r\n  |\r\n2 | mod do_not_compile;\r\n  | ^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: see issue #54727 <https://github.com/rust-lang/rust/issues/54727> for more information\r\n```\r\n\r\n### Version it worked on\r\n\r\n<!--\r\nProvide the most recent version this worked on, for example:\r\n\r\nIt most recently worked on: Rust 1.51\r\n-->\r\n\r\nIt most recently worked on: Rust 1.51\r\n\r\n### Version with regression\r\n\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.52.0 (88f19c6da 2021-05-03)\r\nbinary: rustc\r\ncommit-hash: 88f19c6dab716c6281af7602e30f413e809c5974\r\ncommit-date: 2021-05-03\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.52.0\r\nLLVM version: 12.0.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<!--\r\nIf you know when this regression occurred, please add a line like below, replacing `{channel}` with one of stable, beta, or nightly.\r\n\r\n@rustbot modify labels: +regression-from-stable-to-stable -regression-untriaged\r\n-->\r\n", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85015/timeline", "performed_via_github_app": null, "state_reason": "completed"}