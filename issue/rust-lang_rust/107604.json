{"url": "https://api.github.com/repos/rust-lang/rust/issues/107604", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107604/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107604/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107604/events", "html_url": "https://github.com/rust-lang/rust/issues/107604", "id": 1568428938, "node_id": "I_kwDOAAsO6M5dfFOK", "number": 107604, "title": "Compiler's help suggestion is incorrect when passing Option<String> into a function expecting Option<&str>", "user": {"login": "scizzorz", "id": 2607718, "node_id": "MDQ6VXNlcjI2MDc3MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2607718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scizzorz", "html_url": "https://github.com/scizzorz", "followers_url": "https://api.github.com/users/scizzorz/followers", "following_url": "https://api.github.com/users/scizzorz/following{/other_user}", "gists_url": "https://api.github.com/users/scizzorz/gists{/gist_id}", "starred_url": "https://api.github.com/users/scizzorz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scizzorz/subscriptions", "organizations_url": "https://api.github.com/users/scizzorz/orgs", "repos_url": "https://api.github.com/users/scizzorz/repos", "events_url": "https://api.github.com/users/scizzorz/events{/privacy}", "received_events_url": "https://api.github.com/users/scizzorz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-02-02T17:06:09Z", "updated_at": "2023-02-03T21:04:48Z", "closed_at": "2023-02-03T21:04:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\n\n```Rust\nfn foo(_s: Option<&str>) {\r\n}\r\n\r\nfn main() {\r\n    let s = Some(\"\".to_string());\r\n    foo(s);\r\n}\r\n\r\n// AND:\r\n\r\nfn foo(_s: Option<&str>) {\r\n}\r\n\r\nfn main() {\r\n    let s = Some(\"\".to_string());\r\n    foo(s.map(|x| &*x));\r\n}\n```\n\n\n### Current output\n\n```Shell\nerror[E0308]: mismatched types\r\n --> foo.rs:6:9\r\n  |\r\n6 |     foo(s);\r\n  |     --- ^ expected `&str`, found struct `String`\r\n  |     |\r\n  |     arguments to this function are incorrect\r\n  |\r\n  = note: expected enum `Option<&str>`\r\n             found enum `Option<String>`\r\nnote: function defined here\r\n --> foo.rs:1:4\r\n  |\r\n1 | fn foo(_s: Option<&str>) {\r\n  |    ^^^ ----------------\r\nhelp: try converting the passed type into a `&str`\r\n  |\r\n6 |     foo(s.map(|x| &*x));\r\n  |          +++++++++++++\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\n\r\n// AND:\r\n\r\nerror[E0515]: cannot return value referencing function parameter `x`\r\n --> foo.rs:6:19\r\n  |\r\n6 |     foo(s.map(|x| &*x));\r\n  |                   ^^-\r\n  |                   | |\r\n  |                   | `x` is borrowed here\r\n  |                   returns a value referencing data owned by the current function\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0515`.\n```\n\n\n### Desired output\n\n```Shell\nI believe the help suggestion should be valid code. I was able to solve this error with:\r\n\r\nfn foo(s: Option<&str>) {\r\n}\r\n\r\nfn main() {\r\n    let s = Some(\"\".to_string());\r\n    foo(s.as_ref().map(AsRef::as_ref));\r\n}\n```\n\n\n### Rationale and extra context\n\nrustc's help suggestions are often extremely helpful, but in this case the suggested change simply does not work and also doesn't provide any further help or explanation about why it doesn't work.\n\n### Other cases\n\n_No response_\n\n### Anything else?\n\n_No response_", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107604/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107604/timeline", "performed_via_github_app": null, "state_reason": "completed"}