{"url": "https://api.github.com/repos/rust-lang/rust/issues/98849", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/98849/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/98849/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/98849/events", "html_url": "https://github.com/rust-lang/rust/issues/98849", "id": 1292355513, "node_id": "I_kwDOAAsO6M5NB8e5", "number": 98849, "title": "`--nxcompat` unrecognized option when cross compiling from linux to windows", "user": {"login": "Hellzbellz123", "id": 31550512, "node_id": "MDQ6VXNlcjMxNTUwNTEy", "avatar_url": "https://avatars.githubusercontent.com/u/31550512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hellzbellz123", "html_url": "https://github.com/Hellzbellz123", "followers_url": "https://api.github.com/users/Hellzbellz123/followers", "following_url": "https://api.github.com/users/Hellzbellz123/following{/other_user}", "gists_url": "https://api.github.com/users/Hellzbellz123/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hellzbellz123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hellzbellz123/subscriptions", "organizations_url": "https://api.github.com/users/Hellzbellz123/orgs", "repos_url": "https://api.github.com/users/Hellzbellz123/repos", "events_url": "https://api.github.com/users/Hellzbellz123/events{/privacy}", "received_events_url": "https://api.github.com/users/Hellzbellz123/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-07-03T14:33:29Z", "updated_at": "2023-02-13T03:37:37Z", "closed_at": "2023-02-13T03:37:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Problem\r\n\r\nOn my wsl2 machine, trying to compile my bevy project with ```cargo build --target=x86_64-pc-windows-msvc -Z unstable-options --out-dir=publish --release``` will work up until the linker gets a random --nxcompat. i also noticed that in the error message its using ld even though clang is setup. setting mold as the linker causes mold to fail from the same error\r\n\r\nerror output by cargo\r\n```\r\n   Compiling vanillacoffee v0.0.1 (/home/hellzbellz/Source/VanillaCoffee)\r\nerror: linking with `clang` failed: exit status: 1\r\n  |\r\n  = note: \"clang\" \"/tmp/rustcVYROkk/symbols.o\" \"/home/hellzbellz/Source/VanillaCoffee/target/x86_64-pc-windows-msvc/release/deps/vanillacoffee.vanillacoffee.d8322a15-cgu.1.rcgu.o\" \"-L\" \"/home/hellzbellz/Source/VanillaCoffee/target/x86_64-pc-windows-msvc/release/deps\" \"-L\" \"/home/hellzbellz/Source/VanillaCoffee/target/release/deps\" \"-L\" \"/opt/xwin/crt/lib/x86_64\" \"-L\" \"/opt/xwin/sdk/lib/um/x86_64\" \"-L\" \"/opt/xwin/sdk/lib/ucrt/x86_64\" \"-L\" \"/home/hellzbellz/.cargo/registry/src/github.com-1ecc6299db9ec823/windows_x86_64_msvc-0.36.1/lib\" \"-L\" \"/home/hellzbellz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-msvc/lib\" \"-Wl,--start-group\" \"-Wl,--end-group\" \"-Wl,-Bstatic\" \"/home/hellzbellz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-msvc/lib/libcompiler_builtins-ce01cad194b518d4.rlib\" \"-Wl,-Bdynamic\" \"-lwindows\" \"-ladvapi32\" \"-lcfgmgr32\" \"-lcomctl32\" \"-ld3d12\" \"-ld3dcompiler\" \"-ldwmapi\" \"-ldxgi\" \"-lgdi32\" \"-limm32\" \"-lkernel32\" \"-lmmdevapi\" \"-lmsimg32\" \"-lole32\" \"-lopengl32\" \"-lshcore\" \"-lshell32\" \"-lshlwapi\" \"-lsynchronization\" \"-luser32\" \"-luxtheme\" \"-lwinmm\" \"-lwinspool\" \"-lxinput\" \"-lbcrypt\" \"-ladvapi32\" \"-luserenv\" \"-lkernel32\" \"-lws2_32\" \"-lbcrypt\" \"-lmsvcrt\" \"-Wl,--eh-frame-hdr\" \"-Wl,--nxcompat\" \"-L\" \"/home/hellzbellz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-msvc/lib\" \"-o\" \"/home/hellzbellz/Source/VanillaCoffee/target/x86_64-pc-windows-msvc/release/deps/vanillacoffee.exe\"\r\n  = note: /usr/sbin/ld: unrecognized option '--nxcompat'\r\n          /usr/sbin/ld: use the --help option for usage information\r\n          clang-14: error: linker command failed with exit code 1 (use -v to see invocation)\r\n\r\n\r\nerror: could not compile `vanillacoffee` due to previous error\r\n\u276f cargo build --target=x86_64-pc-windows-msvc -Z unstable-options --out-dir=publish --release\r\n```\r\n\r\n### Steps\r\n\r\n1. set clang as msvc linker\r\n2. be on nightly\r\n3. use xwin to download msvc librarys from windows\r\n4. try to compile\r\n\r\n### Possible Solution(s)\r\n\r\njudging from the error message it looks like clang is loading the windows gnu api flags and  and adding a compatability flag for something, but it is not working here\r\n\r\n### Notes\r\n\r\nwsl\r\n\r\nconfig.toml\r\n```\r\n[target.x86_64-unknown-linux-gnu]\r\nlinker = \"clang\"\r\nrustflags = [\"-Zshare-generics=y\", \"-C\", \"link-arg=--ld-path=/usr/sbin/mold\"]\r\n\r\n[target.x86_64-pc-windows-msvc]\r\nlinker = \"clang\"\r\nrustflags = [\r\n  \"-Zshare-generics=n\",\r\n  \"-Lnative=/opt/xwin/crt/lib/x86_64\",\r\n  \"-Lnative=/opt/xwin/sdk/lib/um/x86_64\",\r\n  \"-Lnative=/opt/xwin/sdk/lib/ucrt/x86_64\",\r\n]\r\n\r\n[profile.dev]  \r\nopt-level = 1\r\n\r\n[profile.dev.package.\"*\"] # # Enable high optimizations for dependencies (incl. Bevy), but not for our code:\r\nopt-level = 3\r\n\r\n\r\n[profile.release]\r\nlto = \"full\"\r\nopt-level = 3\r\n[build]\r\nrustc-wrapper = \"sccache\"\r\nrustflags = [\"-Ctarget-cpu=znver3\"]\r\n```\r\n\r\n### Version\r\n\r\n```text\r\ncargo 1.64.0-nightly (dbff32b27 2022-06-24)\r\nrelease: 1.64.0-nightly\r\ncommit-hash: dbff32b27893b899ae2397f3d56d1be111041d56\r\ncommit-date: 2022-06-24\r\nhost: x86_64-unknown-linux-gnu\r\nlibgit2: 1.4.2 (sys:0.14.2 vendored)\r\nlibcurl: 7.83.1-DEV (sys:0.4.55+curl-7.83.1 vendored ssl:OpenSSL/1.1.1n)\r\nos: Arch Linux [64-bit]\r\n```\r\n", "closed_by": {"login": "Hellzbellz123", "id": 31550512, "node_id": "MDQ6VXNlcjMxNTUwNTEy", "avatar_url": "https://avatars.githubusercontent.com/u/31550512?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hellzbellz123", "html_url": "https://github.com/Hellzbellz123", "followers_url": "https://api.github.com/users/Hellzbellz123/followers", "following_url": "https://api.github.com/users/Hellzbellz123/following{/other_user}", "gists_url": "https://api.github.com/users/Hellzbellz123/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hellzbellz123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hellzbellz123/subscriptions", "organizations_url": "https://api.github.com/users/Hellzbellz123/orgs", "repos_url": "https://api.github.com/users/Hellzbellz123/repos", "events_url": "https://api.github.com/users/Hellzbellz123/events{/privacy}", "received_events_url": "https://api.github.com/users/Hellzbellz123/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/98849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/98849/timeline", "performed_via_github_app": null, "state_reason": "completed"}