{"url": "https://api.github.com/repos/rust-lang/rust/issues/31002", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31002/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31002/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31002/events", "html_url": "https://github.com/rust-lang/rust/issues/31002", "id": 127274309, "node_id": "MDU6SXNzdWUxMjcyNzQzMDk=", "number": 31002, "title": "[MIR] Requiring TempRef to only be assigned to once may be too restrictive", "user": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2016-01-18T17:25:33Z", "updated_at": "2016-01-22T15:59:04Z", "closed_at": "2016-01-22T13:27:21Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "In MIR we want `tmp*` values to be SSA, however ensuring that constraint in trans (i.e. in TempRef) is wrong, I think.\n\nNamely, for code like this:\n\n``` rust\n#![feature(rustc_attrs)]\nstruct A(f32);\n#[rustc_mir(graphviz=\"mir.gv\")]\nfn mir(f: f32) -> bool { !(f.is_nan() || f.is_infinite()) }\nfn main() { println!(\"{:?}\", mir(0.0)); }\n```\n\nwe will generate following MIR (graphviz version, because easier to visualise):\n\n![MIR](https://cloud.githubusercontent.com/assets/679122/12397961/508d42f8-be19-11e5-9aad-d1c2de375992.png)\n\nwhich will result in \n\n```\ntest.rs:17:7: 17:36 error: internal compiler error: operand const false already assigned\ntest.rs:17     !(f.is_nan() || f.is_infinite())\n                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n```\n\nNote how we assign `tmp0` twice, but the two branches are fully disjoint, and thus, for the purposes of data-flow `tmp0` is still SSA, but for the purposes of translator `tmp0` is assigned multiple times.\n\nIf we want `TempRef`s to stay `SSA` across translation of the whole function, we will need something like a `phi` in the MIR.\n\ncc @nikomatsakis \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31002/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31002/timeline", "performed_via_github_app": null, "state_reason": "completed"}