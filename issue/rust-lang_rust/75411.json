{"url": "https://api.github.com/repos/rust-lang/rust/issues/75411", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75411/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75411/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75411/events", "html_url": "https://github.com/rust-lang/rust/issues/75411", "id": 677037490, "node_id": "MDU6SXNzdWU2NzcwMzc0OTA=", "number": 75411, "title": "Rust can't incrementally compile project over remote file system [Internal Compiler Error]", "user": {"login": "slightknack", "id": 54823450, "node_id": "MDQ6VXNlcjU0ODIzNDUw", "avatar_url": "https://avatars.githubusercontent.com/u/54823450?v=4", "gravatar_id": "", "url": "https://api.github.com/users/slightknack", "html_url": "https://github.com/slightknack", "followers_url": "https://api.github.com/users/slightknack/followers", "following_url": "https://api.github.com/users/slightknack/following{/other_user}", "gists_url": "https://api.github.com/users/slightknack/gists{/gist_id}", "starred_url": "https://api.github.com/users/slightknack/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/slightknack/subscriptions", "organizations_url": "https://api.github.com/users/slightknack/orgs", "repos_url": "https://api.github.com/users/slightknack/repos", "events_url": "https://api.github.com/users/slightknack/events{/privacy}", "received_events_url": "https://api.github.com/users/slightknack/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-11T16:55:11Z", "updated_at": "2020-08-13T00:04:02Z", "closed_at": "2020-08-13T00:03:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n-->\r\n\r\nAfter setting up a NAS device (exfat over smb via RPI3), Rust has trouble compiling any project stored on that device. This isn't so much a problem with the Rust compiler as it is with my awkward NAS setup. \r\n\r\nHere's an ascii diagram to illustrate:\r\n```\r\n+----------------+ +-------------+\r\n| local computer | | NAS         |\r\n+----------------+ +-------------+\r\n| compiler <-------- source code |\r\n|  | ^           | |             | \r\n|  | |           | |             | \r\n|  | +-------------> /target     |\r\n|  v             | |  |          |\r\n| binary <------------+          |\r\n|  |             | +-------------+  \r\n|  v             |\r\n| run            |\r\n+----------------+\r\n```\r\n\r\nThe idea is that the source code is hosted on the NAS (slow but lots of storage), and compiled/run on the local machine (fast but less storage).\r\n\r\nThe main driver of the error is simple: Rust is unable to 'create [a] session directory lock file' due to `os error 45`. After some quick digging, it appears that this error primarily occurs when a device is not connected and access is attempted (which is not the case here - the device is connected, albeit over a network).\r\n\r\nI primarily believe that this error is occurring due to the limitations of the smb protocol (and not due to the fact that this drive is formated as exfat; if the device is *physically* connected, Rust code compiles fine). This error also seems to occur in relation to incremental builds, though that may simply be because that is what the compiler checks for first.\r\n\r\nI could just disable incremental compilation - while fixing the error, it still does not fix incremental compilation over remote file systems. I'm pretty sure this issue is fairly unique, but if there is already an issue that discusses this particular topic, please just ignore this one.\r\n\r\nThank you in advance for any help \ud83d\ude04.\r\n\r\n### Code\r\nAnything and everything - the compiler will not start compiling.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.45.2 (d3fb005a3 2020-07-31)\r\nbinary: rustc\r\ncommit-hash: d3fb005a39e62501b8b0b356166e515ae24e2e54\r\ncommit-date: 2020-07-31\r\nhost: x86_64-apple-darwin\r\nrelease: 1.45.2\r\nLLVM version: 10.0\r\n```\r\n\r\n### Error output\r\n\r\n`cargo run --verbose`\r\n```\r\n   Compiling error v0.1.0 (/Volumes/drive/repos/error)\r\n     Running `rustc --crate-name error --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -Cembed-bitcode=no -C debuginfo=2 -C metadata=75b64579dca9fefb --out-dir /Volumes/drive/Repos/error/target/debug/deps -C incremental=/Volumes/drive/Repos/error/target/debug/incremental -L dependency=/Volumes/drive/Repos/error/target/debug/deps`\r\nerror: incremental compilation: could not create session directory lock file: Operation not supported (os error 45)\r\n\r\nthread 'rustc' panicked at 'trying to get session directory from `IncrCompSession`: NotInitialized', src/librustc_session/session.rs:840:48\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.45.2 (d3fb005a3 2020-07-31) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `error`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name error --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -Cembed-bitcode=no -C debuginfo=2 -C metadata=75b64579dca9fefb --out-dir /Volumes/drive/Repos/Veritable/error/target/debug/deps -C incremental=/Volumes/drive/Repos/Veritable/error/target/debug/incremental -L dependency=/Volumes/drive/Repos/Veritable/error/target/debug/deps` (exit code: 101)\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\nNo backtrace, even when `RUST_BACKTRACE=1` is set.\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75411/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75411/timeline", "performed_via_github_app": null, "state_reason": "completed"}