{"url": "https://api.github.com/repos/rust-lang/rust/issues/23437", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23437/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23437/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23437/events", "html_url": "https://github.com/rust-lang/rust/issues/23437", "id": 62373549, "node_id": "MDU6SXNzdWU2MjM3MzU0OQ==", "number": 23437, "title": "compiler panic - struct function fields passed to higher order function.", "user": {"login": "mikehadlow", "id": 223097, "node_id": "MDQ6VXNlcjIyMzA5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/223097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikehadlow", "html_url": "https://github.com/mikehadlow", "followers_url": "https://api.github.com/users/mikehadlow/followers", "following_url": "https://api.github.com/users/mikehadlow/following{/other_user}", "gists_url": "https://api.github.com/users/mikehadlow/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikehadlow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikehadlow/subscriptions", "organizations_url": "https://api.github.com/users/mikehadlow/orgs", "repos_url": "https://api.github.com/users/mikehadlow/repos", "events_url": "https://api.github.com/users/mikehadlow/events{/privacy}", "received_events_url": "https://api.github.com/users/mikehadlow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-03-17T11:46:01Z", "updated_at": "2015-06-23T13:10:29Z", "closed_at": "2015-06-23T13:10:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Just playing with higher-order functions and structs with function fields.\n\nI tried this code:\n\n```\n// the main function\nfn main() {\n\n    let funcs = Funcs {\n        a: Box::new( |x| { 1 + x } ),\n        b: Box::new( |x| { x * 2 } )\n    };\n\n    let composed = compose(&funcs.a, &funcs.b);\n\n    let r1: i32 = composed(3);\n    let r2: i32 = composed(10);\n\n    println!(\"r1 is {}\", r1);\n    println!(\"r2 is {}\", r2);\n\n}\n\n// a higher order function\nfn compose<'a, T, F: 'a, G: 'a>(f: &'a F, g: &'a G) -> Box<Fn(T) -> T + 'a>\n    where\n        F: Fn(T) -> T,\n        G: Fn(T) -> T {\n\n    Box::new(move |x| { f(g(x)) })\n}\n\nstruct Funcs {\n    a: Box<Fn(i32) -> i32>,\n    b: Box<Fn(i32) -> i32>,\n}\n```\n\nI expected to see this happen: \n\n```\nCompiling rust_hello v0.0.1 (file:///home/mike/source/rust_hello)\nRunning `target/debug/rust_hello`\nr1 is 7\nr2 is 21\n```\n\nInstead, this happened: \n\n```\nCompiling rust_hello v0.0.1 (file:///home/mike/source/rust_hello)\nsrc/main.rs:10:20: 10:47 error: internal compiler error: cat_expr Errd\nsrc/main.rs:10     let composed = compose(&funcs.a, &funcs.b);\n                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:130\n```\n## Meta\n\n```\nrustc --version --verbose\nrustc 1.0.0-nightly (30e1f9a1c 2015-03-14) (built 2015-03-15)\nbinary: rustc\ncommit-hash: 30e1f9a1c2bf7134135800bc9afd082773defadc\ncommit-date: 2015-03-14\nbuild-date: 2015-03-15\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-nightly\n```\n\nBacktrace:\n\n```\nRUST_BACKTRACE=1 rustc src/main.rs\nsrc/main.rs:10:20: 10:47 error: internal compiler error: cat_expr Errd\nsrc/main.rs:10     let composed = compose(&funcs.a, &funcs.b);\n                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:130\n\nstack backtrace:\n   1:     0x7fb896007fd4 - sys::backtrace::write::hc598c94e8fe3368fYyC\n   2:     0x7fb89602dd98 - panicking::on_panic::he6f0d5fd56790ce4OGI\n   3:     0x7fb895f64faa - rt::unwind::begin_unwind_inner::h0de67d11bf40bff3mnI\n   4:     0x7fb8933e140d - rt::unwind::begin_unwind::h1003680148821460282\n   5:     0x7fb8933e13b3 - diagnostic::SpanHandler::span_bug::h1c5c4bceba1974e2FaB\n   6:     0x7fb893c98523 - session::Session::span_bug::h04e509cfca0af677Qvn\n   7:     0x7fb894cc60e1 - check::regionck::visit_expr::h6d73f9ea96a73481dCd\n   8:     0x7fb894cc69fa - check::regionck::visit_local::h94f330bbd6249aa8izd\n   9:     0x7fb894cc18a5 - check::regionck::Rcx<'a, 'tcx>::visit_fn_body::h91c2ca9bef55fb39qed\n  10:     0x7fb894d4c566 - check::check_bare_fn::ha0fa7770160c8d54b8m\n  11:     0x7fb894d44681 - check::check_item::h289f0c28a59d81b7Pqn\n  12:     0x7fb894e18a03 - check_crate::closure.35785\n  13:     0x7fb894e1373a - check_crate::h77f9ea673c087f80O3B\n  14:     0x7fb89662fbf8 - driver::phase_3_run_analysis_passes::h716709d467e74aabqGa\n  15:     0x7fb896616f59 - driver::compile_input::h56dbe0e66fe8a956Rba\n  16:     0x7fb8966cea42 - run_compiler::hbbbe30f1ad654d0ex2b\n  17:     0x7fb8966cc88c - thunk::F.Invoke<A, R>::invoke::h9510793753674638958\n  18:     0x7fb8966cb910 - rt::unwind::try::try_fn::h15118916039308917284\n  19:     0x7fb89609ef58 - rust_try_inner\n  20:     0x7fb89609ef45 - rust_try\n  21:     0x7fb8966cbdb6 - thunk::F.Invoke<A, R>::invoke::h8595907971712275588\n  22:     0x7fb89601c995 - sys::thread::thread_start::h9f0c06661d546448B1G\n  23:     0x7fb88fec2181 - start_thread\n  24:     0x7fb895bd647c - __clone\n  25:                0x0 - <unknown>\n```\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23437/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23437/timeline", "performed_via_github_app": null, "state_reason": "completed"}