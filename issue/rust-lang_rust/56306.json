{"url": "https://api.github.com/repos/rust-lang/rust/issues/56306", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/56306/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/56306/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/56306/events", "html_url": "https://github.com/rust-lang/rust/issues/56306", "id": 385148924, "node_id": "MDU6SXNzdWUzODUxNDg5MjQ=", "number": 56306, "title": "Need to be able to explicitly set --whole-archive linker flag when building a binary", "user": {"login": "jkryl", "id": 5690145, "node_id": "MDQ6VXNlcjU2OTAxNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5690145?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jkryl", "html_url": "https://github.com/jkryl", "followers_url": "https://api.github.com/users/jkryl/followers", "following_url": "https://api.github.com/users/jkryl/following{/other_user}", "gists_url": "https://api.github.com/users/jkryl/gists{/gist_id}", "starred_url": "https://api.github.com/users/jkryl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jkryl/subscriptions", "organizations_url": "https://api.github.com/users/jkryl/orgs", "repos_url": "https://api.github.com/users/jkryl/repos", "events_url": "https://api.github.com/users/jkryl/events{/privacy}", "received_events_url": "https://api.github.com/users/jkryl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-11-28T08:14:49Z", "updated_at": "2022-02-11T12:31:21Z", "closed_at": "2022-02-11T12:31:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm using `1.32.0-nightly (6bfb46e4a 2018-11-26)` but it likely applies to all rust versions. The default behaviour when building a binary is to include only static/shared libraries which are actually referenced from the code. There is a legitimate use case when you want to include everything from a native library regardless if it appears to be used or not. Native library can contain functions marked as `__attribute__((constructor, used))` which are executed at the time when the library is loaded and can influence behaviour of other libraries which are explicitly referenced. One such example is DPDK library. Currently there does not seem to be a way to instruct explicitly rustc to include the lib even if not used.\r\n\r\nUsing .cargo/config to override rustc flags looks more like a workaround than a proper solution. Or maybe I missed some other way how to accomplish the same without hacking the code? I will be thankful for any advice. Thanks!\r\n\r\nFor more in-depth discussion about the particular case of DPDK/SPDK see: \r\nhttps://github.com/jkozlowski/starfish/issues/6 or https://github.com/spdk/spdk/issues/518 or a PR https://github.com/jkozlowski/starfish/pull/8 .", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/56306/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/56306/timeline", "performed_via_github_app": null, "state_reason": "completed"}