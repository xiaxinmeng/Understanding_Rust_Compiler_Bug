{"url": "https://api.github.com/repos/rust-lang/rust/issues/22318", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22318/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22318/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22318/events", "html_url": "https://github.com/rust-lang/rust/issues/22318", "id": 57680072, "node_id": "MDU6SXNzdWU1NzY4MDA3Mg==", "number": 22318, "title": "Internal Compiler Error: assertion failed: did.krate != ast::LOCAL_CRATE", "user": {"login": "GrahamDennis", "id": 103838, "node_id": "MDQ6VXNlcjEwMzgzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/103838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GrahamDennis", "html_url": "https://github.com/GrahamDennis", "followers_url": "https://api.github.com/users/GrahamDennis/followers", "following_url": "https://api.github.com/users/GrahamDennis/following{/other_user}", "gists_url": "https://api.github.com/users/GrahamDennis/gists{/gist_id}", "starred_url": "https://api.github.com/users/GrahamDennis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GrahamDennis/subscriptions", "organizations_url": "https://api.github.com/users/GrahamDennis/orgs", "repos_url": "https://api.github.com/users/GrahamDennis/repos", "events_url": "https://api.github.com/users/GrahamDennis/events{/privacy}", "received_events_url": "https://api.github.com/users/GrahamDennis/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-02-14T03:59:53Z", "updated_at": "2015-02-14T10:59:19Z", "closed_at": "2015-02-14T10:59:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Rust version:\n\n```\nrustc 1.0.0-nightly (3ef8ff1f8 2015-02-12 00:38:24 +0000)\nbinary: rustc\ncommit-hash: 3ef8ff1f81107b42840a695725e1a0869c163355\ncommit-date: 2015-02-12 00:38:24 +0000\nhost: x86_64-apple-darwin\nrelease: 1.0.0-nightly\n```\n# Error:\n\n```\n\u279c rust-crdt git:(master) \u2717 env RUST_BACKTRACE=1 cargo  build --verbose\n   Compiling rust-crdt v0.0.1 (file:///Users/graham/Developer/rust-crdt)\n     Running `rustc src/lib.rs --crate-name rust-crdt --crate-type lib -g -C metadata=8dcd9444cd87d8ff -C extra-filename=-8dcd9444cd87d8ff --out-dir /Users/graham/Developer/rust-crdt/target --emit=dep-info,link -L dependency=/Users/graham/Developer/rust-crdt/target -L dependency=/Users/graham/Developer/rust-crdt/target/deps`\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'assertion failed: did.krate != ast::LOCAL_CRATE', /Users/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-mac/build/src/librustc/middle/ty.rs:5383\n\nstack backtrace:\n   1:        0x10f2f30a7 - sys::backtrace::write::h1864de2e29cfcfa3jWA\n   2:        0x10f31aa02 - failure::on_fail::hb779450ca026c246YwJ\n   3:        0x10f265708 - rt::unwind::begin_unwind_inner::h252a44c757d4dd84eeJ\n   4:        0x10c0f1555 - rt::unwind::begin_unwind::h9848272882995846808\n   5:        0x10c454881 - middle::ty::lookup_trait_def::h8e358ea41ffb8ee8kv9\n   6:        0x10c49c2f7 - middle::ty::predicates_for_trait_ref::hac77857a3eb8aa54qw9\n   7:        0x10c473a74 - middle::traits::util::Elaborator<'cx, 'tcx>.Iterator::next::h6c40d87b882069f31DU\n   8:        0x10c478e71 - middle::traits::util::Supertraits<'cx, 'tcx>.Iterator::next::h992e5ba45c909e1bCGU\n   9:        0x10bdab44d - astconv::ast_ty_to_ty::closure.34168\n  10:        0x10bd49efd - astconv::ast_ty_to_ty::hfc281cfabc6cd159VHv\n  11:        0x10bda1ed8 - vec::Vec<T>.FromIterator<T>::from_iter::h5118803716913674361\n  12:        0x10bd9ff1b - astconv::convert_angle_bracketed_parameters::hec3579c8a4af0b23sPu\n  13:        0x10bda3c84 - astconv::ast_path_to_trait_ref::h6fdf175b9a3f0841w2u\n  14:        0x10bd5509b - astconv::instantiate_trait_ref::ha8d70047126381c3dZu\n  15:        0x10bda30ca - astconv::instantiate_poly_trait_ref::he6516e6713c959acCXu\n  16:        0x10bdd2b89 - collect::compute_bounds::h41181afabd0333f8b9x\n  17:        0x10bdbab0a - collect::trait_def_of_item::h4ebf2ffacbbee292Esx\n  18:        0x10bdb918f - collect::CollectTraitDefVisitor<'a, 'tcx>.visit..Visitor<'v>::visit_item::h983a5bf4695c0168PCw\n  19:        0x10bdf860f - check_crate::closure.35183\n  20:        0x10bdf6625 - check_crate::h6350381f56a0ec2akrB\n  21:        0x10b79a2f5 - driver::phase_3_run_analysis_passes::h875436d46bd4a86dSGa\n  22:        0x10b780261 - driver::compile_input::h95c8a48d55aa4f35Eba\n  23:        0x10b8530a0 - run_compiler::h94216d35105add495bc\n  24:        0x10b850572 - thunk::F.Invoke<A, R>::invoke::h12503301436629523007\n  25:        0x10b84f240 - rt::unwind::try::try_fn::h15374797505029523364\n  26:        0x10f3921a9 - rust_try_inner\n  27:        0x10f392196 - rust_try\n  28:        0x10b84f939 - thunk::F.Invoke<A, R>::invoke::h5615031943461454492\n  29:        0x10f304733 - sys::thread::thread_start::ha3ace5b5b28cf521mOE\n  30:     0x7fff93d6f268 - _pthread_body\n  31:     0x7fff93d6f1e5 - _pthread_body\n\nCould not compile `rust-crdt`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/lib.rs --crate-name rust-crdt --crate-type lib -g -C metadata=8dcd9444cd87d8ff -C extra-filename=-8dcd9444cd87d8ff --out-dir /Users/graham/Developer/rust-crdt/target --emit=dep-info,link -L dependency=/Users/graham/Developer/rust-crdt/target -L dependency=/Users/graham/Developer/rust-crdt/target/deps` (status=101)\n```\n# Source code:\n\n```\nuse std::sync::Arc;\n\nenum CRDTOperation<T : CRDTSnapshot> {\n    Initialise,\n    Local(T::Operation, T),\n    Merge(T, T),\n}\n\ntrait CRDTLocalOperation<State> {\n    fn apply(&self, state: &State) -> &State;\n}\n\ntrait CRDTSnapshot {\n    type State;\n    type Operation : CRDTLocalOperation<Self::State>;\n\n    fn current_state(&self) -> &Self::State;\n    fn last_operation(&self) -> &CRDTOperation<Self::Operation>;\n}\n\n\nenum CounterOperation {\n    Increment(i64),\n}\n\nimpl CRDTLocalOperation<i64> for CounterOperation {\n    fn apply(&self, state: &i64) -> &i64 {\n        match *self {\n            CounterOperation::Increment(increment) => increment + state\n        }\n    }\n}\n\nstruct CounterSnapshot {\n    current_state: i64,\n    last_operation: CRDTOperation<CounterSnapshot>\n}\n\nimpl CounterSnapshot {\n    fn new() -> CounterSnapshot {\n        CounterSnapshot { current_state: 0, last_operation: CRDTOperation::Initialise }\n    }\n}\n\nimpl CRDTSnapshot for CounterSnapshot {\n    type State = i64;\n    type Operation = CounterOperation;\n\n    fn current_state(&self) -> &i64 {\n        &self.current_state\n    }\n\n    fn last_operation(&self) -> &CounterOperation {\n        &self.last_operation\n    }\n}\n\n#[test]\nfn it_works() {\n    let counter = CounterSnapshot::new();\n}\n\n```\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22318/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22318/timeline", "performed_via_github_app": null, "state_reason": "completed"}