{"url": "https://api.github.com/repos/rust-lang/rust/issues/79842", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79842/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79842/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79842/events", "html_url": "https://github.com/rust-lang/rust/issues/79842", "id": 759830378, "node_id": "MDU6SXNzdWU3NTk4MzAzNzg=", "number": 79842, "title": "Unexpected None, no reproduction", "user": {"login": "alexbuzzbee", "id": 2061796, "node_id": "MDQ6VXNlcjIwNjE3OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/2061796?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexbuzzbee", "html_url": "https://github.com/alexbuzzbee", "followers_url": "https://api.github.com/users/alexbuzzbee/followers", "following_url": "https://api.github.com/users/alexbuzzbee/following{/other_user}", "gists_url": "https://api.github.com/users/alexbuzzbee/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexbuzzbee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexbuzzbee/subscriptions", "organizations_url": "https://api.github.com/users/alexbuzzbee/orgs", "repos_url": "https://api.github.com/users/alexbuzzbee/repos", "events_url": "https://api.github.com/users/alexbuzzbee/events{/privacy}", "received_events_url": "https://api.github.com/users/alexbuzzbee/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-12-08T22:22:19Z", "updated_at": "2020-12-08T23:30:48Z", "closed_at": "2020-12-08T23:30:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "When this ICE happened, I tried to create a minimal reproduction right away; this was apparently a mistake, as after a few changes to my code, the crash vanished and I couldn't get it to come back. I'm reporting this anyway with the hope that someone might be able to work backwards from the point of the crash and figure out where the bad `None` is coming from.\r\n\r\n### Code\r\n\r\nWhile I was trying to figure out which part of my code was triggering this issue by deleting various pieces and recompiling, it disappeared and refused to come back even after restoring my code back to where it was when the crash happened. I therefore have been unable to reproduce the issue with any specific code. I understand that this probably makes this issue very difficult to investigate.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.50.0-nightly (3d6705aa5 2020-12-07)\r\nbinary: rustc\r\ncommit-hash: 3d6705aa5abffe94c83bf09af8c3ba3c599845fc\r\ncommit-date: 2020-12-07\r\nhost: x86_64-unknown-linux-musl\r\nrelease: 1.50.0-nightly\r\n```\r\n\r\nMy build situation is very weird. The code being compiled is `no_std`, `rustc` is given `-Z pre-link-args=-nostartfiles`, and `cargo` is given `-Z build-std=core,alloc --target x86_64-unknown-linux-gnu`. There are probably other weird things around that I missed when I dug through my build setup and `Cargo.toml`s.\r\n\r\n### Error output\r\n\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', compiler/rustc_middle/src/ty/query/mod.rs:235:5\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.50.0-nightly (3d6705aa5 2020-12-07) running on x86_64-unknown-linux-musl\r\n\r\nnote: compiler flags: -Z pre-link-args=-nostartfiles -Z unstable-options -C panic=abort -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\nthread '<unnamed>' panicked at 'assertion failed: `(left == right)`\r\n  left: `LLVMing`,\r\n right: `Codegenning`', /rustc/3d6705aa5abffe94c83bf09af8c3ba3c599845fc/compiler/rustc_codegen_ssa/src/back/write.rs:1425:21\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.50.0-nightly (3d6705aa5 2020-12-07) running on x86_64-unknown-linux-musl\r\n\r\nnote: compiler flags: -Z pre-link-args=-nostartfiles -Z unstable-options -C panic=abort -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\n```\r\n\r\nI tried to create a minimal reproduction before I ran with `RUST_BACKTRACE`, so unfortunately I don't have a backtrace to report. Again, I know this makes this very hard to investigate.", "closed_by": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79842/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79842/timeline", "performed_via_github_app": null, "state_reason": "completed"}