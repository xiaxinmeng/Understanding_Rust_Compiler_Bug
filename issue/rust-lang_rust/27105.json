{"url": "https://api.github.com/repos/rust-lang/rust/issues/27105", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27105/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27105/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27105/events", "html_url": "https://github.com/rust-lang/rust/issues/27105", "id": 95822946, "node_id": "MDU6SXNzdWU5NTgyMjk0Ng==", "number": 27105, "title": "Nested `CoerceUnsized` is not infered properly", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-07-18T12:54:48Z", "updated_at": "2015-10-17T13:24:06Z", "closed_at": "2015-10-17T13:24:06Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The following piece of code does not compile:\n\n``` Rust\npub struct Callbacks {\n    callbacks: Vec<Rc<RefCell<FnMut(i32)>>>,\n}\n\nimpl Callbacks {\n    pub fn register<F: FnMut(i32)+'static>(&mut self, callback: F) {\n        self.callbacks.push(Rc::new(RefCell::new(callback)));\n    }\n}\n```\n\n([Playpen](https://play.rust-lang.org/?gist=0352293b9c8828bb5c97&version=nightly))\n\nHowever, an explicit type annotation makes the code compile just fine:\n\n``` Rust\nuse std::rc::Rc;\nuse std::cell::RefCell;\n\npub struct Callbacks {\n    callbacks: Vec<Rc<RefCell<FnMut(i32)>>>,\n}\n\nimpl Callbacks {\n    pub fn register<F: FnMut(i32)+'static>(&mut self, callback: F) {\n        self.callbacks.push(Rc::new(RefCell::new(callback)) as Rc<RefCell<F>>);\n    }\n}\n```\n\nAlternatively, one can introduce an intermediate variable for the argument of `push`. Then Rust is fine with not having an annotation.\n\nRust should infer the proper types automatically, to make this annotation unnecessary even without an intermediate variable.\n\nThis is with current beta and nightly. (Stable does not support the unsized stuff well enough to write this at all.)\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27105/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27105/timeline", "performed_via_github_app": null, "state_reason": "completed"}