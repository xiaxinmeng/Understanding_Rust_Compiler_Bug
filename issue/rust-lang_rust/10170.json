{"url": "https://api.github.com/repos/rust-lang/rust/issues/10170", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10170/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10170/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10170/events", "html_url": "https://github.com/rust-lang/rust/issues/10170", "id": 21807236, "node_id": "MDU6SXNzdWUyMTgwNzIzNg==", "number": 10170, "title": "Allow for implicit scope-ends for variables/borrowing/destructors", "user": {"login": "Earlz", "id": 371222, "node_id": "MDQ6VXNlcjM3MTIyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/371222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Earlz", "html_url": "https://github.com/Earlz", "followers_url": "https://api.github.com/users/Earlz/followers", "following_url": "https://api.github.com/users/Earlz/following{/other_user}", "gists_url": "https://api.github.com/users/Earlz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Earlz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Earlz/subscriptions", "organizations_url": "https://api.github.com/users/Earlz/orgs", "repos_url": "https://api.github.com/users/Earlz/repos", "events_url": "https://api.github.com/users/Earlz/events{/privacy}", "received_events_url": "https://api.github.com/users/Earlz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 43009118, "node_id": "MDU6TGFiZWw0MzAwOTExOA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-destructors", "name": "A-destructors", "color": "f7e101", "default": false, "description": "Area: destructors (Drop, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-10-30T06:17:31Z", "updated_at": "2014-12-29T16:35:03Z", "closed_at": "2014-12-29T16:35:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "There are currently some rather hacky things I have to do because I need to borrow a pointer more than once in a method.. \n\n```\nstruct Master;\n\nstruct Child<'self>\n{\n  master: &'self mut Master\n}\n\nfn main(){\n  let mut m=Master;\n  let c1=Child{master: &mut m};\n  let c2=Child{master: &mut m};\n}\n```\n\nThis code will produce an error: \"cannot borrow `m` as mutable more than once at a time\"\n\nThe \"fix\" for this issue is to explicitly limit the scope of c1 so that it doesn't conflict with the c2 borrow. \n\n```\nstruct Master;\n\nstruct Child<'self>\n{\n  master: &'self mut Master\n}\n\nfn main(){\n  let mut m=Master;\n  { let c1=Child{master: &mut m}; }\n  { let c2=Child{master: &mut m}; }\n}\n```\n\nHowever, this should not be necessary in /most/ cases. It is completely discoverable to the compiler with static analysis that c1 goes out of scope after it is first created. Say there was a `c1.update_master()` method. Assuming that you place c1 and c2 in the proper order, it should be trivial to also discover that after this method is called, c1 goes out of scope, just before c2 needs to borrow the master pointer. \n\nThis will make destructor determinism slightly less obvious, but I think the extra concision would be useful in many use cases. For instance, for optimization you probably don't want to keep a file handle open for very long. But, to free it as soon as possible, you must introduce this rather ugly explicit scoping with `{ }`. \n\nThis should not change behavior of existing programs, but should allow a larger subset of programs to be compiled with more concision, while retaining the safety and determinism that is so precious in rust. \n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10170/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10170/timeline", "performed_via_github_app": null, "state_reason": "completed"}