{"url": "https://api.github.com/repos/rust-lang/rust/issues/28550", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28550/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28550/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28550/events", "html_url": "https://github.com/rust-lang/rust/issues/28550", "id": 107413747, "node_id": "MDU6SXNzdWUxMDc0MTM3NDc=", "number": 28550, "title": "ICE: unexpected panic in InferCtxt", "user": {"login": "khernyo", "id": 447532, "node_id": "MDQ6VXNlcjQ0NzUzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/447532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khernyo", "html_url": "https://github.com/khernyo", "followers_url": "https://api.github.com/users/khernyo/followers", "following_url": "https://api.github.com/users/khernyo/following{/other_user}", "gists_url": "https://api.github.com/users/khernyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/khernyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khernyo/subscriptions", "organizations_url": "https://api.github.com/users/khernyo/orgs", "repos_url": "https://api.github.com/users/khernyo/repos", "events_url": "https://api.github.com/users/khernyo/events{/privacy}", "received_events_url": "https://api.github.com/users/khernyo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-09-20T19:53:26Z", "updated_at": "2015-10-02T22:49:40Z", "closed_at": "2015-10-02T22:49:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Compiling the following code causes a panic:\n\n``` rust\nuse std::result::Result;\nuse std::thread;\n\nstruct A<H: B> {\n    t: H::Timeout,\n}\n\ntrait B {\n    type Timeout;\n}\n\nstruct C<F> where F: Factory {\n    f: F,\n}\n\nimpl<F> B for C <F> where F: Factory {\n    type Timeout = ();\n}\n\nstruct D<F> where F: Factory {\n    a: A<C<F>>,\n}\n\nimpl<F> D<F> where F: Factory {\n    fn new(f: F) -> Result<D<F>, ()> {\n        panic!();\n    }\n}\n\ntrait Factory {\n}\n\nimpl<F, H> Factory for F where H: Handler, F: FnMut(i32) -> H {\n}\n\ntrait Handler {\n}\n\nimpl<F> Handler for F where F: Fn(i32) -> () {\n}\n\nfn main() {\n    thread::spawn(move || {\n        D::new(|_| { move |_| { () } });\n    });\n}\n```\n\nCompiler output:\n\n```\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', ../src/libcore/option.rs:365\n\nstack backtrace:\n   1:     0x7fdef400af19 - sys::backtrace::tracing::imp::write::hd3f07380f094c3d8Pnt\n   2:     0x7fdef4008736 - panicking::on_panic::hbcd77a06a59b411aenx\n   3:     0x7fdef3fd503e - sys_common::unwind::begin_unwind_inner::h57bfaf3a147bd49affs\n   4:     0x7fdef3fd5a78 - sys_common::unwind::begin_unwind_fmt::h86f74adb98a0354bles\n   5:     0x7fdef40081d1 - rust_begin_unwind\n   6:     0x7fdef4054acf - panicking::panic_fmt::hb3d424cb509d7c29TaG\n   7:     0x7fdef404e0e8 - panicking::panic::hea7947f7c1336ee9q9F\n   8:     0x7fdef1e344fa - middle::infer::InferCtxt<'a, 'tcx>::closure_type::hb9fca2654a1e5eebd1C\n   9:     0x7fdef1eafd38 - middle::traits::select::SelectionContext<'cx, 'tcx>::closure_trait_ref_unnormalized::haf9984e1bd3a2127ImX\n  10:     0x7fdef1d8d259 - middle::traits::select::SelectionContext<'cx, 'tcx>::select::hb6b9ab80b7d40addudU\n  11:     0x7fdef1e942f3 - middle::traits::fulfill::process_predicate::h777636d2b6e7bc0dx5R\n  12:     0x7fdef1e92c81 - middle::traits::fulfill::FulfillmentContext<'tcx>::select::h2760b340d700acc6ZYR\n  13:     0x7fdef1e927d7 - middle::traits::fulfill::FulfillmentContext<'tcx>::select_where_possible::hddcd4049e7010152tXR\n  14:     0x7fdef1d38e23 - middle::traits::fulfill::FulfillmentContext<'tcx>::select_all_or_error::h4c3a89434e3357a6SVR\n  15:     0x7fdef1e3359f - middle::traits::type_known_to_meet_builtin_bound::h1b4c4c37c2c4a2e0D3Y\n  16:     0x7fdef1ee1c0b - middle::ty::util::ty..TyS<'tcx>::impls_bound::h02e3d047f5e01c50FW4\n  17:     0x7fdef1e3372f - middle::ty::util::ty..TyS<'tcx>::moves_by_default::hb1722bfd58f33277WY4\n  18:     0x7fdef1da6df2 - middle::expr_use_visitor::copy_or_move::h420c1a217b76bfa95Nr\n  19:     0x7fdef1d34e66 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'a, 'tcx>::consume_expr::hdc82c412b9ba9053snq\n  20:     0x7fdef1d7f394 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'a, 'tcx>::walk_expr::hc7978fbe900003fdLvq\n  21:     0x7fdef1d34eae - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'a, 'tcx>::consume_expr::hdc82c412b9ba9053snq\n  22:     0x7fdef1d3660a - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'a, 'tcx>::walk_fn::h422f97948c1a8175Lhq\n  23:     0x7fdef2b618dd - check::upvar::AdjustBorrowKind<'a, 'tcx>.Visitor<'v>::visit_fn::h76010959033c9b35Cbk\n  24:     0x7fdef2b61550 - visit::walk_expr::h16181555174029332073\n  25:     0x7fdef2b6124e - visit::walk_expr::h16181555174029332073\n  26:     0x7fdef2ba58f5 - check::check_bare_fn::h1b9a831a51795dbcozp\n  27:     0x7fdef2ba3310 - check::check_item_body::h223ccbb34dff59e3I0p\n  28:     0x7fdef2c59cd2 - check_crate::h85ae42a95dc44b30GCE\n  29:     0x7fdef4528c9e - driver::phase_3_run_analysis_passes::closure.21538\n  30:     0x7fdef450b3bc - middle::ty::context::ctxt<'tcx>::create_and_enter::h14072355153472622424\n  31:     0x7fdef4506b71 - driver::phase_3_run_analysis_passes::h5404249183138524855\n  32:     0x7fdef44e74c3 - driver::compile_input::h813f6e216bee01860ba\n  33:     0x7fdef464d02b - run_compiler::heebf093ad18f383a3qc\n  34:     0x7fdef464a896 - boxed::F.FnBox<A>::call_box::h5441627487340085045\n  35:     0x7fdef464a1a4 - sys_common::unwind::try::try_fn::h12996996568669864182\n  36:     0x7fdef4008038 - __rust_try\n  37:     0x7fdef3ffc832 - sys_common::unwind::try::inner_try::hc22680ca31a93181Dbs\n  38:     0x7fdef464a33e - boxed::F.FnBox<A>::call_box::h4646831150340203223\n  39:     0x7fdef4010233 - sys::thread::Thread::new::thread_start::h4012f549bc8d9354dGw\n  40:     0x7fdeed5910a3 - start_thread\n  41:     0x7fdef3c9106c - clone\n  42:                0x0 - <unknown>\n```\n\nI compiled with `rustc main.rs`\n## Meta\n\nrustc 1.5.0-nightly (6e5a32547 2015-09-19)\nbinary: rustc\ncommit-hash: 6e5a3254747cf1f76f8ea698d37f688e13344392\ncommit-date: 2015-09-19\nhost: x86_64-unknown-linux-gnu\nrelease: 1.5.0-nightly\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28550/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28550/timeline", "performed_via_github_app": null, "state_reason": "completed"}