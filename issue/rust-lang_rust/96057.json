{"url": "https://api.github.com/repos/rust-lang/rust/issues/96057", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96057/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96057/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96057/events", "html_url": "https://github.com/rust-lang/rust/issues/96057", "id": 1204924380, "node_id": "I_kwDOAAsO6M5H0a_c", "number": 96057, "title": "Cannot use drop in place where toilet closure works if the argument is a reference ", "user": {"login": "panstromek", "id": 25121817, "node_id": "MDQ6VXNlcjI1MTIxODE3", "avatar_url": "https://avatars.githubusercontent.com/u/25121817?v=4", "gravatar_id": "", "url": "https://api.github.com/users/panstromek", "html_url": "https://github.com/panstromek", "followers_url": "https://api.github.com/users/panstromek/followers", "following_url": "https://api.github.com/users/panstromek/following{/other_user}", "gists_url": "https://api.github.com/users/panstromek/gists{/gist_id}", "starred_url": "https://api.github.com/users/panstromek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/panstromek/subscriptions", "organizations_url": "https://api.github.com/users/panstromek/orgs", "repos_url": "https://api.github.com/users/panstromek/repos", "events_url": "https://api.github.com/users/panstromek/events{/privacy}", "received_events_url": "https://api.github.com/users/panstromek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-04-14T19:58:44Z", "updated_at": "2022-04-17T13:28:59Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this code:\r\n\r\n```rust\r\nstruct Arg(i8);\r\n\r\nfn takes_cb(cb: fn(&Arg)) {}\r\n\r\n\r\nfn takes_arg(a: &Arg) {}\r\n\r\nfn main() {\r\n    takes_cb(takes_arg); // this is ok\r\n    takes_cb(|_|( )); // this is ok\r\n    takes_cb(drop); // this is an error\r\n}\r\n```\r\n\r\nI expected to see this happen:\r\nI expect the code to compile. It looks like this should work, because drop should be more or less equivalent to toilet closure, it just has generic argument, but without any bounds, so it seems like it should be accepted here.\r\n\r\nInstead, this happened: \r\n\r\nCode doesn't compile with:\r\n```\r\nerror[E0308]: mismatched types\r\n   --> crates/legacy-zebra/src/game.rs:315:14\r\n    |\r\n315 |     takes_cb(drop);\r\n    |              ^^^^ one type is more general than the other\r\n    |\r\n    = note: expected fn pointer `for<'r> fn(&'r Arg)`\r\n               found fn pointer `fn(&Arg)`\r\n```\r\n\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.60.0-nightly (75d9a0ae2 2022-02-16)\r\nbinary: rustc\r\ncommit-hash: 75d9a0ae210dcd078b3985e3550b59064e6603bc\r\ncommit-date: 2022-02-16\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.60.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n", "closed_by": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96057/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96057/timeline", "performed_via_github_app": null, "state_reason": null}