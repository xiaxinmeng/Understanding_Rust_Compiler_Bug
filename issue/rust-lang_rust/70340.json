{"url": "https://api.github.com/repos/rust-lang/rust/issues/70340", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/70340/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/70340/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/70340/events", "html_url": "https://github.com/rust-lang/rust/issues/70340", "id": 586582253, "node_id": "MDU6SXNzdWU1ODY1ODIyNTM=", "number": 70340, "title": "assert failure in mpsc::shared `recv`", "user": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-23T23:21:29Z", "updated_at": "2020-03-24T12:50:11Z", "closed_at": "2020-03-24T12:50:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Don\u2019t have minimal reproducer, but the issue reproduces this very often, so I\u2019m hopeful it will be easy to eventually minimize. Either way, reporting the issue now.\r\n\r\nThe assertion looks like this:\r\n\r\n```\r\nthread '<unnamed>' panicked at 'assertion failed: `(left == right)`\r\n  left: `139656431668000`,\r\n  right: `0`', /rustc/58b834344fc7b9185e7a50db1ff24e5eb07dae5e/src/libstd/macros.rs:16:9\r\nstack backtrace:\r\n   0: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n   1: core::fmt::write\r\n   2: std::io::Write::write_fmt\r\n   3: std::panicking::default_hook::{{closure}}\r\n   4: std::panicking::default_hook\r\n   5: std::panicking::rust_panic_with_hook\r\n   6: rust_begin_unwind\r\n   7: std::panicking::begin_panic_fmt\r\n   8: std::sync::mpsc::shared::Packet<T>::recv\r\n   9: std::sync::mpsc::Receiver<T>::recv_timeout\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n\r\nFrom quick read through the code it looks like the assertion being triggered is this one: https://github.com/rust-lang/rust/blob/55299b2ba99432d10f925cd28ff52fe397577371/src/libstd/sync/mpsc/shared.rs#L252\r\n\r\nThe assert appears to be timing sensitive, which makes sense given this involves `recv_timeout`.\r\n\r\nI believe our usage of the channel is fairly typical, we have one thread consuming the channel with `recv_timeout` and multiple threads producing the data. The assert occurs, I believe, within the first couple pushes to the channel.", "closed_by": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/70340/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/70340/timeline", "performed_via_github_app": null, "state_reason": "completed"}