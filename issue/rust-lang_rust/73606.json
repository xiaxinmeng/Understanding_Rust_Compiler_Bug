{"url": "https://api.github.com/repos/rust-lang/rust/issues/73606", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/73606/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/73606/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/73606/events", "html_url": "https://github.com/rust-lang/rust/issues/73606", "id": 642826841, "node_id": "MDU6SXNzdWU2NDI4MjY4NDE=", "number": 73606, "title": "Linker-Plugin-LTO encodes wrong OS ABI in the ELF header", "user": {"login": "stlankes", "id": 5888473, "node_id": "MDQ6VXNlcjU4ODg0NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/5888473?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stlankes", "html_url": "https://github.com/stlankes", "followers_url": "https://api.github.com/users/stlankes/followers", "following_url": "https://api.github.com/users/stlankes/following{/other_user}", "gists_url": "https://api.github.com/users/stlankes/gists{/gist_id}", "starred_url": "https://api.github.com/users/stlankes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stlankes/subscriptions", "organizations_url": "https://api.github.com/users/stlankes/orgs", "repos_url": "https://api.github.com/users/stlankes/repos", "events_url": "https://api.github.com/users/stlankes/events{/privacy}", "received_events_url": "https://api.github.com/users/stlankes/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-22T07:27:15Z", "updated_at": "2021-05-15T17:19:20Z", "closed_at": "2021-05-15T17:19:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am working on the library operating system [RustyHermit](https://github.com/hermitcore/rusty-hermit). If I enable LTO support, I have to use the Linker-Plugin-LTO, because parts of the kernel are provided as static library. Unfortunately,  the final result uses in the ELF file a wrong byte to define the OS ABI. In my case, it encodes the byte of the host operating system.\r\n\r\n```\r\n$ readelf -a target/x86_64-unknown-hermit/release/rusty_demo|less\r\n\r\nELF Header:\r\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 \r\n  Class:                             ELF64\r\n  Data:                              2's complement, little endian\r\n  Version:                           1 (current)\r\n  OS/ABI:                            UNIX - System V\r\n  ABI Version:                       0\r\n  Type:                              EXEC (Executable file)\r\n  Machine:                           Advanced Micro Devices X86-64\r\n  Version:                           0x1\r\n  Entry point address:               0x30a730\r\n  Start of program headers:          64 (bytes into file)\r\n  Start of section headers:          1791520 (bytes into file)\r\n  Flags:                             0x0\r\n  Size of this header:               64 (bytes)\r\n  Size of program headers:           56 (bytes)\r\n  Number of program headers:         7\r\n  Size of section headers:           64 (bytes)\r\n  Number of section headers:         12\r\n  Section header string table index: 10\r\n```\r\n\r\nIn our case. the binary should encode that the application is able run standalonen.  According to the ELF standard `0xff` must be coded. If I disable LTO, the file uses the correct value for the OS ABI.\r\n\r\n```\r\n$ readelf -a target/x86_64-unknown-hermit/debug/rusty_demo|less\r\n\r\nELF Header:\r\n  Magic:   7f 45 4c 46 02 01 01 ff 00 00 00 00 00 00 00 00 \r\n  Class:                             ELF64\r\n  Data:                              2's complement, little endian\r\n  Version:                           1 (current)\r\n  OS/ABI:                            <unknown: ff>\r\n  ABI Version:                       0\r\n  Type:                              EXEC (Executable file)\r\n  Machine:                           Advanced Micro Devices X86-64\r\n  Version:                           0x1\r\n  Entry point address:               0x3c3540\r\n  Start of program headers:          64 (bytes into file)\r\n  Start of section headers:          28120976 (bytes into file)\r\n  Flags:                             0x0\r\n  Size of this header:               64 (bytes)\r\n  Size of program headers:           56 (bytes)\r\n  Number of program headers:         7\r\n  Size of section headers:           64 (bytes)\r\n  Number of section headers:         23\r\n  Section header string table index: 21\r\n```\r\n\r\nBesides this issue, the file is correct. If I change the OS ABI with `elfedit`, the applicationsruns correctly.\r\n\r\nDoes anyone have an idea what this might be caused to?", "closed_by": {"login": "stlankes", "id": 5888473, "node_id": "MDQ6VXNlcjU4ODg0NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/5888473?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stlankes", "html_url": "https://github.com/stlankes", "followers_url": "https://api.github.com/users/stlankes/followers", "following_url": "https://api.github.com/users/stlankes/following{/other_user}", "gists_url": "https://api.github.com/users/stlankes/gists{/gist_id}", "starred_url": "https://api.github.com/users/stlankes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stlankes/subscriptions", "organizations_url": "https://api.github.com/users/stlankes/orgs", "repos_url": "https://api.github.com/users/stlankes/repos", "events_url": "https://api.github.com/users/stlankes/events{/privacy}", "received_events_url": "https://api.github.com/users/stlankes/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/73606/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/73606/timeline", "performed_via_github_app": null, "state_reason": "completed"}