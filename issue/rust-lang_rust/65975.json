{"url": "https://api.github.com/repos/rust-lang/rust/issues/65975", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65975/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65975/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65975/events", "html_url": "https://github.com/rust-lang/rust/issues/65975", "id": 514868310, "node_id": "MDU6SXNzdWU1MTQ4NjgzMTA=", "number": 65975, "title": ">=rust-1.36.0 introduced bleeding of host's -march cflags into foreign rust libs during bootstrap", "user": {"login": "stefson", "id": 14232936, "node_id": "MDQ6VXNlcjE0MjMyOTM2", "avatar_url": "https://avatars.githubusercontent.com/u/14232936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefson", "html_url": "https://github.com/stefson", "followers_url": "https://api.github.com/users/stefson/followers", "following_url": "https://api.github.com/users/stefson/following{/other_user}", "gists_url": "https://api.github.com/users/stefson/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefson/subscriptions", "organizations_url": "https://api.github.com/users/stefson/orgs", "repos_url": "https://api.github.com/users/stefson/repos", "events_url": "https://api.github.com/users/stefson/events{/privacy}", "received_events_url": "https://api.github.com/users/stefson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-10-30T17:54:03Z", "updated_at": "2021-05-28T12:13:24Z", "closed_at": "2021-05-28T12:13:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "seriously, I don't know how to phrase this. I'm a fellow gentoo user, and I've been trying to get compiling of cross compiler rustlib's started, by adding them to config.toml: \r\n\r\n```\r\n[llvm]\r\noptimize = true\r\nrelease-debuginfo = false\r\nassertions = false\r\ntargets = \"X86;ARM\"\r\nexperimental-targets = \"\"\r\nlink-shared = true\r\n[build]\r\nbuild = \"x86_64-unknown-linux-gnu\"\r\nhost = [\"x86_64-unknown-linux-gnu\"]\r\ntarget = [\"x86_64-unknown-linux-gnu\",\"armv7-unknown-linux-gnueabihf\"]\r\ncargo = \"/var/tmp/portage/dev-lang/rust-1.34.2/work/rust-stage0/bin/cargo\"\r\nrustc = \"/var/tmp/portage/dev-lang/rust-1.34.2/work/rust-stage0/bin/rustc\"\r\ndocs = false\r\nsubmodules = false\r\npython = \"python3.6\"\r\nlocked-deps = true\r\nvendor = true\r\nextended = true\r\ntools = [\"rustfmt\",\"cargo\",]\r\n[install]\r\nprefix = \"/usr\"\r\nlibdir = \"lib64/rust-1.34.2\"\r\ndocdir = \"share/doc/rust-1.34.2\"\r\nmandir = \"share/rust-1.34.2/man\"\r\n[rust]\r\noptimize = true\r\ndebuginfo = false\r\ndebug-assertions = false\r\ndefault-linker = \"x86_64-pc-linux-gnu-gcc\"\r\nchannel = \"stable\"\r\nrpath = false\r\nlld = false\r\n[target.x86_64-unknown-linux-gnu]\r\ncc = \"x86_64-pc-linux-gnu-gcc\"\r\ncxx = \"x86_64-pc-linux-gnu-g++\"\r\nlinker = \"x86_64-pc-linux-gnu-gcc\"\r\nar = \"x86_64-pc-linux-gnu-ar\"\r\nllvm-config = \"/usr/lib/llvm/8/bin/llvm-config\"\r\n[target.armv7-unknown-linux-gnueabihf]\r\ncc = \"armv7a-unknown-linux-gnueabihf-gcc\"\r\ncxx = \"armv7a-unknown-linux-gnueabihf-g++\"\r\nlinker = \"armv7a-unknown-linux-gnueabihf-gcc\"\r\nar = \"armv7a-unknown-linux-gnueabihf-ar\"\r\n```\r\n\r\nand then execute via\r\n\r\n`python3.6 ./x.py build --config=\"${path-to-toml.config} -j$(nproc)`\r\n\r\nwait for an hour, everything is fine. \r\n\r\nBut starting with the release of rust-1.36.0, this stopped working, as it would fail at some point in the bootstrap, as there are foreign cflags (from the host) leaking into the env of the foreign rustlibs (armv7 in this case). But only if there's a `-march=` involved, in my case it's `-march=znver1`, which makes the cross compile fail as it's not compatible with armv7. \r\n\r\nI'm going to provide a log with the error soon. In any case, I'm absolutly willing to bisect this, but need some instructions as I'm lost in the hundreds of commits. How can I find the beta1, beta2 etc. pp. commit id's of rust-1.36.0-beta? That would be a good starting point, in my opinion. \r\n\r\nCurrent workaround is: avoid `-march` and refrain to `-O2 -pipe` only ", "closed_by": {"login": "stefson", "id": 14232936, "node_id": "MDQ6VXNlcjE0MjMyOTM2", "avatar_url": "https://avatars.githubusercontent.com/u/14232936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stefson", "html_url": "https://github.com/stefson", "followers_url": "https://api.github.com/users/stefson/followers", "following_url": "https://api.github.com/users/stefson/following{/other_user}", "gists_url": "https://api.github.com/users/stefson/gists{/gist_id}", "starred_url": "https://api.github.com/users/stefson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stefson/subscriptions", "organizations_url": "https://api.github.com/users/stefson/orgs", "repos_url": "https://api.github.com/users/stefson/repos", "events_url": "https://api.github.com/users/stefson/events{/privacy}", "received_events_url": "https://api.github.com/users/stefson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65975/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65975/timeline", "performed_via_github_app": null, "state_reason": "completed"}