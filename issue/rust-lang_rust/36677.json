{"url": "https://api.github.com/repos/rust-lang/rust/issues/36677", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36677/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36677/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36677/events", "html_url": "https://github.com/rust-lang/rust/issues/36677", "id": 178948053, "node_id": "MDU6SXNzdWUxNzg5NDgwNTM=", "number": 36677, "title": "rg crashes with `-C target-cpu=native` on Xeon E5-2670 ", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2016-09-23T18:49:48Z", "updated_at": "2017-06-27T04:02:36Z", "closed_at": "2017-06-27T04:02:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If I `RUSTFLAGS=\"-C target-cpu=native\" cargo install ripgrep` then run `rg --version` it crashes with an illegal instruction.\n\nrg version is 0.1.17, rustc is `rustc 1.13.0-nightly (4f9812a59 2016-09-21)`.\n\n```\nStarting program: /home/brian/.cargo/bin/rg --version\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n\nProgram received signal SIGILL, Illegal instruction.\n0x0000555555594fec in collections::slice::hack::into_vec<collections::string::String> (b=<error reading variable: access outside bounds of object referenced via synthetic pointer>)\n    at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libcollections/slice.rs:140\n140     /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libcollections/slice.rs: No such file or directory.\n(gdb) bt\n#0  0x0000555555594fec in collections::slice::hack::into_vec<collections::string::String> (b=<error reading variable: access outside bounds of object referenced via synthetic pointer>)\n    at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libcollections/slice.rs:140\n#1  collections::slice::{{impl}}::into_vec<collections::string::String> (self=<error reading variable: access outside bounds of object referenced via synthetic pointer>)\n    at /buildslave/rust-buildbot/slave/nightly-dist-rustc-linux/build/obj/../src/libcollections/slice.rs:1165\n#2  rg::args::{{impl}}::parse () at /home/brian/.cargo/registry/src/github.com-1ecc6299db9ec823/ripgrep-0.1.17/src/args.rs:442\n#3  rg::main () at /home/brian/.cargo/registry/src/github.com-1ecc6299db9ec823/ripgrep-0.1.17/src/main.rs:77\n#4  0x0000555555663597 in __rust_maybe_catch_panic ()\n#5  0x000055555565a1cc in std::rt::lang_start::haaae1186de9de8cb ()\n#6  0x00007ffff73f7830 in __libc_start_main (main=0x5555555a8a60 <main>, argc=2, argv=0x7fffffffe238, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>,\n    stack_end=0x7fffffffe228) at ../csu/libc-start.c:291\n#7  0x0000555555568369 in _start ()\n```\n\n```\n(gdb) x/10i $pc\n=> 0x555555594fec <rg::main+28>:        vxorps %xmm0,%xmm0,%xmm0\n   0x555555594ff0 <rg::main+32>:        vmovups %xmm0,-0x48(%rbp)\n   0x555555594ff5 <rg::main+37>:        lea    -0x9a8(%rbp),%rdi\n   0x555555594ffc <rg::main+44>:        callq  0x55555564f480 <_ZN3std3env7args_os17h56ed1cad6d6fff07E>\n   0x555555595001 <rg::main+49>:        vmovups -0x9a8(%rbp),%xmm0\n   0x555555595009 <rg::main+57>:        vmovups -0x998(%rbp),%xmm1\n   0x555555595011 <rg::main+65>:        vmovaps %xmm1,-0x70(%rbp)\n   0x555555595016 <rg::main+70>:        vmovaps %xmm0,-0x80(%rbp)\n   0x55555559501b <rg::main+75>:        xor    %r15d,%r15d\n   0x55555559501e <rg::main+78>:        mov    $0x1,%r12d\n```\n\n```\n$ cat /proc/cpuinfo\nprocessor       : 0\nvendor_id       : GenuineIntel\ncpu family      : 6\nmodel           : 62\nmodel name      : Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\nstepping        : 4\nmicrocode       : 0x415\ncpu MHz         : 2500.096\ncache size      : 25600 KB\nphysical id     : 1\nsiblings        : 4\ncore id         : 0\ncpu cores       : 1\napicid          : 32\ninitial apicid  : 32\nfpu             : yes\nfpu_exception   : yes\ncpuid level     : 13\nwp              : yes\nflags           : fpu de tsc msr pae cx8 apic sep cmov pat clflush mmx fxsr sse sse2 ss ht syscall nx lm constant_tsc rep_good nopl pni pclmulqdq ssse3 cx16 sse4_1 sse4_2 popcnt tsc_deadline_timer aes rdrand hypervisor lahf_lm epb fsgsbase erms dtherm ida arat pln pts\nbugs            :\nbogomips        : 5000.19\nclflush size    : 64\ncache_alignment : 64\naddress sizes   : 46 bits physical, 48 bits virtual\npower management:\n```\n\nSeems like rustc is using avx2 when it doesn't exist. cc @BurntSushi \n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36677/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36677/timeline", "performed_via_github_app": null, "state_reason": "completed"}