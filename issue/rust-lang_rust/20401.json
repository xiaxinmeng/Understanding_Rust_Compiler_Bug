{"url": "https://api.github.com/repos/rust-lang/rust/issues/20401", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20401/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20401/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20401/events", "html_url": "https://github.com/rust-lang/rust/issues/20401", "id": 53222349, "node_id": "MDU6SXNzdWU1MzIyMjM0OQ==", "number": 20401, "title": "ICE due to dereferencing core::result::Result", "user": {"login": "gal-leib", "id": 396845, "node_id": "MDQ6VXNlcjM5Njg0NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/396845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gal-leib", "html_url": "https://github.com/gal-leib", "followers_url": "https://api.github.com/users/gal-leib/followers", "following_url": "https://api.github.com/users/gal-leib/following{/other_user}", "gists_url": "https://api.github.com/users/gal-leib/gists{/gist_id}", "starred_url": "https://api.github.com/users/gal-leib/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gal-leib/subscriptions", "organizations_url": "https://api.github.com/users/gal-leib/orgs", "repos_url": "https://api.github.com/users/gal-leib/repos", "events_url": "https://api.github.com/users/gal-leib/events{/privacy}", "received_events_url": "https://api.github.com/users/gal-leib/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-01-01T15:51:39Z", "updated_at": "2015-01-12T04:40:23Z", "closed_at": "2015-01-12T04:40:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Code Example\n\nthis was taken from the intro doc, a few days ago. Notice that in the latest nightly you need to add a call to unwrap() after lock().\n\n``` rust\nuse std::thread::Thread;\nuse std::sync::{Arc,Mutex};\n\nfn main() {\n    let numbers = Arc::new(Mutex::new(vec![1i, 2i, 3i]));\n\n    for i in range(0u, 3u) {\n        let number = numbers.clone();\n        Thread::spawn(move || {\n            let mut array = number.lock();\n\n            (*array)[i] += 1;\n\n            println!(\"numbers[{}] is {}\", i, (*array)[i]);\n        }).detach();\n    }\n}\n```\n# Output\n\n``` rust\nfff.rs:12:14: 12:20 error: type `core::result::Result<std::sync::mutex::MutexGuard<'_, collections::vec::Vec<int>>, std::sync::poison::PoisonError<std::sync::mutex::MutexGuard<'_, collections::vec::Vec<int>>>>` cannot be dereferenced\nfff.rs:12             (*array)[i] += 1;\n                       ^~~~~~\nfff.rs:14:47: 14:53 error: type `core::result::Result<std::sync::mutex::MutexGuard<'_, collections::vec::Vec<int>>, std::sync::poison::PoisonError<std::sync::mutex::MutexGuard<'_, collections::vec::Vec<int>>>>` cannot be dereferenced\nfff.rs:14             println!(\"numbers[{}] is {}\", i, (*array)[i]);\n                                                        ^~~~~~\nnote: in expansion of format_args!\n<std macros>:2:54: 2:77 note: expansion site\n<std macros>:1:1: 3:2 note: in expansion of println!\nfff.rs:14:13: 14:59 note: expansion site\nerror: internal compiler error: no type for node 71: expr i (id=71) in fcx 0x7fb3b9feca18\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/libsyntax/diagnostic.rs:182\n\nstack backtrace:\n   1:     0x7fb3c194f950 - sys::backtrace::write::h895a7595e35ffe42gnt\n   2:     0x7fb3c1974660 - failure::on_fail::hb3298435971cff34kEz\n   3:     0x7fb3c18db940 - rt::unwind::begin_unwind_inner::h6dee24d5dc335a63oiz\n   4:     0x7fb3bcaadcc0 - rt::unwind::begin_unwind::h12623432956124006653\n   5:     0x7fb3bcaae570 - diagnostic::Handler::bug::ha9b616024b46f3aebVF\n   6:     0x7fb3bfb4b770 - session::Session::bug::h12be686e19b5b0bazyp\n   7:     0x7fb3c0f11390 - check::FnCtxt<'a, 'tcx>::node_ty::h9b8a67e28e41ba8bSGl\n   8:     0x7fb3c0f24e50 - check::writeback::WritebackCx<'cx, 'tcx>::visit_node_id::h2c4dc3387755279ctHb\n   9:     0x7fb3c0f210e0 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h2f0f77b56a4c1394exb\n  10:     0x7fb3c0f24d50 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_block::h91bc12c657353988uyb\n  11:     0x7fb3c0f2c970 - visit::walk_fn::h10733558075477871190\n  12:     0x7fb3c0f210e0 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h2f0f77b56a4c1394exb\n  13:     0x7fb3c0f210e0 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h2f0f77b56a4c1394exb\n  14:     0x7fb3c0f210e0 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h2f0f77b56a4c1394exb\n  15:     0x7fb3c0f24d50 - check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_block::h91bc12c657353988uyb\n  16:     0x7fb3c0fe32c0 - check::check_bare_fn::h24d3cb693ab9ca75Qzj\n  17:     0x7fb3c0fda950 - check::check_item::hb991f99d47aa82ceSSj\n  18:     0x7fb3c117b030 - check_crate::unboxed_closure.39833\n  19:     0x7fb3c1175dd0 - check_crate::hb802e7bb2dee1cd6NLx\n  20:     0x7fb3c1e98860 - driver::phase_3_run_analysis_passes::h83e2236a47a83223qva\n  21:     0x7fb3c1e870a0 - driver::compile_input::h2bdea93b5d9f3dbfwba\n  22:     0x7fb3c1fd2970 - thunk::F.Invoke<A, R>::invoke::h11261394929911795771\n  23:     0x7fb3c1fd1720 - rt::unwind::try::try_fn::h18390836921836612068\n  24:     0x7fb3c19da2d0 - rust_try_inner\n  25:     0x7fb3c19da2c0 - rust_try\n  26:     0x7fb3c1fd1a70 - thunk::F.Invoke<A, R>::invoke::h16439250889300796363\n  27:     0x7fb3c1961300 - sys::thread::thread_start::haeaaf0233fbdd5c3bgw\n  28:     0x7fb3bc2cf460 - start_thread\n  29:     0x7fb3c1590749 - clone\n  30:                0x0 - <unknown>\n```\n# Version\n\nrustc 0.13.0-nightly (7608dbad6 2014-12-31 10:06:21 -0800)\nbinary: rustc\ncommit-hash: 7608dbad651f02e837ed05eef3d74a6662a6e928\ncommit-date: 2014-12-31 10:06:21 -0800\nhost: x86_64-unknown-linux-gnu\nrelease: 0.13.0-nightly\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20401/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20401/timeline", "performed_via_github_app": null, "state_reason": "completed"}