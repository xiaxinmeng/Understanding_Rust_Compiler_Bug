{"url": "https://api.github.com/repos/rust-lang/rust/issues/88252", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/88252/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/88252/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/88252/events", "html_url": "https://github.com/rust-lang/rust/issues/88252", "id": 976758178, "node_id": "MDU6SXNzdWU5NzY3NTgxNzg=", "number": 88252, "title": "AVR: Cannot compile compiler_builtins in either release or debug mode with nightly 2021-08-21", "user": {"login": "gergoerdi", "id": 116009, "node_id": "MDQ6VXNlcjExNjAwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/116009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gergoerdi", "html_url": "https://github.com/gergoerdi", "followers_url": "https://api.github.com/users/gergoerdi/followers", "following_url": "https://api.github.com/users/gergoerdi/following{/other_user}", "gists_url": "https://api.github.com/users/gergoerdi/gists{/gist_id}", "starred_url": "https://api.github.com/users/gergoerdi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gergoerdi/subscriptions", "organizations_url": "https://api.github.com/users/gergoerdi/orgs", "repos_url": "https://api.github.com/users/gergoerdi/repos", "events_url": "https://api.github.com/users/gergoerdi/events{/privacy}", "received_events_url": "https://api.github.com/users/gergoerdi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1884641928, "node_id": "MDU6TGFiZWwxODg0NjQxOTI4", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AVR", "name": "O-AVR", "color": "6e6ec0", "default": false, "description": "Target: AVR processors (ATtiny, ATmega, etc.)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2021-08-23T08:15:13Z", "updated_at": "2023-04-05T17:35:34Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Compiling a pretty much empty project for AVR brings in `compiler_builtins` as a dependency, but then building that fails with a segfault (with `--release`) or a a `ran out of registers during register allocation` error message.\r\n\r\nTo reproduce, make the following files:\r\n\r\n# `Cargo.toml`\r\n\r\n```\r\n[package]\r\nname = \"foo\"\r\nversion = \"0.1.0\"\r\n```\r\n\r\n# `.cargo/config`\r\n\r\n```\r\n[build]\r\ntarget = \"avr-unknown-gnu-atmega328\"\r\n\r\n[unstable]\r\nbuild-std = [\"core\"]\r\n```\r\n\r\n# `src/main.rs`\r\n\r\n```\r\n#![no_std]\r\n#![no_main]\r\n\r\n#[no_mangle]\r\npub extern fn main() {\r\n}\r\n```\r\n\r\nBuild logs:\r\n\r\n```\r\n$ cargo build \r\n   Compiling core v0.0.0 (/home/cactus/sdk/rust/rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core)\r\n   Compiling compiler_builtins v0.1.49\r\n   Compiling rustc-std-workspace-core v1.99.0 (rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/rustc-std-workspace-core)\r\nerror: ran out of registers during register allocation\r\n\r\nerror: could not compile `core` due to previous error\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\n```\r\n\r\n```\r\n$ cargo build --release\r\n   Compiling compiler_builtins v0.1.49\r\n   Compiling core v0.0.0 (rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core)\r\n   Compiling rustc-std-workspace-core v1.99.0 (rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/rustc-std-workspace-core)\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x4ffee3)[0x7f4b5705dee3]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x141f0)[0x7f4b567be1f0]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm12MachineInstr15addRegisterDeadENS_8RegisterEPKNS_18TargetRegisterInfoEb+0xe1)[0x7f4b536eb021]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm13LiveIntervals17computeDeadValuesERNS_12LiveIntervalEPNS_15SmallVectorImplIPNS_12MachineInstrEEE+0x2ab)[0x7f4b5363bd1b]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm13LiveIntervals12shrinkToUsesEPNS_12LiveIntervalEPNS_15SmallVectorImplIPNS_12MachineInstrEEE+0x492)[0x7f4b5363d242]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm13LiveRangeEdit17eliminateDeadDefsERNS_15SmallVectorImplIPNS_12MachineInstrEEENS_8ArrayRefINS_8RegisterEEEPNS_9AAResultsE+0x20a)[0x7f4b5365811a]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(+0x25af0f2)[0x7f4b536090f2]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm12RegAllocBase16postOptimizationEv+0x17)[0x7f4b5382adf7]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(+0x27e04ca)[0x7f4b5383a4ca]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm19MachineFunctionPass13runOnFunctionERNS_8FunctionE+0xee)[0x7f4b536dcfde]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE+0x639)[0x7f4b53479429]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE+0x33)[0x7f4b534803e3]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.56.0-nightly.so(_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE+0x470)[0x7f4b53479c90]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x2129268)[0x7f4b58c87268]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x20b004f)[0x7f4b58c0e04f]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x20b2f70)[0x7f4b58c10f70]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x20be46b)[0x7f4b58c1c46b]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x20b7d84)[0x7f4b58c15d84]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x20f9d3c)[0x7f4b58c57d3c]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f66b15f11dec651a.so(+0x211631c)[0x7f4b58c7431c]\r\nrustup/toolchains/nightly-x86_64-unknown-linux-gnu/bin/../lib/libstd-1dd6c19f0820d51d.so(rust_metadata_std_155e9b00b45252a2+0xa9fe3)[0x7f4b5689bfe3]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x9450)[0x7f4b567b3450]\r\n/lib/x86_64-linux-gnu/libc.so.6(clone+0x43)[0x7f4b566c1d53]\r\nerror: could not compile `compiler_builtins`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name compiler_builtins .cargo/registry/src/github.com-1ecc6299db9ec823/compiler_builtins-0.1.49/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C embed-bitcode=no --cfg 'feature=\"compiler-builtins\"' --cfg 'feature=\"core\"' --cfg 'feature=\"default\"' --cfg 'feature=\"rustc-dep-of-std\"' -C metadata=35ae16dbb58b86b3 -C extra-filename=-35ae16dbb58b86b3 --out-dir prog/rust/avr/compiler-builtins-bug/target/avr-unknown-gnu-atmega328/release/deps --target avr-unknown-gnu-atmega328 -Z force-unstable-if-unmarked -L dependency=prog/rust/avr/compiler-builtins-bug/target/avr-unknown-gnu-atmega328/release/deps -L dependency=prog/rust/avr/compiler-builtins-bug/target/release/deps --extern core=prog/rust/avr/compiler-builtins-bug/target/avr-unknown-gnu-atmega328/release/deps/librustc_std_workspace_core-feaa69e1bf1370b5.rmeta --cap-lints allow --cfg 'feature=\"unstable\"'` (signal: 11, SIGSEGV: invalid memory reference)\r\n\r\n```\r\n", "closed_by": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/88252/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/88252/timeline", "performed_via_github_app": null, "state_reason": "reopened"}