{"url": "https://api.github.com/repos/rust-lang/rust/issues/107278", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107278/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107278/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107278/events", "html_url": "https://github.com/rust-lang/rust/issues/107278", "id": 1555685682, "node_id": "I_kwDOAAsO6M5cueEy", "number": 107278, "title": "`#[doc(hidden)]` causes type's traits to disappear from rustdoc JSON built with `--document-hidden-items`", "user": {"login": "obi1kenobi", "id": 2348618, "node_id": "MDQ6VXNlcjIzNDg2MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/2348618?v=4", "gravatar_id": "", "url": "https://api.github.com/users/obi1kenobi", "html_url": "https://github.com/obi1kenobi", "followers_url": "https://api.github.com/users/obi1kenobi/followers", "following_url": "https://api.github.com/users/obi1kenobi/following{/other_user}", "gists_url": "https://api.github.com/users/obi1kenobi/gists{/gist_id}", "starred_url": "https://api.github.com/users/obi1kenobi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/obi1kenobi/subscriptions", "organizations_url": "https://api.github.com/users/obi1kenobi/orgs", "repos_url": "https://api.github.com/users/obi1kenobi/repos", "events_url": "https://api.github.com/users/obi1kenobi/events{/privacy}", "received_events_url": "https://api.github.com/users/obi1kenobi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2682491374, "node_id": "MDU6TGFiZWwyNjgyNDkxMzc0", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-rustdoc-json", "name": "A-rustdoc-json", "color": "f7e101", "default": false, "description": "Area: Rustdoc JSON backend"}, {"id": 3921860029, "node_id": "LA_kwDOAAsO6M7pwtW9", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-has-mcve", "name": "S-has-mcve", "color": "862eff", "default": false, "description": "A Minimal Complete and Verifiable Example has been found for this issue"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-01-24T21:23:09Z", "updated_at": "2023-03-06T22:13:46Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Affected crate: `toml_edit`, at path `crates/toml_edit` in repo https://github.com/toml-rs/toml\r\nCommit: d86370fc5e8777e532de457cb6569feeae6429f0\r\nBuilding rustdoc JSON with `RUSTDOCFLAGS=\"-Z unstable-options --document-private-items --document-hidden-items --output-format=json\"`\r\n\r\nConsider the following type from `crates/toml_edit/src/easy/value.rs` in that commit:\r\n```rust\r\n#[doc(hidden)]\r\n#[deprecated(since = \"0.18.0\", note = \"Replaced with `toml::Value`\")]\r\n#[derive(PartialEq, Clone, Debug, serde::Serialize)]\r\n#[serde(untagged)]\r\npub enum Value {\r\n    // < omitted >\r\n}\r\n```\r\n\r\nI expected to see this happen: the rustdoc JSON should state that `PartialEq, Clone, Debug, Send, Sync, Unpin` etc. are all implemented for that type.\r\n\r\nInstead, this happened: none of those traits are listed as implemented for that type.\r\n\r\nDeleting `#[doc(hidden)]` and rebuilding the rustdoc JSON causes all the missing trait impls to be present again.\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.66.1 (90743e729 2023-01-10)\r\nbinary: rustc\r\ncommit-hash: 90743e7298aca107ddaa0c202a4d3604e29bfeb6\r\ncommit-date: 2023-01-10\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.66.1\r\nLLVM version: 15.0.2\r\n```\r\n\r\nThe same bug is present on nightly:\r\n```\r\nrustc 1.69.0-nightly (c8e6a9e8b 2023-01-23)\r\nbinary: rustc\r\ncommit-hash: c8e6a9e8b6251bbc8276cb78cabe1998deecbed7\r\ncommit-date: 2023-01-23\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.69.0-nightly\r\nLLVM version: 15.0.7\r\n```\r\n\r\nThe bug was first spotted by @epage who filed [a bug report](https://github.com/obi1kenobi/cargo-semver-checks/discussions/296#discussioncomment-4742719) on `cargo-semver-checks` for incorrectly reporting that types stopped being `Send / Sync / Debug / Clone` etc. Of course we now know this was because those traits were genuinely not present in the underlying rustdoc JSON file.\r\n\r\nThanks for all the awesome work you've been doing! It's been absolutely fundamental for `cargo-semver-checks`.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107278/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107278/timeline", "performed_via_github_app": null, "state_reason": null}