{"url": "https://api.github.com/repos/rust-lang/rust/issues/32981", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/32981/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/32981/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/32981/events", "html_url": "https://github.com/rust-lang/rust/issues/32981", "id": 148526662, "node_id": "MDU6SXNzdWUxNDg1MjY2NjI=", "number": 32981, "title": "test harness does not give file name for panics in macros", "user": {"login": "jonhoo", "id": 176295, "node_id": "MDQ6VXNlcjE3NjI5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/176295?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonhoo", "html_url": "https://github.com/jonhoo", "followers_url": "https://api.github.com/users/jonhoo/followers", "following_url": "https://api.github.com/users/jonhoo/following{/other_user}", "gists_url": "https://api.github.com/users/jonhoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonhoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonhoo/subscriptions", "organizations_url": "https://api.github.com/users/jonhoo/orgs", "repos_url": "https://api.github.com/users/jonhoo/repos", "events_url": "https://api.github.com/users/jonhoo/events{/privacy}", "received_events_url": "https://api.github.com/users/jonhoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-04-15T01:14:46Z", "updated_at": "2017-05-07T20:20:16Z", "closed_at": "2017-05-07T20:20:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "**Description**:\nIf a test case fails with a panic inside of a macro invocation, the test file name is not included in the stack trace. Originally reported as rust-lang/cargo#2581, but moved here at the request of the maintainers there.\n\n**Steps to reproduce**:\n\n``` rust\n// test.rs\n#[test]\nfn it_works() {\n    use std::collections::HashMap;\n    let x: HashMap<&str, &str> = HashMap::new();\n    assert_eq!(x[\"y\"], \"z\");\n}\n```\n\n**Actual output**:\n\n``` console\n$ rustc --test -g test.rs\n$ ./test\nrunning 1 test\ntest it_works ... FAILED\n\nfailures:\n\n---- it_works stdout ----\n    thread 'it_works' panicked at 'no entry found for key', ../src/libcore/option.rs:704\nstack backtrace:\n   1:     0x5600cbbf14a0 - sys::backtrace::tracing::imp::write::h3675b4f0ca767761Xcv\n   2:     0x5600cbbf3e5b - panicking::default_handler::_$u7b$$u7b$closure$u7d$$u7d$::closure.44519\n   3:     0x5600cbbf3a13 - panicking::default_handler::h18faf4fbd296d909lSz\n   4:     0x5600cbbe7bec - sys_common::unwind::begin_unwind_inner::hfb5d07d6e405c6bbg1t\n   5:     0x5600cbbe8038 - sys_common::unwind::begin_unwind_fmt::h8b491a76ae84af35m0t\n   6:     0x5600cbbf0911 - rust_begin_unwind\n   7:     0x5600cbc233ef - panicking::panic_fmt::h98b8cbb286f5298alcM\n   8:     0x5600cbc27dd4 - option::expect_failed::ha2bedd125befb493uGO\n   9:     0x5600cbba8cdf - option::Option<T>::expect::h5884297980627299622\n                        at ../src/libcore/option.rs:298\n  10:     0x5600cbba8c7f - collections::hash::map::HashMap<K, V, S>.Index<&'a Q>::index::h15197474938586646891\n                        at ../src/libstd/collections/hash/map.rs:1315\n  11:     0x5600cbba6e4b - it_works::h86b830f3898815a4eaa\n                        at /tmp/src/<std macros>:5\n  12:     0x5600cbbcadb6 - boxed::F.FnBox<A>::call_box::h12974170719861018744\n  13:     0x5600cbbcd4ab - sys_common::unwind::try::try_fn::h16547832986514587285\n  14:     0x5600cbbf089b - __rust_try\n  15:     0x5600cbbee06d - sys_common::unwind::inner_try::hadd81c754a64f07ciYt\n  16:     0x5600cbbcd82a - boxed::F.FnBox<A>::call_box::h8956144540797489804\n  17:     0x5600cbbf2909 - sys::thread::Thread::new::thread_start::h9bc812305b5e01feFPy\n  18:     0x7f1c7eb70423 - start_thread\n  19:     0x7f1c7e699cbc - clone\n  20:                0x0 - <unknown>\n\n\nfailures:\n    it_works\n\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured\n```\n\nNotice that backtrace segment number 11 says that the error occurred in `/tmp/<std macros>:7`.\n\n**Expected output**:\n\n```\n\u2026\n  11:     0x5600cbba6e4b - it_works::h86b830f3898815a4eaa\n                        at /tmp/test.rs:7\n\u2026\n```\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/32981/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/32981/timeline", "performed_via_github_app": null, "state_reason": "completed"}