{"url": "https://api.github.com/repos/rust-lang/rust/issues/36642", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36642/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36642/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36642/events", "html_url": "https://github.com/rust-lang/rust/issues/36642", "id": 178505336, "node_id": "MDU6SXNzdWUxNzg1MDUzMzY=", "number": 36642, "title": "rustc panics with \"No def'n found for DefId\" using external eh_personality", "user": {"login": "yotann", "id": 1542154, "node_id": "MDQ6VXNlcjE1NDIxNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1542154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yotann", "html_url": "https://github.com/yotann", "followers_url": "https://api.github.com/users/yotann/followers", "following_url": "https://api.github.com/users/yotann/following{/other_user}", "gists_url": "https://api.github.com/users/yotann/gists{/gist_id}", "starred_url": "https://api.github.com/users/yotann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yotann/subscriptions", "organizations_url": "https://api.github.com/users/yotann/orgs", "repos_url": "https://api.github.com/users/yotann/repos", "events_url": "https://api.github.com/users/yotann/events{/privacy}", "received_events_url": "https://api.github.com/users/yotann/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-09-22T02:27:23Z", "updated_at": "2021-06-01T06:14:30Z", "closed_at": "2021-06-01T06:10:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "When compiling this code:\n\n``` rust\n#![feature(alloc)]                                \n#![feature(lang_items)]\n#![feature(start)]\n#![no_std]\n\nextern crate alloc;\n\n#[start] fn start(_argc: isize, _argv: *const *const u8) -> isize {\n    alloc::boxed::Box::<i32>::new(17);\n    0\n}\n\n#[lang = \"panic_fmt\"] extern fn panic_fmt() -> ! { loop {} }\n\n#[lang = \"eh_personality\"]\nextern \"C\" {\n    fn eh_personality();\n}\n```\n\nrustc panics with the following error:\n\n`error: internal compiler error: ../src/librustc/ty/mod.rs:2091: No def'n found for DefId { krate: 0, node: DefIndex(6) => lib/45447b7afbd5e544f7d0f1df0fccd26014d9850130abd3f020b89ff96b82079f-exe::[0] } in tcx.tcache`\n\nrustc works fine if the `eh_personality` declaration is replaced with an empty definition:\n\n``` rust\n#[lang = \"eh_personality\"]\nextern \"C\" fn eh_personality() {}\n```\n\nI'm not sure whether using an external `eh_personality` is ever useful, but the crash is unexpected and confusing.\n## Meta\n\n`rustc --version --verbose`:\nrustc 1.13.0-nightly (c772948b6 2016-09-20)\nbinary: rustc\ncommit-hash: c772948b687488a087356cb91432425662e034b9\ncommit-date: 2016-09-20\nhost: x86_64-unknown-linux-gnu\nrelease: 1.13.0-nightly\n\nBacktrace:\n\n```\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:655\nstack backtrace:\n   1:      0x37b45a1fb12 - std::sys::backtrace::tracing::imp::write::h4b09e6e8c01db097\n   2:      0x37b45a38ead - std::panicking::default_hook::{{closure}}::h1d3243f546573ff4\n   3:      0x37b45a2df9e - std::panicking::default_hook::h96c288d728df3ebf\n   4:      0x37b45a2e688 - std::panicking::rust_panic_with_hook::hb1322e5f2588b4db\n   5:      0x37b3e577ab7 - std::panicking::begin_panic::hb7c71bbc491f561c\n   6:      0x37b3e588b48 - rustc_errors::Handler::bug::h6a6af37ebad32a7a\n   7:      0x37b42f77fda - rustc::session::opt_span_bug_fmt::{{closure}}::h6ad7caa20ac20c4b\n   8:      0x37b42e8ecd5 - rustc::session::opt_span_bug_fmt::h38eb39636c07401c\n   9:      0x37b42e8eb12 - rustc::session::bug_fmt::hd87c9038863af104\n  10:      0x37b42f0a6ce - rustc::ty::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::lookup_item_type::h372a3f7763a0220b\n  11:      0x37b452dd446 - rustc_trans::callee::Callee::def::h6369cae153140977\n  12:      0x37b452ee730 - rustc_trans::common::FunctionContext::eh_personality::h7b5427749cb96f20\n  13:      0x37b45365ffe - rustc_trans::mir::block::<impl rustc_trans::mir::MirContext<'bcx, 'tcx>>::trans_block::{{closure}}::h3fd18ad9e74ddeba\n  14:      0x37b4532e34a - rustc_trans::mir::block::<impl rustc_trans::mir::MirContext<'bcx, 'tcx>>::trans_block::he2f6252e2877e76b\n  15:      0x37b45328af8 - rustc_trans::mir::trans_mir::hc6963a43e5e7752b\n  16:      0x37b452c8d9b - rustc_trans::base::trans_closure::h7d9d1480ec1824e6\n  17:      0x37b45349e8c - rustc_trans::trans_item::TransItem::define::hfbf0030d6e6abc40\n  18:      0x37b452cc3e4 - rustc_trans::base::trans_crate::h45437752c34c2c6e\n  19:      0x37b45dfdbed - rustc_driver::driver::phase_4_translate_to_llvm::h1b8076dc9a7a3e1b\n  20:      0x37b45e36ffc - rustc_driver::driver::compile_input::{{closure}}::hdf708031c67974d4\n  21:      0x37b45e285ef - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::hcac3a2328cd9259a\n  22:      0x37b45df10de - rustc_driver::driver::phase_3_run_analysis_passes::h9865057b323cad0e\n  23:      0x37b45de2b4a - rustc_driver::driver::compile_input::hc0edbed7edb3eb18\n  24:      0x37b45e10521 - rustc_driver::run_compiler::h22d678d32fb7c300\n  25:      0x37b45d49ea3 - std::panicking::try::do_call::h4d040997e2efdaf3\n  26:      0x37b45a40da6 - __rust_maybe_catch_panic\n  27:      0x37b45d68ef9 - <F as alloc::boxed::FnBox<A>>::call_box::hba0b436c79e56b23\n  28:      0x37b45a2c9d0 - std::sys::thread::Thread::new::thread_start::h022e3887023c6290\n  29:      0x37b3dd1f453 - start_thread\n  30:      0x37b456867de - __GI___clone\n  31:                0x0 - <unknown>\n```\n", "closed_by": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36642/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36642/timeline", "performed_via_github_app": null, "state_reason": "completed"}