{"url": "https://api.github.com/repos/rust-lang/rust/issues/69752", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69752/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69752/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69752/events", "html_url": "https://github.com/rust-lang/rust/issues/69752", "id": 576652378, "node_id": "MDU6SXNzdWU1NzY2NTIzNzg=", "number": 69752, "title": "Enabling LTO generates broken code", "user": {"login": "almindor", "id": 1950958, "node_id": "MDQ6VXNlcjE5NTA5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1950958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/almindor", "html_url": "https://github.com/almindor", "followers_url": "https://api.github.com/users/almindor/followers", "following_url": "https://api.github.com/users/almindor/following{/other_user}", "gists_url": "https://api.github.com/users/almindor/gists{/gist_id}", "starred_url": "https://api.github.com/users/almindor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/almindor/subscriptions", "organizations_url": "https://api.github.com/users/almindor/orgs", "repos_url": "https://api.github.com/users/almindor/repos", "events_url": "https://api.github.com/users/almindor/events{/privacy}", "received_events_url": "https://api.github.com/users/almindor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-06T02:18:26Z", "updated_at": "2020-03-06T17:49:44Z", "closed_at": "2020-03-06T17:49:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Enabling LTO optimizations on [this project](https://github.com/almindor/pinetime-quickstart) as set in [Cargo.toml](https://github.com/almindor/pinetime-quickstart/blob/master/Cargo.toml#L30-L33) produces broken code in release mode for the `ferris_display` example binary.\r\n\r\nRemoving the profile setup lines fixes it although it seems to be specifically tied to `lto = true`.\r\n\r\nIf LTO is not enabled the code is almost 2x in text section size (using `size`) and works as expected.\r\n\r\nEnabling LTO breaks the code somehow. It does \"run\" and even the final \"rendering done\" message is shown, however nothing related to rendering seems to be done. The display stays exactly as before, as if the `embedded-graphics` pipeline did not get called.\r\n\r\nI'll try to find out if the missing piece can be identified. Sadly there's no easy way to test this outside of having a pinetime device.\r\n\r\nNOTE: I have tested with version 1.38.0 and 1.32.0 in addition to latest stable and all seem to have the same behavior. Another person also reproduced this on their setup.\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.41.1 (f3e1a954d 2020-02-24)\r\nbinary: rustc\r\ncommit-hash: f3e1a954d2ead4e2fc197c7da7d71e6c61bad196\r\ncommit-date: 2020-02-24\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.41.1\r\nLLVM version: 9.0\r\n```\r\n\r\n\r\n", "closed_by": {"login": "almindor", "id": 1950958, "node_id": "MDQ6VXNlcjE5NTA5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1950958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/almindor", "html_url": "https://github.com/almindor", "followers_url": "https://api.github.com/users/almindor/followers", "following_url": "https://api.github.com/users/almindor/following{/other_user}", "gists_url": "https://api.github.com/users/almindor/gists{/gist_id}", "starred_url": "https://api.github.com/users/almindor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/almindor/subscriptions", "organizations_url": "https://api.github.com/users/almindor/orgs", "repos_url": "https://api.github.com/users/almindor/repos", "events_url": "https://api.github.com/users/almindor/events{/privacy}", "received_events_url": "https://api.github.com/users/almindor/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69752/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69752/timeline", "performed_via_github_app": null, "state_reason": "completed"}