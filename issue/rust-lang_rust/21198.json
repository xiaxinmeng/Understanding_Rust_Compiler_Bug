{"url": "https://api.github.com/repos/rust-lang/rust/issues/21198", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21198/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21198/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21198/events", "html_url": "https://github.com/rust-lang/rust/issues/21198", "id": 54459958, "node_id": "MDU6SXNzdWU1NDQ1OTk1OA==", "number": 21198, "title": "new scoping rules for safe dtors may benefit from variance on type params", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-01-15T15:12:50Z", "updated_at": "2017-11-30T15:35:18Z", "closed_at": "2017-05-02T15:55:07Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Spawned off of #21022, #21972.\n\nAs discussed on this commit https://github.com/pnkfelix/rust/commit/8ee3c94f4ebca092bda5a4ee78b44d1a6706dcc1\n\nthere are example programs (both artificial and in the wild) that have to change under the current implementation of the new scoping rules, but might not require such change if we add support for variance of type parameters: https://github.com/rust-lang/rfcs/issues/281\n\n---\n\nAn easy example of this, taken from the discussion on the above commit, is the following:\n\n``` rust\nfn main() {\n    let x = 3u8;\n    let p = Option::Some(&x); // call the implicit lifetime here `&'_#1 x`\n    let y = 4u8;\n    constraints(p, &y); // call the implicit lifetime here `&'_#2 y`\n}\n\nfn constraints<'a> (px: Option<&'a u8>, py: &'a u8)\n{\n    loop  { }\n}\n```\n\nUnder the region inference constraints (regardless of which scoping rules have been adopted), `'_#1` has to outlive `p`, while `'_#2` cannot outlive `y`, and the call to `constraints` is trying to find a `'a` compatible with `'_#1` and `'_#2`.\n\nUnder the old scoping rules, `p` and `y` had the same scope, so the constraint set is satisfiable.\n\nUnder the new scoping rules, the scope of `y` is strictly less than that of `p`, so the constraint set is no longer satisfiable.\n\n---\n\nThe solution adopted in #21022 is to move the binding of `y` up above the binding of `p`.\n\nBut an alternative solution is this: If RFC Issue 281 https://github.com/rust-lang/rfcs/issues/281 leads to type parameter variance being implemented, then cases like this might be directly expressible (because the lifetime `'_#1` will continue to outlive `p`, but the occurrence of `p` in the call to `constraints` would use variance to assign the scope of `y` (a sublifetime of `'_#1`) as the new lifetime embedded within the type of `p`.\n\nThis ticket is to mark cases that we should revisit if/when type parameter variance is implemented.\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21198/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21198/timeline", "performed_via_github_app": null, "state_reason": "completed"}