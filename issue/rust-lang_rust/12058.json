{"url": "https://api.github.com/repos/rust-lang/rust/issues/12058", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12058/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12058/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12058/events", "html_url": "https://github.com/rust-lang/rust/issues/12058", "id": 27027044, "node_id": "MDU6SXNzdWUyNzAyNzA0NA==", "number": 12058, "title": "segfault when trying to write multiple times to a socket moved across a task boundary", "user": {"login": "vogon", "id": 88932, "node_id": "MDQ6VXNlcjg4OTMy", "avatar_url": "https://avatars.githubusercontent.com/u/88932?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vogon", "html_url": "https://github.com/vogon", "followers_url": "https://api.github.com/users/vogon/followers", "following_url": "https://api.github.com/users/vogon/following{/other_user}", "gists_url": "https://api.github.com/users/vogon/gists{/gist_id}", "starred_url": "https://api.github.com/users/vogon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vogon/subscriptions", "organizations_url": "https://api.github.com/users/vogon/orgs", "repos_url": "https://api.github.com/users/vogon/repos", "events_url": "https://api.github.com/users/vogon/events{/privacy}", "received_events_url": "https://api.github.com/users/vogon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2014-02-06T04:57:49Z", "updated_at": "2014-02-06T05:03:44Z", "closed_at": "2014-02-06T05:02:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "hey, I'm working on trying to make a multi-client network server as my first project in Rust, so I've got this small hello-worldish program:\n\n```\nextern mod extra;\n\nuse std::io::{Listener, Acceptor};\nuse std::io::net::ip::SocketAddr;\nuse std::io::net::tcp::{TcpListener, TcpStream};\nuse std::io::timer;\n\nfn main() {\n    let addr = from_str::<SocketAddr>(\"0.0.0.0:3569\").unwrap();\n    let listener = TcpListener::bind(addr).unwrap();\n\n    let mut acceptor = listener.listen().unwrap();\n\n    loop {\n        let mut stream: TcpStream = acceptor.accept().unwrap();\n\n        stream.write_str(\"hey hi\\r\\n\");\n\n        spawn(proc() {\n            loop {\n                let mut stream = stream;\n\n                stream.write_str(\"ping\\r\\n\");\n                timer::sleep(1000);\n            }\n        });\n    }\n}\n```\n\nit compiles fine, but when I run this program, and connect to it by telnetting to localhost:3569, it prints \"hey hi\", then one \"ping\", then crashes.\n\nhere's a stack trace:\n\n```\n(gdb) bt\n#0  0x00000000004629b4 in io::net::tcp::Writer$TcpStream::write::h3e42059c65c3f43f05au::v0.10.pre ()\n#1  0x00000000004064d1 in io::Writer::write_str::hb41c95d4c4ae4cb1aY::v0.0 ()\n#2  0x000000000040663e in main::anon::expr_fn::aa ()\n#3  0x00000000004c9368 in task::__extensions__::build_start_wrapper::anon::anon::expr_fn::aI ()\n#4  0x00000000004a1e33 in rt::task::__extensions__::run::anon::expr_fn::aG ()\n#5  0x00000000004a9bec in rust_try ()\n#6  0x00000000004a1da2 in rt::task::Task::run::hc9c9660d47e409e7TWaD::v0.10.pre\n    ()\n#7  0x00000000004c9039 in task::__extensions__::build_start_wrapper::anon::expr_fn::aw ()\n#8  0x0000000000000000 in ?? ()\n```\n\nI'm using master as of 3e39e3e.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12058/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12058/timeline", "performed_via_github_app": null, "state_reason": "completed"}