{"url": "https://api.github.com/repos/rust-lang/rust/issues/82623", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82623/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82623/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82623/events", "html_url": "https://github.com/rust-lang/rust/issues/82623", "id": 818143972, "node_id": "MDU6SXNzdWU4MTgxNDM5NzI=", "number": 82623, "title": "Incorrect error printed by `rustc` when using generics in constants", "user": {"login": "InnocentusLime", "id": 17496400, "node_id": "MDQ6VXNlcjE3NDk2NDAw", "avatar_url": "https://avatars.githubusercontent.com/u/17496400?v=4", "gravatar_id": "", "url": "https://api.github.com/users/InnocentusLime", "html_url": "https://github.com/InnocentusLime", "followers_url": "https://api.github.com/users/InnocentusLime/followers", "following_url": "https://api.github.com/users/InnocentusLime/following{/other_user}", "gists_url": "https://api.github.com/users/InnocentusLime/gists{/gist_id}", "starred_url": "https://api.github.com/users/InnocentusLime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/InnocentusLime/subscriptions", "organizations_url": "https://api.github.com/users/InnocentusLime/orgs", "repos_url": "https://api.github.com/users/InnocentusLime/repos", "events_url": "https://api.github.com/users/InnocentusLime/events{/privacy}", "received_events_url": "https://api.github.com/users/InnocentusLime/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-02-28T07:22:55Z", "updated_at": "2021-02-28T14:27:58Z", "closed_at": "2021-02-28T14:27:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried the following piece of code:\r\n\r\n```rust\r\nuse std::marker::PhantomData;\r\n\r\ntrait Padded {\r\n    const PAD : usize;\r\n}\r\n\r\nstruct Test<T : Padded> \r\n{\r\n    _marker : PhantomData<T>,\r\n    _pad : [u8; <T as Padded>::PAD],\r\n}\r\n\r\nfn main() {}\r\n```\r\nWhat I expected `rustc 1.50.0` to do is abort with an error telling that generic parameters are not yet allowed in constant expressions. The stable version of the compiler, however, prints out the following error, making it seem like it's ignoring the trait bound:\r\n\r\n```\r\nerror[E0277]: the trait bound `T: Padded` is not satisfied\r\n  --> src/main.rs:10:17\r\n   |\r\n4  |     const PAD : usize;\r\n   |     ------------------ required by `Padded::PAD`\r\n...\r\n10 |     _pad : [u8; <T as Padded>::PAD],\r\n   |                 ^^^^^^^^^^^^^^^^^^ the trait `Padded` is not implemented for `T`\r\n   |\r\nhelp: consider further restricting this bound\r\n   |\r\n7  | struct Test<T : Padded + Padded> \r\n   |                        ^^^^^^^^\r\n```\r\n\r\nThe `beta` and `nightly` versions of the compiler report the error correctly:\r\n\r\n```\r\n>error: generic parameters may not be used in const operations\r\n --> src/main.rs:10:18\r\n   |\r\n10 |     _pad : [u8; <T as Padded>::PAD],\r\n   |                  ^ cannot perform const operation using `T`\r\n   |\r\n   = note: type parameters may not be used in const expressions\r\n   = help: use `#![feature(const_generics)]` and `#![feature(const_evaluatable_checked)]` to allow generic const expressions\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82623/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82623/timeline", "performed_via_github_app": null, "state_reason": "completed"}