{"url": "https://api.github.com/repos/rust-lang/rust/issues/28600", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28600/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28600/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28600/events", "html_url": "https://github.com/rust-lang/rust/issues/28600", "id": 107885582, "node_id": "MDU6SXNzdWUxMDc4ODU1ODI=", "number": 28600, "title": "ICE: pub extern fn with parameter type &str inside struct impl", "user": {"login": "ryantaylor", "id": 2320507, "node_id": "MDQ6VXNlcjIzMjA1MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2320507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryantaylor", "html_url": "https://github.com/ryantaylor", "followers_url": "https://api.github.com/users/ryantaylor/followers", "following_url": "https://api.github.com/users/ryantaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ryantaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryantaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryantaylor/subscriptions", "organizations_url": "https://api.github.com/users/ryantaylor/orgs", "repos_url": "https://api.github.com/users/ryantaylor/repos", "events_url": "https://api.github.com/users/ryantaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ryantaylor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-09-23T09:58:53Z", "updated_at": "2017-03-06T12:00:24Z", "closed_at": "2017-03-06T12:00:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\nstruct Test;\n\nimpl Test {\n    pub extern fn test(val: &str) {\n\n    }\n}\n```\n\nWhen you attempt to compile you get:\n\n```\nthread 'rustc' panicked at 'assertion failed: index < LLVMCountParams(llfn)', ../src/librustc_llvm/lib.rs:2281\n\nstack backtrace:\n   1:     0x7f594732b6e9 - sys::backtrace::tracing::imp::write::hc20cecbe7cbc162bPnt\n   2:     0x7f5947328c36 - panicking::on_panic::h838652421a384701enx\n   3:     0x7f59472f3f9e - sys_common::unwind::begin_unwind_inner::h1941327c7a60c738ffs\n   4:     0x7f5942add8bf - sys_common::unwind::begin_unwind::h10325064115155345230\n   5:     0x7f5942ade6c8 - get_param::h41f15541bf012b4aDUc\n   6:     0x7f594682b985 - trans::base::trans_closure::h9db23c69943cc6edvQi\n   7:     0x7f594682ea4f - trans::base::trans_fn::he234bd1782c765fai0i\n   8:     0x7f59468330ab - trans::base::trans_item::hdd4c4224f51d93be9qj\n   9:     0x7f594683f989 - trans::base::trans_crate::hbcfdc768138ad4feRck\n  10:     0x7f59478574dc - driver::phase_4_translate_to_llvm::h281d81b2d864b5a0lPa\n  11:     0x7f5947851ba3 - driver::phase_3_run_analysis_passes::closure.21540\n  12:     0x7f594782f27c - middle::ty::context::ctxt<'tcx>::create_and_enter::h14146594457946518047\n  13:     0x7f594782aa31 - driver::phase_3_run_analysis_passes::h3931958423828830349\n  14:     0x7f594780aded - driver::compile_input::h4f0a6e7bed616ea50ba\n  15:     0x7f5947970d0b - run_compiler::ha3f4465c73f94406qqc\n  16:     0x7f594796e576 - boxed::F.FnBox<A>::call_box::h9054381916092353385\n  17:     0x7f594796de84 - sys_common::unwind::try::try_fn::h18243607356614407688\n  18:     0x7f5947328538 - __rust_try\n  19:     0x7f594731ccd2 - sys_common::unwind::try::inner_try::h074d3cf1bfeda6e7Dbs\n  20:     0x7f594796e01e - boxed::F.FnBox<A>::call_box::h2812587830519910695\n  21:     0x7f5947330a03 - sys::thread::Thread::new::thread_start::h745044ae17db5a99dGw\n  22:     0x7f59412c64a3 - start_thread\n  23:     0x7f5946fb813c - clone\n  24:                0x0 - <unknown>\n```\n\nAlso tested with the following:\n\n```\nuse std::path::Path;\n\nstruct Test;\n\nimpl Test {\n    pub extern fn test(val: &Path) {\n\n    }\n}\n```\n\nYou get:\n\n```\nthread 'rustc' panicked at 'assertion failed: index < LLVMCountParams(llfn)', ../src/librustc_llvm/lib.rs:2281\n\nstack backtrace:\n   1:     0x7fab8a7b06e9 - sys::backtrace::tracing::imp::write::hc20cecbe7cbc162bPnt\n   2:     0x7fab8a7adc36 - panicking::on_panic::h838652421a384701enx\n   3:     0x7fab8a778f9e - sys_common::unwind::begin_unwind_inner::h1941327c7a60c738ffs\n   4:     0x7fab85f628bf - sys_common::unwind::begin_unwind::h10325064115155345230\n   5:     0x7fab85f636c8 - get_param::h41f15541bf012b4aDUc\n   6:     0x7fab89cb0985 - trans::base::trans_closure::h9db23c69943cc6edvQi\n   7:     0x7fab89cb3a4f - trans::base::trans_fn::he234bd1782c765fai0i\n   8:     0x7fab89cb80ab - trans::base::trans_item::hdd4c4224f51d93be9qj\n   9:     0x7fab89cc4989 - trans::base::trans_crate::hbcfdc768138ad4feRck\n  10:     0x7fab8acdc4dc - driver::phase_4_translate_to_llvm::h281d81b2d864b5a0lPa\n  11:     0x7fab8acd6ba3 - driver::phase_3_run_analysis_passes::closure.21540\n  12:     0x7fab8acb427c - middle::ty::context::ctxt<'tcx>::create_and_enter::h14146594457946518047\n  13:     0x7fab8acafa31 - driver::phase_3_run_analysis_passes::h3931958423828830349\n  14:     0x7fab8ac8fded - driver::compile_input::h4f0a6e7bed616ea50ba\n  15:     0x7fab8adf5d0b - run_compiler::ha3f4465c73f94406qqc\n  16:     0x7fab8adf3576 - boxed::F.FnBox<A>::call_box::h9054381916092353385\n  17:     0x7fab8adf2e84 - sys_common::unwind::try::try_fn::h18243607356614407688\n  18:     0x7fab8a7ad538 - __rust_try\n  19:     0x7fab8a7a1cd2 - sys_common::unwind::try::inner_try::h074d3cf1bfeda6e7Dbs\n  20:     0x7fab8adf301e - boxed::F.FnBox<A>::call_box::h2812587830519910695\n  21:     0x7fab8a7b5a03 - sys::thread::Thread::new::thread_start::h745044ae17db5a99dGw\n  22:     0x7fab8474b4a3 - start_thread\n  23:     0x7fab8a43d13c - clone\n  24:                0x0 - <unknown>\n```\n\nHowever, the following works:\n\n```\nstruct Test;\n\nimpl Test {\n    pub extern fn test(val: &u8) {\n\n    }\n}\n```\n\nRust version:\n\n```\nrustc 1.4.0-beta.1 (d2e13e822 2015-09-15)\n```\n\nAlso tested on 1.3.0 stable. Haven't tested on nightly.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28600/timeline", "performed_via_github_app": null, "state_reason": "completed"}