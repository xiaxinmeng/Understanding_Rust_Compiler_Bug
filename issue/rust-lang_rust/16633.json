{"url": "https://api.github.com/repos/rust-lang/rust/issues/16633", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/16633/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/16633/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/16633/events", "html_url": "https://github.com/rust-lang/rust/issues/16633", "id": 40739084, "node_id": "MDU6SXNzdWU0MDczOTA4NA==", "number": 16633, "title": "Remove the `assert_eq!` macro in favor of special-casing a check for equality in the `assert!` macro", "user": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2014-08-20T20:07:16Z", "updated_at": "2015-01-17T14:09:35Z", "closed_at": "2015-01-16T20:50:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "We currently have four macros for runtime assertions: `assert!`, `assert_eq!`, `debug_assert!`, and `debug_assert_eq!`. See https://github.com/rust-lang/rust/blob/master/src/libcore/macros.rs#L50 for their definitions, which are all quite simple. The reason for having the `_eq` form for both `assert!` and `debug_assert!` is because equality checks are the most common kinds of assertions (`assert_eq!` is found 7100 times in the Rust repo, vs 4600 for `assert!`) and that by encoding the intent of the assertion we can produce a better error message, like so:\n\n``` rust\nassert!(1 == 2);  // task '<main>' failed at 'assertion failed: 1 == 2'\nassert_eq!(1, 2);  // task '<main>' failed at 'assertion failed: `(left == right) && (right == left)` (left: `1`, right: `2`)', assert.rs:2\n```\n\nHowever, I don't see a reason for the existence of this extra macro. I propose that we leverage our existing `macro_rules!` facilities to special-case the form `assert!(a == b)` such that it implements the current logic of `assert_eq!`. In non-tested copy-pasted code:\n\n``` rust\nmacro_rules! assert(\n    ($cond1:expr == $cond2:expr) => ({  // literally just the inner bit of the assert_eq! definition\n        let c1 = $cond1;\n        let c2 = $cond2;\n        if c1 != c2 || c2 != c1 {\n            fail!(\"expressions not equal, left: {}, right: {}\", c1, c2);\n        }\n    })\n    ($cond:expr) => (  // the current assert! definition starts here\n        if !$cond {\n            fail!(concat!(\"assertion failed: \", stringify!($cond)))\n        }\n    );\n    ($cond:expr, $($arg:tt)*) => (\n        if !$cond {\n            fail!($($arg)*)\n        }\n    );\n)\n```\n\nDoes anyone see any problems with this?\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/16633/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/16633/timeline", "performed_via_github_app": null, "state_reason": "completed"}