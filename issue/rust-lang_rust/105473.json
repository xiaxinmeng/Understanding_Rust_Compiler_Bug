{"url": "https://api.github.com/repos/rust-lang/rust/issues/105473", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/105473/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/105473/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/105473/events", "html_url": "https://github.com/rust-lang/rust/issues/105473", "id": 1485441085, "node_id": "I_kwDOAAsO6M5Yigg9", "number": 105473, "title": "Attributing value to tuple struct field via IndexMut leads to stack overflow exception", "user": {"login": "Azgrom", "id": 14893177, "node_id": "MDQ6VXNlcjE0ODkzMTc3", "avatar_url": "https://avatars.githubusercontent.com/u/14893177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Azgrom", "html_url": "https://github.com/Azgrom", "followers_url": "https://api.github.com/users/Azgrom/followers", "following_url": "https://api.github.com/users/Azgrom/following{/other_user}", "gists_url": "https://api.github.com/users/Azgrom/gists{/gist_id}", "starred_url": "https://api.github.com/users/Azgrom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Azgrom/subscriptions", "organizations_url": "https://api.github.com/users/Azgrom/orgs", "repos_url": "https://api.github.com/users/Azgrom/repos", "events_url": "https://api.github.com/users/Azgrom/events{/privacy}", "received_events_url": "https://api.github.com/users/Azgrom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-12-08T21:35:39Z", "updated_at": "2022-12-09T00:58:59Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nHere is the code to reproduce the problem:\r\n\r\n```rust\r\nuse std::ops::{Index, IndexMut};\r\n\r\n#[derive(Debug)]\r\nstruct TupleStruct(u32, u32);\r\n\r\nimpl Index<usize> for TupleStruct {\r\n    type Output = u32;\r\n\r\n    fn index(&self, index: usize) -> &Self::Output {\r\n        &self[index]\r\n    }\r\n}\r\n\r\nimpl IndexMut<usize> for TupleStruct {\r\n    fn index_mut(&mut self, index: usize) -> &mut Self::Output {\r\n        &mut self[index]\r\n    }\r\n}\r\n\r\nimpl PartialEq<TupleStruct> for TupleStruct {\r\n    fn eq(&self, other: &TupleStruct) -> bool {\r\n        self.0 == other.0 && self.1 == other.1\r\n    }\r\n}\r\n\r\n#[cfg(test)]\r\nmod tests {\r\n    use super::*;\r\n\r\n    #[test]\r\n    fn reproduce_tuple_struct_stack_overflow() {\r\n        let mut tuple_struct = TupleStruct(1, 2);\r\n\r\n        tuple_struct[0] = 5; // This line triggers the overflow\r\n\r\n        assert_eq!(tuple_struct, TupleStruct(5, 2));\r\n    }\r\n}\r\n```\r\n\r\nI expected to be able to access and change the tuple struct fields\r\n\r\nInstead, not only the compiler not warns the probable implementation error. As this could be just an rabbit hole entrance to a memory security issue.\r\n\r\nHere is a link to the playground, where it is possible to reproduce this behavior: https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=38853a9969af7c1c9779f14f439dc40a\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0 (897e37553 2022-11-02)\r\nbinary: rustc\r\ncommit-hash: 897e37553bba8b42751c67658967889d11ecd120\r\ncommit-date: 2022-11-02\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.65.0\r\nLLVM version: 15.0.0\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/105473/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/105473/timeline", "performed_via_github_app": null, "state_reason": null}