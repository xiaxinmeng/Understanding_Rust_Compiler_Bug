{"url": "https://api.github.com/repos/rust-lang/rust/issues/66118", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66118/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66118/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66118/events", "html_url": "https://github.com/rust-lang/rust/issues/66118", "id": 517762587, "node_id": "MDU6SXNzdWU1MTc3NjI1ODc=", "number": 66118, "title": "rustc generates invalid DWARF when LTO is enabled", "user": {"login": "hannobraun", "id": 85732, "node_id": "MDQ6VXNlcjg1NzMy", "avatar_url": "https://avatars.githubusercontent.com/u/85732?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hannobraun", "html_url": "https://github.com/hannobraun", "followers_url": "https://api.github.com/users/hannobraun/followers", "following_url": "https://api.github.com/users/hannobraun/following{/other_user}", "gists_url": "https://api.github.com/users/hannobraun/gists{/gist_id}", "starred_url": "https://api.github.com/users/hannobraun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hannobraun/subscriptions", "organizations_url": "https://api.github.com/users/hannobraun/orgs", "repos_url": "https://api.github.com/users/hannobraun/repos", "events_url": "https://api.github.com/users/hannobraun/events{/privacy}", "received_events_url": "https://api.github.com/users/hannobraun/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2019-11-05T13:09:07Z", "updated_at": "2023-05-08T17:56:42Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "When combining `lto = true` with `debug = true` in Cargo.toml, the compiler generates invalid DWARF, according to [Gimli](https://github.com/gimli-rs/gimli.git).\r\n\r\nI've created a minimal example here: https://github.com/hannobraun/dwarf-test\r\n\r\nIf you follow the instructions in the example's README, you should see something like this:\r\n```\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13d1b to 0x492\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13d30 to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13d4a to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13d59 to 0x5e2\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13d91 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13da6 to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13dce to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13de2 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13dfb to 0x2b31\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e10 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e25 to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e4d to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e61 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e87 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13e9c to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13ec4 to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13ed8 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13ef1 to 0x2b31\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13f06 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13f1b to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13f43 to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13f57 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13fb5 to 0x4ac\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13fca to 0x49f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13fdf to 0x492b\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x13ff4 to 0x523c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14009 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14022 to 0x4893\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1402f to 0x4880\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14049 to 0x4b9\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14056 to 0x5ef\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14063 to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14085 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1409c to 0x5fc\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x140b1 to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x140db to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x140f2 to 0x609\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14107 to 0x616\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1411c to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14146 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1415d to 0x609\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14172 to 0x616\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14187 to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x141b1 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x141c8 to 0x609\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x141dd to 0x616\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x141f7 to 0x4e0\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1420c to 0x62d\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14221 to 0x4d3\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14236 to 0x4945\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1424b to 0x4938\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14279 to 0x492\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1428e to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x142a8 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x142b7 to 0x5e2\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x142c5 to 0x492\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x142da to 0x491e\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x142f4 to 0x522f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14303 to 0x5e2\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14326 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1433b to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14363 to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14377 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14390 to 0x2b31\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x143a5 to 0x4857\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x143ba to 0x536c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x143e2 to 0xf5\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x143f6 to 0xe8\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x144ea to 0x3e22\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14528 to 0x4531\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14551 to 0x4ed\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14582 to 0x453d\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14d39 to 0x4100\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14dcb to 0x3e38\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14e10 to 0x412c\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14e29 to 0x3e4b\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x14e3e to 0x4b11\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x174a6 to 0x6cf\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x17532 to 0x6cf\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x175be to 0x6cf\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x17652 to 0x6cf\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x1770d to 0x7ac\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x178c3 to 0x816\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x178d8 to 0x36f\r\nDWARF error in ../dwarf-test/target/debug/dwarf-test: Invalid intra-unit reference in unit 0x102 from DIE 0x17903 to 0x37c\r\n```\r\n\r\nI've seen this first in a larger project. There, the combination of `lto = true` and `debug = true`  also causes GDB to freeze when reading the symbols from the binary. I wasn't able to reproduce this in my minimal example, but in the larger project, all binaries that caused GDB to freeze produced these DWARF errors, while I didn't see these errors in the binaries that worked normally.\r\n\r\nSo while I'm not 100% sure that these DWARF errors are a real problem, I suspect that they're the cause of the GDB freezes I was seeing.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66118/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66118/timeline", "performed_via_github_app": null, "state_reason": null}