{"url": "https://api.github.com/repos/rust-lang/rust/issues/93951", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93951/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93951/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93951/events", "html_url": "https://github.com/rust-lang/rust/issues/93951", "id": 1134709384, "node_id": "I_kwDOAAsO6M5DokqI", "number": 93951, "title": "`let_else` returns in surprising borrowck errors with impl trait", "user": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3186331060, "node_id": "MDU6TGFiZWwzMTg2MzMxMDYw", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-let-else", "name": "F-let-else", "color": "f9c0cc", "default": false, "description": "Issues related to let-else statements (RFC 3137)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-02-12T22:24:01Z", "updated_at": "2022-07-30T04:05:28Z", "closed_at": "2022-07-30T04:05:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\r\n#![feature(let_else)]\r\nuse std::fmt::Debug;\r\n\r\nfn foo<'a>(x: &'a str) -> Result<impl Debug + 'a, ()> {\r\n    Ok(x)\r\n}\r\n\r\nfn fail() {\r\n    let x = String::from(\"Hey\");\r\n\r\n    let Ok(s) = foo(&x) else { return };\r\n}\r\n\r\nfn ok() {\r\n    let x = String::from(\"Hey\");\r\n\r\n    let s = if let Ok(s) = foo(&x) { s } else { return };\r\n}\r\n```\r\nresults in\r\n```\r\nerror[E0597]: `x` does not live long enough\r\n  --> src/main.rs:11:21\r\n   |\r\n11 |     let Ok(s) = foo(&x) else { return };\r\n   |                 ----^^-\r\n   |                 |   |\r\n   |                 |   borrowed value does not live long enough\r\n   |                 a temporary with access to the borrow is created here ...\r\n12 | }\r\n   | -\r\n   | |\r\n   | `x` dropped here while still borrowed\r\n   | ... and the borrow might be used here, when that temporary is dropped and runs the destructor for type `Result<impl Debug, ()>`\r\n   |\r\nhelp: consider adding semicolon after the expression so its temporaries are dropped sooner, before the local variables declared by the block are dropped\r\n   |\r\n11 |     let Ok(s) = foo(&x) else { return };;\r\n   |                                        +\r\n   ```\r\nI am not sure if this issue exists only in combination with impl Trait of if it can be triggered in some other ways as well, haven't managed to get this bug some other way.\r\n\r\ncc #93628 @est31 do you know whether this behavior is known already?", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93951/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93951/timeline", "performed_via_github_app": null, "state_reason": "completed"}