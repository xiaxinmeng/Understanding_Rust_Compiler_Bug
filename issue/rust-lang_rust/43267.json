{"url": "https://api.github.com/repos/rust-lang/rust/issues/43267", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43267/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43267/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43267/events", "html_url": "https://github.com/rust-lang/rust/issues/43267", "id": 243253197, "node_id": "MDU6SXNzdWUyNDMyNTMxOTc=", "number": 43267, "title": "Compiler fails to warn about certain unreachable match arms containing exclusive ranges", "user": {"login": "feadoor", "id": 17862382, "node_id": "MDQ6VXNlcjE3ODYyMzgy", "avatar_url": "https://avatars.githubusercontent.com/u/17862382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feadoor", "html_url": "https://github.com/feadoor", "followers_url": "https://api.github.com/users/feadoor/followers", "following_url": "https://api.github.com/users/feadoor/following{/other_user}", "gists_url": "https://api.github.com/users/feadoor/gists{/gist_id}", "starred_url": "https://api.github.com/users/feadoor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feadoor/subscriptions", "organizations_url": "https://api.github.com/users/feadoor/orgs", "repos_url": "https://api.github.com/users/feadoor/repos", "events_url": "https://api.github.com/users/feadoor/events{/privacy}", "received_events_url": "https://api.github.com/users/feadoor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1731101920, "node_id": "MDU6TGFiZWwxNzMxMTAxOTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-exclusive_range_pattern", "name": "F-exclusive_range_pattern", "color": "f9c0cc", "default": false, "description": "`#![feature(exclusive_range_pattern)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-07-16T17:21:41Z", "updated_at": "2022-08-14T10:25:18Z", "closed_at": "2022-08-14T10:25:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\n#![feature(exclusive_range_pattern)]\r\n\r\nfn main() {\r\n    match 10 {\r\n        1...10 => {},\r\n        1..10 => {},\r\n         _ => {},        \r\n    };\r\n\r\n    match 10 {\r\n        1...10 => {},\r\n        1..11 => {},\r\n         _ => {},        \r\n    };\r\n}\r\n```\r\n\r\nIn each case, the second arm of the match is unreachable, but the compiler fails to generate a warning.\r\n\r\nThis is related to #43253, but more tricky to resolve. There are problems with all of the first three match arms of the following function from `librustc_const_eval/_match.rs`:\r\n\r\n```\r\nfn range_covered_by_constructor(tcx: TyCtxt, span: Span,\r\n                                ctor: &Constructor,\r\n                                from: &ConstVal, to: &ConstVal,\r\n                                end: RangeEnd) {\r\n    ...\r\n}\r\n```\r\n\r\nThe problem with the first two arms is resolved by #43266. The third arm cannot be fixed in a similar fashion. Essentially, this function tries to work out whether the range represented by `ctor` fits entirely within the range determined by the function parameters, and does so using the results of comparisons between the endpoints of the two ranges.\r\n\r\nThis is not sufficient information to determine if an exclusive range fits within an inclusive range. In particular, for ranges of integers:\r\n\r\n - `1..11` fits entirely within `1...10`\r\n - `1..12` does not fit entirely within `1...10`\r\n\r\nThis is despite the results of comparisons between the range endpoints are the same in each case.\r\n\r\nThe fix here will probably need to treat discrete ranges (e.g. of integers) differently from continuous ranges (e.g. of floating point numbers - yes, everything is discrete to a computer, but that's not how people think when actually using floating point numbers!)", "closed_by": {"login": "Nadrieril", "id": 6783654, "node_id": "MDQ6VXNlcjY3ODM2NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6783654?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nadrieril", "html_url": "https://github.com/Nadrieril", "followers_url": "https://api.github.com/users/Nadrieril/followers", "following_url": "https://api.github.com/users/Nadrieril/following{/other_user}", "gists_url": "https://api.github.com/users/Nadrieril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nadrieril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nadrieril/subscriptions", "organizations_url": "https://api.github.com/users/Nadrieril/orgs", "repos_url": "https://api.github.com/users/Nadrieril/repos", "events_url": "https://api.github.com/users/Nadrieril/events{/privacy}", "received_events_url": "https://api.github.com/users/Nadrieril/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43267/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43267/timeline", "performed_via_github_app": null, "state_reason": "completed"}