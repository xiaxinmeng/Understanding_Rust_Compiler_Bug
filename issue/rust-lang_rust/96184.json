{"url": "https://api.github.com/repos/rust-lang/rust/issues/96184", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96184/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96184/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96184/events", "html_url": "https://github.com/rust-lang/rust/issues/96184", "id": 1207293401, "node_id": "I_kwDOAAsO6M5H9dXZ", "number": 96184, "title": "\"meta-variable x repeats N times, but y repeats M times\" error is confusing", "user": {"login": "clarfonthey", "id": 15850505, "node_id": "MDQ6VXNlcjE1ODUwNTA1", "avatar_url": "https://avatars.githubusercontent.com/u/15850505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clarfonthey", "html_url": "https://github.com/clarfonthey", "followers_url": "https://api.github.com/users/clarfonthey/followers", "following_url": "https://api.github.com/users/clarfonthey/following{/other_user}", "gists_url": "https://api.github.com/users/clarfonthey/gists{/gist_id}", "starred_url": "https://api.github.com/users/clarfonthey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clarfonthey/subscriptions", "organizations_url": "https://api.github.com/users/clarfonthey/orgs", "repos_url": "https://api.github.com/users/clarfonthey/repos", "events_url": "https://api.github.com/users/clarfonthey/events{/privacy}", "received_events_url": "https://api.github.com/users/clarfonthey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-04-18T18:03:13Z", "updated_at": "2022-10-28T13:36:32Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nSo, I ran into this when writing up a macro for a project. I'm not really sure what a minimal example would be, but here's some slightly-shorter-than-what-I-wrote code: [(playground link)](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=67e182b39566a17be38fb35c7458d038)\r\n\r\n```rust\r\nmacro_rules! test_cons {\r\n    (\r\n        $ty:ident {\r\n            array: [$($arr:literal),*],\r\n            $(\r\n                $from:ident: $val:expr,\r\n            )*\r\n        }\r\n    ) => {\r\n        $(\r\n            test_arrays! { ($ty::$from)($val) == [$($arr),*] }\r\n        )*\r\n    }\r\n}\r\n\r\nmacro_rules! test_arrays {\r\n    (($method:path)($val:expr) == [$($arr:literal),*]) => {\r\n        {\r\n            let x = $method($val);\r\n            assert_eq!(x.to_array(), [$($arr),*], \"{}({:?}).to_array() != {:?}\", stringify!($method), $val, [$($arr),*]);\r\n        }\r\n    }\r\n}\r\n\r\nfn do_test() {\r\n    test_cons! {\r\n        MyTy {\r\n            array: [1, 2, 3],\r\n            from_array: [1, 2, 3],\r\n            from_shorter_array: [1, 2],\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nIn case it's not obvious what I'm trying to do here: I want to verify that `MyTy::from_array([1, 2, 3]).to_array() == [1, 2, 3]` and that `MyTy::from_shorter_array([1, 2]).to_array() == [1, 2, 3]`. This is shorter than the original macro I wrote, but should be enough to demonstrate the error.\r\n\r\nThe current output is:\r\n\r\n```\r\nerror: meta-variable `from` repeats 2 times, but `arr` repeats 3 times\r\n  [--> src/lib.rs:10:10\r\n](https://play.rust-lang.org/#)   |\r\n10 |           $(\r\n   |  __________^\r\n11 | |             test_arrays! { ($ty::$from)($val) == [$($arr),*] }\r\n12 | |         )*\r\n   | |_________^\r\n```\r\n\r\nThat's it. No suggestions for what might be wrong, not even a link to an error code. Just saying that what I wrote is wrong. I tried messing around with metavar expressions as specified in #83527 but I don't know what exactly would would help here.\r\n\r\nBasically, I have no idea what exactly the circumstances for this error are, or what I'm doing wrong here, but either way, this error is extremely confusing and could be improved to at least explain what the compiler thinks is happening, and what I could do to fix that.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96184/reactions", "total_count": 4, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96184/timeline", "performed_via_github_app": null, "state_reason": null}