{"url": "https://api.github.com/repos/rust-lang/rust/issues/111669", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/111669/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/111669/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/111669/events", "html_url": "https://github.com/rust-lang/rust/issues/111669", "id": 1713080979, "node_id": "I_kwDOAAsO6M5mG4qT", "number": 111669, "title": "Not using the result of offset_of should lint", "user": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 4989566137, "node_id": "LA_kwDOAAsO6M8AAAABKWa8uQ", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-offset_of", "name": "F-offset_of", "color": "f9c0cc", "default": false, "description": "`#![feature(offset_of)]`"}], "state": "open", "locked": false, "assignee": {"login": "ChayimFriedman2", "id": 24700207, "node_id": "MDQ6VXNlcjI0NzAwMjA3", "avatar_url": "https://avatars.githubusercontent.com/u/24700207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChayimFriedman2", "html_url": "https://github.com/ChayimFriedman2", "followers_url": "https://api.github.com/users/ChayimFriedman2/followers", "following_url": "https://api.github.com/users/ChayimFriedman2/following{/other_user}", "gists_url": "https://api.github.com/users/ChayimFriedman2/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChayimFriedman2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChayimFriedman2/subscriptions", "organizations_url": "https://api.github.com/users/ChayimFriedman2/orgs", "repos_url": "https://api.github.com/users/ChayimFriedman2/repos", "events_url": "https://api.github.com/users/ChayimFriedman2/events{/privacy}", "received_events_url": "https://api.github.com/users/ChayimFriedman2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ChayimFriedman2", "id": 24700207, "node_id": "MDQ6VXNlcjI0NzAwMjA3", "avatar_url": "https://avatars.githubusercontent.com/u/24700207?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChayimFriedman2", "html_url": "https://github.com/ChayimFriedman2", "followers_url": "https://api.github.com/users/ChayimFriedman2/followers", "following_url": "https://api.github.com/users/ChayimFriedman2/following{/other_user}", "gists_url": "https://api.github.com/users/ChayimFriedman2/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChayimFriedman2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChayimFriedman2/subscriptions", "organizations_url": "https://api.github.com/users/ChayimFriedman2/orgs", "repos_url": "https://api.github.com/users/ChayimFriedman2/repos", "events_url": "https://api.github.com/users/ChayimFriedman2/events{/privacy}", "received_events_url": "https://api.github.com/users/ChayimFriedman2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2023-05-17T04:20:31Z", "updated_at": "2023-05-17T10:31:40Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The offset_of macro (#106655) is side effect free. For standard library functions that are side effect free, or that have side effects but there is versions of them that don't return anything, it is policy to add a `must_use` attribute to them so that users are warned if they invoke the function without doing anything with the result (#89692).\n \nIdeally, the same should hold for the `offset_of` macro as well. One of the lints in the `unused` lint group should fire if you don't use the result of the `offset_of!()` macro:\n```Rust\nfn foo() {\n    offset_of!(F, field); // WARNING result must be used\n}\nstruct F { field: u8, }\n```\n\nIdeally it would be integrated into the `must_use` system, say via supporting `#[must_use]` attributes on macros. Currently you are getting:\n\n```\nwarning: `#[must_use]` has no effect when applied to a macro def\n --> src/main.rs:1:1\n  |\n1 | #[must_use = \"hi\"]\n  | ^^^^^^^^^^^^^^^^^^\n  |\n  = note: `#[warn(unused_attributes)]` on by default\n```\nfor\n```Rust\n#[must_use = \"hi\"]\nmacro_rules! foo {\n    () => {0};\n}\nfn main() {\n    foo!();\n}\n```\n\nIt could e.g. expand to some AST node that is just the identity.\n\nAlternatively, one could also just solve it for the offset_of macro via sending the result through a function:\n\n```Rust\nmacro_rules! offset_of_must_use {\n    () => {\n            #[must_use = \"offset_of result must be used\"]\n            const fn must_use(v: usize) -> usize { v }\n            must_use(0)\n    };\n}\n\nfn main() {\n    offset_of_must_use!();\n}\n```\n\nSadly this pollutes the context with a function however. If one surrounds the entire expansion with `{}`s, the lint is silent again.\n\nI don't think it's worth its own lint in itself.\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"ChayimFriedman2\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/111669/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/111669/timeline", "performed_via_github_app": null, "state_reason": null}