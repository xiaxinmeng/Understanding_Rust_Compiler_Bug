{"url": "https://api.github.com/repos/rust-lang/rust/issues/55037", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55037/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55037/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55037/events", "html_url": "https://github.com/rust-lang/rust/issues/55037", "id": 369803234, "node_id": "MDU6SXNzdWUzNjk4MDMyMzQ=", "number": 55037, "title": "Wrong diagnostic for empty macro bodies", "user": {"login": "Bert-Proesmans", "id": 2027877, "node_id": "MDQ6VXNlcjIwMjc4Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/2027877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bert-Proesmans", "html_url": "https://github.com/Bert-Proesmans", "followers_url": "https://api.github.com/users/Bert-Proesmans/followers", "following_url": "https://api.github.com/users/Bert-Proesmans/following{/other_user}", "gists_url": "https://api.github.com/users/Bert-Proesmans/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bert-Proesmans/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bert-Proesmans/subscriptions", "organizations_url": "https://api.github.com/users/Bert-Proesmans/orgs", "repos_url": "https://api.github.com/users/Bert-Proesmans/repos", "events_url": "https://api.github.com/users/Bert-Proesmans/events{/privacy}", "received_events_url": "https://api.github.com/users/Bert-Proesmans/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-13T13:40:35Z", "updated_at": "2019-01-11T15:13:19Z", "closed_at": "2019-01-11T00:36:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "This issue was encountered while designing an API for my upcoming library and is related to empty (stub) macros. \r\nThe compiler gives a confusing error description about expecting an expression when the stub macro is called. This is a diagnostic issue.\r\n\r\nConsider [this case (playground link)](https://play.rust-lang.org/?gist=a56279f8136f8273719fb399283960ae&version=stable&mode=debug&edition=2015)\r\n```rust\r\nmacro_rules! r {\r\n    ($($x:tt)*) => {};\r\n}\r\nfn do<X>(x: X) { unimplemented!() }\r\n\r\nfn main() { \r\n    do(r![\r\n        do(Ok(12)),\r\n        do(Err(12)),\r\n    ]);\r\n}\r\n```\r\n\r\nAttempting to compile this example returns the following error exactly\r\n```\r\nCompiling playground v0.0.1 (file:///playground)\r\nerror: expected expression, found `<eof>`\r\nerror: aborting due to previous error\r\n```\r\nEdit: Tested on the current stable and nightly compiler, 1.29.2 and 1.31 respectively.\r\n\r\nThis error is technically correct when you understand how the parser works, but really difficult to debug when you encounter it (at random) in a more complex example.\r\nI would expect the error description to be more precise towards the macro context while also providing line numbers and code highlights. After all the compiler expects the macro to expand into an expression.\r\n\r\nThe above example can be made to compile by filling in the macro body. The macro `unimplemented!()` would be a semantically fitting option (in my opinion), but it causes unreachable code warnings. Returning `()` (empty tuple object) within the macro body works as well without these warnings.\r\n", "closed_by": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55037/timeline", "performed_via_github_app": null, "state_reason": "completed"}