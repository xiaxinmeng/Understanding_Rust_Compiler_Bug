{"url": "https://api.github.com/repos/rust-lang/rust/issues/110794", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110794/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110794/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110794/events", "html_url": "https://github.com/rust-lang/rust/issues/110794", "id": 1682939961, "node_id": "I_kwDOAAsO6M5kT6A5", "number": 110794, "title": "`tests/ui/io-checks` fail locally on master", "user": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}], "state": "closed", "locked": false, "assignee": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2023-04-25T11:00:51Z", "updated_at": "2023-04-28T03:27:31Z", "closed_at": "2023-04-28T03:27:31Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The `tests/ui/io-checks/inaccessbile-temp-dir.rs` test fails for me locally on the master branch (and was failing for a while now). I can of course ignore it, but it's annoying. `tests/ui/io-checks/non-ice-error-on-worker-io-fail.rs` also fails if run after/with `inaccessbile-temp-dir.rs`.\r\n\r\nIt looks like `inaccessbile-temp-dir.rs` successfully creates a temp directory even if it's parent does not exist:\r\n\r\n<details><summary>output</summary>\r\n<p>\r\n\r\n```\r\n:~/rust-b (master); git log -1 --oneline\r\n91b61a4ad61 (HEAD -> master, upstream/master) Auto merge of #110389 - mazong1123:add-shortcut-for-grisu3, r=Mark-Simulacrum\r\n:~/rust-b (master); ls /does-not-exist\r\nls: cannot access '/does-not-exist': No such file or directory\r\n:~/rust-b (master) [2]; x t tests/ui/io-checks/inaccessbile-temp-dir.rs\r\nBuilding bootstrap\r\n    Finished dev [unoptimized] target(s) in 0.06s\r\nBuilding stage0 library artifacts (aarch64-unknown-linux-gnu)\r\n    Finished release [optimized + debuginfo] target(s) in 0.18s\r\nBuilding compiler artifacts (stage0 -> stage1, aarch64-unknown-linux-gnu)\r\n    Finished release [optimized + debuginfo] target(s) in 0.29s\r\nAssembling stage1 compiler\r\nBuilding stage1 library artifacts (aarch64-unknown-linux-gnu)\r\n    Blocking waiting for file lock on package cache\r\n    Blocking waiting for file lock on package cache\r\n    Finished release [optimized + debuginfo] target(s) in 0.21s\r\nBuilding stage0 tool compiletest (aarch64-unknown-linux-gnu)\r\n    Finished release [optimized + debuginfo] target(s) in 0.19s\r\nCheck compiletest suite=ui mode=ui (aarch64-unknown-linux-gnu -> aarch64-unknown-linux-gnu)\r\n\r\nrunning 1 tests\r\nF\r\n\r\nfailures:\r\n\r\n---- [ui] tests/ui/io-checks/inaccessbile-temp-dir.rs stdout ----\r\n\r\nerror: ui test compiled successfully!\r\nstatus: exit status: 0\r\ncommand: \"/home/gh-WaffleLapkin/rust-b/build/aarch64-unknown-linux-gnu/stage1/bin/rustc\" \"/home/gh-WaffleLapkin/rust-b/tests/ui/io-checks/inaccessbile-temp-dir.rs\" \"-Zthreads=1\" \"--sysroot\" \"/home/gh-WaffleLapkin/rust-b/build/aarch64-unknown-linux-gnu/stage1\" \"--target=aarch64-unknown-linux-gnu\" \"--error-format\" \"json\" \"--json\" \"future-incompat\" \"-Ccodegen-units=1\" \"-Zui-testing\" \"-Zsimulate-remapped-rust-src-base=/rustc/FAKE_PREFIX\" \"-Ztranslate-remapped-path-to-local-path=no\" \"-Zdeduplicate-diagnostics=no\" \"-Cstrip=debuginfo\" \"--emit\" \"metadata\" \"-C\" \"prefer-dynamic\" \"--out-dir\" \"/home/gh-WaffleLapkin/rust-b/build/aarch64-unknown-linux-gnu/test/ui/io-checks/inaccessbile-temp-dir\" \"-A\" \"unused\" \"-Crpath\" \"-Cdebuginfo=0\" \"-Lnative=/home/gh-WaffleLapkin/rust-b/build/aarch64-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"/home/gh-WaffleLapkin/rust-b/build/aarch64-unknown-linux-gnu/test/ui/io-checks/inaccessbile-temp-dir/auxiliary\" \"-Z\" \"temps-dir=/does-not-exist/output\"\r\nstdout: none\r\nstderr: none\r\n\r\n\r\n\r\nfailures:\r\n    [ui] tests/ui/io-checks/inaccessbile-temp-dir.rs\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 14869 filtered out; finished in 60.70ms\r\n\r\nSome tests failed in compiletest suite=ui mode=ui host=aarch64-unknown-linux-gnu target=aarch64-unknown-linux-gnu\r\nBuild completed unsuccessfully in 0:00:03\r\n:~/rust-b (master) [1]; ls /does-not-exist\r\noutput\r\n:~/rust-b (master); \r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nThis causes the failure (as the test is expected to not compile) and also creates the directory, which `non-ice-error-on-worker-io-fail.rs` then observes and also fails.\r\n\r\nThis happens for me on the [`dev-desktop-eu-1`](https://forge.rust-lang.org/infra/docs/dev-desktop.html).\r\n\r\ncc @fee1-dead iirc you had the same problems\r\ncc @cuviper you changed those tests at some point, so maybe you know something", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110794/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110794/timeline", "performed_via_github_app": null, "state_reason": "completed"}