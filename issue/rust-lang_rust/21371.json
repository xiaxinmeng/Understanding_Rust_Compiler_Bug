{"url": "https://api.github.com/repos/rust-lang/rust/issues/21371", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21371/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21371/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21371/events", "html_url": "https://github.com/rust-lang/rust/issues/21371", "id": 54704710, "node_id": "MDU6SXNzdWU1NDcwNDcxMA==", "number": 21371, "title": "Sleep causes memory leak according to valgrind", "user": {"login": "petermora", "id": 1550359, "node_id": "MDQ6VXNlcjE1NTAzNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1550359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petermora", "html_url": "https://github.com/petermora", "followers_url": "https://api.github.com/users/petermora/followers", "following_url": "https://api.github.com/users/petermora/following{/other_user}", "gists_url": "https://api.github.com/users/petermora/gists{/gist_id}", "starred_url": "https://api.github.com/users/petermora/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petermora/subscriptions", "organizations_url": "https://api.github.com/users/petermora/orgs", "repos_url": "https://api.github.com/users/petermora/repos", "events_url": "https://api.github.com/users/petermora/events{/privacy}", "received_events_url": "https://api.github.com/users/petermora/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-01-18T18:17:40Z", "updated_at": "2015-01-19T03:27:57Z", "closed_at": "2015-01-19T03:27:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "I guess that valgrind should always return 0 used bytes at exit. The code only sleeps for 5 seconds:\n\n```\n#[allow(unstable)]\nfn main() {\n  std::io::timer::sleep(std::time::duration::Duration::seconds(5));\n}\n```\n\nI'm on 64 bit Debian testing. Version of Rust:\n\n```\nrustc --version --verbose\nrustc 1.0.0-nightly (ed530d7a3 2015-01-16 22:41:16 +0000)\nbinary: rustc\ncommit-hash: ed530d7a3b67989047e6fe61fe101b9d8158585f\ncommit-date: 2015-01-16 22:41:16 +0000\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-nightly\n```\n\n Valgrind output:\n\n```\nvalgrind --leak-check=full ../target/hello                                                                          [11/198]\n==3789== Memcheck, a memory error detector\n==3789== Copyright (C) 2002-2013, and GNU GPL'd, by Julian Seward et al.\n==3789== Using Valgrind-3.10.0 and LibVEX; rerun with -h for copyright info\n==3789== Command: ../target/hello\n==3789== \n==3789== \n==3789== HEAP SUMMARY:\n==3789==     in use at exit: 904 bytes in 13 blocks\n==3789==   total heap usage: 33 allocs, 20 frees, 2,400 bytes allocated\n==3789== \n==3789== 288 bytes in 1 blocks are possibly lost in loss record 13 of 13\n==3789==    at 0x4C2AD10: calloc (vg_replace_malloc.c:623)\n==3789==    by 0x4010FD1: allocate_dtv (dl-tls.c:296)\n==3789==    by 0x40116DD: _dl_allocate_tls (dl-tls.c:460)\n==3789==    by 0x5041C27: allocate_stack (allocatestack.c:589)\n==3789==    by 0x5041C27: pthread_create@@GLIBC_2.2.5 (pthread_create.c:495)\n==3789==    by 0x1148F4: sys::thread::create::hcba76e95a3a3ee63jTw (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x112669: thread::Builder::spawn_inner::h5695881126130537417 (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x118BAA: io::timer::Timer::new::h6de63c2656b477e2e0g (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x11805A: io::timer::sleep::he75e770508550e27QZg (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x10EC95: main::h655d5e7b0d3f884beaa (main.rs:4)\n==3789==    by 0x132AF8: rust_try_inner (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x132AE5: rust_try (in /home/petya/rust/hello/target/hello)\n==3789==    by 0x1301B5: rt::lang_start::h8024648b47185c9dZ0z (in /home/petya/rust/hello/target/hello)\n==3789== \n==3789== LEAK SUMMARY:\n==3789==    definitely lost: 0 bytes in 0 blocks\n==3789==    indirectly lost: 0 bytes in 0 blocks\n==3789==      possibly lost: 288 bytes in 1 blocks\n==3789==    still reachable: 616 bytes in 12 blocks\n==3789==         suppressed: 0 bytes in 0 blocks\n==3789== Reachable blocks (those to which a pointer was found) are not shown.\n==3789== To see them, rerun with: --leak-check=full --show-leak-kinds=all\n==3789== \n==3789== For counts of detected and suppressed errors, rerun with: -v\n==3789== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21371/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21371/timeline", "performed_via_github_app": null, "state_reason": "completed"}