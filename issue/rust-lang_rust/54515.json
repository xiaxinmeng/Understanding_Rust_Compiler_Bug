{"url": "https://api.github.com/repos/rust-lang/rust/issues/54515", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54515/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54515/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54515/events", "html_url": "https://github.com/rust-lang/rust/issues/54515", "id": 362980475, "node_id": "MDU6SXNzdWUzNjI5ODA0NzU=", "number": 54515, "title": "[nightly] ICE in macros-2.0 heavy crate", "user": {"login": "jjpe", "id": 1242003, "node_id": "MDQ6VXNlcjEyNDIwMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1242003?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjpe", "html_url": "https://github.com/jjpe", "followers_url": "https://api.github.com/users/jjpe/followers", "following_url": "https://api.github.com/users/jjpe/following{/other_user}", "gists_url": "https://api.github.com/users/jjpe/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjpe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjpe/subscriptions", "organizations_url": "https://api.github.com/users/jjpe/orgs", "repos_url": "https://api.github.com/users/jjpe/repos", "events_url": "https://api.github.com/users/jjpe/events{/privacy}", "received_events_url": "https://api.github.com/users/jjpe/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 632573348, "node_id": "MDU6TGFiZWw2MzI1NzMzNDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-2.0", "name": "A-macros-2.0", "color": "f7e101", "default": false, "description": "Area: declarative macros 2.0, https://github.com/rust-lang/rust/issues/39412"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-09-23T21:49:39Z", "updated_at": "2020-03-11T18:08:28Z", "closed_at": "2020-03-11T18:07:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a crate that uses an unholy mix of `macros 2.0`, a couple of old-style macros I haven't been able to get rid of yet, and a derive macro.\r\nTogether these generate what should become a parser.\r\n\r\nSo far they combine marvellously well, but now I've hit an ICE.\r\nIt's got a nondeterministic feel to it, as sometimes when I build, I get this ICE, and sometimes (with identical code and config!) the build runs perfectly smoothly. However, when I do a `cargo clean` and then a `cargo build`, so far it builds correctly every time so *perhaps.\r\n\r\nI'm using `rustc rustc 1.30.0-nightly (79fcc58b2 2018-09-18)`, and I'm working on a `Fedora 28` host.\r\n\r\nThe build log containing the ICE: \r\n\r\n````\r\n-*- mode: cargo-process; default-directory: \"~/dev/toy_parser/\" -*-\r\nCargo-Process started at Sun Sep 23 23:41:55\r\n\r\n/home/j/.cargo/bin/cargo build --manifest-path /home/j/dev/toy_parser/Cargo.toml \r\n   Compiling toy_parser v0.1.0 (/home/j/dev/toy_parser)\r\nparser type: ToyParser\r\nthread 'main' panicked at 'index out of bounds: the len is 24 but the index is 41', libcore/slice/mod.rs:2046:10\r\nstack backtrace:\r\n   0:     0x7fb036ccd69e - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h4d878bab27fd0f70\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7fb036ca6966 - std::sys_common::backtrace::print::h35bb85d3b98f8626\r\n                               at libstd/sys_common/backtrace.rs:71\r\n                               at libstd/sys_common/backtrace.rs:59\r\n   2:     0x7fb036ca45cd - std::panicking::default_hook::{{closure}}::h200bf37fc8919558\r\n                               at libstd/panicking.rs:211\r\n   3:     0x7fb036ca4340 - std::panicking::default_hook::he298f773e406a972\r\n                               at libstd/panicking.rs:227\r\n   4:     0x7fb033321811 - rustc::util::common::panic_hook::h7a484c4bc0b7e466\r\n   5:     0x7fb036ca4c93 - std::panicking::rust_panic_with_hook::hb8a41eeada5713c9\r\n                               at libstd/panicking.rs:481\r\n   6:     0x7fb036ca4839 - std::panicking::continue_panic_fmt::hb390f79f908da969\r\n                               at libstd/panicking.rs:391\r\n   7:     0x7fb036ca4735 - rust_begin_unwind\r\n                               at libstd/panicking.rs:326\r\n   8:     0x7fb036d37dab - core::panicking::panic_fmt::h9df27fbdce6cd890\r\n                               at libcore/panicking.rs:77\r\n   9:     0x7fb036d37d5f - core::panicking::panic_bounds_check::hd3ca1cf6860f370f\r\n                               at libcore/panicking.rs:59\r\n  10:     0x7fb032f4cb72 - <rustc::ty::query::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<syntax_pos::span_encoding::Span>>::specialized_decode::haf36a776572d0532\r\n  11:     0x7fb032efc5a3 - <syntax_pos::hygiene::ExpnInfo as serialize::serialize::Decodable>::decode::hc90798acbce0dee6\r\n  12:     0x7fb032f4c840 - <rustc::ty::query::on_disk_cache::CacheDecoder<'a, 'tcx, 'x> as serialize::serialize::SpecializedDecoder<syntax_pos::span_encoding::Span>>::specialized_decode::haf36a776572d0532\r\n  13:     0x7fb032f0dc5c - serialize::serialize::Decoder::read_struct::hf1af29377a264348\r\n  14:     0x7fb032f07344 - serialize::serialize::Decoder::read_struct::h44ed42a7b3bad803\r\n  15:     0x7fb032f187ec - serialize::serialize::Decoder::read_seq::he8ff09d78ef83105\r\n  16:     0x7fb03300e003 - <rustc::mir::Mir<'tcx> as serialize::serialize::Decodable>::decode::{{closure}}::h2848e41c2d23fc5c\r\n  17:     0x7fb032f4654b - rustc::ty::query::on_disk_cache::OnDiskCache::try_load_query_result::h7c3782a51ad12b8e\r\n  18:     0x7fb032d02b00 - <rustc::ty::query::queries::optimized_mir<'tcx> as rustc::ty::query::config::QueryDescription<'tcx>>::try_load_from_disk::h03fcc147b0cfef99\r\n  19:     0x7fb0330ad786 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_get_query::h84aa791ae4321112\r\n  20:     0x7fb0331aa416 - rustc::ty::query::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::optimized_mir::ha2f74ea799f06ac4\r\n  21:     0x7fb034eea948 - rustc_metadata::encoder::<impl rustc_metadata::isolated_encoder::IsolatedEncoder<'a, 'b, 'tcx>>::encode_optimized_mir::h7592cc16217bb636\r\n  22:     0x7fb034eebc60 - rustc_metadata::encoder::<impl rustc_metadata::isolated_encoder::IsolatedEncoder<'a, 'b, 'tcx>>::encode_info_for_item::h93226db7d2f33957\r\n  23:     0x7fb034ec4757 - rustc::ty::context::tls::with_context::hbd124c5effdbb45f\r\n  24:     0x7fb034dfc9f3 - <rustc_metadata::encoder::EncodeVisitor<'a, 'b, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_item::h225d6897f30e15b7\r\n  25:     0x7fb034e10f1a - rustc::hir::Crate::visit_all_item_likes::he0147d47e484bb95\r\n  26:     0x7fb034dfdb9a - rustc_metadata::encoder::encode_metadata::h5a7037861d93f8ef\r\n  27:     0x7fb034edfcae - rustc_metadata::cstore_impl::<impl rustc::middle::cstore::CrateStore for rustc_metadata::cstore::CStore>::encode_metadata::hc5c3c6fabad0559f\r\n  28:     0x7fb0331a0c80 - rustc::ty::context::TyCtxt::encode_metadata::h31815857e386509c\r\n  29:     0x7fb02cabfb06 - rustc_codegen_llvm::base::write_metadata::h978ea2f11520b6aa\r\n  30:     0x7fb02c9e9b94 - rustc::util::common::time::hf555149f3077fea3\r\n  31:     0x7fb02cac04a4 - rustc_codegen_llvm::base::codegen_crate::h37dba7e1eb0177e1\r\n  32:     0x7fb02caf4f9f - <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_utils::codegen_backend::CodegenBackend>::codegen_crate::hb62d04d0bb4aee9d\r\n  33:     0x7fb037038ce1 - rustc::util::common::time::hed0ba969379f3144\r\n  34:     0x7fb037055a1d - rustc_driver::driver::phase_4_codegen::h7de0b037a738f5e8\r\n  35:     0x7fb0370ef343 - rustc_driver::driver::compile_input::{{closure}}::h02fddf9351c26ef6\r\n  36:     0x7fb0370e8129 - rustc::ty::context::tls::enter_context::h8f0d021915b2f34d\r\n  37:     0x7fb0370aa26a - <std::thread::local::LocalKey<T>>::with::h68c56c88e15ae56a\r\n  38:     0x7fb03710ccd6 - rustc::ty::context::TyCtxt::create_and_enter::h525f6f0ef4f469d3\r\n  39:     0x7fb03704eb88 - rustc_driver::driver::compile_input::h4f47cdbacf41587e\r\n  40:     0x7fb0370f3fdc - rustc_driver::run_compiler_with_pool::hf2761cb646965bbf\r\n  41:     0x7fb03704c814 - rustc_driver::driver::spawn_thread_pool::he9b41f41389dfef1\r\n  42:     0x7fb0370f2ff1 - rustc_driver::run_compiler::h2f161f58bd524a71\r\n  43:     0x7fb03703b0ec - <scoped_tls::ScopedKey<T>>::set::hf16868c69d7a8d53\r\n  44:     0x7fb037077171 - syntax::with_globals::h8dae2372140c50b5\r\n  45:     0x7fb036ce41f9 - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  46:     0x7fb0370f124c - rustc_driver::run::h26fa391579b13041\r\n  47:     0x7fb0370ff29a - rustc_driver::main::h943dabc10c09630e\r\n  48:     0x55d57d868952 - std::rt::lang_start::{{closure}}::hadd84dae5f71d4e1\r\n  49:     0x7fb036ca46d2 - std::panicking::try::do_call::h3c29175827f8c066\r\n                               at libstd/rt.rs:59\r\n                               at libstd/panicking.rs:310\r\n  50:     0x7fb036ce41f9 - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  51:     0x7fb036cbaba5 - std::rt::lang_start_internal::h790baabe7ccaf0b4\r\n                               at libstd/panicking.rs:289\r\n                               at libstd/panic.rs:392\r\n                               at libstd/rt.rs:58\r\n  52:     0x55d57d8689b3 - main\r\n  53:     0x7fb0368b411a - __libc_start_main\r\n  54:     0x55d57d868838 - <unknown>\r\nquery stack during panic:\r\nend of query stack\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.30.0-nightly (79fcc58b2 2018-09-18) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `toy_parser`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\nCargo-Process exited abnormally with code 101 at Sun Sep 23 23:41:56\r\n\r\n````", "closed_by": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54515/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54515/timeline", "performed_via_github_app": null, "state_reason": "completed"}