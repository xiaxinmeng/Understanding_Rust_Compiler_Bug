{"url": "https://api.github.com/repos/rust-lang/rust/issues/7793", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7793/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7793/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7793/events", "html_url": "https://github.com/rust-lang/rust/issues/7793", "id": 16738744, "node_id": "MDU6SXNzdWUxNjczODc0NA==", "number": 7793, "title": "Cross-crate inlined drop methods don't work.", "user": {"login": "mstewartgallus", "id": 4070335, "node_id": "MDQ6VXNlcjQwNzAzMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4070335?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mstewartgallus", "html_url": "https://github.com/mstewartgallus", "followers_url": "https://api.github.com/users/mstewartgallus/followers", "following_url": "https://api.github.com/users/mstewartgallus/following{/other_user}", "gists_url": "https://api.github.com/users/mstewartgallus/gists{/gist_id}", "starred_url": "https://api.github.com/users/mstewartgallus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mstewartgallus/subscriptions", "organizations_url": "https://api.github.com/users/mstewartgallus/orgs", "repos_url": "https://api.github.com/users/mstewartgallus/repos", "events_url": "https://api.github.com/users/mstewartgallus/events{/privacy}", "received_events_url": "https://api.github.com/users/mstewartgallus/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 13242248, "node_id": "MDU6TGFiZWwxMzI0MjI0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-metadata", "name": "A-metadata", "color": "f7e101", "default": false, "description": "Area: crate metadata"}, {"id": 43009118, "node_id": "MDU6TGFiZWw0MzAwOTExOA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-destructors", "name": "A-destructors", "color": "f7e101", "default": false, "description": "Area: destructors (Drop, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-07-15T03:56:05Z", "updated_at": "2014-05-11T00:26:32Z", "closed_at": "2014-05-11T00:26:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider the following crate myextra.rs, and user of the crate main.rs. After the myextra.rs crate is succesfully compiled, and when main.rs is compiled, and linked with myextra.rs the following internal compiler error occurs, and the following error is logged (with RUST_LOG=1)\n\n```\nrust: ~\"failed to find block with tag 13\"\nrust: task failed at 'explicit failure', /home/steven/others/src/rust/src/libextra/ebml.rs:219\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/steven/others/src/rust/src/librustc/rustc.rs:362\nrust: domain main @0xad8010 root task failed\n```\n\nmyextra.rs\n\n``` rust\n#[link(name = \"myextra\")];\n#[crate_type = \"lib\"];\n\n\npub struct WriteLock;\n\nimpl WriteLock {\n    pub fn new() -> WriteLock { fail!() }\n}\n\nimpl Drop for WriteLock {\n    // Removing the inline attribute fixes the problem\n    #[inline(always)]\n    fn drop(&mut self) { }\n}\n```\n\nmain.rs\n\n``` rust\nextern mod myextra;\n\nuse myextra::WriteLock;\n\n\nfn main() {\n    let _foo = WriteLock::new();\n}\n```\n\nCommands to reproduce:\n\n```\n% rustc --lib myextra.rs && RUST_LOG=rustc=1 rustc -L. main.rs\nwarning: missing crate link meta `vers`, using `0.0` as default\nwarning: no debug symbols in executable (-arch x86_64)\nfailed to find block with tag 13\ntask <unnamed> failed at 'explicit failure', /Users/fklock/Dev/Mozilla/rust.git/src/libextra/ebml.rs:220\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1 to get further details and report the results to github.com/mozilla/rust/issues\ntask <unnamed> failed at 'explicit failure', /Users/fklock/Dev/Mozilla/rust.git/src/librustc/rustc.rs:377\n% \n```\n\nStack trace from gdb:\n\n```\n(gdb) bt\n#0  0x00007fff8fb6a521 in __cxa_throw ()\n#1  0x0000000102c21c27 in rust_begin_unwind (token=<value temporarily unavailable, due to optimizations>) at /Users/fklock/Dev/Mozilla/rust.git/src/rt/rust_builtin.cpp:533\n#2  0x000000010008ecc6 in rt::task::Unwinder::begin_unwind::h7c12263797ed078Twao::v0.8$x2dpre ()\n#3  0x000000010008dff2 in sys::begin_unwind_::h89e154cd0915671aJ::v0.8$x2dpre ()\n#4  0x000000010008e152 in sys::__extensions__::fail_with::anon::anon::expr_fn::af ()\n#5  0x000000010008da48 in c_str::ToCStr::with_c_str::hc6798931b183a7aa::v0.8$x2dpre ()\n#6  0x000000010008e101 in sys::__extensions__::fail_with::anon::expr_fn::ae ()\n#7  0x000000010008da48 in c_str::ToCStr::with_c_str::hc6798931b183a7aa::v0.8$x2dpre ()\n#8  0x000000010000ca7c in sys::FailWithCause$__extensions__::fail_with::hdb4c44d01ce4116AHa0::v0.8$x2dpre ()\n#9  0x00000001005d0211 in ebml::reader::get_doc::h48e2c3d9cf8ec3d8aG::v0.8$x2dpre ()\n#10 0x00000001013c50d5 in metadata::decoder::item_symbol::h67beac06c34ecebaJ::v0.8$x2dpre ()\n#11 0x00000001013cb63c in metadata::decoder::get_symbol::h18a6afa78b26cbf3ay::v0.8$x2dpre ()\n#12 0x0000000100d9f6d6 in metadata::csearch::get_symbol::h20f8f2c15a6feb90ax::v0.8$x2dpre ()\n#13 0x0000000100d44f6b in middle::trans::base::get_res_dtor::hda2a82128fbf9c23a8::v0.8$x2dpre ()\n#14 0x0000000100d44637 in middle::trans::glue::trans_struct_drop_flag::anon::expr_fn::aJ ()\n#15 0x0000000100d441b1 in middle::trans::base::with_cond::hcf4955b2b88de3daG::v0.8$x2dpre ()\n#16 0x0000000100d42f86 in middle::trans::glue::trans_struct_drop_flag::heaa8734681d4d6baD::v0.8$x2dpre ()\n#17 0x0000000100d3eb06 in middle::trans::glue::make_drop_glue::h5d8c6f0d36ac2e4ae::v0.8$x2dpre ()\n#18 0x0000000100d4ce16 in middle::trans::glue::make_generic_glue_inner::hc8fa84edf7bf7faF::v0.8$x2dpre ()\n#19 0x0000000100d3dceb in middle::trans::glue::make_generic_glue::ha7ad711b993f6f80ag::v0.8$x2dpre ()\n#20 0x0000000100d3ba6a in middle::trans::glue::lazily_emit_tydesc_glue::h30c42fc3732305dad::v0.8$x2dpre ()\n#21 0x0000000100d3f8ce in middle::trans::glue::call_tydesc_glue_full::hfc61d796e17b57cbaC::v0.8$x2dpre ()\n#22 0x0000000100d39cb2 in middle::trans::glue::call_tydesc_glue::hc5996dd21893fag::v0.8$x2dpre ()\n#23 0x0000000100d39fa2 in middle::trans::glue::drop_ty::h5d8c6f0d36ac2e4aD::v0.8$x2dpre ()\n#24 0x0000000100dda6af in middle::trans::common::add_clean::anon::anon::expr_fn::aC ()\n#25 0x0000000100e1853c in middle::trans::base::trans_block_cleanups_::hec4ff651426f5a6aI::v0.8$x2dpre ()\n#26 0x0000000100e18e34 in middle::trans::base::cleanup_block::h6561f3b8f40496aB::v0.8$x2dpre ()\n#27 0x0000000100e21e38 in middle::trans::base::trans_closure::h24546ef980e82cc9a8::v0.8$x2dpre ()\n#28 0x0000000100cf3fa0 in middle::trans::base::trans_fn::h4aa9be3f4a84a92ar::v0.8$x2dpre ()\n#29 0x0000000100cea483 in middle::trans::base::trans_item::h7140b0485824492aa::v0.8$x2dpre ()\n#30 0x0000000100e2864f in middle::trans::base::trans_mod::h5661676b3713944av::v0.8$x2dpre ()\n#31 0x0000000100e33e1e in middle::trans::base::trans_crate::ha032f53ebcceafac::v0.8$x2dpre ()\n#32 0x00000001013f1d7e in driver::driver::phase_4_translate_to_llvm::h58f312694ff58822ah::v0.8$x2dpre ()\n#33 0x00000001013f2af0 in driver::driver::compile_input::h97189be1b4289193ah::v0.8$x2dpre ()\n#34 0x0000000101418924 in run_compiler::h728412684e5354f9ar::v0.8$x2dpre ()\n#35 0x000000010142e4de in main_args::anon::expr_fn::a0 ()\n#36 0x000000010142c2fd in monitor::anon::expr_fn::az ()\n#37 0x00000001014293bf in task::TaskBuilder::try::anon::expr_fn::BPaoah ()\n#38 0x0000000100065ea0 in task::spawn::spawn_raw::anon::expr_fn::aU ()\n#39 0x00000001000ac1c0 in rt::task::__extensions__::build_start_wrapper::anon::anon::expr_fn::ar ()\n#40 0x00000001000aa6e7 in rt::task::__extensions__::run::anon::expr_fn::aJ ()\n#41 0x0000000102c21ba3 in rust_try (f=<value temporarily unavailable, due to optimizations>, fptr=<value temporarily unavailable, due to optimizations>, env=<value temporarily unavailable, due to optimizations>) at /Users/fklock/Dev/Mozilla/rust.git/src/rt/rust_builtin.cpp:523\n#42 0x00000001000aa61c in rt::task::Unwinder::try::h199ab8d6eb226980TwaI::v0.8$x2dpre ()\n#43 0x00000001000aa491 in rt::task::Task::run::h199ab8d6eb226980EUaH::v0.8$x2dpre ()\n#44 0x00000001000abd9c in rt::task::__extensions__::build_start_wrapper::anon::expr_fn::ai ()\n```\n", "closed_by": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7793/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7793/timeline", "performed_via_github_app": null, "state_reason": "completed"}