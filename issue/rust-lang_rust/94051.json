{"url": "https://api.github.com/repos/rust-lang/rust/issues/94051", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94051/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94051/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94051/events", "html_url": "https://github.com/rust-lang/rust/issues/94051", "id": 1139864397, "node_id": "I_kwDOAAsO6M5D8PNN", "number": 94051, "title": "rustc build artifacts should contain checksum to pervent unrelated ICEs / miscompiles / etc", "user": {"login": "klensy", "id": 1782831, "node_id": "MDQ6VXNlcjE3ODI4MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1782831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klensy", "html_url": "https://github.com/klensy", "followers_url": "https://api.github.com/users/klensy/followers", "following_url": "https://api.github.com/users/klensy/following{/other_user}", "gists_url": "https://api.github.com/users/klensy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klensy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klensy/subscriptions", "organizations_url": "https://api.github.com/users/klensy/orgs", "repos_url": "https://api.github.com/users/klensy/repos", "events_url": "https://api.github.com/users/klensy/events{/privacy}", "received_events_url": "https://api.github.com/users/klensy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 1448485701, "node_id": "MDU6TGFiZWwxNDQ4NDg1NzAx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-error-handling", "name": "A-error-handling", "color": "f7e101", "default": false, "description": "Area: Error handling"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-02-16T11:03:58Z", "updated_at": "2022-02-16T22:47:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Checked with incremental compilation artifacts:\r\n\r\n1. Created default cargo project with:\r\nmain.rs:\r\n```rust\r\nfn main(){}\r\n```\r\n2. in Cargo.toml turned on `incremental = true, codegen-units=1`\r\n3. `cargo build`\r\n4. in `target/debug/incremental/[some_path]` folder opened some `dep-graph.bin`, `query-cache.bin` (didn't checked other types yet) and randomly changed few bytes.\r\n5. opened main.rs and added\\removed spaces around (to use incremental build)\r\n6. `cargo build`\r\n\r\n\r\nI'm expected, that build will be failed, because of wrong checksum/hash of corrupted files, and some error like: \"files was corrupted, etc..\",\r\nbut it actually builds successfully or ICEs with general message, like that (here i changed dep-graph file, i guess) (can be differ from time to time, so this exact ICE is not important)\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', compiler\\rustc_metadata\\src\\rmeta\\def_path_hash_map.rs:18:85\r\nstack backtrace:\r\n   0:      0x7fed7737e30 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::he376fbea1245f2cf\r\n   1:      0x7fed7767a9a - core::fmt::write::h5e138f42fa148c9f\r\n   2:      0x7fed7729059 - <std::io::IoSlice as core::fmt::Debug>::fmt::h2ac239f531b51c25\r\n   3:      0x7fed773b5a2 - std::panicking::default_hook::hdac2f70bb79c9285\r\n   4:      0x7fed773b163 - std::panicking::default_hook::hdac2f70bb79c9285\r\n   5:      0x7feb1798149 - <rustc_driver[d0f8e8bee9276d3d]::args::Error as core[caf1bcf4c9c99831]::fmt::Debug>::fmt\r\n   6:      0x7fed773bed2 - std::panicking::rust_panic_with_hook::hf60975f0d343d471\r\n   7:      0x7fed773bbe2 - <std::panicking::begin_panic_handler::StrPanicPayload as core::panic::BoxMeUp>::get::ha1e40f14bea3163b\r\n   8:      0x7fed7738787 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::he376fbea1245f2cf\r\n   9:      0x7fed773b899 - rust_begin_unwind\r\n  10:      0x7fed779ac95 - core::panicking::panic_fmt::h169c5b4c17c0b46c\r\n  11:      0x7fed779ab3c - core::panicking::panic::h774c6a2306362c68\r\n  12:      0x7feb54169da - <rustc_metadata[980890dc6482dc21]::creader::CStore as rustc_session[9c2fdf61d4d3706c]::cstore::CrateStore>::def_path_hash_to_def_id\r\n  13:      0x7feb5bf1bc6 - <rustc_middle[5be9dd9712efa76d]::ty::context::TyCtxt>::def_path_hash_to_def_id\r\n  14:      0x7feb5c66cc4 - <rustc_query_system[4f119c27d31e4817]::dep_graph::dep_node::DepNode<rustc_middle[5be9dd9712efa76d]::dep_graph::dep_node::DepKind> as rustc_middle[5be9dd9712efa76d]::dep_graph::dep_node::DepNodeExt>::extract_def_id\r\n  15:      0x7feb4e5d3a6 - <&[rustc_span[1644296338110723]::span_encoding::Span] as rustc_serialize[f2ace800d99ebe3b]::serialize::Decodable<rustc_query_impl[7231c5a387277fbd]::on_disk_cache::CacheDecoder>>::decode\r\n  16:      0x7feb5bd60c4 - <rustc_middle[5be9dd9712efa76d]::ty::context::TyCtxt as rustc_query_system[4f119c27d31e4817]::dep_graph::DepContext>::try_load_from_on_disk_cache\r\n  17:      0x7feb4f56dcd - <&[rustc_ast[84776166d75f4b05]::ast::InlineAsmTemplatePiece] as rustc_serialize[f2ace800d99ebe3b]::serialize::Decodable<rustc_query_impl[7231c5a387277fbd]::on_disk_cache::CacheDecoder>>::decode\r\n  18:      0x7feb4ea2202 - <rustc_query_impl[7231c5a387277fbd]::on_disk_cache::OnDiskCache as rustc_middle[5be9dd9712efa76d]::ty::context::OnDiskCache>::drop_serialized_data\r\n  19:      0x7feb5199b79 - rustc_incremental[70b4dd3adfb609db]::persist::work_product::delete_workproduct_files\r\n  20:      0x7feb5179e9f - <rustc_incremental[70b4dd3adfb609db]::assert_dep_graph::GraphvizDepGraph as rustc_graphviz[d20dbb5caf23c65]::Labeller>::node_label\r\n  21:      0x7feb5156758 - rustc_incremental[70b4dd3adfb609db]::persist::save::save_dep_graph\r\n  22:      0x7feb1743f9a - <rustc_driver[d0f8e8bee9276d3d]::args::Error as core[caf1bcf4c9c99831]::fmt::Debug>::fmt\r\n  23:      0x7feb170b960 - <rustc_codegen_ssa[8458bcb186c10200]::back::linker::BpfLinker as rustc_codegen_ssa[8458bcb186c10200]::back::linker::Linker>::no_default_libraries\r\n  24:      0x7feb172ee76 - <rustc_codegen_ssa[8458bcb186c10200]::back::linker::BpfLinker as rustc_codegen_ssa[8458bcb186c10200]::back::linker::Linker>::no_default_libraries\r\n  25:      0x7feb1737cd5 - <rustc_driver[d0f8e8bee9276d3d]::args::Error as core[caf1bcf4c9c99831]::fmt::Debug>::fmt\r\n  26:      0x7feb172d42a - <rustc_codegen_ssa[8458bcb186c10200]::back::linker::BpfLinker as rustc_codegen_ssa[8458bcb186c10200]::back::linker::Linker>::no_default_libraries\r\n  27:      0x7feb170e25a - <rustc_codegen_ssa[8458bcb186c10200]::back::linker::BpfLinker as rustc_codegen_ssa[8458bcb186c10200]::back::linker::Linker>::no_default_libraries\r\n  28:      0x7feb17ae1e8 - rustc_driver[d0f8e8bee9276d3d]::pretty::print_after_hir_lowering\r\n  29:      0x7fed774cbec - std::sys::windows::thread::Thread::new::h25c1e3623f62de88\r\n  30:         0x76d3556d - BaseThreadInitThunk\r\n  31:         0x76e9372d - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.60.0-nightly (09cb29c64 2022-02-15) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type bin -C embed-bitcode=no -C codegen-units=1 -C debuginfo=2 -C incremental\r\n\r\n```\r\n\r\n@rustbot label +A-incr-comp +A-error-handling ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94051/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94051/timeline", "performed_via_github_app": null, "state_reason": null}