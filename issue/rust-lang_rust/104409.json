{"url": "https://api.github.com/repos/rust-lang/rust/issues/104409", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104409/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104409/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104409/events", "html_url": "https://github.com/rust-lang/rust/issues/104409", "id": 1448350494, "node_id": "I_kwDOAAsO6M5WVBMe", "number": 104409, "title": "mir typeck: subtyping cannot deal with bivariance", "user": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3675472455, "node_id": "LA_kwDOAAsO6M7bE0JH", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-variance", "name": "A-variance", "color": "f7e101", "default": false, "description": "Area: Variance (https://doc.rust-lang.org/nomicon/subtyping.html)"}, {"id": 4172483496, "node_id": "LA_kwDOAAsO6M74swuo", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-types", "name": "T-types", "color": "bfd4f2", "default": false, "description": "Relevant to the types team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2022-11-14T16:13:00Z", "updated_at": "2022-11-19T09:30:33Z", "closed_at": "2022-11-19T09:30:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\ntrait Trait {\n    type Assoc;\n}\n\nstruct Foo<T, U>(T)\nwhere\n    T: Trait<Assoc = U>;\n\nimpl Trait for for<'a> fn(&'a ()) {\n    type Assoc = u32;\n}\nimpl Trait for fn(&'static ()) {\n    type Assoc = String;\n}\n    \nfn foo(x: Foo<for<'a> fn(&'a ()), u32>) -> Foo<fn(&'static ()), String> {\n    x\n}\n\nfn main() {}\n```\nresults in the following ICE:\n```rust\nerror: internal compiler error: broken MIR in DefId(0:15 ~ example[9884]::foo) (_0 = move _1): bad assignment (Foo<fn(&()), std::string::String> = Foo<for<'a> fn(&'a ()), u32>): NoSolution\n  --> <source>:17:5\n   |\n17 |     x\n   |     ^\n\nthread 'rustc' panicked at 'aborting due to `-Z treat-err-as-bug=1`', compiler/rustc_errors/src/lib.rs:1561:30\nstack backtrace:\n----------- SNIP ----------------------\n  17:     0x7fe0e8c751b3 - <rustc_errors[1020869c0a53ac34]::HandlerInner>::panic_if_treat_err_as_bug\n  18:     0x7fe0e8c73258 - <rustc_errors[1020869c0a53ac34]::HandlerInner>::emit_diagnostic\n  19:     0x7fe0ea774481 - <rustc_errors[1020869c0a53ac34]::HandlerInner>::emit_diag_at_span::<rustc_span[efd8b0f1895919e0]::span_encoding::Span>\n  20:     0x7fe0ea774603 - <rustc_errors[1020869c0a53ac34]::HandlerInner>::span_bug::<rustc_span[efd8b0f1895919e0]::span_encoding::Span, &str>\n  21:     0x7fe0ea773c55 - <rustc_errors[1020869c0a53ac34]::Handler>::delay_span_bug::<rustc_span[efd8b0f1895919e0]::span_encoding::Span, &str>\n  22:     0x7fe0e9228157 - <rustc_borrowck[e2ad9be94bf77b7a]::type_check::TypeChecker>::typeck_mir\n  23:     0x7fe0e919c351 - rustc_borrowck[e2ad9be94bf77b7a]::type_check::type_check\n  24:     0x7fe0e9187179 - rustc_borrowck[e2ad9be94bf77b7a]::nll::compute_regions\n  25:     0x7fe0e915c6e8 - rustc_borrowck[e2ad9be94bf77b7a]::do_mir_borrowck\n  26:     0x7fe0e9b8f296 - rustc_borrowck[e2ad9be94bf77b7a]::mir_borrowck\n```\n[godbolt](https://godbolt.org/z/WdM3qPM63)\n\nThis should compile\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"lcnr\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104409/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104409/timeline", "performed_via_github_app": null, "state_reason": "completed"}