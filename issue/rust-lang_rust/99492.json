{"url": "https://api.github.com/repos/rust-lang/rust/issues/99492", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/99492/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/99492/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/99492/events", "html_url": "https://github.com/rust-lang/rust/issues/99492", "id": 1310430678, "node_id": "I_kwDOAAsO6M5OG5XW", "number": 99492, "title": "Spurious \"implementation of `FnOnce` is not general enough\" error", "user": {"login": "mystenmark", "id": 103447440, "node_id": "U_kgDOBip7kA", "avatar_url": "https://avatars.githubusercontent.com/u/103447440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mystenmark", "html_url": "https://github.com/mystenmark", "followers_url": "https://api.github.com/users/mystenmark/followers", "following_url": "https://api.github.com/users/mystenmark/following{/other_user}", "gists_url": "https://api.github.com/users/mystenmark/gists{/gist_id}", "starred_url": "https://api.github.com/users/mystenmark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mystenmark/subscriptions", "organizations_url": "https://api.github.com/users/mystenmark/orgs", "repos_url": "https://api.github.com/users/mystenmark/repos", "events_url": "https://api.github.com/users/mystenmark/events{/privacy}", "received_events_url": "https://api.github.com/users/mystenmark/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}, {"id": 1259721467, "node_id": "MDU6TGFiZWwxMjU5NzIxNDY3", "url": "https://api.github.com/repos/rust-lang/rust/labels/AsyncAwait-Triaged", "name": "AsyncAwait-Triaged", "color": "d4c5f9", "default": false, "description": "Async-await issues that have been triaged during a working group meeting."}, {"id": 3921861239, "node_id": "LA_kwDOAAsO6M7pwtp3", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-bug-has-test", "name": "S-bug-has-test", "color": "862eff", "default": false, "description": "A `known-bug` test has been added for this bug."}, {"id": 4172483496, "node_id": "LA_kwDOAAsO6M74swuo", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-types", "name": "T-types", "color": "bfd4f2", "default": false, "description": "Relevant to the types team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2022-07-20T04:48:33Z", "updated_at": "2023-05-05T11:15:14Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hello rustaceans, I'll start with the brief overview and provide repro instructions at the end:\r\n\r\nGiven the following code:\r\n\r\n```rust\r\n    pub async fn spawn_execute_process(self: Arc<Self>) -> JoinHandle<()> {\r\n        tokio::task::spawn(async move {\r\n            execution_process(&self).await;\r\n        })\r\n    }\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror: implementation of `FnOnce` is not general enough\r\n   --> crates/sui-core/src/authority_active.rs:327:9\r\n    |\r\n327 |         tokio::task::spawn(async move {\r\n    |         ^^^^^^^^^^^^^^^^^^ implementation of `FnOnce` is not general enough\r\n    |\r\n    = note: closure with signature `fn(&'0 (u64, sui_types::base_types::TransactionDigest)) -> u64` must implement `FnOnce<(&(u64, sui_types::base_types::TransactionDigest),)>`, for any lifetime `'0`...\r\n    = note: ...but it actually implements `FnOnce<(&(u64, sui_types::base_types::TransactionDigest),)>`\r\n```\r\n\r\nThis is pretty fishy looking already - as you can see there is no closure in the code above, and the async block doesn't look anything like `(u64, TransactionDigest) -> u64` \r\n\r\nI did however add such a closure _in another file_. And sure enough if I remove that closure from that other file, this problem goes away.\r\n\r\nUnfortunately I don't have time to try to pare this down to a minimal repro right now, but I can provide a repo link.\r\n\r\nInstructions:\r\n* `git clone https://github.com/mystenmark/sui.git`\r\n* `cd sui`\r\n* `git checkout rust-bug-repro` (commit description is \"Reproduce the error at this commit\")\r\n* `cargo check`\r\n* Observe the error\r\n* `git checkout rust-bug-repro-workaround` (commit description is \"Make the error magically go away\")\r\n* `cargo check`\r\n* Observe that the error is gone\r\n\r\nAs you can see the commit that fixes the error isn't even in the same file, nor does it alter any public function signatures or type defintions: https://github.com/mystenmark/sui/commit/73302e1f5a7942635114e7a5c1f7e1db38b377ee\r\n\r\nLastly, this is happens on both rust 1.62.0 and 1.62.1 - the branch above uses 1.62.1\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/99492/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/99492/timeline", "performed_via_github_app": null, "state_reason": null}