{"url": "https://api.github.com/repos/rust-lang/rust/issues/83996", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83996/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83996/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83996/events", "html_url": "https://github.com/rust-lang/rust/issues/83996", "id": 853491081, "node_id": "MDU6SXNzdWU4NTM0OTEwODE=", "number": 83996, "title": "Slices that cover the last byte of the address space are invalid", "user": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}, {"id": 889209675, "node_id": "MDU6TGFiZWw4ODkyMDk2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-iterators", "name": "A-iterators", "color": "f7e101", "default": false, "description": "Area: Iterators"}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2021-04-08T13:45:17Z", "updated_at": "2023-06-16T12:45:38Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The current implementation uses `pointer::add` to compute the end pointer for the bounds check:\r\nhttps://github.com/rust-lang/rust/blob/69e1d22ddbc67b25141a735a22a8895a678b32ca/library/core/src/slice/iter.rs#L88-L102\r\nThe method requires that the calculation will not overflow a `usize`, however that is not always the case. For instance, an allocator might return the last available page (`0xfffff000` on x86) and correctly return a slice of `u8` (with size 4096 on x86). If a program now iterates over the slice, the end pointer will overflow, wrapping around the address space and thus creating UB. \r\n\r\nThis behaviour is extremely unlikely and only occurs with `no_std` as most kernels reserve the higher half of the address space anyway. \r\n\r\n# Solutions\r\n* Use wrapping_add instead, which avoids the UB, but might disable some optimizations\r\n* Update the requirements for allocators so they aren't allowed to return the last bit of memory\r\n* \u2026", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83996/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83996/timeline", "performed_via_github_app": null, "state_reason": null}