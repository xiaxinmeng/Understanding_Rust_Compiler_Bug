{"url": "https://api.github.com/repos/rust-lang/rust/issues/22570", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22570/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22570/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22570/events", "html_url": "https://github.com/rust-lang/rust/issues/22570", "id": 58340129, "node_id": "MDU6SXNzdWU1ODM0MDEyOQ==", "number": 22570, "title": "Strange behaviour of BufReader", "user": {"login": "antekone", "id": 1664036, "node_id": "MDQ6VXNlcjE2NjQwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1664036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antekone", "html_url": "https://github.com/antekone", "followers_url": "https://api.github.com/users/antekone/followers", "following_url": "https://api.github.com/users/antekone/following{/other_user}", "gists_url": "https://api.github.com/users/antekone/gists{/gist_id}", "starred_url": "https://api.github.com/users/antekone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antekone/subscriptions", "organizations_url": "https://api.github.com/users/antekone/orgs", "repos_url": "https://api.github.com/users/antekone/repos", "events_url": "https://api.github.com/users/antekone/events{/privacy}", "received_events_url": "https://api.github.com/users/antekone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-02-20T11:30:52Z", "updated_at": "2017-02-06T15:08:26Z", "closed_at": "2015-02-20T15:29:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "Edit: It seems I was too hasty about this, and this actually is an expected behaviour. I'm not sure I can remove this entry, so please close it.\n\nOn Reddit I've got an advice that this could be a known issue and it will be fixed in time, but I couldn't find it in the issue list, so here it goes.\n\nHere's the code of the POC:\n\n```\n#![feature(fs)]\n#![feature(io)]\n\nuse std::io::prelude::*;\nuse std::io::BufReader;\nuse std::fs::File;\n\nfn main() {\n    check_sample_file();\n}\n\nfn check_sample_file() {\n    let mut reader = BufReader::new(File::open(\"test.bin\").unwrap());\n\n    let mut buf = [0u8; 520];\n    let mut sum_read = 0us;\n\n    for i in (0..140us) {\n        match reader.read(&mut buf) {\n            Ok(count) => {\n                sum_read += count;\n                println!(\"Read {} bytes, sum of read bytes: {}\", count, sum_read);\n            },\n            Err(_) => return\n        }\n    }\n}\n```\n\nAll it does is that it reads the file in 520-byte chunks by using a buffering layer in the form of BufReader. Now here's the output:\n\n```\n[...]\nRead 520 bytes, sum of read bytes: 64480\nRead 520 bytes, sum of read bytes: 65000\nRead 520 bytes, sum of read bytes: 65520\nRead 16 bytes, sum of read bytes: 65536\nRead 520 bytes, sum of read bytes: 66056\nRead 520 bytes, sum of read bytes: 66576\nRead 520 bytes, sum of read bytes: 67096\n[...]\n```\n\nWhy it suddenly read 16 bytes, up to the boundary of its buffer capacity? Shouldn't BufReader handle this case and abstract me from these kinds of problems?\n\nMy Rustc version is: rustc 1.0.0-nightly (dfc5c0f1e 2015-02-18) (built 2015-02-19)\n", "closed_by": {"login": "antekone", "id": 1664036, "node_id": "MDQ6VXNlcjE2NjQwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1664036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antekone", "html_url": "https://github.com/antekone", "followers_url": "https://api.github.com/users/antekone/followers", "following_url": "https://api.github.com/users/antekone/following{/other_user}", "gists_url": "https://api.github.com/users/antekone/gists{/gist_id}", "starred_url": "https://api.github.com/users/antekone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antekone/subscriptions", "organizations_url": "https://api.github.com/users/antekone/orgs", "repos_url": "https://api.github.com/users/antekone/repos", "events_url": "https://api.github.com/users/antekone/events{/privacy}", "received_events_url": "https://api.github.com/users/antekone/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22570/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22570/timeline", "performed_via_github_app": null, "state_reason": "completed"}