{"url": "https://api.github.com/repos/rust-lang/rust/issues/13474", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13474/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13474/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13474/events", "html_url": "https://github.com/rust-lang/rust/issues/13474", "id": 31373892, "node_id": "MDU6SXNzdWUzMTM3Mzg5Mg==", "number": 13474, "title": "Compiler crashes when loading macros from a crate that contains syntax extensions", "user": {"login": "vosen", "id": 1206376, "node_id": "MDQ6VXNlcjEyMDYzNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1206376?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vosen", "html_url": "https://github.com/vosen", "followers_url": "https://api.github.com/users/vosen/followers", "following_url": "https://api.github.com/users/vosen/following{/other_user}", "gists_url": "https://api.github.com/users/vosen/gists{/gist_id}", "starred_url": "https://api.github.com/users/vosen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vosen/subscriptions", "organizations_url": "https://api.github.com/users/vosen/orgs", "repos_url": "https://api.github.com/users/vosen/repos", "events_url": "https://api.github.com/users/vosen/events{/privacy}", "received_events_url": "https://api.github.com/users/vosen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2014-04-12T01:38:37Z", "updated_at": "2014-04-16T15:11:06Z", "closed_at": "2014-04-16T15:11:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Rustc crashes when running following code:\n\n``` Rust\n#![feature(phase)]\n\n#[phase(syntax)] extern crate fourcc;\n\nfn main() { }\n```\n\nHere's gdb output:\n\n```\n(gdb) r fourcc-crash.rs\nStarting program: D:\\dev\\Rust\\bin\\rustc.exe fourcc-crash.rs\n[New Thread 3524.0x1894]\n[New Thread 3524.0x14f4]\n\nYou've met with a terrible fate, haven't you?\n\nfatal runtime error: runtime tls key not initialized\nstack backtrace:\n   1: 0x6eeb1a3f\n   2: 0x6ef13a28\n   3: 0x6eeb370f\n   4: 0x712c12c3\n   5:  0x18b8332\n\nProgram received signal SIGILL, Illegal instruction.\n[Switching to Thread 3524.0x14f4]\n0x6eeb1a59 in rt::util::abort::h439cebf64f55f5c1U4a::v0.11.pre () from D:\\dev\\Rust\\bin\\std-aad93cea-0.11-pre.dll\n(gdb) bt\n#0  0x6eeb1a59 in rt::util::abort::h439cebf64f55f5c1U4a::v0.11.pre () from D:\\dev\\Rust\\bin\\std-aad93cea-0.11-pre.dll\n#1  0x6ef13a28 in rt::local_ptr::native::unsafe_borrow::h0d5317ed6ed9ce06fW9::v0.11.pre ()\n   from D:\\dev\\Rust\\bin\\std-aad93cea-0.11-pre.dll\n#2  0x6eeb370f in local_data::get_local_map::h6aadaf5daa81cd9c0pF::v0.11.pre () from D:\\dev\\Rust\\bin\\std-aad93cea-0.11-pre.dll\n#3  0x678f52d7 in parse::token::get_ident_interner::h0bb6c51e2d627c67UjI::v0.11.pre ()\n   from D:\\dev\\Rust\\bin\\syntax-5de2fc8e-0.11-pre.dll\n#4  0x712c12c3 in macro_registrar::h5cf23ffc818750f9vaa::v0.11.pre ()\n   from D:\\dev\\Rust\\bin\\rustlib\\i686-pc-mingw32\\lib\\fourcc-e7a24ce8-0.11-pre.dll\n#5  0x018b8332 in ext::expand::load_extern_macros::h08746a7dabbaf50avGR::v0.11.pre ()\n#6  0x018b11bb in fold::noop_fold_mod::closure.26381 ()\n#7  0x018b0eab in iter::Iterator::collect::ha510073717ed79ffV03::v0.11.pre ()\n#8  0x018b0d03 in fold::Folder::fold_mod::h3063a8a13c6911b8d5x::v0.11.pre ()\n#9  0x018d449d in ext::expand::expand_crate::h5be3510f9f4aeaebn4R::v0.11.pre ()\n#10 0x00b838b6 in driver::driver::phase_2_configure_and_expand::closure.88027 ()\n#11 0x00b832e9 in util::common::time::h176addc10893f0b78Pg::v0.11.pre ()\n#12 0x00b812f5 in driver::driver::phase_2_configure_and_expand::h5264ff43d70fb058kye::v0.11.pre ()\n#13 0x00bbe512 in driver::driver::compile_input::hda7d83b4f81d42b9D1e::v0.11.pre ()\n#14 0x00be34c4 in run_compiler::hcafaeca05b1b783eIxm::v0.11.pre ()\n#15 0x00bf5267 in main_args::closure.92185 ()\n#16 0x00bf3c69 in monitor::closure.92070 ()\n#17 0x00befefe in task::TaskBuilder::try::closure.91842 ()\n#18 0x004274b3 in task::spawn_opts::closure.7691 ()\n#19 0x01a5acac in rt::task::Task::run::closure.40013 ()\n#20 0x01a5ed05 in rt::unwind::Unwinder::try::try_fn::he27cd916ec604645k79::v0.11.pre ()\n#21 0x01a66016 in rust_try ()\n#22 0x01a5ab84 in rt::task::Task::run::hd417a7b2504dfe98eA8::v0.11.pre ()\n#23 0x00427360 in task::spawn_opts::closure.7664 ()\n#24 0x01a5e0ed in rt::thread::thread_start::h63560cc2549b235dWe9::v0.11.pre ()\n#25 0x74cb495d in KERNEL32!BaseThreadInitThunk () from C:\\Windows\\SysWOW64\\kernel32.dll\n#26 0x772598ee in ?? ()\n#27 0x772598c4 in ?? ()\n#28 0x00000000 in ?? ()\n```\n\nNote, it works fine with crates that use macros defined with macro_rules (e.g. log) or with phase(link) instead of phase(syntax).\n\nI'm using Windows 8.1 x64 with nightly installer that I've had downloaded few hours ago, but I've also installed 0.10 and it has the same problem:\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13474/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13474/timeline", "performed_via_github_app": null, "state_reason": "completed"}