{"url": "https://api.github.com/repos/rust-lang/rust/issues/63330", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63330/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63330/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63330/events", "html_url": "https://github.com/rust-lang/rust/issues/63330", "id": 477492704, "node_id": "MDU6SXNzdWU0Nzc0OTI3MDQ=", "number": 63330, "title": "bare_trait_objects help is incorrect with Box<Trait + 'lifetime> in 2015 edition", "user": {"login": "mmitteregger", "id": 6066953, "node_id": "MDQ6VXNlcjYwNjY5NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/6066953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mmitteregger", "html_url": "https://github.com/mmitteregger", "followers_url": "https://api.github.com/users/mmitteregger/followers", "following_url": "https://api.github.com/users/mmitteregger/following{/other_user}", "gists_url": "https://api.github.com/users/mmitteregger/gists{/gist_id}", "starred_url": "https://api.github.com/users/mmitteregger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mmitteregger/subscriptions", "organizations_url": "https://api.github.com/users/mmitteregger/orgs", "repos_url": "https://api.github.com/users/mmitteregger/repos", "events_url": "https://api.github.com/users/mmitteregger/events{/privacy}", "received_events_url": "https://api.github.com/users/mmitteregger/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1183099971, "node_id": "MDU6TGFiZWwxMTgzMDk5OTcx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-suggestion-diagnostics", "name": "A-suggestion-diagnostics", "color": "f7e101", "default": false, "description": "Area: suggestions generated by the compiler applied by cargo fix"}, {"id": 1596521768, "node_id": "MDU6TGFiZWwxNTk2NTIxNzY4", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-edition", "name": "D-edition", "color": "c9f7a3", "default": false, "description": "Diagnostic error that should account for edition differences"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-06T17:00:07Z", "updated_at": "2021-04-24T18:51:49Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "The help text message for `bare_trait_objects` is incorrect when using the 2015 edition.\r\n\r\nThe following example gives a correct help text in the 2015 and 2018 edition:\r\n```rust\r\npub fn test(_: Box<::std::any::Any>) {}\r\n```\r\n```rust\r\nwarning: trait objects without an explicit `dyn` are deprecated\r\n --> src/lib.rs:1:20\r\n  |\r\n1 | pub fn test(_: Box<::std::any::Any>) {\r\n  |                    ^^^^^^^^^^^^^^^ help: use `dyn`: `dyn (::std::any::Any)`\r\n  |\r\n  = note: `#[warn(bare_trait_objects)]` on by default\r\n```\r\nbut adding a lifetime to the trait bound produces an incorrect help message for the 2015 edition:\r\n```rust\r\npub fn test(_: Box<::std::any::Any + 'static>) {\r\n}\r\n```\r\n```rust\r\nwarning: trait objects without an explicit `dyn` are deprecated\r\n --> src/lib.rs:1:20\r\n  |\r\n1 | pub fn test(_: Box<::std::any::Any + 'static>) {\r\n  |                    ^^^^^^^^^^^^^^^^^^^^^^^^^ help: use `dyn`: `dyn ::std::any::Any + 'static`\r\n  |\r\n  = note: `#[warn(bare_trait_objects)]` on by default\r\n```\r\nApplying the suggest help text in 2015 edition code results in:\r\n```rust\r\npub fn test(_: Box<dyn ::std::any::Any + 'static>) {\r\n}\r\n```\r\n```rust\r\nerror[E0433]: failed to resolve: use of undeclared type or module `dyn`\r\n --> src/lib.rs:1:20\r\n  |\r\n1 | pub fn test(_: Box<dyn ::std::any::Any + 'static>) {\r\n  |                    ^^^ use of undeclared type or module `dyn`\r\n\r\nwarning: trait objects without an explicit `dyn` are deprecated\r\n --> src/lib.rs:1:20\r\n  |\r\n1 | pub fn test(_: Box<dyn ::std::any::Any + 'static>) {\r\n  |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: use `dyn`: `dyn dyn ::std::any::Any + 'static`\r\n  |\r\n  = note: `#[warn(bare_trait_objects)]` on by default\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nerror: Could not compile `playground`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nThe code actually compiles with the 2018 edition.\r\nThe correct fix for 2015 edition code (which also works for edition 2018) is probably to include parens:\r\n```rust\r\npub fn test(_: Box<dyn (::std::any::Any) + 'static>) {\r\n}\r\n```\r\n\r\nI see two options:\r\n1. Add parens to the help text so that it is correct in both editions.\r\n2. Fix the help text only for the 2015 edition, because the suggested fix is already correct for the 2018 edition.\r\n\r\nI personally prefer the first option for consistency with the existing help text and easier copy/pasting between editions.\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.38.0-nightly (c4715198b 2019-08-05)\r\nbinary: rustc\r\ncommit-hash: c4715198b50d1cdaad44b6e250844362b77dcdd7\r\ncommit-date: 2019-08-05\r\nhost: x86_64-pc-windows-gnu\r\nrelease: 1.38.0-nightly\r\nLLVM version: 9.0\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63330/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63330/timeline", "performed_via_github_app": null, "state_reason": null}