{"url": "https://api.github.com/repos/rust-lang/rust/issues/22957", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22957/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22957/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22957/events", "html_url": "https://github.com/rust-lang/rust/issues/22957", "id": 59451299, "node_id": "MDU6SXNzdWU1OTQ1MTI5OQ==", "number": 22957, "title": "ICE when quasi-quoting ?Sized trait bound", "user": {"login": "rschifflin", "id": 2578071, "node_id": "MDQ6VXNlcjI1NzgwNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/2578071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rschifflin", "html_url": "https://github.com/rschifflin", "followers_url": "https://api.github.com/users/rschifflin/followers", "following_url": "https://api.github.com/users/rschifflin/following{/other_user}", "gists_url": "https://api.github.com/users/rschifflin/gists{/gist_id}", "starred_url": "https://api.github.com/users/rschifflin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rschifflin/subscriptions", "organizations_url": "https://api.github.com/users/rschifflin/orgs", "repos_url": "https://api.github.com/users/rschifflin/repos", "events_url": "https://api.github.com/users/rschifflin/events{/privacy}", "received_events_url": "https://api.github.com/users/rschifflin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-03-02T08:26:08Z", "updated_at": "2015-03-06T00:28:07Z", "closed_at": "2015-03-06T00:28:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "Looks like when using #![feature(quote)], invoking quote_item! with a type bounded by ?Sized throws an internal compiler error.\n\nI tried this code:\n\n``` rust\n#![feature(quote)]\nextern crate syntax;\n\nuse syntax::ext::base::ExtCtxt;\nuse syntax::ptr::P;\nuse syntax::ast::Item;\n\nfn create_item(context: &mut ExtCtxt) -> Option<P<Item>> {\n  quote_item!(context,\n    fn foo<T: ?Sized>() { }\n  )\n}\n```\n\nI expected to see the same kind of output as the exact same code, but using the Sized bound:\n\n``` rust\n#![feature(quote)]\nextern crate syntax;\n\nuse syntax::ext::base::ExtCtxt;\nuse syntax::ptr::P;\nuse syntax::ast::Item;\n\nfn create_item(context: &mut ExtCtxt) -> Option<P<Item>> {\n  quote_item!(context,\n    fn foo<T: Sized>() { }\n  )\n}\n```\n\nBut instead, the former ICE's and the latter compiles just fine.\n## Meta\n\n`rustc --version --verbose`: \n\n```\nrustc 1.0.0-nightly (e233987ce 2015-02-27) (built 2015-02-27)\nbinary: rustc\ncommit-hash: e233987ce1de88a48db2ce612019ba644d3cf5dd\ncommit-date: 2015-02-27\nbuild-date: 2015-02-27\nhost: x86_64-apple-darwin\nrelease: 1.0.0-nightly\n```\n\nBacktrace:\n\n```\nthread 'rustc' panicked at 'explicit panic', /Users/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-mac/build/src/libsyntax/ext/quote.rs:640\n\nstack backtrace:\n   1:         0x12a15fe3 - sys::backtrace::write::hb3b51289927be9aflmA\n   2:         0x12a42f65 - panicking::on_panic::h0306c1498949d4d4X4I\n   3:         0x1296c818 - rt::unwind::begin_unwind_inner::h55bf82c2d60bb553TNI\n   4:         0x11f677e5 - rt::unwind::begin_unwind::h17653505613502601944\n   5:         0x1229feb0 - ext::quote::mk_token::he254548538a307b2gXd\n   6:         0x122a27b9 - ext::quote::mk_tt::ha7795ef1896c9e55P9d\n   7:         0x122a3263 - ext::quote::mk_tts::hce9806a248bdb55eree\n   8:         0x1229cfde - ext::quote::expand_tts::hb0642e8af84d1df2jfe\n   9:         0x1229de6b - ext::quote::expand_parse_call::h044a69775e7fbe53aje\n  10:         0x12183d88 - ext::quote::expand_quote_item::hd4119d1deced932eQOd\n  11:         0x12186c10 - ext::base::F.TTMacroExpander::expand::h5249812734344092700\n  12:         0x121d829e - ext::expand::expand_expr::closure.59368\n  13:         0x121d5ef2 - ext::expand::expand_expr::h50e262962b9cdb1dwwa\n  14:         0x12186d07 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_expr::h575753e63c1823260Ib\n  15:         0x1222af41 - ext::expand::expand_block_elts::closure.59960\n  16:         0x1222944a - ext::expand::expand_block_elts::closure.59945\n  17:         0x121e2dc2 - ext::expand::expand_block_elts::hec4c08ea423187201hb\n  18:         0x12228d28 - ext::expand::expand_block::ha3b6bc1af360039cmhb\n  19:         0x121e1d97 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_block::hd3abe2902689c3351Kb\n  20:         0x121e287b - ext::expand::expand_and_rename_fn_decl_and_block::h98b7f7dcc9e532245Gb\n  21:         0x121ecef0 - ext::expand::expand_item_underscore::hcf5a3615bce025bcQWa\n  22:         0x12254122 - fold::Folder::fold_item_simple::h15113887917141331462\n  23:         0x122538a3 - ptr::P<T>::map::h3996768931285986864\n  24:         0x121e8350 - ext::expand::expand_annotatable::hc29966229e4d8804lsb\n  25:         0x121e2f70 - ext::expand::expand_item::h46ad11869d4d5cd8bTa\n  26:         0x121f25b5 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::h93a5df8409b098e8wJb\n  27:         0x121f2378 - fold::noop_fold_mod::closure.59525\n  28:         0x121f2116 - iter::FlatMap<I, U, F>.Iterator::next::h5348942706720091560\n  29:         0x121f1d60 - vec::Vec<T>.FromIterator<T>::from_iter::h17381127239759809368\n  30:         0x121f199f - fold::noop_fold_mod::h3500212460602705731\n  31:         0x121ed7b9 - ext::expand::expand_item_underscore::hcf5a3615bce025bcQWa\n  32:         0x12254122 - fold::Folder::fold_item_simple::h15113887917141331462\n  33:         0x122538a3 - ptr::P<T>::map::h3996768931285986864\n  34:         0x121e88d5 - ext::expand::expand_annotatable::hc29966229e4d8804lsb\n  35:         0x121e2f70 - ext::expand::expand_item::h46ad11869d4d5cd8bTa\n  36:         0x121f25b5 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::h93a5df8409b098e8wJb\n  37:         0x12260ac4 - ext::expand::expand_crate::hde71209051590b8ccPb\n  38:          0xedbfa14 - driver::phase_2_configure_and_expand::closure.18923\n  39:          0xed7308b - driver::phase_2_configure_and_expand::h9e4875d4573a9bbbCsa\n  40:          0xed62e76 - driver::compile_input::hf09b55bf6562020bHba\n  41:          0xee38077 - run_compiler::h5e74fcf00338d9fdE5b\n  42:          0xee354f1 - thunk::F.Invoke<A, R>::invoke::h14410064886368080395\n  43:          0xee34150 - rt::unwind::try::try_fn::h9227424996074964567\n  44:         0x12abbd69 - rust_try_inner\n  45:         0x12abbd56 - rust_try\n  46:          0xee348b5 - thunk::F.Invoke<A, R>::invoke::h7948097163614817145\n  47:         0x12a2c343 - sys::thread::thread_start::h6bab8dc98adbaf071HE\n  48:         0x93c1d772 - _pthread_start\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22957/timeline", "performed_via_github_app": null, "state_reason": "completed"}