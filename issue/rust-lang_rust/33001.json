{"url": "https://api.github.com/repos/rust-lang/rust/issues/33001", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/33001/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/33001/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/33001/events", "html_url": "https://github.com/rust-lang/rust/issues/33001", "id": 148732979, "node_id": "MDU6SXNzdWUxNDg3MzI5Nzk=", "number": 33001, "title": "thread 'rustc' has overflowed its stack with lalrpop-generated grammar", "user": {"login": "jfranty", "id": 2043682, "node_id": "MDQ6VXNlcjIwNDM2ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/2043682?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jfranty", "html_url": "https://github.com/jfranty", "followers_url": "https://api.github.com/users/jfranty/followers", "following_url": "https://api.github.com/users/jfranty/following{/other_user}", "gists_url": "https://api.github.com/users/jfranty/gists{/gist_id}", "starred_url": "https://api.github.com/users/jfranty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jfranty/subscriptions", "organizations_url": "https://api.github.com/users/jfranty/orgs", "repos_url": "https://api.github.com/users/jfranty/repos", "events_url": "https://api.github.com/users/jfranty/events{/privacy}", "received_events_url": "https://api.github.com/users/jfranty/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-04-15T18:28:47Z", "updated_at": "2017-05-02T23:40:16Z", "closed_at": "2017-05-02T23:40:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've been playing around the lalrpop crate, https://github.com/nikomatsakis/lalrpop, for a little bit, and started hitting a stack overflow with rustc. I unfortunately don't have a good isolated test case that I can share.\n\n`cargo run` fails with the following:\n\n```\nthread 'rustc' has overflowed its stack\nfatal runtime error: stack overflow\n```\n\nHere are the top and bottom of the stack:\n\n```\n(lldb) bt\n* thread #2: tid = 0x0001, 0x00000001120e7a50 libstd-4fda350b.dylib`sys::stack_overflow::imp::signal_handler::h47cf6ab11e6e9fd45sy + 896, stop reason = signal SIGSTOP\n  * frame #0: 0x00000001120e7a50 libstd-4fda350b.dylib`sys::stack_overflow::imp::signal_handler::h47cf6ab11e6e9fd45sy + 896\n    frame #1: 0x00007fff883f25aa libsystem_platform.dylib`_sigtramp + 26\n    frame #2: 0x000000010ed734c2 librustc-4fda350b.dylib`middle::const_eval::eval_const_expr_partial::h709350e1c8fb9c4c0nm + 210\n    frame #3: 0x000000010edaf329 librustc-4fda350b.dylib`middle::const_eval::compare_lit_exprs::h31d8a0a0e82994f6oun + 73\n    frame #4: 0x000000010e90a4f9 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 7753\n    frame #5: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #6: 0x000000010e90d0e2 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 18994\n    frame #7: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #8: 0x000000010e909cd4 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 5668\n    frame #9: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #10: 0x000000010e90d0e2 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 18994\n    frame #11: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #12: 0x000000010e909cd4 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 5668\n    frame #13: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #14: 0x000000010e90ce41 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch_continue::h4d6caf7565396624C4M + 18321\n    frame #15: 0x000000010e907a58 librustc_trans-4fda350b.dylib`trans::_match::compile_submatch::hceb2a6dee08762ef2YM + 2952\n    frame #16: 0x000000010e90f381 librustc_trans-4fda350b.dylib`trans::_match::trans_match_inner::h24a90c2c25ff28a19yN + 3441\n    frame #17: 0x000000010e8d03bf librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6975\n    frame #18: 0x000000010e839203 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2291\n    frame #19: 0x000000010e8aae26 librustc_trans-4fda350b.dylib`trans::controlflow::trans_stmt_semi::h63e0f5036212e5988qy + 310\n    frame #20: 0x000000010e83522a librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 746\n    frame #21: 0x000000010e833bc5 librustc_trans-4fda350b.dylib`trans::base::trans_closure::hba0c0872f549ec52KOj + 15973\n    frame #22: 0x000000010e835f3e librustc_trans-4fda350b.dylib`trans::base::trans_fn::hed9c6073728147b7TZj + 830\n    frame #23: 0x000000010e87ab8b librustc_trans-4fda350b.dylib`trans::monomorphize::monomorphic_fn::h27ed80a1b70d9044zkR + 4587\n    frame #24: 0x000000010e869cd7 librustc_trans-4fda350b.dylib`trans::callee::trans_fn_ref_with_substs::h25b15813138f6079wlq + 1047\n    frame #25: 0x000000010e868fd0 librustc_trans-4fda350b.dylib`trans::callee::trans_fn_ref::h61a9be90468d0e98Kaq + 208\n    frame #26: 0x000000010e868263 librustc_trans-4fda350b.dylib`trans::callee::trans::hf6c91bf3e7289b6beZp + 1251\n    frame #27: 0x000000010e87b8d1 librustc_trans-4fda350b.dylib`trans::callee::trans_call_inner::h311463431459118637 + 97\n    frame #28: 0x000000010e8d05ee librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 7534\n    frame #29: 0x000000010e8ce132 librustc_trans-4fda350b.dylib`trans::expr::trans_unadjusted::h8fd3d7e4f4126c4eOoE + 1138\n    frame #30: 0x000000010e7fa323 librustc_trans-4fda350b.dylib`trans::expr::trans::h81da75dd37f8697crVD + 2403\n    frame #31: 0x000000010e8aae94 librustc_trans-4fda350b.dylib`trans::expr::trans_to_lvalue::heaf97c64b576393cXnE + 52\n    frame #32: 0x000000010e90e6a2 librustc_trans-4fda350b.dylib`trans::_match::trans_match_inner::h24a90c2c25ff28a19yN + 146\n    frame #33: 0x000000010e8d03bf librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6975\n    frame #34: 0x000000010e8ce132 librustc_trans-4fda350b.dylib`trans::expr::trans_unadjusted::h8fd3d7e4f4126c4eOoE + 1138\n    frame #35: 0x000000010e7fa323 librustc_trans-4fda350b.dylib`trans::expr::trans::h81da75dd37f8697crVD + 2403\n    frame #36: 0x000000010e8d2cbc librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_stmt_unadjusted::h60c5bb3edc05b414QNE + 1308\n    frame #37: 0x000000010e8391d3 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2243\n    frame #38: 0x000000010e8aae26 librustc_trans-4fda350b.dylib`trans::controlflow::trans_stmt_semi::h63e0f5036212e5988qy + 310\n    frame #39: 0x000000010e83522a librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 746\n    frame #40: 0x000000010e8d02ea librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6762\n    frame #41: 0x000000010e839203 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2291\n    frame #42: 0x000000010e90f454 librustc_trans-4fda350b.dylib`trans::_match::trans_match_inner::h24a90c2c25ff28a19yN + 3652\n    frame #43: 0x000000010e8d03bf librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6975\n    frame #44: 0x000000010e839203 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2291\n    frame #45: 0x000000010e83554f librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 1551\n    frame #46: 0x000000010e8d340a librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_stmt_unadjusted::h60c5bb3edc05b414QNE + 3178\n    frame #47: 0x000000010e8391d3 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2243\n    frame #48: 0x000000010e8aae26 librustc_trans-4fda350b.dylib`trans::controlflow::trans_stmt_semi::h63e0f5036212e5988qy + 310\n    frame #49: 0x000000010e83522a librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 746\n    frame #50: 0x000000010e833bc5 librustc_trans-4fda350b.dylib`trans::base::trans_closure::hba0c0872f549ec52KOj + 15973\n```\n\n```\nframe #4385: 0x000000010e8aae26 librustc_trans-4fda350b.dylib`trans::controlflow::trans_stmt_semi::h63e0f5036212e5988qy + 310\n    frame #4386: 0x000000010e83522a librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 746\n    frame #4387: 0x000000010e833bc5 librustc_trans-4fda350b.dylib`trans::base::trans_closure::hba0c0872f549ec52KOj + 15973\n    frame #4388: 0x000000010e835f3e librustc_trans-4fda350b.dylib`trans::base::trans_fn::hed9c6073728147b7TZj + 830\n    frame #4389: 0x000000010e87ab8b librustc_trans-4fda350b.dylib`trans::monomorphize::monomorphic_fn::h27ed80a1b70d9044zkR + 4587\n    frame #4390: 0x000000010e869cd7 librustc_trans-4fda350b.dylib`trans::callee::trans_fn_ref_with_substs::h25b15813138f6079wlq + 1047\n    frame #4391: 0x000000010e868fd0 librustc_trans-4fda350b.dylib`trans::callee::trans_fn_ref::h61a9be90468d0e98Kaq + 208\n    frame #4392: 0x000000010e868263 librustc_trans-4fda350b.dylib`trans::callee::trans::hf6c91bf3e7289b6beZp + 1251\n    frame #4393: 0x000000010e87b8d1 librustc_trans-4fda350b.dylib`trans::callee::trans_call_inner::h311463431459118637 + 97\n    frame #4394: 0x000000010e8d05ee librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 7534\n    frame #4395: 0x000000010e8ce132 librustc_trans-4fda350b.dylib`trans::expr::trans_unadjusted::h8fd3d7e4f4126c4eOoE + 1138\n    frame #4396: 0x000000010e7fa323 librustc_trans-4fda350b.dylib`trans::expr::trans::h81da75dd37f8697crVD + 2403\n    frame #4397: 0x000000010e8aae94 librustc_trans-4fda350b.dylib`trans::expr::trans_to_lvalue::heaf97c64b576393cXnE + 52\n    frame #4398: 0x000000010e90e6a2 librustc_trans-4fda350b.dylib`trans::_match::trans_match_inner::h24a90c2c25ff28a19yN + 146\n    frame #4399: 0x000000010e8d03bf librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6975\n    frame #4400: 0x000000010e8ce132 librustc_trans-4fda350b.dylib`trans::expr::trans_unadjusted::h8fd3d7e4f4126c4eOoE + 1138\n    frame #4401: 0x000000010e7fa323 librustc_trans-4fda350b.dylib`trans::expr::trans::h81da75dd37f8697crVD + 2403\n    frame #4402: 0x000000010e8aae94 librustc_trans-4fda350b.dylib`trans::expr::trans_to_lvalue::heaf97c64b576393cXnE + 52\n    frame #4403: 0x000000010e90e6a2 librustc_trans-4fda350b.dylib`trans::_match::trans_match_inner::h24a90c2c25ff28a19yN + 146\n    frame #4404: 0x000000010e8d03bf librustc_trans-4fda350b.dylib`trans::expr::trans_rvalue_dps_unadjusted::h2d372f8621d2fbb1yVE + 6975\n    frame #4405: 0x000000010e839203 librustc_trans-4fda350b.dylib`trans::expr::trans_into::h7652c0f3c8b5cd0cZND + 2291\n    frame #4406: 0x000000010e83554f librustc_trans-4fda350b.dylib`trans::controlflow::trans_block::hde5006322ab6cf144ry + 1551\n    frame #4407: 0x000000010e833bc5 librustc_trans-4fda350b.dylib`trans::base::trans_closure::hba0c0872f549ec52KOj + 15973\n    frame #4408: 0x000000010e835f3e librustc_trans-4fda350b.dylib`trans::base::trans_fn::hed9c6073728147b7TZj + 830\n    frame #4409: 0x000000010e83aa81 librustc_trans-4fda350b.dylib`trans::base::trans_item::h6acb22e4cadb1a91Xnk + 2385\n    frame #4410: 0x000000010e858ae7 librustc_trans-4fda350b.dylib`trans::base::TransItemsWithinModVisitor$LT$$u27$a$C$$u20$$u27$tcx$GT$.Visitor$LT$$u27$v$GT$::visit_item::h17401197a5140e35bol + 167\n    frame #4411: 0x000000010e856977 librustc_trans-4fda350b.dylib`intravisit::walk_item::h14166753778712320355 + 615\n    frame #4412: 0x000000010e84665f librustc_trans-4fda350b.dylib`trans::base::trans_crate::he0efa1d5417c3e0bB7k + 6207\n    frame #4413: 0x000000010deab2b3 librustc_driver-4fda350b.dylib`driver::phase_4_translate_to_llvm::h6b8ee7bea6f9aad8O1a + 2435\n    frame #4414: 0x000000010dea9ba9 librustc_driver-4fda350b.dylib`driver::compile_input::_$u7b$$u7b$closure$u7d$$u7d$::closure.29264 + 1097\n    frame #4415: 0x000000010dea6574 librustc_driver-4fda350b.dylib`driver::phase_3_run_analysis_passes::_$u7b$$u7b$closure$u7d$$u7d$::closure.28279 + 18340\n    frame #4416: 0x000000010dea042a librustc_driver-4fda350b.dylib`middle::ty::context::ctxt$LT$$u27$tcx$GT$::create_and_enter::h13294442458140553536 + 8282\n    frame #4417: 0x000000010de9cea3 librustc_driver-4fda350b.dylib`driver::phase_3_run_analysis_passes::h5242075341164975033 + 11891\n    frame #4418: 0x000000010de70c4e librustc_driver-4fda350b.dylib`driver::compile_input::h8dcd247802517a6fHca + 7886\n    frame #4419: 0x000000010de60309 librustc_driver-4fda350b.dylib`run_compiler::hb0408bcf47642fe6mPc + 3785\n    frame #4420: 0x000000010de5d966 librustc_driver-4fda350b.dylib`sys_common::unwind::try::try_fn::h17587884860915543117 + 470\n    frame #4421: 0x00000001120ddb3c libstd-4fda350b.dylib`__rust_try + 12\n    frame #4422: 0x00000001120d5d64 libstd-4fda350b.dylib`sys_common::unwind::inner_try::ha8c5d452cd60c627NVt + 116\n    frame #4423: 0x000000010de5e21a librustc_driver-4fda350b.dylib`boxed::F.FnBox$LT$A$GT$::call_box::h11079460496650762403 + 394\n    frame #4424: 0x00000001120e7acd libstd-4fda350b.dylib`sys::thread::Thread::new::thread_start::h1c23c8220fd8bb7dPFy + 61\n    frame #4425: 0x00007fff840b2899 libsystem_pthread.dylib`_pthread_body + 138\n    frame #4426: 0x00007fff840b272a libsystem_pthread.dylib`_pthread_start + 137\n```\n\nI've hit this with both rust 1.7 and 1.8, and on both my Mac 10.9.5 laptop and on Travis-CI running an Ubuntu image. I've also hit this with both lalrpop 0.10 and 0.11. The above stack trace is with\n\n```\n$ rustc --version --verbose\nrustc 1.8.0 (db2939409 2016-04-11)\nbinary: rustc\ncommit-hash: db2939409db26ab4904372c82492cd3488e4c44e\ncommit-date: 2016-04-11\nhost: x86_64-apple-darwin\nrelease: 1.8.0\n```\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/33001/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/33001/timeline", "performed_via_github_app": null, "state_reason": "completed"}