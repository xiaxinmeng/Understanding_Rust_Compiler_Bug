{"url": "https://api.github.com/repos/rust-lang/rust/issues/57837", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57837/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57837/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57837/events", "html_url": "https://github.com/rust-lang/rust/issues/57837", "id": 401816204, "node_id": "MDU6SXNzdWU0MDE4MTYyMDQ=", "number": 57837, "title": "RUSTFLAGS Linker Flags Order", "user": {"login": "LukeMauldin", "id": 1440808, "node_id": "MDQ6VXNlcjE0NDA4MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1440808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukeMauldin", "html_url": "https://github.com/LukeMauldin", "followers_url": "https://api.github.com/users/LukeMauldin/followers", "following_url": "https://api.github.com/users/LukeMauldin/following{/other_user}", "gists_url": "https://api.github.com/users/LukeMauldin/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukeMauldin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukeMauldin/subscriptions", "organizations_url": "https://api.github.com/users/LukeMauldin/orgs", "repos_url": "https://api.github.com/users/LukeMauldin/repos", "events_url": "https://api.github.com/users/LukeMauldin/events{/privacy}", "received_events_url": "https://api.github.com/users/LukeMauldin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-01-22T15:24:08Z", "updated_at": "2022-02-11T12:32:21Z", "closed_at": "2022-02-11T12:32:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "Linker flags specified by `RUSTFLAGS` are added to end of the command.  Need a way to add at beginning.\r\n\r\nI have a simple rust program that compiles against multiple vendor provided shared libraries.  I need to link against the shared libraries with the `--no-as-needed` flag because the dependencies of the shared libaries are not setup correctly.  I do not have the source code to the libraries and I cannot recompile them.\r\n\r\nThis is an example of linking a simple C++ program against the libraries.  Notice the `--no-as-needed` flag is at the start of the command.\r\n```\r\n/usr/bin/gcc -m64 -L/apps/tc9/lib -L/apps/tc9/lib/oracle -L/usr/lib -L/usr/lib64 -L/usr/lib /apps/tc9/lib/itk_main.o main.o -Wl,--no-as-needed -L/apps/tc9/lib -luser_exits -lgdis -leintstub -lnxmgr_im -linternal_exits -lae -laie -lappr -larchive -lvis -lvm -lbackup -lbmf -lbob -lbom -lcae -lcfm -lconfig -lcxpom -ldmi -lmgc -lecm -leint -lepm -lfclasses -lform -lgrm -ltcinit -ltc -lsml -ltccore -ltctrushape -lqsearch -litk -lbase_utils -lics -llov -lme -lmld -lobjio -love -lproperty -lps -lpublication -lpie -lai -lqry -lres -lreq -ladsfoundation -ltcsoacorestrong -lsa -lschmgt -lschmgt_bridge -lss -lvispublish -lsub_mgr -lclientcache -ltextsrv -lrdv -lTcCrypto -ltcsso -lcollabctx -lmechatronics -ldocmgtapp -lcontmgmt -lserver_exits -linternal_server_exits -ltcgsoap -laiwebservice -ltcxsd -lconfigurator -ltcsoacommon -ltcsoaclient -ltcgateway -ltcsoaserver -ltcserverutil -lvalidation -lcp -ltcmultisitetypes -ltcmultisitestrong -ltcsoaworkflow -ltcsoaworkflowtypes -ltcsoaworkflownative -ltc_utils -ltccoreext -lrbf -lce -lclips -lclipsutil -lgms -ltie -lbriefcase -lvisualization -lnxclone -lvendormanagementdispatch -lccdm -lproductvariant -lfunctionality -licsie -lcondvalidation -lsmartuibldr -lfnd0soadiagramming -lfnd0soadiagrammingtypes -ltcsoacoretypes -ltcsoacore -ltcsoaprojectmanagement -ltcsoaprojectmanagementtypes -ltcsoaprojectmanagementnative -lbmidebase -lpdi_corba_server -lict -lcba -lsharedcache -lsharedcachetypes -lbooleanmath -lcbaext -lcfilter -lfnd0booleansolve -ldispatcher -lmeta -lmetaframework -lsecore -lfoundationdispatch -lcmdispatch -lcm -lFnd0nweditor -lusagewc -lusage -lconstants -lmfg -lmfgbvr -lssrsccuaclient -lscmccdispatch -lextensionframework -ldocmgt -lissuemgmt -lfunctionality -lcondvalidation -lFnd0profiler -lFnd0formulamgmt -larm -lpom -lsyss -lugmath -lplmxmlSDK -lplmxmlExtensions -lplmContainerSDK -licui18n341 -lxerces270 -lxalan110 -lc -lm -ldl -lnsl -lelf -lresolv -lclntsh -ldb2 -lstdc++ -Wl,--unresolved-symbols=ignore-in-shared-libs -o main_ubuntu\r\n```\r\n\r\nI have set the `RUSTFLAGS` variable via ./.cargo/config:\r\n```\r\n[build]\r\nrustflags = [\r\n\"-C\", \"link-arg=-Wl,--unresolved-symbols=ignore-all\",\r\n\"-C\", \"link-arg=-Wl,--no-as-needed\"\r\n]\r\n```\r\nI then ran `cargo build  -Z print-link-args` and below is the command that rust is using to link the program.  Notice the `--no-as-needed` is added at the end which the linker ignores.\r\n```\r\n\"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.10imwdy594ztd6bq.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.16d1j1qvoz2m2jvs.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.1fyaisel7xwy8gol.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.1m1fmcgm6riw3k8x.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.1ofvdi3023mvvvco.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.1sxelb0w7h73vp0e.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.26gzaqs5j4288ipr.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.2b1t8ich07w2gvrl.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.2roea1mze8w2afh0.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.3j13xg5n5tgud8iy.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.3sx17r8001u8o3w5.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4113mge63r7rocsc.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.419w4t766q8u6dci.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.45cnk29n205b6w8p.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.49ob1frj11j54voq.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4lo6dh84os25q8en.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4td2c64b2g0tc0pa.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4ulw9y80xwlyly7h.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4zvsimlxb9npcpqm.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.9ud5haptujyqskc.rcgu.o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.agcn0tji9vk7e22.rcgu.o\" \"-o\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps/tclogin-1d2993c5e8dcf6e2.4kzuzfmqupnpce59.rcgu.o\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-nodefaultlibs\" \"-L\" \"/home/mauldinl@gvl.is.l-3com.com/code/rust/tclogin/target/debug/deps\" \"-L\" \"/apps/tc9/lib\" \"-L\" \"/apps/tc9/lib/oracle\" \"-L\" \"/usr/lib/x86_64-linux-gnu\" \"-L\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-lgdis\" \"-leintstub\" \"-lnxmgr_im\" \"-linternal_exits\" \"-lae\" \"-laie\" \"-lappr\" \"-larchive\" \"-lvis\" \"-lvm\" \"-lbackup\" \"-lbmf\" \"-lbob\" \"-lbom\" \"-lcae\" \"-lcfm\" \"-lconfig\" \"-lcxpom\" \"-ldmi\" \"-lmgc\" \"-lecm\" \"-leint\" \"-lepm\" \"-lfclasses\" \"-lform\" \"-lgrm\" \"-ltcinit\" \"-ltc\" \"-lsml\" \"-ltccore\" \"-ltctrushape\" \"-lqsearch\" \"-litk\" \"-lbase_utils\" \"-lics\" \"-llov\" \"-lme\" \"-lmld\" \"-lobjio\" \"-love\" \"-lproperty\" \"-lps\" \"-lpublication\" \"-lpie\" \"-lai\" \"-lqry\" \"-lres\" \"-lreq\" \"-ladsfoundation\" \"-ltcsoacorestrong\" \"-lsa\" \"-lschmgt\" \"-lschmgt_bridge\" \"-lss\" \"-lvispublish\" \"-lsub_mgr\" \"-lclientcache\" \"-ltextsrv\" \"-lrdv\" \"-lTcCrypto\" \"-ltcsso\" \"-lcollabctx\" \"-lmechatronics\" \"-ldocmgtapp\" \"-lcontmgmt\" \"-lserver_exits\" \"-linternal_server_exits\" \"-ltcgsoap\" \"-laiwebservice\" \"-ltcxsd\" \"-lconfigurator\" \"-ltcsoacommon\" \"-ltcsoaclient\" \"-ltcgateway\" \"-ltcsoaserver\" \"-ltcserverutil\" \"-lvalidation\" \"-lcp\" \"-ltcmultisitetypes\" \"-ltcmultisitestrong\" \"-ltcsoaworkflow\" \"-ltcsoaworkflowtypes\" \"-ltcsoaworkflownative\" \"-ltc_utils\" \"-ltccoreext\" \"-lrbf\" \"-lce\" \"-lclips\" \"-lclipsutil\" \"-lgms\" \"-ltie\" \"-lbriefcase\" \"-lvisualization\" \"-lnxclone\" \"-lvendormanagementdispatch\" \"-lccdm\" \"-lproductvariant\" \"-lfunctionality\" \"-licsie\" \"-lcondvalidation\" \"-lsmartuibldr\" \"-lfnd0soadiagramming\" \"-lfnd0soadiagrammingtypes\" \"-ltcsoacoretypes\" \"-ltcsoacore\" \"-ltcsoaprojectmanagement\" \"-ltcsoaprojectmanagementtypes\" \"-ltcsoaprojectmanagementnative\" \"-lbmidebase\" \"-lpdi_corba_server\" \"-lict\" \"-lcba\" \"-lsharedcache\" \"-lsharedcachetypes\" \"-lbooleanmath\" \"-lcbaext\" \"-lcfilter\" \"-lfnd0booleansolve\" \"-ldispatcher\" \"-lmeta\" \"-lmetaframework\" \"-lsecore\" \"-lfoundationdispatch\" \"-lcmdispatch\" \"-lcm\" \"-lFnd0nweditor\" \"-lusagewc\" \"-lusage\" \"-lconstants\" \"-lmfg\" \"-lmfgbvr\" \"-lssrsccuaclient\" \"-lscmccdispatch\" \"-lextensionframework\" \"-ldocmgt\" \"-lissuemgmt\" \"-lFnd0profiler\" \"-lFnd0formulamgmt\" \"-lpom\" \"-lsyss\" \"-lugmath\" \"-lplmxmlSDK\" \"-lplmxmlExtensions\" \"-lplmContainerSDK\" \"-licui18n341\" \"-lxerces270\" \"-lxalan110\" \"-lc\" \"-lm\" \"-ldl\" \"-lnsl\" \"-lelf\" \"-lresolv\" \"-lclntsh\" \"-ldb2\" \"-licuuc341\" \"-licudata341\" \"-lTcCryptoUtil\" \"-lpoco\" \"-lTAO\" \"-lACE\" \"-lFnd0propertyrenderer\" \"-lnnz10\" \"-ltccurl\" \"-lTcMemBinding64\" \"-lTcMemCppBinding64\" \"-lstdc++\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-de5969744423fb69.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-349473e71495321d.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libbacktrace_sys-586a1c8092fef75c.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-132eea50c4719d58.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-ceaa2d4e2e4490ea.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-b0584d127f427a22.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-8570ae25713836c4.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-4ea1c8a0d2fa277d.rlib\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-c04ea2c3b5f80e64.rlib\" \"-Wl,--end-group\" \"/home/mauldinl@gvl.is.l-3com.com/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-a3371a772297084a.rlib\" \"-Wl,-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\" \"-Wl,--unresolved-symbols=ignore-all\" \"-Wl,--no-as-needed\"\r\n```\r\n\r\nI need a way to either specify that the RUSTFLAGS should come at the beginning of the command OR a way to explictly inform rust to link to `--no-as-needed`\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\nrustc 1.33.0-nightly (e2f221c75 2019-01-15)\r\nbinary: rustc\r\ncommit-hash: e2f221c75932de7a29845c8d6f1f73536ad00c41\r\ncommit-date: 2019-01-15\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.33.0-nightly\r\nLLVM version: 8.0\r\n\r\nOS: Ubuntu 18.04", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57837/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57837/timeline", "performed_via_github_app": null, "state_reason": "completed"}