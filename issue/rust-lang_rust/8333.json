{"url": "https://api.github.com/repos/rust-lang/rust/issues/8333", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/8333/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/8333/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/8333/events", "html_url": "https://github.com/rust-lang/rust/issues/8333", "id": 17687276, "node_id": "MDU6SXNzdWUxNzY4NzI3Ng==", "number": 8333, "title": "Numeric operators dont inline well on generic code.", "user": {"login": "sebcrozet", "id": 1734958, "node_id": "MDQ6VXNlcjE3MzQ5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1734958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebcrozet", "html_url": "https://github.com/sebcrozet", "followers_url": "https://api.github.com/users/sebcrozet/followers", "following_url": "https://api.github.com/users/sebcrozet/following{/other_user}", "gists_url": "https://api.github.com/users/sebcrozet/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebcrozet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebcrozet/subscriptions", "organizations_url": "https://api.github.com/users/sebcrozet/orgs", "repos_url": "https://api.github.com/users/sebcrozet/repos", "events_url": "https://api.github.com/users/sebcrozet/events{/privacy}", "received_events_url": "https://api.github.com/users/sebcrozet/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-08-06T12:30:40Z", "updated_at": "2013-12-18T23:45:13Z", "closed_at": "2013-12-18T23:45:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Those two functions should generate the same asm code:\n\n``` rust\n#[inline(never)]\nfn doit_not_generic(a: f64) -> f64 {\n    let mut a = a;\n    do 1000000000.times {\n        a = a * a;\n    }\n\n    a\n}\n\n#[inline(never)]\nfn doit<N: Mul<N, N>>(a: N) -> N {\n    let mut a = a;\n    do 1000000000.times {\n        a = a * a;\n    }\n\n    a\n}\n```\n\nBut they dont (at least, when called with f64).\nAsm code for `doit` (there is an explicit call to the multiplication function):\n\n``` asm\n0000000000400b50 <_ZN9doit_338817_2e876a1e2fea8cf17_0$x2e0E>:\n  400b50:   64 48 3b 24 25 70 00    cmp    %fs:0x70,%rsp\n  400b57:   00 00\n  400b59:   77 1a                   ja     400b75 <_ZN9doit_338817_2e876a1e2fea8cf17_0$x2e0E+0x25>\n  400b5b:   49 ba 28 00 00 00 00    movabs $0x28,%r10\n  400b62:   00 00 00\n  400b65:   49 bb 00 00 00 00 00    movabs $0x0,%r11\n  400b6c:   00 00 00\n  400b6f:   e8 4c 00 00 00          callq  400bc0 <__morestack>\n  400b74:   c3                      retq\n  400b75:   55                      push   %rbp\n  400b76:   48 89 e5                mov    %rsp,%rbp\n  400b79:   41 56                   push   %r14\n  400b7b:   53                      push   %rbx\n  400b7c:   48 83 ec 10             sub    $0x10,%rsp\n  400b80:   48 b8 00 00 00 00 00    movabs $0x3ff0000000000000,%rax\n  400b87:   00 f0 3f\n  400b8a:   48 89 45 e8             mov    %rax,-0x18(%rbp)\n  400b8e:   48 c7 c3 00 36 65 c4    mov    $0xffffffffc4653600,%rbx\n  400b95:   4c 8d 75 e8             lea    -0x18(%rbp),%r14\n  400b99:   90                      nop\n  400b9a:   90                      nop\n  400b9b:   90                      nop\n  400b9c:   90                      nop\n  400b9d:   90                      nop\n  400b9e:   90                      nop\n  400b9f:   90                      nop\n  400ba0:   4c 89 f7                mov    %r14,%rdi\n  400ba3:   4c 89 f6                mov    %r14,%rsi\n  400ba6:   e8 35 fd ff ff          callq  4008e0 <_ZN3f6414__extensions__10meth_147683mul17_ce584f3346886dfe14_0$x2e8$x2dpreE@plt>\n  400bab:   f2 0f 11 45 e8          movsd  %xmm0,-0x18(%rbp)\n  400bb0:   48 ff c3                inc    %rbx\n  400bb3:   75 eb                   jne    400ba0 <_ZN9doit_338817_2e876a1e2fea8cf17_0$x2e0E+0x50>\n  400bb5:   48 83 c4 10             add    $0x10,%rsp\n  400bb9:   5b                      pop    %rbx\n  400bba:   41 5e                   pop    %r14\n  400bbc:   5d                      pop    %rbp\n  400bbd:   c3                      retq\n  400bbe:   66 90                   xchg   %ax,%ax\n```\n\nAsm code for `doit_not_generic` (uses the machine instruction):\n\n``` asm\n0000000000400a40 <_ZN16doit_not_generic17_2e876a1e2fea8cf17_0$x2e0E>:\n  400a40:   64 48 3b 24 25 70 00    cmp    %fs:0x70,%rsp\n  400a47:   00 00\n  400a49:   77 1a                   ja     400a65 <_ZN16doit_not_generic17_2e876a1e2fea8cf17_0$x2e0E+0x25>\n  400a4b:   49 ba 08 00 00 00 00    movabs $0x8,%r10\n  400a52:   00 00 00\n  400a55:   49 bb 00 00 00 00 00    movabs $0x0,%r11\n  400a5c:   00 00 00\n  400a5f:   e8 5c 01 00 00          callq  400bc0 <__morestack>\n  400a64:   c3                      retq\n  400a65:   55                      push   %rbp\n  400a66:   48 89 e5                mov    %rsp,%rbp\n  400a69:   48 c7 c0 00 36 65 c4    mov    $0xffffffffc4653600,%rax\n  400a70:   f2 0f 59 c0             mulsd  %xmm0,%xmm0\n  400a74:   48 ff c0                inc    %rax\n  400a77:   75 f7                   jne    400a70 <_ZN16doit_not_generic17_2e876a1e2fea8cf17_0$x2e0E+0x30>\n  400a79:   5d                      pop    %rbp\n  400a7a:   c3                      retq\n  400a7b:   90                      nop\n  400a7c:   90                      nop\n  400a7d:   90                      nop\n  400a7e:   90                      nop\n  400a7f:   90                      nop\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/8333/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/8333/timeline", "performed_via_github_app": null, "state_reason": "completed"}