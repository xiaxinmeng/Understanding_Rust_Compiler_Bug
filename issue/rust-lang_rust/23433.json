{"url": "https://api.github.com/repos/rust-lang/rust/issues/23433", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23433/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23433/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23433/events", "html_url": "https://github.com/rust-lang/rust/issues/23433", "id": 62288229, "node_id": "MDU6SXNzdWU2MjI4ODIyOQ==", "number": 23433, "title": "LLVM Assertion on Pattern Match + Unique", "user": {"login": "jamwt", "id": 61509, "node_id": "MDQ6VXNlcjYxNTA5", "avatar_url": "https://avatars.githubusercontent.com/u/61509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamwt", "html_url": "https://github.com/jamwt", "followers_url": "https://api.github.com/users/jamwt/followers", "following_url": "https://api.github.com/users/jamwt/following{/other_user}", "gists_url": "https://api.github.com/users/jamwt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamwt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamwt/subscriptions", "organizations_url": "https://api.github.com/users/jamwt/orgs", "repos_url": "https://api.github.com/users/jamwt/repos", "events_url": "https://api.github.com/users/jamwt/events{/privacy}", "received_events_url": "https://api.github.com/users/jamwt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-03-17T05:08:02Z", "updated_at": "2015-04-26T15:04:38Z", "closed_at": "2015-04-26T15:04:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Given the following code:\n\n```\n#![feature(unique)]\n#![allow(unused_variables)]\n\nuse std::ptr::Unique;\n\nfn main() {\n    let mut a = [0u8; 5];\n    let b: Option<Unique<[u8]>> = unsafe { Some(Unique::new(&mut a)) };\n    match b {\n        Some(ref inner) => println!(\"it's a some\"),\n        None => println!(\"it's a none\"),\n    }\n}\n```\n\nRustc bails out on an LLVM assertion:\n\n```\nrustc: /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/include/llvm/IR/Instructions.h:1001: void llvm::ICmpInst::AssertOK(): Assertion `(getOperand(0)->getType()->isIntOrIntVectorTy() || getOperand(0)->getType()->isPtrOrPtrVectorTy()) && \"Invalid operand types for ICmp instruction\"' failed.\n```\n\nHere's the stack:\n\n```\n#0  0x00007ffff6fda0d5 in raise () from /lib/x86_64-linux-gnu/libc.so.6\n#1  0x00007ffff6fdd83b in abort () from /lib/x86_64-linux-gnu/libc.so.6\n#2  0x00007ffff6fd2d9e in ?? () from /lib/x86_64-linux-gnu/libc.so.6\n#3  0x00007ffff6fd2e42 in __assert_fail () from /lib/x86_64-linux-gnu/libc.so.6\n#4  0x00007ffff207021f in llvm::ICmpInst::AssertOK() () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#5  0x00007ffff20702cb in llvm::IRBuilder<true, llvm::ConstantFolder, llvm::IRBuilderDefaultInserter<true> >::CreateICmp(llvm::CmpInst::Predicate, llvm::Value*, llvm::Value*, llvm::Twine const&) [clone .part.491] () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#6  0x00007ffff3108e8f in LLVMBuildICmp () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#7  0x00007ffff6b42900 in trans::build::ICmp::h70eb28ee2d0546d5aMp () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#8  0x00007ffff6b3eefe in trans::adt::trans_get_discr::h6649ce41ceb444a9zFH () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#9  0x00007ffff6c176b9 in trans::_match::compile_submatch_continue::h39a18e8f0a879054gdw () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#10 0x00007ffff6c135af in trans::_match::compile_submatch::h3accf2ac93c439ddJ7v () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#11 0x00007ffff6c1d120 in trans::_match::trans_match_inner::h727c41a4ddfa6f515Ew () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#12 0x00007ffff6b71b03 in trans::expr::trans_rvalue_dps_unadjusted::hae9fe8e72b025d32xzi () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#13 0x00007ffff6b22a51 in trans::expr::trans_into::h9bfce6438b73e9acSmh () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#14 0x00007ffff6b23b68 in trans::controlflow::trans_block::hcba31267fa6c4968t6d () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#15 0x00007ffff6b71b5f in trans::expr::trans_rvalue_dps_unadjusted::hae9fe8e72b025d32xzi () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#16 0x00007ffff6b22a51 in trans::expr::trans_into::h9bfce6438b73e9acSmh () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#17 0x00007ffff6c34be8 in trans::_match::mk_binding_alloca::h16265078090998076011 () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#18 0x00007ffff6b21fae in trans::base::init_local::h9921fd3a372311dbVys () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#19 0x00007ffff6b23843 in trans::controlflow::trans_block::hcba31267fa6c4968t6d () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#20 0x00007ffff6bfb462 in trans::base::trans_closure::h295e0a8c0302a522Rjt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#21 0x00007ffff6b0bf59 in trans::base::trans_fn::h475c276dfb9092deKut () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#22 0x00007ffff6b08527 in trans::base::trans_item::hc022dcad9f32230fCSt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#23 0x00007ffff6b08369 in trans::base::trans_item::hc022dcad9f32230fCSt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#24 0x00007ffff6c0458d in trans::base::trans_crate::ha116a53daafe15a4fPu () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#25 0x00007ffff7afd554 in driver::phase_4_translate_to_llvm::hb0c3ed9b413b640akOa () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#26 0x00007ffff7ad9144 in driver::compile_input::h56dbe0e66fe8a956Rba () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#27 0x00007ffff7b90a43 in run_compiler::hbbbe30f1ad654d0ex2b () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#28 0x00007ffff7b8e88d in thunk::F.Invoke$LT$A$C$$u20$R$GT$::invoke::h9510793753674638958 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#29 0x00007ffff7b8d911 in rt::unwind::try::try_fn::h15118916039308917284 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#30 0x00007ffff7560f59 in rust_try_inner () from /usr/local/lib/libstd-4e7c5e5c.so\n#31 0x00007ffff7560f46 in rust_try () from /usr/local/lib/libstd-4e7c5e5c.so\n#32 0x00007ffff7b8ddb7 in thunk::F.Invoke$LT$A$C$$u20$R$GT$::invoke::h8595907971712275588 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#33 0x00007ffff74de996 in sys::thread::thread_start::h9f0c06661d546448B1G () from /usr/local/lib/libstd-4e7c5e5c.so\n#34 0x00007ffff138ae9a in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\n#35 0x00007ffff70982ed in clone () from /lib/x86_64-linux-gnu/libc.so.6\n#36 0x0000000000000000 in ?? ()\n```\n\nAnd here's the vitals:\n\n```\n~$ rustc --version\nrustc 1.0.0-nightly (30e1f9a1c 2015-03-14) (built 2015-03-15)\n~$ uname -a\nLinux dbdev 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:39:31 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n```\n\nPlaypen link that also fails on 2015-03-16: http://is.gd/yYChkD\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23433/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23433/timeline", "performed_via_github_app": null, "state_reason": "completed"}