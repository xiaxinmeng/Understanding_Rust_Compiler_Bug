{"url": "https://api.github.com/repos/rust-lang/rust/issues/92910", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92910/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92910/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92910/events", "html_url": "https://github.com/rust-lang/rust/issues/92910", "id": 1104210657, "node_id": "I_kwDOAAsO6M5B0Orh", "number": 92910, "title": "rustdoc fails to build an intra doc link when linking through 3 crates without explicit use", "user": {"login": "mockersf", "id": 8672791, "node_id": "MDQ6VXNlcjg2NzI3OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/8672791?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mockersf", "html_url": "https://github.com/mockersf", "followers_url": "https://api.github.com/users/mockersf/followers", "following_url": "https://api.github.com/users/mockersf/following{/other_user}", "gists_url": "https://api.github.com/users/mockersf/gists{/gist_id}", "starred_url": "https://api.github.com/users/mockersf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mockersf/subscriptions", "organizations_url": "https://api.github.com/users/mockersf/orgs", "repos_url": "https://api.github.com/users/mockersf/repos", "events_url": "https://api.github.com/users/mockersf/events{/privacy}", "received_events_url": "https://api.github.com/users/mockersf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1118567289, "node_id": "MDU6TGFiZWwxMTE4NTY3Mjg5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-intra-doc-links", "name": "A-intra-doc-links", "color": "f7e101", "default": false, "description": "Area: Intra-doc links, the ability to link to items in docs by name"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-01-14T23:31:30Z", "updated_at": "2022-01-16T17:33:16Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "With three crates:\r\n* Crate C export a public struct\r\n* Crate B depends on crate C and export a public struct with doc linking to the crate C pub item\r\n* Crate A reexport everything from crate B\r\n\r\nWhen building doc for crate A, the intra doc link will not work without a warning.\r\n\r\nThis is what's happening in Bevy on [the doc for `DefaultPlugins`](https://docs.rs/bevy/latest/bevy/struct.DefaultPlugins.html) (https://github.com/bevyengine/bevy/issues/3654).\r\n\r\nI managed to write a UI test reproducing the issue: https://github.com/mockersf/rust/commit/1c4d4784fdfa320edf9c6328ca4734089f873c86\r\n\r\n<details><summary>Test failure message</summary>\r\n<p>\r\n\r\n```\r\n14: @has check failed\r\n\t`XPATH PATTERN` did not match\r\n\t// @has 'issue_zzzz/struct.Reexported.html' '//div[@class=\"docblock\"]/p/a[@href=\"../issue_zzzz_internal/struct.Internal.html\"]' 'issue_zzzz_internal::Internal'\r\n\r\nEncountered 1 errors\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<img width=\"1002\" alt=\"Screenshot 2022-01-15 at 00 00 31\" src=\"https://user-images.githubusercontent.com/8672791/149597541-52c4a82f-6903-4d8c-a7d3-808e82c743f0.png\">\r\nThe link is not replaced, even though rustdoc was able to correctly link the struct in the definition.\r\n\r\n<details><summary>If I uncomment the `extern crate` in the reexported crate (crate B from above), the link works</summary>\r\n<p>\r\n<img width=\"1002\" alt=\"Screenshot 2022-01-15 at 00 00 00\" src=\"https://user-images.githubusercontent.com/8672791/149597662-ab6e9c1a-4871-4db2-bb17-deabbe7e9282.png\">\r\n</p>\r\n</details>\r\n\r\nIdeally I would like the link to work. I'm guessing it's something about the external crate not being in context for link resolution when it's not explicitly used, but it seems it is later on as the link is correct for the struct definition. I tried to follow the code to where the context could be different between the two but didn't manage to find it.\r\n\r\nIf it's not possible, would it be OK to issue a warning?\r\n\r\n### Meta\r\n\r\nReproduced with rust 1.57, 1.58, nightly 1bd4fdc94 2022-01-12 and 256721ee519f6ff15dc5c1cfaf3ebf9af75efa4a\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92910/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92910/timeline", "performed_via_github_app": null, "state_reason": null}