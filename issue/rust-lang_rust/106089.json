{"url": "https://api.github.com/repos/rust-lang/rust/issues/106089", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/106089/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/106089/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/106089/events", "html_url": "https://github.com/rust-lang/rust/issues/106089", "id": 1509572358, "node_id": "I_kwDOAAsO6M5Z-j8G", "number": 106089, "title": "Error message implies I need a const impl, but there is no such thing", "user": {"login": "mcclure", "id": 277318, "node_id": "MDQ6VXNlcjI3NzMxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/277318?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcclure", "html_url": "https://github.com/mcclure", "followers_url": "https://api.github.com/users/mcclure/followers", "following_url": "https://api.github.com/users/mcclure/following{/other_user}", "gists_url": "https://api.github.com/users/mcclure/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcclure/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcclure/subscriptions", "organizations_url": "https://api.github.com/users/mcclure/orgs", "repos_url": "https://api.github.com/users/mcclure/repos", "events_url": "https://api.github.com/users/mcclure/events{/privacy}", "received_events_url": "https://api.github.com/users/mcclure/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-12-23T17:18:43Z", "updated_at": "2023-01-02T04:30:53Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I am using Rust 1.65.0. I run\r\n`cargo new impl_test && cd impl_test && cargo add glam && vi src/main.rs`\r\nand enter this code:\r\n\r\n```\r\nuse glam::IVec2;\r\n\r\nconst AXES: [IVec2; 4] = [ -IVec2::Y, IVec2::Y, -IVec2::X, IVec2::X ];\r\n\r\nfn main() {\r\n}\r\n```\r\nWhat I am trying to do is create an array containing the four cardinal directions\\*. Rust doesn't like it:\r\n```\r\nerror[E0015]: cannot call non-const operator in constants\r\n   --> src\\main.rs:3:28\r\n    |\r\n3   | const AXES: [IVec2; 4] = [ -IVec2::Y, IVec2::Y, -IVec2::X, IVec2::X ];\r\n    |                            ^^^^^^^^^\r\n    |\r\nnote: impl defined here, but it is not `const`\r\n   --> C:\\Users\\Andi\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\glam-0.22.0\\src\\i32\\ivec2.rs:628:1\r\n    |\r\n628 | impl Neg for IVec2 {\r\n    | ^^^^^^^^^^^^^^^^^^\r\n    = note: calls in constants are limited to constant functions, tuple structs and tuple variants\r\n```\r\nOh!, I think. The impl is not const! I will go file a issue on glam and ask them to make this impl const.\r\n\r\nBut then after a moment I think to check, and I realize [const impls are an experimental feature](https://github.com/rust-lang/rust/issues/67792). It is not stable and the RFC has not even been accepted yet. So that would have been a very unhelpful issue.\r\n\r\nThe error message seems to be a generic one (the method is not const) but **the wording implies that you can fix it by making the impl const**. In other words it implies the problem is with your impl, but actually the problem is impls are not adequate for what you want them to do. (And if this is something that works in nightly, someone might have the unpleasant experience of thinking the compiler told them to add a const to their impl, adding a const to their impl, and then getting a \"sorry, unstable\" error message).\r\n\r\n**\"Ideally the output should look like:\"**\r\n\r\nI would probably word it like\r\n```\r\nnote: impl defined here, but impl methods are not `const`\r\n```\r\nor to be even more explicit\r\n```\r\nnote: impl defined here, but impl methods can never be `const`\r\n```\r\n\r\nIf const impls work in nightly, a `hint: const impl is allowed in nightly [tracking issue link]` could be helpful to in addition to the wording change (or could be used in place of the above wording completely)\r\n\r\n\\* *What I should have done in this case is use IVec2::NEG_X and IVec2::NEG_Y. But that's not the point.*", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/106089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/106089/timeline", "performed_via_github_app": null, "state_reason": null}