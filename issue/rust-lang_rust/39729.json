{"url": "https://api.github.com/repos/rust-lang/rust/issues/39729", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39729/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39729/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39729/events", "html_url": "https://github.com/rust-lang/rust/issues/39729", "id": 206918653, "node_id": "MDU6SXNzdWUyMDY5MTg2NTM=", "number": 39729, "title": "rustbuild failures for solaris target", "user": {"login": "binarycrusader", "id": 541114, "node_id": "MDQ6VXNlcjU0MTExNA==", "avatar_url": "https://avatars.githubusercontent.com/u/541114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/binarycrusader", "html_url": "https://github.com/binarycrusader", "followers_url": "https://api.github.com/users/binarycrusader/followers", "following_url": "https://api.github.com/users/binarycrusader/following{/other_user}", "gists_url": "https://api.github.com/users/binarycrusader/gists{/gist_id}", "starred_url": "https://api.github.com/users/binarycrusader/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/binarycrusader/subscriptions", "organizations_url": "https://api.github.com/users/binarycrusader/orgs", "repos_url": "https://api.github.com/users/binarycrusader/repos", "events_url": "https://api.github.com/users/binarycrusader/events{/privacy}", "received_events_url": "https://api.github.com/users/binarycrusader/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-02-10T22:06:28Z", "updated_at": "2017-02-13T23:30:42Z", "closed_at": "2017-02-13T23:30:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I've been using the (now obsolete) Makefile-based builds successfully for some time now while trying to get rust running on Solaris x86_64 (and from there sparcv9).\r\n\r\nHowever, now that the rustbuild is the build system used for master, I've hit an unexpected regression:\r\n\r\n> \r\n>    Compiling error_index_generator v0.0.0 (file:///builds/srwalker/rsdev/rust.git/src/tools/error_index_generator)\r\n>      Running `/builds/srwalker/rsdev/rust.git/build/bootstrap/debug/rustc --crate-name error_index_generator src/tools/error_index_generator/main.rs --crate-type bin -C debug-assertions=off -C metada\r\n> ta=55b3c2ceee213ac4 -C extra-filename=-55b3c2ceee213ac4 --out-dir /builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/x86_64-sun-solaris/debug/deps --emit=dep-info,link --target x86\r\n> _64-sun-solaris -L dependency=/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/x86_64-sun-solaris/debug/deps -L dependency=/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solari\r\n> s/stage0-tools/debug/deps`\r\n> error: linking with `gcc` failed: exit code: 1\r\n>   |\r\n>   = note: \"gcc\" \"-m64\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stag\r\n> e0-tools/x86_64-sun-solaris/debug/deps/error_index_generator-55b3c2ceee213ac4.0.o\" \"-o\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/x86_64-sun-solaris/debug/deps/error_index_generator-55b3c2ceee213ac4\" \"-Wl,-z\" \"-Wl,ignore\" \"-nodefaultlibs\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/x86_64-sun-solaris/debug/deps\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/debug/deps\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-Wl,-Bstatic\" \"-Wl,-Bdynamic\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustdoc-dc29c94abd4dcd0b\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_driver-ad92d3e67e903774\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_typeck-35a3b54b6cdf97b8\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_save_analysis-cfdfe8acd6869272\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_privacy-024a67cf6bc3e709\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_plugin-8ac1ae7e5776eac0\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_metadata-ec7dd07248e52e75\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_passes-364f38216d6c9424\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_trans-cdd243fe1e68012f\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_platform_intrinsics-3f47cab9ef631fa8\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"flate-0fd3b1a0a223499d\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_incremental-0716a51558e38db4\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_borrowck-e00e0fa179bdb736\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_mir-e476d98505ff4a5a\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_lint-0ca5fe89f646b285\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_const_eval-1bae27148c7bc577\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"syntax_ext-0fe5527df8de6a12\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"proc_macro-2ff07fc394454e4c\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_resolve-14ff019444b0925d\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc-371900ccc5089862\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_const_math-5c402b785333d9c5\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_back-593a5bc33c0bbc74\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_llvm-3fc564fdb05f532d\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"graphviz-7372a6bd3115d725\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"fmt_macros-aa72d845f9be82d4\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"arena-c02259e246615414\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"syntax-dd0d5972ba1c7927\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_data_structures-08cfb1bce6556e99\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"rustc_errors-3d314e34a93ae9c9\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"syntax_pos-a88c23d3e25f8736\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"serialize-54827eda001a7e78\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"log-151dae97b40a2eed\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"test-21372d30bc4f4052\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"term-911c66b6f4f7c84b\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"getopts-a50dc22aef8e3c26\" \"-L\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib\" \"-l\" \"std-68576f367c0b7ff2\" \"/builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-sysroot/lib/rustlib/x86_64-sun-solaris/lib/libcompiler_builtins-7791545be2c71751.rlib\" \"-l\" \"rt\" \"-l\" \"dl\" \"-l\" \"m\" \"-l\" \"stdc++\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-Wl,-rpath,$ORIGIN/../lib\"\r\n>   = note: Undefined                     first referenced\r\n>            symbol                           in file\r\n>           _Unwind_Resume                      /builds/srwalker/rsdev/rust.git/build/x86_64-sun-solaris/stage0-tools/x86_64-sun-solaris/debug/deps/error_index_generator-55b3c2ceee213ac4.0.o  (symbol belongs to implicit dependency /usr/gcc/5/lib/gcc/x86_64-pc-solaris2.12/5.4.0/../../../amd64/libgcc_s.so.1)\r\n>           ld: fatal: symbol referencing errors\r\n>           collect2: error: ld returned 1 exit status\r\n>           \r\n> \r\n> error: aborting due to previous error\r\n\r\nInitially, I thought this would be simple enough to workaround by altering `librustc_back/target/solaris_base.rs`:\r\n\r\n```patch\r\ndiff --git a/src/librustc_back/target/solaris_base.rs b/src/librustc_back/target/solaris_base.rs\r\nindex 41323c9..cac0a02 100644\r\n--- a/src/librustc_back/target/solaris_base.rs\r\n+++ b/src/librustc_back/target/solaris_base.rs\r\n@@ -19,6 +19,9 @@ pub fn opts() -> TargetOptions {\r\n         target_family: Some(\"unix\".to_string()),\r\n         is_like_solaris: true,\r\n         exe_allocation_crate: super::maybe_jemalloc(),\r\n+        late_link_args: vec![\r\n+            \"-lgcc\".to_string(), // needed for _Unwind_Resume, etc.\r\n+        ],\r\n \r\n         .. Default::default()\r\n     }\r\n```\r\n\r\nHowever, after making that change and rebuilding, I still hit the issue.\r\n\r\nSo I have questions:\r\n1) where is the right place to ensure -lgcc is used for linking here?\r\n2) do I need to apply this fix to the beta snapshot I'm using to build master first or just to master itself before building?\r\n3) shouldn't rust explicitly specifying -lgcc automatically?  The [gcc documentation](https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html) appears to imply that libgcc is still needed in most cases, notably when using -nostdlibs (of which -nodefaultlibs appears to be a superset?)\r\n\r\nThe Solaris linker fails (as expected) here since there's an implicit dependency that's known, but wasn't explicitly named.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39729/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39729/timeline", "performed_via_github_app": null, "state_reason": "completed"}