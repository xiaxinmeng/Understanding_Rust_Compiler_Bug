{"url": "https://api.github.com/repos/rust-lang/rust/issues/96475", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96475/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96475/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96475/events", "html_url": "https://github.com/rust-lang/rust/issues/96475", "id": 1217223105, "node_id": "I_kwDOAAsO6M5IjVnB", "number": 96475, "title": "Wrong and missing information in PDB file", "user": {"login": "MolecularMatters", "id": 61518974, "node_id": "MDQ6VXNlcjYxNTE4OTc0", "avatar_url": "https://avatars.githubusercontent.com/u/61518974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MolecularMatters", "html_url": "https://github.com/MolecularMatters", "followers_url": "https://api.github.com/users/MolecularMatters/followers", "following_url": "https://api.github.com/users/MolecularMatters/following{/other_user}", "gists_url": "https://api.github.com/users/MolecularMatters/gists{/gist_id}", "starred_url": "https://api.github.com/users/MolecularMatters/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MolecularMatters/subscriptions", "organizations_url": "https://api.github.com/users/MolecularMatters/orgs", "repos_url": "https://api.github.com/users/MolecularMatters/repos", "events_url": "https://api.github.com/users/MolecularMatters/events{/privacy}", "received_events_url": "https://api.github.com/users/MolecularMatters/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-04-27T11:31:47Z", "updated_at": "2022-04-29T10:08:43Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "With both Rust 1.60 stable as well as the latest nightly (rustc 1.62.0-nightly (082e4ca49 2022-04-26)), rustc currently does not emit correct S_OBJNAME records and LF_BUILDINFO records into the PDB on Windows.\r\n\r\nSteps to reproduce:\r\n* cargo new repro\r\n* cd repro\r\n* cargo build\r\n* dump the PDB using either DIA2Dump or llvm pdbutil\r\n\r\nS_OBJNAME:\r\nThe S_OBJNAME record is stored in the PDB for each module stream, and contains the full path to the compiled .o file. This is supported by LLVM at: https://github.com/llvm/llvm-project/blob/9592e88f59cfd399e9285cfec50a23675f43a43a/llvm/lib/CodeGen/AsmPrinter/CodeViewDebug.cpp#L783\r\n\r\nAt the moment, this record is empty for all .o files stored in a PDB.\r\n\r\nLF_BUILDINFO:\r\nSimilarly, the LF_BUILDINFO record stores the following information for each module stream in the PDB:\r\n* the current working directory\r\n* path to the build tool, e.g. rustc\r\n* source file\r\n* PDB file (not applicable in this case)\r\n* command-line used to compile the corresponding .o\r\n\r\nThis is supported by LLVM at: https://github.com/llvm/llvm-project/blob/9592e88f59cfd399e9285cfec50a23675f43a43a/llvm/lib/CodeGen/AsmPrinter/CodeViewDebug.cpp#L920\r\n\r\nAt the moment, with rustc there are the following defects in the LF_BUILDINFO record:\r\n* path to the build tool is missing, i.e. uses an invalid type index, which makes DIA2Dump choke and llvm pdbutil crash\r\n* command-line is missing, again uses an invalid type index\r\n* source file is wrong, e.g. it is \"src\\main.rs\\@\\2j9iw9kw1zbigor6\" where it should be \"src\\main.rs\"\r\n\r\nTools like Live++ (https://liveplusplus.tech) need this information in order to be able to recompile individual .o files.\r\nThe relevant Zulip discussion can be found here: https://rust-lang.zulipchat.com/#narrow/stream/182449-t-compiler.2Fhelp/topic/Live.2B.2B.20for.20Rust", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96475/reactions", "total_count": 6, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 6}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96475/timeline", "performed_via_github_app": null, "state_reason": null}