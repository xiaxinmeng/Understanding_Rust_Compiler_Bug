{"url": "https://api.github.com/repos/rust-lang/rust/issues/90355", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90355/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90355/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90355/events", "html_url": "https://github.com/rust-lang/rust/issues/90355", "id": 1037869258, "node_id": "I_kwDOAAsO6M493KDK", "number": 90355, "title": "1.56 breaks multiple crates on Windows when subsystem = \"windows\" is used", "user": {"login": "ancwrd1", "id": 2361919, "node_id": "MDQ6VXNlcjIzNjE5MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2361919?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ancwrd1", "html_url": "https://github.com/ancwrd1", "followers_url": "https://api.github.com/users/ancwrd1/followers", "following_url": "https://api.github.com/users/ancwrd1/following{/other_user}", "gists_url": "https://api.github.com/users/ancwrd1/gists{/gist_id}", "starred_url": "https://api.github.com/users/ancwrd1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ancwrd1/subscriptions", "organizations_url": "https://api.github.com/users/ancwrd1/orgs", "repos_url": "https://api.github.com/users/ancwrd1/repos", "events_url": "https://api.github.com/users/ancwrd1/events{/privacy}", "received_events_url": "https://api.github.com/users/ancwrd1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-27T21:15:45Z", "updated_at": "2021-10-27T21:46:23Z", "closed_at": "2021-10-27T21:46:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\n\r\nSince 1.56 the `env_logger`, `pretty_env_logger` and other crates which depend on `termcolor` panic under Windows when `subsystem = \"windows\"` is used (tested with x86_64-pc-windows-gnu toolchain).\r\n\r\n### Code\r\n\r\nI tried this code:\r\n\r\n```rust\r\n#![windows_subsystem = \"windows\"]\r\nfn main() {\r\n    env_logger::init();\r\n}\r\n```\r\n\r\nThis panics in `stdlib/src/rust/library/std/src/os/windows/io/handle.rs`, line 183, failed assertion:\r\n\r\n```rust\r\n    unsafe fn from_raw_handle(handle: RawHandle) -> Self {\r\n        assert!(!handle.is_null());\r\n        Self { handle: NonNull::new_unchecked(handle) }\r\n    }\r\n```\r\n\r\n\r\n### Version it worked on\r\n\r\n<!--\r\nProvide the most recent version this worked on, for example:\r\n\r\nIt most recently worked on: Rust 1.55\r\n-->\r\n\r\nIt most recently worked on: Rust 1.55\r\n\r\n### Version with regression\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.56.0 (09c42c458 2021-10-18)\r\nbinary: rustc\r\ncommit-hash: 09c42c45858d5f3aedfa670698275303a3d19afa\r\ncommit-date: 2021-10-18\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.56.0\r\nLLVM version: 13.0.0\r\n```\r\n\r\n<!--\r\nDid the compiler crash? If so, please provide a backtrace.\r\n-->\r\n\r\n### Backtrace\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\n  11:           0xd9a6fc - <std::os::imp::windows::io::handle::OwnedHandle as std::os::imp::windows::io::raw::FromRawHandle>::from_raw_handle::h58e99ce743308beb\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\std\\src\\os\\.\\windows\\io\\handle.rs:183:9\r\n  12:           0xd9a623 - <std::fs::File as std::os::imp::windows::io::raw::FromRawHandle>::from_raw_handle::hd7ff93cfd96a36fc\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\std\\src\\os\\.\\windows\\io\\raw.rs:117:13\r\n  13:           0xd9990e - winapi_util::win::HandleRef::from_raw_handle::hcc2d6f6e7515e992\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/winapi-util-0.1.5/src/win.rs:162:39\r\n  14:           0xd998b7 - winapi_util::win::HandleRef::stderr::h79810937d5d69e16\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/winapi-util-0.1.5/src/win.rs:139:18\r\n  15:           0xd985b7 - winapi_util::console::HandleKind::handle::hb01c5a7ce1190825\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/winapi-util-0.1.5/src/console.rs:200:35\r\n  16:           0xd985f2 - winapi_util::console::Console::create_for_stream::h95149a3ab231c294\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/winapi-util-0.1.5/src/console.rs:208:17\r\n  17:           0xd9880d - winapi_util::console::Console::stderr::ha5961735cfeb7f2f\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/winapi-util-0.1.5/src/console.rs:225:9\r\n  18:           0xd82459 - termcolor::BufferWriter::create::h51337345c09243f7\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/termcolor-1.1.2/src/lib.rs:895:43\r\n  19:           0xd827b2 - termcolor::BufferWriter::stderr::h4a35d0b5ec85860d\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/termcolor-1.1.2/src/lib.rs:940:9\r\n  20:           0xd60bb9 - env_logger::fmt::writer::termcolor::imp::BufferWriter::stderr::hf2cc537fde91555f\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/fmt/writer/termcolor/extern_impl.rs:85:20\r\n  21:           0xd6f8c3 - env_logger::fmt::writer::Builder::build::he0d20b9c18bae37f\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/fmt/writer/mod.rs:194:39\r\n  22:           0xd544f6 - env_logger::Builder::build::h33b6f74caadbec9e\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/lib.rs:832:21\r\n  23:           0xd5434c - env_logger::Builder::try_init::he3e2683574f124e9\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/lib.rs:797:22\r\n  24:           0xd55399 - env_logger::try_init_from_env::h4e8cc27e0993b52a\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/lib.rs:1195:5\r\n  25:           0xd5530b - env_logger::try_init::hdfaf504ffb87fa4e\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/lib.rs:1145:5\r\n  26:           0xd55329 - env_logger::init::h9e63e6eb50009500\r\n                               at /home/dmitry/.cargo/registry/src/github.com-1ecc6299db9ec823/env_logger-0.9.0/src/lib.rs:1158:5\r\n  27:           0xd51cbd - termtest::main::h10cdc24da3ac8f2b\r\n                               at /home/dmitry/devel/inforce/rust/tests/termtest/src/main.rs:12:5\r\n  28:           0xd51a1b - core::ops::function::FnOnce::call_once::h2d55417970b8ea34\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\core\\src\\ops\\function.rs:227:5\r\n  29:           0xd5210e - std::sys_common::backtrace::__rust_begin_short_backtrace::h1816c1f107efa2cc\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\std\\src\\sys_common\\backtrace.rs:125:18\r\n  30:           0xd520e1 - std::rt::lang_start::{{closure}}::h1907ef58a21b40cc\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\std\\src\\rt.rs:63:18\r\n  31:          0x1155d9f - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once::hb976906386bc8227\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\core\\src\\ops/function.rs:259:13\r\n                           std::panicking::try::do_call::hba5df04a2cf65f69\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panicking.rs:403:40\r\n                           std::panicking::try::h2ac56f9643178143\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panicking.rs:367:19\r\n                           std::panic::catch_unwind::h6f85ffdd95e7a919\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panic.rs:129:14\r\n                           std::rt::lang_start_internal::{{closure}}::ha3ad8e05daeccc99\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/rt.rs:45:48\r\n                           std::panicking::try::do_call::h9c76db811424ade5\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panicking.rs:403:40\r\n                           std::panicking::try::h74e48764e0fe1c7c\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panicking.rs:367:19\r\n                           std::panic::catch_unwind::h01fcb7921a9e1098\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/panic.rs:129:14\r\n                           std::rt::lang_start_internal::h66170f2e3b2ec67d\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\/library\\std\\src/rt.rs:45:20\r\n  32:           0xd520af - std::rt::lang_start::hfbfc1a28994be11a\r\n                               at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa\\library\\std\\src\\rt.rs:62:5\r\n  33:           0xd51cfc - main\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<!--\r\nIf you know when this regression occurred, please add a line like below, replacing `{channel}` with one of stable, beta, or nightly.\r\n\r\n@rustbot modify labels: +regression-from-stable-to-{channel} -regression-untriaged\r\n-->\r\n", "closed_by": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90355/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90355/timeline", "performed_via_github_app": null, "state_reason": "completed"}