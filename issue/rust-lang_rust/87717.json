{"url": "https://api.github.com/repos/rust-lang/rust/issues/87717", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/87717/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/87717/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/87717/events", "html_url": "https://github.com/rust-lang/rust/issues/87717", "id": 958714008, "node_id": "MDU6SXNzdWU5NTg3MTQwMDg=", "number": 87717, "title": "Warn that trait implementation is gated by a feature flag", "user": {"login": "edward-shen", "id": 6173958, "node_id": "MDQ6VXNlcjYxNzM5NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6173958?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edward-shen", "html_url": "https://github.com/edward-shen", "followers_url": "https://api.github.com/users/edward-shen/followers", "following_url": "https://api.github.com/users/edward-shen/following{/other_user}", "gists_url": "https://api.github.com/users/edward-shen/gists{/gist_id}", "starred_url": "https://api.github.com/users/edward-shen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edward-shen/subscriptions", "organizations_url": "https://api.github.com/users/edward-shen/orgs", "repos_url": "https://api.github.com/users/edward-shen/repos", "events_url": "https://api.github.com/users/edward-shen/events{/privacy}", "received_events_url": "https://api.github.com/users/edward-shen/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-08-03T04:34:10Z", "updated_at": "2021-08-03T18:33:39Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given the following code: (Playground link not provided because this involves a crate not on playground)\r\n\r\n```rust\r\nuse rayon::iter::IntoParallelIterator;\r\nuse dashmap::DashSet;\r\n\r\n#[derive(PartialEq, Eq, PartialOrd, Ord, Hash)]\r\nstruct Foo;\r\n\r\nlet test = DashSet::<Foo>::new();\r\ntest.par_iter();\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0599]: the method `par_iter` exists for struct `DashSet<Foo>`, but its trait bounds were not satisfied\r\n  --> src/lib.rs:74:14\r\n   |\r\n74 |         test.par_iter();\r\n   |              ^^^^^^^^ method cannot be called on `DashSet<Foo>` due to unsatisfied trait bounds\r\n   | \r\n  ::: /home/edward/.cargo/registry/src/github.com-1ecc6299db9ec823/dashmap-4.0.2/src/set.rs:19:1\r\n   |\r\n19 | pub struct DashSet<K, S = RandomState> {\r\n   | -------------------------------------- doesn't satisfy `DashSet<Foo>: IntoParallelRefIterator`\r\n   |\r\n   = note: the following trait bounds were not satisfied:\r\n           `&DashSet<Foo>: IntoParallelIterator`\r\n           which is required by `DashSet<Foo>: IntoParallelRefIterator`\r\n```\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the output should look like:\r\n\r\n```\r\nerror[E0599]: the method `par_iter` exists for struct `DashSet<Foo>`, but its trait bounds were not satisfied\r\n  --> src/lib.rs:74:14\r\n   |\r\n74 |         test.par_iter();\r\n   |              ^^^^^^^^ method cannot be called on `DashSet<Foo>` due to unsatisfied trait bounds\r\n   | \r\n  ::: /home/edward/.cargo/registry/src/github.com-1ecc6299db9ec823/dashmap-4.0.2/src/set.rs:19:1\r\n   |\r\n19 | pub struct DashSet<K, S = RandomState> {\r\n   | -------------------------------------- doesn't satisfy `DashSet<Foo>: IntoParallelRefIterator`\r\n   |\r\n   = note: the following trait bounds were not satisfied:\r\n           `&DashSet<Foo>: IntoParallelIterator`\r\n           which is required by `DashSet<Foo>: IntoParallelRefIterator`\r\n   = note: `dashmap` has an optional feature `rayon` that is currently not enabled.\r\n```\r\n\r\nI was trying to call `par_iter()` on the following example, but was very confused with regards to the error message. Consider the following image, snapshotted from the [`dashmap::DashSet` docs](https://docs.rs/dashmap/4.0.2/dashmap/struct.DashSet.html#impl-FromParallelIterator%3CK%3E):\r\n![image](https://user-images.githubusercontent.com/6173958/127957155-50fc0de4-dbcd-4189-96d1-3683f7ed0d09.png)\r\n\r\nIt looks like `Foo` satisfies all the trait bounds needed for `DashSet<Foo>` to fufill `InterParallelIterator`, yet the trait still isn't being satisfied! What's going on? The solution is a case of either confusing docs.rs or a perhaps unintuitive diagnostic: a missing feature flag (in this case, `rayon`).\r\n\r\nAs a quick concept, I would suggest a note indicating that the trait implementation _does_ exist for a struct but isn't enabled because the feature isn't enabled. As a layman on the rustc internals, I'm not sure how feasible this would be, but something like the following might be viable:\r\n 1. On a failed trait bound check `Trait`,\r\n 2. Check if struct `Foo` from crate `crate` implements `Trait` regardless of enabled features,\r\n 3. If so, check if the `Trait` implementation or its parent mods is enabled through a feature, and that feature isn't enabled,\r\n 4. If so, add a note saying that `Trait` is not satisfied because the trait implementation is gated by a feature flag.\r\n\r\nI think this is worthwhile to implement, as I believe this is incredibly confusing to new Rust users. The compiler and docs make no indication that a trait implementation is gated, which means that a new user would be absolutely lost on next steps.\r\nHeck, I would consider myself an intermediate or even an advanced user, and had to ask the community for help. ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/87717/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/87717/timeline", "performed_via_github_app": null, "state_reason": null}