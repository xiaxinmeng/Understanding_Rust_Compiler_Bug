{"url": "https://api.github.com/repos/rust-lang/rust/issues/103823", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103823/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103823/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103823/events", "html_url": "https://github.com/rust-lang/rust/issues/103823", "id": 1430668153, "node_id": "I_kwDOAAsO6M5VRkN5", "number": 103823, "title": "`rustc` v1.64.0 hangs for a crate with a syntax error", "user": {"login": "tdyas", "id": 901363, "node_id": "MDQ6VXNlcjkwMTM2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/901363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tdyas", "html_url": "https://github.com/tdyas", "followers_url": "https://api.github.com/users/tdyas/followers", "following_url": "https://api.github.com/users/tdyas/following{/other_user}", "gists_url": "https://api.github.com/users/tdyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/tdyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tdyas/subscriptions", "organizations_url": "https://api.github.com/users/tdyas/orgs", "repos_url": "https://api.github.com/users/tdyas/repos", "events_url": "https://api.github.com/users/tdyas/events{/privacy}", "received_events_url": "https://api.github.com/users/tdyas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-01T00:27:31Z", "updated_at": "2022-11-01T03:49:01Z", "closed_at": "2022-11-01T03:49:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "Issue: `rustc` v1.64.0 hangs on a crate with a syntax error without reporting the error. \r\n\r\nI was making [this change](https://github.com/pantsbuild/pants/pull/17290) to a [Rust project](https://github.com/pantsbuild/pants) where one of the non-default workspace crates ended up with an error due to the signature of a function in another crate in the workspace changing. Normally, this crate compiles relatively quickly, but after making the change, `rustc` ran indefinitely instead of showing the error. Fixing the error (or not making the change in the first place) allows the crate to compile normally again.\r\n\r\nSeems to build fine on nightly as of today.\r\n\r\nCommits:\r\n- [Commit which triggers the hang](https://github.com/pantsbuild/pants/pull/17290/commits/0f7dd58f884300740aa9f0e2fd96637b8fe2616e)\r\n- [Commit which fixes the syntax error and then crate compiles normally](https://github.com/pantsbuild/pants/pull/17290/commits/7c0024f76b990f8513514f65f52127f53d005bf2)\r\n\r\nReproduces on both Linux and macOS/ARM with Rust v1.64.0. Nightly appears to build without a hang and then displays the expected syntax error.\r\n\r\nHow to reproduce:\r\n\r\n1. Clone [my fork](https://github.com/tdyas/pants) of the https://github.com/pantsbuild/pants/ repository.\r\n2. Checkout the commit: `git checkout 0f7dd58f884300740aa9f0e2fd96637b8fe2616e`\r\n3. Build the crate at issue:\r\n  ```\r\n  cd src/rust/engine/process_executor\r\n  cargo build\r\n  ```\r\n4. The build should hang. Reproduces on both Linux and macOS/ARM with Rust v1.64.0.\r\n\r\nTraces:\r\n- [Thread dumps #1 and #2](https://github.com/rust-lang/rust/files/9905760/thread-dumps.txt)\r\n- [perf.hist.txt](https://github.com/rust-lang/rust/files/9905753/perf.hist.txt)\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.64.0 (a55dd71d5 2022-09-19)\r\nbinary: rustc\r\ncommit-hash: a55dd71d5fb0ec5a6a3a9e8c27b2127ba491ce52\r\ncommit-date: 2022-09-19\r\nhost: aarch64-apple-darwin\r\nrelease: 1.64.0\r\nLLVM version: 14.0.6\r\n```\r\n\r\nNightly version info on which there is no hang:\r\n\r\n```\r\nrustc 1.67.0-nightly (77e57db38 2022-10-30)\r\nbinary: rustc\r\ncommit-hash: 77e57db384aca99444c3b5f6a9c86bc58a804d89\r\ncommit-date: 2022-10-30\r\nhost: aarch64-apple-darwin\r\nrelease: 1.67.0-nightly\r\nLLVM version: 15.0.4\r\n```\r\n\r\n", "closed_by": {"login": "tdyas", "id": 901363, "node_id": "MDQ6VXNlcjkwMTM2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/901363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tdyas", "html_url": "https://github.com/tdyas", "followers_url": "https://api.github.com/users/tdyas/followers", "following_url": "https://api.github.com/users/tdyas/following{/other_user}", "gists_url": "https://api.github.com/users/tdyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/tdyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tdyas/subscriptions", "organizations_url": "https://api.github.com/users/tdyas/orgs", "repos_url": "https://api.github.com/users/tdyas/repos", "events_url": "https://api.github.com/users/tdyas/events{/privacy}", "received_events_url": "https://api.github.com/users/tdyas/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103823/timeline", "performed_via_github_app": null, "state_reason": "completed"}