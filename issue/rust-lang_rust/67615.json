{"url": "https://api.github.com/repos/rust-lang/rust/issues/67615", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67615/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67615/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67615/events", "html_url": "https://github.com/rust-lang/rust/issues/67615", "id": 542376123, "node_id": "MDU6SXNzdWU1NDIzNzYxMjM=", "number": 67615, "title": "Missing backtraces in local compiler build", "user": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-12-25T19:00:48Z", "updated_at": "2020-03-02T18:35:29Z", "closed_at": "2020-03-02T18:35:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I recently rebased an old branch (branched off at 4007d4ef26eab44bdabc2b7574d032152264d3ad) and afterwards found that the backtrace didn't contain any of the compiler (ignore the actual ICE, I'm sure I'll fix it once I stop trying to get backtraces back):\r\n\r\n```\r\nerror: internal compiler error: src/librustc/traits/codegen/mod.rs:58: Encountered error `Unimplemented` selecting `Binder(<T as num::dec2flt::rawfp::RawFloat>)` during codegen\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:895:9\r\nstack backtrace:\r\n   0: backtrace::backtrace::libunwind::trace\r\n             at /home/david/.cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88\r\n   1: backtrace::backtrace::trace_unsynchronized\r\n             at /home/david/.cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/mod.rs:66\r\n   2: std::sys_common::backtrace::_print_fmt\r\n             at src/libstd/sys_common/backtrace.rs:77\r\n   3: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n             at src/libstd/sys_common/backtrace.rs:59\r\n   4: core::fmt::write\r\n             at src/libcore/fmt/mod.rs:1057\r\n   5: std::io::Write::write_fmt\r\n             at src/libstd/io/mod.rs:1426\r\n   6: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:62\r\n   7: std::sys_common::backtrace::print\r\n             at src/libstd/sys_common/backtrace.rs:49\r\n   8: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/panicking.rs:195\r\n   9: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\nerror: could not compile `core`.\r\n```\r\n\r\nYou can find my [`config.toml` here](https://github.com/davidtwco/veritas/blob/fbdde10284101a7e2b412495894828dd2fbe3067/shells/rust.nix#L13-L524). This is running on a NixOS host with an i7-8700. It isn't fixed by setting `RUST_BACKTRACE` to `1`, `full` or leaving it unset. I've also tried with and without the `backtrace` option in `config.toml`. I also tried invoking the compiler directly (original error was in compiling `libcore` through `x.py` after some of my changes).\r\n\r\nI was able to bisect ([results](http://sprunge.us/ACXOa3)) the issue to a handful of commits:\r\n\r\n- 150d328d2e70b4cbc63d0f7d2dc802e1d6d2ac39\r\n- 9245182420879321962ec63c6d8cf2d9a862316e\r\n- a7de090e35efdbe7c45a7840726c1b4facf26ae6\r\n- 8b9c5396ca574fad9cc7b51d16c8c96e0ae74632\r\n- 1aa34d4decde1d1e0089a4aef450d45efd9ea2d4\r\n- fca192cca2dc1a9ea730f2b1ac5b5976ea62bb61\r\n- f94b0e6af32c095d1627926d8922d6d3e218ca76\r\n- 91b25a84df08d88c9bf7910da9d84ae30e410edb\r\n- 7f23e6e8d7479d8a430e007fab9b195b7ea0d261\r\n\r\nI wasn't able to test any of these and be more specific because `Cargo.lock` was in a broken state in these commits. On the last commit which failed, after printing the same limited backtrace as above (on a simple test case that compile errors and `-Z treat-err-as-bug`), it printed the following:\r\n\r\n```\r\n   8: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/panicking.rs:193 \r\n   9: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:210    \r\nfish: \u201crustc +rust2-stage1 -Z treat-er\u2026\u201d terminated by signal SIGSEGV (Address boundary error)\r\n```\r\n\r\ncc @Aaron1011 @alexcrichton (authors of the above commits)", "closed_by": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67615/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67615/timeline", "performed_via_github_app": null, "state_reason": "completed"}