{"url": "https://api.github.com/repos/rust-lang/rust/issues/37276", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37276/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37276/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37276/events", "html_url": "https://github.com/rust-lang/rust/issues/37276", "id": 183950746, "node_id": "MDU6SXNzdWUxODM5NTA3NDY=", "number": 37276, "title": "LLVM pointer range loop / autovectorization regression part two", "user": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-10-19T12:42:18Z", "updated_at": "2020-01-31T21:01:53Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "This is a follow up to #35662. The optimizer regression that resulted in that bug is still not fixed.\n\nThat bug created a simplified test case, and fixed it for that case. That's good. However, I have not been able to remove my workaround, so the issue still persists in the original code.\n\nThe issue appears for an 8x8 kernel and disappears if the kernel is shrunk to 4x4, so it's somehow related to the sheer size of the function, or the length it goes to in loop unrolling.\n\nPreamble for the code that produces the desired codegen:\n\n``` rust\nlet mut ab: [[f32; 8]; 8];\nab = ::std::mem::uninitialized();\nloop8!(i, loop8!(j, ab[i][j] = 0.));\n```\n\nWhat the loop8 macros do is that they expand the expression statically, so it corresponds to 64 assignments.\n\nInitialization part for code which is not optimizing well:\n\n``` rust\nlet mut ab: [[f32; 8]; 8];\nab = [[0.; 8]; 8];\n```\n\nAnother example which is not optimizing well:\n\n``` rust\nlet mut ab: [[f32; 8]; 8];\nab = ::std::mem::uninitialized();\nfor i in 0..8 {\n    for j in 0..8 {\n        ab[i][j] = 0.;\n    }\n}\n```\n\nFull reproducer in the next comment.\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37276/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37276/timeline", "performed_via_github_app": null, "state_reason": null}