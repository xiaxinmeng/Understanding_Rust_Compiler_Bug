{"url": "https://api.github.com/repos/rust-lang/rust/issues/51292", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51292/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51292/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51292/events", "html_url": "https://github.com/rust-lang/rust/issues/51292", "id": 328725346, "node_id": "MDU6SXNzdWUzMjg3MjUzNDY=", "number": 51292, "title": "Deprecate `ok_or` method", "user": {"login": "Pzixel", "id": 11201122, "node_id": "MDQ6VXNlcjExMjAxMTIy", "avatar_url": "https://avatars.githubusercontent.com/u/11201122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pzixel", "html_url": "https://github.com/Pzixel", "followers_url": "https://api.github.com/users/Pzixel/followers", "following_url": "https://api.github.com/users/Pzixel/following{/other_user}", "gists_url": "https://api.github.com/users/Pzixel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pzixel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pzixel/subscriptions", "organizations_url": "https://api.github.com/users/Pzixel/orgs", "repos_url": "https://api.github.com/users/Pzixel/repos", "events_url": "https://api.github.com/users/Pzixel/events{/privacy}", "received_events_url": "https://api.github.com/users/Pzixel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-06-02T08:17:11Z", "updated_at": "2018-06-02T14:33:53Z", "closed_at": "2018-06-02T14:33:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "There is plenty of issues when people unintendely use the eager version of mapping result method just because it saves some typing. It results in [confusion among the community](https://users.rust-lang.org/t/performance-impact-of-result-vs-option/17783) as well as [performance issues in compiler](https://github.com/rust-lang/rust/pull/50051).\r\n\r\nRust is going into the new epoch, so it's a good time to resolve this mistake.\r\n\r\nThe proposal is:\r\n\r\n1. Deprecate `ok_or` method on `Result` type. We already have a lint in clippy that suggest to replace it with `ok_or_else` if any computations are done there. It's a good signal that it shall be done. On the other hand, `or_or_else` with constant value lambda would be always inlined and thus have same performance as before.\r\n2. _(Optional)_ Remove `ok_or`. Replace it with `ok_or_else` implementation. `ok_or_else` could be a deprecated alias for `ok_or` with lambda as parameter.\r\n\r\nThe phase 2 looks a bit confusing, but as said it would save some typing. Or it could be done in one big step. It would break the existing code, however it's an ok breakage as it's easy to fix it automatically (via just `grep` replace). We are already going to break some code with `dyn Trait` so it's not new for us.\r\n\r\nThis probably requires an RFC, I didn't do one yet, but I think we may collect some feedback here. Do you feel that compiler is smart enough to inline constant functions and we can remove some confusion and possible bottlenecks? Do you accept to type a bit more (`else(||` part) or it's too high cost (among others like deprecation and code breakage)?", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51292/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51292/timeline", "performed_via_github_app": null, "state_reason": "completed"}