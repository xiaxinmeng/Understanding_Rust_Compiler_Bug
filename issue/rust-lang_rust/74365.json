{"url": "https://api.github.com/repos/rust-lang/rust/issues/74365", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74365/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74365/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74365/events", "html_url": "https://github.com/rust-lang/rust/issues/74365", "id": 657391576, "node_id": "MDU6SXNzdWU2NTczOTE1NzY=", "number": 74365, "title": "Consider allowing trailing comma in struct update syntax", "user": {"login": "Veetaha", "id": 36276403, "node_id": "MDQ6VXNlcjM2Mjc2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/36276403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veetaha", "html_url": "https://github.com/Veetaha", "followers_url": "https://api.github.com/users/Veetaha/followers", "following_url": "https://api.github.com/users/Veetaha/following{/other_user}", "gists_url": "https://api.github.com/users/Veetaha/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veetaha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veetaha/subscriptions", "organizations_url": "https://api.github.com/users/Veetaha/orgs", "repos_url": "https://api.github.com/users/Veetaha/repos", "events_url": "https://api.github.com/users/Veetaha/events{/privacy}", "received_events_url": "https://api.github.com/users/Veetaha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 27424086, "node_id": "MDU6TGFiZWwyNzQyNDA4Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-parser", "name": "A-parser", "color": "f7e101", "default": false, "description": "Area: The parsing of Rust source code to an AST."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}, {"id": 1659943986, "node_id": "MDU6TGFiZWwxNjU5OTQzOTg2", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-verbose", "name": "D-verbose", "color": "c9f7a3", "default": false, "description": "Too much output caused by a single piece of incorrect code"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-15T14:23:23Z", "updated_at": "2022-09-07T07:12:24Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "One downside of prohibiting this little trailing guy is this example:\r\n```rust\r\n#[derive(Default)]\r\nstruct S { foo: i32 }\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    S { ..S::default(), };\r\n}\r\n```\r\nIf you open it with `rust-analyzer` you'll see the entire file in the fire:\r\n![image](https://user-images.githubusercontent.com/36276403/87556308-2af56580-c6bf-11ea-9b36-04dbb6bae85f.png)\r\n\r\nThis is because (my wild guess) that trailing comma inside the struct is a syntax error and that's why `#[tokio::main]` proc macro doesn't get expanded and you get an error about the missing main function which has a span of the enire file and hides the trailing comma in an IDE.\r\n\r\n<details>\r\n<summary>cargo run output:</summary>\r\n\r\n```\r\n~/junk/rust-sandbox $ cargo run\r\n   Compiling crate_foo v0.1.0 (/home/veetaha/junk/rust-sandbox/crate_foo)\r\nerror: cannot use a comma after the base struct\r\n --> crate_foo/src/main.rs:6:9\r\n  |\r\n6 |     S { ..S::default(), };\r\n  |         ^^^^^^^^^^^^^^- help: remove this comma\r\n  |\r\n  = note: the base struct must always be the last field\r\n\r\nerror: unexpected token\r\n --> crate_foo/src/main.rs:6:23\r\n  |\r\n6 |     S { ..S::default(), };\r\n  |                       ^\r\n\r\nerror[E0601]: `main` function not found in crate `crate_foo`\r\n --> crate_foo/src/main.rs:1:1\r\n  |\r\n1 | / #[derive(Default)]\r\n2 | | struct S { foo: i32 }\r\n3 | |\r\n4 | | #[tokio::main]\r\n5 | | async fn main() {\r\n6 | |     S { ..S::default(), };\r\n7 | | }\r\n  | |_^ consider adding a `main` function to `crate_foo/src/main.rs`\r\n\r\nerror: aborting due to 3 previous errors\r\n\r\nFor more information about this error, try `rustc --explain E0601`.\r\nerror: could not compile `crate_foo`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n</details>\r\n\r\n<details>\r\n<summary>Environment</summary>\r\n\r\n```\r\n~/junk/rust-sandbox $ rustc --version --verbose\r\nrustc 1.44.1 (c7087fe00 2020-06-17)\r\nbinary: rustc\r\ncommit-hash: c7087fe00d2ba919df1d813c040a5d47e43b0fe7\r\ncommit-date: 2020-06-17\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.44.1\r\nLLVM version: 9.0\r\n~/junk/rust-sandbox $ cargo --version --verbose\r\ncargo 1.44.1 (88ba85757 2020-06-11)\r\nrelease: 1.44.1\r\ncommit-hash: 88ba8575724c08a50eb265a05f3ff6d0883de1ee\r\ncommit-date: 2020-06-11\r\n```\r\n</details>\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74365/timeline", "performed_via_github_app": null, "state_reason": null}