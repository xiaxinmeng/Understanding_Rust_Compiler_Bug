{"url": "https://api.github.com/repos/rust-lang/rust/issues/54384", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54384/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54384/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54384/events", "html_url": "https://github.com/rust-lang/rust/issues/54384", "id": 362109057, "node_id": "MDU6SXNzdWUzNjIxMDkwNTc=", "number": 54384, "title": "remove CTFE loop detector", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 900795185, "node_id": "MDU6TGFiZWw5MDA3OTUxODU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-eval", "name": "A-const-eval", "color": "f7e101", "default": false, "description": "Area: constant evaluation (mir interpretation)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2018-09-20T09:55:31Z", "updated_at": "2020-03-24T04:07:46Z", "closed_at": "2020-03-24T04:07:46Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The plan changed to [removing the loop detector](https://github.com/rust-lang/rust/issues/54384#issuecomment-598119713).\r\n\r\n### Original issue\r\n\r\nThe code at https://github.com/rust-lang/rust/blob/master/src/librustc_mir/interpret/snapshot.rs leaves me puzzled and confused after wasting about two hours on it.  Open questions are:\r\n\r\n* Why is `AllocIdSnapshot` an `Option`? What does it mean when there is a `None` there and when does that happen?\r\n* Why does `EvalSnapshot::new` make a deep copy, and then it has a method `EvalSnapshot::snapshot` that does a snapshot (of the `EvalSnapshot`, confusing naming)? That method is called in `PartialEq::eq`, doesn't that mean we do tons of allocations and copies every time we compare?\r\n* Where and how does it avoid snapshotting the same allocation twice in one snapshot?\r\n\r\nI tried fixing the second point (making a snapshot when `EvalSnapshot` is created, not when it is compared), but failed to do so as the thing produced by the `Snapshot` trait isn't actually a snapshot (which I would expect to be a deep, independent copy), but something full of references to somewhere (couldn't figure out where though, just saw the lifetime).\r\n\r\nDocumentation (inline in the code) should be improved to answer these questions, and if the part about allocating during comparison is correct, that should be fixed.\r\n\r\nCc @oli-obk @brunocodutra ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54384/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54384/timeline", "performed_via_github_app": null, "state_reason": "completed"}