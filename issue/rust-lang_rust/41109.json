{"url": "https://api.github.com/repos/rust-lang/rust/issues/41109", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/41109/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/41109/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/41109/events", "html_url": "https://github.com/rust-lang/rust/issues/41109", "id": 219856664, "node_id": "MDU6SXNzdWUyMTk4NTY2NjQ=", "number": 41109, "title": "Some gcc names make the compiler think it runs on windows", "user": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-04-06T10:41:37Z", "updated_at": "2017-06-25T17:59:04Z", "closed_at": "2017-06-25T17:59:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm running on linux (x86_64-unknown-linux-gnu) and cross-compiling for an OpenWRT device using `xargo`. I use the gcc from the OpenWRT SDK and get an error:\r\n\r\n```\r\n$ export CC=/home/vorner/OpenWrt-SDK-mpc85xx-p2020-nand_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64/staging_dir/toolchain-powerpc_8540_gcc-4.8-linaro_uClibc-0.9.33.2/bin/powerpc-openwrt-linux-uclibcspe-gcc\r\n$ xargo build --target=powerpc-unknown-linux-gnu --release\r\n    Updating registry `https://github.com/rust-lang/crates.io-index`\r\n   Compiling unwind v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libunwind)\r\n   Compiling gcc v0.3.45\r\n   Compiling libc v0.2.21\r\n   Compiling libc v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/rustc/libc_shim)\r\n   Compiling core v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcore)\r\n   Compiling filetime v0.1.10\r\n   Compiling build_helper v0.1.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/build_helper)\r\n   Compiling std v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libstd)\r\n   Compiling compiler_builtins v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcompiler_builtins)\r\nerror: failed to run custom build command for `compiler_builtins v0.0.0 (file:///home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcompiler_builtins)`\r\nprocess didn't exit successfully: `/tmp/.private/vorner/xargo.66pfGEaAS3rl/target/release/build/compiler_builtins-902201105b0c4b84/build-script-build` (exit code: 101)\r\n--- stdout\r\ncargo:rerun-if-changed=/home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcompiler_builtins/../compiler-rt/www/menu.html.incl\r\ncargo:rerun-if-changed=/home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcompiler_builtins/../compiler-rt/www/menu.css\r\n# Omitted lots of rerun-if-changed lines that look similar\r\ncargo:rerun-if-changed=/home/vorner/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libcompiler_builtins/../compiler-rt/.arcconfig\r\ncargo:rustc-link-lib=static=compiler-rt\r\ncargo:rustc-link-search=native=/tmp/.private/vorner/xargo.66pfGEaAS3rl/target/powerpc-unknown-linux-gnu/release/build/compiler_builtins-393fea2539fdafee/out/compiler-rt/.\r\nTARGET = Some(\"powerpc-unknown-linux-gnu\")\r\nOPT_LEVEL = Some(\"3\")\r\nTARGET = Some(\"powerpc-unknown-linux-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nTARGET = Some(\"powerpc-unknown-linux-gnu\")\r\nTARGET = Some(\"powerpc-unknown-linux-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCC_powerpc-unknown-linux-gnu = None\r\nCC_powerpc_unknown_linux_gnu = None\r\nTARGET_CC = None\r\nCC = Some(\"/home/vorner/OpenWrt-SDK-mpc85xx-p2020-nand_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64/staging_dir/toolchain-powerpc_8540_gcc-4.8-linaro_uClibc-0.9.33.2/bin/powerpc-openwrt-linux-uclibcspe-gcc\")\r\nTARGET = Some(\"powerpc-unknown-linux-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCFLAGS_powerpc-unknown-linux-gnu = None\r\nCFLAGS_powerpc_unknown_linux_gnu = None\r\nTARGET_CFLAGS = None\r\nCFLAGS = None\r\nPROFILE = Some(\"release\")\r\nrunning: \"/home/vorner/OpenWrt-SDK-mpc85xx-p2020-nand_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64/staging_dir/toolchain-powerpc_8540_gcc-4.8-linaro_uClibc-0.9.33.2/bin/powerpc-openwrt-linux-uclibcspe-gcc\" \"/nologo\" \"/MD\" \"/O2\" \"-fno-builtin\" \"-fvisibility=hidden\" \"-fomit-frame-pointer\" \"-ffreestanding\" \"/DVISIBILITY_HIDDEN\" \"-o\" \"/tmp/.private/vorner/xargo.66pfGEaAS3rl/target/powerpc-unknown-linux-gnu/release/build/compiler_builtins-393fea2539fdafee/out/compiler-rt/../compiler-rt/lib/builtins/absvdi2.o\" \"-c\" \"../compiler-rt/lib/builtins/absvdi2.c\"\r\ncargo:warning=powerpc-openwrt-linux-uclibcspe-gcc: error: /nologo: No such file or directory\r\ncargo:warning=powerpc-openwrt-linux-uclibcspe-gcc: error: /MD: No such file or directory\r\ncargo:warning=powerpc-openwrt-linux-uclibcspe-gcc: error: /O2: No such file or directory\r\ncargo:warning=powerpc-openwrt-linux-uclibcspe-gcc: error: /DVISIBILITY_HIDDEN: No such file or directory\r\nExitStatus(ExitStatus(256))\r\n```\r\n\r\nWhat seems to be happening is that something calls the gcc compiler with windows-style switches (`/MD` instead of `-MD`), which fails. However, if I set the compiler to `/home/vorner/OpenWrt-SDK-mpc85xx-p2020-nand_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64/staging_dir/toolchain-powerpc_8540_gcc-4.8-linaro_uClibc-0.9.33.2/bin/powerpc-openwrt-linux-gcc` (omitting the `uclibcspe` part, the SDK has a symlink with that name), everything works fine and it uses the correct switches.\r\n\r\nObviously, the name of the compiler confuses something in there to think it runs on windows. I was told on `#rust-internals` to report it here, though it is not 100% obvious it's problem in this repository.\r\n\r\nRelevant versions:\r\n```\r\n$ rustc --version --verbose\r\nrustc 1.18.0-nightly (91ae22a01 2017-04-05)\r\nbinary: rustc\r\ncommit-hash: 91ae22a012fae7fa7589b1bba77bf4579708ee33\r\ncommit-date: 2017-04-05\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.18.0-nightly\r\nLLVM version: 3.9\r\n$ xargo --version --verbose\r\nxargo 0.3.5\r\n+ \"cargo\" \"--version\" \"--verbose\"\r\ncargo 0.19.0-nightly (4e95c6b41 2017-03-23)\r\nrelease: 0.19.0\r\ncommit-hash: 4e95c6b41eca3388f54dd5f7787366ad2df637b5\r\ncommit-date: 2017-03-23\r\n```\r\n\r\nIf anyone wants to try, the SDK can be found [here](https://repo.turris.cz/turris/OpenWrt-SDK-mpc85xx-p2020-nand_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64.tar.bz2). I'll be happy to provide more needed information.\r\n\r\nDespite these small setbacks, I must compliment on how cross-compiling with rust is a smooth experience (taking into account how painful cross-compiling usually is).", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/41109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/41109/timeline", "performed_via_github_app": null, "state_reason": "completed"}