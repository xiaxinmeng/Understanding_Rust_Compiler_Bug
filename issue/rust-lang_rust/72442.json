{"url": "https://api.github.com/repos/rust-lang/rust/issues/72442", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/72442/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/72442/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/72442/events", "html_url": "https://github.com/rust-lang/rust/issues/72442", "id": 622832816, "node_id": "MDU6SXNzdWU2MjI4MzI4MTY=", "number": 72442, "title": "[Nightly RustC -- Debug only] Type check fails in async functions when compiling to debug.", "user": {"login": "vicky5124", "id": 8344197, "node_id": "MDQ6VXNlcjgzNDQxOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8344197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vicky5124", "html_url": "https://github.com/vicky5124", "followers_url": "https://api.github.com/users/vicky5124/followers", "following_url": "https://api.github.com/users/vicky5124/following{/other_user}", "gists_url": "https://api.github.com/users/vicky5124/gists{/gist_id}", "starred_url": "https://api.github.com/users/vicky5124/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vicky5124/subscriptions", "organizations_url": "https://api.github.com/users/vicky5124/orgs", "repos_url": "https://api.github.com/users/vicky5124/repos", "events_url": "https://api.github.com/users/vicky5124/events{/privacy}", "received_events_url": "https://api.github.com/users/vicky5124/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-05-21T22:39:01Z", "updated_at": "2020-05-26T01:43:39Z", "closed_at": "2020-05-26T01:43:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\nThe rustc compiler panics for being unable to check the type of an object.\r\nIn the example, it's shown in the form of `path.to_str()` returning an Option, and `File::open()` being unable to take Option as a parameter type.\r\n\r\n```\r\nerror[E0277]: the trait bound `std::option::Option<&str>: std::convert::AsRef<std::path::Path>` is not satisfied\r\n   --> src/main.rs:7:28\r\n    |\r\n7   |     let mut f = File::open(path.to_str())?;\r\n    |                            ^^^^^^^^^^^^^ the trait `std::convert::AsRef<std::path::Path>` is not implemented for `std::option::Option<&str>`\r\n    |\r\n   ::: /home/nitsuga/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src/libstd/fs.rs:374:20\r\n    |\r\n374 |     pub fn open<P: AsRef<Path>>(path: P) -> io::Result<File> {\r\n    |                    ----------- required by this bound in `std::fs::File::open`\r\n```\r\nThis would be the expected compilation error for that snippet of code, but instead of that, the compiler just panics.\r\n\r\nThis error only occurs on asynchronous functions and in nightly.\r\nIt also only happens when not compiling with --release, only in debug.\r\n\r\n### Code\r\n\r\n```Rust\r\nuse std::fs::File;\r\nuse std::io::prelude::*;\r\n\r\n// async_std or just calling an async function in any way possible will produce the same panic\r\n// just here for example usage, as tokio is the most common async runtime.\r\n#[tokio::main]\r\nasync fn main() -> Result<(), Box<dyn std::error::Error>> {\r\n    let path = std::path::Path::new(\".\");\r\n    let mut f = File::open(path.to_str())?;\r\n    let mut src = String::new();\r\n\r\n    f.read_to_string(&mut src)?;\r\n\r\n    Ok(())\r\n}\r\n\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.45.0-nightly (d8878868c 2020-05-18)\r\nbinary: rustc\r\ncommit-hash: d8878868c8d7ef3779e7243953fc050cbb0e0565\r\ncommit-date: 2020-05-18\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.45.0-nightly\r\nLLVM version: 9.0\r\n```\r\n\r\n### Error output\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\nhttps://pastebin.com/6WaHRfij\r\n`RUST_BACKTRACE=1 cargo run --verbose`\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/72442/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/72442/timeline", "performed_via_github_app": null, "state_reason": "completed"}