{"url": "https://api.github.com/repos/rust-lang/rust/issues/23477", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23477/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23477/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23477/events", "html_url": "https://github.com/rust-lang/rust/issues/23477", "id": 62696438, "node_id": "MDU6SXNzdWU2MjY5NjQzOA==", "number": 23477, "title": "LLVM assertion failure when using `rustc -g` on struct with unsized trailing field", "user": {"login": "sp3d", "id": 4684824, "node_id": "MDQ6VXNlcjQ2ODQ4MjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4684824?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sp3d", "html_url": "https://github.com/sp3d", "followers_url": "https://api.github.com/users/sp3d/followers", "following_url": "https://api.github.com/users/sp3d/following{/other_user}", "gists_url": "https://api.github.com/users/sp3d/gists{/gist_id}", "starred_url": "https://api.github.com/users/sp3d/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sp3d/subscriptions", "organizations_url": "https://api.github.com/users/sp3d/orgs", "repos_url": "https://api.github.com/users/sp3d/repos", "events_url": "https://api.github.com/users/sp3d/events{/privacy}", "received_events_url": "https://api.github.com/users/sp3d/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-03-18T13:38:41Z", "updated_at": "2016-06-14T01:26:40Z", "closed_at": "2016-06-14T01:26:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Compiling the following program with `rustc -g` fails an LLVM assertion:\n\n```\n#![feature(core)]\n#![crate_type = \"lib\"]\n\nextern crate core;\nuse core::raw::Repr;\n\npub struct Dst {\n    pub a: (),\n    pub b: (),\n    pub data: [u8],\n}\n\npub unsafe fn borrow(bytes: &[u8]) -> &Dst {\n    let slice = bytes.repr();\n    let dst: &Dst = std::mem::transmute((slice.data, slice.len));\n    dst\n}\n```\n\n```\n$ rustc -g crash-rustc-g.rs \nrustc: /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/include/llvm/IR/DataLayout.h:484: uint64_t llvm::StructLayout::getElementOffset(unsigned int) const: Assertion `Idx < NumElements && \"Invalid element idx!\"' failed.\n```\n\nThis is basically a minimal test-case, as removing pretty much anything (including fields a or b!) avoids the assertion. Similarly, compiling without `-g` does not produce an assertion failure.\n\nThe backtrace looks like this:\n\n```\n#0  0x00007ffff6ff44b7 in raise () from /usr/lib/libc.so.6\n#1  0x00007ffff6ff588a in abort () from /usr/lib/libc.so.6\n#2  0x00007ffff6fed41d in __assert_fail_base () from /usr/lib/libc.so.6\n#3  0x00007ffff6fed4d2 in __assert_fail () from /usr/lib/libc.so.6\n#4  0x00007ffff2fd009d in LLVMOffsetOfElement () from /usr/local/lib/librustc_llvm-4e7c5e5c.so\n#5  0x00007ffff6c84326 in iter::Map$LT$I$C$$u20$F$GT$.Iterator::next::h1347171284529675023 () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#6  0x00007ffff6c7e375 in trans::debuginfo::set_members_of_composite_type::h557c9a9bddb8036bKSE () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#7  0x00007ffff6c7d24c in trans::debuginfo::RecursiveTypeDescription$LT$$u27$tcx$GT$::finalize::hcc3c0cb5c91492bb7oE () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#8  0x00007ffff6c76fe3 in trans::debuginfo::type_metadata::h6cb0d45057c320e9U8E () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#9  0x00007ffff6c78031 in trans::debuginfo::type_metadata::h6cb0d45057c320e9U8E () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#10 0x00007ffff6c85083 in trans::debuginfo::subroutine_type_metadata::he917a06bcf81ed42u4E () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#11 0x00007ffff6c764b4 in trans::debuginfo::type_metadata::h6cb0d45057c320e9U8E () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#12 0x00007ffff6c0fb87 in trans::debuginfo::create_function_debug_context::h603196dd6899b3baGMD () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#13 0x00007ffff6b4d0e8 in trans::base::new_fn_ctxt::heff0d89eaf6a93a31Vs () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#14 0x00007ffff6c15178 in trans::base::trans_closure::h295e0a8c0302a522Rjt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#15 0x00007ffff6b28f59 in trans::base::trans_fn::h475c276dfb9092deKut () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#16 0x00007ffff6b24bb2 in trans::base::trans_item::hc022dcad9f32230fCSt () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#17 0x00007ffff6c2158d in trans::base::trans_crate::ha116a53daafe15a4fPu () from /usr/local/lib/librustc_trans-4e7c5e5c.so\n#18 0x00007ffff7afe554 in driver::phase_4_translate_to_llvm::hb0c3ed9b413b640akOa () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#19 0x00007ffff7ada144 in driver::compile_input::h56dbe0e66fe8a956Rba () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#20 0x00007ffff7b91a43 in run_compiler::hbbbe30f1ad654d0ex2b () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#21 0x00007ffff7b8f88d in thunk::F.Invoke$LT$A$C$$u20$R$GT$::invoke::h9510793753674638958 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#22 0x00007ffff7b8e911 in rt::unwind::try::try_fn::h15118916039308917284 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#23 0x00007ffff7561f59 in rust_try_inner () from /usr/local/lib/libstd-4e7c5e5c.so\n#24 0x00007ffff7561f46 in rust_try () from /usr/local/lib/libstd-4e7c5e5c.so\n#25 0x00007ffff7b8edb7 in thunk::F.Invoke$LT$A$C$$u20$R$GT$::invoke::h8595907971712275588 () from /usr/local/lib/librustc_driver-4e7c5e5c.so\n#26 0x00007ffff74df996 in sys::thread::thread_start::h9f0c06661d546448B1G () from /usr/local/lib/libstd-4e7c5e5c.so\n#27 0x00007ffff13a7374 in start_thread () from /usr/lib/libpthread.so.0\n#28 0x00007ffff70a927d in clone () from /usr/lib/libc.so.6\n```\n\nRustc version is `rustc 1.0.0-nightly (30e1f9a1c 2015-03-14) (built 2015-03-15)`.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23477/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23477/timeline", "performed_via_github_app": null, "state_reason": "completed"}