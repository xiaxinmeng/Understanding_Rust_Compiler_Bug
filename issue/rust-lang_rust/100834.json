{"url": "https://api.github.com/repos/rust-lang/rust/issues/100834", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100834/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100834/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100834/events", "html_url": "https://github.com/rust-lang/rust/issues/100834", "id": 1345394396, "node_id": "I_kwDOAAsO6M5QMRbc", "number": 100834, "title": "llvm assertion failure when trying to compile sha2 crate for skylake (with llvm+rustc debug assertions)", "user": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2022-08-21T05:54:43Z", "updated_at": "2022-09-04T07:55:52Z", "closed_at": "2022-09-04T07:55:52Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I have a `Intel(R) Core(TM) i5-7200U CPU @ 2.50GHz`, so when compiling with `-Ctarget-cpu=native` this is equivalent to `-Ctarget-cpu=skylake`.\r\n\r\nI have a rustc+llvm that has debug assertions enabled and when I try to compile `sha2 v0.10.1` this apparently hits a debug assertion inside llvm:\r\n\r\n`RUSTFLAGS=\"-Ctarget-cpu=skylake\" RUSTC=/home/matthias/vcs/github/rust_debug_assertions/build/x86_64-unknown-linux-gnu/stage1/bin/rustc cargo build --release`\r\n\r\n````\r\n   Compiling sha2 v0.10.1 (/tmp/sha)\r\nrustc: /home/matthias/vcs/github/rust_debug_assertions/src/llvm-project/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp:2556: llvm::slpvectorizer::BoUpSLP::TreeEntry *llvm::slpvectorizer::BoUpSLP::newTreeEntry(ArrayRef<llvm::Value *>, TreeEntry::EntryState, Optional<llvm::slpvectorizer::BoUpSLP::ScheduleData *>, const (anonymous namespace)::InstructionsState &, const llvm::slpvectorizer::BoUpSLP::EdgeInfo &, ArrayRef<int>, ArrayRef<unsigned int>): Assertion `!getTreeEntry(V) && \"Scalar already in tree!\"' failed.\r\nsccache: Compiler killed by signal 6\r\nerror: could not compile `sha2`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/home/matthias/.cargo/bin/sccache /home/matthias/vcs/github/rust_debug_assertions/build/x86_64-unknown-linux-gnu/stage1/bin/rustc --crate-name sha2 --edition=2018 src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C embed-bitcode=no --cfg 'feature=\"default\"' --cfg 'feature=\"std\"' -C metadata=96ac895c949c4242 -C extra-filename=-96ac895c949c4242 --out-dir /tmp/sha/target/release/deps -L dependency=/tmp/sha/target/release/deps --extern cfg_if=/tmp/sha/target/release/deps/libcfg_if-19e7cc0b6f708960.rmeta --extern cpufeatures=/tmp/sha/target/release/deps/libcpufeatures-60eedbcf432061e3.rmeta --extern digest=/tmp/sha/target/release/deps/libdigest-d6ef0fdeb4fc592a.rmeta -Ctarget-cpu=skylake` (exit status: 254)\r\n````\r\n\r\nThis rustc used is built with rustc debug assertions and llvm debug assertions and I noticed this crash during  stage 2 of `x.py build` boostrap.\r\n\r\nbootstrap was done with\r\n````toml\r\nchangelog-seen = 2\r\n[llvm]\r\ndownload-ci-llvm = false\r\nassertions = true\r\nninja = true\r\ntargets = \"X86\"\r\nlink-jobs = 2\r\n[build]\r\nextended = true\r\ntools = [\"cargo\", \"rls\", \"clippy\", \"rustfmt\", \"analysis\", \"src\"] # + \"rust-demangler\" if `profiler`\r\nlow-priority = true\r\n[install]\r\n[rust]\r\ndebug = true\r\ndebug-assertions = true\r\ndebug-assertions-std = true\r\noverflow-checks = true\r\noverflow-checks-std = true\r\ndebuginfo-level = 1\r\nbacktrace-on-ice = true\r\nverify-llvm-ir = true\r\n[target.x86_64-unknown-linux-gnu]\r\n[dist]\r\n````", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100834/timeline", "performed_via_github_app": null, "state_reason": "completed"}