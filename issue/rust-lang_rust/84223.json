{"url": "https://api.github.com/repos/rust-lang/rust/issues/84223", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84223/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84223/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84223/events", "html_url": "https://github.com/rust-lang/rust/issues/84223", "id": 859012304, "node_id": "MDU6SXNzdWU4NTkwMTIzMDQ=", "number": 84223, "title": "Tracking Issue for const-initialized thread locals", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 632886930, "node_id": "MDU6TGFiZWw2MzI4ODY5MzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-thread-locals", "name": "A-thread-locals", "color": "f7e101", "default": false, "description": "Area: Thread local storage (TLS)"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 919710011, "node_id": "MDU6TGFiZWw5MTk3MTAwMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-merge", "name": "disposition-merge", "color": "008800", "default": false, "description": "This issue / PR is in PFCP or FCP with a disposition to merge it."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 26, "created_at": "2021-04-15T15:44:28Z", "updated_at": "2023-04-20T18:59:10Z", "closed_at": "2021-12-05T03:41:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Feature gate: `#![feature(thread_local_const_init)]`\r\n\r\nThis is a tracking issue for the `const`-initialization of thread locals in the standard library added in https://github.com/rust-lang/rust/pull/83416. \r\n\r\n### Public API\r\n\r\n```rust\r\nuse std::cell::Cell;\r\nstd::thread_local!(static KEY: Cell<u32> = const { Cell::new(0) });\r\n\r\n// ... same APIs as before with thread locals\r\n```\r\n\r\nThe API here is intended to be exclusively within the syntax of the preexisting `thread_local!` macro. The initialization expression for thread local keys can now be surrounded with `const { ... }` to indicate that the value should be const-evaluated and initialized.\r\n\r\nNote that this also supports the multi-definition form:\r\n\r\n```rust\r\nuse std::cell::Cell;\r\nstd::thread_local! {\r\n    static KEY1: Cell<u32> = const { Cell::new(0) };\r\n    static KEY2: Cell<u32> = const { Cell::new(0) };\r\n}\r\n```\r\n\r\n### Steps / History\r\n\r\n- [x] Implementation: #83416\r\n- [x] Final commenting period (FCP)\r\n- [x] Stabilization PR\r\n\r\n### Unresolved Questions\r\n\r\n- Syntax bikeshed - is the use of what is likely to be a future-feature, `const` blocks, ok here? Are there other options for syntax?\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84223/reactions", "total_count": 14, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 13, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84223/timeline", "performed_via_github_app": null, "state_reason": "completed"}