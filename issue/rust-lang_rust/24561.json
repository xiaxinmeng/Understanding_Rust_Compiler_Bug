{"url": "https://api.github.com/repos/rust-lang/rust/issues/24561", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24561/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24561/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24561/events", "html_url": "https://github.com/rust-lang/rust/issues/24561", "id": 69331142, "node_id": "MDU6SXNzdWU2OTMzMTE0Mg==", "number": 24561, "title": "Name collision between extern \"C\" functions can cause undefined behavior in safe code", "user": {"login": "dgrunwald", "id": 243140, "node_id": "MDQ6VXNlcjI0MzE0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/243140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dgrunwald", "html_url": "https://github.com/dgrunwald", "followers_url": "https://api.github.com/users/dgrunwald/followers", "following_url": "https://api.github.com/users/dgrunwald/following{/other_user}", "gists_url": "https://api.github.com/users/dgrunwald/gists{/gist_id}", "starred_url": "https://api.github.com/users/dgrunwald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dgrunwald/subscriptions", "organizations_url": "https://api.github.com/users/dgrunwald/orgs", "repos_url": "https://api.github.com/users/dgrunwald/repos", "events_url": "https://api.github.com/users/dgrunwald/events{/privacy}", "received_events_url": "https://api.github.com/users/dgrunwald/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-04-18T17:38:22Z", "updated_at": "2016-03-05T21:58:12Z", "closed_at": "2016-03-05T21:58:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm generating `extern \"C\"` functions using macros. Since it's currently not possible to use `$concat_ident` for function names, I can't give these functions unique names.\n\nI was hoping for rust's name mangling to take care of the issue; but unfortunately this doesn't work if the macro is used twice in the same function. This usually results in internal compiler errors for me, but on the playpen machine it's possible to produce undefined behavior in safe code:\n\n```\nfn main() {\n    {\n        extern \"C\" fn test(a: &mut i32) {\n            println!(\"a: {:?}\", a);\n            *a = 1;\n        }\n    }\n    {\n        extern \"C\" fn test(b: &i32) {\n            println!(\"b: {:?}\", b);\n        }\n        test(&1);\n    }\n}\n```\n\nExpected output: `b: 1`\nActual output: `a: 1`\n`playpen: application terminated abnormally with signal 4 (Illegal instruction)`\n", "closed_by": {"login": "dgrunwald", "id": 243140, "node_id": "MDQ6VXNlcjI0MzE0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/243140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dgrunwald", "html_url": "https://github.com/dgrunwald", "followers_url": "https://api.github.com/users/dgrunwald/followers", "following_url": "https://api.github.com/users/dgrunwald/following{/other_user}", "gists_url": "https://api.github.com/users/dgrunwald/gists{/gist_id}", "starred_url": "https://api.github.com/users/dgrunwald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dgrunwald/subscriptions", "organizations_url": "https://api.github.com/users/dgrunwald/orgs", "repos_url": "https://api.github.com/users/dgrunwald/repos", "events_url": "https://api.github.com/users/dgrunwald/events{/privacy}", "received_events_url": "https://api.github.com/users/dgrunwald/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24561/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24561/timeline", "performed_via_github_app": null, "state_reason": "completed"}