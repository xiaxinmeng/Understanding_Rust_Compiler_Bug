{"url": "https://api.github.com/repos/rust-lang/rust/issues/84766", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84766/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84766/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84766/events", "html_url": "https://github.com/rust-lang/rust/issues/84766", "id": 873448423, "node_id": "MDU6SXNzdWU4NzM0NDg0MjM=", "number": 84766, "title": "Support building and testing std with panic=abort", "user": {"login": "tmandry", "id": 2280544, "node_id": "MDQ6VXNlcjIyODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2280544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmandry", "html_url": "https://github.com/tmandry", "followers_url": "https://api.github.com/users/tmandry/followers", "following_url": "https://api.github.com/users/tmandry/following{/other_user}", "gists_url": "https://api.github.com/users/tmandry/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmandry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmandry/subscriptions", "organizations_url": "https://api.github.com/users/tmandry/orgs", "repos_url": "https://api.github.com/users/tmandry/repos", "events_url": "https://api.github.com/users/tmandry/events{/privacy}", "received_events_url": "https://api.github.com/users/tmandry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-04-30T23:02:58Z", "updated_at": "2021-05-02T04:24:20Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`panic=abort` is needed in resource-constrained environments, wasm, and when building with the [cranelift backend](https://github.com/bjorn3/rustc_codegen_cranelift/blob/6d30315d055e92464026c2ac0d7f3ad8b02539b6/scripts/test_rustc_tests.sh#L24-L41).\r\n\r\nBuilding and testing std with `panic=abort` today is fraught for at least two reasons:\r\n\r\n1. `panic=unwind` is still needed for proc macros, so setting target-specific rustflags doesn't work if you want to do this on a host platform.\r\n2. Many tests (~80 by my count: [1], [2]) depend on unwinding, and the test framework doesn't know how to automatically disable them. Many of these are disabled for individual platforms (wasm) or dealt with externally in a somewhat brittle way.\r\n\r\n[1]: https://github.com/bjorn3/rustc_codegen_cranelift/blob/6d30315d055e92464026c2ac0d7f3ad8b02539b6/scripts/test_rustc_tests.sh#L13-L16\r\n[2]: https://github.com/bjorn3/rustc_codegen_cranelift/blob/6d30315d055e92464026c2ac0d7f3ad8b02539b6/scripts/test_rustc_tests.sh#L24-L41\r\n\r\nIn order to make this work, rustbuild should support this option directly and tests relying on unwinding need to be labelled with `needs-unwind`.\r\n\r\nGiven the number of tests this affects and the likelihood of regression, we may also want to test this configuration explicitly in CI. But the wasm builders would serve this purpose almost as well.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84766/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84766/timeline", "performed_via_github_app": null, "state_reason": null}