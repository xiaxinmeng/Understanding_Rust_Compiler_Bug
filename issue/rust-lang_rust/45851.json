{"url": "https://api.github.com/repos/rust-lang/rust/issues/45851", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45851/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45851/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45851/events", "html_url": "https://github.com/rust-lang/rust/issues/45851", "id": 272001989, "node_id": "MDU6SXNzdWUyNzIwMDE5ODk=", "number": 45851, "title": "`Read::read_to_end` time is quadratic for input over 8KB", "user": {"login": "mbrubeck", "id": 5920, "node_id": "MDQ6VXNlcjU5MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbrubeck", "html_url": "https://github.com/mbrubeck", "followers_url": "https://api.github.com/users/mbrubeck/followers", "following_url": "https://api.github.com/users/mbrubeck/following{/other_user}", "gists_url": "https://api.github.com/users/mbrubeck/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbrubeck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbrubeck/subscriptions", "organizations_url": "https://api.github.com/users/mbrubeck/orgs", "repos_url": "https://api.github.com/users/mbrubeck/repos", "events_url": "https://api.github.com/users/mbrubeck/events{/privacy}", "received_events_url": "https://api.github.com/users/mbrubeck/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-11-07T22:08:40Z", "updated_at": "2017-11-11T09:51:46Z", "closed_at": "2017-11-07T22:32:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The [default implementation of `read_to_end`][1] grows its buffer by at most `DEFAULT_BUF_SIZE` bytes (8KB) at a time.  When the input is large, this takes O(n\u00b2) time due to repeated reallocation and copying.  Calling `read_to_end` on a 100MB file with an empty buffer will resize and copy the buffer over 10,000 times.\r\n\r\nWhen the input size is known ahead of time, callers can avoid this problem by passing in a pre-allocated buffer.  It would be nice if this was not necessary in cases where the standard library could do this automatically.\r\n\r\n* `read_to_end` could be specialized to pre-reserve space for types that implement `Seek`.\r\n* Types like `File` that have other ways to determine the input size could provide their own implementations of `read_to_end`.\r\n\r\nThis still leaves potentially quadratic behavior for cases where the input size can't be determined up front. This could be fixed using exponential growth, at the cost of wasting more memory due to unused buffer space.\r\n\r\n[1]: https://github.com/rust-lang/rust/blob/7f6417e9b72de63666fd92caf1a6b96a778b60ed/src/libstd/io/mod.rs#L357", "closed_by": {"login": "mbrubeck", "id": 5920, "node_id": "MDQ6VXNlcjU5MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbrubeck", "html_url": "https://github.com/mbrubeck", "followers_url": "https://api.github.com/users/mbrubeck/followers", "following_url": "https://api.github.com/users/mbrubeck/following{/other_user}", "gists_url": "https://api.github.com/users/mbrubeck/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbrubeck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbrubeck/subscriptions", "organizations_url": "https://api.github.com/users/mbrubeck/orgs", "repos_url": "https://api.github.com/users/mbrubeck/repos", "events_url": "https://api.github.com/users/mbrubeck/events{/privacy}", "received_events_url": "https://api.github.com/users/mbrubeck/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45851/timeline", "performed_via_github_app": null, "state_reason": "completed"}