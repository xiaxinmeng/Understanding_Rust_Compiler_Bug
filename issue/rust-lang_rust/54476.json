{"url": "https://api.github.com/repos/rust-lang/rust/issues/54476", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54476/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54476/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54476/events", "html_url": "https://github.com/rust-lang/rust/issues/54476", "id": 362860014, "node_id": "MDU6SXNzdWUzNjI4NjAwMTQ=", "number": 54476, "title": "Unused import warning fires incorrectly for imports used and shadowed by decl_macro's.", "user": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-09-22T14:09:42Z", "updated_at": "2019-11-07T10:14:10Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "I wanted to demonstrate name resolution detecting maro expansion shadowing\r\n```rust\r\n#![feature(decl_macro)]\r\n\r\nmod foo {\r\n    pub macro import_bar($name:ident) {\r\n        use bar::time_travel as $name;\r\n    }\r\n}\r\n\r\nmod bar {\r\n    pub macro time_travel($name:ident) {\r\n        // The uncommented version never errors.\r\n        use foo::import_bar as $name;\r\n        // use bar::time_travel as $name;\r\n    }\r\n}\r\n\r\nuse foo::*;\r\n\r\n// Only if the invocation uses the glob import and `time_travel`\r\n// shadows it to something *different*, does it produce an error.\r\n/*foo::*/import_bar!(m2);\r\nm2!(import_bar);\r\n```\r\n\r\nHowever, while the example works as expected, \"warning: unused import: `foo::*`\" is produced, despite the import being used by the first macro invocation (and trying to remove it results in an error).\r\n\r\nThis is likely caused by us marking imports as used after expansion is finished, so the `use foo::import_bar as import_bar;` import gets marked as used, instead of `use foo::*;`.\r\n\r\nBut the macro *couldn't* have expanded without the later-shadowed glob import, so maybe expansion *should* mark the imports used to find the macro, as used, early?\r\n\r\ncc @petrochenkov @nikomatsakis ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54476/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54476/timeline", "performed_via_github_app": null, "state_reason": null}