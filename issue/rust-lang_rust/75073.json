{"url": "https://api.github.com/repos/rust-lang/rust/issues/75073", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75073/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75073/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75073/events", "html_url": "https://github.com/rust-lang/rust/issues/75073", "id": 671687475, "node_id": "MDU6SXNzdWU2NzE2ODc0NzU=", "number": 75073, "title": "building on arm64 hardware under armv7 qemu emulation want to use wrong platform", "user": {"login": "iav", "id": 325961, "node_id": "MDQ6VXNlcjMyNTk2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/325961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iav", "html_url": "https://github.com/iav", "followers_url": "https://api.github.com/users/iav/followers", "following_url": "https://api.github.com/users/iav/following{/other_user}", "gists_url": "https://api.github.com/users/iav/gists{/gist_id}", "starred_url": "https://api.github.com/users/iav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iav/subscriptions", "organizations_url": "https://api.github.com/users/iav/orgs", "repos_url": "https://api.github.com/users/iav/repos", "events_url": "https://api.github.com/users/iav/events{/privacy}", "received_events_url": "https://api.github.com/users/iav/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3940166907, "node_id": "LA_kwDOAAsO6M7q2iz7", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AArch64", "name": "O-AArch64", "color": "6e6ec0", "default": false, "description": "Armv8-A or later processors in AArch64 mode"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-02T20:50:37Z", "updated_at": "2022-03-23T02:02:32Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I use arm64 hardware to make armv7 and aarch64 platform docker containers with rust project inside.\r\nTo get armv7 on aarch64 platform used qemu emulation via docker buildx.\r\nrust 1.44 works as should. Started from 1.45 it brokes:\r\n\r\n```dockerfile\r\nFROM rust:1.45 as rust\r\nRUN USER=root cargo new app\r\nWORKDIR /app\r\nRUN mkdir -p ./src/bin && echo 'fn main() { println!(\"Dummy\") }' > ./src/bin/main.rs\r\nRUN rustc --version --verbose\r\nRUN cargo build --release --verbose\r\n```\r\nstart on aarch64: `docker buildx build --platform linux/arm/v7 --progress plain .`\r\noutput:\r\n```\r\n#6 [3/4] RUN rustc --version --verbose\r\n#6 0.293 info: syncing channel updates for '1.45.1-aarch64-unknown-linux-gnu'\r\n#6 0.960 info: latest update on 2020-07-30, rust version 1.45.1 (c367798cf 2020-07-26)\r\n#6 0.960 info: downloading component 'cargo'\r\n#6 1.456 info: downloading component 'rust-std'\r\n#6 2.915 info: downloading component 'rustc'\r\n#6 8.791 info: installing component 'cargo'\r\n#6 8.794 info: Defaulting to 500.0 MiB unpack ram\r\n#6 9.854 info: installing component 'rust-std'\r\n#6 12.12 info: installing component 'rustc'\r\n#6 22.04 error: command failed: 'rustc'\r\n#6 22.04 error: caused by: No such file or directory (os error 2)\r\n#6 ERROR: executor failed running [/bin/sh -c rustc --version --verbose]: buildkit-runc did not terminate successfully\r\n```\r\nHow it looks like for rust:1.44\r\n```\r\n#8 [5/6] RUN rustc --version --verbose\r\n#8 0.230 rustc 1.44.1 (c7087fe00 2020-06-17)\r\n#8 0.230 binary: rustc\r\n#8 0.230 commit-hash: c7087fe00d2ba919df1d813c040a5d47e43b0fe7\r\n#8 0.230 commit-date: 2020-06-17\r\n#8 0.230 host: armv7-unknown-linux-gnueabihf\r\n#8 0.230 release: 1.44.1\r\n#8 0.230 LLVM version: 9.0\r\n#8 DONE 0.3s\r\n\r\n#9 [6/6] RUN cargo build --release --verbose\r\n#9 0.330    Compiling app v0.1.0 (/app)\r\n#9 0.330      Running `rustc --crate-name app --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C opt-level=3 -C metadata=e0e87e943b5623ed -C extra-filename=-e0e87e943b5623ed --out-dir /app/target/release/deps -L dependency=/app/target/release/deps`\r\n#9 0.331      Running `rustc --crate-name main --edition=2018 src/bin/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C opt-level=3 -C metadata=198a25098b0a5694 -C extra-filename=-198a25098b0a5694 --out-dir /app/target/release/deps -L dependency=/app/target/release/deps`\r\n#9 1.785     Finished release [optimized] target(s) in 1.60s\r\n#9 DONE 2.0s\r\n```\r\n\r\nSeems rust 1.45 wrongs when tries to get a platform. 1.44 takes it correct.\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75073/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75073/timeline", "performed_via_github_app": null, "state_reason": null}