{"url": "https://api.github.com/repos/rust-lang/rust/issues/44650", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44650/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44650/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44650/events", "html_url": "https://github.com/rust-lang/rust/issues/44650", "id": 258287972, "node_id": "MDU6SXNzdWUyNTgyODc5NzI=", "number": 44650, "title": "env::args differs from MSVC CRT in some cases on Windows", "user": {"login": "SpaceManiac", "id": 222630, "node_id": "MDQ6VXNlcjIyMjYzMA==", "avatar_url": "https://avatars.githubusercontent.com/u/222630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SpaceManiac", "html_url": "https://github.com/SpaceManiac", "followers_url": "https://api.github.com/users/SpaceManiac/followers", "following_url": "https://api.github.com/users/SpaceManiac/following{/other_user}", "gists_url": "https://api.github.com/users/SpaceManiac/gists{/gist_id}", "starred_url": "https://api.github.com/users/SpaceManiac/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SpaceManiac/subscriptions", "organizations_url": "https://api.github.com/users/SpaceManiac/orgs", "repos_url": "https://api.github.com/users/SpaceManiac/repos", "events_url": "https://api.github.com/users/SpaceManiac/events{/privacy}", "received_events_url": "https://api.github.com/users/SpaceManiac/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2017-09-17T08:21:08Z", "updated_at": "2021-09-02T18:58:09Z", "closed_at": "2021-09-02T18:58:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "For a command-line of the form `\"a/\"b.exe`, where `a/b.exe` does indeed exist, `std::env::args()` produces different results than `argc` and `argv` in a C++ program. Specifically, `CommandLineToArgvW` is returning troublesome results. It looks like the CRT and CommandLineToArgvW [disagree](http://www.windowsinspired.com/how-a-windows-programs-splits-its-command-line-into-individual-arguments/).\r\n\r\n* Invocation in Command Prompt: `\"a/\"b.exe`\r\n* Expected arguments: [`a/b.exe`]\r\n* C++ main() arguments: [`a/b.exe`] \r\n* Result of GetCommandLineW: `\"a/\"b.exe`\r\n* Result of CommandLineToArgvW: [`a/`, `b.exe`]\r\n* Result of `std::env::args()`: [`a/`, `b.exe`]\r\n\r\nObviously, this interpretation makes no sense. `env::current_exe` does not seem to be affected.\r\n\r\nA Rust program which demonstrates the mismatch:\r\n```rust\r\nfn main() {\r\n    for (i, j) in std::env::args().enumerate() {\r\n        println!(\"{}: {}\", i, j);\r\n    }\r\n}\r\n```\r\n\r\nA C++ program which demonstrates the mismatch:\r\n```cpp\r\n#include <stdio.h>\r\n#include <windows.h>\r\n\r\nint main(int argc, char* argv[]) {\r\n\tprintf(\"---- argc and argv think:\\n\");\r\n\tfor (int i = 0; i < argc; ++i) {\r\n\t\tprintf(\"%i: %s\\n\", i, argv[i]);\r\n\t}\r\n\t\r\n\tprintf(\"---- GetCommandLineW is:\\n\");\r\n\tprintf(\"%ws\\n\", GetCommandLineW());\r\n\t\r\n\tprintf(\"---- CommandLineToArgvW thinks:\\n\");\r\n\tLPWSTR *szArglist;\r\n\tint nArgs;\r\n\tszArglist = CommandLineToArgvW(GetCommandLineW(), &nArgs);\r\n\tif (szArglist == NULL) {\r\n\t\twprintf(L\"CommandLineToArgvW failed\\n\");\r\n\t\treturn 0;\r\n\t}\r\n\tfor (int i = 0; i < nArgs; i++) {\r\n\t\tprintf(\"%d: %ws\\n\", i, szArglist[i]);\r\n\t}\r\n}\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44650/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44650/timeline", "performed_via_github_app": null, "state_reason": "completed"}