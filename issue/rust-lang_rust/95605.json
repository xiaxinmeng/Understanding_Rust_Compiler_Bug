{"url": "https://api.github.com/repos/rust-lang/rust/issues/95605", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/95605/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/95605/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/95605/events", "html_url": "https://github.com/rust-lang/rust/issues/95605", "id": 1190755106, "node_id": "I_kwDOAAsO6M5G-Xsi", "number": 95605, "title": "Odd macro expansion errors with nested macros", "user": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2413861294, "node_id": "MDU6TGFiZWwyNDEzODYxMjk0", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-untriaged", "name": "regression-untriaged", "color": "e4008a", "default": false, "description": "Untriaged performance or correctness regression."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-02T22:33:32Z", "updated_at": "2023-01-06T11:57:32Z", "closed_at": "2022-04-03T01:28:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\r\n\r\nI apologize that I can't get a full MCVE going at the moment.\r\nThe macro is defined in [`calypso_diagnostic/src/types.rs`](https://github.com/calypso-lang/calypso/blob/main/libs/calypso_diagnostic/src/types.rs) and used in [`calypso_parsing/src/lexer.rs`](https://github.com/calypso-lang/calypso/blob/main/libs/calypso_parsing/src/lexer.rs#L276=). I originally thought this was related to #52234 after testing in the playground, but I'm not sure anymore as I've tried some workarounds that worked in the playground that did not work here, and did not change anything about the odd behaviour of rustc here.\r\n\r\nI expected to see this happen: The program builds\r\n\r\nInstead, this happened:\r\n```\r\n error: no rules expected the token `E0001`\r\n   --> libs/calypso_parsing/src/lexer.rs:276:55\r\n    |\r\n276 | ...                   b.code(\"E0001\").short(err!(E0001)).label(\r\n    |                                             ^^^^^^^^^^^ no rules expected this token in macro call\r\n    |\r\n    = note: this error originates in the macro `err` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: no rules expected the token `E0001`\r\n   --> libs/calypso_parsing/src/lexer.rs:308:51\r\n    |\r\n308 | ...                   b.code(\"E0001\").short(err!(E0001)).label(\r\n    |                                             ^^^^^^^^^^^ no rules expected this token in macro call\r\n    |\r\n    = note: this error originates in the macro `err` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: could not compile `calypso_parsing` due to 2 previous errors\r\n```\r\n\r\n### Version it worked on\r\n\r\nIt most recently worked on: 1.59.0\r\n\r\n### Version with regression\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.61.0-nightly (eb82facb1 2022-04-01)\r\nbinary: rustc\r\ncommit-hash: eb82facb1626166188d49599a3313fc95201f556\r\ncommit-date: 2022-04-01\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.61.0-nightly\r\nLLVM version: 14.0.0\r\n```\r\n\r\n@rustbot modify labels: +regression-from-stable-to-nightly +E-needs-mcve +E-needs-bisection", "closed_by": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/95605/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/95605/timeline", "performed_via_github_app": null, "state_reason": "completed"}