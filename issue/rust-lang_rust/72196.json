{"url": "https://api.github.com/repos/rust-lang/rust/issues/72196", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/72196/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/72196/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/72196/events", "html_url": "https://github.com/rust-lang/rust/issues/72196", "id": 618263169, "node_id": "MDU6SXNzdWU2MTgyNjMxNjk=", "number": 72196, "title": "rustup update causes clion debugging to fail", "user": {"login": "nixomose", "id": 13739626, "node_id": "MDQ6VXNlcjEzNzM5NjI2", "avatar_url": "https://avatars.githubusercontent.com/u/13739626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nixomose", "html_url": "https://github.com/nixomose", "followers_url": "https://api.github.com/users/nixomose/followers", "following_url": "https://api.github.com/users/nixomose/following{/other_user}", "gists_url": "https://api.github.com/users/nixomose/gists{/gist_id}", "starred_url": "https://api.github.com/users/nixomose/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nixomose/subscriptions", "organizations_url": "https://api.github.com/users/nixomose/orgs", "repos_url": "https://api.github.com/users/nixomose/repos", "events_url": "https://api.github.com/users/nixomose/events{/privacy}", "received_events_url": "https://api.github.com/users/nixomose/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-05-14T14:09:56Z", "updated_at": "2021-04-17T08:06:49Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nA guy I was working with told me that there were new rustfmt features available in stable, and it was my task to reformat the code in our project so I did rustup update and it updated from 1.40.0 which is what I had to 1.43.1\r\nthe fmt features weren't there \"fn_params_layout\" doesn't work apparently in 1.40.0 it's called \"fn_args_layout\" but what we were looking for was \"fn_call_width\" which according to this:  https://rust-lang.github.io/rustfmt/ is an option, but it doesn't work.\r\n\r\nSo anyway, I gave up and went back to debugging a problem I was working on.\r\nI use clion with the latest rust plugin, but now when I try to run in the debugger, I get \r\n\r\n/home/smark/git/xxx/target/debug/yyy\r\n/home/smark/git/xxx/target/debug/yyy: relocation error: /home/smark/git/xxx/target/debug/yyy: symbol \ufffdtH\ufffdH;\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdH\ufffd\ufffd\ufffdf.\ufffd version OPENSSL_1_1_0 not defined in file libcrypto.so.1.1 with link time referenceProcess finished with exit code 127\r\n\r\nif I run the program from the command line it works, and if I run it from gdb, it works, it only fails, when I try and run it from the debugger in clion.\r\n\r\nThere are two other debugging options gdb in /usr/bin and lldb.\r\nso I tried them both.\r\nmy local gdb yielded the same result as the bundled gdb which was the default option.\r\n\r\nbut lldb gave me a more interesting error.\r\n\r\n/home/smark/git/xxx/target/debug/yyy\r\nInconsistency detected by ld.so: rtld.c: 1266: dl_main: Assertion `GL(dl_rtld_map).l_libname' failed!\r\n\r\nThat didn't help me any, but it convinced me that something was wrong with the build.\r\nAlthough again it still runs from the command line, but then I figured the environment the debugger runs in must be different than the environment that my shell has.\r\nI couldn't find too much in the way of configurability with the debugger in clion, there's a place to set environment variables, so I tried setting LD_LIBRARY_PATH to where the libssl libraries are that the first error message was complaining about, but that didn't help.\r\n\r\nThen I figured maybe I'd get rid of libssl 1.1 and just use 1.0 and after shuffling the packages, no change same error.\r\n\r\nI googled a bunch, nobody had this problem with rust but me. There are other reports of that problem with other packages and the solution always seems to be rebuild with this or that switch.\r\nI can't really rebuild rust, it's not my job. I'm just trying to debug my rust program.\r\n\r\nThen what happened, trying to remember, it was a long day yesterday first with the formatting options then the debugger problem.\r\nOh yeah, so the formatter thing, I tried to set width_heuristics, but it wanted  a structure. after a bunch of trial and error I was able to create the structure it wanted in the rustfmt.toml file and then when I finally got it all right it said something like \"this is a nightly feature only\". so that was a dead end too.\r\n\r\nBut again, I gave up on that formatting thing, back to the debugger problem.\r\n\r\nSo after a while it finally occurred to me that the only other thing I did was the rustup update, maybe that had something to do with it.\r\n\r\nSo I tried to figure out what version of rustup I had before updating. if it printed it out, I didn't see it or recall it and that shell was gone.\r\n\r\nBut I run zfs for my filesystem, and I have it take a snapshot of my filesystem every minute so I can go back in time and see what happened.\r\nSo I sifted back to the beginning of the day when I was able to use the debugger and tried to figure out what version of cargo and rustc and rustup I had.\r\nI found the binaries in .cargo/bin, but while they're all the same size, and copies of the same file, they're not actually hardlinks. I didn't quite understand that. But whatever.\r\nso I went to my early morning snapshot ran ./rustup --version and it said 1.43.1 which was the latest that rustup had updated to. I thought that odd, so I went back further in time and kept getting the same thing.\r\n\r\nit seems that something about the binary when it loads must look in the environment and run or link in the current binary because it kept getting me the current version not the one I was actually running.\r\nmaybe that's a weird side effect of rust and zfs snapshots, I dunno.\r\n\r\nEventually I got the idea to just run strings on the binary, and then I was able to tell that the version of rustup I had that morning was 1.40.0\r\n\r\nso I ran rustup default 1.40.0, rebuilt everything and then my debugger worked.\r\n\r\nI told my boss this story and he said \r\n\r\n\"I'd file a bug w/them, and describe what you're seeing... curious to see how quickly they respond to this\"\r\n\r\nSo here I am.\r\n\r\nAnother glaring piece of information I came across was this:\r\nhttps://github.com/rust-lang/rust/blob/master/RELEASES.md\r\nthe first very line says \r\n\r\n\"Updated openssl-src to 1.1.1g for CVE-2020-1967.\"\r\n\r\nboy if that doesn't look incriminating.\r\n\r\nI had tried to downgrade to 1.43.0 but that didn't work either, but I admit I might have messed up the install. this event had been going on for quite a while at this point.\r\n\r\nI figured 1.40.0 had worked that morning, I'd go back to what I had, and that did, indeed fix it.\r\n\r\nSo there's my bug report.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nI expected to see this happen: *explanation*\r\n\r\nInstead, this happened: *explanation*\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nI found a workaround, that's good enough for now.\r\n\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.40.0 (73528e339 2019-12-16)\r\nbinary: rustc\r\ncommit-hash: 73528e339aae0f17a15ffa49a8ac608f50c6cf14\r\ncommit-date: 2019-12-16\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.40.0\r\nLLVM version: 9.0\r\n\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nthere is no backtrace, there is only the error message above, I'll repeat it here:\r\n\r\n/home/smark/git/xxx/target/debug/yyy: relocation error: /home/smark/git/xxx/target/debug/yyy: symbol \ufffdtH\ufffdH;\ufffd\ufffd\ufffd\ufffd\ufffd\ufffdH\ufffd\ufffd\ufffdf.\ufffd version OPENSSL_1_1_0 not defined in file libcrypto.so.1.1 with link time referenceProcess finished with exit code 127\r\n\r\n\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/72196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/72196/timeline", "performed_via_github_app": null, "state_reason": null}