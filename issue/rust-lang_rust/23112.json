{"url": "https://api.github.com/repos/rust-lang/rust/issues/23112", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23112/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23112/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23112/events", "html_url": "https://github.com/rust-lang/rust/issues/23112", "id": 60091608, "node_id": "MDU6SXNzdWU2MDA5MTYwOA==", "number": 23112, "title": "struct order of eval is (still) not well", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-03-06T11:38:57Z", "updated_at": "2015-03-10T14:50:43Z", "closed_at": "2015-03-10T14:50:43Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Executive summary:\n\nThis code fails in its assertion:\n\n``` rust\nstruct S { f0: String, _f1: u32 }\n\npub fn main() {\n    const HI: &'static str = \"Hello, world!\";\n    let s = HI.to_string();\n    let s = S {\n        f0: s.to_string(),\n        ..S {\n            f0: s,\n            _f1: 23\n        }\n    };\n    assert_eq!(HI, s.f0);\n}\n\n```\n\n[playpen link](http://is.gd/fM4fSf)\n\n---\n\nLonger fun story:\n\nYou might think from our test suite that struct literal order of evaluation is being tested.\n\nE.g. there are the two tests:\n- https://github.com/rust-lang/rust/blob/master/src/test/run-pass/struct-order-of-eval-1.rs\n- https://github.com/rust-lang/rust/blob/master/src/test/run-pass/struct-order-of-eval-2.rs\n\nHowever, misbehavior I witnessed on my filling-drop work (namely, `usize` overflows, which I believe were signaled solely due to the recently landed arithmetic overflow work) led me to investigate these tests more closely.\n\nNeither of them have `assert!` nor `assert_eq!` calls!\n\nSo essentially all we are testing in these two tests is that \n1. the borrow checker does not complain, and\n2. the resulting code does not segfault at runtime!\n\nI.e., Very weak testing!  (And also, totally bogus dynamic semantics.)\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23112/timeline", "performed_via_github_app": null, "state_reason": "completed"}