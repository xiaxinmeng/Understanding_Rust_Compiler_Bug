{"url": "https://api.github.com/repos/rust-lang/rust/issues/53670", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53670/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53670/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53670/events", "html_url": "https://github.com/rust-lang/rust/issues/53670", "id": 353782503, "node_id": "MDU6SXNzdWUzNTM3ODI1MDM=", "number": 53670, "title": "Fabricate hangs while building rust for raspbian on arm64 host.", "user": {"login": "plugwash", "id": 3199425, "node_id": "MDQ6VXNlcjMxOTk0MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/3199425?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plugwash", "html_url": "https://github.com/plugwash", "followers_url": "https://api.github.com/users/plugwash/followers", "following_url": "https://api.github.com/users/plugwash/following{/other_user}", "gists_url": "https://api.github.com/users/plugwash/gists{/gist_id}", "starred_url": "https://api.github.com/users/plugwash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plugwash/subscriptions", "organizations_url": "https://api.github.com/users/plugwash/orgs", "repos_url": "https://api.github.com/users/plugwash/repos", "events_url": "https://api.github.com/users/plugwash/events{/privacy}", "received_events_url": "https://api.github.com/users/plugwash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 3940166907, "node_id": "LA_kwDOAAsO6M7q2iz7", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AArch64", "name": "O-AArch64", "color": "6e6ec0", "default": false, "description": "Armv8-A or later processors in AArch64 mode"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-08-24T13:24:17Z", "updated_at": "2022-08-17T06:23:11Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "We do a lot of package builds for raspbian in a raspbian chroot in a debian armhf container on an arm64 host, we use this host because it's fast.\r\n\r\nUnfortunately recent versions of rustc can no longer be built in this environment, a program called \"fabricate\" hangs with 200% CPU usage. IIRC this has been happening since 1.25, currently I am building 1.27 with 1.26 (I will try again with 1.28 once I have 1.27 built).\r\n\r\nrunning: \"/<<BUILDDIR>>/rustc-1.27.2+dfsg1/build/arm-unknown-linux-gnueabihf/stage0-tools-bin/fabricate\" \"generate\" \"--product-name=Rust-Documentation\" \"--rel-manifest-dir=rustlib\" \"--success-message=Rust-documentation-is-installed.\" \"--image-dir\" \"/<<BUILDDIR>>/rustc-1.27.2+dfsg1/build/tmp/dist/rust-docs-1.27.2-arm-unknown-linux-gnueabihf-image\" \"--work-dir\" \"/<<BUILDDIR>>/rustc-1.27.2+dfsg1/build/tmp/dist\" \"--output-dir\" \"/<<BUILDDIR>>/rustc-1.27.2+dfsg1/build/dist\" \"--package-name=rust-docs-1.27.2-arm-unknown-linux-gnueabihf\" \"--component-name=rust-docs\" \"--legacy-manifest-dirs=rustlib,cargo\" \"--bulk-dirs=share/doc/rust/html\"\r\n\r\n(the <<BUILDDIR>> shown in the log is a substitution made by a build log filter, the actual command has the real paths in it).\r\n\r\nAttempts to debug/workaround this issue on the box in question have failed, my only soloution so-far has been to do the rust builds on a different box (which works but is a pain with my workflow).\r\n\r\nTo help me debug I would appreciate answers to the following questions.\r\n\r\n1. What is fabricate and where can I find documentation for it? googling for \"rust fabricate\" or even \"rust language fabricate\" has proved futile.\r\n2. How can I run commands from the rust build process outside the build process (e.g. in a debugger),  in my experiance trying to re-run the commands shown by the build process inevitablly results in unrelated errors. Are there special environment variables in-play? if so how do I find out what those environment variables should be.\r\n3. Is there a way to disable paralellism in fabricate?\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53670/timeline", "performed_via_github_app": null, "state_reason": null}