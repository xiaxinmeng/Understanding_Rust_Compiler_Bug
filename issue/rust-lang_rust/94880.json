{"url": "https://api.github.com/repos/rust-lang/rust/issues/94880", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94880/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94880/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94880/events", "html_url": "https://github.com/rust-lang/rust/issues/94880", "id": 1167278712, "node_id": "I_kwDOAAsO6M5Fk0J4", "number": 94880, "title": "1+1=2 causing attempt to add with overflow error on datatype usize", "user": {"login": "arnabanimesh", "id": 6032584, "node_id": "MDQ6VXNlcjYwMzI1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6032584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arnabanimesh", "html_url": "https://github.com/arnabanimesh", "followers_url": "https://api.github.com/users/arnabanimesh/followers", "following_url": "https://api.github.com/users/arnabanimesh/following{/other_user}", "gists_url": "https://api.github.com/users/arnabanimesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/arnabanimesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arnabanimesh/subscriptions", "organizations_url": "https://api.github.com/users/arnabanimesh/orgs", "repos_url": "https://api.github.com/users/arnabanimesh/repos", "events_url": "https://api.github.com/users/arnabanimesh/events{/privacy}", "received_events_url": "https://api.github.com/users/arnabanimesh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-03-12T12:43:41Z", "updated_at": "2022-03-12T16:46:09Z", "closed_at": "2022-03-12T16:46:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\n\r\n```Rust\r\n/* Code is too big, I have posted in the github repo (https://github.com/arnabanimesh/percolation)\r\nThe project structure goes like this:\r\npercolation (lib) (dependent on weightedunionfind)\r\n |\r\n |-weightedunionfind (lib)\r\n |\r\n |-percolationstats (lib) (dependent on percolation)\r\n*/\r\n// Error is coming when I am running unit tests in percolationstats lib\r\n#[cfg(test)]\r\nmod tests {\r\n    use crate::PercolationStats;\r\n    #[test]\r\n    fn percolationstats_works() {\r\n        let ps = PercolationStats::new(100, 60);\r\n        println!(\"mean = {}\", ps.mean());\r\n        println!(\"stddev = {}\", ps.stddev());\r\n        println!(\r\n            \"95% confidence interval = [{}, {}]\",\r\n            ps.confidence_lo(),\r\n            ps.confidence_hi()\r\n        );\r\n        assert!(ps.mean() == 1.);\r\n    }\r\n}\r\n// This is the code in weightedunionfind processed by the compiler before throwing the error\r\n// I created some unnecessary variables to assist in debugging\r\n    #[allow(unused_variables)]\r\n    pub fn union(&mut self, node1: usize, node2: usize) {\r\n        let root1 = self.find(node1);\r\n        let root2 = self.find(node2);\r\n        let size1 = self.size[root1];\r\n        let size2 = self.size[root2];\r\n        let sizesum = size1 + size2;\r\n        let max = usize::MAX;\r\n        if size1 < size2 {\r\n            self.parent[root1] = root2;\r\n            self.size[root2] = sizesum;\r\n        } else {\r\n            let size3 = format!(\"{}\", sizesum);\r\n            self.parent[root2] = root1;\r\n            self.size[root1] = sizesum;\r\n        }\r\n        self.count -= 1;\r\n    }\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.59.0 (9d1b2106e 2022-02-23)\r\nbinary: rustc\r\ncommit-hash: 9d1b2106e23b1abd32fce1f17267604a5102f57a\r\ncommit-date: 2022-02-23\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.59.0\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nthread 'tests::percolationstats_works' panicked at 'attempt to add with overflow'\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n---- tests::percolationstats_works stdout ----\r\nthread 'tests::percolationstats_works' panicked at 'attempt to add with overflow', C:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\weightedquickunion\\src\\lib.rs:37:23\r\nstack backtrace:\r\n   0: std::panicking::begin_panic_handler\r\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\\/library\\std\\src\\panicking.rs:498\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\\/library\\core\\src\\panicking.rs:116\r\n   2: core::panicking::panic\r\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\\/library\\core\\src\\panicking.rs:48\r\n   3: weightedquickunion::WeightedQuickUnionUF::union\r\n             at C:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\weightedquickunion\\src\\lib.rs:37\r\n   4: percolation::Percolation::connect\r\n             at C:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\src\\lib.rs:40\r\n   5: percolation::Percolation::open\r\n             at C:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\src\\lib.rs:60\r\n   6: percolationstats::PercolationStats::new\r\n             at .\\src\\lib.rs:22\r\n   7: percolationstats::tests::percolationstats_works\r\n             at .\\src\\lib.rs:60\r\n   8: percolationstats::tests::percolationstats_works::closure$0\r\n             at .\\src\\lib.rs:59\r\n   9: core::ops::function::FnOnce::call_once<percolationstats::tests::percolationstats_works::closure$0,tuple$<> >\r\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:227\r\n  10: core::ops::function::FnOnce::call_once\r\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:227\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n\r\nfailures:\r\n    tests::percolationstats_works\r\n\r\ntest result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.08s\r\n\r\nerror: test failed, to rerun pass '--lib'\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>VSCode debugger main thread callstack</strong></summary>\r\n<p>\r\n\r\n```\r\nntdll.dll!00007fff4f4c72a4() (Unknown Source:0)\r\nntdll.dll!00007fff4f43d7ed() (Unknown Source:0)\r\nntdll.dll!00007fff4f47b0be() (Unknown Source:0)\r\nntdll.dll!00007fff4f47b003() (Unknown Source:0)\r\nKernelBase.dll!00007fff4cb2d4af() (Unknown Source:0)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!std::sys::windows::thread_parker::Parker::park_timeout() Line 145 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sys\\windows\\thread_parker.rs:145)\r\npercolationstats-c7cea238c81caca5.exe!std::thread::park_timeout() Line 965 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\thread\\mod.rs:965)\r\npercolationstats-c7cea238c81caca5.exe!std::sync::mpsc::blocking::WaitToken::wait_max_until() Line 74 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sync\\mpsc\\blocking.rs:74)\r\npercolationstats-c7cea238c81caca5.exe!std::sync::mpsc::shared::Packet::recv<test::event::CompletedTest>() Line 230 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sync\\mpsc\\shared.rs:230)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!std::sync::mpsc::Receiver::recv_deadline() Line 1358 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sync\\mpsc\\mod.rs:1358)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!std::sync::mpsc::Receiver::recv_timeout() Line 1277 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sync\\mpsc\\mod.rs:1277)\r\npercolationstats-c7cea238c81caca5.exe!test::run_tests<test::console::run_tests_console::closure$2>() Line 337 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\test\\src\\lib.rs:337)\r\npercolationstats-c7cea238c81caca5.exe!test::console::run_tests_console() Line 290 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\test\\src\\console.rs:290)\r\npercolationstats-c7cea238c81caca5.exe!test::test_main() Line 115 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\test\\src\\lib.rs:115)\r\npercolationstats-c7cea238c81caca5.exe!test::test_main_static() Line 135 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\test\\src\\lib.rs:135)\r\npercolationstats-c7cea238c81caca5.exe!percolationstats::main() Line 1 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\percolationstats\\src\\lib.rs:1)\r\npercolationstats-c7cea238c81caca5.exe!core::ops::function::FnOnce::call_once<void (*)(),tuple$<>>(void(*)()) Line 227 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:227)\r\npercolationstats-c7cea238c81caca5.exe!std::sys_common::backtrace::__rust_begin_short_backtrace<void (*)(),tuple$<>>(void(*)() f) Line 126 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sys_common\\backtrace.rs:126)\r\npercolationstats-c7cea238c81caca5.exe!std::rt::lang_start::closure$0<tuple$<>>(std::rt::lang_start::closure$0 *) Line 145 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\rt.rs:145)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!core::ops::function::impls::impl$2::call_once() Line 259 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:259)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>VSCode debugger tests::percolationstats_works call stack</strong></summary>\r\n<p>\r\n\r\n```\r\nKernelBase.dll!00007fff4cb1478c() (Unknown Source:0)\r\nvcruntime140.dll!00007fff216564c0() (Unknown Source:0)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!panic_unwind::real_imp::panic() Line 313 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\panic_unwind\\src\\seh.rs:313)\r\npercolationstats-c7cea238c81caca5.exe!panic_unwind::__rust_start_panic() Line 104 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\panic_unwind\\src\\lib.rs:104)\r\npercolationstats-c7cea238c81caca5.exe!std::panicking::rust_panic() Line 654 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\panicking.rs:654)\r\npercolationstats-c7cea238c81caca5.exe!std::panicking::rust_panic_with_hook() Line 624 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\panicking.rs:624)\r\npercolationstats-c7cea238c81caca5.exe!std::panicking::begin_panic_handler::closure$0() Line 500 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\panicking.rs:500)\r\npercolationstats-c7cea238c81caca5.exe!std::sys_common::backtrace::__rust_end_short_backtrace<std::panicking::begin_panic_handler::closure$0,never$>() Line 139 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\sys_common\\backtrace.rs:139)\r\npercolationstats-c7cea238c81caca5.exe!std::panicking::begin_panic_handler() Line 498 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\std\\src\\panicking.rs:498)\r\npercolationstats-c7cea238c81caca5.exe!core::panicking::panic_fmt() Line 116 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\panicking.rs:116)\r\npercolationstats-c7cea238c81caca5.exe!core::panicking::panic() Line 48 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\panicking.rs:48)\r\npercolationstats-c7cea238c81caca5.exe!weightedquickunion::WeightedQuickUnionUF::union(unsigned __int64 self, unsigned __int64 node1) Line 37 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\weightedquickunion\\src\\lib.rs:37)\r\npercolationstats-c7cea238c81caca5.exe!percolation::Percolation::connect(unsigned __int64 self, unsigned __int64 idx) Line 41 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\src\\lib.rs:41)\r\npercolationstats-c7cea238c81caca5.exe!percolation::Percolation::open(unsigned __int64 self, unsigned __int64 row) Line 54 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\src\\lib.rs:54)\r\npercolationstats-c7cea238c81caca5.exe!percolationstats::PercolationStats::new(unsigned __int64 n, unsigned __int64 trials) Line 22 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\percolationstats\\src\\lib.rs:22)\r\npercolationstats-c7cea238c81caca5.exe!percolationstats::tests::percolationstats_works() Line 60 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\percolationstats\\src\\lib.rs:60)\r\npercolationstats-c7cea238c81caca5.exe!percolationstats::tests::percolationstats_works::closure$0(percolationstats::tests::percolationstats_works::closure$0 *) Line 59 (c:\\Users\\arnab\\Documents\\coding\\self\\rust\\princeton-rs\\dsa\\Part 1\\Week 1\\percolation\\percolationstats\\src\\lib.rs:59)\r\npercolationstats-c7cea238c81caca5.exe!core::ops::function::FnOnce::call_once<percolationstats::tests::percolationstats_works::closure$0,tuple$<>>(percolationstats::tests::percolationstats_works::closure$0) Line 227 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:227)\r\n[Inline Frame] percolationstats-c7cea238c81caca5.exe!core::ops::function::FnOnce::call_once() Line 227 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\core\\src\\ops\\function.rs:227)\r\npercolationstats-c7cea238c81caca5.exe!test::__rust_begin_short_backtrace<void (*)()>() Line 578 (c:\\rustc\\9d1b2106e23b1abd32fce1f17267604a5102f57a\\library\\test\\src\\lib.rs:578)\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "arnabanimesh", "id": 6032584, "node_id": "MDQ6VXNlcjYwMzI1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6032584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arnabanimesh", "html_url": "https://github.com/arnabanimesh", "followers_url": "https://api.github.com/users/arnabanimesh/followers", "following_url": "https://api.github.com/users/arnabanimesh/following{/other_user}", "gists_url": "https://api.github.com/users/arnabanimesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/arnabanimesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arnabanimesh/subscriptions", "organizations_url": "https://api.github.com/users/arnabanimesh/orgs", "repos_url": "https://api.github.com/users/arnabanimesh/repos", "events_url": "https://api.github.com/users/arnabanimesh/events{/privacy}", "received_events_url": "https://api.github.com/users/arnabanimesh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94880/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94880/timeline", "performed_via_github_app": null, "state_reason": "completed"}