{"url": "https://api.github.com/repos/rust-lang/rust/issues/88247", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/88247/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/88247/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/88247/events", "html_url": "https://github.com/rust-lang/rust/issues/88247", "id": 976585830, "node_id": "MDU6SXNzdWU5NzY1ODU4MzA=", "number": 88247, "title": "Weird ICE on edge-case input on stable", "user": {"login": "kawaemon", "id": 34652535, "node_id": "MDQ6VXNlcjM0NjUyNTM1", "avatar_url": "https://avatars.githubusercontent.com/u/34652535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kawaemon", "html_url": "https://github.com/kawaemon", "followers_url": "https://api.github.com/users/kawaemon/followers", "following_url": "https://api.github.com/users/kawaemon/following{/other_user}", "gists_url": "https://api.github.com/users/kawaemon/gists{/gist_id}", "starred_url": "https://api.github.com/users/kawaemon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kawaemon/subscriptions", "organizations_url": "https://api.github.com/users/kawaemon/orgs", "repos_url": "https://api.github.com/users/kawaemon/repos", "events_url": "https://api.github.com/users/kawaemon/events{/privacy}", "received_events_url": "https://api.github.com/users/kawaemon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-08-23T03:25:48Z", "updated_at": "2021-09-16T12:27:00Z", "closed_at": "2021-09-16T12:27:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\n\r\nFor more context, please read [this repository](https://github.com/kawaemon/unexpected_ice) because it depends on another file.\r\n\r\nWe investigated for some time, and we found that this ICE also depends on length of path of working directory.\r\nWe reproduced with length of 32 and 48.\r\n\r\n```Rust\r\nfn main() {\r\n    println!(include_str!(\"123456789123456\"));\r\n\r\n    let token = std::env::var(\"\").expect(\"\");\r\n\r\n    Client::builder(token)\r\n        .event_handler(DiscordEventHandler)\r\n        .expect(\"                                  \u30a2\");\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nWe couldn't reproduce on `rustc 1.56.0-nightly (af140757b 2021-08-22)`.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.54.0 (a178d0322 2021-07-26)\r\nbinary: rustc\r\ncommit-hash: a178d0322ce20e33eac124758e837cbd80a6f633\r\ncommit-date: 2021-07-26\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.54.0\r\nLLVM version: 12.0.1\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nthread 'rustc' panicked at 'assertion failed: bpos.to_u32() >= mbc.pos.to_u32() + mbc.bytes as u32', compiler/rustc_span/src/lib.rs:1575:17\r\n\r\n<backtrace>\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.54.0 (a178d0322 2021-07-26) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C linker=/usr/bin/clang -C incremental -C link-arg=-fuse-ld=lld --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:515:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/panicking.rs:92:14\r\n   2: core::panicking::panic\r\n             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/panicking.rs:50:5\r\n   3: rustc_span::SourceFile::lookup_file_pos\r\n   4: rustc_span::SourceFile::lookup_file_pos_with_col_display\r\n   5: rustc_span::source_map::SourceMap::lookup_char_pos\r\n   6: rustc_errors::emitter::EmitterWriter::get_multispan_max_line_num\r\n   7: <rustc_errors::emitter::EmitterWriter as rustc_errors::emitter::Emitter>::emit_diagnostic\r\n   8: rustc_errors::json::Diagnostic::from_errors_diagnostic\r\n   9: <rustc_errors::json::JsonEmitter as rustc_errors::emitter::Emitter>::emit_diagnostic\r\n  10: rustc_errors::HandlerInner::emit_diagnostic\r\n  11: rustc_errors::diagnostic_builder::DiagnosticBuilder::emit\r\n  12: rustc_builtin_macros::format::expand_preparsed_format_args\r\n  13: rustc_builtin_macros::format::expand_format_args_impl\r\n  14: rustc_expand::expand::MacroExpander::fully_expand_fragment\r\n  15: rustc_expand::expand::MacroExpander::expand_crate\r\n  16: rustc_session::utils::<impl rustc_session::session::Session>::time\r\n  17: rustc_interface::passes::configure_and_expand_inner\r\n  18: rustc_interface::passes::boxed_resolver::BoxedResolver::new\r\n  19: rustc_interface::queries::Queries::expansion\r\n  20: rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter\r\n  21: rustc_span::with_source_map\r\n  22: rustc_interface::interface::create_compiler_and_run\r\n  23: scoped_tls::ScopedKey<T>::set\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "kawaemon", "id": 34652535, "node_id": "MDQ6VXNlcjM0NjUyNTM1", "avatar_url": "https://avatars.githubusercontent.com/u/34652535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kawaemon", "html_url": "https://github.com/kawaemon", "followers_url": "https://api.github.com/users/kawaemon/followers", "following_url": "https://api.github.com/users/kawaemon/following{/other_user}", "gists_url": "https://api.github.com/users/kawaemon/gists{/gist_id}", "starred_url": "https://api.github.com/users/kawaemon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kawaemon/subscriptions", "organizations_url": "https://api.github.com/users/kawaemon/orgs", "repos_url": "https://api.github.com/users/kawaemon/repos", "events_url": "https://api.github.com/users/kawaemon/events{/privacy}", "received_events_url": "https://api.github.com/users/kawaemon/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/88247/reactions", "total_count": 11, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 4, "eyes": 4}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/88247/timeline", "performed_via_github_app": null, "state_reason": "completed"}