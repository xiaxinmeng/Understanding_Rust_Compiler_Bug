{"url": "https://api.github.com/repos/rust-lang/rust/issues/69721", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69721/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69721/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69721/events", "html_url": "https://github.com/rust-lang/rust/issues/69721", "id": 575884368, "node_id": "MDU6SXNzdWU1NzU4ODQzNjg=", "number": 69721, "title": "potential memory leak in backtrace", "user": {"login": "mimoo", "id": 1316043, "node_id": "MDQ6VXNlcjEzMTYwNDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1316043?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mimoo", "html_url": "https://github.com/mimoo", "followers_url": "https://api.github.com/users/mimoo/followers", "following_url": "https://api.github.com/users/mimoo/following{/other_user}", "gists_url": "https://api.github.com/users/mimoo/gists{/gist_id}", "starred_url": "https://api.github.com/users/mimoo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mimoo/subscriptions", "organizations_url": "https://api.github.com/users/mimoo/orgs", "repos_url": "https://api.github.com/users/mimoo/repos", "events_url": "https://api.github.com/users/mimoo/events{/privacy}", "received_events_url": "https://api.github.com/users/mimoo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-03-04T23:41:49Z", "updated_at": "2020-03-05T14:30:28Z", "closed_at": "2020-03-05T14:30:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Yellow!\r\n\r\nI've been investigating a memory leak that we found via LeakSanitizer. The thing looked like this:\r\n\r\n<details>\r\n<summary>click here</summary>\r\n<pre><code>==86445==ERROR: LeakSanitizer: detected memory leaks\r\n\r\nDirect leak of 2853 byte(s) in 80 object(s) allocated from:\r\n    #0 0x559896d2b9ed in malloc /rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3\r\n    #1 0x5598ae1c0ef2 in __rdos_backtrace_alloc (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70fef2)\r\n    #2 0x5598ae1c5e36 in read_line_info (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e714e36)\r\n    #3 0x5598ae1c4df0 in dwarf_lookup_pc (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e713df0)\r\n    #4 0x5598ae1c2cdf in dwarf_fileline (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e711cdf)\r\n    #5 0x5598ae1bc506 in backtrace::symbolize::libbacktrace::syminfo_cb::h4645a25390a5567b /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/libbacktrace.rs:189:8\r\n    #6 0x5598ae1bf20b in elf_syminfo (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e20b)\r\n    #7 0x5598ae1bcb82 in __rdos_backtrace_syminfo (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bb82)\r\n    #8 0x5598ae1bc6ab in backtrace::symbolize::libbacktrace::resolve::hef1bf34e465712ca /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/libbacktrace.rs:469:8\r\n    #9 0x5598ae188861 in backtrace::symbolize::resolve_frame_unsynchronized::h64576c15b6f0d017 /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/mod.rs:178:4\r\n    #10 0x5598ae188861 in std::backtrace::Capture::resolve::h12b3b1574c5326e4 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:397:16\r\n    #11 0x5598ae188861 in _$LT$std..backtrace..Backtrace$u20$as$u20$core..fmt..Display$GT$::fmt::h9238db13fc40cf16 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:339:8\r\n    #12 0x5598ac3feb1c in _$LT$$RF$T$u20$as$u20$core..fmt..Display$GT$::fmt::h9b038eb6aa0ab6ad /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #13 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #14 0x5598ac3f2385 in core::fmt::Write::write_fmt::h5619abe06b01e135 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #15 0x5598ac3ff02b in _$LT$T$u20$as$u20$alloc..string..ToString$GT$::to_string::h711ce6a45b96d0ff /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/string.rs:2165:8\r\n    #16 0x5598ac3dc56b in anyhow::fmt::_$LT$impl$u20$anyhow..error..ErrorImpl$LT$$LP$$RP$$GT$$GT$::debug::hc0a884696ea7f686 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/fmt.rs:47:36\r\n    #17 0x5598ac3ec366 in anyhow::error::_$LT$impl$u20$core..fmt..Debug$u20$for$u20$anyhow..Error$GT$::fmt::h9d6bac8d0df90610 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/error.rs:492:8\r\n    #18 0x5598a4400dac in _$LT$$RF$T$u20$as$u20$core..fmt..Debug$GT$::fmt::hd157e7bb0a137d52 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #19 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #20 0x5598ae1cf7c2 in core::fmt::Write::write_fmt::h9faa23917d9c1261 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #21 0x5598ae1cf7c2 in alloc::fmt::format::hd31ca1f26e46e32c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/fmt.rs:571:4\r\n    #22 0x55989dbdd721 in libra_logger::security::SecurityLog::error::hb6b81fe85beddef7 /home/davidwg/libra/<::alloc::macros::format macros>:4:18\r\n    #23 0x559896e6dbb8 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::_$u7b$$u7b$closure$u7d$$u7d$::hf2e2c248928ca891 /home/davidwg/libra/consensus/src/chained_bft/event_process\r\nor.rs:426:12\r\n    #24 0x5598972ba98f in core::result::Result$LT$T$C$E$GT$::map_err::h26aaa04a741c110a /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/result.rs:610:26\r\n    #25 0x559896e7ac03 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::hddc8eb4cdebca996 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:425:8\r\n    #26 0x5598975e9e9d in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hd8f929e8a92f042c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #27 0x559897597859 in std::future::poll_with_tls_context::h5b201fc4d3347663 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n    #28 0x559896e66f1a in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::pre_process_proposal::_$u7b$$u7b$closure$u7d$$u7d$::he3b9ca33e6096ef1 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:341:24\r\n    #29 0x5598975e6833 in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hca38850150e4ce63 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #30 0x5598975939e3 in std::future::poll_with_tls_context::h42f38171f79b3cb9 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n    #31 0x559896e5cd9f in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::process_proposal_msg::_$u7b$$u7b$closure$u7d$$u7d$::hb98b4b771a9658f0 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:310:29\r\n\r\nDirect leak of 2760 byte(s) in 23 object(s) allocated from:\r\n    #0 0x559896d2b9ed in malloc /rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3\r\n    #1 0x5598ae1c0ef2 in __rdos_backtrace_alloc (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70fef2)\r\n    #2 0x5598ae1c2496 in __rdos_backtrace_dwarf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e711496)\r\n    #3 0x5598ae1bf01b in elf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e01b)\r\n    #4 0x5598ae1bf14b in phdr_callback (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e14b)\r\n    #5 0x7f1bad0e742b in __dl_iterate_phdr (/lib64/libc.so.6+0x13c42b)\r\n    #6 0x5598ae1bcf4a in __rdos_backtrace_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bf4a)\r\n    #7 0x5598ae1bcaee in fileline_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70baee)\r\n    #8 0x5598ae1bcb62 in __rdos_backtrace_syminfo (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bb62)\r\n    #9 0x5598ae1bc6ab in backtrace::symbolize::libbacktrace::resolve::hef1bf34e465712ca /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/libbacktrace.rs:469:8\r\n    #10 0x5598ae188861 in backtrace::symbolize::resolve_frame_unsynchronized::h64576c15b6f0d017 /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/mod.rs:178:4\r\n    #11 0x5598ae188861 in std::backtrace::Capture::resolve::h12b3b1574c5326e4 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:397:16\r\n    #12 0x5598ae188861 in _$LT$std..backtrace..Backtrace$u20$as$u20$core..fmt..Display$GT$::fmt::h9238db13fc40cf16 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:339:8\r\n    #13 0x5598ac3feb1c in _$LT$$RF$T$u20$as$u20$core..fmt..Display$GT$::fmt::h9b038eb6aa0ab6ad /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #14 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #15 0x5598ac3f2385 in core::fmt::Write::write_fmt::h5619abe06b01e135 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #16 0x5598ac3ff02b in _$LT$T$u20$as$u20$alloc..string..ToString$GT$::to_string::h711ce6a45b96d0ff /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/string.rs:2165:8\r\n    #17 0x5598ac3dc56b in anyhow::fmt::_$LT$impl$u20$anyhow..error..ErrorImpl$LT$$LP$$RP$$GT$$GT$::debug::hc0a884696ea7f686 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/fmt.rs:47:36\r\n    #18 0x5598ac3ec366 in anyhow::error::_$LT$impl$u20$core..fmt..Debug$u20$for$u20$anyhow..Error$GT$::fmt::h9d6bac8d0df90610 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/error.rs:492:8\r\n    #19 0x5598a4400dac in _$LT$$RF$T$u20$as$u20$core..fmt..Debug$GT$::fmt::hd157e7bb0a137d52 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #20 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #21 0x5598ae1cf7c2 in core::fmt::Write::write_fmt::h9faa23917d9c1261 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #22 0x5598ae1cf7c2 in alloc::fmt::format::hd31ca1f26e46e32c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/fmt.rs:571:4\r\n    #23 0x55989dbdd721 in libra_logger::security::SecurityLog::error::hb6b81fe85beddef7 /home/davidwg/libra/<::alloc::macros::format macros>:4:18\r\n    #24 0x559896e6dbb8 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::_$u7b$$u7b$closure$u7d$$u7d$::hf2e2c248928ca891 /home/davidwg/libra/consensus/src/chained_bft/event_process\r\nor.rs:426:12\r\n    #25 0x5598972ba98f in core::result::Result$LT$T$C$E$GT$::map_err::h26aaa04a741c110a /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/result.rs:610:26\r\n    #26 0x559896e7ac03 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::hddc8eb4cdebca996 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:425:8\r\n    #27 0x5598975e9e9d in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hd8f929e8a92f042c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #28 0x559897597859 in std::future::poll_with_tls_context::h5b201fc4d3347663 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n    #29 0x559896e66f1a in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::pre_process_proposal::_$u7b$$u7b$closure$u7d$$u7d$::he3b9ca33e6096ef1 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:341:24\r\n    #30 0x5598975e6833 in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hca38850150e4ce63 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #31 0x5598975939e3 in std::future::poll_with_tls_context::h42f38171f79b3cb9 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\nIndirect leak of 10144 byte(s) in 23 object(s) allocated from:\r\n    #0 0x559896d2b9ed in malloc /rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3\r\n    #1 0x5598ae1c0ef2 in __rdos_backtrace_alloc (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70fef2)\r\n    #2 0x5598ae1c1978 in __rdos_backtrace_dwarf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e710978)\r\n    #3 0x5598ae1bf01b in elf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e01b)\r\n    #4 0x5598ae1bf14b in phdr_callback (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e14b)\r\n    #5 0x7f1bad0e742b in __dl_iterate_phdr (/lib64/libc.so.6+0x13c42b)\r\n    #6 0x5598ae1bcf4a in __rdos_backtrace_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bf4a)\r\n    #7 0x5598ae1bcaee in fileline_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70baee)\r\n    #8 0x5598ae1bcb62 in __rdos_backtrace_syminfo (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bb62)\r\n    #9 0x5598ae1bc6ab in backtrace::symbolize::libbacktrace::resolve::hef1bf34e465712ca /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/libbacktrace.rs:469:8\r\n    #10 0x5598ae188861 in backtrace::symbolize::resolve_frame_unsynchronized::h64576c15b6f0d017 /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/mod.rs:178:4\r\n    #11 0x5598ae188861 in std::backtrace::Capture::resolve::h12b3b1574c5326e4 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:397:16\r\n    #12 0x5598ae188861 in _$LT$std..backtrace..Backtrace$u20$as$u20$core..fmt..Display$GT$::fmt::h9238db13fc40cf16 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:339:8\r\n    #13 0x5598ac3feb1c in _$LT$$RF$T$u20$as$u20$core..fmt..Display$GT$::fmt::h9b038eb6aa0ab6ad /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #14 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #15 0x5598ac3f2385 in core::fmt::Write::write_fmt::h5619abe06b01e135 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #16 0x5598ac3ff02b in _$LT$T$u20$as$u20$alloc..string..ToString$GT$::to_string::h711ce6a45b96d0ff /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/string.rs:2165:8\r\n    #17 0x5598ac3dc56b in anyhow::fmt::_$LT$impl$u20$anyhow..error..ErrorImpl$LT$$LP$$RP$$GT$$GT$::debug::hc0a884696ea7f686 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/fmt.rs:47:36\r\n    #18 0x5598ac3ec366 in anyhow::error::_$LT$impl$u20$core..fmt..Debug$u20$for$u20$anyhow..Error$GT$::fmt::h9d6bac8d0df90610 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/error.rs:492:8\r\n    #19 0x5598a4400dac in _$LT$$RF$T$u20$as$u20$core..fmt..Debug$GT$::fmt::hd157e7bb0a137d52 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #20 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #21 0x5598ae1cf7c2 in core::fmt::Write::write_fmt::h9faa23917d9c1261 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #22 0x5598ae1cf7c2 in alloc::fmt::format::hd31ca1f26e46e32c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/fmt.rs:571:4\r\n    #23 0x55989dbdd721 in libra_logger::security::SecurityLog::error::hb6b81fe85beddef7 /home/davidwg/libra/<::alloc::macros::format macros>:4:18\r\n    #24 0x559896e6dbb8 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::_$u7b$$u7b$closure$u7d$$u7d$::hf2e2c248928ca891 /home/davidwg/libra/consensus/src/chained_bft/event_process\r\nor.rs:426:12\r\n    #25 0x5598972ba98f in core::result::Result$LT$T$C$E$GT$::map_err::h26aaa04a741c110a /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/result.rs:610:26\r\n    #26 0x559896e7ac03 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::hddc8eb4cdebca996 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:425:8\r\n    #27 0x5598975e9e9d in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hd8f929e8a92f042c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #28 0x559897597859 in std::future::poll_with_tls_context::h5b201fc4d3347663 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n    #29 0x559896e66f1a in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::pre_process_proposal::_$u7b$$u7b$closure$u7d$$u7d$::he3b9ca33e6096ef1 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:341:24\r\n    #30 0x5598975e6833 in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hca38850150e4ce63 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #31 0x5598975939e3 in std::future::poll_with_tls_context::h42f38171f79b3cb9 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n\r\nIndirect leak of 8296 byte(s) in 307 object(s) allocated from:\r\n    #0 0x559896d2b9ed in malloc /rustc/llvm/src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cc:145:3\r\n    #1 0x5598ae1c0ef2 in __rdos_backtrace_alloc (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70fef2)\r\n    #2 0x5598ae1c1e7c in __rdos_backtrace_dwarf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e710e7c)\r\n    #3 0x5598ae1bf01b in elf_add (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e01b)\r\n    #4 0x5598ae1bf14b in phdr_callback (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70e14b)\r\n    #5 0x7f1bad0e742b in __dl_iterate_phdr (/lib64/libc.so.6+0x13c42b)\r\n    #6 0x5598ae1bcf4a in __rdos_backtrace_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bf4a)\r\n    #7 0x5598ae1bcaee in fileline_initialize (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70baee)\r\n    #8 0x5598ae1bcb62 in __rdos_backtrace_syminfo (/home/davidwg/libra/target/x86_64-unknown-linux-gnu/debug/fuzz_runner+0x1e70bb62)\r\n    #9 0x5598ae1bc6ab in backtrace::symbolize::libbacktrace::resolve::hef1bf34e465712ca /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/libbacktrace.rs:469:8\r\n    #10 0x5598ae188861 in backtrace::symbolize::resolve_frame_unsynchronized::h64576c15b6f0d017 /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.44/src/symbolize/mod.rs:178:4\r\n    #11 0x5598ae188861 in std::backtrace::Capture::resolve::h12b3b1574c5326e4 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:397:16\r\n    #12 0x5598ae188861 in _$LT$std..backtrace..Backtrace$u20$as$u20$core..fmt..Display$GT$::fmt::h9238db13fc40cf16 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/backtrace.rs:339:8\r\n    #13 0x5598ac3feb1c in _$LT$$RF$T$u20$as$u20$core..fmt..Display$GT$::fmt::h9b038eb6aa0ab6ad /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #14 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #15 0x5598ac3f2385 in core::fmt::Write::write_fmt::h5619abe06b01e135 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #16 0x5598ac3ff02b in _$LT$T$u20$as$u20$alloc..string..ToString$GT$::to_string::h711ce6a45b96d0ff /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/string.rs:2165:8\r\n    #17 0x5598ac3dc56b in anyhow::fmt::_$LT$impl$u20$anyhow..error..ErrorImpl$LT$$LP$$RP$$GT$$GT$::debug::hc0a884696ea7f686 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/fmt.rs:47:36\r\n    #18 0x5598ac3ec366 in anyhow::error::_$LT$impl$u20$core..fmt..Debug$u20$for$u20$anyhow..Error$GT$::fmt::h9d6bac8d0df90610 /home/davidwg/.cargo/registry/src/github.com-1ecc6299db9ec823/anyhow-1.0.26/src/error.rs:492:8\r\n    #19 0x5598a4400dac in _$LT$$RF$T$u20$as$u20$core..fmt..Debug$GT$::fmt::hd157e7bb0a137d52 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1949:80\r\n    #20 0x5598ae1dc44b in core::fmt::write::h74f862b8fe5295c5 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:1053:16\r\n    #21 0x5598ae1cf7c2 in core::fmt::Write::write_fmt::h9faa23917d9c1261 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/fmt/mod.rs:195:8\r\n    #22 0x5598ae1cf7c2 in alloc::fmt::format::hd31ca1f26e46e32c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/fmt.rs:571:4\r\n    #23 0x55989dbdd721 in libra_logger::security::SecurityLog::error::hb6b81fe85beddef7 /home/davidwg/libra/<::alloc::macros::format macros>:4:18\r\n    #22 0x5598ae1cf7c2 in alloc::fmt::format::hd31ca1f26e46e32c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/liballoc/fmt.rs:571:4\r\n    #23 0x55989dbdd721 in libra_logger::security::SecurityLog::error::hb6b81fe85beddef7 /home/davidwg/libra/<::alloc::macros::format macros>:4:18\r\n    #24 0x559896e6dbb8 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::_$u7b$$u7b$closure$u7d$$u7d$::hf2e2c248928ca891 /home/davidwg/libra/consensus/src/chained_bft/event_process\r\nor.rs:426:12\r\n    #25 0x5598972ba98f in core::result::Result$LT$T$C$E$GT$::map_err::h26aaa04a741c110a /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libcore/result.rs:610:26\r\n    #26 0x559896e7ac03 in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::sync_up::_$u7b$$u7b$closure$u7d$$u7d$::hddc8eb4cdebca996 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:425:8\r\n    #27 0x5598975e9e9d in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hd8f929e8a92f042c /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #28 0x559897597859 in std::future::poll_with_tls_context::h5b201fc4d3347663 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n    #29 0x559896e66f1a in consensus::chained_bft::event_processor::EventProcessor$LT$T$GT$::pre_process_proposal::_$u7b$$u7b$closure$u7d$$u7d$::he3b9ca33e6096ef1 /home/davidwg/libra/consensus/src/chained_bft/event_processor.rs:341:24\r\n    #30 0x5598975e6833 in _$LT$std..future..GenFuture$LT$T$GT$$u20$as$u20$core..future..future..Future$GT$::poll::hca38850150e4ce63 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:44:14\r\n    #31 0x5598975939e3 in std::future::poll_with_tls_context::h42f38171f79b3cb9 /rustc/abc3073c92df034636a823c5382ece2186d22b9e/src/libstd/future.rs:102:13\r\n\r\nSUMMARY: AddressSanitizer: 24053 byte(s) leaked in 433 allocation(s).</code></pre>\r\n</details>\r\n\r\nDigging a bit, it seems like this simple script leaks according to valgrind:\r\n\r\n```rust\r\n#![feature(backtrace)]\r\nuse std::backtrace::Backtrace;\r\nfn main() {\r\n    for _ in 0..100 {\r\n        let bt = Backtrace::force_capture();\r\n        println!(\"{}\", bt); println!(\"{:?}\", bt);\r\n    }\r\n}\r\n```\r\n\r\nvalgrind output:\r\n\r\n```\r\n==863497== Memcheck, a memory error detector\r\n==863497== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==863497== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info\r\n==863497== Command: ./target/debug/repro_memleak\r\n==863497== Parent PID: 575326\r\n==863497== \r\n==863497== \r\n==863497== HEAP SUMMARY:\r\n==863497==     in use at exit: 687,121 bytes in 243 blocks\r\n==863497==   total heap usage: 2,447 allocs, 2,204 frees, 1,530,442 bytes allocated\r\n==863497== \r\n==863497== 2,729 bytes in 2 blocks are definitely lost in loss record 13 of 23\r\n==863497==    at 0x4C29DAF: malloc (vg_replace_malloc.c:309)\r\n==863497==    by 0x1228E2: __rdos_backtrace_alloc (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x1206DE: elf_add (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11FDF6: elf_add (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x120B3B: phdr_callback (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x57B642B: dl_iterate_phdr (in /usr/lib64/libc-2.17.so)\r\n==863497==    by 0x11E93A: __rdos_backtrace_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E66E: fileline_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E6E2: __rdos_backtrace_syminfo (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E2AB: backtrace::symbolize::libbacktrace::resolve (libbacktrace.rs:469)\r\n==863497==    by 0x114C91: resolve_frame_unsynchronized<closure-0> (mod.rs:178)\r\n==863497==    by 0x114C91: resolve (backtrace.rs:397)\r\n==863497==    by 0x114C91: <std::backtrace::Backtrace as core::fmt::Display>::fmt (backtrace.rs:339)\r\n==863497==    by 0x131ABB: core::fmt::write (mod.rs:1053)\r\n==863497== \r\n==863497== 123,804 bytes in 8 blocks are possibly lost in loss record 20 of 23\r\n==863497==    at 0x4C29DAF: malloc (vg_replace_malloc.c:309)\r\n==863497==    by 0x1228E2: __rdos_backtrace_alloc (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x12A6B5: __rdos_backtrace_get_view (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11F3DE: elf_add (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x120B3B: phdr_callback (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x57B642B: dl_iterate_phdr (in /usr/lib64/libc-2.17.so)\r\n==863497==    by 0x11E93A: __rdos_backtrace_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E66E: fileline_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E6E2: __rdos_backtrace_syminfo (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E2AB: backtrace::symbolize::libbacktrace::resolve (libbacktrace.rs:469)\r\n==863497==    by 0x114C91: resolve_frame_unsynchronized<closure-0> (mod.rs:178)\r\n==863497==    by 0x114C91: resolve (backtrace.rs:397)\r\n==863497==    by 0x114C91: <std::backtrace::Backtrace as core::fmt::Display>::fmt (backtrace.rs:339)\r\n==863497==    by 0x131ABB: core::fmt::write (mod.rs:1053)\r\n==863497== \r\n==863497== 126,992 bytes in 1 blocks are possibly lost in loss record 21 of 23\r\n==863497==    at 0x4C29DAF: malloc (vg_replace_malloc.c:309)\r\n==863497==    by 0x1228E2: __rdos_backtrace_alloc (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x12A6B5: __rdos_backtrace_get_view (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11F3DE: elf_add (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E8DC: __rdos_backtrace_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E66E: fileline_initialize (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E6E2: __rdos_backtrace_syminfo (in /home/davidwg/work/repro_memleak/target/debug/repro_memleak)\r\n==863497==    by 0x11E2AB: backtrace::symbolize::libbacktrace::resolve (libbacktrace.rs:469)\r\n==863497==    by 0x114C91: resolve_frame_unsynchronized<closure-0> (mod.rs:178)\r\n==863497==    by 0x114C91: resolve (backtrace.rs:397)\r\n==863497==    by 0x114C91: <std::backtrace::Backtrace as core::fmt::Display>::fmt (backtrace.rs:339)\r\n==863497==    by 0x131ABB: core::fmt::write (mod.rs:1053)\r\n==863497==    by 0x11685F: write_fmt<std::io::stdio::StdoutLock> (mod.rs:1428)\r\n==863497==    by 0x11685F: <std::io::stdio::Stdout as std::io::Write>::write_fmt (stdio.rs:549)\r\n==863497==    by 0x116F3D: {{closure}}<std::io::stdio::Stdout> (stdio.rs:800)\r\n==863497==    by 0x116F3D: try_with<core::cell::RefCell<core::option::Option<alloc::boxed::Box<Write>>>,closure-0,core::result::Result<(), std::io::error::Error>> (local.rs:262)\r\n==863497==    by 0x116F3D: print_to<std::io::stdio::Stdout> (stdio.rs:793)\r\n==863497==    by 0x116F3D: std::io::stdio::_print (stdio.rs:817)\r\n==863497== \r\n==863497== LEAK SUMMARY:\r\n==863497==    definitely lost: 2,729 bytes in 2 blocks\r\n==863497==    indirectly lost: 0 bytes in 0 blocks\r\n==863497==      possibly lost: 250,796 bytes in 9 blocks\r\n==863497==    still reachable: 433,596 bytes in 232 blocks\r\n==863497==         suppressed: 0 bytes in 0 blocks\r\n==863497== Reachable blocks (those to which a pointer was found) are not shown.\r\n==863497== To see them, rerun with: --leak-check=full --show-leak-kinds=all\r\n==863497== \r\n==863497== For lists of detected and suppressed errors, rerun with: -s\r\n==863497== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 0 from 0)\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69721/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69721/timeline", "performed_via_github_app": null, "state_reason": "completed"}