{"url": "https://api.github.com/repos/rust-lang/rust/issues/58987", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58987/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58987/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58987/events", "html_url": "https://github.com/rust-lang/rust/issues/58987", "id": 418130874, "node_id": "MDU6SXNzdWU0MTgxMzA4NzQ=", "number": 58987, "title": "rustc panic: Type parameter `R/#1` (R/1) out of range when substituting...", "user": {"login": "Vociferix", "id": 15919217, "node_id": "MDQ6VXNlcjE1OTE5MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/15919217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vociferix", "html_url": "https://github.com/Vociferix", "followers_url": "https://api.github.com/users/Vociferix/followers", "following_url": "https://api.github.com/users/Vociferix/following{/other_user}", "gists_url": "https://api.github.com/users/Vociferix/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vociferix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vociferix/subscriptions", "organizations_url": "https://api.github.com/users/Vociferix/orgs", "repos_url": "https://api.github.com/users/Vociferix/repos", "events_url": "https://api.github.com/users/Vociferix/events{/privacy}", "received_events_url": "https://api.github.com/users/Vociferix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 900795185, "node_id": "MDU6TGFiZWw5MDA3OTUxODU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-eval", "name": "A-const-eval", "color": "f7e101", "default": false, "description": "Area: constant evaluation (mir interpretation)"}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2019-03-07T05:05:47Z", "updated_at": "2022-08-14T13:59:10Z", "closed_at": "2020-04-27T00:38:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Please see [this repo]( https://github.com/Vociferix/io-cache) for more details. Commit 628894b, which is the only commit at this time, as I created the repo specifically for this issue. It's an in progress library with a lot of early experimentation in it.\r\n\r\n\r\nBelow is the compiler and build information. Based on the information, it appears the problem has to do\r\nwith rust's in-progress `const` semantics, although I might not know what I'm talking about. I just know\r\nthat my use of `const` and generics in this library is fairly atypical (or at least I believe it to be),\r\nso it makes sense to me that the problem lies there.\r\n\r\nI apologize for the state of this code base. It has no comments, no tests, and is full of experimentation\r\ncode to see what will compile and what won't. I did at least clean up all the warnings before posting\r\nthis, to make life a bit easier. It is a one-man hobby project, and I am still relatively new to rust. A\r\nlot of the code here is my personal translation of C++ meta programming over to rust.\r\n\r\nA note to keep in mind: Everything compiled until I added the threading code for `AsyncIO` in\r\nsrc/detail/io.rs, which I find interesting since it appears to be complaining about something that\r\npreviously compiled with no problem, and is unrelated to the threading code.\r\n\r\nAlso note that if the compiler did not panic, there is a good chance there is something actually wrong\r\nwith the code that would fail to compile, which would be something in src/detail/io.rs.\r\n\r\n```\r\n$ rustc --version\r\nrustc 1.33.0 (2aa4c46cf 2019-02-28)\r\n```\r\n\r\n```\r\n$ rustup show\r\nDefault host: x86_64-unknown-linux-gnu\r\n\r\ninstalled toolchains\r\n--------------------\r\n\r\nstable-x86_64-unknown-linux-gnu (default)\r\nbeta-x86_64-unknown-linux-gnu\r\nnightly-x86_64-unknown-linux-gnu\r\n\r\nactive toolchain\r\n----------------\r\n\r\nstable-x86_64-unknown-linux-gnu (default)\r\nrustc 1.33.0 (2aa4c46cf 2019-02-28)\r\n\r\n```\r\n\r\n```\r\n$ RUST_BACKTRACE=FULL cargo build --verbose\r\n   Compiling io-cache v0.1.0 (/home/jack/devel/io-cache)\r\n     Running `rustc --edition=2018 --crate-name io_cache src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=531453a790193d18 -C extra-filename=-531453a790193d18 --out-dir /home/jack/devel/io-cache/target/debug/deps -C incremental=/home/jack/devel/io-cache/target/debug/incremental -L dependency=/home/jack/devel/io-cache/target/debug/deps`\r\nerror: internal compiler error: src/librustc/ty/subst.rs:480: Type parameter `R/#1` (R/1) out of range when substituting (root type=Some(detail::set::NWaySet<L, R, Block, Blocks>)) substs=[detail::set::NWaySet<L, R, Block, Blocks>]\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:526:9\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:70\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/sys_common/backtrace.rs:58\r\n             at src/libstd/panicking.rs:200\r\n   3: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\n   4: rustc::util::common::panic_hook\r\n   5: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:482\r\n   6: std::panicking::begin_panic\r\n   7: rustc_errors::Handler::span_bug\r\n   8: rustc::util::bug::opt_span_bug_fmt::{{closure}}\r\n   9: rustc::ty::context::tls::with_opt::{{closure}}\r\n  10: rustc::ty::context::tls::with_context_opt\r\n  11: rustc::ty::context::tls::with_opt\r\n  12: rustc::util::bug::opt_span_bug_fmt\r\n  13: rustc::util::bug::span_bug_fmt\r\n  14: <rustc::ty::subst::SubstFolder<'a, 'gcx, 'tcx> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_ty\r\n  15: <smallvec::SmallVec<A> as core::iter::traits::FromIterator<<A as smallvec::Array>::Item>>::from_iter\r\n  16: rustc::ty::fold::TypeFoldable::fold_with\r\n  17: rustc::ty::structural_impls::<impl rustc::ty::fold::TypeFoldable<'tcx> for &'tcx rustc::ty::TyS<'tcx>>::super_fold_with\r\n  18: <rustc::ty::subst::SubstFolder<'a, 'gcx, 'tcx> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_ty\r\n  19: <smallvec::SmallVec<A> as core::iter::traits::FromIterator<<A as smallvec::Array>::Item>>::from_iter\r\n  20: rustc::ty::fold::TypeFoldable::fold_with\r\n  21: rustc::traits::codegen::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'tcx>>::subst_and_normalize_erasing_regions\r\n  22: <rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::resolve\r\n  23: rustc_mir::interpret::step::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::run\r\n  24: rustc_mir::const_eval::eval_body_using_ecx\r\n  25: rustc_mir::const_eval::const_eval_raw_provider\r\n  26: rustc::ty::query::__query_compute::const_eval_raw\r\n  27: rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::const_eval_raw<'tcx>>::compute\r\n  28: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  29: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_get_with\r\n  30: <rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::const_eval_raw\r\n  31: rustc_mir::interpret::operand::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::const_value_to_op\r\n  32: rustc_mir::const_eval::lazy_const_to_op\r\n  33: rustc_mir::transform::const_prop::ConstPropagator::eval_constant\r\n  34: <rustc_mir::transform::const_prop::ConstPropagator<'b, 'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_statement\r\n  35: <rustc_mir::transform::const_prop::ConstProp as rustc_mir::transform::MirPass>::run_pass\r\n  36: rustc_mir::transform::run_passes::{{closure}}\r\n  37: rustc_mir::transform::run_passes\r\n  38: rustc_mir::transform::optimized_mir\r\n  39: rustc::ty::query::__query_compute::optimized_mir\r\n  40: rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::optimized_mir<'tcx>>::compute\r\n  41: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  42: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_get_with\r\n  43: rustc_metadata::encoder::<impl rustc_metadata::isolated_encoder::IsolatedEncoder<'a, 'b, 'tcx>>::encode_optimized_mir\r\n  44: rustc_metadata::encoder::<impl rustc_metadata::isolated_encoder::IsolatedEncoder<'a, 'b, 'tcx>>::encode_info_for_impl_item\r\n  45: rustc::dep_graph::graph::DepGraph::with_ignore\r\n  46: rustc_metadata::encoder::<impl rustc_metadata::index_builder::IndexBuilder<'a, 'b, 'tcx>>::encode_addl_info_for_item\r\n  47: rustc::hir::Crate::visit_all_item_likes\r\n  48: rustc_metadata::encoder::encode_metadata\r\n  49: rustc_metadata::cstore_impl::<impl rustc::middle::cstore::CrateStore for rustc_metadata::cstore::CStore>::encode_metadata\r\n  50: rustc::ty::context::TyCtxt::encode_metadata\r\n  51: <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_ssa::traits::backend::ExtraBackendMethods>::write_metadata\r\n  52: rustc::util::common::time\r\n  53: rustc_codegen_ssa::base::codegen_crate\r\n  54: <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_utils::codegen_backend::CodegenBackend>::codegen_crate\r\n  55: rustc::util::common::time\r\n  56: rustc_driver::driver::phase_4_codegen\r\n  57: rustc_driver::driver::compile_input::{{closure}}\r\n  58: <std::thread::local::LocalKey<T>>::with\r\n  59: rustc::ty::context::TyCtxt::create_and_enter\r\n  60: rustc_driver::driver::compile_input\r\n  61: rustc_driver::run_compiler_with_pool\r\n  62: <scoped_tls::ScopedKey<T>>::set\r\n  63: rustc_driver::run_compiler\r\n  64: <scoped_tls::ScopedKey<T>>::set\r\nquery stack during panic:\r\n#0 [const_eval_raw] const-evaluating `<detail::set::NWaySet<L, R, Block, Blocks> as detail::set::Set>::STATIC_META_MEM`\r\n   --> src/detail/set.rs:206:32\r\n    |\r\n206 |       const MEM_PER_SET: usize = (Block::LEN * Blocks::LEN)\r\n    |  ________________________________^\r\n207 | |         + NWaySet::<L, R, Block, Blocks>::STATIC_META_MEM\r\n    | |_________________________________________________________^\r\n#1 [optimized_mir] processing `<detail::set::NWaySets<L, R, Block, Blocks, S>>::MEM_PER_SET`\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.33.0 (2aa4c46cf 2019-02-28) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `io-cache`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --edition=2018 --crate-name io_cache src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=531453a790193d18 -C extra-filename=-531453a790193d18 --out-dir /home/jack/devel/io-cache/target/debug/deps -C incremental=/home/jack/devel/io-cache/target/debug/incremental -L dependency=/home/jack/devel/io-cache/target/debug/deps` (exit code: 101)\r\n```", "closed_by": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58987/timeline", "performed_via_github_app": null, "state_reason": "completed"}