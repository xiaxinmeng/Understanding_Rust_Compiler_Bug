{"url": "https://api.github.com/repos/rust-lang/rust/issues/33497", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/33497/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/33497/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/33497/events", "html_url": "https://github.com/rust-lang/rust/issues/33497", "id": 153661166, "node_id": "MDU6SXNzdWUxNTM2NjExNjY=", "number": 33497, "title": "Compiler panics when 'data-layout' field is missing in LLVM target json", "user": {"login": "jgallag88", "id": 4139386, "node_id": "MDQ6VXNlcjQxMzkzODY=", "avatar_url": "https://avatars.githubusercontent.com/u/4139386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jgallag88", "html_url": "https://github.com/jgallag88", "followers_url": "https://api.github.com/users/jgallag88/followers", "following_url": "https://api.github.com/users/jgallag88/following{/other_user}", "gists_url": "https://api.github.com/users/jgallag88/gists{/gist_id}", "starred_url": "https://api.github.com/users/jgallag88/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jgallag88/subscriptions", "organizations_url": "https://api.github.com/users/jgallag88/orgs", "repos_url": "https://api.github.com/users/jgallag88/repos", "events_url": "https://api.github.com/users/jgallag88/events{/privacy}", "received_events_url": "https://api.github.com/users/jgallag88/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-05-08T15:17:55Z", "updated_at": "2016-11-29T14:50:12Z", "closed_at": "2016-11-29T14:50:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When I upgraded my compiler to the most recent nightly, I found that my project no longer compiles. Instead, rustc panics, producing this error:\n\n```\n$ RUST_BACKTRACE=1 rustc --target i686-unknown-none-gnu -Z no-landing-pads -C no-redzone -C opt-level=1 -A dead_code -L . -L src rust/src/libcore/lib.rs\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Field data-layout in target specification is required', ../src/librustc_back/target/mod.rs:370\nstack backtrace:\n   1:     0x7f16d61a1d10 - std::sys::backtrace::tracing::imp::write::h9fb600083204ae7f\n   2:     0x7f16d61af58b - std::panicking::default_hook::_$u7b$$u7b$closure$u7d$$u7d$::hca543c34f11229ac\n   3:     0x7f16d61af12c - std::panicking::default_hook::hc2c969e7453d080c\n   4:     0x7f16d61748cf - std::sys_common::unwind::begin_unwind_inner::h30e12d15ce2b2e25\n   5:     0x7f16d61769b8 - std::sys_common::unwind::begin_unwind_fmt::hb2de8a9968d38523\n   6:     0x7f16d213b0ca - rustc_back::target::Target::from_json::h0865f3d0efe9d5a8\n   7:     0x7f16d213d2bf - rustc_back::target::Target::search::load_file::h10b754eb1c29e7bb\n   8:     0x7f16d213ca4a - rustc_back::target::Target::search::h5d24d442a2ed9dcf\n   9:     0x7f16d2a39e71 - rustc::session::config::build_target_config::h59bc6d485b6e9271\n  10:     0x7f16d2a37f6d - rustc::session::build_session_::h6f9ae75b9cc92e18\n  11:     0x7f16d2a365a3 - rustc::session::build_session_with_codemap::h0045b7130fdfbb5c\n  12:     0x7f16d66b0367 - rustc_driver::run_compiler::h8902aebf8b1849a8\n  13:     0x7f16d66ad7bd - std::sys_common::unwind::try::try_fn::h4c74456035d0fcc7\n  14:     0x7f16d619f4eb - __rust_try\n  15:     0x7f16d619f47d - std::sys_common::unwind::inner_try::h47a4d9cd4a369dcd\n  16:     0x7f16d66ae1ea - _<F as std..boxed..FnBox<A>>::call_box::h27f542a39f1d61ef\n  17:     0x7f16d61ad6f4 - std::sys::thread::Thread::new::thread_start::h6f266e069bf4ec2b\n  18:     0x7f16cdf226f9 - start_thread\n  19:     0x7f16d5e02b5c - clone\n  20:                0x0 - <unknown>\n```\n\nAs the panic message indicates, the target I was supplying was missing the 'data-layout' field:\n\n```\n$ cat i686-unknown-none-gnu.json\n{\n    \"llvm-target\": \"i686-unknown-none-gnu\",\n    \"target-endian\": \"little\",\n    \"target-pointer-width\": \"32\",\n    \"os\": \"none\",\n    \"arch\": \"x86\",\n    \"target-env\": \"gnu\",\n    \"pre-link-args\": [ \"-m32\" ],\n    \"features\": \"-mmx,-sse,-sse2,-sse3,-ssse3,-sse4.1,-sse4.2,-3dnow,-3dnowa,-avx,-avx2\",\n    \"disable-redzone\": true,\n    \"eliminate-frame-pointer\": true,\n    \"linker-is-gnu\": true,\n    \"no-compiler-rt\": true,\n    \"archive-format\": \"gnu\"\n}\n```\n\nI added `\"data-layout\": \"e-m:e-p:32:32-f64:32:64-f80:32-n8:16:32-S128\"` to the target, and everything builds once again. The requirement that this field be present apparently is caused by a change in LLVM, according to this issue: https://github.com/rust-lang/rust/issues/31367. It looks like this was fixed for all of the targets rust uses internally by this change: https://github.com/rust-lang/rust/pull/32939. \n\nSince targets can be supplied by the user, as in the case above, panicking doesn't really seem warranted. Panicking implies there is a bug in the compiler, whereas the problem might be in the user's input. If the problem is in the user's input, it would be nice for the error to indicate this, to prevent confusion.\n\n```\n$ rustc --version --verbose\nrustc 1.10.0-nightly (62e2b2fb7 2016-05-06)\nbinary: rustc\ncommit-hash: 62e2b2fb7acf5f8331781cd7128c754ed1b66c4f\ncommit-date: 2016-05-06\nhost: x86_64-unknown-linux-gnu\nrelease: 1.10.0-nightly\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/33497/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/33497/timeline", "performed_via_github_app": null, "state_reason": "completed"}