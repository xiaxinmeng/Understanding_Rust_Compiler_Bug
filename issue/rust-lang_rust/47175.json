{"url": "https://api.github.com/repos/rust-lang/rust/issues/47175", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47175/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47175/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47175/events", "html_url": "https://github.com/rust-lang/rust/issues/47175", "id": 285923861, "node_id": "MDU6SXNzdWUyODU5MjM4NjE=", "number": 47175, "title": "Memory corruption (?) from tower-grpc-build on nightly", "user": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 16, "created_at": "2018-01-04T09:20:20Z", "updated_at": "2018-01-13T01:17:33Z", "closed_at": "2018-01-08T17:26:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello\r\n\r\nWhen playing with some development versions of tower-grpc-build (https://github.com/tower-rs/tower/grpc), I discovered a strange crash of the build script. I managed to shring it a bit, but I don't think this is minimal case (I just don't know how to continue pinning it down further).\r\n\r\nFew observations:\r\n* The string it talks about in the backtrace seems like random junk (which isn't always the same). I'm not sure how it got there, but in general, Rust probably should prevent creation of strings with uninitialized content.\r\n* It doesn't happen on stable.\r\n* It happens on today's and yesterday's nightly (exact version below).\r\n* It doesn't happen on approx. a week old nightly, but I'm not at the computer that has the older version, I'll look exact version when I get to it in few hours.\r\n\r\nAs I needed to pin exact commits in `Cargo.lock` to make the branches and crates from git to compile together, I have the example as a whole repository: https://github.com/vorner/p-crash.\r\n\r\nSteps to reproduce (I moved the failing code from build script to ordinary `main.rs`, therefore the `OUT_DIR`):\r\n\r\n```\r\nrustup default nightly\r\nOUT_DIR=\".\" cargo run\r\n```\r\n\r\nThe backtrace:\r\n\r\n```\r\nthread 'main' panicked at 'byte index 1 is not a char boundary; it is inside '\\u{0}' (bytes 0..1) of `\u00a0\u00e2U\u007f\u00e2U\u00e2U\u007f\u00a0P\u00e2U\u007fCbyte index 1 is not a char boundary; it is inside ams_p._ping_re`[...]', /checkout/src/libcore/str/mod.rs:2234:5\r\nstack backtrace:\r\n   0:     0x564e394ee1fb - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::hb720ecb1cdd94d34\r\n                               at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x564e394f1c4e - std::sys_common::backtrace::print::h3b9052ae1243ac3c\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:68\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:57\r\n   2:     0x564e394e8930 - std::panicking::default_hook::{{closure}}::h8386650ae58050b2\r\n                               at /checkout/src/libstd/panicking.rs:381\r\n   3:     0x564e394e8465 - std::panicking::default_hook::h939eef3f926b9ec4\r\n                               at /checkout/src/libstd/panicking.rs:397\r\n   4:     0x564e394e8cbb - std::panicking::rust_panic_with_hook::hd65467d489bb99a6\r\n                               at /checkout/src/libstd/panicking.rs:577\r\n   5:     0x564e394e8b0e - std::panicking::begin_panic::h06b05d85af0a01cf\r\n                               at /checkout/src/libstd/panicking.rs:538\r\n   6:     0x564e394e8a7a - std::panicking::begin_panic_fmt::hdcdf37dcdaa48dbb\r\n                               at /checkout/src/libstd/panicking.rs:522\r\n   7:     0x564e394e8a12 - rust_begin_unwind\r\n                               at /checkout/src/libstd/panicking.rs:498\r\n   8:     0x564e39540e40 - core::panicking::panic_fmt::h1bceab3183b318fb\r\n                               at /checkout/src/libcore/panicking.rs:71\r\n   9:     0x564e3953f4ed - core::str::slice_error_fail::h92f09d0a955fe52f\r\n                               at /checkout/src/libcore/str/mod.rs:0\r\n  10:     0x564e394a04de - core::str::traits::<impl core::slice::SliceIndex<str> for core::ops::range::RangeFrom<usize>>::index::{{closure}}::h7353d5e4c348ff28\r\n                               at /checkout/src/libcore/str/mod.rs:1987\r\n  11:     0x564e3949e455 - <core::option::Option<T>>::unwrap_or_else::hde62f1acbfa5a0d6\r\n                               at /checkout/src/libcore/option.rs:376\r\n  12:     0x564e394a0ad9 - core::str::traits::<impl core::slice::SliceIndex<str> for core::ops::range::RangeFrom<usize>>::index::hea07b70cbc76dfe2\r\n                               at /checkout/src/libcore/str/mod.rs:1987\r\n  13:     0x564e394a0494 - core::str::traits::<impl core::ops::index::Index<core::ops::range::RangeFrom<usize>> for str>::index::he1272c2136040a65\r\n                               at /checkout/src/libcore/str/mod.rs:1734\r\n  14:     0x564e3949d564 - unicode_segmentation::word::UWordBounds::get_next_cat::hd9df4c8a50c69cf3\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/unicode-segmentation-1.2.0/src/word.rs:611\r\n  15:     0x564e3949cc48 - <unicode_segmentation::word::UWordBounds<'a> as core::iter::iterator::Iterator>::next::hfaaee7c167be77af\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/unicode-segmentation-1.2.0/src/word.rs:227\r\n  16:     0x564e3949d7ee - <&'a mut I as core::iter::iterator::Iterator>::next::h1d6ba2952b78d957\r\n                               at /checkout/src/libcore/iter/iterator.rs:2380\r\n  17:     0x564e394a36b8 - <core::iter::Filter<I, P> as core::iter::iterator::Iterator>::next::h735c3caf6113fcd5\r\n                               at /checkout/src/libcore/iter/mod.rs:1362\r\n  18:     0x564e3949d44b - <unicode_segmentation::word::UnicodeWords<'a> as core::iter::iterator::Iterator>::next::h05b4feaa8a7b6004\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/unicode-segmentation-1.2.0/src/word.rs:30\r\n  19:     0x564e394a12ea - heck::transform::h2bd9c6ea08dc34e6\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/heck-0.3.0/src/lib.rs:81\r\n  20:     0x564e3949c503 - <str as heck::snake::SnakeCase>::to_snake_case::h13cce73744a245f8\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/heck-0.3.0/src/snake.rs:37\r\n  21:     0x564e3942fef1 - prost_build::ident::to_snake::h6cb82fcbe7a31a26\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/ident.rs:8\r\n  22:     0x564e3944b177 - core::ops::function::FnMut::call_mut::he9df2a59f21ce2ef\r\n                               at /checkout/src/libcore/ops/function.rs:146\r\n  23:     0x564e3942dd36 - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &'a mut F>::call_once::hc412d0b7423e7dd9\r\n                               at /checkout/src/libcore/ops/function.rs:271\r\n  24:     0x564e3940dadf - <core::option::Option<T>>::map::ha68eff2bf856d1c0\r\n                               at /checkout/src/libcore/option.rs:404\r\n  25:     0x564e3944789a - <core::iter::Map<I, F> as core::iter::iterator::Iterator>::next::hf391941cd12c07f0\r\n                               at /checkout/src/libcore/iter/mod.rs:1251\r\n  26:     0x564e39447ce8 - <core::iter::Chain<A, B> as core::iter::iterator::Iterator>::next::hde73355ad686dd14\r\n                               at /checkout/src/libcore/iter/mod.rs:758\r\n  27:     0x564e39447aaa - <core::iter::Chain<A, B> as core::iter::iterator::Iterator>::next::h158ea3896fb6310f\r\n                               at /checkout/src/libcore/iter/mod.rs:754\r\n  28:     0x564e39449b76 - itertools::Itertools::join::h6e55fdae653e6cbd\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/itertools-0.6.5/src/lib.rs:1203\r\n  29:     0x564e3943e209 - prost_build::code_generator::CodeGenerator::resolve_ident::hf5ad253193aac324\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/code_generator.rs:574\r\n  30:     0x564e3943d192 - prost_build::code_generator::CodeGenerator::unpack_service::{{closure}}::h00de60f26a10433d\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/code_generator.rs:477\r\n  31:     0x564e39433c77 - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &'a mut F>::call_once::h4b79d43010f986cb\r\n                               at /checkout/src/libcore/ops/function.rs:271\r\n  32:     0x564e3940ce5e - <core::option::Option<T>>::map::h933162c45fb6401e\r\n                               at /checkout/src/libcore/option.rs:404\r\n  33:     0x564e394476c3 - <core::iter::Map<I, F> as core::iter::iterator::Iterator>::next::h0913e1a7621c5c9e\r\n                               at /checkout/src/libcore/iter/mod.rs:1251\r\n  34:     0x564e3941dc9c - <alloc::vec::Vec<T> as alloc::vec::SpecExtend<T, I>>::spec_extend::hb997b01e2b5e5058\r\n                               at /checkout/src/liballoc/vec.rs:1844\r\n  35:     0x564e3941ed6e - <alloc::vec::Vec<T> as alloc::vec::SpecExtend<T, I>>::from_iter::h777d37041a1c7591\r\n                               at /checkout/src/liballoc/vec.rs:1827\r\n  36:     0x564e3941f336 - <alloc::vec::Vec<T> as core::iter::traits::FromIterator<T>>::from_iter::h43714bb9d059e0ac\r\n                               at /checkout/src/liballoc/vec.rs:1713\r\n  37:     0x564e39444c87 - core::iter::iterator::Iterator::collect::h436cb81ed82afe86\r\n                               at /checkout/src/libcore/iter/iterator.rs:1298\r\n  38:     0x564e3943ca1b - prost_build::code_generator::CodeGenerator::unpack_service::hfea0f83504e71fec\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/code_generator.rs:465\r\n  39:     0x564e39434d87 - prost_build::code_generator::CodeGenerator::generate::hab3bbb91478da3b9\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/code_generator.rs:111\r\n  40:     0x564e3940a9c4 - prost_build::Config::generate::hd148016b47bb16b0\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/lib.rs:342\r\n  41:     0x564e393d1aff - prost_build::Config::compile_protos::hc4c921ff79be61f5\r\n                               at /home/vorner/.cargo/registry/src/github.com-1ecc6299db9ec823/prost-build-0.2.3/src/lib.rs:321\r\n  42:     0x564e393e02e6 - tower_grpc_build::Config::build::h85b9824f7574fc87\r\n                               at /home/vorner/.cargo/git/checkouts/tower-grpc-02dc54165a968a91/a844add/tower-grpc-build/src/lib.rs:92\r\n  43:     0x564e393dde07 - sscli::main::h0f8da34d077bac22\r\n                               at src/main.rs:4\r\n  44:     0x564e393e0171 - std::rt::lang_start::{{closure}}::h115d56dea3cc829d\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  45:     0x564e394e89d7 - std::panicking::try::do_call::h9688ac8626758e25\r\n                               at /checkout/src/libstd/rt.rs:59\r\n                               at /checkout/src/libstd/panicking.rs:480\r\n  46:     0x564e395069fe - __rust_maybe_catch_panic\r\n                               at /checkout/src/libpanic_unwind/lib.rs:101\r\n  47:     0x564e394edfd5 - std::rt::lang_start_internal::ha33cbd0fd3958dd3\r\n                               at /checkout/src/libstd/panicking.rs:459\r\n                               at /checkout/src/libstd/panic.rs:365\r\n                               at /checkout/src/libstd/rt.rs:58\r\n  48:     0x564e393e0151 - std::rt::lang_start::h40dceadf8934dbfd\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  49:     0x564e393dde5d - main\r\n  50:     0x7f0656239040 - __libc_start_main\r\n  51:     0x564e393934d9 - _start\r\n  52:                0x0 - <unknown>\r\n```\r\n\r\nIt is likely something fishy is happening in some of the development branches, but I still suspect something strange happening in the compiler, both because of the uninitialized memory (or, memory looking uninitialized) and because it passes on stable, but not nightly.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47175/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47175/timeline", "performed_via_github_app": null, "state_reason": "completed"}