{"url": "https://api.github.com/repos/rust-lang/rust/issues/107868", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107868/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107868/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107868/events", "html_url": "https://github.com/rust-lang/rust/issues/107868", "id": 1578950237, "node_id": "I_kwDOAAsO6M5eHN5d", "number": 107868, "title": "Internal segfault when cross-compiling to arm32 --release", "user": {"login": "adamspofford-dfinity", "id": 93943719, "node_id": "U_kgDOBZl3pw", "avatar_url": "https://avatars.githubusercontent.com/u/93943719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adamspofford-dfinity", "html_url": "https://github.com/adamspofford-dfinity", "followers_url": "https://api.github.com/users/adamspofford-dfinity/followers", "following_url": "https://api.github.com/users/adamspofford-dfinity/following{/other_user}", "gists_url": "https://api.github.com/users/adamspofford-dfinity/gists{/gist_id}", "starred_url": "https://api.github.com/users/adamspofford-dfinity/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adamspofford-dfinity/subscriptions", "organizations_url": "https://api.github.com/users/adamspofford-dfinity/orgs", "repos_url": "https://api.github.com/users/adamspofford-dfinity/repos", "events_url": "https://api.github.com/users/adamspofford-dfinity/events{/privacy}", "received_events_url": "https://api.github.com/users/adamspofford-dfinity/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-02-10T04:05:29Z", "updated_at": "2023-02-10T23:18:40Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n-->\r\n\r\nRustc segfaults on the following crate on 1.67.1, and nightly-2023-02-09 (and a good bit back - at least since 1.61) when cross-compiled to arm-unknown-linux-gnueabihf, but only if built on opt-level=3. `resolver = \"1\"` is just used to force build scripts to build openssl from source too; the segfault also occurs if that line is removed and OpenSSL is installed normally (see the provided Cross.toml).\r\n\r\n### Code\r\n\r\nCargo.toml:\r\n\r\n```toml\r\n[package]\r\nname = \"test-segfault\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\nresolver = \"1\"\r\n\r\n[dependencies]\r\nic-crypto-internal-threshold-sig-ecdsa = { git = \"https://github.com/dfinity/ic\", rev = \"7bef7166811204c044c70939c33d3e705c8c3897\" }\r\nopenssl = { version = \"0.10\", features = [\"vendored\"] }\r\n```\r\n\r\n([Source](https://github.com/dfinity/ic/tree/master/rs/crypto/internal/crypto_lib/threshold_sig/tecdsa))\r\n\r\n<details><summary>Cross.toml (optional)</summary>\r\n\r\n```toml\r\n[build]\r\npre-build = [\"apt-get update && apt-get install --assume-yes libssl-dev\"]\r\n```\r\n\r\n</details>\r\n\r\nCommand:\r\n\r\n```sh\r\ncross build --target arm-unknown-linux-gnueabihf --release\r\n```\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.67.1 (d5a82bbd2 2023-02-07)\r\nbinary: rustc\r\ncommit-hash: d5a82bbd26e1ad8b7401f6a718a9c57c96905483\r\ncommit-date: 2023-02-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.67.1\r\nLLVM version: 15.0.6\r\n```\r\n```\r\nrustc 1.69.0-nightly (8996ea93b 2023-02-09)\r\nbinary: rustc\r\ncommit-hash: 8996ea93b6e554148c4286e62b613f12a3ee505c\r\ncommit-date: 2023-02-09\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.69.0-nightly\r\nLLVM version: 15.0.7\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x325f1a3)[0x7fa8bb7a81a3]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12980)[0x7fa8b7f30980]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(+0x63e9f2c)[0x7fa8b7201f2c]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(+0x59e8292)[0x7fa8b6800292]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm16SelectionDAGISel17CodeGenAndEmitDAGEv+0x11d9)[0x7fa8b658a659]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm16SelectionDAGISel20SelectAllBasicBlocksERKNS_8FunctionE+0x1306)[0x7fa8b683ea48]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm16SelectionDAGISel20runOnMachineFunctionERNS_15MachineFunctionE+0x410)[0x7fa8b6841890]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(+0x464bab1)[0x7fa8b5463ab1]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE+0xb2c)[0x7fa8b679193c]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm13FPPassManager11runOnModuleERNS_6ModuleE+0x2f)[0x7fa8b6790def]\r\n/rust/lib/libLLVM-15-rust-1.67.1-stable.so(_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE+0x21a)[0x7fa8b6517360]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x2749b22)[0x7fa8bac92b22]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x27494c5)[0x7fa8bac924c5]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x2747407)[0x7fa8bac90407]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x27445cd)[0x7fa8bac8d5cd]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x27434e7)[0x7fa8bac8c4e7]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x274233f)[0x7fa8bac8b33f]\r\n/rust/lib/librustc_driver-710574fabae712f8.so(+0x26a8c36)[0x7fa8babf1c36]\r\n/rust/lib/libstd-c6192dd4c4d410ac.so(rust_metadata_std_359ab902947f5f0b+0x10c803)[0x7fa8bc9c5803]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x76db)[0x7fa8b7f256db]\r\n/lib/x86_64-linux-gnu/libc.so.6(clone+0x3f)[0x7fa8b7c4e61f]\r\nerror: could not compile `ic-crypto-internal-threshold-sig-ecdsa`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name ic_crypto_internal_threshold_sig_ecdsa --edition=2021 /cargo/git/checkouts/ic-ca00ee28655ee32e/7bef716/rs/crypto/internal/crypto_lib/threshold_sig/tecdsa/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C embed-bitcode=no -C metadata=5658081b45d03b8e -C extra-filename=-5658081b45d03b8e --out-dir /target/arm-unknown-linux-gnueabihf/release/deps --target arm-unknown-linux-gnueabihf -C linker=arm-unknown-linux-gnueabihf-gcc -L dependency=/target/arm-unknown-linux-gnueabihf/release/deps -L dependency=/target/release/deps --extern fe_derive=/target/release/deps/libfe_derive-6145351e853bc244.so --extern hex=/target/arm-unknown-linux-gnueabihf/release/deps/libhex-1d2acbd050dcda70.rmeta --extern hex_literal=/target/release/deps/libhex_literal-aa1a8889e0d85c74.so --extern ic_crypto_internal_hmac=/target/arm-unknown-linux-gnueabihf/release/deps/libic_crypto_internal_hmac-0527c81bf33a2263.rmeta --extern ic_crypto_internal_seed=/target/arm-unknown-linux-gnueabihf/release/deps/libic_crypto_internal_seed-9651940a0c0a0b54.rmeta --extern ic_crypto_internal_types=/target/arm-unknown-linux-gnueabihf/release/deps/libic_crypto_internal_types-8cf76e7560b6af7c.rmeta --extern ic_crypto_sha=/target/arm-unknown-linux-gnueabihf/release/deps/libic_crypto_sha-4aca1db4bfeda5fd.rmeta --extern ic_types=/target/arm-unknown-linux-gnueabihf/release/deps/libic_types-9d799243aafdd578.rmeta --extern k256=/target/arm-unknown-linux-gnueabihf/release/deps/libk256-1dcf500b878e2bbd.rmeta --extern lazy_static=/target/arm-unknown-linux-gnueabihf/release/deps/liblazy_static-added3069e70bf89.rmeta --extern p256=/target/arm-unknown-linux-gnueabihf/release/deps/libp256-a0e7f3eb02a0768b.rmeta --extern paste=/target/release/deps/libpaste-2e6d8847b5aff82f.so --extern rand=/target/arm-unknown-linux-gnueabihf/release/deps/librand-2e052310e627cf80.rmeta --extern rand_chacha=/target/arm-unknown-linux-gnueabihf/release/deps/librand_chacha-ff08df3f680338be.rmeta --extern serde=/target/arm-unknown-linux-gnueabihf/release/deps/libserde-093279e46761f9bc.rmeta --extern serde_bytes=/target/arm-unknown-linux-gnueabihf/release/deps/libserde_bytes-e00731949f5f0e43.rmeta --extern serde_cbor=/target/arm-unknown-linux-gnueabihf/release/deps/libserde_cbor-73ce0baae4841a34.rmeta --extern subtle=/target/arm-unknown-linux-gnueabihf/release/deps/libsubtle-c5d00340592154ec.rmeta --extern zeroize=/target/arm-unknown-linux-gnueabihf/release/deps/libzeroize-afbe04cdd147be8e.rmeta --cap-lints allow -L native=/target/arm-unknown-linux-gnueabihf/release/build/openssl-sys-9b33cacbf7ef279f/out/openssl-build/install/lib` (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n\r\nNo backtrace was available as it was a segfault; the provided output was captured with `RUST_BACKTRACE=1`. ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107868/timeline", "performed_via_github_app": null, "state_reason": null}