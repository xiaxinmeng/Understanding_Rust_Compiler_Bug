{"url": "https://api.github.com/repos/rust-lang/rust/issues/82825", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82825/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82825/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82825/events", "html_url": "https://github.com/rust-lang/rust/issues/82825", "id": 823565372, "node_id": "MDU6SXNzdWU4MjM1NjUzNzI=", "number": 82825, "title": "Method resolution fails when through a reference to a trait object on Self: Sized methods", "user": {"login": "guswynn", "id": 5404303, "node_id": "MDQ6VXNlcjU0MDQzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5404303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guswynn", "html_url": "https://github.com/guswynn", "followers_url": "https://api.github.com/users/guswynn/followers", "following_url": "https://api.github.com/users/guswynn/following{/other_user}", "gists_url": "https://api.github.com/users/guswynn/gists{/gist_id}", "starred_url": "https://api.github.com/users/guswynn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guswynn/subscriptions", "organizations_url": "https://api.github.com/users/guswynn/orgs", "repos_url": "https://api.github.com/users/guswynn/repos", "events_url": "https://api.github.com/users/guswynn/events{/privacy}", "received_events_url": "https://api.github.com/users/guswynn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 4172483496, "node_id": "LA_kwDOAAsO6M74swuo", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-types", "name": "T-types", "color": "bfd4f2", "default": false, "description": "Relevant to the types team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-03-06T05:02:45Z", "updated_at": "2023-04-05T17:39:47Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\ntrait Trait {\r\n    fn static_call(&self) where Self: Sized;\r\n    \r\n    fn maybe_dynamic_call(&self) {\r\n        unimplemented!(\"unsupported maybe_dynamic_call\");\r\n    }\r\n}\r\n\r\nimpl<T: ?Sized + Trait> Trait for &T {\r\n    fn static_call(&self) where Self: Sized {\r\n        (**self).maybe_dynamic_call();\r\n    }\r\n}\r\n\r\nfn foo(x: &dyn Trait) {\r\n    // Works.\r\n    (&x).static_call();\r\n    \r\n    // Doesn't work (goes through `dyn Trait: Trait`,\r\n    // despite `static_call` not being object-safe)\r\n    x.static_call();\r\n}\r\n```\r\n(playground: https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=8d985c6ac7adc1a9835d4c7b5cd74f31)\r\n\r\nTo me it appears that method resolution should autoref and find the impl on the `&T` automatically, as the `Self: Sized` should be \r\n\r\nNote that this is specific to &self/&mut self methods, and by-value receivers work, like MANY of the methods on `Iterator`:\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=4dbe34cf1ffec880d225d96bd2370907 (rustc even gives an extremely good diagnostic about & vs &mut), though its unclear to me why in that cause, `next` is callable in that case, but I think it's because it lacks the `Self: Sized` bound)\r\n\r\n(note that the origin of this issue is me investigating how to stabilize the not-yet implemented `std::stream::Stream::next` https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=7e9fe3092902bafe9e5ae607a12e9b4e)\r\n\r\nThanks @eddyb for helping me minimize this and suggesting that this may be possible to resolve in a simple way.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82825/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82825/timeline", "performed_via_github_app": null, "state_reason": null}