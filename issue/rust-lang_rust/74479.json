{"url": "https://api.github.com/repos/rust-lang/rust/issues/74479", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74479/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74479/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74479/events", "html_url": "https://github.com/rust-lang/rust/issues/74479", "id": 660200418, "node_id": "MDU6SXNzdWU2NjAyMDA0MTg=", "number": 74479, "title": "Tracking Issue for `#![feature(available_parallelism)]`", "user": {"login": "yoshuawuyts", "id": 2467194, "node_id": "MDQ6VXNlcjI0NjcxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2467194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoshuawuyts", "html_url": "https://github.com/yoshuawuyts", "followers_url": "https://api.github.com/users/yoshuawuyts/followers", "following_url": "https://api.github.com/users/yoshuawuyts/following{/other_user}", "gists_url": "https://api.github.com/users/yoshuawuyts/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoshuawuyts/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoshuawuyts/subscriptions", "organizations_url": "https://api.github.com/users/yoshuawuyts/orgs", "repos_url": "https://api.github.com/users/yoshuawuyts/repos", "events_url": "https://api.github.com/users/yoshuawuyts/events{/privacy}", "received_events_url": "https://api.github.com/users/yoshuawuyts/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9695584, "node_id": "MDU6TGFiZWw5Njk1NTg0", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-concurrency", "name": "A-concurrency", "color": "f7e101", "default": false, "description": "Area: Concurrency related issues."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 246778137, "node_id": "MDU6TGFiZWwyNDY3NzgxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/B-unstable", "name": "B-unstable", "color": "d304cb", "default": false, "description": "Implemented in the nightly compiler and unstable."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 919710011, "node_id": "MDU6TGFiZWw5MTk3MTAwMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-merge", "name": "disposition-merge", "color": "008800", "default": false, "description": "This issue / PR is in PFCP or FCP with a disposition to merge it."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}, {"id": 2240305001, "node_id": "MDU6TGFiZWwyMjQwMzA1MDAx", "url": "https://api.github.com/repos/rust-lang/rust/labels/Libs-Tracked", "name": "Libs-Tracked", "color": "d4c5f9", "default": false, "description": "Libs issues that are tracked on the team's project board."}, {"id": 2240342704, "node_id": "MDU6TGFiZWwyMjQwMzQyNzA0", "url": "https://api.github.com/repos/rust-lang/rust/labels/Libs-Small", "name": "Libs-Small", "color": "d4c5f9", "default": false, "description": "Libs issues that are considered \"small\" or self-contained"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 39, "created_at": "2020-07-18T15:06:15Z", "updated_at": "2022-03-02T23:50:50Z", "closed_at": "2022-01-08T08:55:28Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The feature gate for the issue is `#![feature(available_parallelism)]`.\r\n\r\nThis is a tracking issue for `std::thread::available_parallelism`; a portable API to determine how many threads to spawn in order to ensure a program can make use of all available parallelism available on a machine.\r\n\r\n[stabilization-guide]: https://rustc-dev-guide.rust-lang.org/stabilization_guide.html#stabilization-pr\r\n[doc-guide]: https://rustc-dev-guide.rust-lang.org/stabilization_guide.html#documentation-prs\r\n\r\n### Public API\r\n\r\n<!--\r\nFor most library features, it'd be useful to include a summarized version of the public API.\r\n(E.g. just the public function signatures without their doc comments or implementation.)\r\n-->\r\n\r\n```rust\r\n#![feature(available_parallelism)]\r\nuse std::thread;\r\n\r\nfn main() -> std::io::Result<()> {\r\n    let count = thread::available_parallelism()?.get();\r\n    assert!(count >= 1);\r\n    Ok(())\r\n}\r\n```\r\n\r\n### Tasks\r\n\r\n- [x] Resolve discussion on naming.\r\n- [x] Resolve discussion on function signature.\r\n- [x] Resolve discussion on terminology.\r\n- [x] Add support for externally-set limits on Linux ([ref](https://github.com/rust-lang/rust/pull/89310)).\r\n- [ ] Add support for externally-set limits on Windows ([ref](https://github.com/rust-lang/rust/pull/74480#issuecomment-673311001)).\r\n- [x] Update documentation to remove mentions of \"hardware\" ([ref](https://github.com/rust-lang/rust/pull/89324#issuecomment-934343254)).\r\n- [x] Smooth out the docs example.\r\n\r\n### Notes on Platform-specific behavior\r\n\r\n`available_parallelism` is (for now) only considered a hint. The following platform limitations exist:\r\n\r\n- On Windows the available concurrency may be undercounted when exceeding 64 threads https://github.com/rust-lang/rust/pull/74480#issuecomment-660557465\r\n- On Windows the available concurrency may be overcounted when limited by a process wide affinity mask or job object limitations https://github.com/rust-lang/rust/pull/74480#issuecomment-673311001\r\n- On Linux the available concurrency may be overcounted in the face of cgroup limits and task-wise affinity masks https://github.com/rust-lang/rust/pull/74480#issuecomment-693390069\r\n\r\n### Implementation history\r\n\r\n<!--\r\nInclude a list of all the PRs that were involved in implementing the feature.\r\n-->\r\n\r\n- https://github.com/rust-lang/rust/pull/74480\r\n- https://github.com/rust-lang/rust/pull/85182\r\n- https://github.com/rust-lang/rust/pull/89310\r\n- https://github.com/rust-lang/rust/pull/89324\r\n- https://github.com/rust-lang/rust/pull/92697\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74479/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74479/timeline", "performed_via_github_app": null, "state_reason": "completed"}