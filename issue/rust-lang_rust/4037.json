{"url": "https://api.github.com/repos/rust-lang/rust/issues/4037", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4037/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4037/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4037/events", "html_url": "https://github.com/rust-lang/rust/issues/4037", "id": 8640748, "node_id": "MDU6SXNzdWU4NjQwNzQ4", "number": 4037, "title": "Segfault in reflection on enum variants", "user": {"login": "cdleary", "id": 123475, "node_id": "MDQ6VXNlcjEyMzQ3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/123475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cdleary", "html_url": "https://github.com/cdleary", "followers_url": "https://api.github.com/users/cdleary/followers", "following_url": "https://api.github.com/users/cdleary/following{/other_user}", "gists_url": "https://api.github.com/users/cdleary/gists{/gist_id}", "starred_url": "https://api.github.com/users/cdleary/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cdleary/subscriptions", "organizations_url": "https://api.github.com/users/cdleary/orgs", "repos_url": "https://api.github.com/users/cdleary/repos", "events_url": "https://api.github.com/users/cdleary/events{/privacy}", "received_events_url": "https://api.github.com/users/cdleary/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/9", "html_url": "https://github.com/rust-lang/rust/milestone/9", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/9/labels", "id": 194126, "node_id": "MDk6TWlsZXN0b25lMTk0MTI2", "number": 9, "title": "0.6", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 203, "state": "closed", "created_at": "2012-10-11T18:15:24Z", "updated_at": "2015-01-21T01:43:22Z", "due_on": "2013-03-25T07:00:00Z", "closed_at": "2013-04-02T18:27:52Z"}, "comments": 1, "created_at": "2012-11-25T03:23:04Z", "updated_at": "2013-03-20T23:12:59Z", "closed_at": "2013-03-20T23:12:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Version: rustc 0.5 (68c73dc 2012-11-18 15:00:43 -0800)\n\n``` rust\nenum recursive_type {\n    recursive_value(~recursive_type, ~recursive_type),\n    leaf\n}\n\nfn main() {\n    let r = recursive_value(~leaf, ~leaf);\n    repr::write_repr2(io::stdout(), &r);\n    io::println(\"\");\n}\n```\n\nBacktrace:\n\n```\n(gdb) r\nStarting program: /home/cdleary/tmp/crasher \n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\n[New Thread 0x7ffff7ff7700 (LWP 575)]\n[New Thread 0x7ffff7ff2700 (LWP 576)]\n~~\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7ffff7ff2700 (LWP 576)]\n0x00007ffff7aa3b3d in repr::__extensions__::meth_11970::visit_uniq::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n(gdb) bt\n#0  0x00007ffff7aa3b3d in repr::__extensions__::meth_11970::visit_uniq::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#1  0x00007ffff7aa3a4d in reflect::__extensions__::visit_uniq_11962::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#2  0x0000000000403817 in glue_visit_1774 ()\n#3  0x00007ffff7aa580b in repr::__extensions__::meth_12084::visit_enum_variant_field::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#4  0x00007ffff7aa5697 in reflect::__extensions__::visit_enum_variant_field_12082::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#5  0x00007ffff7ab50a0 in __morestack () from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#6  0x0000000000403604 in glue_visit_1770 ()\n#7  0x00007ffff7aa3c5f in repr::__extensions__::meth_11970::visit_uniq::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#8  0x00007ffff7aa3a4d in reflect::__extensions__::visit_uniq_11962::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#9  0x0000000000403817 in glue_visit_1774 ()\n#10 0x00007ffff7aa580b in repr::__extensions__::meth_12084::visit_enum_variant_field::_73a2decbe7873a81::_05 ()\n   from /home/cdleary/tmp/../opt/rust-master/lib/rustc/x86_64-unknown-linux-gnu/lib/libcore-c3ca5d77d81b46c1-0.5.so\n#11 0x0000000000407e2d in reflect::__extensions__::visit_enum_variant_field_2138::_1634aa8effcb368::_00 ()\n#12 0x0000000000403604 in glue_visit_1770 ()\n#13 0x000000000040410b in intrinsic::rusti::visit_tydesc_1822::_b1c47c813447841::_00 ()\n#14 0x0000000000403bc5 in repr::write_repr2_1785::_31ee5679ee539e47::_00 ()\n#15 0x0000000000408a48 in __morestack ()\n#16 0x0000000000403093 in main::_9ef9bf229154ee9::_00 ()\n#17 0x000000000040313e in _rust_main ()\n#18 0x00007ffff77c0044 in task_start_wrapper (a=0x610ff0) at /home/cdleary/src/rust/src/rt/rust_task.cpp:150\n#19 0x0000000000000000 in ?? ()\n(gdb) x/10i $pc\n=> 0x7ffff7aa3b3d <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+205>:   mov    (%rax),%r13\n   0x7ffff7aa3b40 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+208>:   lea    -0x70(%rbp),%r12\n   0x7ffff7aa3b44 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+212>:   mov    0x8(%rbx),%rax\n   0x7ffff7aa3b48 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+216>:   mov    0x10(%rbx),%rcx\n   0x7ffff7aa3b4c <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+220>:   mov    %rcx,-0x68(%rbp)\n   0x7ffff7aa3b50 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+224>:   mov    %rax,-0x70(%rbp)\n   0x7ffff7aa3b54 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+228>:   xor    %edi,%edi\n   0x7ffff7aa3b56 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+230>:   xor    %esi,%esi\n   0x7ffff7aa3b58 <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+232>:   xor    %edx,%edx\n   0x7ffff7aa3b5a <_ZN4repr14__extensions__10meth_1197010visit_uniq17_73a2decbe7873a813_05E+234>:   mov    %r12,%rcx\n(gdb) p $rax\n$1 = 32\n```\n\nNot too familiar with how these raw types will codegen, but I'll attempt some printf debugging in repr.rs to see if anything obvious to fix pops out.\n", "closed_by": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4037/timeline", "performed_via_github_app": null, "state_reason": "completed"}