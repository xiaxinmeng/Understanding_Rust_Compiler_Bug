{"url": "https://api.github.com/repos/rust-lang/rust/issues/100882", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100882/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100882/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100882/events", "html_url": "https://github.com/rust-lang/rust/issues/100882", "id": 1346600350, "node_id": "I_kwDOAAsO6M5QQ32e", "number": 100882, "title": "Type inference breaks from a seemingly unrelated change", "user": {"login": "kamulos", "id": 5168812, "node_id": "MDQ6VXNlcjUxNjg4MTI=", "avatar_url": "https://avatars.githubusercontent.com/u/5168812?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamulos", "html_url": "https://github.com/kamulos", "followers_url": "https://api.github.com/users/kamulos/followers", "following_url": "https://api.github.com/users/kamulos/following{/other_user}", "gists_url": "https://api.github.com/users/kamulos/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamulos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamulos/subscriptions", "organizations_url": "https://api.github.com/users/kamulos/orgs", "repos_url": "https://api.github.com/users/kamulos/repos", "events_url": "https://api.github.com/users/kamulos/events{/privacy}", "received_events_url": "https://api.github.com/users/kamulos/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604454086, "node_id": "MDU6TGFiZWw2MDQ0NTQwODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inference", "name": "A-inference", "color": "f7e101", "default": false, "description": "Area: Type inference"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-08-22T15:29:35Z", "updated_at": "2023-03-14T11:26:16Z", "closed_at": "2023-03-14T11:26:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was just making changes in one of the crates in my workspace, when the code broke in another crate of the workspace. Rust is no longer able to infer the type automatically, with an explicit annotation it works again.\r\n\r\nFeel free to close this bug report if this is to be expected, but to me this seems very unusual for Rust.\r\n\r\nThis is the code:\r\n\r\n```rust\r\nuse serde::{Deserialize, Serialize};\r\n\r\n#[derive(Serialize, Deserialize)]\r\nstruct S {}\r\n\r\nfn main() {\r\n    // let s: S = serde_json::from_str(\"\").unwrap();\r\n}\r\n\r\nfn check_len(len: &str) {\r\n    let vec = vec![1, 2, 3];\r\n\r\n    if vec.len() != len.parse().unwrap() {\r\n        panic!();\r\n    }\r\n}\r\n```\r\n\r\nUncomment the `serde_json` line to trigger the bug. After uncommenting Rust needs an explicit type annotation as `usize` for `len.parse()`.\r\n\r\n\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0-nightly (c0941dfb5 2022-08-21)\r\nbinary: rustc\r\ncommit-hash: c0941dfb5a7d07ef2d70cc54d319669d9d6f6c01\r\ncommit-date: 2022-08-21\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.65.0-nightly\r\nLLVM version: 15.0.0\r\n```\r\n\r\nThis occurs also with the stable and beta compiler", "closed_by": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100882/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100882/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}