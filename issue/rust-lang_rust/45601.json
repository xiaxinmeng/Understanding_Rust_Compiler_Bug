{"url": "https://api.github.com/repos/rust-lang/rust/issues/45601", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45601/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45601/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45601/events", "html_url": "https://github.com/rust-lang/rust/issues/45601", "id": 269357851, "node_id": "MDU6SXNzdWUyNjkzNTc4NTE=", "number": 45601, "title": "Avoid the `proc_macro` crate being dynamically linked. ", "user": {"login": "mystor", "id": 1261662, "node_id": "MDQ6VXNlcjEyNjE2NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/1261662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mystor", "html_url": "https://github.com/mystor", "followers_url": "https://api.github.com/users/mystor/followers", "following_url": "https://api.github.com/users/mystor/following{/other_user}", "gists_url": "https://api.github.com/users/mystor/gists{/gist_id}", "starred_url": "https://api.github.com/users/mystor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mystor/subscriptions", "organizations_url": "https://api.github.com/users/mystor/orgs", "repos_url": "https://api.github.com/users/mystor/repos", "events_url": "https://api.github.com/users/mystor/events{/privacy}", "received_events_url": "https://api.github.com/users/mystor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 632573348, "node_id": "MDU6TGFiZWw2MzI1NzMzNDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-2.0", "name": "A-macros-2.0", "color": "f7e101", "default": false, "description": "Area: declarative macros 2.0, https://github.com/rust-lang/rust/issues/39412"}, {"id": 941498014, "node_id": "MDU6TGFiZWw5NDE0OTgwMTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-1.2", "name": "A-macros-1.2", "color": "f7e101", "default": false, "description": "Issues which affect macros 1.2"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-10-28T23:23:27Z", "updated_at": "2019-10-30T18:16:06Z", "closed_at": "2019-10-30T18:16:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Currently the `proc_macro` crate is dynamically linked. This is so that it can be provided by the compiler when writing procedural macros and has access to unstable compiler internals.\r\n\r\nUnfortunately, it's possible for programs which are not compiler plugins to `extern crate proc_macro`. This happens right now if you use any crate which wants to provide conversions for its types from `proc_macro::TokenStream`. This can potentially happen deep in your dependencies without it being obvious. This means that suddenly your program will no longer work when run on systems which either don't have the same version of the `proc_macro` dylib installed, or which don't have it installed at all.\r\n\r\nIdeally, for the best experience, we'd make the `proc_macro` crate a small statically linked shim, which when loaded into the compiler, uses `dlsym(3)` (and the windows equivalent) to actually gain access to compiler internals. When not loaded into the compiler, it would panic when used like it does today.\r\n\r\nThis way crates which depend on `proc_macro` to provide things like `From` impls won't be accidental footguns which break end user applications. IIRC @dtolnay has run into this in the past with the `proc_macro_hack` crate, and the current master version of `syn` has this problem as well.\r\n\r\ncc @alexcrichton who I talked to about this a bit at Rust Belt Rust.", "closed_by": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45601/timeline", "performed_via_github_app": null, "state_reason": "completed"}