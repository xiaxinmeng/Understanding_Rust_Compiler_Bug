{"url": "https://api.github.com/repos/rust-lang/rust/issues/44683", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44683/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44683/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44683/events", "html_url": "https://github.com/rust-lang/rust/issues/44683", "id": 258603756, "node_id": "MDU6SXNzdWUyNTg2MDM3NTY=", "number": 44683, "title": "1.19 powerpc64le run-pass test failure: smallest-hello-world sometimes has bad interaction with --gc-sections", "user": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-18T20:03:34Z", "updated_at": "2017-09-19T10:21:41Z", "closed_at": "2017-09-19T10:21:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This test fails on [Debian](https://buildd.debian.org/status/fetch.php?pkg=rustc&arch=ppc64el&ver=1.19.0%2Bdfsg3-1&stamp=1505722097&raw=0) but not [Fedora](https://kojipkgs.fedoraproject.org//packages/rust/1.20.0/2.fc28/data/logs/ppc64le/build.log). I can also reproduce it with the clean 1.19.0 tarball without Debian patches, but `./configure`-d to use Debian's LLVM 4.0.\r\n\r\n~~~~\r\n------stderr------------------------------\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/stage2/lib/rustlib/powerpc64le-unknown-linux-gnu/lib\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/test/run-pass/smallest-hello-world.0.o\" \"-o\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/test/run-pass/smallest-hello-world.stage2-powerpc64le-unknown-linux-gnu\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-O1\" \"-nodefaultlibs\" \"-L\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/test/run-pass\" \"-L\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/test/run-pass/smallest-hello-world.stage2-powerpc64le-unknown-linux-gnu.run-pass.libaux\" \"-L\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/native/rust-test-helpers\" \"-L\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/stage2/lib/rustlib/powerpc64le-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/stage2/lib/rustlib/powerpc64le-unknown-linux-gnu/lib/liblibc-5281d33b9c81245c.rlib\" \"/<<BUILDDIR>>/rustc-1.19.0+dfsg3/build/powerpc64le-unknown-linux-gnu/stage2/lib/rustlib/powerpc64le-unknown-linux-gnu/lib/libcore-5c2b844a2a519641.rlib\" \"-Wl,-Bdynamic\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-l\" \"util\" \"-Wl,-rpath,/usr/lib/rustlib/powerpc64le-unknown-linux-gnu/lib\" \"-Wl,--enable-new-dtags\"\r\n  = note: /usr/bin/ld: stubs don't match calculated size\r\n          /usr/bin/ld: can not build stubs: Invalid operation\r\n          collect2: error: ld returned 1 exit status\r\n          \r\n\r\nerror: aborting due to previous error(s)\r\n------------------------------------------\r\n~~~~\r\n\r\nAs indicated by the error message there is a long `cc` invocation. If I run it manually, I get the same failure. However if I remove the `\"-Wl,--gc-sections\"` flag then the compilation succeeds. Adding `\"-Wl,--print-gc-sections\"` gives me:\r\n\r\n~~~~\r\n(experimental_ppc64el-dchroot)infinity0@plummer:~/rustc-1.19.0-src$ sh test.sh\r\n/usr/bin/ld: Removing unused section '.rodata.cst4' in file '/usr/lib/gcc/powerpc64le-linux-gnu/7/../../../powerpc64le-linux-gnu/Scrt1.o'\r\n/usr/bin/ld: Removing unused section '.data' in file '/usr/lib/gcc/powerpc64le-linux-gnu/7/../../../powerpc64le-linux-gnu/Scrt1.o'\r\n/usr/bin/ld: Removing unused section '.text.rust_eh_register_frames' in file '/home/infinity0/rustc-1.19.0-src/build/powerpc64le-unknown-linux-gnu/test/run-pass/smallest-hello-world.0.o'\r\n/usr/bin/ld: Removing unused section '.text.rust_eh_unregister_frames' in file '/home/infinity0/rustc-1.19.0-src/build/powerpc64le-unknown-linux-gnu/test/run-pass/smallest-hello-world.0.o'\r\n/usr/bin/ld: stubs don't match calculated size\r\n/usr/bin/ld: can not build stubs: Invalid operation\r\ncollect2: error: ld returned 1 exit status\r\n~~~~\r\n", "closed_by": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44683/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44683/timeline", "performed_via_github_app": null, "state_reason": "completed"}