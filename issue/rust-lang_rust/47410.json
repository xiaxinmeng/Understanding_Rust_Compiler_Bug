{"url": "https://api.github.com/repos/rust-lang/rust/issues/47410", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47410/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47410/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47410/events", "html_url": "https://github.com/rust-lang/rust/issues/47410", "id": 288316727, "node_id": "MDU6SXNzdWUyODgzMTY3Mjc=", "number": 47410, "title": "Bug optimization", "user": {"login": "aristarh2704", "id": 23471474, "node_id": "MDQ6VXNlcjIzNDcxNDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23471474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aristarh2704", "html_url": "https://github.com/aristarh2704", "followers_url": "https://api.github.com/users/aristarh2704/followers", "following_url": "https://api.github.com/users/aristarh2704/following{/other_user}", "gists_url": "https://api.github.com/users/aristarh2704/gists{/gist_id}", "starred_url": "https://api.github.com/users/aristarh2704/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aristarh2704/subscriptions", "organizations_url": "https://api.github.com/users/aristarh2704/orgs", "repos_url": "https://api.github.com/users/aristarh2704/repos", "events_url": "https://api.github.com/users/aristarh2704/events{/privacy}", "received_events_url": "https://api.github.com/users/aristarh2704/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2018-01-13T09:48:10Z", "updated_at": "2018-01-15T17:07:42Z", "closed_at": "2018-01-13T12:09:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I write this code:\r\n\r\n> pub fn clean(x:isize){\r\n>       unsafe{\r\n>       let mut buffer=0xb8000 as *mut u8;\r\n>         let mut y=0;\r\n>         while y<(80 * 25 * 2){\r\n>             let mut p=buffer.offset(y);\r\n>             *buffer.offset(y)=0x00;\r\n>             y=y+1;\r\n>             *buffer.offset(y)=0x20;\r\n>              y=y+1;\r\n>          }\r\n>      } \r\n>  }\r\n\r\nand compile: \"cargo build --release\"\r\nDisassembling views this:\r\n\r\n> 000000e0 <__ZN6memory5clean17h43e2ddeb8148e2edE>:\r\n>push   %ebp\r\n>mov    %esp,%ebp\r\n>movaps 0x0,%xmm0\r\n>xor    %eax,%eax\r\n>nopl   0x0(%eax)\r\n>movups %xmm0,0xb8010(%eax,%eax,1)\r\n>movups %xmm0,0xb8000(%eax,%eax,1)\r\n>add    $0x10,%eax\r\n>cmp    $0x7d0,%eax\r\n>jne    f0 <__ZN6memory5clean17h43e2ddeb8148e2edE+0x10>\r\n>pop    %ebp\r\n>ret\r\n\r\nIt's not correct code.\r\nBut when I write \r\n\r\n> y=y+x; //x is argument equal 1\r\n\r\n instead of \r\n\r\n> y=y+1;\r\n\r\nit produce this asm:\r\n\r\n> 000000e0 <__ZN6memory5clean17h43e2ddeb8148e2edE>:\r\n> push   %ebp\r\n> mov    %esp,%ebp\r\n> push   %esi\r\n> mov    0x8(%ebp),%eax\r\n> mov    $0xb8000,%ecx\r\n> xor    %esi,%esi\r\n> lea    0xb8000(%eax),%edx\r\n> data16 data16 nopw %cs:0x0(%eax,%eax,1)\r\n> movb   $0x0,(%ecx,%esi,1)\r\n> movb   $0x20,(%edx,%esi,1)\r\n> add    %eax,%esi\r\n> add    %eax,%esi\r\n> cmp    $0xfa0,%esi\r\n> jl     100 <__ZN6memory5clean17h43e2ddeb8148e2edE+0x20>\r\n> pop    %esi\r\n> pop    %ebp\r\n> ret\r\n\r\nwhich is really correct.\r\nRustc version:\r\n\r\n> $ rustc -vV\r\n\r\n> rustc 1.22.1 (05e2e1c41 2017-11-22)\r\n> binary: rustc\r\n> commit-hash: 05e2e1c41414e8fc73d0f267ea8dab1a3eeeaa99\r\n> commit-date: 2017-11-22\r\n> host: i686-pc-windows-gnu\r\n> release: 1.22.1\r\n> LLVM version: 4.0", "closed_by": {"login": "aristarh2704", "id": 23471474, "node_id": "MDQ6VXNlcjIzNDcxNDc0", "avatar_url": "https://avatars.githubusercontent.com/u/23471474?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aristarh2704", "html_url": "https://github.com/aristarh2704", "followers_url": "https://api.github.com/users/aristarh2704/followers", "following_url": "https://api.github.com/users/aristarh2704/following{/other_user}", "gists_url": "https://api.github.com/users/aristarh2704/gists{/gist_id}", "starred_url": "https://api.github.com/users/aristarh2704/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aristarh2704/subscriptions", "organizations_url": "https://api.github.com/users/aristarh2704/orgs", "repos_url": "https://api.github.com/users/aristarh2704/repos", "events_url": "https://api.github.com/users/aristarh2704/events{/privacy}", "received_events_url": "https://api.github.com/users/aristarh2704/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47410/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47410/timeline", "performed_via_github_app": null, "state_reason": "completed"}