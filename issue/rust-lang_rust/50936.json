{"url": "https://api.github.com/repos/rust-lang/rust/issues/50936", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50936/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50936/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50936/events", "html_url": "https://github.com/rust-lang/rust/issues/50936", "id": 324910924, "node_id": "MDU6SXNzdWUzMjQ5MTA5MjQ=", "number": 50936, "title": "Some safe methods in hash/table.rs are not.", "user": {"login": "pythonesque", "id": 923144, "node_id": "MDQ6VXNlcjkyMzE0NA==", "avatar_url": "https://avatars.githubusercontent.com/u/923144?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pythonesque", "html_url": "https://github.com/pythonesque", "followers_url": "https://api.github.com/users/pythonesque/followers", "following_url": "https://api.github.com/users/pythonesque/following{/other_user}", "gists_url": "https://api.github.com/users/pythonesque/gists{/gist_id}", "starred_url": "https://api.github.com/users/pythonesque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pythonesque/subscriptions", "organizations_url": "https://api.github.com/users/pythonesque/orgs", "repos_url": "https://api.github.com/users/pythonesque/repos", "events_url": "https://api.github.com/users/pythonesque/events{/privacy}", "received_events_url": "https://api.github.com/users/pythonesque/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-05-21T13:12:04Z", "updated_at": "2019-12-24T02:32:53Z", "closed_at": "2019-12-24T02:32:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This was pointed out on Twitter as an example of the standard library violating the requirement that unsafe code cannot rely on safe code preserving invariants past the module boundary, instead relying on debug assertions that are turned off in production builds: https://twitter.com/jix_/status/998339990923939840.\r\n\r\n> For example creating a RawTable with capacity 0 (https://github.com/rust-lang/rust/blob/master/src/libstd/collections/hash/table.rs#L809) and then calling https://github.com/rust-lang/rust/blob/master/src/libstd/collections/hash/table.rs#L344 with an arbitrary offset, which will be dereferenced by https://github.com/rust-lang/rust/blob/master/src/libstd/collections/hash/table.rs#L401. The module calls itself \"safe-ish\" and is not public.\r\n\r\nBesides this being wrong, and bad pedagogy (people will assume that if the standard library does it it's okay), the invariant that capacity can't be zero before these are called also seems fairly subtle and not implied by the name of the function.  So it seems to me that making one or more of the methods here unsafe would be a good idea (possibly that of creating a new bucket?).  If it's a very common function in modules that use the raw table, it can always be pulled out into a local unsafe function per module.  Or, if for some reason this actually *is* safe, there should at least be documentation explaining why.", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50936/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50936/timeline", "performed_via_github_app": null, "state_reason": "completed"}