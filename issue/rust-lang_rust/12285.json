{"url": "https://api.github.com/repos/rust-lang/rust/issues/12285", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12285/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12285/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12285/events", "html_url": "https://github.com/rust-lang/rust/issues/12285", "id": 27644157, "node_id": "MDU6SXNzdWUyNzY0NDE1Nw==", "number": 12285, "title": "rustc crashes matching Option<&S> when S is a struct with no fields.", "user": {"login": "jakerr", "id": 322861, "node_id": "MDQ6VXNlcjMyMjg2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/322861?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakerr", "html_url": "https://github.com/jakerr", "followers_url": "https://api.github.com/users/jakerr/followers", "following_url": "https://api.github.com/users/jakerr/following{/other_user}", "gists_url": "https://api.github.com/users/jakerr/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakerr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakerr/subscriptions", "organizations_url": "https://api.github.com/users/jakerr/orgs", "repos_url": "https://api.github.com/users/jakerr/repos", "events_url": "https://api.github.com/users/jakerr/events{/privacy}", "received_events_url": "https://api.github.com/users/jakerr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-02-15T07:01:38Z", "updated_at": "2014-07-04T13:41:29Z", "closed_at": "2014-07-04T13:41:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Version: f0bad904\n\n```\nOSX 10.9.1\nrustc 0.10-pre\nhost: x86_64-apple-darwin\n```\n\nMinimal reproduction:\n\n``` rust\nstruct S;\n\nfn main() {\n  let s = &S;\n  let opt_s: Option<&S> = Some(s);\n  match  opt_s {\n    Some(&S) => println!(\"{:?}\", S),\n    _ => {}\n  }\n}\n```\n\ncauses crash: `error: internal compiler error: only scalars and strings supported in compare_values`\n\nback trace:\n\n```\nBreakpoint 1, 0x00000001000dcf10 in rust_fail ()\n(gdb) bt\n#0  0x00000001000dcf10 in rust_fail ()\n#1  0x00000001000dceee in rt::unwind::Unwinder::begin_unwind::h5bab6b74dc9914dcZVi::v0.10.pre ()\n#2  0x00000001000131a9 in rt::unwind::begin_unwind_inner::h49aeb912c6a4ce4eQ4i::v0.10.pre ()\n#3  0x0000000100a42202 in rt::unwind::begin_unwind::h2c64224fbfd78a986q5::v0.10.pre ()\n#4  0x0000000100a42be0 in diagnostic::Handler::fatal::h41c181a6acba83c3L2b::v0.10.pre ()\n#5  0x0000000100a43158 in diagnostic::Handler::bug::h59bf254d007669aar6b::v0.10.pre ()\n#6  0x0000000100ff20f1 in driver::session::Session_::bug::h1251c6a7576ff383qEj::v0.10.pre ()\n#7  0x00000001011203df in middle::trans::_match::compile_submatch_continue::hd376baa48abf54ad6Mt::v0.10.pre ()\n#8  0x0000000101115e6f in middle::trans::_match::compile_submatch::h9b25cc24b7fe47d0vFt::v0.10.pre ()\n#9  0x000000010111c5dc in middle::trans::_match::compile_submatch_continue::hd376baa48abf54ad6Mt::v0.10.pre ()\n#10 0x0000000101115e6f in middle::trans::_match::compile_submatch::h9b25cc24b7fe47d0vFt::v0.10.pre ()\n#11 0x000000010111ee47 in middle::trans::_match::compile_submatch_continue::hd376baa48abf54ad6Mt::v0.10.pre ()\n#12 0x0000000101115e6f in middle::trans::_match::compile_submatch::h9b25cc24b7fe47d0vFt::v0.10.pre ()\n#13 0x00000001010a9067 in middle::trans::_match::trans_match::h804a8fd442d5bb1aEcu::v0.10.pre ()\n#14 0x000000010109795d in middle::trans::expr::trans_rvalue_dps_unadjusted::hce8904b279cf7d8amuf::v0.10.pre ()\n#15 0x000000010101a312 in middle::trans::expr::trans_into::hced97041bceb57efdAe::v0.10.pre ()\n#16 0x000000010101b027 in middle::trans::controlflow::trans_block::h830e6540e96f62b384a::v0.10.pre ()\n#17 0x00000001010f7f42 in middle::trans::base::trans_closure::h356b84d4c18f206ePep::v0.10.pre ()\n#18 0x0000000100ff2a5a in middle::trans::base::trans_fn::he7de539c4580c505Jmp::v0.10.pre ()\n#19 0x0000000100fee4c2 in middle::trans::base::trans_item::hc20a2c61f41ea0d4vyp::v0.10.pre ()\n#20 0x00000001010feb6f in middle::trans::base::trans_mod::h69d707bdeb3376956Dp::v0.10.pre ()\n#21 0x00000001011072ee in middle::trans::base::trans_crate::h12811b8fac70f7c81pr::v0.10.pre ()\n#22 0x0000000101613a58 in driver::driver::phase_4_translate_to_llvm::h784570c37ae178b9q6h::v0.10.pre ()\n#23 0x0000000101617196 in driver::driver::compile_input::h794f8e6e3126fa9dpli::v0.10.pre ()\n#24 0x000000010163ab82 in run_compiler::h5cec0c25fef797c6Rcq::v0.10.pre ()\n#25 0x000000010164cbbd in main_args::closure ()\n#26 0x000000010164b1f2 in monitor::closure ()\n#27 0x000000010164620b in task::TaskBuilder::try::closure ()\n#28 0x000000010060e60c in task::bootstrap_green_task::closure ()\n#29 0x00000001000d5d78 in rt::task::Task::run::closure ()\n#30 0x00000001000dfc2c in rust_try ()\n#31 0x000000010060e4c5 in task::bootstrap_green_task::hbb0150eeae2a78081bc::v0.10.pre ()\n```\n\nIf a field is added to the struct in the above repro case the crash does not occur.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12285/timeline", "performed_via_github_app": null, "state_reason": "completed"}