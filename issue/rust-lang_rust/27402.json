{"url": "https://api.github.com/repos/rust-lang/rust/issues/27402", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27402/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27402/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27402/events", "html_url": "https://github.com/rust-lang/rust/issues/27402", "id": 98260656, "node_id": "MDU6SXNzdWU5ODI2MDY1Ng==", "number": 27402, "title": "rustc does not add the LIBPATH for ucrt.lib to the MSVC command line.", "user": {"login": "briansmith", "id": 16816, "node_id": "MDQ6VXNlcjE2ODE2", "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briansmith", "html_url": "https://github.com/briansmith", "followers_url": "https://api.github.com/users/briansmith/followers", "following_url": "https://api.github.com/users/briansmith/following{/other_user}", "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions", "organizations_url": "https://api.github.com/users/briansmith/orgs", "repos_url": "https://api.github.com/users/briansmith/repos", "events_url": "https://api.github.com/users/briansmith/events{/privacy}", "received_events_url": "https://api.github.com/users/briansmith/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-07-30T20:44:54Z", "updated_at": "2015-07-30T21:37:03Z", "closed_at": "2015-07-30T21:37:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "When `cargo build` is used outside of an VS2015 {x86,x64} Native Tools Command Prompt, I receive this error during linking:\n\n`rustc: LINK : fatal error LNK1104: cannot open file 'ucrt.lib'`\n\nin librustc_trans/back/msvc/mod.rs:\n\n``` rust\n    // The MSVC linker uses the LIB environment variable as the default lookup\n    // path for libraries. This environment variable is normally set up by the\n    // VS shells, so we only want to start adding our own pieces if it's not\n    // set.\n    //\n    // If we're adding our own pieces, then we need to add two primary\n    // directories to the default search path for the linker. The first is in\n    // the VS install direcotry and the next is the Windows SDK directory.\n```\n\nWhen building using the VS2015 toolkit, there is a _third_ path needed: The path to ucrt.lib. On my system, it is `C:\\Program Files (x86)\\Windows Kits\\10\\lib\\10.0.10150.0\\ucrt\\x64`. Here is the full value of the `LIB` environment variable that `vcvarsall.bat` sets:\n\n```\nLIB=C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\LIB\\amd64;C:\\ProgramFiles (x86)\\Microsoft Visual Studio 14.0\\VC\\ATLMFC\\LIB\\amd64;C:\\Program Files (x86)\\Windows Kits\\10\\lib\\10.0.10150.0\\ucrt\\x64;C:\\Program Files (x86)\\Windows Kits\\NETFXSDK\\4.6\\lib\\um\\x64;C:\\Program Files (x86)\\Windows Kits\\8.1\\lib\\winv6.3\\um\\x64;\n```\n\nHere's the build output, reformatted so every parameter is on its own line:\n\n```\nerror: linking with `link.exe` failed: exit code: 1104\nnote: \"C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC/bin\\amd64\\link.exe\"\n\"/LIBPATH:C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC/lib\\amd64\"\n\"/LIBPATH:C:\\Program Files (x86)\\Windows Kits\\8.1\\Lib\\winv6.3\\um\\x64\"\n\"/NOLOGO\"\n\"/NXCOMPAT\"\n\"/LIBPATH:C:\\Users\\Example\\AppData\\Local\\Apps\\Rust-1.3\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\"\n\"C:\\Users\\Example\\Documents\\p\\ring\\target\\debug\\build\\ring-c7da49b4c8d6e8fe\\build_script_build.0.o\"\n\"/OUT:C:\\Users\\Example\\Documents\\p\\ring\\target\\debug\\build\\ring-c7da49b4c8d6e8fe\\build_script_build.exe\"\n\"/OPT:REF,ICF\"\n\"/DEBUG\"\n\"/LIBPATH:C:\\Users\\Example\\AppData\\Local\\Apps\\Rust-1.3\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\"\n\"std-74fa456f.lib\"\n\"/LIBPATH:C:\\Users\\Example\\Documents\\p\\ring\\target\\debug\"\n\"/LIBPATH:C:\\Users\\Example\\Documents\\p\\ring\\target\\debug\\deps\"\n\"/LIBPATH:C:\\Users\\Example\\AppData\\Local\\Apps\\Rust-1\n.3\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\"\n\"/LIBPATH:C:\\Users\\Example\\Documents\\p\\ring\\.rust\\bin\\x86_64-pc-windows-msvc\"\n\"/LIBPATH:C:\\Users\\Example\\Documents\\p\\ring\\bin\\x86_64-pc-windows-msvc\"\n\"ws2_32.lib\"\n\"userenv.lib\"\n\"advapi32.lib\"\n\"kernel32.lib\"\n\"shell32.lib\"\n\"msvcrt.lib\"\n\"compiler-rt.lib\"\nnote: LINK : fatal error LNK1104: cannot open file 'ucrt.lib'\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27402/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27402/timeline", "performed_via_github_app": null, "state_reason": "completed"}