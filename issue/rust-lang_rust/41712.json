{"url": "https://api.github.com/repos/rust-lang/rust/issues/41712", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/41712/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/41712/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/41712/events", "html_url": "https://github.com/rust-lang/rust/issues/41712", "id": 225772845, "node_id": "MDU6SXNzdWUyMjU3NzI4NDU=", "number": 41712, "title": "[FIXME] settle future of MIR pass manager", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-05-02T17:57:55Z", "updated_at": "2017-11-14T10:27:15Z", "closed_at": "2017-11-14T10:27:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In https://github.com/rust-lang/rust/pull/41625, the role of the MIR pass manager has been significantly scaled back. Once can still register passes, but they always take an `&mut Mir`, and the set of passes is defined in `driver` and cannot be readily changed (in particular, the session no longer has a `Passes` struct). @eddyb would like to go further, I think, and remove the `Passes` strruct from the `tcx` altogether -- the main reason it is still there is that it allows the MIR code to (indirectly) invoke passes defined in other crates, e.g. `elaborate_drops`. I tend to also think it's nice to \"collect\" the MIR passes into one single data-structure to ensure that (e.g.) we have the option to dump the MIR in between each pass and apply other debugging conventions (as well as to easily reorder passes or introduce new ones).\r\n\r\nLonger term, what do we think this should look like? One extreme future might remove the `Passes` struct altogether and have the invocations of each pass kind of hard-coded -- we could build up the set of `Pass` objects in the various \"mir queries\", for example. Another extreme would be to make the `Passes` struct more complex to support plugins adding custom optimizations -- it seems like we're a long way from there, and that may never make sense.\r\n\r\nTo do the \"radically scaled back\" version of futures, we'd have to at least consolidate the borrowck and mir crates, or make one a dependency of the other, or something like that. \r\n\r\ncc @rust-lang/compiler -- thoughts?", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/41712/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/41712/timeline", "performed_via_github_app": null, "state_reason": "completed"}