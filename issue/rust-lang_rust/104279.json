{"url": "https://api.github.com/repos/rust-lang/rust/issues/104279", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104279/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104279/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104279/events", "html_url": "https://github.com/rust-lang/rust/issues/104279", "id": 1445232022, "node_id": "I_kwDOAAsO6M5WJH2W", "number": 104279, "title": "Matching with multiple patterns and match guards can have unintuitive results", "user": {"login": "jamesmunns", "id": 2097964, "node_id": "MDQ6VXNlcjIwOTc5NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2097964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamesmunns", "html_url": "https://github.com/jamesmunns", "followers_url": "https://api.github.com/users/jamesmunns/followers", "following_url": "https://api.github.com/users/jamesmunns/following{/other_user}", "gists_url": "https://api.github.com/users/jamesmunns/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamesmunns/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamesmunns/subscriptions", "organizations_url": "https://api.github.com/users/jamesmunns/orgs", "repos_url": "https://api.github.com/users/jamesmunns/repos", "events_url": "https://api.github.com/users/jamesmunns/events{/privacy}", "received_events_url": "https://api.github.com/users/jamesmunns/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-11-11T09:57:59Z", "updated_at": "2022-11-11T10:00:58Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nWhen matching with multiple patterns AND a match guard, it is potentially confusing that the match guard applies to ALL patterns, not just the rightmost pattern.\r\n\r\nIn writing an encoder where I wanted to ensure that I don't encode a value larger than 127, I wrote the \"wrong\" variant below, until I caught the issue in a test. There was no warning, and clippy also did not give any warning.\r\n\r\nThis is probably a pretty hard thing to write a reliable lint for (either in the compiler or in clippy) that wouldn't have false positives, so I understand if this gets closed, but I stumbled over it and wanted to report it, in case y'all have better ideas on how to catch this than I do.\r\n\r\nGiven the following code: [playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=db1f1214c0204590bafb10412a4fc17a)\r\n\r\n```rust\r\nfn main() {\r\n    for outer in 0..13 {\r\n        for inner in 0..12 {\r\n            // wrong\r\n            let x = match outer {\r\n                0..=9 | 10 if inner <= 7 => (outer * 12) + inner,\r\n                _ => 0x00,\r\n            };\r\n            \r\n            // right\r\n            let y = match outer {\r\n                0..=9 => (outer * 12) + inner,\r\n                10 if inner <= 7 => (outer * 12) + inner,\r\n                _ => 0x00,\r\n            };\r\n            \r\n            let res = if x == y { \"RIGHT\" } else { \"WRONG\" };\r\n            \r\n            println!(\"| {outer:02} | {inner:02} | {x:03} | {y:03} | {res} |\");\r\n            assert!(x <= 127);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\n| 00 | 00 | 000 | 000 | RIGHT |\r\n| 00 | 01 | 001 | 001 | RIGHT |\r\n| 00 | 02 | 002 | 002 | RIGHT |\r\n| 00 | 03 | 003 | 003 | RIGHT |\r\n| 00 | 04 | 004 | 004 | RIGHT |\r\n| 00 | 05 | 005 | 005 | RIGHT |\r\n| 00 | 06 | 006 | 006 | RIGHT |\r\n| 00 | 07 | 007 | 007 | RIGHT |\r\n| 00 | 08 | 000 | 008 | WRONG |\r\n| 00 | 09 | 000 | 009 | WRONG |\r\n| 00 | 10 | 000 | 010 | WRONG |\r\n| 00 | 11 | 000 | 011 | WRONG |\r\n| 01 | 00 | 012 | 012 | RIGHT |\r\n| 01 | 01 | 013 | 013 | RIGHT |\r\n| 01 | 02 | 014 | 014 | RIGHT |\r\n| 01 | 03 | 015 | 015 | RIGHT |\r\n| 01 | 04 | 016 | 016 | RIGHT |\r\n| 01 | 05 | 017 | 017 | RIGHT |\r\n| 01 | 06 | 018 | 018 | RIGHT |\r\n| 01 | 07 | 019 | 019 | RIGHT |\r\n| 01 | 08 | 000 | 020 | WRONG |\r\n| 01 | 09 | 000 | 021 | WRONG |\r\n| 01 | 10 | 000 | 022 | WRONG |\r\n| 01 | 11 | 000 | 023 | WRONG |\r\n| 02 | 00 | 024 | 024 | RIGHT |\r\n| 02 | 01 | 025 | 025 | RIGHT |\r\n| 02 | 02 | 026 | 026 | RIGHT |\r\n| 02 | 03 | 027 | 027 | RIGHT |\r\n| 02 | 04 | 028 | 028 | RIGHT |\r\n| 02 | 05 | 029 | 029 | RIGHT |\r\n| 02 | 06 | 030 | 030 | RIGHT |\r\n| 02 | 07 | 031 | 031 | RIGHT |\r\n| 02 | 08 | 000 | 032 | WRONG |\r\n| 02 | 09 | 000 | 033 | WRONG |\r\n| 02 | 10 | 000 | 034 | WRONG |\r\n| 02 | 11 | 000 | 035 | WRONG |\r\n| 03 | 00 | 036 | 036 | RIGHT |\r\n| 03 | 01 | 037 | 037 | RIGHT |\r\n| 03 | 02 | 038 | 038 | RIGHT |\r\n| 03 | 03 | 039 | 039 | RIGHT |\r\n| 03 | 04 | 040 | 040 | RIGHT |\r\n| 03 | 05 | 041 | 041 | RIGHT |\r\n| 03 | 06 | 042 | 042 | RIGHT |\r\n| 03 | 07 | 043 | 043 | RIGHT |\r\n| 03 | 08 | 000 | 044 | WRONG |\r\n| 03 | 09 | 000 | 045 | WRONG |\r\n| 03 | 10 | 000 | 046 | WRONG |\r\n| 03 | 11 | 000 | 047 | WRONG |\r\n| 04 | 00 | 048 | 048 | RIGHT |\r\n| 04 | 01 | 049 | 049 | RIGHT |\r\n| 04 | 02 | 050 | 050 | RIGHT |\r\n| 04 | 03 | 051 | 051 | RIGHT |\r\n| 04 | 04 | 052 | 052 | RIGHT |\r\n| 04 | 05 | 053 | 053 | RIGHT |\r\n| 04 | 06 | 054 | 054 | RIGHT |\r\n| 04 | 07 | 055 | 055 | RIGHT |\r\n| 04 | 08 | 000 | 056 | WRONG |\r\n| 04 | 09 | 000 | 057 | WRONG |\r\n| 04 | 10 | 000 | 058 | WRONG |\r\n| 04 | 11 | 000 | 059 | WRONG |\r\n| 05 | 00 | 060 | 060 | RIGHT |\r\n| 05 | 01 | 061 | 061 | RIGHT |\r\n| 05 | 02 | 062 | 062 | RIGHT |\r\n| 05 | 03 | 063 | 063 | RIGHT |\r\n| 05 | 04 | 064 | 064 | RIGHT |\r\n| 05 | 05 | 065 | 065 | RIGHT |\r\n| 05 | 06 | 066 | 066 | RIGHT |\r\n| 05 | 07 | 067 | 067 | RIGHT |\r\n| 05 | 08 | 000 | 068 | WRONG |\r\n| 05 | 09 | 000 | 069 | WRONG |\r\n| 05 | 10 | 000 | 070 | WRONG |\r\n| 05 | 11 | 000 | 071 | WRONG |\r\n| 06 | 00 | 072 | 072 | RIGHT |\r\n| 06 | 01 | 073 | 073 | RIGHT |\r\n| 06 | 02 | 074 | 074 | RIGHT |\r\n| 06 | 03 | 075 | 075 | RIGHT |\r\n| 06 | 04 | 076 | 076 | RIGHT |\r\n| 06 | 05 | 077 | 077 | RIGHT |\r\n| 06 | 06 | 078 | 078 | RIGHT |\r\n| 06 | 07 | 079 | 079 | RIGHT |\r\n| 06 | 08 | 000 | 080 | WRONG |\r\n| 06 | 09 | 000 | 081 | WRONG |\r\n| 06 | 10 | 000 | 082 | WRONG |\r\n| 06 | 11 | 000 | 083 | WRONG |\r\n| 07 | 00 | 084 | 084 | RIGHT |\r\n| 07 | 01 | 085 | 085 | RIGHT |\r\n| 07 | 02 | 086 | 086 | RIGHT |\r\n| 07 | 03 | 087 | 087 | RIGHT |\r\n| 07 | 04 | 088 | 088 | RIGHT |\r\n| 07 | 05 | 089 | 089 | RIGHT |\r\n| 07 | 06 | 090 | 090 | RIGHT |\r\n| 07 | 07 | 091 | 091 | RIGHT |\r\n| 07 | 08 | 000 | 092 | WRONG |\r\n| 07 | 09 | 000 | 093 | WRONG |\r\n| 07 | 10 | 000 | 094 | WRONG |\r\n| 07 | 11 | 000 | 095 | WRONG |\r\n| 08 | 00 | 096 | 096 | RIGHT |\r\n| 08 | 01 | 097 | 097 | RIGHT |\r\n| 08 | 02 | 098 | 098 | RIGHT |\r\n| 08 | 03 | 099 | 099 | RIGHT |\r\n| 08 | 04 | 100 | 100 | RIGHT |\r\n| 08 | 05 | 101 | 101 | RIGHT |\r\n| 08 | 06 | 102 | 102 | RIGHT |\r\n| 08 | 07 | 103 | 103 | RIGHT |\r\n| 08 | 08 | 000 | 104 | WRONG |\r\n| 08 | 09 | 000 | 105 | WRONG |\r\n| 08 | 10 | 000 | 106 | WRONG |\r\n| 08 | 11 | 000 | 107 | WRONG |\r\n| 09 | 00 | 108 | 108 | RIGHT |\r\n| 09 | 01 | 109 | 109 | RIGHT |\r\n| 09 | 02 | 110 | 110 | RIGHT |\r\n| 09 | 03 | 111 | 111 | RIGHT |\r\n| 09 | 04 | 112 | 112 | RIGHT |\r\n| 09 | 05 | 113 | 113 | RIGHT |\r\n| 09 | 06 | 114 | 114 | RIGHT |\r\n| 09 | 07 | 115 | 115 | RIGHT |\r\n| 09 | 08 | 000 | 116 | WRONG |\r\n| 09 | 09 | 000 | 117 | WRONG |\r\n| 09 | 10 | 000 | 118 | WRONG |\r\n| 09 | 11 | 000 | 119 | WRONG |\r\n| 10 | 00 | 120 | 120 | RIGHT |\r\n| 10 | 01 | 121 | 121 | RIGHT |\r\n| 10 | 02 | 122 | 122 | RIGHT |\r\n| 10 | 03 | 123 | 123 | RIGHT |\r\n| 10 | 04 | 124 | 124 | RIGHT |\r\n| 10 | 05 | 125 | 125 | RIGHT |\r\n| 10 | 06 | 126 | 126 | RIGHT |\r\n| 10 | 07 | 127 | 127 | RIGHT |\r\n| 10 | 08 | 000 | 000 | RIGHT |\r\n| 10 | 09 | 000 | 000 | RIGHT |\r\n| 10 | 10 | 000 | 000 | RIGHT |\r\n| 10 | 11 | 000 | 000 | RIGHT |\r\n| 11 | 00 | 000 | 000 | RIGHT |\r\n| 11 | 01 | 000 | 000 | RIGHT |\r\n| 11 | 02 | 000 | 000 | RIGHT |\r\n| 11 | 03 | 000 | 000 | RIGHT |\r\n| 11 | 04 | 000 | 000 | RIGHT |\r\n| 11 | 05 | 000 | 000 | RIGHT |\r\n| 11 | 06 | 000 | 000 | RIGHT |\r\n| 11 | 07 | 000 | 000 | RIGHT |\r\n| 11 | 08 | 000 | 000 | RIGHT |\r\n| 11 | 09 | 000 | 000 | RIGHT |\r\n| 11 | 10 | 000 | 000 | RIGHT |\r\n| 11 | 11 | 000 | 000 | RIGHT |\r\n| 12 | 00 | 000 | 000 | RIGHT |\r\n| 12 | 01 | 000 | 000 | RIGHT |\r\n| 12 | 02 | 000 | 000 | RIGHT |\r\n| 12 | 03 | 000 | 000 | RIGHT |\r\n| 12 | 04 | 000 | 000 | RIGHT |\r\n| 12 | 05 | 000 | 000 | RIGHT |\r\n| 12 | 06 | 000 | 000 | RIGHT |\r\n| 12 | 07 | 000 | 000 | RIGHT |\r\n| 12 | 08 | 000 | 000 | RIGHT |\r\n| 12 | 09 | 000 | 000 | RIGHT |\r\n| 12 | 10 | 000 | 000 | RIGHT |\r\n| 12 | 11 | 000 | 000 | RIGHT |\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104279/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104279/timeline", "performed_via_github_app": null, "state_reason": null}