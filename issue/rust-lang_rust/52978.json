{"url": "https://api.github.com/repos/rust-lang/rust/issues/52978", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52978/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52978/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52978/events", "html_url": "https://github.com/rust-lang/rust/issues/52978", "id": 347003364, "node_id": "MDU6SXNzdWUzNDcwMDMzNjQ=", "number": 52978, "title": "Documentation of NonNull is difficult to understand", "user": {"login": "kornelski", "id": 72159, "node_id": "MDQ6VXNlcjcyMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kornelski", "html_url": "https://github.com/kornelski", "followers_url": "https://api.github.com/users/kornelski/followers", "following_url": "https://api.github.com/users/kornelski/following{/other_user}", "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}", "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions", "organizations_url": "https://api.github.com/users/kornelski/orgs", "repos_url": "https://api.github.com/users/kornelski/repos", "events_url": "https://api.github.com/users/kornelski/events{/privacy}", "received_events_url": "https://api.github.com/users/kornelski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-02T13:05:55Z", "updated_at": "2018-12-27T16:16:51Z", "closed_at": "2018-12-27T16:16:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://doc.rust-lang.org/std/ptr/struct.NonNull.html\r\n\r\n> If you're not sure if you should use `NonNull<T>`, just use `*mut T`! \r\n\r\nThis is a cop out. I *am* unsure if I should use `NonNull`, but mainly because the rest of the documentation is hard to digest.\r\n\r\nThe whole explanation of `NonNull` doesn't use any terminology or examples that a C programmer can relate to. It feels written from perspective of a language designer, not a language user.\r\n\r\n> Unlike `*mut T`, `NonNull<T>` is **covariant** over `T`. \r\n\r\nThis property is explained entirely using type theory jargon, and advanced usage of `PhantomData`. The documentation assumes that the reader understands the subtle but crucial difference between `PhantomData<Cell<T>>` and `PhantomData<T>`, which by itself requires understanding of covariance \u2014\u00a0a catch-22.\r\n\r\nThis documentation doesn't explain covariance, and unfortunately other sources aren't good either. The [Wikipedia page](https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)) requires a lot of mental effort to extract relevant information from (covariance is explained in terms of \"that's how OCaml works\" or \"preserves the ordering of types (\u2264) [links deeper into jargon-filled type theory article]\").\r\n\r\n>  Usually this won't be necessary; covariance is correct for most safe abstractions, such as Box, Rc, Arc, **Vec**, and LinkedList. \r\n\r\nThe Wikipedia page has a whole section explaining that Arrays are only safe if they are invariant, and this note seems to be contradicting it, so this is further confusing (probably because the documentation refers to variance of lifetimes, not inheritance? But *this is not documented*)\r\n\r\n\r\nCould usage of `NonNull` be explained without relying on type variance terminology? (and subtle typesystem interactions of `PhantomData` directly related to it?), e.g. what specific usage would violate the coveriance requirement? What would happen then?\r\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52978/reactions", "total_count": 13, "+1": 11, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52978/timeline", "performed_via_github_app": null, "state_reason": "completed"}