{"url": "https://api.github.com/repos/rust-lang/rust/issues/81930", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81930/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81930/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81930/events", "html_url": "https://github.com/rust-lang/rust/issues/81930", "id": 804717002, "node_id": "MDU6SXNzdWU4MDQ3MTcwMDI=", "number": 81930, "title": "Follow-up work for `download-rustc`", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}, {"id": 5380396158, "node_id": "LA_kwDOAAsO6M8AAAABQLJUfg", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-download-rustc", "name": "A-download-rustc", "color": "f7e101", "default": false, "description": "Area: Related to the `rust.download-rustc` build option"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 25, "created_at": "2021-02-09T16:38:34Z", "updated_at": "2023-06-06T23:08:12Z", "closed_at": "2023-06-06T23:08:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "These are all the features for `download-rustc` that didn't land in the initial MVP (https://github.com/rust-lang/rust/pull/79540).\r\n\r\n## Required before this is made a default\r\n\r\n- [x] Download a separate beta compiler for stage0 and only use CI artifacts for stage1 onward. Right now, every time you rebase, stage0 tools (bootstrap, tidy, ...) will have to be recompiled. Additionally running `x.py setup tools` will compile rustbuild twice. https://github.com/rust-lang/rust/pull/79540#issuecomment-757047321, https://github.com/rust-lang/rust/pull/82739\r\n- [x] Compile a new version of tracing so that rustdoc still gets debug logging (since CI artifacts always disable `debug` and `trace` logging). https://github.com/rust-lang/rust/pull/81932\r\n- [x] Right now only rustdoc is ever rebuilt. This is not ideal and should probably at least compile compiler tools (rustfmt, clippy, miri). https://github.com/rust-lang/rust/pull/79540#issuecomment-775634693, https://github.com/rust-lang/rust/pull/82480\r\n- [x] Using `git log --author=bors` sometimes breaks. This should use `git merge-base` instead, or use some other workaround that doesn't break. https://github.com/rust-lang/rust/pull/79540#discussion_r572572280, https://github.com/rust-lang/rust/pull/82740\r\n- [x] This breaks during release week (but only release week). #83350\r\n\r\n## Nice to have\r\n\r\n- [x] Add `download-rustc = \"if-unchanged\"` which rebuilds rustc instead of warning when `compiler/` has been modified. https://github.com/rust-lang/rust/issues/81930#issuecomment-785527408, https://github.com/rust-lang/rust/pull/83368\r\n- [x] `x.py check --stage 0` doesn't work. https://github.com/rust-lang/rust/issues/81930#issuecomment-805428682, https://github.com/rust-lang/rust/pull/82739\r\n- [x] `x.py check --stage 1 src/tools/rustdoc` doesn't work. https://github.com/rust-lang/rust/issues/81930#issuecomment-813408485, fixed in https://github.com/rust-lang/rust/pull/110121\r\n- [x] Add `x.py setup tools` to enable this conveniently (it doesn't make sense to use this for compiler developers). This shouldn't be added until people have used this feature for a little bit and it works reasonably well. https://github.com/rust-lang/rust/pull/83370\r\n- [ ] Enable verification for the commit tarballs. This requires first signing nightly commits; right now the .sha256 URLs gave a 404. This seems fairly simple to fix but also not high priority.\r\n- [x] Give a better error message when rebasing an old branch (I think commits are kept at most 160 days?). https://github.com/rust-lang/rust/pull/79540#issuecomment-751481291\r\n- [x] It would be nice to support cross-compiling the standard library - fixed in https://github.com/rust-lang/rust/pull/110113\r\n- [x] Some tests fail when download-rustc is enabled: https://github.com/rust-lang/rust/issues?q=is%3Aissue+is%3Aopen+label%3AA-testsuite+label%3AA-download-rustc\r\n- ~~Combine `download-rustc` and `download-ci-llvm` into the same option. This needs quite a bit more design work. https://github.com/rust-lang/rust/pull/79540#issuecomment-775477288, https://github.com/rust-lang/rust/issues/83369~~ This doesn't seem useful.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81930/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81930/timeline", "performed_via_github_app": null, "state_reason": "completed"}