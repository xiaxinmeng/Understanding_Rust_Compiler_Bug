{"url": "https://api.github.com/repos/rust-lang/rust/issues/16339", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/16339/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/16339/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/16339/events", "html_url": "https://github.com/rust-lang/rust/issues/16339", "id": 39781753, "node_id": "MDU6SXNzdWUzOTc4MTc1Mw==", "number": 16339, "title": "Unexpected \"life is too short\" error", "user": {"login": "kvark", "id": 107301, "node_id": "MDQ6VXNlcjEwNzMwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/107301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kvark", "html_url": "https://github.com/kvark", "followers_url": "https://api.github.com/users/kvark/followers", "following_url": "https://api.github.com/users/kvark/following{/other_user}", "gists_url": "https://api.github.com/users/kvark/gists{/gist_id}", "starred_url": "https://api.github.com/users/kvark/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kvark/subscriptions", "organizations_url": "https://api.github.com/users/kvark/orgs", "repos_url": "https://api.github.com/users/kvark/repos", "events_url": "https://api.github.com/users/kvark/events{/privacy}", "received_events_url": "https://api.github.com/users/kvark/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2014-08-08T00:27:19Z", "updated_at": "2014-08-08T14:04:21Z", "closed_at": "2014-08-08T14:01:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The repro code:\n\n``` rust\n#![feature(macro_rules)]\n\n#[macro_export]\nmacro_rules! entity {\n    ($($name:ident : $component:ty,)*) => {\n        type IdType = u32;\n        #[deriving(Clone, PartialEq, Show)]\n        pub struct Id<S>(IdType);\n\n        /// A collection of pointers to components\n        pub struct Entity {\n            $(\n            pub $name: Option<Id<$component>>,\n            )*\n        }\n        impl Entity {\n            pub fn new() -> Entity {\n                Entity {\n                    $(\n                    $name: None,\n                    )*\n                }\n            }\n        }\n\n        /// A collection of component arrays\n        pub struct DataHub {\n            $(\n            pub $name: Vec<$component>,\n            )*\n        }\n\n        /// Component change() wrapper\n        pub struct Changer<'a> {\n            entity: &'a Entity,\n            hub: &'a mut DataHub,\n        }\n        impl <'a> Changer<'a> {\n            $(\n            pub fn $name(&mut self) -> Option<&mut $component> {\n                self.entity.$name.map(|Id(id)| self.hub.$name.get_mut(id as uint))\n            }\n            )*\n        }\n    }\n}\n\npub mod test {\n    type DummyComponent = int;\n    entity! {\n        dummy : DummyComponent,\n    }\n}\n\nfn main() {\n}\n```\n\nRust complains:\n\n```\n<anon>:41:48: 41:62 error: lifetime of `self` is too short to guarantee its contents can be safely reborrowed\n<anon>:41                 self.entity.$name.map(|Id(id)| self.hub.$name.get_mut(id as uint))\n                                                         ^~~~~~~~~~~~~~\n<anon>:4:1: 46:2 note: in expansion of entity!\n<anon>:50:5: 52:6 note: expansion site\n<anon>:40:64: 42:14 note: `self` would have to be valid for the anonymous lifetime #1 defined on the block at 40:63...\n<anon>:40             pub fn $name(&mut self) -> Option<&mut $component> {\n<anon>:41                 self.entity.$name.map(|Id(id)| self.hub.$name.get_mut(id as uint))\n<anon>:42             }\n<anon>:41:17: 41:83 note: ...but `self` is only valid for the method call at 41:16\n<anon>:41                 self.entity.$name.map(|Id(id)| self.hub.$name.get_mut(id as uint))\n                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<anon>:4:1: 46:2 note: in expansion of entity!\n```\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/16339/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/16339/timeline", "performed_via_github_app": null, "state_reason": "completed"}