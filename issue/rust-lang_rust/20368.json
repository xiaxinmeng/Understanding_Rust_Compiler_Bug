{"url": "https://api.github.com/repos/rust-lang/rust/issues/20368", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20368/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20368/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20368/events", "html_url": "https://github.com/rust-lang/rust/issues/20368", "id": 53175754, "node_id": "MDU6SXNzdWU1MzE3NTc1NA==", "number": 20368, "title": "Associated types: ICE \"type_of with ty_projection\"", "user": {"login": "kinghajj", "id": 3409, "node_id": "MDQ6VXNlcjM0MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/3409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kinghajj", "html_url": "https://github.com/kinghajj", "followers_url": "https://api.github.com/users/kinghajj/followers", "following_url": "https://api.github.com/users/kinghajj/following{/other_user}", "gists_url": "https://api.github.com/users/kinghajj/gists{/gist_id}", "starred_url": "https://api.github.com/users/kinghajj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kinghajj/subscriptions", "organizations_url": "https://api.github.com/users/kinghajj/orgs", "repos_url": "https://api.github.com/users/kinghajj/repos", "events_url": "https://api.github.com/users/kinghajj/events{/privacy}", "received_events_url": "https://api.github.com/users/kinghajj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 149689562, "node_id": "MDU6TGFiZWwxNDk2ODk1NjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-associated-items", "name": "A-associated-items", "color": "f7e101", "default": false, "description": "Area: Associated items such as associated types and consts."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-12-31T09:40:05Z", "updated_at": "2015-01-08T07:35:55Z", "closed_at": "2015-01-08T07:35:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "After #20307 was merged, I tried using associated types again to improve an API, but ran into an ICE demonstrated by the following example.\n\n```\n#![feature(associated_types)]\n\ntrait Foo {\n  fn foo(&self) -> ();\n}\n\ntrait Bar {\n  type F: Foo;\n}\n\nstruct Wat<B: Bar> {\n  fs: Vec<B::F>,\n}\n\nimpl<B: Bar> Wat<B> {\n  fn new() -> Self {\n    Wat { fs: Vec::new() }\n  }\n\n  fn wat(&mut self) -> () {\n    Foo::foo(&self.fs.pop().unwrap());\n  }\n}\n\nstruct FooImpl;\n\nimpl Foo for FooImpl {\n  fn foo(&self) -> () {}\n}\n\nstruct BarImpl;\n\nimpl Bar for BarImpl {\n  type F = FooImpl;\n}\n\nfn main() {\n  // error is caused by this line.\n  let wat: Wat<BarImpl> = Wat::new();\n}\n```\n\nError:\n\n```\nerror: internal compiler error: type_of with ty_projection\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /Users/samuel/Documents/rust/src/libsyntax/diagnostic.rs:182\n\nstack backtrace:\n   1:        0x10b98aa25 - sys::backtrace::write::h79fcf57f48f2accbUpt\n   2:        0x10b9af473 - failure::on_fail::he313666202ab06e0wwz\n   3:        0x10b9156aa - rt::unwind::begin_unwind_inner::h3818eca49d000e060dz\n   4:        0x10988fe47 - rt::unwind::begin_unwind::h2232683046508229913\n   5:        0x1098907b8 - diagnostic::Handler::bug::hd878cdd91e904135bVF\n   6:        0x108edc1e8 - session::Session::bug::he3e7f8e3682f0beezyp\n   7:        0x1084d0001 - trans::type_of::type_of::h9197635c60619429njp\n   8:        0x1084d020f - trans::type_of::type_of::h9197635c60619429njp\n   9:        0x1085f5c15 - vec::Vec<T>.FromIterator<T>::from_iter::h6585550067129994724\n  10:        0x1084d04c3 - trans::type_of::type_of::h9197635c60619429njp\n  11:        0x1084cf3ac - trans::type_of::type_of::h9197635c60619429njp\n  12:        0x1085f5c15 - vec::Vec<T>.FromIterator<T>::from_iter::h6585550067129994724\n  13:        0x1084d04c3 - trans::type_of::type_of::h9197635c60619429njp\n  14:        0x1084cf3ac - trans::type_of::type_of::h9197635c60619429njp\n  15:        0x1085f5c15 - vec::Vec<T>.FromIterator<T>::from_iter::h6585550067129994724\n  16:        0x1084d04c3 - trans::type_of::type_of::h9197635c60619429njp\n  17:        0x1084cf3ac - trans::type_of::type_of::h9197635c60619429njp\n  18:        0x1084d8eed - trans::base::alloc_ty::h0ff116b4545bfc9eFFt\n  19:        0x1085be404 - trans::_match::mk_binding_alloca::h1489438822966140848\n  20:        0x1084c99e3 - trans::base::init_local::h78d0086b1f8238539qt\n  21:        0x1084cae95 - trans::controlflow::trans_block::h2f26f7b25eb8f55a2ae\n  22:        0x1085883a4 - trans::base::trans_closure::hd27e32dcce03144cKju\n  23:        0x1084bac1b - trans::base::trans_fn::hb6a8bb6b558798cazuu\n  24:        0x1084b6276 - trans::base::trans_item::h823c6709f851fa543Ru\n  25:        0x10858f1f8 - trans::base::trans_crate::he3d01922f8b5bab14Ov\n  26:        0x1082ebd0e - driver::phase_4_translate_to_llvm::hc27e2b2792fb5383eFa\n  27:        0x1082ce0b1 - driver::compile_input::hf6a1e42e515c971bwba\n  28:        0x1083ff393 - thunk::F.Invoke<A, R>::invoke::h1106905942537841072\n  29:        0x1083fc4f0 - rt::unwind::try::try_fn::h16870325584336102008\n  30:        0x10ba19649 - rust_try_inner\n  31:        0x10ba19636 - rust_try\n  32:        0x1083fcc36 - thunk::F.Invoke<A, R>::invoke::h8218093585600920335\n  33:        0x10b99bd84 - sys::thread::thread_start::hccba841055eeb8d6Dfw\n  34:     0x7fff8d7932fc - _pthread_body\n  35:     0x7fff8d793279 - _pthread_body\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20368/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20368/timeline", "performed_via_github_app": null, "state_reason": "completed"}