{"url": "https://api.github.com/repos/rust-lang/rust/issues/82946", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82946/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82946/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82946/events", "html_url": "https://github.com/rust-lang/rust/issues/82946", "id": 826579306, "node_id": "MDU6SXNzdWU4MjY1NzkzMDY=", "number": 82946, "title": "Move compiletest out of tree", "user": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 602425123, "node_id": "MDU6TGFiZWw2MDI0MjUxMjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-dev-tools", "name": "T-dev-tools", "color": "bfd4f2", "default": false, "description": "Relevant to the dev-tools subteam, which will review and decide on the PR/issue."}, {"id": 2352122097, "node_id": "MDU6TGFiZWwyMzUyMTIyMDk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-discussion", "name": "C-discussion", "color": "f5f1fd", "default": false, "description": "Category: Discussion or questions that doesn't represent real issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2021-03-09T20:21:24Z", "updated_at": "2023-04-26T15:47:17Z", "closed_at": "2023-04-26T15:47:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "See also: https://github.com/Manishearth/compiletest-rs/issues/238\r\n\r\ncc @rust-lang/compiler  @rust-lang/clippy @rust-lang/devtools \r\n\r\nCurrently compiletest is used by Rust in two different forms: It's used by rustc itself in rust-lang/rust as a testsuite, and it's also used by clippy via https://github.com/Manishearth/compiletest-rs/ . Compiletest-rs is used by both clippy and some proc macro libraries (like syn) for testing diagnostics.\r\n\r\nThis is suboptimal. The clippy team already primarily maintains this fork (and recently the repo owner transferred it to my account). We've been considering moving it into rust-lang, but it feels super weird for Rust to maintain _multiple_ compiletest forks.\r\n\r\nIt would be nice if compiletest-rs could be moved out of tree. A blocker to doing this is moving libtest out of tree -- this was tried before and had problems -- but I think we might be able to move _the relevant parts of libtest_ out of tree since compiletest really only uses the parts of libtest that handle output formatting.\r\n\r\nI propose the following steps:\r\n\r\n - Identify the \"test output formatting\" parts of libtest, put them in a separate crate, make libtest and compiletest depend on them\r\n - Identify features in compiletest-rs that compiletest does not have (it will likely be very minor stuff -- compiletest-rs largely does not add new features), try to add them\r\n - Move compiletest out of tree into a temporary branch on compiletest-rs\r\n - Try to make clippy use this temporary test branch, make sure it works. Upstream any necessary fixes.\r\n - Try to make `syn`/`serde` use this temporary test branch, make sure it works. Upstream any necessary fixes.\r\n - Release this as a major version bump of compiletest-rs\r\n - Update clippy, rustc, and syn to use this new version\r\n\r\n\r\nI feel like this will be a win-win for everyone. The resultant repo will be able to get the maintenance efforts of the clippy team _and_ the compiler team, and will also get polish from community crates like syn slowly turning it into a general purpose tool.", "closed_by": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82946/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82946/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}