{"url": "https://api.github.com/repos/rust-lang/rust/issues/68608", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68608/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68608/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68608/events", "html_url": "https://github.com/rust-lang/rust/issues/68608", "id": 556386982, "node_id": "MDU6SXNzdWU1NTYzODY5ODI=", "number": 68608, "title": "Occasional non-reproducibility when building librls and libcargo", "user": {"login": "jgalenson", "id": 505819, "node_id": "MDQ6VXNlcjUwNTgxOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/505819?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jgalenson", "html_url": "https://github.com/jgalenson", "followers_url": "https://api.github.com/users/jgalenson/followers", "following_url": "https://api.github.com/users/jgalenson/following{/other_user}", "gists_url": "https://api.github.com/users/jgalenson/gists{/gist_id}", "starred_url": "https://api.github.com/users/jgalenson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jgalenson/subscriptions", "organizations_url": "https://api.github.com/users/jgalenson/orgs", "repos_url": "https://api.github.com/users/jgalenson/repos", "events_url": "https://api.github.com/users/jgalenson/events{/privacy}", "received_events_url": "https://api.github.com/users/jgalenson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1508600909, "node_id": "MDU6TGFiZWwxNTA4NjAwOTA5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-reproducibility", "name": "A-reproducibility", "color": "f7e101", "default": false, "description": "Area: Reproducible / Deterministic builds"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-28T18:24:35Z", "updated_at": "2023-05-08T12:20:52Z", "closed_at": "2023-05-08T12:20:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "Occasionally (perhaps 1/3 of the time, so it's not that rare) when doing multiple builds with `extended = true` (and hence building tools including rls and cargo), I get different libcargo.rlib and librls.rlib files.\r\n\r\nDuring a normal build, libcargo gets built once (reproducibly for me), but on these bad builds it gets built twice.  The command line is slightly different the second time, as it has `,artifacts` appended to its `--json` argument (due to [this code](https://github.com/rust-lang/cargo/blob/rust-1.42.0/src/cargo/core/compiler/mod.rs#L684)).  This difference gets propagated to librls, which depends on libcargo.\r\n\r\nI believe this is due to rustc's bootstrap compiler invoking cargo separately for each tool.  If the cargo build finishes early enough, the rls build can use its result.  But if it does not, the rls build seems to fire off its own compile, which causes the above issue.\r\n\r\nNote that this is a part of #34902.", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68608/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68608/timeline", "performed_via_github_app": null, "state_reason": "completed"}