{"url": "https://api.github.com/repos/rust-lang/rust/issues/15189", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15189/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15189/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15189/events", "html_url": "https://github.com/rust-lang/rust/issues/15189", "id": 36533697, "node_id": "MDU6SXNzdWUzNjUzMzY5Nw==", "number": 15189, "title": "pretty-rpass tests work only accidentally/fragilely", "user": {"login": "jbclements", "id": 226617, "node_id": "MDQ6VXNlcjIyNjYxNw==", "avatar_url": "https://avatars.githubusercontent.com/u/226617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbclements", "html_url": "https://github.com/jbclements", "followers_url": "https://api.github.com/users/jbclements/followers", "following_url": "https://api.github.com/users/jbclements/following{/other_user}", "gists_url": "https://api.github.com/users/jbclements/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbclements/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbclements/subscriptions", "organizations_url": "https://api.github.com/users/jbclements/orgs", "repos_url": "https://api.github.com/users/jbclements/repos", "events_url": "https://api.github.com/users/jbclements/events{/privacy}", "received_events_url": "https://api.github.com/users/jbclements/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108435, "node_id": "MDU6TGFiZWwxMDg0MzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-pretty", "name": "A-pretty", "color": "f7e101", "default": false, "description": "Area: Pretty printing."}, {"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2014-06-25T23:57:04Z", "updated_at": "2018-09-24T17:08:38Z", "closed_at": "2018-09-24T17:08:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "AFAICT, the pretty-rpass tests pretty-print files and then ensure that they type-check. I wouldn't expect this to work in general, because pretty-printing does not respect hygiene. For instance, consider this program:\n\n``` rust\n#![feature(macro_rules)]\n\nmacro_rules! third(($e:expr)=>({let x = 2; *$e.get(x)}))\n\nfn main() {\n    let x = vec!(10u,11u,12u,13u);\n    let t = third!(x);\n    assert_eq!(t,12u);\n}\n```\n\nPretty-printing this with `--pretty expanded` results in a program where a `let x` is wrapped around two uses of `x`, one of which is an integer and one of which is a vector. Trying to type-check this doesn't work.\n\nThis issue is not just a hypothetical one; I removed unneccessary double-underscores from the index variable \"__i\" introduced by the expansion of a 'for' loop, and now a bunch of pretty-rpass tests are failing for the reasons given above.\n\nIn the short term, the easiest thing to do is to reinstitute the silly underscore before the i, but this is strictly short-term; the general problem is that the pretty-rpass test pass is broken, because pretty-print doesn't respect hygiene.\n\nThe fix would be to update pretty-print to generate names by mangling based on the name and the mtwt_resolve()'d name, but my understanding is that the pretty-printer is... on the way out anyway?\n\nFor now, I'm just going to put the underscore hack back in, so that all tests pass again, but this is strictly a \"hide the bug\" solution.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/15189/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15189/timeline", "performed_via_github_app": null, "state_reason": "completed"}