{"url": "https://api.github.com/repos/rust-lang/rust/issues/42506", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42506/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42506/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42506/events", "html_url": "https://github.com/rust-lang/rust/issues/42506", "id": 234214582, "node_id": "MDU6SXNzdWUyMzQyMTQ1ODI=", "number": 42506, "title": "Extending `match` to take notes", "user": {"login": "Yoric", "id": 10190, "node_id": "MDQ6VXNlcjEwMTkw", "avatar_url": "https://avatars.githubusercontent.com/u/10190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yoric", "html_url": "https://github.com/Yoric", "followers_url": "https://api.github.com/users/Yoric/followers", "following_url": "https://api.github.com/users/Yoric/following{/other_user}", "gists_url": "https://api.github.com/users/Yoric/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yoric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yoric/subscriptions", "organizations_url": "https://api.github.com/users/Yoric/orgs", "repos_url": "https://api.github.com/users/Yoric/repos", "events_url": "https://api.github.com/users/Yoric/events{/privacy}", "received_events_url": "https://api.github.com/users/Yoric/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-06-07T13:45:29Z", "updated_at": "2017-06-07T14:51:11Z", "closed_at": "2017-06-07T14:51:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Consider the following snippet:\r\n\r\n```rust\r\n\r\nenum Foo {\r\n   Case1(Bar),\r\n   Case2(Bar),\r\n   Case3(Bar),\r\n   SomethingElseEntirely\r\n}\r\n\r\nfn walk_through(foo: &Foo) {\r\n  match *foo {\r\n    Case1(ref bar) => { println!(\"This is Case1\"); some_complex_expression(bar) }\r\n    Case2(ref bar) => { println!(\"This is Case2\"); some_complex_expression(bar) }\r\n    Case3(ref bar) => { println!(\"This is Case3\"); some_complex_expression(bar) }\r\n    SomethingElseEntirely => ...\r\n  }\r\n}\r\n```\r\n\r\nHere, the branches attached to `Case1`, `Case2`, `Case3` are essentially the same. Indeed, the only difference is in the `println`. However, this difference is sufficient that we cannot merge the branches.\r\n\r\nIn this specific case, we could rewrite the shared part of the code as a closure or a function, but this is not always possible/desirable. For instance, when writing an AST serializer, there may be dozens of `enum` cases and moving the code to a closure may hurt readability.\r\n\r\nWhat I suggest here is some kind of construction that would let me write:\r\n\r\n```rust\r\nfn walk_through(foo: &Foo) {\r\n  match *foo {\r\n    Case1(ref bar) where let message = \"This is Case1\" |\r\n    Case2(ref bar) where let message = \"This is Case2\" |\r\n    Case3(ref bar) where let message = \"This is Case3\" => {\r\n      println!(\"{}\", message);\r\n      some_complex_expression(bar)\r\n    }\r\n    SomethingElseEntirely => ...\r\n  }\r\n}\r\n```", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42506/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42506/timeline", "performed_via_github_app": null, "state_reason": "completed"}