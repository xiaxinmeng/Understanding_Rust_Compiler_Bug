{"url": "https://api.github.com/repos/rust-lang/rust/issues/31803", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31803/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31803/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31803/events", "html_url": "https://github.com/rust-lang/rust/issues/31803", "id": 135150964, "node_id": "MDU6SXNzdWUxMzUxNTA5NjQ=", "number": 31803, "title": "add insert_get() function to BTreeSet and HashSet", "user": {"login": "Robbepop", "id": 8193155, "node_id": "MDQ6VXNlcjgxOTMxNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8193155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Robbepop", "html_url": "https://github.com/Robbepop", "followers_url": "https://api.github.com/users/Robbepop/followers", "following_url": "https://api.github.com/users/Robbepop/following{/other_user}", "gists_url": "https://api.github.com/users/Robbepop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Robbepop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Robbepop/subscriptions", "organizations_url": "https://api.github.com/users/Robbepop/orgs", "repos_url": "https://api.github.com/users/Robbepop/repos", "events_url": "https://api.github.com/users/Robbepop/events{/privacy}", "received_events_url": "https://api.github.com/users/Robbepop/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 166999014, "node_id": "MDU6TGFiZWwxNjY5OTkwMTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-collections", "name": "A-collections", "color": "f7e101", "default": false, "description": "Area: std::collections."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-02-21T02:53:41Z", "updated_at": "2016-03-16T16:45:40Z", "closed_at": "2016-03-16T16:45:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am missing a method which I just call `insert_get(...)` in the interface of Set.\n\nThe method is a combination of `insert(...)` and the proposed `get(...)` (https://github.com/rust-lang/rust/issues/21234).\n\nSo with `insert_get(...)` I could add a new item to the Set if it isn't already contained and return a reference to it.\n\nHowever, contrary to the combined calls to `insert(...)` and `get(...)` this function would only calculate the hash of the given item once and also only perform the look-up once.\n\nBesides that, given the certainty that the given item is inserted into the Set before we return the reference this method can return a `&T` instead of an `Option<T>` as in `get(...)`.\n\nI am in need of this method since I am trying to create a string cache and want to use this data structure as the owner of all strings within my application. This is not possible with the current API for sets.\n\n**Signature** (fixed: thanks to apasel422)\n\n``` rust\nfn insert_get(&mut self, value: T) -> &T;\n```\n\nor (linked RFC)\n\n``` rust\nfn get_or_insert(&mut self, value: T) -> &T;\n```\n\n**A Problem ...**\nI am not sure if it is possible to implement references out of containers easily since iterator invalidation could happen during insertion of new items deleting all references to items within the set stored outside ...\n\n**A Solution ...**\nTo avoid iterator invalidation one could use indirections e.g. by using `Box<T>` instead of `T`as item type for the HashSet.\nAn implementation could use this in order to provide methods that return references to its owned elements and forbid access to these methods otherwise.\n", "closed_by": {"login": "apasel422", "id": 8644784, "node_id": "MDQ6VXNlcjg2NDQ3ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8644784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apasel422", "html_url": "https://github.com/apasel422", "followers_url": "https://api.github.com/users/apasel422/followers", "following_url": "https://api.github.com/users/apasel422/following{/other_user}", "gists_url": "https://api.github.com/users/apasel422/gists{/gist_id}", "starred_url": "https://api.github.com/users/apasel422/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apasel422/subscriptions", "organizations_url": "https://api.github.com/users/apasel422/orgs", "repos_url": "https://api.github.com/users/apasel422/repos", "events_url": "https://api.github.com/users/apasel422/events{/privacy}", "received_events_url": "https://api.github.com/users/apasel422/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31803/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31803/timeline", "performed_via_github_app": null, "state_reason": "completed"}