{"url": "https://api.github.com/repos/rust-lang/rust/issues/80293", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80293/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80293/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80293/events", "html_url": "https://github.com/rust-lang/rust/issues/80293", "id": 772957131, "node_id": "MDU6SXNzdWU3NzI5NTcxMzE=", "number": 80293, "title": "VecDeque iter+collect causes an infinite loop (1.48.0)", "user": {"login": "matled", "id": 139427, "node_id": "MDQ6VXNlcjEzOTQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/139427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matled", "html_url": "https://github.com/matled", "followers_url": "https://api.github.com/users/matled/followers", "following_url": "https://api.github.com/users/matled/following{/other_user}", "gists_url": "https://api.github.com/users/matled/gists{/gist_id}", "starred_url": "https://api.github.com/users/matled/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matled/subscriptions", "organizations_url": "https://api.github.com/users/matled/orgs", "repos_url": "https://api.github.com/users/matled/repos", "events_url": "https://api.github.com/users/matled/events{/privacy}", "received_events_url": "https://api.github.com/users/matled/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-22T13:43:46Z", "updated_at": "2021-01-12T11:20:35Z", "closed_at": "2021-01-12T11:20:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "I discovered that `VecDeque` can produce an infinite loop in an iterator when using iter+collect.\r\n\r\n[code demonstrating the issue](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ac094612a9272cbf61eb28dedc5159c0):\r\n```rust\r\nuse std::collections::VecDeque;\r\nuse std::iter::FromIterator;\r\n\r\nfn main() {\r\n    let mut v = VecDeque::from_iter(0..6);\r\n    v.pop_front();\r\n    v.pop_front();\r\n    v.push_back(6);\r\n    v.push_back(7);\r\n    v.push_back(8);\r\n    v.make_contiguous();\r\n    // `v.iter().collect()` does not terminate at this point.\r\n    // Limit `collect` to `v.len() * 3` to avoid the inifinite iteration.\r\n    let collected: Vec<_> = v.iter().copied().take(v.len() * 3).collect();\r\n    assert_eq!(v.as_slices(), (&collected[..], &[] as &[_]));\r\n    // Result on stable 1.48.0 (7eac88abb 2020-11-16)\r\n    // thread 'main' panicked at 'assertion failed: `(left == right)`\r\n    //   left: `([2, 3, 4, 5, 6, 7, 8], [])`,\r\n    //  right: `([2, 3, 4, 5, 6, 7, 8, 8, 2, 3, 4, 5, 6, 7, 8, 8, 2, 3, 4, 5, 6], [])`', src/main.rs:15:5\r\n}\r\n```\r\n\r\nThis happens with stable (1.48.0, 7eac88abb). I could not reproduce the issue on 1.50.0-nightly 11c94a197 or 1.49.0-beta.4 877c7cbe1.\r\n\r\nI think this may be related/a duplicate of #79808. Particularly 527934d15cf looks highly related to this issue (@lcnr).\r\n\r\nI'm filing this bug as I'm not super familiar with Rust and think it may be worth to confirm that this is caused by the same underlying issue and appropriately fixed already.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80293/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80293/timeline", "performed_via_github_app": null, "state_reason": "completed"}