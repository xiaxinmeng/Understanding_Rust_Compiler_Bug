{"url": "https://api.github.com/repos/rust-lang/rust/issues/22528", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22528/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22528/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22528/events", "html_url": "https://github.com/rust-lang/rust/issues/22528", "id": 58194676, "node_id": "MDU6SXNzdWU1ODE5NDY3Ng==", "number": 22528, "title": "Linux shared libraries can't be loaded in Java", "user": {"login": "drrb", "id": 2309891, "node_id": "MDQ6VXNlcjIzMDk4OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2309891?v=4", "gravatar_id": "", "url": "https://api.github.com/users/drrb", "html_url": "https://github.com/drrb", "followers_url": "https://api.github.com/users/drrb/followers", "following_url": "https://api.github.com/users/drrb/following{/other_user}", "gists_url": "https://api.github.com/users/drrb/gists{/gist_id}", "starred_url": "https://api.github.com/users/drrb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/drrb/subscriptions", "organizations_url": "https://api.github.com/users/drrb/orgs", "repos_url": "https://api.github.com/users/drrb/repos", "events_url": "https://api.github.com/users/drrb/events{/privacy}", "received_events_url": "https://api.github.com/users/drrb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-02-19T11:10:00Z", "updated_at": "2016-09-28T18:29:58Z", "closed_at": "2016-09-28T18:29:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "It seems that there is something peculiar about the shared libraries that come with Rust for Linux that stops them from being able to be loaded from Java. Loading libraries this way is important for embedding Rust code in Java, and works as expected with the OSX shared libraries.\n\nScript that reproduces the problem on post-alpha nightlies (tested with Ubuntu 12.04/14.10 64 bit, OpenJDK 7, Oracle JDK 7, 8):\n\n``` bash\n#!/bin/bash -e\n\ntrap 'rm *.java *.class' EXIT\n\ncat > LoadNativeLibrary.java <<EOF\nclass LoadNativeLibrary {\n    public static void main(String[] args) {\n        String library = args[0];\n        System.load(library);\n    }\n}\nEOF\njavac LoadNativeLibrary.java\n\necho \"Attempting to load libsyntax in Java...\"\njava LoadNativeLibrary /usr/local/lib/libsyntax-*.so\necho \"Loaded\"\n```\n\nExample output:\n\n```\n$ ./load-rust-library \nAttempting to load libsyntax in Java...\n./load-rust-library: line 16:  8388 Segmentation fault      (core dumped) java LoadNativeLibrary /usr/local/lib/libsyntax-*.so\n```\n\nCore dump backtrace:\n\n```\nCore was generated by `java LoadNativeLibrary /usr/local/lib/libsyntax-4e7c5e5c.so'.\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  open_verify (name=0x7f9f7c0e1770 \"/usr/local/lib/libsyntax-4e7c5e5c.so\", fbp=0x7f9f84a353d8, loader=<optimized out>, whatcode=<optimized out>, found_other_class=<optimized out>, \n    free_name=<optimized out>) at dl-load.c:2098\n2098    dl-load.c: No such file or directory.\n(gdb) bt full\n#0  open_verify (name=0x7f9f7c0e1770 \"/usr/local/lib/libsyntax-4e7c5e5c.so\", fbp=0x7f9f84a353d8, loader=<optimized out>, whatcode=<optimized out>, found_other_class=<optimized out>, \n    free_name=<optimized out>) at dl-load.c:2098\n        size = 3836402\n        phdr = 0x7f9f84a35420\n        ph = 0x7f9f84a354c8\n        ehdr = 0x7f9f84a353e0\n        abi_note = <optimized out>\n        osversion = <optimized out>\n        maplength = <optimized out>\n        errstring = 0x0\n        errval = 0\n        fd = 11\n#1  0x00007f9f8482ed9f in _dl_map_object (loader=loader@entry=0xd227e0, name=name@entry=0x7f9f7c0e0c90 \"/usr/local/lib/libsyntax-4e7c5e5c.so\", type=type@entry=2, trace_mode=trace_mode@entry=0, \n    mode=mode@entry=-1879048191, nsid=0) at dl-load.c:2543\n        fd = <optimized out>\n        realname = 0x7f9f7c0e1770 \"/usr/local/lib/libsyntax-4e7c5e5c.so\"\n        l = <optimized out>\n        fb = {len = 832, \n          buf = \"\\177ELF\\002\\001\\001\\000\\000\\000\\000\\000\\000\\000\\000\\000\\003\\000>\\000\\001\\000\\000\\000\\220\\377\\004\\000\\000\\000\\000\\000@\\000\\000\\000\\000\\000\\000\\000\\030|{\\000\\000\\000\\000\\000\\000\\000\\000\\000@\\000\\070\\000\\a\\000@\\000\\037\\000\\034\\000\\001\\000\\000\\000\\005\", '\\000' <repeats 28 times>, \"\\365?\\000\\000\\000\\000\\000\\000\\365?\\000\\000\\000\\000\\000\\000\\000 \\000\\000\\000\\000\\000\\001\\000\\000\\000\\006\\000\\000\\000\\000\\365?\\000\\000\\000\\000\\000\\000\\365_\\000\\000\\000\\000\\000\\000\\365_\\000\\000\\000\\000\\000\\222\\205;\\000\\000\\000\\000\\000\\250\\205;\\000\\000\\000\\000\\000\\000\\000 \\000\\000\\000\\000\\000\\002\\000\\000\\000\\006\\000\\000\\000P\\320@\\000\\000\\000\\000\\000P\\320`\\000\\000\\000\\000\\000\"...}\n        __PRETTY_FUNCTION__ = \"_dl_map_object\"\n        found_other_class = false\n        stack_end = 0x7f9f00000000\n#2  0x00007f9f8483aa54 in dl_open_worker (a=a@entry=0x7f9f84a35958) at dl-open.c:235\n        args = 0x7f9f84a35958\n        file = 0x7f9f7c0e0c90 \"/usr/local/lib/libsyntax-4e7c5e5c.so\"\n        mode = -2147483647\n        call_map = 0xd227e0\n        dst = <optimized out>\n        __PRETTY_FUNCTION__ = \"dl_open_worker\"\n        new = <optimized out>\n        r = <optimized out>\n        reloc_mode = <optimized out>\n        nmaps = <optimized out>\n        l = <optimized out>\n        maps = <optimized out>\n        any_tls = <optimized out>\n        first_static_tls = <optimized out>\n#3  0x00007f9f84835ff4 in _dl_catch_error (objname=objname@entry=0x7f9f84a35948, errstring=errstring@entry=0x7f9f84a35950, mallocedp=mallocedp@entry=0x7f9f84a35940, \n    operate=operate@entry=0x7f9f8483a9a0 <dl_open_worker>, args=args@entry=0x7f9f84a35958) at dl-error.c:187\n        errcode = 32671\n        c = {objname = 0x7f9f84a35948, errstring = 0x7f9f84a35950, malloced = 0x7f9f84a35940, errcode = 0x7f9f84a35834, env = {{__jmpbuf = {140323101825624, 9168241663064937987, 2147483649, 140322957823120, \n                140736273650424, 3, 9168241662859417091, 9168241938003793411}, __mask_was_saved = 2080374816, __saved_mask = {__val = {50752, 0, 8092888, 50736, 1792, 140323094083624, 3598896384, 391126, \n                  4095, 391168, 4096, 1, 140323101825376, 763, 3669971740273, 95}}}}}\n        catchp = 0x7f9f84a376f8\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22528/timeline", "performed_via_github_app": null, "state_reason": "completed"}