{"url": "https://api.github.com/repos/rust-lang/rust/issues/85000", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85000/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85000/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85000/events", "html_url": "https://github.com/rust-lang/rust/issues/85000", "id": 877814204, "node_id": "MDU6SXNzdWU4Nzc4MTQyMDQ=", "number": 85000, "title": "Coverage only applies to spans in a contiguous span of source code (not both macro and caller)", "user": {"login": "richkadel", "id": 3827298, "node_id": "MDQ6VXNlcjM4MjcyOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3827298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richkadel", "html_url": "https://github.com/richkadel", "followers_url": "https://api.github.com/users/richkadel/followers", "following_url": "https://api.github.com/users/richkadel/following{/other_user}", "gists_url": "https://api.github.com/users/richkadel/gists{/gist_id}", "starred_url": "https://api.github.com/users/richkadel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richkadel/subscriptions", "organizations_url": "https://api.github.com/users/richkadel/orgs", "repos_url": "https://api.github.com/users/richkadel/repos", "events_url": "https://api.github.com/users/richkadel/events{/privacy}", "received_events_url": "https://api.github.com/users/richkadel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2483744621, "node_id": "MDU6TGFiZWwyNDgzNzQ0NjIx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-code-coverage", "name": "A-code-coverage", "color": "f7e101", "default": false, "description": "Area: Source-based code coverage (-Cinstrument-coverage)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-05-06T18:08:14Z", "updated_at": "2023-03-30T20:29:55Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Explore adding coverage spans for all sources that emit some coverable spans, including macros and the source that invokes the macros.\r\n\r\nThe current implementation of `-Zinstrument-coverage` requires choosing a span in which to report coverage. Typically this is the function's or closure's body_span, so functions that invoke macros will have coverage but code within the expanded macro will not have coverage. Or, if the macro starts the body span (if the macro emits the left curly brace), the macro will have coverage, and any code in the calling source (if passed as an argument to the macro) will not get coverage.\r\n\r\nThis latter effect was a problem for closures that don't include enclosing braces, until PR #84897 .\r\n\r\nPR #84897 is better, but limited: The PR removed coverage from a macro that included most of the function logic (`on_error!()` defined in `closure_macro.rs` and `closure_macro_async.rs` coverage tests.)\r\n\r\nInstead of the change in PR #84897, if we can actually add spans to all sources that emit some part of the actual covered, expanded function body syntax, I think this will give coverage results everywhere they apply (except perhaps for macros that generate code that splits a statement or terminator implementation across multiple source spans).\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85000/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85000/timeline", "performed_via_github_app": null, "state_reason": null}