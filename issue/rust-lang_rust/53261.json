{"url": "https://api.github.com/repos/rust-lang/rust/issues/53261", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53261/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53261/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53261/events", "html_url": "https://github.com/rust-lang/rust/issues/53261", "id": 349697159, "node_id": "MDU6SXNzdWUzNDk2OTcxNTk=", "number": 53261, "title": "I found the OsStr(ing) documentation misleading w.r.t. Windows", "user": {"login": "8573", "id": 3662816, "node_id": "MDQ6VXNlcjM2NjI4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/3662816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/8573", "html_url": "https://github.com/8573", "followers_url": "https://api.github.com/users/8573/followers", "following_url": "https://api.github.com/users/8573/following{/other_user}", "gists_url": "https://api.github.com/users/8573/gists{/gist_id}", "starred_url": "https://api.github.com/users/8573/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/8573/subscriptions", "organizations_url": "https://api.github.com/users/8573/orgs", "repos_url": "https://api.github.com/users/8573/repos", "events_url": "https://api.github.com/users/8573/events{/privacy}", "received_events_url": "https://api.github.com/users/8573/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 45472092, "node_id": "MDU6TGFiZWw0NTQ3MjA5Mg==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-ffi", "name": "A-ffi", "color": "f7e101", "default": false, "description": "Area: Foreign Function Interface (FFI)"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-08-11T02:00:14Z", "updated_at": "2021-12-08T14:28:35Z", "closed_at": "2021-12-08T14:28:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "The [documentation for `std::ffi::OsString`] says\u2014\r\n\r\n> On Windows, [platform-native] strings are often arbitrary sequences of non-zero 16-bit values, interpreted as UTF-16 when it is valid to do so.\r\n\r\nThe [documentation for `std::ffi` \u00a7 \"Representations of non-Rust strings\"] says\u2014\r\n\r\n> - OsString represents an owned string in whatever representation the operating system prefers. [...]\r\n> - OsStr represents a borrowed reference to a string in a format that can be passed to the operating system. [...]\r\n\r\nThese statements led me to understand that\u2014\r\n\r\n- on Microsoft Windows, an `OsString` would represent its text as \"arbitrary sequences of non-zero 16-bit values\", and not as UTF-8, and thus\r\n- on Windows, an `OsStr` would reference such a non-UTF-8 sequence, and thus\r\n- [`OsStr::to_str`] \u2014 which returns an `Option`al `&str` that (by my imperfect understanding of Rust reference rules) would have to reference the same thing as the `OsStr` \u2014 almost always would return `None` on Windows (except for, e.g., empty strings), because a Windows string could not validly be read as a Rust `str`.\r\n\r\nHowever, @retep998 tells me that\u2014\r\n\r\n- \"OsStr::to_str on Windows will succeed most of the time\",\r\n- `OsString` stores its text in WTF-8 on Windows, and\r\n- > it's more accurate [than what the `std::ffi` documentation says] to say that OsStr represents an owned string in a representation capable of handling any string received from the operating system\r\n  > not necessarily the same encoding as what the operating system uses, but it can losslessly transcode back and forth\r\n\r\nWas my misinterpretation of the documentation unreasonable? If not, could the documentation be clarified on this point?\r\n\r\n[documentation for `std::ffi::OsString`]: <https://doc.rust-lang.org/std/ffi/struct.OsString.html>\r\n[documentation for `std::ffi` \u00a7 \"Representations of non-Rust strings\"]: <https://doc.rust-lang.org/std/ffi/index.html#representations-of-non-rust-strings>\r\n[`OsStr::to_str`]: <https://doc.rust-lang.org/std/ffi/struct.OsStr.html#method.to_str>", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53261/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53261/timeline", "performed_via_github_app": null, "state_reason": "completed"}