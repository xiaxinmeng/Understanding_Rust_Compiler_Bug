{"url": "https://api.github.com/repos/rust-lang/rust/issues/49869", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49869/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49869/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49869/events", "html_url": "https://github.com/rust-lang/rust/issues/49869", "id": 313261568, "node_id": "MDU6SXNzdWUzMTMyNjE1Njg=", "number": 49869, "title": "Regression: MSVC/VS2017 fails to link rustc in miniz.o", "user": {"login": "abonander", "id": 3198595, "node_id": "MDQ6VXNlcjMxOTg1OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonander", "html_url": "https://github.com/abonander", "followers_url": "https://api.github.com/users/abonander/followers", "following_url": "https://api.github.com/users/abonander/following{/other_user}", "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonander/subscriptions", "organizations_url": "https://api.github.com/users/abonander/orgs", "repos_url": "https://api.github.com/users/abonander/repos", "events_url": "https://api.github.com/users/abonander/events{/privacy}", "received_events_url": "https://api.github.com/users/abonander/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2018-04-11T10:19:40Z", "updated_at": "2019-05-22T17:40:25Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have MSVC installed through Visual Studio 2017. It used to work fine but very recently I have hit a regression in linking `rustc` with `miniz.o`:\r\n\r\n```\r\nCompiling rustc v0.0.0 (file:///C:/Users/cyber/Rust/rust/src/librustc)\r\nerror: linking with `C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.13.26128\\bin\\HostX64\\x64\\link.exe` failed: exit code: 1120\r\n  |\r\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Community\\\\VC\\\\Tools\\\\MSVC\\\\14.13.26128\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-sysroot\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc0-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc1-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc2-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc3-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc4-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc5-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc6-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.rustc7-f229a91c0528eceb2c17c37abdfa1e60.rs.rcgu.o\" \"/OUT:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.dll\" \"/DEF:C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\lib.def\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.crate.metadata.rcgu.o\" \"C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.crate.allocator.rcgu.o\" \"/OPT:REF,ICF\" \"/DEBUG\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\release\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\build\\\\miniz-sys-386dfa5bb266d631\\\\out\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-sysroot\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"psapi.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-sysroot\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"test-df926bd1ab5fd104.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-sysroot\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"term-3fe728aae5ce7da5.dll.lib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libflate2-f910e11d6a06ae5e.rlib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libminiz_sys-11b1e7ea6e848cba.rlib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\liblibc-eeed0d808ff34cba.rlib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libbacktrace-6815acd00c774abd.rlib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\librustc_demangle-7e093ccf0057a92d.rlib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libbyteorder-98cb0bccab47de74.rlib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"proc_macro-85741acd40c8722e.dll.lib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libjobserver-6f77f02e5c37ee01.rlib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"rustc_const_math-542876ec2770c2cb.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"rustc_back-4211764832c56432.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"syntax-e45249716652a60c.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"rustc_errors-ad984646b9d61af6.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"syntax_pos-b98a1de894166ba0.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"rustc_data_structures-985119952f88acaa.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"serialize-8d2a38a7d63d5b3d.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"rustc_cratesio_shim-0f4f3b26149e3475.dll.lib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\liblazy_static-8d7b70e9dbdb4e00.rlib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"graphviz-0e70195c5cd98069.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"fmt_macros-58082eb5b11691a5.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\" \"arena-64bd765e7e31a4ab.dll.lib\" \"/LIBPATH:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-sysroot\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"std-1c1752cc72c96a73.dll.lib\" \"C:\\\\Users\\\\cyber\\\\AppData\\\\Local\\\\Temp\\\\rustc.jaql3r8uVhnm\\\\libcompiler_builtins-e53948253266021b.rlib\" \"kernel32.lib\" \"setupapi.lib\" \"credui.lib\" \"opengl32.lib\" \"synchronization.lib\" \"msimg32.lib\" \"winspool.lib\" \"gdi32.lib\" \"kernel32.lib\" \"dbghelp.lib\" \"user32.lib\" \"secur32.lib\" \"advapi32.lib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"shell32.lib\" \"libcmt.lib\" \"/DLL\" \"/IMPLIB:C:\\\\Users\\\\cyber\\\\Rust\\\\rust\\\\build\\\\x86_64-pc-windows-msvc\\\\stage0-rustc\\\\x86_64-pc-windows-msvc\\\\release\\\\deps\\\\rustc-7d90e5433b19a0af.dll.lib\"\r\n  = note:    Creating library C:\\Users\\cyber\\Rust\\rust\\build\\x86_64-pc-windows-msvc\\stage0-rustc\\x86_64-pc-windows-msvc\\release\\deps\\rustc-7d90e5433b19a0af.dll.lib and object C:\\Users\\cyber\\Rust\\rust\\build\\x86_64-pc-windows-msvc\\stage0-rustc\\x86_64-pc-windows-msvc\\release\\deps\\rustc-7d90e5433b19a0af.dll.exp\r\n          libcmt.lib(initializers.obj) : warning LNK4098: defaultlib 'msvcrt.lib' conflicts with use of other libs; use /NODEFAULTLIB:library\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : warning LNK4217: locally defined symbol free imported in function def_free_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : warning LNK4217: locally defined symbol malloc imported in function def_alloc_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : warning LNK4217: locally defined symbol fclose imported in function mz_zip_reader_end\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : warning LNK4217: locally defined symbol fflush imported in function mz_zip_writer_finalize_archive\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_realloc referenced in function def_realloc_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__localtime64_s referenced in function localtime_s\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__mktime64 referenced in function mktime\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__time64 referenced in function mz_zip_writer_add_mem_ex\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__wassert referenced in function mz_zip_array_ensure_capacity\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_fopen_s referenced in function mz_fopen\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_freopen_s referenced in function mz_freopen\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_fread referenced in function mz_zip_file_read_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__fseeki64 referenced in function mz_zip_file_read_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__ftelli64 referenced in function mz_zip_file_read_func\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_fwrite referenced in function mz_zip_file_write_callback\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp_remove referenced in function mz_zip_add_mem_to_archive_file_in_place\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__stat64i32 referenced in function mz_zip_add_mem_to_archive_file_in_place\r\n          libminiz_sys-11b1e7ea6e848cba.rlib(miniz.o) : error LNK2019: unresolved external symbol __imp__utime64 referenced in function mz_zip_reader_extract_file_to_file\r\n          C:\\Users\\cyber\\Rust\\rust\\build\\x86_64-pc-windows-msvc\\stage0-rustc\\x86_64-pc-windows-msvc\\release\\deps\\rustc-7d90e5433b19a0af.dll : fatal error LNK1120: 14 unresolved externals\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `rustc`.\r\n```\r\n\r\nThe errors suggest the wrong CRT is being linked to. I'm running the latest nightly as of this post: `rustc 1.27.0-nightly (0b72d48f8 2018-04-10)`. This also seems to be specific to Rustbuild as I cloned flate2-rs and ran `cargo test` and all tests passed.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49869/timeline", "performed_via_github_app": null, "state_reason": null}