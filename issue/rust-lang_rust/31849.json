{"url": "https://api.github.com/repos/rust-lang/rust/issues/31849", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31849/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31849/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31849/events", "html_url": "https://github.com/rust-lang/rust/issues/31849", "id": 135839420, "node_id": "MDU6SXNzdWUxMzU4Mzk0MjA=", "number": 31849, "title": "Typechecking memory use", "user": {"login": "asajeffrey", "id": 403333, "node_id": "MDQ6VXNlcjQwMzMzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/403333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asajeffrey", "html_url": "https://github.com/asajeffrey", "followers_url": "https://api.github.com/users/asajeffrey/followers", "following_url": "https://api.github.com/users/asajeffrey/following{/other_user}", "gists_url": "https://api.github.com/users/asajeffrey/gists{/gist_id}", "starred_url": "https://api.github.com/users/asajeffrey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asajeffrey/subscriptions", "organizations_url": "https://api.github.com/users/asajeffrey/orgs", "repos_url": "https://api.github.com/users/asajeffrey/repos", "events_url": "https://api.github.com/users/asajeffrey/events{/privacy}", "received_events_url": "https://api.github.com/users/asajeffrey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2016-02-23T19:33:53Z", "updated_at": "2017-03-22T08:52:47Z", "closed_at": "2017-03-22T08:52:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Typechecking the rust library at https://github.com/asajeffrey/wasm/tree/typechecking-blowup uses more than 10G of memory. The program uses a lot of nested generic traits and lifetime polymorphism. The timing details are:\n\n```\n$ multirust run nightly cargo rustc -- -Z time-passes\n   Compiling wasm v0.0.1 (file:///home/ajeffrey/github/asajeffrey/wasm)\ntime: 0.001; rss: 49MB  parsing\ntime: 0.000; rss: 49MB  configuration 1\ntime: 0.000; rss: 49MB  recursion limit\ntime: 0.000; rss: 49MB  gated macro checking\ntime: 0.000; rss: 49MB  crate injection\ntime: 0.003; rss: 54MB  macro loading\ntime: 0.000; rss: 54MB  plugin loading\ntime: 0.000; rss: 54MB  plugin registration\ntime: 0.025; rss: 56MB  expansion\ntime: 0.001; rss: 56MB  complete gated feature checking 1\ntime: 0.007; rss: 56MB  configuration 2\ntime: 0.000; rss: 56MB  gated configuration checking\ntime: 0.003; rss: 56MB  maybe building test harness\ntime: 0.003; rss: 56MB  prelude injection\ntime: 0.000; rss: 56MB  checking that all macro invocations are gone\ntime: 0.000; rss: 56MB  checking for inline asm in case the target doesn't support it\ntime: 0.000; rss: 56MB  complete gated feature checking 2\ntime: 0.000; rss: 56MB  const fn bodies and arguments\ntime: 0.002; rss: 56MB  assigning node ids\ntime: 0.003; rss: 62MB  lowering ast -> hir\ntime: 0.001; rss: 62MB  indexing hir\ntime: 0.000; rss: 62MB  attribute checking\ntime: 0.002; rss: 62MB  early lint checks\ntime: 0.001; rss: 60MB  external crate/lib resolution\ntime: 0.000; rss: 60MB  language item collection\ntime: 0.005; rss: 68MB  resolution\ntime: 0.000; rss: 68MB  lifetime resolution\ntime: 0.000; rss: 68MB  looking for entry point\ntime: 0.000; rss: 68MB  looking for plugin registrar\ntime: 0.001; rss: 69MB  region resolution\ntime: 0.000; rss: 69MB  loop checking\ntime: 0.000; rss: 69MB  static item recursion checking\ntime: 0.003; rss: 71MB  type collecting\ntime: 0.000; rss: 71MB  variance inference\ntime: 0.027; rss: 89MB  coherence checking\ntime: 0.014; rss: 89MB  wf checking\ntime: 0.004; rss: 89MB  item-types checking\n```\n\nat which point the process starts using large amounts of time and memory. \n\nThe same behaviour happens with nightly-2015-12-01, so this is not part of the recent rewrite of typechecking.\n\nDiscussed on irc with @eddyb, @Manishearth and @aturon.\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31849/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31849/timeline", "performed_via_github_app": null, "state_reason": "completed"}