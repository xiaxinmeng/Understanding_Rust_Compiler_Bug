{"url": "https://api.github.com/repos/rust-lang/rust/issues/58742", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58742/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58742/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58742/events", "html_url": "https://github.com/rust-lang/rust/issues/58742", "id": 414340141, "node_id": "MDU6SXNzdWU0MTQzNDAxNDE=", "number": 58742, "title": "panic with \"Layout mismatch when copying!\"", "user": {"login": "mattheww", "id": 395747, "node_id": "MDQ6VXNlcjM5NTc0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/395747?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattheww", "html_url": "https://github.com/mattheww", "followers_url": "https://api.github.com/users/mattheww/followers", "following_url": "https://api.github.com/users/mattheww/following{/other_user}", "gists_url": "https://api.github.com/users/mattheww/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattheww/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattheww/subscriptions", "organizations_url": "https://api.github.com/users/mattheww/orgs", "repos_url": "https://api.github.com/users/mattheww/repos", "events_url": "https://api.github.com/users/mattheww/events{/privacy}", "received_events_url": "https://api.github.com/users/mattheww/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 900795185, "node_id": "MDU6TGFiZWw5MDA3OTUxODU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-eval", "name": "A-const-eval", "color": "f7e101", "default": false, "description": "Area: constant evaluation (mir interpretation)"}], "state": "closed", "locked": false, "assignee": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2019-02-25T22:34:46Z", "updated_at": "2019-03-11T11:46:17Z", "closed_at": "2019-03-11T11:46:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Running yesterday's nightly rustdoc on the following file panics for me:\r\n\r\n```\r\nconst fn one(arr: &[u8; 1]) -> u8 {\r\n    arr[0]\r\n}\r\n\r\nconst fn two(byte: u8) -> [u8; 1] {[\r\n    byte\r\n]}\r\n\r\nconst fn three(data: u8) -> u8 {\r\n    one(&two(data))\r\n}\r\n\r\nconst FOO: u8 = three(0x0);\r\n```\r\n\r\nIt says `thread 'rustc' panicked at 'Layout mismatch when copying!`.\r\n\r\nThe version is `rustdoc 1.34.0-nightly (097c04cf4 2019-02-24)`.\r\n\r\nThere isn't a problem compiling the file.\r\n\r\nOutput including backtrace:\r\n\r\n```\r\n% RUST_BACKTRACE=1 rustdoc +nightly --color=never src/lib.rs\r\nthread 'rustc' panicked at 'Layout mismatch when copying!\r\nsrc: OpTy {\r\n    op: Indirect(\r\n        MemPlace {\r\n            ptr: Ptr(\r\n                Pointer {\r\n                    alloc_id: AllocId(\r\n                        4\r\n                    ),\r\n                    offset: Size {\r\n                        raw: 0\r\n                    },\r\n                    tag: ()\r\n                }\r\n            ),\r\n            align: Align {\r\n                pow2: 0\r\n            },\r\n            meta: None\r\n        }\r\n    ),\r\n    layout: TyLayout {\r\n        ty: [u8; 1],\r\n        details: LayoutDetails {\r\n            variants: Single {\r\n                index: 0\r\n            },\r\n            fields: Array {\r\n                stride: Size {\r\n                    raw: 1\r\n                },\r\n                count: 1\r\n            },\r\n            abi: Aggregate {\r\n                sized: true\r\n            },\r\n            align: AbiAndPrefAlign {\r\n                abi: Align {\r\n                    pow2: 0\r\n                },\r\n                pref: Align {\r\n                    pow2: 0\r\n                }\r\n            },\r\n            size: Size {\r\n                raw: 1\r\n            }\r\n        }\r\n    }\r\n}\r\ndest: PlaceTy {\r\n    place: Local {\r\n        frame: 0,\r\n        local: _2\r\n    },\r\n    layout: TyLayout {\r\n        ty: u8,\r\n        details: LayoutDetails {\r\n            variants: Single {\r\n                index: 0\r\n            },\r\n            fields: Union(\r\n                0\r\n            ),\r\n            abi: Scalar(\r\n                Scalar {\r\n                    value: Int(\r\n                        I8,\r\n                        false\r\n                    ),\r\n                    valid_range: 0..=255\r\n                }\r\n            ),\r\n            align: AbiAndPrefAlign {\r\n                abi: Align {\r\n                    pow2: 0\r\n                },\r\n                pref: Align {\r\n                    pow2: 0\r\n                }\r\n            },\r\n            size: Size {\r\n                raw: 1\r\n            }\r\n        }\r\n    }\r\n}', src/librustc_mir/interpret/place.rs:826:9\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1: std::sys_common::backtrace::_print\r\n             at src/libstd/sys_common/backtrace.rs:70\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at src/libstd/sys_common/backtrace.rs:58\r\n             at src/libstd/panicking.rs:200\r\n   3: std::panicking::default_hook\r\n             at src/libstd/panicking.rs:215\r\n   4: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:478\r\n   5: std::panicking::continue_panic_fmt\r\n             at src/libstd/panicking.rs:385\r\n   6: std::panicking::begin_panic_fmt\r\n             at src/libstd/panicking.rs:340\r\n   7: rustc_mir::interpret::place::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::copy_op_no_validate\r\n   8: rustc_mir::interpret::step::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::run\r\n   9: rustc_mir::const_eval::eval_body_using_ecx\r\n  10: rustc_mir::const_eval::const_eval_raw_provider\r\n  11: rustc::ty::query::__query_compute::const_eval_raw\r\n  12: rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::const_eval_raw<'tcx>>::compute\r\n  13: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  14: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::get_query\r\n  15: <rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::const_eval_raw\r\n  16: rustc_mir::interpret::place::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::eval_place_to_mplace\r\n  17: rustc_mir::interpret::place::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::eval_place\r\n  18: rustc_mir::interpret::step::<impl rustc_mir::interpret::eval_context::EvalContext<'a, 'mir, 'tcx, M>>::run\r\n  19: rustc_mir::const_eval::eval_body_using_ecx\r\n  20: rustc_mir::const_eval::const_eval_raw_provider\r\n  21: rustc::ty::query::__query_compute::const_eval_raw\r\n  22: rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::const_eval_raw<'tcx>>::compute\r\n  23: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  24: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::get_query\r\n  25: rustc_mir::const_eval::const_eval_provider\r\n  26: rustc::ty::query::__query_compute::const_eval\r\n  27: rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::const_eval<'tcx>>::compute\r\n  28: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  29: rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::get_query\r\n  30: rustc_lint::builtin::check_const\r\n  31: <rustc_lint::register_builtins::BuiltinCombinedLateLintPass as rustc::lint::LateLintPass<'a, 'tcx>>::check_item\r\n  32: <rustc::lint::context::LateContext<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_item\r\n  33: <rustc::lint::context::LateContext<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_mod\r\n  34: rustc::hir::intravisit::walk_crate\r\n  35: rustc::lint::context::check_crate\r\n  36: rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::{{closure}}\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:1333\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/util/common.rs:150\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/util/common.rs:144\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:1333\r\n  37: rustc::util::common::time\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/util/common.rs:150\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/util/common.rs:144\r\n  38: <std::thread::local::LocalKey<T>>::with\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:1321\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:2000\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1966\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1899\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1965\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1999\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1954\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libstd/thread/local.rs:300\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libstd/thread/local.rs:246\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1946\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libstd/thread/local.rs:300\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libstd/thread/local.rs:246\r\n  39: rustc::ty::context::TyCtxt::create_and_enter\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1938\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1977\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc/ty/context.rs:1290\r\n  40: rustc_driver::driver::phase_3_run_analysis_passes\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:1213\r\n  41: <scoped_tls::ScopedKey<T>>::set\r\n             at src/librustdoc/core.rs:494\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:65\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155\r\n  42: <scoped_tls::ScopedKey<T>>::set\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/librustc_driver/driver.rs:64\r\n             at src/librustdoc/core.rs:400\r\n             at src/librustdoc/lib.rs:434\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libsyntax/lib.rs:100\r\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:155\r\n  43: syntax::with_globals\r\n             at /rustc/097c04cf433048585dd9e3f63b30e03cc3509e4b/src/libsyntax/lib.rs:99\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.34.0-nightly (097c04cf4 2019-02-24) running on i686-unknown-linux-gnu\r\n```\r\n", "closed_by": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58742/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58742/timeline", "performed_via_github_app": null, "state_reason": "completed"}