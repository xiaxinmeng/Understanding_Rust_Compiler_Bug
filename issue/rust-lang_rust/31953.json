{"url": "https://api.github.com/repos/rust-lang/rust/issues/31953", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31953/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31953/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31953/events", "html_url": "https://github.com/rust-lang/rust/issues/31953", "id": 137103898, "node_id": "MDU6SXNzdWUxMzcxMDM4OTg=", "number": 31953, "title": "Complex iterator chain is very slow to compile", "user": {"login": "Nercury", "id": 106180, "node_id": "MDQ6VXNlcjEwNjE4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/106180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nercury", "html_url": "https://github.com/Nercury", "followers_url": "https://api.github.com/users/Nercury/followers", "following_url": "https://api.github.com/users/Nercury/following{/other_user}", "gists_url": "https://api.github.com/users/Nercury/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nercury/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nercury/subscriptions", "organizations_url": "https://api.github.com/users/Nercury/orgs", "repos_url": "https://api.github.com/users/Nercury/repos", "events_url": "https://api.github.com/users/Nercury/events{/privacy}", "received_events_url": "https://api.github.com/users/Nercury/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-02-28T22:22:11Z", "updated_at": "2016-02-29T00:13:01Z", "closed_at": "2016-02-29T00:13:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I thought this was a cool way to implement collection of values from a builder into an array, and stumbled upon this case:\n\n``` rust\nuse std::iter;\n\npub struct ConfigFilterRef {\n    alpha_mask_size: Option<[i32; 2]>,\n    alpha_size: Option<[i32; 2]>,\n    bind_to_texture_rgb: Option<[i32; 2]>,\n    bind_to_texture_rgba: Option<[i32; 2]>,\n    blue_size: Option<[i32; 2]>,\n    buffer_size: Option<[i32; 2]>,\n    color_buffer_type: Option<[i32; 2]>,\n    config_caveat: Option<[i32; 2]>,\n    config_id: Option<[i32; 2]>,\n    conformant: Option<[i32; 2]>,\n}\n\nimpl ConfigFilterRef {\n    pub fn new() -> ConfigFilterRef {\n        ConfigFilterRef {\n            alpha_mask_size: None,\n            alpha_size: None,\n            bind_to_texture_rgb: None,\n            bind_to_texture_rgba: None,\n            blue_size: None,\n            buffer_size: None,\n            color_buffer_type: None,\n            config_caveat: None,\n            config_id: None,\n            conformant: None,\n        }\n    }\n\n    pub fn attrs(self) -> Vec<i32> {\n        iter::empty()\n            // slow part start\n            .chain(self.alpha_mask_size.iter().flat_map(|i| i))\n            .chain(self.alpha_size.iter().flat_map(|i| i))\n            .chain(self.bind_to_texture_rgb.iter().flat_map(|i| i))\n            .chain(self.bind_to_texture_rgba.iter().flat_map(|i| i))\n            .chain(self.blue_size.iter().flat_map(|i| i))\n            .chain(self.buffer_size.iter().flat_map(|i| i))\n            .chain(self.color_buffer_type.iter().flat_map(|i| i))\n            .chain(self.config_caveat.iter().flat_map(|i| i))\n            .chain(self.config_id.iter().flat_map(|i| i))\n            .chain(self.conformant.iter().flat_map(|i| i))\n            // slow part end\n            .chain(&[0])\n            .cloned()\n            .collect()\n    }\n}\n\nfn main() {\n    ConfigFilterRef::new().attrs();\n}\n```\n\n**On stable:**\n\n``` bash\n   Compiling test v0.1.0 (file:///Users/nercury/webs/test)\ncargo build  40.86s user 0.74s system 99% cpu 41.930 total\n```\n\n**On nightly:**\n\n``` bash\n   Compiling test v0.1.0 (file:///Users/nercury/webs/test)\ncargo build  46.43s user 0.73s system 99% cpu 47.174 total\n```\n\n**On nightly-2016-02-28:**\n\n``` bash\n   Compiling test v0.1.0 (file:///Users/nercury/webs/test)\ncargo build  44.31s user 0.77s system 99% cpu 45.082 total\n```\n\n**Without \"slow part\":**\n\n``` bash\n   Compiling test v0.1.0 (file:///Users/nercury/webs/test)\ncargo build  0.63s user 0.33s system 99% cpu 0.959 total\n```\n\nFeel free to close if this is a duplicate/won't fix.\n", "closed_by": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31953/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31953/timeline", "performed_via_github_app": null, "state_reason": "completed"}