{"url": "https://api.github.com/repos/rust-lang/rust/issues/77789", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77789/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77789/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77789/events", "html_url": "https://github.com/rust-lang/rust/issues/77789", "id": 718630925, "node_id": "MDU6SXNzdWU3MTg2MzA5MjU=", "number": 77789, "title": "Build failing after update to Rust 1.47.0", "user": {"login": "Tamschi", "id": 715360, "node_id": "MDQ6VXNlcjcxNTM2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/715360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tamschi", "html_url": "https://github.com/Tamschi", "followers_url": "https://api.github.com/users/Tamschi/followers", "following_url": "https://api.github.com/users/Tamschi/following{/other_user}", "gists_url": "https://api.github.com/users/Tamschi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tamschi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tamschi/subscriptions", "organizations_url": "https://api.github.com/users/Tamschi/orgs", "repos_url": "https://api.github.com/users/Tamschi/repos", "events_url": "https://api.github.com/users/Tamschi/events{/privacy}", "received_events_url": "https://api.github.com/users/Tamschi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2079070889, "node_id": "MDU6TGFiZWwyMDc5MDcwODg5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-proc-macros", "name": "A-proc-macros", "color": "f7e101", "default": false, "description": "Area: Procedural macros"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-10-10T14:25:22Z", "updated_at": "2020-10-11T11:45:10Z", "closed_at": "2020-10-11T11:43:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have [a build](https://travis-ci.com/github/Tamschi/taml/builds/189182286) that works fine on Rust 1.46.0 but fails on 1.47.0.  \r\n(I didn't have this issue on any 1.46 version, but I only run CI for 1.46.0.)\r\n\r\nTo reproduce, you can run:\r\n\r\n```cmd\r\ngit clone https://github.com/Tamschi/taml.git -b misc/rustc-bug-report\r\ncd taml\r\ncargo build\r\n```\r\n\r\n(Apologies for the large sample code. I failed to narrow this down on my own.)\r\n\r\nOn 1.46.0, this and `cargo test` complete successfully.  \r\nOn 1.47.0, I get errors of this form:\r\n\r\n```\r\nerror: expected `,`\r\n   --> src\\parsing.rs:541:12\r\n    |\r\n541 |                       Token {\r\n    |  ___________________________^\r\n542 | |                         span: _1,\r\n543 | |                         token: lexerToken::Identifier(_0),\r\n544 | |                     } = iter.next().unwrap()\r\n    | |_____________________^\r\n    |\r\n    = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\n<details><summary>Context</summary>\r\n<p>\r\n\r\n```rust\r\n\tloop {\r\n\t\tmatch iter.peek().map(|t| &t.token) {\r\n\t\t\tNone => break,\r\n\t\t\tSome(lexerToken::Identifier(_)) => {\r\n\t\t\t\tlet (key, key_span) = try_match!(\r\n\t\t\t\t\tToken {\r\n\t\t\t\t\t\tspan: _1,\r\n\t\t\t\t\t\ttoken: lexerToken::Identifier(_0),\r\n\t\t\t\t\t} = iter.next().unwrap()\r\n\t\t\t\t)\r\n\t\t\t\t.debugless_unwrap();\r\n\t\t\t\tbase.push(BasicPathElement {\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Meta\r\n\r\nThe issue also appears on beta and nightly (and also on Linux, judging by the Travis run).\r\n\r\n`rustc --version --verbose`:\r\n* stable:\r\n  ```\r\n  rustc 1.47.0 (18bf6b4f0 2020-10-07)\r\n  binary: rustc\r\n  commit-hash: 18bf6b4f01a6feaf7259ba7cdae58031af1b7b39\r\n  commit-date: 2020-10-07\r\n  host: x86_64-pc-windows-msvc\r\n  release: 1.47.0\r\n  LLVM version: 11.0\r\n  ```\r\n* beta:\r\n  ```\r\n  rustc 1.48.0-beta.2 (212e76c31 2020-10-08)\r\n  binary: rustc\r\n  commit-hash: 212e76c31d461462544b5d516d3bdc99fc8f016e\r\n  commit-date: 2020-10-08\r\n  host: x86_64-pc-windows-msvc\r\n  release: 1.48.0-beta.2\r\n  LLVM version: 11.0\r\n  ```\r\n* nightly:\r\n  ```\r\n  rustc 1.49.0-nightly (38d911dfc 2020-10-09)\r\n  binary: rustc\r\n  commit-hash: 38d911dfc55a7a1eea1c80139113ed2ff0151087\r\n  commit-date: 2020-10-09\r\n  host: x86_64-pc-windows-msvc\r\n  release: 1.49.0-nightly\r\n  LLVM version: 11.0\r\n  ```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Macro Backtrace</summary>\r\n<p>\r\n\r\n`RUSTFLAGS=\"-Z macro-backtrace\" cargo +nightly build` (excerpt):\r\n\r\n```\r\n   Compiling taml v0.0.3 (C:\\Users\\Tamme\\Documents\\Clones\\taml)\r\nerror: expected `,`\r\n   --> src\\parsing.rs:541:12\r\n    |\r\n540 |                   let (key, key_span) = try_match!(\r\n    |  _______________________________________-\r\n541 | |                     Token {\r\n    | |                           ^\r\n542 | |                         span: _1,\r\n543 | |                         token: lexerToken::Identifier(_0),\r\n544 | |                     } = iter.next().unwrap()\r\n545 | |                 )\r\n    | |_________________- in this macro invocation (#1)\r\n    |\r\n   ::: C:\\Users\\Tamme\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\try_match-0.2.2\\src\\lib.rs:106:1\r\n    |\r\n106 | / macro_rules! try_match {\r\n107 | |     ($p:pat = $in:expr => $out:expr) => {\r\n108 | |         match $in {\r\n109 | |             $p => ::core::result::Result::Ok($out),\r\n...   |\r\n120 | |         $crate::implicit_try_match!(($p) = $($in)*)\r\n    | |         ------------------------------------------- in this macro invocation (#2)\r\n121 | |     };\r\n122 | | }\r\n    | |_- in this expansion of `try_match!` (#1)\r\n...\r\n127 | / macro_rules! implicit_try_match {\r\n128 | |     ($p:pat = $($in:tt)*) => {\r\n129 | |         // `$p` needs to be parenthesized for it to work on nightly-2020-05-30\r\n130 | |         // and syn 1.0.29\r\n131 | |         $crate::implicit_try_match_inner!(std($p) = $($in)*)\r\n    | |         ---------------------------------------------------- in this macro invocation (#3)\r\n132 | |     };\r\n133 | | }\r\n    | |_- in this expansion of `$crate::implicit_try_match!` (#2)\r\n...\r\n170 |   #[proc_macro_hack::proc_macro_hack]\r\n    |   -----------------------------------\r\n    |   |\r\n    |   in this expansion of `$crate::implicit_try_match_inner!` (#3)\r\n    |  _in this macro invocation (#4)\r\n    | |\r\n171 | | #[doc(hidden)]\r\n172 | | pub use try_match_inner::implicit_try_match_inner;\r\n    | |_________________________________________________- in this expansion of `proc_macro_call!` (#4)\r\nerror: expected `,`\r\n   --> src\\parsing.rs:589:14\r\n[...]\r\n```\r\n\r\n</p>\r\n</details>", "closed_by": {"login": "Tamschi", "id": 715360, "node_id": "MDQ6VXNlcjcxNTM2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/715360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tamschi", "html_url": "https://github.com/Tamschi", "followers_url": "https://api.github.com/users/Tamschi/followers", "following_url": "https://api.github.com/users/Tamschi/following{/other_user}", "gists_url": "https://api.github.com/users/Tamschi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tamschi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tamschi/subscriptions", "organizations_url": "https://api.github.com/users/Tamschi/orgs", "repos_url": "https://api.github.com/users/Tamschi/repos", "events_url": "https://api.github.com/users/Tamschi/events{/privacy}", "received_events_url": "https://api.github.com/users/Tamschi/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77789/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77789/timeline", "performed_via_github_app": null, "state_reason": "completed"}