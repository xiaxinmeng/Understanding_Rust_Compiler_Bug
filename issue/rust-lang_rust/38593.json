{"url": "https://api.github.com/repos/rust-lang/rust/issues/38593", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38593/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38593/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38593/events", "html_url": "https://github.com/rust-lang/rust/issues/38593", "id": 197474776, "node_id": "MDU6SXNzdWUxOTc0NzQ3NzY=", "number": 38593, "title": "Stainless panics when I try to write a macro for running tests", "user": {"login": "ethanabrooks", "id": 10344742, "node_id": "MDQ6VXNlcjEwMzQ0NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/10344742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ethanabrooks", "html_url": "https://github.com/ethanabrooks", "followers_url": "https://api.github.com/users/ethanabrooks/followers", "following_url": "https://api.github.com/users/ethanabrooks/following{/other_user}", "gists_url": "https://api.github.com/users/ethanabrooks/gists{/gist_id}", "starred_url": "https://api.github.com/users/ethanabrooks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ethanabrooks/subscriptions", "organizations_url": "https://api.github.com/users/ethanabrooks/orgs", "repos_url": "https://api.github.com/users/ethanabrooks/repos", "events_url": "https://api.github.com/users/ethanabrooks/events{/privacy}", "received_events_url": "https://api.github.com/users/ethanabrooks/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-12-24T19:26:50Z", "updated_at": "2016-12-25T15:15:12Z", "closed_at": "2016-12-25T08:54:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am using the [stainless testing framework](https://github.com/reem/stainless) and I found a compiler bug. I'll also post this on the stainless repo.\r\n\r\nThe simplest version of the code that produces the bug is this:\r\n```Rust\r\ndescribe! tests {\r\n    before_each {\r\n        macro_rules! make_test {\r\n        }\r\n    }\r\n\r\n    make_test!();\r\n\r\n    after_each {\r\n    }\r\n}\r\n```\r\n\r\nThe bug that it throws is:\r\n```\r\n   Fresh stainless v0.1.10\r\n   Compiling pipes v0.1.0 (file:///home/ethanbro/lstm)\r\n   Running `rustc main.rs --crate-name pipes -g --test -C metadata=b8dfe5ce564a1ec9 -C extra-filename=-b8dfe5ce564a1ec9 --out-dir /home/ethanbro/lstm/target/debug/deps --emit=dep-info,link -L dependency=/home/ethanbro/lstm/target/debug/deps --extern stainless=/home/ethanbro/lstm/target/debug/deps/libstainless-195115ceaf447e08.so`\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nthread 'rustc' panicked at 'Diagnostic { level: Fatal, message: \"Expected one of: `before_each, after_each, before, after, it, bench, failing, describe, ignore`, but found: `make_test`\", code: None, span: MultiSpan { primary_spans: [Span { lo: BytePos(3788), hi: BytePos(3789), expn_id: ExpnId(4294967295) }], span_labels: [] }, children: [] }', /home/ethanbro/.cargo/registry/src/github.com-1ecc6299db9ec823/stainless-0.1.10/src/parse.rs:192\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\nerror: Could not compile `pipes`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc main.rs --crate-name pipes -g --test -C metadata=b8dfe5ce564a1ec9 -C extra-filename=-b8dfe5ce564a1ec9 --out-dir /home/ethanbro/lstm/target/debug/deps --emit=dep-info,link -L dependency=/home/ethanbro/lstm/target/debug/deps --extern stainless=/home/ethanbro/lstm/target/debug/deps/libstainless-195115ceaf447e08.so` (exit code: 101)\r\n\r\nshell returned 101\r\n```\r\n\r\nLet me know if I can provide any additional info.", "closed_by": {"login": "TimNN", "id": 1178249, "node_id": "MDQ6VXNlcjExNzgyNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TimNN", "html_url": "https://github.com/TimNN", "followers_url": "https://api.github.com/users/TimNN/followers", "following_url": "https://api.github.com/users/TimNN/following{/other_user}", "gists_url": "https://api.github.com/users/TimNN/gists{/gist_id}", "starred_url": "https://api.github.com/users/TimNN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TimNN/subscriptions", "organizations_url": "https://api.github.com/users/TimNN/orgs", "repos_url": "https://api.github.com/users/TimNN/repos", "events_url": "https://api.github.com/users/TimNN/events{/privacy}", "received_events_url": "https://api.github.com/users/TimNN/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38593/timeline", "performed_via_github_app": null, "state_reason": "completed"}