{"url": "https://api.github.com/repos/rust-lang/rust/issues/82590", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82590/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82590/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82590/events", "html_url": "https://github.com/rust-lang/rust/issues/82590", "id": 817934053, "node_id": "MDU6SXNzdWU4MTc5MzQwNTM=", "number": 82590, "title": "std::fs::write is not atomic - document it explicitly or make it atomic", "user": {"login": "Kixunil", "id": 1178779, "node_id": "MDQ6VXNlcjExNzg3Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1178779?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kixunil", "html_url": "https://github.com/Kixunil", "followers_url": "https://api.github.com/users/Kixunil/followers", "following_url": "https://api.github.com/users/Kixunil/following{/other_user}", "gists_url": "https://api.github.com/users/Kixunil/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kixunil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kixunil/subscriptions", "organizations_url": "https://api.github.com/users/Kixunil/orgs", "repos_url": "https://api.github.com/users/Kixunil/repos", "events_url": "https://api.github.com/users/Kixunil/events{/privacy}", "received_events_url": "https://api.github.com/users/Kixunil/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 2238437210, "node_id": "MDU6TGFiZWwyMjM4NDM3MjEw", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-io", "name": "A-io", "color": "f7e101", "default": false, "description": "Area: std::io, std::fs, std::net and std::path"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-02-27T14:30:46Z", "updated_at": "2022-10-27T16:02:27Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "By not being atomic, `std::fs::write()` may be a footgun for people trying to create correct/secure code.\r\nAs an example, nodejs has a function with same behavior that led to [a security risk](https://github.com/Ride-The-Lightning/RTL/issues/610). In that case creation of the secret token file succeeded but writing to it failed leaving an empty token file which caused application to accept empty authentication token later.\r\n\r\nThe documentation currently kind of describes the behavior but the implications may not be obvious to people. Adding a note about the risk of empty/corrupted file being left in case of failure could help people avoid issues.\r\n\r\nIf atomic behavior is undesired due to compatibility reasons, then maybe add another `atomic_write()` function and suggest it in `write()` doc. This could be done in a crate obviously but maybe the security/robustness benefits are a good reason to put it into `std`.\r\n\r\nI'm willing to make a PR regardless of the conclusion.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82590/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82590/timeline", "performed_via_github_app": null, "state_reason": null}