{"url": "https://api.github.com/repos/rust-lang/rust/issues/23173", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23173/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23173/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23173/events", "html_url": "https://github.com/rust-lang/rust/issues/23173", "id": 60249486, "node_id": "MDU6SXNzdWU2MDI0OTQ4Ng==", "number": 23173, "title": "ICE when passing nonexistent literal enum reference", "user": {"login": "nukep", "id": 1551458, "node_id": "MDQ6VXNlcjE1NTE0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1551458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nukep", "html_url": "https://github.com/nukep", "followers_url": "https://api.github.com/users/nukep/followers", "following_url": "https://api.github.com/users/nukep/following{/other_user}", "gists_url": "https://api.github.com/users/nukep/gists{/gist_id}", "starred_url": "https://api.github.com/users/nukep/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nukep/subscriptions", "organizations_url": "https://api.github.com/users/nukep/orgs", "repos_url": "https://api.github.com/users/nukep/repos", "events_url": "https://api.github.com/users/nukep/events{/privacy}", "received_events_url": "https://api.github.com/users/nukep/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-03-08T09:43:26Z", "updated_at": "2015-06-22T00:11:07Z", "closed_at": "2015-06-22T00:11:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "The compiler seems to raise a ICE whenever an enum literal reference that's passed directly as a function parameter is missing or misspelled:\n\n``` rust\nenum Token { LeftParen, RightParen, Plus, Minus, /* etc */ }\n\nfn use_token(token: &Token) { unimplemented!() }\n\nfn main() {\n    // Token::LeftParens is misspelled, should be Token::LeftParen.\n    use_token(&Token::LeftParens);\n}\n```\n\n```\nthread 'rustc' panicked at 'path not fully resolved: PathResolution { base_def: DefTy(DefId { krate: 0, node: 4 }, true), last_private: LastMod(AllPublic), depth: 1 }', C:/bot/slave/nightly-dist-rustc-win-64/build/src/librustc\\middle\\def.rs:79\n\nstack backtrace:\n   1:         0x71217094 - sys::backtrace::write::h702ba69fda76a133UVA\n   2:         0x71231708 - rt::unwind::register::h2807fa6be024d773ZpJ\n   3:         0x71183427 - rt::unwind::begin_unwind_inner::h33dce4042bd21f85onJ\n   4:         0x71183beb - rt::unwind::begin_unwind_fmt::hae30e0776fdf0958ZlJ\n   5:           0xf5ba4a - middle::ty::resolve_expr::h3413f822b132c794uV6\n   6:          0x108d876 - middle::ty::expr_kind::h7a4229e8cf2923d94W6\n   7:          0x108d589 - middle::ty::expr_is_lval::hee14165bdb90e648xW6\n   8:          0x1685988 - check::UnresolvedTypeAction...std..fmt..Debug::fmt::h6fea2f9b6c32405bN8o\n   9:          0x1663989 - check::callee::CallResolution<'tcx>.DeferredCallResolution<'tcx>::resolve::h620708a97b262156Qlm\n  10:          0x1660e5b - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::h3d9369be1c793797zjo\n  11:          0x165fad8 - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::h3d9369be1c793797zjo\n  12:          0x16af2f8 - check::UnresolvedTypeAction...std..fmt..Debug::fmt::h6fea2f9b6c32405bN8o\n  13:          0x16751e1 - check::GatherLocalsVisitor<'a, 'tcx>.Visitor<'tcx>::visit_item::hccf69f0ad25ab806Xln\n  14:          0x165d854 - check::FnCtxt<'a, 'tcx>.AstConv<'tcx>::projected_ty::h3d9369be1c793797zjo\n  15:          0x1672a8c - check::CheckItemTypesVisitor<'a, 'tcx>.Visitor<'tcx>::visit_ty::hb08a5401782be257man\n  16:          0x166b304 - check::CheckItemTypesVisitor<'a, 'tcx>.Visitor<'tcx>::visit_item::hbc63086752858e7d09m\n  17:          0x17280d4 - check_crate::h490a1c107c2f6f04hfC\n  18:          0x1723821 - check_crate::h490a1c107c2f6f04hfC\n  19:         0x652deb3b - driver::phase_3_run_analysis_passes::h95f5e5d96e327896mGa\n  20:         0x652c2669 - driver::compile_input::h5f994866bdbf7f9fNba\n  21:         0x6538530d - run_compiler::h716ee0dff1e124acG6b\n  22:         0x65383253 - run::h15ad65cc2cf082cdm6b\n  23:         0x65381e1e - run::h15ad65cc2cf082cdm6b\n  24:         0x7125f58c - rust_try\n  25:         0x7125f569 - rust_try\n  26:         0x65382597 - run::h15ad65cc2cf082cdm6b\n  27:         0x71221c32 - sys::tcp::TcpListener::bind::h29247aa3f005ffa1WSE\n  28:     0x7ffd672316ad - BaseThreadInitThunk\n```\n\nVersion:\n\n```\nrustc 1.0.0-nightly (270a677d4 2015-03-07) (built 2015-03-07)\nbinary: rustc\ncommit-hash: 270a677d4d698916f5ad103f0afc3c070b8dbeb4\ncommit-date: 2015-03-07\nbuild-date: 2015-03-07\nhost: x86_64-pc-windows-gnu\nrelease: 1.0.0-nightly\n```\n\n---\n\nThe compiler seems to only panic when the enum is misspelled or missing, and passed directly as a function argument. The following (erroneous) code will not cause any compiler panics:\n\n``` rust\nenum Token { LeftParen, RightParen, Plus, Minus, /* etc */ }\n\nfn use_token(token: &Token) { unimplemented!() }\n\nfn main() {\n    // yields the error: type `Token` does not implement any method in scope named `LeftParens`\n    // The compiler error is correct behavior.\n    let token = &Token::LeftParens;\n    use_token(token);\n}\n```\n\n``` rust\nenum Token { LeftParen, RightParen, Plus, Minus, /* etc */ }\n\nfn use_token(token: &Token) { unimplemented!() }\n\nfn main() {\n    // spelled correctly; compiles successfully\n    use_token(&Token::LeftParen);\n}\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23173/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23173/timeline", "performed_via_github_app": null, "state_reason": "completed"}