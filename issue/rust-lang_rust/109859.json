{"url": "https://api.github.com/repos/rust-lang/rust/issues/109859", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109859/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109859/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109859/events", "html_url": "https://github.com/rust-lang/rust/issues/109859", "id": 1650948055, "node_id": "I_kwDOAAsO6M5iZ3fX", "number": 109859, "title": "Tracking Issue for removing unsafe code from bootstrap", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 234876, "node_id": "MDU6TGFiZWwyMzQ4NzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-hard", "name": "E-hard", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Hard / a lot"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 419557634, "node_id": "MDU6TGFiZWw0MTk1NTc2MzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-medium", "name": "E-medium", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Medium / intermediate"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 2635899341, "node_id": "MDU6TGFiZWwyNjM1ODk5MzQx", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-unix", "name": "O-unix", "color": "6e6ec0", "default": false, "description": "Operating system: Unix-like"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2023-04-02T13:28:08Z", "updated_at": "2023-04-05T08:04:28Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nNOTE: For library features, please use the \"Library Tracking Issue\" template instead.\r\n\r\nThank you for creating a tracking issue! \ud83d\udcdc Tracking issues are for tracking a\r\nfeature from implementation to stabilisation. Make sure to include the relevant\r\nRFC for the feature if it has one. Otherwise provide a short summary of the\r\nfeature and link any relevant PRs or issues, and remove any sections that are\r\nnot relevant to the feature.\r\n\r\nRemember to add team labels to the tracking issue.\r\nFor a language team feature, this would e.g., be `T-lang`.\r\nSuch a feature should also be labeled with e.g., `F-my_feature`.\r\nThis label is used to associate issues (e.g., bugs and design questions) to the feature.\r\n-->\r\n\r\nThis is a tracking issue for removing unsafe code from bootstrap. This is an implementation detail of the build system and there is no associated RFC.\r\n\r\n### About tracking issues\r\n\r\nTracking issues are used to record the overall progress of implementation.\r\nThey are also used as hubs connecting to other relevant issues, e.g., bugs or open design questions.\r\nA tracking issue is however *not* meant for large scale discussion, questions, or bug reports about a feature.\r\nInstead, open a dedicated issue for the specific matter and add the relevant feature gate label.\r\n\r\n### Steps\r\n<!--\r\nInclude each step required to complete the feature. Typically this is a PR\r\nimplementing a feature, followed by a PR that stabilises the feature. However\r\nfor larger features an implementation could be broken up into multiple PRs.\r\n-->\r\n\r\nIf you are interested in working on this issue, please leave a comment saying which part you are working on. Do *not* use `@rustbot claim`; this issue is too large to be done by a single person. Do not claim a checkbox that has already been claimed without first asking the existing assignee.\r\n\r\nNote that much of this code is platform-specific. I strongly recommend not working on Windows-specific code if you don't have a computer that can run Windows, and vice-versa for Unix.\r\n\r\nYou can ask for help in https://rust-lang.zulipchat.com/#narrow/stream/326414-t-infra.2Fbootstrap, #dark-arts on the community discord (https://discord.gg/rust-lang-community), or #windows-dev on the community discord. Please do not ask for help on this tracking issue since it will quickly get overwhelming.\r\n\r\nHere are the current uses of `unsafe`:\r\n- [ ] Creating a directory junction on Windows: https://github.com/rust-lang/rust/blob/d6f27401f12f02876aa6fe53139b030033f37e5e/src/bootstrap/util.rs#L149-L249 This can use https://docs.rs/junction/latest/junction/fn.create.html instead.\r\n- [ ] `std::path::absolute`, copied into bootstrap: https://github.com/rust-lang/rust/blob/d6f27401f12f02876aa6fe53139b030033f37e5e/src/bootstrap/util.rs#L560-L585 This is blocked on stabilization: https://github.com/rust-lang/rust/issues/92750\r\n- [ ] `rusage` metadata on unix: https://github.com/rust-lang/rust/blob/d6f27401f12f02876aa6fe53139b030033f37e5e/src/bootstrap/bin/rustc.rs#L354-L413 This can be replaced with https://docs.rs/nix/latest/nix/sys/resource/fn.getrusage.html.\r\n- [ ] `rusage` metadata on windows: https://github.com/rust-lang/rust/blob/d6f27401f12f02876aa6fe53139b030033f37e5e/src/bootstrap/bin/rustc.rs#L281-L352 Not sure what to replace this with, maybe there's something in docs.rs/windows? https://microsoft.github.io/windows-docs-rs/doc/windows/Win32/System/Threading/fn.GetProcessTimes.html appears to also be unsafe, though.\r\n- [ ] `libc::setpriority`: https://github.com/rust-lang/rust/blob/249198c1f8ae841a49124729a8a0f6f20a905c9c/src/bootstrap/lib.rs#L76-L78 This does not appear to have a counterpart in `nix`.\r\n- [ ] `libc::getuid`: https://github.com/rust-lang/rust/blob/249198c1f8ae841a49124729a8a0f6f20a905c9c/src/bootstrap/lib.rs#L349-L358 This can be replaced with https://docs.rs/nix/latest/nix/unistd/struct.Uid.html#method.current.\r\n- [ ] everything in `job.rs`, I don't really understand what's going on there: https://github.com/rust-lang/rust/blob/d6f27401f12f02876aa6fe53139b030033f37e5e/src/bootstrap/job.rs#L50-L143\r\n- [ ] all the unsafe code in `cache.rs`: https://github.com/rust-lang/rust/blob/fe0b0428b89802f02a050eab72373b75709d0bce/src/bootstrap/cache.rs#L63-L103 We can replace this with https://docs.rs/lasso/\r\n\r\ncc @rust-lang/bootstrap\r\n\r\n### Unresolved Questions\r\n<!--\r\nInclude any open questions that need to be answered before the feature can be\r\nstabilised.\r\n-->\r\n\r\nAre there any safe wrappers for the following APIs?\r\n- `job.rs`\r\n- `libc::setpriority`\r\n- `rusage` on Windows\r\n\r\n### Implementation history\r\n\r\n<!--\r\nInclude a list of all the PRs that were involved in implementing the feature.\r\n-->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109859/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109859/timeline", "performed_via_github_app": null, "state_reason": null}