{"url": "https://api.github.com/repos/rust-lang/rust/issues/10835", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10835/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10835/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10835/events", "html_url": "https://github.com/rust-lang/rust/issues/10835", "id": 23872408, "node_id": "MDU6SXNzdWUyMzg3MjQwOA==", "number": 10835, "title": "SharedChan can be used to create cycles", "user": {"login": "bill-myers", "id": 4647491, "node_id": "MDQ6VXNlcjQ2NDc0OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/4647491?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bill-myers", "html_url": "https://github.com/bill-myers", "followers_url": "https://api.github.com/users/bill-myers/followers", "following_url": "https://api.github.com/users/bill-myers/following{/other_user}", "gists_url": "https://api.github.com/users/bill-myers/gists{/gist_id}", "starred_url": "https://api.github.com/users/bill-myers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bill-myers/subscriptions", "organizations_url": "https://api.github.com/users/bill-myers/orgs", "repos_url": "https://api.github.com/users/bill-myers/repos", "events_url": "https://api.github.com/users/bill-myers/events{/privacy}", "received_events_url": "https://api.github.com/users/bill-myers/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2013-12-06T17:27:50Z", "updated_at": "2014-01-17T19:48:25Z", "closed_at": "2014-01-17T19:48:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Here is how one does it:\n1. Create channels A and B\n2. Send a clone of A's SharedChan and send A's port to channel B\n3. Send a clone of B's SharedChan and send B's port to channel A\n4. Drop the original SharedChans\n5. Memory leak!\n\nThe Linux kernel has the exact same issue with file descriptor passing on Unix sockets and they solve it with an global in-kernel garbage collector for unix sockets (http://lxr.free-electrons.com/source/net/unix/garbage.c)\n\nRust can't do the GC approach easily because it can pass structures containing SharedChans in addition to just SharedChan like Linux.\n\nHowever, we can prevent cycles just like we do for RWARC: by adding a Freeze bound to SharedChan's T and making sure SharedChan is no_freeze.\n\nShould this be done?\n\nIf not, why shouldn't the Freeze be removed from RWARC too, since they are effectively equivalent functionality? (method calls on RWARC-protected objects are equivalent to sending a message via SharedChan to a task that calls the corresponding method)\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10835/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10835/timeline", "performed_via_github_app": null, "state_reason": "completed"}