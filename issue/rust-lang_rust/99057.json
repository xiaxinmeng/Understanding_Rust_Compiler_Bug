{"url": "https://api.github.com/repos/rust-lang/cargo/issues/10834", "repository_url": "https://api.github.com/repos/rust-lang/cargo", "labels_url": "https://api.github.com/repos/rust-lang/cargo/issues/10834/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/cargo/issues/10834/comments", "events_url": "https://api.github.com/repos/rust-lang/cargo/issues/10834/events", "html_url": "https://github.com/rust-lang/cargo/issues/10834", "id": 1299193959, "node_id": "I_kwDOAQnScc5NcCBn", "number": 10834, "title": "Indicate when build errors occur in `build.rs`, rather than in main compilation", "user": {"login": "andrewring", "id": 11069631, "node_id": "MDQ6VXNlcjExMDY5NjMx", "avatar_url": "https://avatars.githubusercontent.com/u/11069631?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewring", "html_url": "https://github.com/andrewring", "followers_url": "https://api.github.com/users/andrewring/followers", "following_url": "https://api.github.com/users/andrewring/following{/other_user}", "gists_url": "https://api.github.com/users/andrewring/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewring/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewring/subscriptions", "organizations_url": "https://api.github.com/users/andrewring/orgs", "repos_url": "https://api.github.com/users/andrewring/repos", "events_url": "https://api.github.com/users/andrewring/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewring/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 139456799, "node_id": "MDU6TGFiZWwxMzk0NTY3OTk=", "url": "https://api.github.com/repos/rust-lang/cargo/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Experience: Easy"}, {"id": 166054475, "node_id": "MDU6TGFiZWwxNjYwNTQ0NzU=", "url": "https://api.github.com/repos/rust-lang/cargo/labels/A-errors", "name": "A-errors", "color": "fbca04", "default": false, "description": "Area: Error and warning messages generated by Cargo itself."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-07-08T15:36:31Z", "updated_at": "2023-03-07T08:59:57Z", "closed_at": "2023-03-07T08:59:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "When compilation errors occur during `build.rs` execution, there is no indication in the error output that the error occurred at that stage. This can cause confusing behavior that is difficult to debug.\r\n\r\nI encountered this issue when adding serde serialization to an enum which was also imported in build.rs to generate tab completions for clap. Despite using serde in another module, I was seeing missing crate errors. This turned out to be very time consuming to track down, and wasn't found until I tried to make a sanitized reproduction of the problem to share with others after [initial consultation in the rust Discord](https://discordapp.com/channels/442252698964721669/994742019232628786) was unsuccessful in debugging the issue.\r\n\r\nTo avoid time lost due to similar issues in the future, the compiler should clearly indicate if the errors were produced while compiling `build.rs`, rather than the main `[[bin]]` or `[[lib]]`.\r\n\r\nGiven the attached code:\r\n[example.zip](https://github.com/rust-lang/rust/files/9073250/example.zip)\r\n\r\nThe current output is:\r\n\r\n```\r\n   Compiling example v0.1.0 (/home/andrewring/CLionProjects/serde_error)\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `serde`\r\n --> src/sometimes_working/mod.rs:1:30\r\n  |\r\n1 | #[derive(Clone, Debug, Hash, serde::Deserialize, serde::Serialize, PartialEq, Eq)]\r\n  |                              ^^^^^ use of undeclared crate or module `serde`\r\n\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `serde`\r\n --> src/sometimes_working/mod.rs:1:50\r\n  |\r\n1 | #[derive(Clone, Debug, Hash, serde::Deserialize, serde::Serialize, PartialEq, Eq)]\r\n  |                                                  ^^^^^ use of undeclared crate or module `serde`\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nerror: could not compile `example` due to 2 previous errors\r\n```\r\n\r\nIdeally the output should look like:\r\n\r\n```\r\n   Compiling example v0.1.0 (/home/andrewring/CLionProjects/serde_error)\r\nencountered errors when compiling `build.rs`:\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `serde`\r\n --> src/sometimes_working/mod.rs:1:30\r\n  |\r\n1 | #[derive(Clone, Debug, Hash, serde::Deserialize, serde::Serialize, PartialEq, Eq)]\r\n  |                              ^^^^^ use of undeclared crate or module `serde`\r\n\r\nerror[E0433]: failed to resolve: use of undeclared crate or module `serde`\r\n --> src/sometimes_working/mod.rs:1:50\r\n  |\r\n1 | #[derive(Clone, Debug, Hash, serde::Deserialize, serde::Serialize, PartialEq, Eq)]\r\n  |                                                  ^^^^^ use of undeclared crate or module `serde`\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nerror: could not compile `example` due to 2 previous errors while compiling `build.rs`\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/cargo/issues/10834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/cargo/issues/10834/timeline", "performed_via_github_app": null, "state_reason": "completed"}