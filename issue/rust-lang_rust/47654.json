{"url": "https://api.github.com/repos/rust-lang/rust/issues/47654", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47654/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47654/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47654/events", "html_url": "https://github.com/rust-lang/rust/issues/47654", "id": 290389905, "node_id": "MDU6SXNzdWUyOTAzODk5MDU=", "number": 47654, "title": "Generator state borrowings should have same as generator lifetime", "user": {"login": "andreytkachenko", "id": 1773973, "node_id": "MDQ6VXNlcjE3NzM5NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1773973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreytkachenko", "html_url": "https://github.com/andreytkachenko", "followers_url": "https://api.github.com/users/andreytkachenko/followers", "following_url": "https://api.github.com/users/andreytkachenko/following{/other_user}", "gists_url": "https://api.github.com/users/andreytkachenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreytkachenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreytkachenko/subscriptions", "organizations_url": "https://api.github.com/users/andreytkachenko/orgs", "repos_url": "https://api.github.com/users/andreytkachenko/repos", "events_url": "https://api.github.com/users/andreytkachenko/events{/privacy}", "received_events_url": "https://api.github.com/users/andreytkachenko/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}, {"id": 679846574, "node_id": "MDU6TGFiZWw2Nzk4NDY1NzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-generators", "name": "A-generators", "color": "f7e101", "default": false, "description": "Area: Generators"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-01-22T08:53:24Z", "updated_at": "2018-01-24T19:36:41Z", "closed_at": "2018-01-24T19:36:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "Consider the example:\r\n\r\n```rust\r\n#![feature(generators, conservative_impl_trait, generator_trait)]\r\nuse std::ops::Generator;\r\n\r\nfn test<'a>(val: u32) -> impl Generator<Yield = u32, Return = u32> + 'a {\r\n    move || {             // returned generator state has lifetime 'a\r\n        let mut x = val;  // variable x is in the generator state and, hence, it has lifetime 'a\r\n        let y = &mut x;   // but y, (which pointing to x with lifetime 'a) doesn't have lifetime 'a\r\n\r\n        yield 1;\r\n        *y += 1;\r\n        yield 2;\r\n        *y += 1;\r\n        yield 3;\r\n\r\n        return *y;\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let mut gen = test(1);\r\n    \r\n    println!(\"{:?}\", gen.resume());\r\n    println!(\"{:?}\", gen.resume());\r\n    println!(\"{:?}\", gen.resume());\r\n    println!(\"{:?}\", gen.resume());\r\n}\r\n```\r\nit won't compile with error:\r\n```\r\nerror[E0597]: `x` does not live long enough\r\n  --> src/main.rs:8:22\r\n   |\r\n8  |         let y = &mut x;\r\n   |                      ^ borrowed value does not live long enough\r\n...\r\n22 |     }\r\n   |     - borrowed value only lives until here\r\n   |\r\nnote: borrowed value must be valid for the lifetime 'a as defined on the function body at 5:1...\r\n  --> src/main.rs:5:1\r\n   |\r\n5  | / fn test<'a>(val: u32) -> impl Generator<Yield = u32, Return = u32> + 'a {\r\n6  | |     move || {\r\n7  | |         let mut x = val;\r\n8  | |         let y = &mut x;\r\n...  |\r\n22 | |     }\r\n23 | | }\r\n   | |_^\r\n```\r\n", "closed_by": {"login": "andreytkachenko", "id": 1773973, "node_id": "MDQ6VXNlcjE3NzM5NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1773973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreytkachenko", "html_url": "https://github.com/andreytkachenko", "followers_url": "https://api.github.com/users/andreytkachenko/followers", "following_url": "https://api.github.com/users/andreytkachenko/following{/other_user}", "gists_url": "https://api.github.com/users/andreytkachenko/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreytkachenko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreytkachenko/subscriptions", "organizations_url": "https://api.github.com/users/andreytkachenko/orgs", "repos_url": "https://api.github.com/users/andreytkachenko/repos", "events_url": "https://api.github.com/users/andreytkachenko/events{/privacy}", "received_events_url": "https://api.github.com/users/andreytkachenko/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47654/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47654/timeline", "performed_via_github_app": null, "state_reason": "completed"}