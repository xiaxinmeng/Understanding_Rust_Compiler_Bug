{"url": "https://api.github.com/repos/rust-lang/rust/issues/66010", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66010/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66010/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66010/events", "html_url": "https://github.com/rust-lang/rust/issues/66010", "id": 515846295, "node_id": "MDU6SXNzdWU1MTU4NDYyOTU=", "number": 66010, "title": "Use React to help simplify librustdoc's main.js", "user": {"login": "philip-peterson", "id": 1326208, "node_id": "MDQ6VXNlcjEzMjYyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1326208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philip-peterson", "html_url": "https://github.com/philip-peterson", "followers_url": "https://api.github.com/users/philip-peterson/followers", "following_url": "https://api.github.com/users/philip-peterson/following{/other_user}", "gists_url": "https://api.github.com/users/philip-peterson/gists{/gist_id}", "starred_url": "https://api.github.com/users/philip-peterson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philip-peterson/subscriptions", "organizations_url": "https://api.github.com/users/philip-peterson/orgs", "repos_url": "https://api.github.com/users/philip-peterson/repos", "events_url": "https://api.github.com/users/philip-peterson/events{/privacy}", "received_events_url": "https://api.github.com/users/philip-peterson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-11-01T00:47:16Z", "updated_at": "2019-11-01T21:51:21Z", "closed_at": "2019-11-01T21:51:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there! Firstly I wanted to say how much I love the Rust language, you all have been doing great work. Was digging in to the code used on docs.rs, because I was interested in making some improvements. The file I found was this one: https://github.com/rust-lang/rust/blob/master/src/librustdoc/html/static/main.js\r\n\r\nSomething I noticed about this file is that it seems to have some convoluted imperative logic to do simple things, such as tracking state of collapsed items, by storing the state in the DOM.  Normally this works well for one-off use cases, but it seems the file has outgrown this level of simplicity IMO.\r\n\r\nFor instance, there is some confusing handling of timeouts here: https://github.com/rust-lang/rust/blob/master/src/librustdoc/html/static/main.js#L1652 mixed in with explicit handling of window history state, which seems unrelated. The overall structure of the file seems a bit haphazard -- if someone disagrees I would be happy to defend this position. Since modern frameworks like React have well-established conventions for handling these situations, I would suggest adopting a similar framework to build this page off of. I would even be happy to produce a prototype to show how it could actually integrate with rustdoc.\r\n\r\nFor completeness, here are some pros and cons of adapting a framework like React:\r\n\r\nCons\r\n----\r\n* Build system required for JSX (though Rollup https://github.com/rollup/rollup is available, which is pretty lightweight)\r\n* (Slightly) increased build time when running rustdoc\r\n\r\nPros\r\n----\r\n* (Most likely) less code to maintain (I would estimate main.js could be cut down by at least 20%, even more if you don't count boilerplate).\r\n* More declarative approach to match Rust's general style.\r\n* More easily bring in third party solutions such as Dropdown or Modal components, which are handled on a bespoke basis right now\r\n* React Component style allows better code reuse\r\n* Established patterns for mixing persistence (settings) with actual document state (currently same as DOM state)\r\n\r\nAnyway, was curious what the Rust community thinks of this idea. I think it could help speed up UX improvements development on rustdoc and docs.rs significantly.\r\n\r\nThanks for reading! - Phil", "closed_by": {"login": "philip-peterson", "id": 1326208, "node_id": "MDQ6VXNlcjEzMjYyMDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1326208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philip-peterson", "html_url": "https://github.com/philip-peterson", "followers_url": "https://api.github.com/users/philip-peterson/followers", "following_url": "https://api.github.com/users/philip-peterson/following{/other_user}", "gists_url": "https://api.github.com/users/philip-peterson/gists{/gist_id}", "starred_url": "https://api.github.com/users/philip-peterson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philip-peterson/subscriptions", "organizations_url": "https://api.github.com/users/philip-peterson/orgs", "repos_url": "https://api.github.com/users/philip-peterson/repos", "events_url": "https://api.github.com/users/philip-peterson/events{/privacy}", "received_events_url": "https://api.github.com/users/philip-peterson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66010/reactions", "total_count": 3, "+1": 0, "-1": 3, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66010/timeline", "performed_via_github_app": null, "state_reason": "completed"}