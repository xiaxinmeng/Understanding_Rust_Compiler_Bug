{"url": "https://api.github.com/repos/rust-lang/rust/issues/46600", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46600/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46600/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46600/events", "html_url": "https://github.com/rust-lang/rust/issues/46600", "id": 280722359, "node_id": "MDU6SXNzdWUyODA3MjIzNTk=", "number": 46600, "title": "`panic_fmt` receiving bogus arguments in freestanding environment", "user": {"login": "ketsuban", "id": 5253816, "node_id": "MDQ6VXNlcjUyNTM4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5253816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ketsuban", "html_url": "https://github.com/ketsuban", "followers_url": "https://api.github.com/users/ketsuban/followers", "following_url": "https://api.github.com/users/ketsuban/following{/other_user}", "gists_url": "https://api.github.com/users/ketsuban/gists{/gist_id}", "starred_url": "https://api.github.com/users/ketsuban/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ketsuban/subscriptions", "organizations_url": "https://api.github.com/users/ketsuban/orgs", "repos_url": "https://api.github.com/users/ketsuban/repos", "events_url": "https://api.github.com/users/ketsuban/events{/privacy}", "received_events_url": "https://api.github.com/users/ketsuban/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-12-09T14:08:38Z", "updated_at": "2017-12-09T17:42:14Z", "closed_at": "2017-12-09T17:42:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I came across this in a hobby OS where it caused a system fault, but I *think* I've pared it back about as much as it'll go to produce a one-file test case which produces a segfault.\r\n\r\n```rust\r\n#![feature(lang_items)]\r\n#![no_main]\r\n#![no_std]\r\n\r\nextern crate libc;\r\n\r\nuse core::fmt::Write;\r\n\r\nstruct Writer;\r\n\r\nimpl core::fmt::Write for Writer {\r\n    fn write_str(&mut self, s: &str) -> ::core::fmt::Result {\r\n        unsafe {\r\n            libc::puts(s.as_ptr() as *const libc::c_char);\r\n        }\r\n        Ok(())\r\n    }\r\n}\r\n\r\n#[no_mangle]\r\npub extern \"C\" fn main(_argc: i32, _argv: *const *const u8) -> i32 {\r\n    panic!(\"Hello, world!\");\r\n}\r\n\r\n#[no_mangle]\r\npub extern \"C\" fn _Unwind_Resume() {}\r\n\r\n#[lang = \"panic_fmt\"]\r\n#[no_mangle]\r\npub fn panic_fmt(fmt: ::core::fmt::Arguments, file: &'static str, line: u32, col: u32) -> ! {\r\n    Writer\r\n        .write_fmt(format_args!(\r\n            \"PANIC in {} on line {}, column {}\\n\\0\",\r\n            file, line, col\r\n        ))\r\n        .unwrap();\r\n    Writer.write_fmt(format_args!(\"    {}\\n\\0\", fmt)).unwrap();\r\n    loop {}\r\n}\r\n```\r\n\r\nCompile this with `panic = \"abort\"` using a nightly compiler. Here's mine.\r\n\r\n```\r\n$ rustc --version --verbose\r\nrustc 1.24.0-nightly (c8ddf2852 2017-12-07)\r\nbinary: rustc\r\ncommit-hash: c8ddf28527119a06a9f5da9bd34c97ae97afe531\r\ncommit-date: 2017-12-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.24.0-nightly\r\nLLVM version: 4.0\r\n```\r\n\r\nHere's the output I get.\r\n\r\n```\r\n$ target/debug/nostd_test\r\nPANIC in  on line , column \r\n\r\nSegmentation fault (core dumped)\r\n```\r\n\r\nHere's what I expected.\r\n\r\n```\r\n$ target/debug/nostd_test\r\nPANIC in main.rs on line 22, column 5\r\n    Hello, world!\r\n```\r\n\r\nIn my OS I do actually get output for `line` (4) and `col` (12), and `file` is printed if I use `{:#p}` (0x000000000000000c), whereas in my test case there's nothing at all.", "closed_by": {"login": "ketsuban", "id": 5253816, "node_id": "MDQ6VXNlcjUyNTM4MTY=", "avatar_url": "https://avatars.githubusercontent.com/u/5253816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ketsuban", "html_url": "https://github.com/ketsuban", "followers_url": "https://api.github.com/users/ketsuban/followers", "following_url": "https://api.github.com/users/ketsuban/following{/other_user}", "gists_url": "https://api.github.com/users/ketsuban/gists{/gist_id}", "starred_url": "https://api.github.com/users/ketsuban/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ketsuban/subscriptions", "organizations_url": "https://api.github.com/users/ketsuban/orgs", "repos_url": "https://api.github.com/users/ketsuban/repos", "events_url": "https://api.github.com/users/ketsuban/events{/privacy}", "received_events_url": "https://api.github.com/users/ketsuban/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46600/timeline", "performed_via_github_app": null, "state_reason": "completed"}