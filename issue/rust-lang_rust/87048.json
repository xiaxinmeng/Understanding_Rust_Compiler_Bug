{"url": "https://api.github.com/repos/rust-lang/rust/issues/87048", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/87048/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/87048/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/87048/events", "html_url": "https://github.com/rust-lang/rust/issues/87048", "id": 941351134, "node_id": "MDU6SXNzdWU5NDEzNTExMzQ=", "number": 87048, "title": "rustdoc: cache.access_levels is wrong", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-07-11T01:17:09Z", "updated_at": "2022-06-20T13:21:45Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "I tried this code:\n\n```diff\ndiff --git a/src/librustdoc/html/format.rs b/src/librustdoc/html/format.rs\nindex c08fe47696b..9238ed5477e 100644\n--- a/src/librustdoc/html/format.rs\n+++ b/src/librustdoc/html/format.rs\n@@ -479,7 +479,12 @@ fn to_module_fqp(shortty: ItemType, fqp: &[String]) -> &[String] {\n         if shortty == ItemType::Module { &fqp[..] } else { &fqp[..fqp.len() - 1] }\n     }\n \n-    if !did.is_local() && !cache.access_levels.is_public(did) && !cache.document_private {\n+    if !cache.access_levels.is_public(did) && !cache.document_private {\n+        // Private local items used to not be checked. Make sure that the behavior is the same as before.\n+        if did.is_local() {\n+            // NOTE: we don't need to check `external_paths.get(did).is_none()` because the crate will always be unknown.\n+            assert!(cache.paths.get(&did).is_none(), \"{:?}\", did);\n+        }\n         return None;\n     }\n \n```\n\nI expected to see this happen: All the rustdoc tests pass; this should be the same behavior as before.\n\nInstead, this happened:\n```\n\n---- [rustdoc] rustdoc/blanket-reexport-item.rs stdout ----\n------------------------------------------\nstderr:\n------------------------------------------\nthread 'rustc' panicked at 'DefId(0:5 ~ foo[cf51]::m::S)', src/librustdoc/html/format.rs:486:13\n```\n\nThe code for this test is https://github.com/rust-lang/rust/blob/dfd7b8d03fb93d0e03147d28b3be6d93260fa94d/src/test/rustdoc/blanket-reexport-item.rs#L1-L8. `m::S` should be marked as public (since it's accessible through the glob re-export), but is not.\n\n### Meta\n\nHEAD is 432e145bd5a974c5b6f4dd9b352891bd7502b69d.\n\n<!--\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\n-->\n<details><summary>Backtrace</summary>\n<p>\n\n```\nthread 'rustc' panicked at 'DefId(0:5 ~ foo[cf51]::m::S)', src/librustdoc/html/format.rs:486:13\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/std/src/panicking.rs:515:5\n   1: std::panicking::begin_panic_fmt\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/std/src/panicking.rs:457:5\n   2: rustdoc::html::format::href\n             at ./src/librustdoc/html/format.rs:486:13\n   3: rustdoc::html::format::anchor\n             at ./src/librustdoc/html/format.rs:681:17\n   4: rustdoc::html::format::resolved_path\n             at ./src/librustdoc/html/format.rs:585:13\n   5: rustdoc::html::format::fmt_type\n             at ./src/librustdoc/html/format.rs:711:13\n   6: rustdoc::html::format::<impl rustdoc::clean::types::Impl>::print::{{closure}}\n   7: <rustdoc::html::format::display_fn::WithFormatter<F> as core::fmt::Display>::fmt\n             at ./src/librustdoc/html/format.rs:1429:13\n   8: <T as alloc::string::ToString>::to_string\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/alloc/src/string.rs:2379:9\n   9: rustdoc::html::render::write_shared::write_shared::{{closure}}\n             at ./src/librustdoc/html/render/write_shared.rs:520:31\n  10: core::ops::function::impls::<impl core::ops::function::FnMut<A> for &mut F>::call_mut\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/core/src/ops/function.rs:269:13\n  11: <core::slice::iter::Iter<T> as core::iter::traits::iterator::Iterator>::find_map\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/core/src/slice/iter/macros.rs:268:38\n  12: <core::iter::adapters::filter_map::FilterMap<I,F> as core::iter::traits::iterator::Iterator>::next\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/core/src/iter/adapters/filter_map.rs:61:9\n  13: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter_nested::SpecFromIterNested<T,I>>::from_iter\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/alloc/src/vec/spec_from_iter_nested.rs:23:32\n  14: <alloc::vec::Vec<T> as alloc::vec::spec_from_iter::SpecFromIter<T,I>>::from_iter\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/alloc/src/vec/spec_from_iter.rs:33:9\n  15: <alloc::vec::Vec<T> as core::iter::traits::collect::FromIterator<T>>::from_iter\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/alloc/src/vec/mod.rs:2453:9\n  16: core::iter::traits::iterator::Iterator::collect\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/library/core/src/iter/traits/iterator.rs:1748:9\n  17: rustdoc::html::render::write_shared::write_shared\n             at ./src/librustdoc/html/render/write_shared.rs:506:28\n  18: <rustdoc::html::render::context::Context as rustdoc::formats::renderer::FormatRenderer>::init\n             at ./src/librustdoc/html/render/context.rs:504:9\n  19: rustdoc::formats::renderer::run_format::{{closure}}\n             at ./src/librustdoc/formats/renderer.rs:62:17\n  20: rustc_data_structures::profiling::VerboseTimingGuard::run\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_data_structures/src/profiling.rs:573:9\n  21: rustdoc::formats::renderer::run_format\n             at ./src/librustdoc/formats/renderer.rs:60:40\n  22: rustdoc::run_renderer\n             at ./src/librustdoc/lib.rs:668:11\n  23: rustdoc::main_options::{{closure}}::{{closure}}::{{closure}}::{{closure}}\n             at ./src/librustdoc/lib.rs:769:25\n  24: rustc_data_structures::profiling::VerboseTimingGuard::run\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_data_structures/src/profiling.rs:573:9\n  25: rustc_session::utils::<impl rustc_session::session::Session>::time\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_session/src/utils.rs:16:9\n  26: rustdoc::main_options::{{closure}}::{{closure}}::{{closure}}\n             at ./src/librustdoc/lib.rs:768:51\n  27: rustc_interface::passes::QueryContext::enter::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/passes.rs:780:42\n  28: rustc_middle::ty::context::tls::enter_context::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_middle/src/ty/context.rs:1765:50\n  29: rustc_middle::ty::context::tls::set_tlv\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_middle/src/ty/context.rs:1749:9\n  30: rustc_middle::ty::context::tls::enter_context\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_middle/src/ty/context.rs:1765:9\n  31: rustc_interface::passes::QueryContext::enter\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/passes.rs:780:9\n  32: rustdoc::main_options::{{closure}}::{{closure}}\n             at ./src/librustdoc/lib.rs:742:13\n  33: rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/queries.rs:390:19\n  34: rustdoc::main_options::{{closure}}\n             at ./src/librustdoc/lib.rs:722:9\n  35: rustc_interface::interface::create_compiler_and_run::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/interface.rs:208:13\n  36: rustc_span::with_source_map\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_span/src/lib.rs:917:5\n  37: rustc_interface::interface::create_compiler_and_run\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/interface.rs:202:5\n  38: rustdoc::main_options\n             at ./src/librustdoc/lib.rs:721:5\n  39: rustdoc::main_args::{{closure}}\n             at ./src/librustdoc/lib.rs:648:17\n  40: rustc_interface::util::setup_callbacks_and_run_in_thread_pool_with_globals::{{closure}}::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/util.rs:155:13\n  41: scoped_tls::ScopedKey<T>::set\n             at /cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-1.0.0/src/lib.rs:137:9\n  42: rustc_span::create_session_globals_then\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_span/src/lib.rs:108:5\n  43: rustc_interface::util::setup_callbacks_and_run_in_thread_pool_with_globals::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/util.rs:153:9\n  44: rustc_interface::util::scoped_thread::{{closure}}\n             at /rustc/432e145bd5a974c5b6f4dd9b352891bd7502b69d/compiler/rustc_interface/src/util.rs:128:24\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n```\n\n</p>\n</details>\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"vramana\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/87048/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/87048/timeline", "performed_via_github_app": null, "state_reason": null}