{"url": "https://api.github.com/repos/rust-lang/rust/issues/101747", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/101747/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/101747/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/101747/events", "html_url": "https://github.com/rust-lang/rust/issues/101747", "id": 1370775466, "node_id": "I_kwDOAAsO6M5RtF-q", "number": 101747, "title": "Hitting the recursion limit when evaluating a type does not provide a useful error message", "user": {"login": "semicoleon", "id": 6548738, "node_id": "MDQ6VXNlcjY1NDg3Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/6548738?v=4", "gravatar_id": "", "url": "https://api.github.com/users/semicoleon", "html_url": "https://github.com/semicoleon", "followers_url": "https://api.github.com/users/semicoleon/followers", "following_url": "https://api.github.com/users/semicoleon/following{/other_user}", "gists_url": "https://api.github.com/users/semicoleon/gists{/gist_id}", "starred_url": "https://api.github.com/users/semicoleon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/semicoleon/subscriptions", "organizations_url": "https://api.github.com/users/semicoleon/orgs", "repos_url": "https://api.github.com/users/semicoleon/repos", "events_url": "https://api.github.com/users/semicoleon/events{/privacy}", "received_events_url": "https://api.github.com/users/semicoleon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-13T02:50:56Z", "updated_at": "2022-09-17T22:04:35Z", "closed_at": "2022-09-17T22:04:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nInspired by this [incredible Twitter thread](https://twitter.com/thingskatedid/status/1569406491886764032)\r\nGiven the following code: [Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=f877afe944810b870c7ce4aa5e349a97)\r\n\r\n```rust\r\ntype Byte = Option<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nOption<Option<Option<Option< Option<Option<Option<Option<\r\nBox<String>\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>\r\n>>>> >>>>;\r\n\r\nfn main() {\r\n    println!(\"{}\", std::mem::size_of::<Byte>());\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror: overflow representing the type `Unique<String>`\r\n```\r\n\r\nThis error message doesn't really communicate the problem to anyone who isn't aware of rustc internals. It also does not communicate the (fairly simple) fix of upping the recursion limit `#![recursion_limit = \"256\"]`. \r\n\r\nIt would be nice to provide an actual diagnostic pointing out the location of the error in the source code (reconstructing that might be complicated, I'm not sure). The current error can be particularly confusing since the type in the error message can be private to another type that's being evaluated, as is the case in this example where an inner type in `Box` is printed in the error. \r\n\r\nRust analyzer does not show any similar warnings or errors.\r\n\r\nNightly prints a slightly different error message, but if anything it's even less helpful\r\n\r\n```\r\nerror: queries overflow the depth limit!\r\n```\r\n\r\n```\r\nrustc 1.63.0 (4b91a6ea7 2022-08-08)\r\nbinary: rustc\r\ncommit-hash: 4b91a6ea7258a947e59c6522cd5898e7c0a6a88f\r\ncommit-date: 2022-08-08\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.63.0\r\nLLVM version: 14.0.5\r\n\r\nrustc 1.65.0-nightly (fa6ee9375 2022-09-12)\r\nbinary: rustc\r\ncommit-hash: fa6ee9375242ae784dab1837dfc0b92f43e787ce\r\ncommit-date: 2022-09-12\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.65.0-nightly\r\nLLVM version: 15.0.0\r\n```\r\n<!--\r\nIf the problem is not self-explanatory, please provide a rationale for the\r\nchange.\r\n-->\r\n\r\n<!--\r\nIf dramatically different output is caused by small changes, consider also\r\nadding them here.\r\n\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions. The output might also be\r\ndifferent depending on the Edition.\r\n-->\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/101747/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/101747/timeline", "performed_via_github_app": null, "state_reason": "completed"}