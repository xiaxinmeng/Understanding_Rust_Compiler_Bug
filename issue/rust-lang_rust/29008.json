{"url": "https://api.github.com/repos/rust-lang/rust/issues/29008", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/29008/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/29008/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/29008/events", "html_url": "https://github.com/rust-lang/rust/issues/29008", "id": 111077915, "node_id": "MDU6SXNzdWUxMTEwNzc5MTU=", "number": 29008, "title": "stdlib Path has inconsistent normalisation behaviour", "user": {"login": "aidanhs", "id": 1050652, "node_id": "MDQ6VXNlcjEwNTA2NTI=", "avatar_url": "https://avatars.githubusercontent.com/u/1050652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aidanhs", "html_url": "https://github.com/aidanhs", "followers_url": "https://api.github.com/users/aidanhs/followers", "following_url": "https://api.github.com/users/aidanhs/following{/other_user}", "gists_url": "https://api.github.com/users/aidanhs/gists{/gist_id}", "starred_url": "https://api.github.com/users/aidanhs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aidanhs/subscriptions", "organizations_url": "https://api.github.com/users/aidanhs/orgs", "repos_url": "https://api.github.com/users/aidanhs/repos", "events_url": "https://api.github.com/users/aidanhs/events{/privacy}", "received_events_url": "https://api.github.com/users/aidanhs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 419557634, "node_id": "MDU6TGFiZWw0MTk1NTc2MzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-medium", "name": "E-medium", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Medium / intermediate"}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 14, "created_at": "2015-10-13T00:11:19Z", "updated_at": "2019-01-12T14:08:54Z", "closed_at": "2019-01-12T14:08:54Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Given:\n\n```\nuse std::path::{Path, PathBuf};\n\nfn main() {\n    let mut p = PathBuf::from(\"/a/b/c\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.push(\"\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.push(\"\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.pop();\n    println!(\"{:?} {:?}\", p, p.file_name());\n\n    p = PathBuf::from(\"/\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.push(\"\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.push(\"\");\n    println!(\"{:?} {:?}\", p, p.file_name());\n    p.pop();\n    println!(\"{:?} {:?}\", p, p.file_name());\n}\n```\n\nYou get:\n\n```\n\"/a/b/c\" Some(\"c\")\n\"/a/b/c/\" Some(\"c\")\n\"/a/b/c/\" Some(\"c\")\n\"/a/b\" Some(\"b\")\n\"/\" None\n\"/\" None\n\"/\" None\n\"/\" None\n```\n\nhttp://is.gd/XbyUdj\n\nFirst, the documentation is misleading (wrong?). `file_name` (https://doc.rust-lang.org/std/path/struct.PathBuf.html#method.file_name) is documented as \"The final component of the path, if it is a normal file.\", but it's returning the directory when there's a trailing slash, which is not (by my book) a normal file?\nLooking at the implementation of `components` it will return the final component of the path unless it is the root directory or a relative component. Maybe it just needs clarifying.\n\nThere's a stranger issue with normalisation of trailing slashes. Initially I thought it should be documented (https://doc.rust-lang.org/std/path/index.html#normalization), because trailing slashes are ignored by `components()`. However, unlike any other normalisation, it is possible to reconstruct the original path (by doing `.push(\"\")`)!\n\nI'm unsure what the intended behaviour is here and what needs fixing (implementation or docs).\nGiven stabilisation, I'm going to assume that implemented behaviour wins at this point? It's slightly irritating because being able to detect a trailing slash can be useful (as rsync does). Failing that I might be tempted to make `.push(\"\")` do nothing - this uncertain state with trailing slashes is strange. Is there an RFC I can look at maybe?\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/29008/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/29008/timeline", "performed_via_github_app": null, "state_reason": "completed"}