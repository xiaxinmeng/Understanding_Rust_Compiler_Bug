{"url": "https://api.github.com/repos/rust-lang/rust/issues/71520", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/71520/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/71520/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/71520/events", "html_url": "https://github.com/rust-lang/rust/issues/71520", "id": 606453799, "node_id": "MDU6SXNzdWU2MDY0NTM3OTk=", "number": 71520, "title": "Use lld by default on x64 msvc windows", "user": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 37977651, "node_id": "MDU6TGFiZWwzNzk3NzY1MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/metabug", "name": "metabug", "color": "5319e7", "default": false, "description": "Issues about issues themselves (\"bugs about bugs\")"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 3537250192, "node_id": "LA_kwDOAAsO6M7S1ieQ", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-tracking-needs-summary", "name": "S-tracking-needs-summary", "color": "4682b4", "default": false, "description": "It's hard to tell what's been done and what hasn't! Someone should do some investigation."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 29, "created_at": "2020-04-24T16:57:21Z", "updated_at": "2023-05-17T17:30:11Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a metabug, constraining the unbound scope of #39915.\r\n\r\n# What is lld\r\n\r\n[A linker that's part of the llvm project](https://lld.llvm.org/index.html), which is desirable for two reasons:\r\n* it's very friendly to cross compilation (hence its emphasis for embedded targets)\r\n* it's very fast (often runs in half the time as Gold -- linking can take several minutes for big projects (rustc, servo, etc.) and linking can be a huge % of the compile with incremental builds, so halving this runtime is a Big Deal.)\r\n\r\nRust currently ships its own copy of lld which it calls rust-lld. This is used by default to link bare-metal targets and wasm.\r\n\r\n# Goal\r\n\r\nThe goal of this metabug is to use rust-lld by default when targeting x64 msvc windows (as opposed to e.g. mingw windows). It's possible this will incidentally get other windows targets working, but I'm constraining scope for the sake of focusing efforts.\r\n\r\nThis configuration is already in a decent state, with backend support already implemented. It's just a matter of making that configuration stable enough to use by default.\r\n\r\n**To test using rust-lld for msvc targets, use `-C linker=lld`**\r\n\r\n# Blocking Issues\r\n\r\n[lld on windows status page](https://lld.llvm.org/windows_support.html)\r\n\r\n* [x] #68647 - linking libtest results in undefined symbols\r\n* [x] #71504 - rust-analyser segfault with lto=thin, linker=lld-link\r\n* [x] #72145 - LLD/COFF does not correctly align TLS section\r\n* [x] https://github.com/rust-lang/rust/issues/81408 - ACCESS_VIOLATION when dereferencing once_cell::Lazy in closure with LTO\r\n* [x] https://github.com/rust-lang/rust/issues/85642 - Windows rust-lld does not support the MSVC manifestdependency .drectve\r\n* [ ] https://github.com/rust-lang/rust/issues/111480", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/71520/reactions", "total_count": 39, "+1": 32, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 7, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/71520/timeline", "performed_via_github_app": null, "state_reason": null}