{"url": "https://api.github.com/repos/rust-lang/rust/issues/30514", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30514/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30514/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30514/events", "html_url": "https://github.com/rust-lang/rust/issues/30514", "id": 123340551, "node_id": "MDU6SXNzdWUxMjMzNDA1NTE=", "number": 30514, "title": "Mir: Value-like struct initializer fails to compile", "user": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-12-21T19:14:57Z", "updated_at": "2015-12-25T18:12:02Z", "closed_at": "2015-12-25T18:12:02Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "``` rust\n#![feature(rustc_attrs)]\n\nstruct A;\n\n#[rustc_mir(graphviz=\"foo.gv\")]\nfn mir() {\n    A;\n}\n\nfn main() {\n    mir();\n}\n```\n\nWill fail with\n\n```\nerror: internal compiler error: expected closure or fn\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', src/libsyntax/errors/mod.rs:230\nstack backtrace:\n   1:     0x7f95437b48ee - sys::backtrace::tracing::imp::write::hf6d5c8e3c66fa27b19t\n   2:     0x7f95437bb9d5 - panicking::log_panic::closure.41821\n   3:     0x7f95437bb475 - panicking::log_panic::h144dc9280b7645fcjhy\n   4:     0x7f95437828e3 - sys_common::unwind::begin_unwind_inner::h55d5feb426745bbeX0s\n   5:     0x7f953f88f437 - sys_common::unwind::begin_unwind::h9096788442279507124\n   6:     0x7f953f88f7f4 - errors::Handler::bug::h4aa521e1f5a0e236f2c\n   7:     0x7f9540c34a2c - session::Session::bug::hdc71a3fb8a9de8b66Qr\n   8:     0x7f954211fdd5 - trans::declare::declare_rust_fn::h3499333bf3b164a8ybC\n   9:     0x7f954218e65c - trans::declare::define_internal_rust_fn::hca6541cf5ddec74cRlC\n  10:     0x7f9542180d8e - trans::monomorphize::monomorphic_fn::h4e88fa61c342a4b4OyP\n  11:     0x7f9542232972 - trans::mir::did::MirContext<'bcx, 'tcx>::trans_fn_ref::h55237ed814e0e1dd6rP\n  12:     0x7f954222ed02 - trans::mir::constant::MirContext<'bcx, 'tcx>::trans_constant::h277fbb9a4164ee637qO\n  13:     0x7f954222d715 - trans::mir::operand::MirContext<'bcx, 'tcx>::trans_operand::h1ccc23113196f11cpbP\n  14:     0x7f954222f264 - trans::mir::rvalue::MirContext<'bcx, 'tcx>::trans_rvalue::h3fd0006d084b3140KFO\n  15:     0x7f954222d5d5 - trans::mir::statement::MirContext<'bcx, 'tcx>::trans_statement::hd3d43f205659cc06llP\n  16:     0x7f954213f525 - trans::mir::trans_mir::ha8bcfa1e861a5f5fqNN\n  17:     0x7f954213a878 - trans::base::trans_closure::haef7ad19910b1872Adj\n  18:     0x7f9542142b4c - trans::base::trans_fn::h663accb72c321f7bJnj\n  19:     0x7f9542147117 - trans::base::trans_item::h2e72d9aa09c9cb4fwNj\n  20:     0x7f9542153715 - trans::base::trans_crate::hf6ee98bf37c50fb1Ezk\n  21:     0x7f9543ceaeea - driver::phase_4_translate_to_llvm::h3282cc6c2caab9027Ua\n  22:     0x7f9543ce4c87 - driver::phase_3_run_analysis_passes::closure.23230\n  23:     0x7f9543cc29d5 - middle::ty::context::ctxt<'tcx>::create_and_enter::h5420659107844287102\n  24:     0x7f9543cbe139 - driver::phase_3_run_analysis_passes::h5834150331257021912\n  25:     0x7f9543ca1cbd - driver::compile_input::h623a21a74ad11852jca\n  26:     0x7f9543e03b2b - run_compiler::h1b7d8da52bbb04c7Vyc\n  27:     0x7f9543e00d58 - sys_common::unwind::try::try_fn::h4212622780748696621\n  28:     0x7f95437b25e8 - __rust_try\n  29:     0x7f95437a967b - sys_common::unwind::try::inner_try::hb757dfa83a0260eavXs\n  30:     0x7f9543e01080 - boxed::F.FnBox<A>::call_box::h10788927616206636218\n  31:     0x7f95437b9c63 - sys::thread::Thread::new::thread_start::h65b91c47bba3fbc3wjx\n  32:     0x7f953d4754a3 - start_thread\n  33:     0x7f954344713c - clone\n  34:                0x0 - <unknown>\n```\n\nThe reason is that we assign `ItemKind::Struct` to this kind of unit-structs, and then unconditionally try to translate these as if they were a functions (which holds true for tuple-like structs, but not unit-like structs).\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30514/timeline", "performed_via_github_app": null, "state_reason": "completed"}