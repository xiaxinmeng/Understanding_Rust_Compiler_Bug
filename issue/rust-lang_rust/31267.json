{"url": "https://api.github.com/repos/rust-lang/rust/issues/31267", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31267/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31267/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31267/events", "html_url": "https://github.com/rust-lang/rust/issues/31267", "id": 129571080, "node_id": "MDU6SXNzdWUxMjk1NzEwODA=", "number": 31267, "title": "ICE on use of associated constants with array expression", "user": {"login": "sdleffler", "id": 5241142, "node_id": "MDQ6VXNlcjUyNDExNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/5241142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sdleffler", "html_url": "https://github.com/sdleffler", "followers_url": "https://api.github.com/users/sdleffler/followers", "following_url": "https://api.github.com/users/sdleffler/following{/other_user}", "gists_url": "https://api.github.com/users/sdleffler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sdleffler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sdleffler/subscriptions", "organizations_url": "https://api.github.com/users/sdleffler/orgs", "repos_url": "https://api.github.com/users/sdleffler/repos", "events_url": "https://api.github.com/users/sdleffler/events{/privacy}", "received_events_url": "https://api.github.com/users/sdleffler/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-01-28T20:28:04Z", "updated_at": "2016-02-04T09:19:30Z", "closed_at": "2016-02-04T09:19:30Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code produces an internal compiler error when compiled with rustc 1.8.0-nightly (2016-01-27) through the Rust playground:\n\n```\n#![feature(associated_consts)]\n\nstruct Foo;\n\nimpl Foo {\n    const FOO: [i32; 3] = [0; 3];\n}\n\nfn main() {\n    let foo = Foo::FOO;\n}\n```\n\nHere's a sample of the error output from the playground:\n\n```\n<anon>:10:9: 10:12 warning: unused variable: `foo`, #[warn(unused_variables)] on by default\n<anon>:10     let foo = Foo::FOO;\n                  ^~~\nerror: internal compiler error: unimplemented unsupported def type in trans_local_var: AssociatedConst(DefId { krate: 0, node: DefIndex(7) => Foo::FOO })\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:488\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n\nplaypen: application terminated with error code 101\n```\n\nThe error occurs regardless of the type of the array's elements. The error seems to be related to the type of array constructor used, since the following code compiles just fine:\n\n```\n#![feature(associated_consts)]\n\nstruct Foo;\n\nimpl Foo {\n    const FOO: [i32; 3] = [0, 0, 0];\n}\n\nfn main() {\n    let foo = Foo::FOO;\n}\n```\n\nThe error does not occur when associated constants are not involved:\n\n```\nconst FOO: [i32; 3] = [0; 3];\n\nfn main() {\n    let foo = FOO;\n}\n```\n\nNow with backtrace!\n\n```\nerror: internal compiler error: unimplemented unsupported def type in trans_local_var: AssociatedConst(DefId { krate: 0, node: DefIndex(7) => Foo::FOO })\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/errors/mod.rs:488\nstack backtrace:\n   1:     0x7f9aa892cab0 - sys::backtrace::tracing::imp::write::hf66cd359dc225f8a0nu\n   2:     0x7f9aa893375b - panicking::default_handler::_<closure>::closure.42795\n   3:     0x7f9aa89332e3 - panicking::default_handler::h74bfdb4a758a82e9EFy\n   4:     0x7f9aa88fcb06 - sys_common::unwind::begin_unwind_inner::h9d3a2e7a2c681f25ygt\n   5:     0x7f9aa47a0ab7 - sys_common::unwind::begin_unwind::h12166797577502796958\n   6:     0x7f9aa47a0ef4 - errors::Handler::bug::h7a9fc56752d25512IFd\n   7:     0x7f9aa47a113f - errors::Handler::unimpl::h2fb5ffe58430b223lGd\n   8:     0x7f9aa5dd2fcc - session::Session::unimpl::h27b2304e69bbb5aetFs\n   9:     0x7f9aa6e7ce7b - trans::expr::trans_local_var::h3e91d61be4441e26BwE\n  10:     0x7f9aa6ed2b5d - trans::expr::trans_def::had2af85c494de6b131D\n  11:     0x7f9aa6ecbdd7 - trans::expr::trans_unadjusted::h3721f6e8ae7f8c49mED\n  12:     0x7f9aa6e3800a - trans::expr::trans_into::ha49f8f2b3262a5d302C\n  13:     0x7f9aa6f0b54a - trans::_match::mk_binding_alloca::h17168749765913251156\n  14:     0x7f9aa6e1c9de - trans::base::init_local::hdd8bd44e0f714a81jKi\n  15:     0x7f9aa6e34493 - trans::controlflow::trans_block::h2d1563a33f626e66GFx\n  16:     0x7f9aa6e30267 - trans::base::trans_closure::h92dd74479c5c1d7dIIj\n  17:     0x7f9aa6e34e0c - trans::base::trans_fn::h049c061a9498dd5duSj\n  18:     0x7f9aa6e391dc - trans::base::trans_item::h90e2c2c43b81ebc8Cgk\n  19:     0x7f9aa6e524cd - trans::base::TransItemsWithinModVisitor<'a, 'tcx>.Visitor<'v>::visit_item::h1a4d671566106a7fSgl\n  20:     0x7f9aa6e44b53 - trans::base::trans_crate::h418c4b34389d84e1n0k\n  21:     0x7f9aa8e62aa4 - driver::phase_4_translate_to_llvm::h54d254ca4986a310YXa\n  22:     0x7f9aa8e5d355 - driver::phase_3_run_analysis_passes::_<closure>::closure.27398\n  23:     0x7f9aa8e3ad27 - middle::ty::context::ctxt<'tcx>::create_and_enter::h2128271708407088678\n  24:     0x7f9aa8e36179 - driver::phase_3_run_analysis_passes::h14773225701904660884\n  25:     0x7f9aa8e08b93 - driver::compile_input::h7fb3e48531569f70xca\n  26:     0x7f9aa8dfb09e - run_compiler::hf652269ac296d8cfdEc\n  27:     0x7f9aa8df7901 - sys_common::unwind::try::try_fn::h11204389414678569358\n  28:     0x7f9aa892a658 - __rust_try\n  29:     0x7f9aa89220bb - sys_common::unwind::try::inner_try::hcce19deda87812016ct\n  30:     0x7f9aa8df8130 - boxed::F.FnBox<A>::call_box::h15366779241909412522\n  31:     0x7f9aa8931cd3 - sys::thread::Thread::new::thread_start::hff6465701ed07c9coCx\n  32:     0x7f9aa1462181 - start_thread\n  33:     0x7f9aa85a247c - __clone\n  34:                0x0 - <unknown>\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31267/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31267/timeline", "performed_via_github_app": null, "state_reason": "completed"}