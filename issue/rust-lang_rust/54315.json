{"url": "https://api.github.com/repos/rust-lang/rust/issues/54315", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54315/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54315/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54315/events", "html_url": "https://github.com/rust-lang/rust/issues/54315", "id": 361127909, "node_id": "MDU6SXNzdWUzNjExMjc5MDk=", "number": 54315, "title": "Unhelpful error message on risc-v using the asm! macro with register extractions", "user": {"login": "liamnaddell", "id": 15148886, "node_id": "MDQ6VXNlcjE1MTQ4ODg2", "avatar_url": "https://avatars.githubusercontent.com/u/15148886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liamnaddell", "html_url": "https://github.com/liamnaddell", "followers_url": "https://api.github.com/users/liamnaddell/followers", "following_url": "https://api.github.com/users/liamnaddell/following{/other_user}", "gists_url": "https://api.github.com/users/liamnaddell/gists{/gist_id}", "starred_url": "https://api.github.com/users/liamnaddell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liamnaddell/subscriptions", "organizations_url": "https://api.github.com/users/liamnaddell/orgs", "repos_url": "https://api.github.com/users/liamnaddell/repos", "events_url": "https://api.github.com/users/liamnaddell/events{/privacy}", "received_events_url": "https://api.github.com/users/liamnaddell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 91598611, "node_id": "MDU6TGFiZWw5MTU5ODYxMQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inline-assembly", "name": "A-inline-assembly", "color": "f7e101", "default": false, "description": "Area: inline asm!(..)"}, {"id": 1210355734, "node_id": "MDU6TGFiZWwxMjEwMzU1NzM0", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-riscv", "name": "O-riscv", "color": "6e6ec0", "default": false, "description": "Target: RISC-V architecture"}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2018-09-18T04:06:48Z", "updated_at": "2020-05-22T21:19:27Z", "closed_at": "2020-05-22T21:19:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "(this is my first issue, sorry)\r\n\r\nThis is sort of a bug and sort of a feature request/cry for help. All of the following stuff is new to me, so this is probably user error.\r\n\r\nThe code I tried is attached below\r\n[diosix.tar.gz](https://github.com/rust-lang/rust/files/2391133/diosix.tar.gz)\r\n\r\n\r\nIf you take the src/kernel/main.rs function, and replace the a2 with r, the rust compiler no longer segfaults!\r\n\r\nI expected some kind of helpful error about how you can't use the a2 register, but got the following beauty:\r\n```\r\n./build.sh --triple riscv32imac-unknown-none-elf --platform sifive_e\r\n[+] Building for riscv32 SiFive-E series\r\n   Compiling diosix v2.0.0 (/home/liam/repos/diosix)\r\nwarning: function is never used: `serial_write`\r\n  --> src/kernel/main.rs:39:1\r\n   |\r\n39 | fn serial_write(s: &str) {\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^\r\n   |\r\n   = note: #[warn(dead_code)] on by default\r\nerror: Could not compile `diosix`.\r\nTo learn more, run the command again with --verbose.\r\nmake: *** [Makefile:2: all] Error 101\r\n```\r\nwhen the --verbose flag is added, you get\r\n\r\n```\r\n./build.sh --triple riscv32imac-unknown-none-elf --platform sifive_e\r\n[+] Building for riscv32 SiFive-E series\r\n       Fresh version_check v0.1.4\r\n       Fresh libc v0.2.43\r\n       Fresh ucd-util v0.1.1\r\n       Fresh utf8-ranges v1.0.1\r\n       Fresh bare-metal v0.2.3\r\n       Fresh memchr v2.0.2\r\n       Fresh regex-syntax v0.6.2\r\n       Fresh riscv v0.3.0\r\n       Fresh aho-corasick v0.6.8\r\n       Fresh lazy_static v1.1.0\r\n       Fresh thread_local v0.3.6\r\n       Fresh regex v1.0.5\r\n   Compiling diosix v2.0.0 (/home/liam/repos/diosix)\r\n     Running `rustc --crate-name kernel src/kernel/main.rs --color always --crate-type bin --emit=dep-info,link -C opt-level=3 -C panic=abort --cfg 'feature=\"sifive_e\"' -C metadata=332af80c5eb5cf4e -C extra-filename=-332af80c5eb5cf4e --out-dir /home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps --target riscv32imac-unknown-none-elf -C ar=riscv32-elf-ar -C linker=riscv32-elf-ld -L dependency=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps -L dependency=/home/liam/repos/diosix/target/release/deps --extern riscv=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps/libriscv-9f27c1cf8cae7478.rlib -C link-arg=-Tsrc/platform/riscv32/sifive_e/link.ld -L native=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/build/diosix-8a0e4656ce8eac69/out -l static=entry`\r\nwarning: function is never used: `serial_write`\r\n  --> src/kernel/main.rs:39:1\r\n   |\r\n39 | fn serial_write(s: &str) {\r\n   | ^^^^^^^^^^^^^^^^^^^^^^^^\r\n   |\r\n   = note: #[warn(dead_code)] on by default\r\nerror: Could not compile `diosix`.\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name kernel src/kernel/main.rs --color always --crate-type bin --emit=dep-info,link -C opt-level=3 -C panic=abort --cfg 'feature=\"sifive_e\"' -C metadata=332af80c5eb5cf4e -C extra-filename=-332af80c5eb5cf4e --out-dir /home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps --target riscv32imac-unknown-none-elf -C ar=riscv32-elf-ar -C linker=riscv32-elf-ld -L dependency=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps -L dependency=/home/liam/repos/diosix/target/release/deps --extern riscv=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/deps/libriscv-9f27c1cf8cae7478.rlib -C link-arg=-Tsrc/platform/riscv32/sifive_e/link.ld -L native=/home/liam/repos/diosix/target/riscv32imac-unknown-none-elf/release/build/diosix-8a0e4656ce8eac69/out -l static=entry` (signal: 11, SIGSEGV: invalid memory reference)\r\nmake: *** [Makefile:2: all] Error 101\r\n```\r\n\r\nIt is totally unclear to me what registers are allowed to be used where(this is because I have no idea what I am doing).\r\n\r\nbtw im on nightly: `rustc 1.30.0-nightly (2ab3eba30 2018-09-14)`\r\nbtw here is the code this is all based off of: \"https://github.com/diodesign/diosix\"\r\nI really love rust-lang and I would love to hear back :)\r\n", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54315/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54315/timeline", "performed_via_github_app": null, "state_reason": "completed"}