{"url": "https://api.github.com/repos/rust-lang/rust/issues/89961", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89961/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89961/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89961/events", "html_url": "https://github.com/rust-lang/rust/issues/89961", "id": 1028148928, "node_id": "I_kwDOAAsO6M49SE7A", "number": 89961, "title": "ICE: thread 'rustc' panicked at 'region constraints already solved'", "user": {"login": "Artemis21", "id": 57376638, "node_id": "MDQ6VXNlcjU3Mzc2NjM4", "avatar_url": "https://avatars.githubusercontent.com/u/57376638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Artemis21", "html_url": "https://github.com/Artemis21", "followers_url": "https://api.github.com/users/Artemis21/followers", "following_url": "https://api.github.com/users/Artemis21/following{/other_user}", "gists_url": "https://api.github.com/users/Artemis21/gists{/gist_id}", "starred_url": "https://api.github.com/users/Artemis21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Artemis21/subscriptions", "organizations_url": "https://api.github.com/users/Artemis21/orgs", "repos_url": "https://api.github.com/users/Artemis21/repos", "events_url": "https://api.github.com/users/Artemis21/events{/privacy}", "received_events_url": "https://api.github.com/users/Artemis21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-10-16T21:09:18Z", "updated_at": "2021-10-16T22:17:45Z", "closed_at": "2021-10-16T22:17:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\n\r\n```rust\r\nuse std::iter::Iterator;\r\n\r\ntrait Data<'a> {\r\n    type Item;\r\n\r\n    fn get_items(&'a self) -> Vec<&'a Self::Item>;\r\n}\r\n\r\nstruct DataContainer<'a, D: Data<'a>> {\r\n    data: D,\r\n    inner: Vec<&'a D::Item>,\r\n}\r\n\r\nimpl<'a, D: Data<'a>> DataContainer<'a, D> {\r\n    fn init(&'a mut self) {\r\n        self.inner = self.data.get_items().into_iter().collect();\r\n    }\r\n}\r\n\r\nstruct DataContainerContainer<'a, D: Data<'a>> {\r\n    inner: DataContainer<'a, D>,\r\n}\r\n\r\nimpl<'a, D: Data<'a>> DataContainerContainer<'a, D> {\r\n    fn go(&self) {\r\n        for _ in self.inner.inner {}\r\n    }\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n\r\n```rustc 1.56.0-nightly (2827db2b1 2021-08-01)\r\nbinary: rustc\r\ncommit-hash: 2827db2b137e899242e81f1beea39ae26e245153\r\ncommit-date: 2021-08-01\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.56.0-nightly\r\nLLVM version: 12.0.1\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nCompiling project-name v0.1.0 (/path/to/project)\r\nthread 'rustc' panicked at 'region constraints already solved', compiler/rustc_infer/src/infer/mod.rs:268:14\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.0-nightly (2827db2b1 2021-08-01) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [mir_borrowck] borrow-checking `<impl at src/main.rs:24:1: 28:2>::go`\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `project-name`\r\n```\r\n\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```   Compiling project-name v0.1.0 (/path/to/project-name)\r\nthread 'rustc' panicked at 'region constraints already solved', compiler/rustc_infer/src/infer/mod.rs:268:14\r\nstack backtrace:\r\n   0:     0x7f1d0c0ee840 - std::backtrace_rs::backtrace::libunwind::trace::h99dbb39dca18857d\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/../../backtrace/src/backtrace/libunwind.rs:90:5\r\n   1:     0x7f1d0c0ee840 - std::backtrace_rs::backtrace::trace_unsynchronized::h832861927e9cfedf\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x7f1d0c0ee840 - std::sys_common::backtrace::_print_fmt::h3d18154c77dcf310\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys_common/backtrace.rs:67:5\r\n   3:     0x7f1d0c0ee840 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::he312f4ad5b9bb346\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys_common/backtrace.rs:46:22\r\n   4:     0x7f1d0c15c96c - core::fmt::write::h9a6d9c74526a6c1b\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/core/src/fmt/mod.rs:1117:17\r\n   5:     0x7f1d0c0e00e5 - std::io::Write::write_fmt::h6aced00850e8186f\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/io/mod.rs:1667:15\r\n   6:     0x7f1d0c0f256b - std::sys_common::backtrace::_print::h65d996766de40da4\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys_common/backtrace.rs:49:5\r\n   7:     0x7f1d0c0f256b - std::sys_common::backtrace::print::h40df9727e635f303\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys_common/backtrace.rs:36:9\r\n   8:     0x7f1d0c0f256b - std::panicking::default_hook::{{closure}}::h8fda4da0104edbdc\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/panicking.rs:208:50\r\n   9:     0x7f1d0c0f2041 - std::panicking::default_hook::h3064706f71c66512\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/panicking.rs:225:9\r\n  10:     0x7f1d0c8d0561 - rustc_driver::DEFAULT_HOOK::{{closure}}::{{closure}}::h370fffa5c9633934\r\n  11:     0x7f1d0c0f2d99 - std::panicking::rust_panic_with_hook::h4b75790a98964d5c\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/panicking.rs:627:17\r\n  12:     0x7f1d0c0f2857 - std::panicking::begin_panic_handler::{{closure}}::h08ba224243609bdb\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/panicking.rs:520:13\r\n  13:     0x7f1d0c0eed4c - std::sys_common::backtrace::__rust_end_short_backtrace::h5a4fe7ab25226445\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys_common/backtrace.rs:141:18\r\n  14:     0x7f1d0c0f27b9 - rust_begin_unwind\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/panicking.rs:516:5\r\n  15:     0x7f1d0c0bd7c1 - core::panicking::panic_fmt::hcf5f6d96e1dd7099\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/core/src/panicking.rs:93:14\r\n  16:     0x7f1d0c0bd6b3 - core::option::expect_failed::h0a5d8f51a88056e8\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/core/src/option.rs:1578:5\r\n  17:     0x7f1d0e273ae2 - <rustc_infer::infer::canonical::canonicalizer::Canonicalizer as rustc_middle::ty::fold::TypeFolder>::fold_region::h26cb734d186582fc\r\n  18:     0x7f1d0e27fafc - rustc_middle::ty::structural_impls::<impl rustc_middle::ty::fold::TypeFoldable for &rustc_middle::ty::TyS>::super_fold_with::h7a1e6b216842a29f\r\n  19:     0x7f1d0e25db84 - rustc_middle::ty::fold::TypeFoldable::fold_with::hf5c04761243c25f7\r\n  20:     0x7f1d0e27fb7c - rustc_middle::ty::structural_impls::<impl rustc_middle::ty::fold::TypeFoldable for &rustc_middle::ty::TyS>::super_fold_with::h7a1e6b216842a29f\r\n  21:     0x7f1d0e27fb0b - rustc_middle::ty::structural_impls::<impl rustc_middle::ty::fold::TypeFoldable for &rustc_middle::ty::TyS>::super_fold_with::h7a1e6b216842a29f\r\n  22:     0x7f1d0e1f1a93 - rustc_middle::ty::fold::TypeFoldable::fold_with::hb28ed157cb56afeb\r\n  23:     0x7f1d0e23ab9e - rustc_middle::ty::fold::TypeFoldable::fold_with::ha81e26ddc98c19fb\r\n  24:     0x7f1d0e202c7e - rustc_infer::infer::canonical::canonicalizer::Canonicalizer::canonicalize::h7ffb5abf455cc5c3\r\n  25:     0x7f1d0e1e1c4e - <rustc_infer::infer::InferCtxt as rustc_trait_selection::traits::query::evaluate_obligation::InferCtxtExt>::evaluate_obligation::h9eeb1202a217d758\r\n  26:     0x7f1d0e1e21a0 - <rustc_infer::infer::InferCtxt as rustc_trait_selection::traits::query::evaluate_obligation::InferCtxtExt>::evaluate_obligation_no_overflow::hc7d6e8e5b578f883\r\n  27:     0x7f1d0e22e69f - rustc_trait_selection::traits::type_known_to_meet_bound_modulo_regions::hd9b1e427baf39aea\r\n  28:     0x7f1d0dec5511 - rustc_mir::borrow_check::diagnostics::move_errors::<impl rustc_mir::borrow_check::MirBorrowckCtxt>::report_move_errors::hfa24569228502051\r\n  29:     0x7f1d0dec7ff2 - rustc_mir::borrow_check::do_mir_borrowck::he7977a83c8db069e\r\n  30:     0x7f1d0dd8d1f7 - rustc_infer::infer::InferCtxtBuilder::enter::h1829a3da5933579e\r\n  31:     0x7f1d0dec6c80 - rustc_mir::borrow_check::mir_borrowck::h8eb6c1f0b14d33e1\r\n  32:     0x7f1d0debcea8 - core::ops::function::FnOnce::call_once::h6f2854470b5c806a\r\n  33:     0x7f1d0e965218 - rustc_query_system::dep_graph::graph::DepGraph<K>::with_task_impl::hc278890e4dec1421\r\n  34:     0x7f1d0e9d9c5a - rustc_data_structures::stack::ensure_sufficient_stack::h7df3ec8b2591229c\r\n  35:     0x7f1d0e8abfc7 - rustc_query_system::query::plumbing::force_query_with_job::h6f86ffe1c88de4c6\r\n  36:     0x7f1d0df4a280 - rustc_query_system::query::plumbing::get_query_impl::h332a4151e7422444\r\n  37:     0x7f1d0dfbd3fb - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::mir_borrowck::h3eeeb2427f584737\r\n  38:     0x7f1d0d9d60d1 - rustc_middle::ty::<impl rustc_middle::ty::context::TyCtxt>::par_body_owners::h6bb5f491d39e5713\r\n  39:     0x7f1d0e3ed8a9 - rustc_interface::passes::analysis::h50d0de1731ee4f37\r\n  40:     0x7f1d0d276df3 - rustc_middle::dep_graph::<impl rustc_query_system::dep_graph::DepKind for rustc_middle::dep_graph::dep_node::DepKind>::with_deps::ha410030de379e7fa\r\n  41:     0x7f1d0d243ae7 - rustc_query_system::dep_graph::graph::DepGraph<K>::with_task_impl::h7d88f9b0801b7005\r\n  42:     0x7f1d0d2527a9 - rustc_query_system::dep_graph::graph::DepGraph<K>::with_eval_always_task::hfb5ebbe42af10190\r\n  43:     0x7f1d0d31933e - rustc_data_structures::stack::ensure_sufficient_stack::h41e0719d654b87ab\r\n  44:     0x7f1d0d0dda31 - rustc_query_system::query::plumbing::force_query_with_job::h739ef3432ad7844a\r\n  45:     0x7f1d0e8949c0 - rustc_query_system::query::plumbing::get_query_impl::hfb328957edb27639\r\n  46:     0x7f1d0e93306d - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::analysis::h1bafb686f4c64bd1\r\n  47:     0x7f1d0e3c1838 - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter::h9ff1bb326f6cbdde\r\n  48:     0x7f1d0e3b0acc - rustc_span::with_source_map::h35aa4a6792e2f0de\r\n  49:     0x7f1d0e3c2a5a - rustc_interface::interface::create_compiler_and_run::h600b31664ea7498c\r\n  50:     0x7f1d0e3b4b59 - scoped_tls::ScopedKey<T>::set::h95fded8ea1ce829a\r\n  51:     0x7f1d0e3b109a - std::sys_common::backtrace::__rust_begin_short_backtrace::hcb9f52ef891273be\r\n  52:     0x7f1d0e3b0385 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h7d639d5804de8241\r\n  53:     0x7f1d0c0ff3a7 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h09f167e08fc945ff\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/alloc/src/boxed.rs:1572:9\r\n  54:     0x7f1d0c0ff3a7 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hf814fe85eeb118e0\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/alloc/src/boxed.rs:1572:9\r\n  55:     0x7f1d0c0ff3a7 - std::sys::unix::thread::Thread::new::thread_start::hb71b17934c5f5e68\r\n                               at /rustc/2827db2b137e899242e81f1beea39ae26e245153/library/std/src/sys/unix/thread.rs:91:17\r\n  56:     0x7f1d0c020450 - start_thread\r\n  57:     0x7f1d0bf2ed53 - clone\r\n  58:                0x0 - <unknown>\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.0-nightly (2827db2b1 2021-08-01) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [mir_borrowck] borrow-checking `<impl at src/main.rs:24:1: 28:2>::go`\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `project-name`\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nEdited with MCVE that should actually compile according to RLS/Rust Analyser.\r\n", "closed_by": {"login": "Artemis21", "id": 57376638, "node_id": "MDQ6VXNlcjU3Mzc2NjM4", "avatar_url": "https://avatars.githubusercontent.com/u/57376638?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Artemis21", "html_url": "https://github.com/Artemis21", "followers_url": "https://api.github.com/users/Artemis21/followers", "following_url": "https://api.github.com/users/Artemis21/following{/other_user}", "gists_url": "https://api.github.com/users/Artemis21/gists{/gist_id}", "starred_url": "https://api.github.com/users/Artemis21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Artemis21/subscriptions", "organizations_url": "https://api.github.com/users/Artemis21/orgs", "repos_url": "https://api.github.com/users/Artemis21/repos", "events_url": "https://api.github.com/users/Artemis21/events{/privacy}", "received_events_url": "https://api.github.com/users/Artemis21/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89961/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89961/timeline", "performed_via_github_app": null, "state_reason": "completed"}