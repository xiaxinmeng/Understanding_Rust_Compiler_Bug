{"url": "https://api.github.com/repos/rust-lang/rust/issues/18146", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18146/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18146/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18146/events", "html_url": "https://github.com/rust-lang/rust/issues/18146", "id": 46191066, "node_id": "MDU6SXNzdWU0NjE5MTA2Ng==", "number": 18146, "title": "Improper instructions produced on i686-unknown-linux-gnu", "user": {"login": "alexchandel", "id": 637714, "node_id": "MDQ6VXNlcjYzNzcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/637714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexchandel", "html_url": "https://github.com/alexchandel", "followers_url": "https://api.github.com/users/alexchandel/followers", "following_url": "https://api.github.com/users/alexchandel/following{/other_user}", "gists_url": "https://api.github.com/users/alexchandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexchandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexchandel/subscriptions", "organizations_url": "https://api.github.com/users/alexchandel/orgs", "repos_url": "https://api.github.com/users/alexchandel/repos", "events_url": "https://api.github.com/users/alexchandel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexchandel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2014-10-18T23:54:04Z", "updated_at": "2017-04-28T22:37:03Z", "closed_at": "2017-04-28T22:37:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "When cross-compiling a minimal `no_std`/`no_main`/`no_stack_check` program for `i686-unknown-linux-gnu` on OS X 10.10, rustc inserts two anomalous instructions during machine code generation. Notice the call/pop eax just after `.Ltmp2`.\n\nFrom assembly:\n\n``` asm\nain:\n    .cfi_startproc\n    pushl   %ebx\n.Ltmp0:\n    .cfi_def_cfa_offset 8\n    subl    $24, %esp\n.Ltmp1:\n    .cfi_def_cfa_offset 32\n.Ltmp2:\n    .cfi_offset %ebx, -8\n    calll   .L0$pb\n.L0$pb:\n    popl    %eax\n.Ltmp3:\n    addl    $_GLOBAL_OFFSET_TABLE_+(.Ltmp3-.L0$pb), %eax\n...\n```\n\nFrom disassembly:\n\n``` asm\nDisassembly of section .text:Disassembly of section .text.main:\nmain:\n       0:   53                                              pushl   %ebx\n       1:   83 ec 18                                        subl    $24, %esp\n       4:   e8 00 00 00 00                                  calll   0\n       9:   58                                              popl    %eax\n       a:   81 c0 03 00 00 00                               addl    $3, %eax\n...\n```\n\n~~Popping the former frame pointer would seem to destroy the stack frame.~~ Actually what is depicted above just pops an IP; however it does destroy the stack later. Note that it is never re-pushed later in the function.\n\nNow, this is does _not_ happen when rustc instead emits LLVM IR that is separately compiled with clang. The issue occurs in larger code, and since executables produced with this issue segfault in qemu, I'm forced to compile/assemble separately with clang.\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18146/timeline", "performed_via_github_app": null, "state_reason": "completed"}