{"url": "https://api.github.com/repos/rust-lang/rust/issues/64048", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/64048/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/64048/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/64048/events", "html_url": "https://github.com/rust-lang/rust/issues/64048", "id": 487817867, "node_id": "MDU6SXNzdWU0ODc4MTc4Njc=", "number": 64048, "title": "Recursive fn with varying const generic parameter causes ICE.", "user": {"login": "goddessfreya", "id": 20157001, "node_id": "MDQ6VXNlcjIwMTU3MDAx", "avatar_url": "https://avatars.githubusercontent.com/u/20157001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goddessfreya", "html_url": "https://github.com/goddessfreya", "followers_url": "https://api.github.com/users/goddessfreya/followers", "following_url": "https://api.github.com/users/goddessfreya/following{/other_user}", "gists_url": "https://api.github.com/users/goddessfreya/gists{/gist_id}", "starred_url": "https://api.github.com/users/goddessfreya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goddessfreya/subscriptions", "organizations_url": "https://api.github.com/users/goddessfreya/orgs", "repos_url": "https://api.github.com/users/goddessfreya/repos", "events_url": "https://api.github.com/users/goddessfreya/events{/privacy}", "received_events_url": "https://api.github.com/users/goddessfreya/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-31T22:36:55Z", "updated_at": "2019-09-02T09:59:43Z", "closed_at": "2019-09-02T09:59:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\r\n#![feature(const_generics)]\r\n\r\nfn mk_array<T, const TO: usize>() -> [T; TO] {\r\n    panic!();\r\n}\r\n\r\nfn uperms<const DICE_NUM: usize>() -> Vec<[u8; DICE_NUM]> {\r\n    if DICE_NUM <= 1 {\r\n        return vec![mk_array::<u8, {DICE_NUM}>()];\r\n    } else {\r\n        let pperms = uperms::<{ DICE_NUM - 1 }>();\r\n        panic!();\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let perms1 = uperms::<{ 1 }>();\r\n}\r\n```\r\n\r\n[Play link](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=43c26fdb0221099101742ce3c0aa257a)\r\n\r\nBacktrace: <details> \r\n```\r\n   Compiling farklemaster v0.1.0 (/home/gentz/Documents/gfx/farklemaster)\r\nwarning: the feature `const_generics` is incomplete and may cause the compiler to crash\r\n --> src/main.rs:1:12\r\n  |\r\n1 | #![feature(const_generics)]\r\n  |            ^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(incomplete_features)]` on by default\r\n\r\nerror: internal compiler error: src/librustc/ty/subst.rs:597: const parameter `DICE_NUM/#0` (Const { ty: usize, val: Param(DICE_NUM/#0) }/0) out of range when substituting substs=[]\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:578:9\r\nstack backtrace:\r\n   0:     0x7fbf7a370902 - backtrace::backtrace::libunwind::trace::h4ce370bcd1ee6179\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.35/src/backtrace/libunwind.rs:88\r\n   1:     0x7fbf7a370902 - backtrace::backtrace::trace_unsynchronized::ha1849ec6dc042df0\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.35/src/backtrace/mod.rs:66\r\n   2:     0x7fbf7a370902 - std::sys_common::backtrace::_print::hb67777a898188c39\r\n                               at src/libstd/sys_common/backtrace.rs:47\r\n   3:     0x7fbf7a370902 - std::sys_common::backtrace::print::hadbba928c72abbae\r\n                               at src/libstd/sys_common/backtrace.rs:36\r\n   4:     0x7fbf7a370902 - std::panicking::default_hook::{{closure}}::h277bed7d7e46968e\r\n                               at src/libstd/panicking.rs:200\r\n   5:     0x7fbf7a3705e6 - std::panicking::default_hook::hc04dc2fea0cc3aac\r\n                               at src/libstd/panicking.rs:214\r\n   6:     0x7fbf7c24da31 - rustc::util::common::panic_hook::hadd0b8f85b4067ef\r\n   7:     0x7fbf7a37113c - std::panicking::rust_panic_with_hook::h7ed0ac6f9e15991f\r\n                               at src/libstd/panicking.rs:481\r\n   8:     0x7fbf7c1dc53d - std::panicking::begin_panic::h1c40c95922eba485\r\n   9:     0x7fbf7bd1e9ad - rustc_errors::Handler::span_bug::hac0d34a0564a9731\r\n  10:     0x7fbf7befe51e - rustc::util::bug::opt_span_bug_fmt::{{closure}}::h139ee24d6fa9531e\r\n  11:     0x7fbf7bef8ed3 - rustc::ty::context::tls::with_opt::{{closure}}::h4c0650730b3d87b0\r\n  12:     0x7fbf7bef8e43 - rustc::ty::context::tls::with_context_opt::h0b052a3db2fd7393\r\n  13:     0x7fbf7bef8e87 - rustc::ty::context::tls::with_opt::h0247b58216cb47e8\r\n  14:     0x7fbf7befe428 - rustc::util::bug::opt_span_bug_fmt::h3dc854d51555accb\r\n  15:     0x7fbf7befe3da - rustc::util::bug::span_bug_fmt::h6a2695b88c32fe61\r\n  16:     0x7fbf7bd086fb - <rustc::ty::subst::SubstFolder as rustc::ty::fold::TypeFolder>::fold_const::h7e3469995479b33a\r\n  17:     0x7fbf7b2cee00 - rustc::traits::codegen::<impl rustc::ty::context::TyCtxt>::subst_and_normalize_erasing_regions::he1889485709b37ce\r\n  18:     0x7fbf7b44b907 - rustc_mir::interpret::operand::<impl rustc_mir::interpret::eval_context::InterpCx<M>>::eval_operand::hb2ea8eb42ae9cf9e\r\n  19:     0x7fbf7b45758b - rustc_mir::interpret::step::<impl rustc_mir::interpret::eval_context::InterpCx<M>>::run::h2c4cd78b015ece1f\r\n  20:     0x7fbf7b23711a - rustc_mir::const_eval::const_eval_raw_provider::hf3ff85bb694929ee\r\n  21:     0x7fbf7b2ed073 - rustc::ty::query::__query_compute::const_eval_raw::h5ba229962fe4016d\r\n  22:     0x7fbf7b24515a - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::const_eval_raw>::compute::h565e5bce23bd5cf5\r\n  23:     0x7fbf7b3a2f6a - rustc::dep_graph::graph::DepGraph::with_task_impl::ha30d8a9044e56636\r\n  24:     0x7fbf7b26bbd5 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h37ea358b8ec9d7c6\r\n  25:     0x7fbf7b235c6e - rustc_mir::const_eval::const_eval_provider::h792d7cb0f1f28534\r\n  26:     0x7fbf7b2ec463 - rustc::ty::query::__query_compute::const_eval::hefa01c0bd68294d6\r\n  27:     0x7fbf7b244f6a - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::const_eval>::compute::h6bb6e558896acff8\r\n  28:     0x7fbf7b3a444d - rustc::dep_graph::graph::DepGraph::with_task_impl::hac6e9df0a3e6f199\r\n  29:     0x7fbf7b267350 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h3025814bdb98c9f5\r\n  30:     0x7fbf7b235bfc - rustc_mir::const_eval::const_eval_provider::h792d7cb0f1f28534\r\n  31:     0x7fbf7bd1693a - rustc::ty::query::__query_compute::const_eval::hb4aa5926d8dc5c9d\r\n  32:     0x7fbf7c10f44a - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::const_eval>::compute::h6bb6e558896acff8\r\n  33:     0x7fbf7bc68f39 - rustc::dep_graph::graph::DepGraph::with_task_impl::h69bc137031276732\r\n  34:     0x7fbf7bf7f3a7 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h36bdc4fed882ea78\r\n  35:     0x7fbf7c16adee - rustc::ty::sty::Const::eval::hb401cdbfd953e0ba\r\n  36:     0x7fbf7bd3401d - <smallvec::SmallVec<A> as core::iter::traits::collect::FromIterator<<A as smallvec::Array>::Item>>::from_iter::he9e2ab7fd3307967\r\n  37:     0x7fbf7c15773b - rustc::ty::fold::TypeFoldable::fold_with::haa043f760b7edf82\r\n  38:     0x7fbf7c14daee - <rustc::traits::project::AssocTypeNormalizer as rustc::ty::fold::TypeFolder>::fold_ty::h86a6eb69d7cae1d0\r\n  39:     0x7fbf7b0113e4 - rustc::traits::project::normalize::hcd8ad6288aa2ebc9\r\n  40:     0x7fbf7ae452cd - rustc_typeck::check::FnCtxt::instantiate_value_path::hedaf5ff2b8b867b2\r\n  41:     0x7fbf7ae0bf30 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::hf72747da8aab128d\r\n  42:     0x7fbf7ae08ee5 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::hd4290fcb743dc65a\r\n  43:     0x7fbf7ae24603 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt>::check_call::h543b73b94215b502\r\n  44:     0x7fbf7ae0991e - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::hf72747da8aab128d\r\n  45:     0x7fbf7ae08ee5 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::hd4290fcb743dc65a\r\n  46:     0x7fbf7ae40dd1 - rustc_typeck::check::FnCtxt::check_decl_initializer::h0df3aa7cb5f326b2\r\n  47:     0x7fbf7ae40e85 - rustc_typeck::check::FnCtxt::check_decl_local::h16dc6a267bb855a1\r\n  48:     0x7fbf7ae40f9b - rustc_typeck::check::FnCtxt::check_stmt::hb8d30f7fa9c2c1f7\r\n  49:     0x7fbf7ae4142b - rustc_typeck::check::FnCtxt::check_block_with_expected::h272b260cd492369d\r\n  50:     0x7fbf7ae08ee5 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::hd4290fcb743dc65a\r\n  51:     0x7fbf7adf1a7f - rustc_typeck::check::_match::<impl rustc_typeck::check::FnCtxt>::check_match::hd3b0418651de0d88\r\n  52:     0x7fbf7ae09d40 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::hf72747da8aab128d\r\n  53:     0x7fbf7ae08ee5 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::hd4290fcb743dc65a\r\n  54:     0x7fbf7ae4146b - rustc_typeck::check::FnCtxt::check_block_with_expected::h272b260cd492369d\r\n  55:     0x7fbf7ae08ee5 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::hd4290fcb743dc65a\r\n  56:     0x7fbf7ae135fb - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_return_expr::h9a52a562d86b5052\r\n  57:     0x7fbf7ae2ed25 - rustc_typeck::check::check_fn::hcb029ffa950299ec\r\n  58:     0x7fbf7af9c709 - rustc::ty::context::GlobalCtxt::enter_local::hcc1e02c358261193\r\n  59:     0x7fbf7ae2dcb8 - rustc_typeck::check::typeck_tables_of::h6f0eb1f8c7b9f5e9\r\n  60:     0x7fbf7ae7ddca - rustc::ty::query::__query_compute::typeck_tables_of::h62d65d4026b99e27\r\n  61:     0x7fbf7af10fcb - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::hca69de331eee9759\r\n  62:     0x7fbf7aeb7d02 - rustc::dep_graph::graph::DepGraph::with_task_impl::ha7be3be332b95d17\r\n  63:     0x7fbf7af20931 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h10565f1243b7ad5c\r\n  64:     0x7fbf7af0dd7f - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::h3a830552646698d8\r\n  65:     0x7fbf7ae2d72d - rustc_typeck::check::typeck_item_bodies::h7b6a9b66bd0d82f5\r\n  66:     0x7fbf7ae7e215 - rustc::ty::query::__query_compute::typeck_item_bodies::hd0a39d56e65efaff\r\n  67:     0x7fbf7aeb9004 - rustc::dep_graph::graph::DepGraph::with_task_impl::hb953ebfe5f7d123d\r\n  68:     0x7fbf7af2c6dd - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h25e7e246720c4835\r\n  69:     0x7fbf7ae82d5e - rustc::util::common::time::h0ca0fd77a3a38e7f\r\n  70:     0x7fbf7b058a9f - rustc_typeck::check_crate::h6efa337673fd0bf9\r\n  71:     0x7fbf7a9573da - rustc_interface::passes::analysis::h5ca1dcf5c3fa00a4\r\n  72:     0x7fbf7a862481 - rustc::ty::query::__query_compute::analysis::hb2ca05cf73df93a7\r\n  73:     0x7fbf7a845759 - rustc::dep_graph::graph::DepGraph::with_task_impl::hada062624bcc756b\r\n  74:     0x7fbf7a859c5e - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hfa3b77f4283d964e\r\n  75:     0x7fbf7a8767aa - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h2cccf239a8fcfaff\r\n  76:     0x7fbf7a9d3b0a - rustc_interface::passes::create_global_ctxt::{{closure}}::h411ea04f079efa05\r\n  77:     0x7fbf7a87926e - rustc_interface::interface::run_compiler_in_existing_thread_pool::h495ac89e699120f3\r\n  78:     0x7fbf7a888522 - std::thread::local::LocalKey<T>::with::h2b6e98dea32965c7\r\n  79:     0x7fbf7a89c21e - scoped_tls::ScopedKey<T>::set::h5242c74f962b8d66\r\n  80:     0x7fbf7a8d1482 - syntax::with_globals::h36bb832d23aa0930\r\n  81:     0x7fbf7a83f940 - std::sys_common::backtrace::__rust_begin_short_backtrace::h5ac2bb0fb1bde18d\r\n  82:     0x7fbf7a3817fa - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:80\r\n  83:     0x7fbf7a864619 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h999a457b750ab865\r\n  84:     0x7fbf7a3543ff - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h8937f8752182f20d\r\n                               at /rustc/4295eea903a9e1014ee30f82930f5ec08d888077/src/liballoc/boxed.rs:922\r\n  85:     0x7fbf7a3804a0 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h2cc60d9264e9fe0a\r\n                               at /rustc/4295eea903a9e1014ee30f82930f5ec08d888077/src/liballoc/boxed.rs:922\r\n  86:     0x7fbf7a3804a0 - std::sys_common::thread::start_thread::h7aa97315f70bdaea\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  87:     0x7fbf7a3804a0 - std::sys::unix::thread::Thread::new::thread_start::h15d5599c4b4a4cef\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  88:     0x7fbf7a28957f - start_thread\r\n  89:     0x7fbf7a19c0e3 - __clone\r\n  90:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [const_eval_raw] const-evaluating `uperms::{{constant}}#1`\r\n#1 [const_eval] const-evaluating + checking `uperms::{{constant}}#1`\r\n#2 [const_eval] const-evaluating + checking `uperms::{{constant}}#1`\r\n#3 [typeck_tables_of] processing `uperms`\r\n#4 [typeck_item_bodies] type-checking all item bodies\r\n#5 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.39.0-nightly (4295eea90 2019-08-30) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `farklemaster`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n</details> ", "closed_by": {"login": "goddessfreya", "id": 20157001, "node_id": "MDQ6VXNlcjIwMTU3MDAx", "avatar_url": "https://avatars.githubusercontent.com/u/20157001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goddessfreya", "html_url": "https://github.com/goddessfreya", "followers_url": "https://api.github.com/users/goddessfreya/followers", "following_url": "https://api.github.com/users/goddessfreya/following{/other_user}", "gists_url": "https://api.github.com/users/goddessfreya/gists{/gist_id}", "starred_url": "https://api.github.com/users/goddessfreya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goddessfreya/subscriptions", "organizations_url": "https://api.github.com/users/goddessfreya/orgs", "repos_url": "https://api.github.com/users/goddessfreya/repos", "events_url": "https://api.github.com/users/goddessfreya/events{/privacy}", "received_events_url": "https://api.github.com/users/goddessfreya/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/64048/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/64048/timeline", "performed_via_github_app": null, "state_reason": "completed"}