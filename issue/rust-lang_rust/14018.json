{"url": "https://api.github.com/repos/rust-lang/rust/issues/14018", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/14018/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/14018/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/14018/events", "html_url": "https://github.com/rust-lang/rust/issues/14018", "id": 33006586, "node_id": "MDU6SXNzdWUzMzAwNjU4Ng==", "number": 14018, "title": "'index out of bounds' failure for Regex::new(\"\") and regex!(\"\")", "user": {"login": "rolfmorel", "id": 854835, "node_id": "MDQ6VXNlcjg1NDgzNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/854835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rolfmorel", "html_url": "https://github.com/rolfmorel", "followers_url": "https://api.github.com/users/rolfmorel/followers", "following_url": "https://api.github.com/users/rolfmorel/following{/other_user}", "gists_url": "https://api.github.com/users/rolfmorel/gists{/gist_id}", "starred_url": "https://api.github.com/users/rolfmorel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rolfmorel/subscriptions", "organizations_url": "https://api.github.com/users/rolfmorel/orgs", "repos_url": "https://api.github.com/users/rolfmorel/repos", "events_url": "https://api.github.com/users/rolfmorel/events{/privacy}", "received_events_url": "https://api.github.com/users/rolfmorel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-05-07T17:29:39Z", "updated_at": "2014-05-07T17:33:22Z", "closed_at": "2014-05-07T17:33:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using an empty string as the `re` argument to `regex::Regex::new()` or `regex!()` leads to an `index out of bounds: the len is 0 but the index is 0` failure on runtime and compile time respectively.\n\nThe following is a compilable test-case:\n\n```\n#![feature(phase)]\nextern crate regex;\n#[phase(syntax)] extern crate regex_macros;\n\nfn main() {\n    // error: internal compiler error: unexpected failure\n    // note: the compiler hit an unexpected failure path. this is a bug.\n    // note: we would appreciate a bug report: http://static.rust-lang.org/doc/master/complement-bugreport.html\n    // note: run with `RUST_BACKTRACE=1` for a backtrace\n    // task 'rustc' failed at 'index out of bounds: the len is 0 but the index is 0', /build/rust-git/src/rust/src/libregex/lib.rs:1\n    let compile_time_empty_re = regex!(\"\");\n\n    // comment out the regex! macro to get the task failure on runtime for the following:\n    let run_time_empty_re = regex::Regex::new(\"\").unwrap();\n}\n```\n\nThe backtrace from `rustc`:\n\n```\n% RUST_BACKTRACE=1 rustc regex-empty-str.rs\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://static.rust-lang.org/doc/master/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'index out of bounds: the len is 0 but the index is 0', /build/rust-git/src/rust/src/libregex/lib.rs:1\nstack backtrace:\n   1:     0x7f2f857062f0 - rt::backtrace::imp::write::h288a001cb8ab0467Mwa::v0.11.pre\n   2:     0x7f2f85657960 - rt::unwind::begin_unwind_inner::h21d0e74b81447276R69::v0.11.pre\n   3:     0x7f2f856578d0 - <unknown>\n   4:     0x7f2f85705f00 - rt::unwind::begin_unwind_raw::hcae126cecf9ac08b039::v0.11.pre\n   5:     0x7f2f85656c00 - rt::unwind::fail_::hb350ad41fcb04968E19::v0.11.pre\n   6:     0x7f2f85705f70 - <unknown>\n   7:     0x7f2f85658b90 - rt::unwind::fail_bounds_check::h77cb92ae44655be1119::v0.11.pre\n   8:     0x7f2f81af2710 - <unknown>\n   9:     0x7f2f81b018a0 - re::Regex::new::h7515f9e2f6385e4exZg::v0.11.pre\n  10:     0x7f2f81d458e0 - <unknown>\n  11:     0x7f2f845f43d0 - ext::base::BasicMacroExpander.MacroExpander::expand::hd67bc89fd9d9a56eQbR::v0.11.pre\n  12:     0x7f2f84605490 - ext::expand::expand_expr::ha374fe02226e64benIR::v0.11.pre\n  13:     0x7f2f8460dd70 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_expr::h677bb239787cfda7RyS::v0.11.pre\n  14:     0x7f2f8462cb80 - ext::expand::expand_stmt::hcdb4c2679a8ed298FhS::v0.11.pre\n  15:     0x7f2f84648610 - <unknown>\n  16:     0x7f2f8461a840 - ext::expand::expand_block_elts::h5c64eab4a957c3e9OuS::v0.11.pre\n  17:     0x7f2f84648530 - ext::expand::expand_block::h454ad0775b85e8908tS::v0.11.pre\n  18:     0x7f2f846175b0 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_block::h96e96e3fb41ac8e10zS::v0.11.pre\n  19:     0x7f2f84620ae0 - <unknown>\n  20:     0x7f2f8461b600 - ext::expand::expand_item::h94bc4908c0c8fdf5TVR::v0.11.pre\n  21:     0x7f2f84623bf0 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::hfe58429eae993e278yS::v0.11.pre\n  22:     0x7f2f84623b90 - <unknown>\n  23:     0x7f2f846235d0 - <unknown>\n  24:     0x7f2f84622ea0 - <unknown>\n  25:     0x7f2f84648d50 - ext::expand::expand_crate::h8377624133b73814MAS::v0.11.pre\n  26:     0x7f2f86b61a00 - <unknown>\n  27:     0x7f2f86b61260 - <unknown>\n  28:     0x7f2f86b5eaf0 - driver::driver::phase_2_configure_and_expand::he42a57583b18ce58YSe::v0.11.pre\n  29:     0x7f2f86ba1550 - driver::driver::compile_input::hffffe7f389caa620Amf::v0.11.pre\n  30:     0x7f2f86bc6aa0 - run_compiler::hfcd48299addf77dfeQm::v0.11.pre\n  31:     0x7f2f86be2f10 - <unknown>\n  32:     0x7f2f86be1410 - <unknown>\n  33:     0x7f2f86bdbc80 - <unknown>\n  34:     0x7f2f85d9e340 - <unknown>\n  35:     0x7f2f856fbda0 - <unknown>\n  36:     0x7f2f8570c5c0 - rust_try\n  37:     0x7f2f856fbbe0 - rt::task::Task::run::h93895fb04573c54dUW7::v0.11.pre\n  38:     0x7f2f85d9e110 - <unknown>\n  39:     0x7f2f85704e30 - <unknown>\n  40:     0x7f2f833ef060 - start_thread\n  41:     0x7f2f8532a489 - __clone\n  42:                0x0 - <unknown>\n```\n\nA backtrace for the program when the `regex!()` macro is commented out:\n\n```\n% rust-backtrace ./regex-empty-str\nBreakpoint 1 at 0x471a30\nwarning: Could not load shared library symbols for linux-vdso.so.1.\nDo you need \"set solib-search-path\" or \"set sysroot\"?\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/usr/lib/libthread_db.so.1\".\ntask '<main>' failed at 'index out of bounds: the len is 0 but the index is 0', /build/rust-git/src/rust/src/libregex/lib.rs:1\n\nBreakpoint 1, 0x0000000000471a30 in rust_fail ()\n#0  0x0000000000471a30 in rust_fail ()\n#1  0x0000000000471a03 in rt::unwind::Unwinder::begin_unwind::h7a34b2c57cd8ebe9EV9::v0.11.pre ()\n#2  0x0000000000453aad in rt::unwind::begin_unwind_inner::h21d0e74b81447276R69::v0.11.pre ()\n#3  0x0000000000452d28 in rt::unwind::begin_unwind::h10355639713018170346::v0.11.pre ()\n#4  0x0000000000471c17 in rt::unwind::begin_unwind_raw::hcae126cecf9ac08b039::v0.11.pre ()\n#5  0x0000000000452b2b in rt::unwind::fail_::hb350ad41fcb04968E19::v0.11.pre ()\n#6  0x0000000000471c5f in rt::unwind::fail_bounds_check::closure.40422 ()\n#7  0x0000000000453fbe in rt::unwind::fail_bounds_check::h77cb92ae44655be1119::v0.11.pre ()\n#8  0x0000000000410c08 in parse::Parser$LT$$x27a$GT$::parse::hd6035c4711160a86Kuf::v0.11.pre ()\n#9  0x00000000004190b9 in re::Regex::new::h7515f9e2f6385e4exZg::v0.11.pre ()\n#10 0x0000000000402afe in main::h695ce60898fd8803gaa::v0.0 ()\n#11 0x0000000000452a43 in start::closure.7194 ()\n#12 0x0000000000468903 in rt::task::Task::run::closure.40319 ()\n#13 0x0000000000477dcc in rust_try ()\n#14 0x0000000000468762 in rt::task::Task::run::h93895fb04573c54dUW7::v0.11.pre ()\n#15 0x0000000000452834 in start::h1727cab19364d8a2xxd::v0.11.pre ()\n#16 0x0000000000452624 in lang_start::hea05ce15f18b4932Rwd::v0.11.pre ()\n#17 0x0000000000402b6f in main ()\n```\n\nThe problem seems to be that in rust/src/libregex/parse.rs `Parser::parse()` calls `self.cur()`, the character index [chari](https://github.com/mozilla/rust/blob/master/src/libregex/parse.rs#L194) is set to zero and when the string length is zero it fails in [self.cur()](https://github.com/mozilla/rust/blob/master/src/libregex/parse.rs#L194) for `*self.chars.get(self.chari)`.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/14018/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/14018/timeline", "performed_via_github_app": null, "state_reason": "completed"}