{"url": "https://api.github.com/repos/rust-lang/rust/issues/85130", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85130/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85130/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85130/events", "html_url": "https://github.com/rust-lang/rust/issues/85130", "id": 883135238, "node_id": "MDU6SXNzdWU4ODMxMzUyMzg=", "number": 85130, "title": "Add information about why a closure is inferred to be FnMut", "user": {"login": "Frederik-Baetens", "id": 18269095, "node_id": "MDQ6VXNlcjE4MjY5MDk1", "avatar_url": "https://avatars.githubusercontent.com/u/18269095?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Frederik-Baetens", "html_url": "https://github.com/Frederik-Baetens", "followers_url": "https://api.github.com/users/Frederik-Baetens/followers", "following_url": "https://api.github.com/users/Frederik-Baetens/following{/other_user}", "gists_url": "https://api.github.com/users/Frederik-Baetens/gists{/gist_id}", "starred_url": "https://api.github.com/users/Frederik-Baetens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Frederik-Baetens/subscriptions", "organizations_url": "https://api.github.com/users/Frederik-Baetens/orgs", "repos_url": "https://api.github.com/users/Frederik-Baetens/repos", "events_url": "https://api.github.com/users/Frederik-Baetens/events{/privacy}", "received_events_url": "https://api.github.com/users/Frederik-Baetens/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-05-10T01:33:43Z", "updated_at": "2021-05-12T20:53:39Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Given the following code:\r\n\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=6a655a94cd06a72a9da17b0ebe8c7c74\r\n\r\n```rust\r\nuse futures::stream::{self, StreamExt};\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    let key1: String = \"/helloa\".to_string();\r\n\r\n    dbg!(&key1);\r\n\r\n    let futlist = stream::iter(0..10);\r\n    let _stringvec: Vec<String> = futlist.map(move |_| {\r\n        async {\r\n            key1.clone()\r\n        }\r\n    }).buffer_unordered(10).collect::<Vec<String>>().await;\r\n}\r\n\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\n    Checking asyncinfererr v0.1.0 (/home/frederik/Programmeren/rust/asyncinfererr)\r\nerror: captured variable cannot escape `FnMut` closure body\r\n  --> src/main.rs:11:9\r\n   |\r\n5  |       let key1: String = \"/helloa\".to_string();\r\n   |           ---- variable defined here\r\n...\r\n10 |       let _stringvec: Vec<String> = futlist.map(move |_| {\r\n   |                                                        - inferred to be a `FnMut` closure\r\n11 | /         async {\r\n12 | |             key1.clone()\r\n   | |             ---- variable captured here\r\n13 | |         }\r\n   | |_________^ returns an `async` block that contains a reference to a captured variable, which then escapes the closure body\r\n   |\r\n   = note: `FnMut` closures only have access to their captured variables while they are executing...\r\n   = note: ...therefore, they cannot allow references to captured variables to escape\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `asyncinfererr`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\nI think it would be quite nice if the user was also told why the closure was inferred to be FnMut. It may not be possible to suggest to the user that they should remove the move to solve this problem, because that might not align with what they want to accomplish, but I think that informing them of that the move keyword caused the closure to be inferred as FnMut would be quite helpful.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85130/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85130/timeline", "performed_via_github_app": null, "state_reason": null}