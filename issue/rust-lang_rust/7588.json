{"url": "https://api.github.com/repos/rust-lang/rust/issues/7588", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7588/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7588/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7588/events", "html_url": "https://github.com/rust-lang/rust/issues/7588", "id": 16379567, "node_id": "MDU6SXNzdWUxNjM3OTU2Nw==", "number": 7588, "title": "Overflow handling of from_str methods is broken", "user": {"login": "tweber12", "id": 2572424, "node_id": "MDQ6VXNlcjI1NzI0MjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2572424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tweber12", "html_url": "https://github.com/tweber12", "followers_url": "https://api.github.com/users/tweber12/followers", "following_url": "https://api.github.com/users/tweber12/following{/other_user}", "gists_url": "https://api.github.com/users/tweber12/gists{/gist_id}", "starred_url": "https://api.github.com/users/tweber12/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tweber12/subscriptions", "organizations_url": "https://api.github.com/users/tweber12/orgs", "repos_url": "https://api.github.com/users/tweber12/repos", "events_url": "https://api.github.com/users/tweber12/events{/privacy}", "received_events_url": "https://api.github.com/users/tweber12/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-07-04T19:55:54Z", "updated_at": "2014-05-23T12:11:58Z", "closed_at": "2013-09-07T04:23:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The from_str methods of all integer types, signed and unsigned, may return Some() values in the case of an overflow. For example, between 256 and 1000, u8::from_str() returns None for less than half of the values and Some(nonsense) for the rest.\n\nExamples:\n\n``` rust\nu8::from_str(\"1000\"); // => Some(232)\nu16::from_str(\"100000\"); // => Some(34464)\nu32::from_str(\"10000000000\"); // => Some(1410065408)\nu64::from_str(\"30000000000000000000\"); // => Some(11553255926290448384)\n\ni8::from_str(\"600\"); // => Some(88)\ni16::from_str(\"80000\"); // => Some(14464)\ni32::from_str(\"5000000000\"); // => Some(705032704)\ni64::from_str(\"21000000000000000000\"); // => Some(2553255926290448384)\n```\n\nFloats don't seem to have this problem, but are inconsistent in their behavior on overflow:\n\n``` rust\nf32::from_str(\"1000000000000000000000000000000000000000\"); // => Some(inf)\nf32::from_str(\"10000000000000000000000000000000000000000\"); // => None\nf32::from_str(\"1e40\"); // same number as above => Some(inf)\n```\n\nWhy this happens:\nfrom_str_bytes_common (from strconv.rs), which is used by all these methods, does the following:\nIt converts the string byte by byte and keeps an accumulator (of the type it converts to) with the value of the bytes already converted. After every byte it tries to detect overflows by checking if the accumulator got smaller.\nThe problem is that this only works if the value added to the accumulator is less than the maximum value its type can hold. In cases where the added value is bigger, the accumulator can overflow and still end up larger than before.\n\nExample:\n\n``` rust\nu8::from_str(\"1000\");\n// byte 1: acc = 1,   old = 0\n// byte 2: acc = 10,  old = 1\n// byte 3: acc = 100, old = 10\n// byte 4: acc = 232, old = 100\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7588/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7588/timeline", "performed_via_github_app": null, "state_reason": "completed"}