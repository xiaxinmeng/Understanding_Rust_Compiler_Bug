{"url": "https://api.github.com/repos/rust-lang/rust/issues/63643", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63643/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63643/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63643/events", "html_url": "https://github.com/rust-lang/rust/issues/63643", "id": 481772419, "node_id": "MDU6SXNzdWU0ODE3NzI0MTk=", "number": 63643, "title": "Audit sources of shared state across rustc", "user": {"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 849077850, "node_id": "MDU6TGFiZWw4NDkwNzc4NTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/WG-compiler-performance", "name": "WG-compiler-performance", "color": "c2e0c6", "default": false, "description": "Working group: Compiler Performance"}, {"id": 891133401, "node_id": "MDU6TGFiZWw4OTExMzM0MDE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-parallel-queries", "name": "A-parallel-queries", "color": "f7e101", "default": false, "description": "Area: Parallel query execution"}], "state": "open", "locked": false, "assignee": {"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "aturon", "id": 709807, "node_id": "MDQ6VXNlcjcwOTgwNw==", "avatar_url": "https://avatars.githubusercontent.com/u/709807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aturon", "html_url": "https://github.com/aturon", "followers_url": "https://api.github.com/users/aturon/followers", "following_url": "https://api.github.com/users/aturon/following{/other_user}", "gists_url": "https://api.github.com/users/aturon/gists{/gist_id}", "starred_url": "https://api.github.com/users/aturon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aturon/subscriptions", "organizations_url": "https://api.github.com/users/aturon/orgs", "repos_url": "https://api.github.com/users/aturon/repos", "events_url": "https://api.github.com/users/aturon/events{/privacy}", "received_events_url": "https://api.github.com/users/aturon/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2019-08-16T20:25:56Z", "updated_at": "2019-09-05T20:03:08Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Infrastructure for parallel compilation has landed in rustc, but the shared state involved has not been fully documented (in terms of what state exists, invariants, atomicity, lock ordering, etc) or assessed for removal by refactoring.\r\n\r\nThis issue tracks the PR history for parallelization infrastructure, which is being re-audited to seed an initial list of shared state to assess. The initial output of the audit is [this paper doc](https://paper.dropbox.com/doc/rustc-shared-state-audit--Ai__733hU70wACu6fchZrhFMAg-zsOrKjkMZbBYZJWhgXPke), which will ultimately be turned into a set of individual issues.\r\n\r\n### PR List\r\n\r\n- [x] #46709\r\n- [x] #46779\r\n- [x] #47906\r\n- [x] #48586\r\n- [x] #48587\r\n- [x] #48690\r\n- [x] #48691\r\n- [x] #48808\r\n- [x] #48811\r\n- [x] #48904\r\n- [x] #48936\r\n- [x] #49030\r\n- [ ] #49045 - make queries thread-safe\r\n- [x] #49349\r\n- [x] #49396\r\n- [x] #49558\r\n- [ ] #49732 - make incremental compilation thread-safe\r\n- [x] #49834 - Make SelectionCache and EvaluationCache thread-safe\r\n- [ ] #49882 -  More thread-safety changes\r\n- [ ] #49894 - Rename InternedString to LocalInternedString and introduce a new thread-safe InternedString\r\n- [x] #50108 - Make GlobalCtxt thread-safe\r\n- [x] #50699 - Blocking Rayon queries\r\n- [x] #51383 - Run some stuff in parallel\r\n- [x] #51487 - Make more passes incremental\r\n- [x] #56614 - Replace LockCell with atomic types\r\n- [x] #56946 - Add support for using a jobserver with Rayon\r\n- [x] #57065 - Optimize try_mark_green and eliminate the lock on dep node colors\r\n- [x] #57232 - Parallelize and optimize parts of HIR map creation\r\n- [x] #57308 - Make CompileController thread-safe\r\n- [x] #58010 - Move privacy checking later in the pipeline and make some passes run in parallel\r\n- [x] #58019  - Combine all builtin late lints and make lint checking parallel\r\n- [x] #58679 - Refactor passes and pass execution to be more parallel\r\n- [x] #59540 -  Use arenas to avoid Lrc in queries #1\r\n- [x] #59545 - Use arenas to avoid Lrc in queries #2\r\n- [x] #59804  - Clean up jobserver integration\r\n- [x] #59809 - Make trait_methods_not_found use a lock\r\n\r\n### Issue creation\r\n\r\n- [ ] Issues created for individual pieces of state, together with a tracking issue", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63643/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63643/timeline", "performed_via_github_app": null, "state_reason": null}