{"url": "https://api.github.com/repos/rust-lang/rust/issues/71499", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/71499/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/71499/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/71499/events", "html_url": "https://github.com/rust-lang/rust/issues/71499", "id": 606095708, "node_id": "MDU6SXNzdWU2MDYwOTU3MDg=", "number": 71499, "title": "Tracking Issue for making ptr offset methods \"const fn\"", "user": {"login": "josephlr", "id": 5506060, "node_id": "MDQ6VXNlcjU1MDYwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5506060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephlr", "html_url": "https://github.com/josephlr", "followers_url": "https://api.github.com/users/josephlr/followers", "following_url": "https://api.github.com/users/josephlr/following{/other_user}", "gists_url": "https://api.github.com/users/josephlr/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephlr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephlr/subscriptions", "organizations_url": "https://api.github.com/users/josephlr/orgs", "repos_url": "https://api.github.com/users/josephlr/repos", "events_url": "https://api.github.com/users/josephlr/events{/privacy}", "received_events_url": "https://api.github.com/users/josephlr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 268744493, "node_id": "MDU6TGFiZWwyNjg3NDQ0OTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-fn", "name": "A-const-fn", "color": "f7e101", "default": false, "description": "Area: const fn foo(..) {..}. Pure functions which can be applied at compile time."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 919710011, "node_id": "MDU6TGFiZWw5MTk3MTAwMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-merge", "name": "disposition-merge", "color": "008800", "default": false, "description": "This issue / PR is in PFCP or FCP with a disposition to merge it."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-04-24T07:14:47Z", "updated_at": "2022-03-31T15:11:16Z", "closed_at": "2022-03-27T09:19:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The feature gate for this is `#![feature(const_ptr_offset)]`. Miri has been able to handle this for some time. This feature allows code like:\r\n```rust\r\nstatic FOO: u8 = 42;\r\nstatic PTR1: *const u8 = &FOO as *const u8;\r\nstatic PTR2: *const u8 = PTR1.wrapping_offset(1);\r\n```\r\n\r\n- The following intrinsic functions will be made `const fn`:\r\n  - [`intrinsics::offset`](https://doc.rust-lang.org/stable/core/intrinsics/fn.offset.html)\r\n  - [`intrinsics::arith_offset`](https://doc.rust-lang.org/stable/core/intrinsics/fn.arith_offset.html)\r\n- The allows the following `*const`/`*mut` methods to be `const fn`:\r\n  - [`offset`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.offset)\r\n  - [`wrapping_offset`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.wrapping_offset)\r\n  - [`add`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.add)/[`sub`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.sub)\r\n  - [`wrapping_add`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.wrapping_add)/[`wrapping_sub`](https://doc.rust-lang.org/stable/std/primitive.pointer.html#method.wrapping_sub)\r\n\r\n- The following methods are **not** part of this issue:\r\n  - `align_offset`: See #62420\r\n  - `offset_from`: Tracked as part of #41079 and https://github.com/rust-lang/rust/issues/92980\r\n  - `wrapping_offset_from`: Not possible across different allocations\r\n  - Any read/write methods: Tracked in #51911\r\n\r\n### Steps (based on #69821)\r\n- [x] Implemented in #71500\r\n- [ ] Check if any other `core`/`alloc`/`std` functions should be made const along with this.\r\n- [x] Remove[ miri's implementations for `offset` and `arith_offset`](https://github.com/rust-lang/miri/blob/52f5d202bdcfe8986f0615845f8d1647ab8a2c6a/src/shims/intrinsics.rs#L96-L112)\r\n- [ ] Final commenting period (FCP): https://github.com/rust-lang/rust/issues/71499#issuecomment-1062913168\r\n- [ ] Stabilization PR\r\n\r\n[stabilization-guide]: https://rustc-dev-guide.rust-lang.org/stabilization_guide.html#stabilization-pr\r\n\r\n### Unresolved Questions\r\n\r\n-  How should `offset == 0` be handled?\r\n   - As implemented, we allow offsets of 0 for all pointers (including dangling pointers) except for null pointers.\r\n   - Should we allow offsets of 0 for null pointers?\r\n   - The documentation is a bit unclear on this, see: #65108 and [@RalfJung's comment](https://github.com/rust-lang/rust/issues/65108#issuecomment-540076878)\r\n\r\nCC: @RalfJung @oli-obk @rust-lang/wg-const-eval ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/71499/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/71499/timeline", "performed_via_github_app": null, "state_reason": "completed"}