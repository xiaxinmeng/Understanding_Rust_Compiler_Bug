{"url": "https://api.github.com/repos/rust-lang/rust/issues/86865", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/86865/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/86865/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/86865/events", "html_url": "https://github.com/rust-lang/rust/issues/86865", "id": 936485243, "node_id": "MDU6SXNzdWU5MzY0ODUyNDM=", "number": 86865, "title": "Improvement to write! macro with wrong type for string literal argument", "user": {"login": "insanitybit", "id": 4956357, "node_id": "MDQ6VXNlcjQ5NTYzNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4956357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/insanitybit", "html_url": "https://github.com/insanitybit", "followers_url": "https://api.github.com/users/insanitybit/followers", "following_url": "https://api.github.com/users/insanitybit/following{/other_user}", "gists_url": "https://api.github.com/users/insanitybit/gists{/gist_id}", "starred_url": "https://api.github.com/users/insanitybit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/insanitybit/subscriptions", "organizations_url": "https://api.github.com/users/insanitybit/orgs", "repos_url": "https://api.github.com/users/insanitybit/repos", "events_url": "https://api.github.com/users/insanitybit/events{/privacy}", "received_events_url": "https://api.github.com/users/insanitybit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "ibraheemdev", "id": 34988408, "node_id": "MDQ6VXNlcjM0OTg4NDA4", "avatar_url": "https://avatars.githubusercontent.com/u/34988408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibraheemdev", "html_url": "https://github.com/ibraheemdev", "followers_url": "https://api.github.com/users/ibraheemdev/followers", "following_url": "https://api.github.com/users/ibraheemdev/following{/other_user}", "gists_url": "https://api.github.com/users/ibraheemdev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibraheemdev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibraheemdev/subscriptions", "organizations_url": "https://api.github.com/users/ibraheemdev/orgs", "repos_url": "https://api.github.com/users/ibraheemdev/repos", "events_url": "https://api.github.com/users/ibraheemdev/events{/privacy}", "received_events_url": "https://api.github.com/users/ibraheemdev/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "ibraheemdev", "id": 34988408, "node_id": "MDQ6VXNlcjM0OTg4NDA4", "avatar_url": "https://avatars.githubusercontent.com/u/34988408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibraheemdev", "html_url": "https://github.com/ibraheemdev", "followers_url": "https://api.github.com/users/ibraheemdev/followers", "following_url": "https://api.github.com/users/ibraheemdev/following{/other_user}", "gists_url": "https://api.github.com/users/ibraheemdev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibraheemdev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibraheemdev/subscriptions", "organizations_url": "https://api.github.com/users/ibraheemdev/orgs", "repos_url": "https://api.github.com/users/ibraheemdev/repos", "events_url": "https://api.github.com/users/ibraheemdev/events{/privacy}", "received_events_url": "https://api.github.com/users/ibraheemdev/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-07-04T15:43:48Z", "updated_at": "2021-09-11T06:30:36Z", "closed_at": "2021-09-11T06:30:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nGiven the following code: \r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=4c5ff2fc026afd1a666633cba4c31865\r\n\r\n```rust\r\npub fn example(f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\r\n    write!(f, b\"Foo{}\", \"bar\")\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror: format argument must be a string literal\r\n --> src/lib.rs:4:15\r\n   |\r\n4 |     write!(f, b\"Foo{}\", \"bar\")\r\n   |               ^^^^^^^^\r\n   |\r\nhelp: you might be missing a string literal to format with\r\n   |\r\n4 |     write!(f, \"{} {}\", b\"Foo{}\", \"bar\")\r\n```\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the output should look like:\r\n\r\n```\r\n error: format argument must be a string literal, **found byte literal**\r\n  --> src/lib.rs:4:15\r\n   |\r\n 4 |     write!(f, b\"Foo{}\", \"bar\")\r\n   |               ^^^^^^^^\r\n   |\r\n help: you might be missing a string literal to format with\r\n   |\r\n4 |     write!(f, \"{} {}\", b\"Foo{}\", \"bar\")\r\n help: you may have meant to pass in a string literal instead of a byte literal\r\n   |\r\n 4 |     write!(f, b\"Foo{}\", \"bar\")\r\n  |               ^ try removing this 'b'\r\n4 |     write!(f, \"Foo{}\", \"bar\")\r\n```\r\n\r\nSo this is super trivial, but I just ran into this and I haven't used `write!` in a while so I sorta did a double take and it took me a second to figure out why it was suggesting what it was suggesting.\r\n\r\nI was just refactoring some code that had used a byte literal beforehand. Two things would help:\r\n\r\n1. Telling me that I passed in a byte literal where a string literal was expected (or whatever else - right now it only says what's expected, not what was provided). IMO this alone would have been a big help and I would have spent 0 cycles thinking about what the problem could be.\r\n\r\n2. Since this is, to a human, clearly a case where I intended the byte literal to be the format string, in an ideal world that would be pointed out to me. I realize that this is open to interpretation - is it \"clearly\" the case because it's a byte literal? Or a byte literal with {}? IDK! Food for thought.\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"ibraheemdev\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/86865/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/86865/timeline", "performed_via_github_app": null, "state_reason": "completed"}