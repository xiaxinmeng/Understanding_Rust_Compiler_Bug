{"url": "https://api.github.com/repos/rust-lang/rust/issues/42516", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42516/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42516/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42516/events", "html_url": "https://github.com/rust-lang/rust/issues/42516", "id": 234346454, "node_id": "MDU6SXNzdWUyMzQzNDY0NTQ=", "number": 42516, "title": "tracking issue for lifetime inference error work (E0495)", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 37977651, "node_id": "MDU6TGFiZWwzNzk3NzY1MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/metabug", "name": "metabug", "color": "5319e7", "default": false, "description": "Issues about issues themselves (\"bugs about bugs\")"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 693665463, "node_id": "MDU6TGFiZWw2OTM2NjU0NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/WG-diagnostics", "name": "WG-diagnostics", "color": "c2e0c6", "default": false, "description": "Working group: diagnostics"}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2017-06-07T21:20:28Z", "updated_at": "2022-04-22T14:38:43Z", "closed_at": "2022-04-22T14:38:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a general tracking issue for the work on improving lifetime errors (in particular the \"cannot infer lifetime\" error E0495, but also including other errors). This is a rather large project, since there are many different classes of errors, so part of the work is finding scenarios and making more targeted error messages for them.\r\n\r\nIn general, I am trying to track errors and brainstorm here. There is also [an etherpad](https://public.etherpad-mozilla.org/p/rust-lifetime-errors) where I have done some note-taking.\r\n\r\n### Current road-map\r\n\r\nThe plan is to have three major kinds of errors, delivered in order of preference. The basic work here is done, but there remain gaps to be covered. If you're interested in helping out, check out the issues associated with the unchecked check boxes!\r\n\r\n- [x] \"explicit lifetime required\" ([example](https://play.rust-lang.org/?gist=eb0993356985fba112f48b31641781ec&version=nightly))\r\n    - these are cases where the user has an explicit lifetime name, but they need to use it in more places\r\n    - [ ] https://github.com/rust-lang/rust/issues/42700 -- we don't handle the case where the anonymous lifetime appears in `self` very well\r\n- [x] https://github.com/rust-lang/rust/issues/42703 -- \"this parameter and the return type are declared with different lifetimes...\" (https://github.com/rust-lang/rust/pull/44124)\r\n- [x] \"these two types are declared with different lifetimes...\" ([example](https://play.rust-lang.org/?gist=4ebb108e6c0bd5c67d45d44736deac6c&version=nightly))\r\n    - This is a sort of fallback. It covers all kinds of cases.\r\n    - [x] https://github.com/rust-lang/rust/issues/44508 -- it doesn't work on lifetimes in structs\r\n    - In particular, the goal with the base message is just to *describe what the problem is* without suggesting a particular solution. We then want to consider various extensions where we can propose a fix:\r\n        - [ ] Suggest a new signature (https://github.com/rust-lang/rust/issues/44506)\r\n        - [ ] Suggest adding a where clause when there are already two named lifetimes (https://github.com/rust-lang/rust/issues/44507)\r\n        - We have to be careful in the above cases around methods appearing in an impl of a trait, since the user may not have freedom to change the signature. Here are some cases:\r\n            - [ ] https://github.com/rust-lang/rust/issues/42706 -- impl does not use the same signature as declared in the trait\r\n- Cross-cutting concerns:\r\n    - [x] Handle `SubSup`-style errors and not just concrete failures (https://github.com/rust-lang/rust/issues/42701)\r\n    - [x] https://github.com/rust-lang/rust/issues/43276 -- double-check behavior in case with more binders\r\n- [x]  Higher-ranked closure error messages should avoid \"anonymous lifetime #2 defined on the body\" #45983 \r\n- [x] smarter blame assignment for lifetime inference errors #45979 \r\n\r\n### Examples in need of analysis\r\n\r\n- [ ] https://github.com/rust-lang/rust/issues/42574 -- weird interaction with closures and `&'static` arguments\r\n\r\n### Future plans\r\n\r\n- [ ] Improve how lifetime inference selects which edges in the region inference graph are at fault. The code for finding the *regions that conflict* seems to work quite well -- but the code to select which edges to blame is hopeless. I think we need to look specifically for cases where the user \"puts things in tension\" (e.g., `foo(a)` puts the formal declarations of `foo` in tension with the type of `a`). I'll try to write up these thoughts in a bit more detail later.\r\n\r\n### Other issues\r\n\r\nHere are various issues that I have subsumed into this one. These are a checklist because I want to go over them and extract any key examples into this issue and then close them. Feel free to do so (in the comments).\r\n\r\n- [x] https://github.com/rust-lang/rust/issues/40900\r\n- [ ] https://github.com/rust-lang/rust/issues/33529\r\n- [x] https://github.com/rust-lang/rust/issues/30387\r\n- [x] https://github.com/rust-lang/rust/issues/13998 -- this needs to be verified, maybe out of date\r\n- [ ] https://github.com/rust-lang/rust/issues/40990\r\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42516/reactions", "total_count": 6, "+1": 0, "-1": 0, "laugh": 0, "hooray": 2, "confused": 0, "heart": 4, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42516/timeline", "performed_via_github_app": null, "state_reason": "completed"}