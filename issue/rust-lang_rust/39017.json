{"url": "https://api.github.com/repos/rust-lang/rust/issues/39017", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39017/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39017/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39017/events", "html_url": "https://github.com/rust-lang/rust/issues/39017", "id": 200409905, "node_id": "MDU6SXNzdWUyMDA0MDk5MDU=", "number": 39017, "title": "1.13.0 armhf stage0 segfaults when building 1.14.0", "user": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-01-12T16:14:05Z", "updated_at": "2017-01-13T10:38:11Z", "closed_at": "2017-01-13T10:38:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "No logs available, I ran this manually on [harris.debian.org](https://db.debian.org/machines.cgi?host=harris). This machine has NEON enabled, to work around #36913. But it should produce 1.14.0 armhf host binaries that don't need NEON (as discussed in #35590).\r\n\r\nThis is after applying #38650 and #38675; The LLVM diff between Debian vs Rust is [here](https://gist.github.com/infinity0/873566481db105fea47630da88e1b632).\r\n\r\nThere are some ARM-related LLVM patches that we haven't yet applied in Debian (see [here](https://gist.github.com/infinity0/873566481db105fea47630da88e1b632)), however this error is in the stage0 compiler so it is probably not Debian-specific. (Though it could be that the stage0 compiler itself is buggy, and needs to be recompiled with these LLVM patches.)\r\n\r\n~~~~\r\nCFG_LLVM_LINKAGE_FILE=/home/infinity0/rustc/armv7-unknown-linux-gnueabihf/rt/llvmdeps.rs LD_LIBRARY_PATH=/home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/lib:/usr/lib/llvm-3.9/lib:$LD_LIBRARY_PATH   armv7-unknown-linux-gnueabihf/stage0/bin/rustc --cfg stage0 -C link-args=-Wl,-z,relro -O --cfg rtopt -Cdebuginfo=1 -C rpath -C prefer-dynamic -C no-stack-check --target=armv7-unknown-linux-gnueabihf   -L \"armv7-unknown-linux-gnueabihf/rt\" -L native=\"/usr/lib/llvm-3.9/lib\"     --out-dir armv7-unknown-linux-gnueabihf/stage0/lib/rustlib/armv7-unknown-linux-gnueabihf/lib -C extra-filename=-f5a209a9 -C metadata=f5a209a9 src/libcore/lib.rs\r\nwarning: this feature has been stable since 1.14.0. Attribute no longer needed, #[warn(stable_features)] on by default\r\n  --> src/libcore/lib.rs:92:29\r\n   |\r\n92 | #![cfg_attr(stage0, feature(question_mark))]\r\n   |                             ^^^^^^^^^^^^^\r\n\r\nSegmentation fault\r\n/home/infinity0/rustc/mk/target.mk:191: recipe for target 'armv7-unknown-linux-gnueabihf/stage0/lib/rustlib/armv7-unknown-linux-gnueabihf/lib/stamp.core' failed\r\n~~~~\r\n\r\nRe-running manually for a stack trace:\r\n\r\n~~~~\r\nrustc$ RUSTC_BOOTSTRAP=1 RUSTC_BOOTSTRAP_KEY=62b3e239 CFG_LLVM_LINKAGE_FILE=/home/infinity0/rustc/armv7-unknown-linux-gnueabihf/rt/llvmdeps.rs LD_LIBRARY_PATH=/home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/lib:/usr/lib/llvm-3.9/lib:$LD_LIBRARY_PATH  gdb armv7-unknown-linux-gnueabihf/stage0/bin/rustc\r\nGNU gdb (Debian 7.12-4) 7.12\r\n[..]\r\n(gdb) run --cfg stage0 -C link-args=-Wl,-z,relro -O --cfg rtopt -Cdebuginfo=1 -C rpath -C prefer-dynamic -C no-stack-check --target=armv7-unknown-linux-gnueabihf   -L \"armv7-unknown-linux-gnueabihf/rt\" -L native=\"/usr/lib/llvm-3.9/lib\"     --out-dir armv7-unknown-linux-gnueabihf/stage0/lib/rustlib/armv7-unknown-linux-gnueabihf/lib -C extra-filename=-f5a209a9 -C metadata=f5a209a9 src/libcore/lib.rs\r\nStarting program: /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/rustc --cfg stage0 -C link-args=-Wl,-z,relro -O --cfg rtopt -Cdebuginfo=1 -C rpath -C prefer-dynamic -C no-stack-check --target=armv7-unknown-linux-gnueabihf   -L \"armv7-unknown-linux-gnueabihf/rt\" -L native=\"/usr/lib/llvm-3.9/lib\"     --out-dir armv7-unknown-linux-gnueabihf/stage0/lib/rustlib/armv7-unknown-linux-gnueabihf/lib -C extra-filename=-f5a209a9 -C metadata=f5a209a9 src/libcore/lib.rs\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/arm-linux-gnueabihf/libthread_db.so.1\".\r\n[New Thread 0xb3dff270 (LWP 15815)]\r\nwarning: this feature has been stable since 1.14.0. Attribute no longer needed, #[warn(stable_features)] on by default\r\n  --> src/libcore/lib.rs:92:29\r\n   |\r\n92 | #![cfg_attr(stage0, feature(question_mark))]\r\n   |                             ^^^^^^^^^^^^^\r\n\r\n\r\nThread 2 \"rustc\" received signal SIGSEGV, Segmentation fault.\r\n[Switching to Thread 0xb3dff270 (LWP 15815)]\r\n0xb51a2974 in llvm::LiveRangeEdit::scanRemattable(llvm::AAResults*) () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n(gdb) bt\r\n#0  0xb51a2974 in llvm::LiveRangeEdit::scanRemattable(llvm::AAResults*) () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#1  0xb51a29ee in llvm::LiveRangeEdit::anyRematerializable(llvm::AAResults*) () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#2  0xb528c72e in llvm::SplitEditor::reset(llvm::LiveRangeEdit&, llvm::SplitEditor::ComplementSpillMode) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#3  0xb5247154 in (anonymous namespace)::RAGreedy::selectOrSplitImpl(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&, llvm::SmallSet<unsigned int, 16u, std::less<unsigned int> >&, unsigned int) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#4  0xb52465e2 in (anonymous namespace)::RAGreedy::selectOrSplitImpl(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&, llvm::SmallSet<unsigned int, 16u, std::less<unsigned int> >&, unsigned int) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#5  0xb52465e2 in (anonymous namespace)::RAGreedy::selectOrSplitImpl(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&, llvm::SmallSet<unsigned int, 16u, std::less<unsigned int> >&, unsigned int) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#6  0xb52465e2 in (anonymous namespace)::RAGreedy::selectOrSplitImpl(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&, llvm::SmallSet<unsigned int, 16u, std::less<unsigned int> >&, unsigned int) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#7  0xb52465e2 in (anonymous namespace)::RAGreedy::selectOrSplitImpl(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&, llvm::SmallSet<unsigned int, 16u, std::less<unsigned int> >&, unsigned int) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#8  0xb5247992 in (anonymous namespace)::RAGreedy::selectOrSplit(llvm::LiveInterval&, llvm::SmallVectorImpl<unsigned int>&) ()\r\n   from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#9  0xb523a9a0 in llvm::RegAllocBase::allocatePhysRegs() () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#10 0xb5244c54 in (anonymous namespace)::RAGreedy::runOnMachineFunction(llvm::MachineFunction&) () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\n#11 0xb51da24a in llvm::MachineFunctionPass::runOnFunction(llvm::Function&) () from /home/infinity0/rustc/armv7-unknown-linux-gnueabihf/stage0/bin/../lib/../lib/librustc_llvm-91a6b62b230b4784.so\r\nBacktrace stopped: previous frame identical to this frame (corrupt stack?)\r\n(gdb) \r\n\r\n~~~~\r\n", "closed_by": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39017/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39017/timeline", "performed_via_github_app": null, "state_reason": "completed"}