{"url": "https://api.github.com/repos/rust-lang/rust/issues/77585", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77585/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77585/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77585/events", "html_url": "https://github.com/rust-lang/rust/issues/77585", "id": 715051077, "node_id": "MDU6SXNzdWU3MTUwNTEwNzc=", "number": 77585, "title": "Panic in Firefox (rusqlite/lru_cache/linked_hash_map) built with recent Rust nightlies", "user": {"login": "valpackett", "id": 208340, "node_id": "MDQ6VXNlcjIwODM0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/208340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/valpackett", "html_url": "https://github.com/valpackett", "followers_url": "https://api.github.com/users/valpackett/followers", "following_url": "https://api.github.com/users/valpackett/following{/other_user}", "gists_url": "https://api.github.com/users/valpackett/gists{/gist_id}", "starred_url": "https://api.github.com/users/valpackett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/valpackett/subscriptions", "organizations_url": "https://api.github.com/users/valpackett/orgs", "repos_url": "https://api.github.com/users/valpackett/repos", "events_url": "https://api.github.com/users/valpackett/events{/privacy}", "received_events_url": "https://api.github.com/users/valpackett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-10-05T18:06:09Z", "updated_at": "2020-10-07T14:22:04Z", "closed_at": "2020-10-07T14:07:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Firefox built with rustc 1.49.0-nightly (beb5ae474 2020-10-04) on FreeBSD/amd64 crashes very quickly with this:\r\n\r\n```\r\n* thread #1, name = 'BgIOThreadPool #2', stop reason = signal SIGSEGV\r\n\u2026\r\n    frame #15: 0x000000080f38e698 libxul.so`core::panicking::panic::h68b0075d98bb8971 at panicking.rs:50:5\r\n    frame #16: 0x000000080ea3f47c libxul.so`linked_hash_map::LinkedHashMap$LT$K$C$V$C$S$GT$::ensure_guard_node::hf152f3bcf37aa17d [inlined] core::mem::uninitialized::h942e45808eca740e at mod.rs:659:9\r\n    frame #17: 0x000000080ea3f463 libxul.so`linked_hash_map::LinkedHashMap$LT$K$C$V$C$S$GT$::ensure_guard_node::hf152f3bcf37aa17d(self=<unavailable>) at lib.rs:174\r\n    frame #18: 0x000000080ea3f59e libxul.so`linked_hash_map::LinkedHashMap$LT$K$C$V$C$S$GT$::insert::h1840c6a0a3863e66(self=0x000000083ab36750, k=Arc<str> @ 0x00007fffd6768f98, v=RawStatement @ 0x00007fffd6768ff0) at lib.rs:304:9\r\n    frame #19: 0x000000080ea39585 libxul.so`lru_cache::LruCache$LT$K$C$V$C$S$GT$::insert::hb5c3cb3e465236d8(self=0x000000083ab36750, k=<unavailable>, v=<unavailable>) at lib.rs:119:23\r\n    frame #20: 0x000000080ea417c2 libxul.so`rusqlite::cache::StatementCache::cache_stmt::h5b1d9082df40c120(self=<unavailable>, stmt=RawStatement @ 0x00007fffd6769140) at cache.rs:149:13\r\n    frame #21: 0x000000080ea41403 libxul.so`_$LT$rusqlite..cache..CachedStatement$u20$as$u20$core..ops..drop..Drop$GT$::drop::h6046c68aae8bc005(self=<unavailable>) at cache.rs:87:13\r\n    frame #22: 0x000000080d75025f libxul.so`core::ptr::drop_in_place::h4eb54bda8caf00cd((null)=0x00007fffd6769330) at mod.rs:175:1\r\n    frame #23: 0x000000080d74fbff libxul.so`sql_support::conn_ext::ConnExt::execute_named_cached::h09f5e419dbd12fc4(self=<unavailable>, sql=<unavailable>, params=&[(&str, &ToSql)] @ 0x0000000a7d679590) at conn_ext.rs:78:5\r\n    frame #24: 0x000000080d755d01 libxul.so`webext_storage::db::put_meta::h98717a8131394191(db=<unavailable>, key=(data_ptr = \"\", length = 14), value=<unavailable>) at db.rs:176:5\r\n    frame #25: 0x000000080d7470d4 libxul.so`_$LT$webext_storage..sync..bridge..BridgedEngine$u20$as$u20$sync15_traits..bridged_engine..BridgedEngine$GT$::set_last_sync::h2e5c6e50ce8664c2(self=<unavailable>, last_sync_millis=0) at bridge.rs:50:9\r\n    frame #26: 0x000000080d72c014 libxul.so`_$LT$webext_storage_bridge..store..LazyStore$u20$as$u20$sync15_traits..bridged_engine..BridgedEngine$GT$::set_last_sync::hf753dca2d35a20d4(self=<unavailable>, last_sync_millis=0) at store.rs:146:12\r\n    frame #27: 0x000000080d729bef libxul.so`golden_gate::task::FerryTask$LT$N$GT$::inner_run::h45ad2dd4388f3741(self=<unavailable>) at task.rs:223:17\r\n    frame #28: 0x000000080d72ae3b libxul.so`_$LT$golden_gate..task..FerryTask$LT$N$GT$$u20$as$u20$moz_task..Task$GT$::run::h543514311cc308d3(self=0x000000083a29b6a0) at task.rs:265:37\r\n    frame #29: 0x000000080e9ea752 libxul.so`moz_task::TaskRunnable::run::hf300adf99dd3a70a(self=0x0000000833cde300) at lib.rs:219:17\r\n    frame #30: 0x000000080e9eabb9 libxul.so`moz_task::TaskRunnable::Run::hbca50f12f2b5c3ee(self=<unavailable>) at method.rs:204:19\r\n    frame #31: 0x000000080e9ea9bd libxul.so`moz_task::TaskRunnable::allocate::Run::hd242ffa8e19937f7(this=0x0000000833cde300) at lib.rs:163:10\r\n    frame #32: 0x0000000808d8e397 libxul.so`mozilla::TaskQueue::Runner::Run(this=0x00000008394db180) at TaskQueue.cpp:158:20\r\n    frame #33: 0x0000000808d9ae3e libxul.so`nsThreadPool::Run(this=<unavailable>) at nsThreadPool.cpp:299:14\r\n\u2026\r\n```\r\n\r\nI think the previous nightly before that had the issue too, but it's a recent issue, whatever I was using before the last couple upgrades (probably something from September) was fine. Switching to stable fixed the issue.\r\n\r\n(doing a debug build now)", "closed_by": {"login": "valpackett", "id": 208340, "node_id": "MDQ6VXNlcjIwODM0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/208340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/valpackett", "html_url": "https://github.com/valpackett", "followers_url": "https://api.github.com/users/valpackett/followers", "following_url": "https://api.github.com/users/valpackett/following{/other_user}", "gists_url": "https://api.github.com/users/valpackett/gists{/gist_id}", "starred_url": "https://api.github.com/users/valpackett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/valpackett/subscriptions", "organizations_url": "https://api.github.com/users/valpackett/orgs", "repos_url": "https://api.github.com/users/valpackett/repos", "events_url": "https://api.github.com/users/valpackett/events{/privacy}", "received_events_url": "https://api.github.com/users/valpackett/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77585/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77585/timeline", "performed_via_github_app": null, "state_reason": "completed"}