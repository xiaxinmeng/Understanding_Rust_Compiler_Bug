{"url": "https://api.github.com/repos/rust-lang/rust/issues/100397", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100397/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100397/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100397/events", "html_url": "https://github.com/rust-lang/rust/issues/100397", "id": 1335633909, "node_id": "I_kwDOAAsO6M5PnCf1", "number": 100397, "title": "PGO profile invalidation in `-Cprofile-use`", "user": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-08-11T08:26:46Z", "updated_at": "2022-08-11T09:39:52Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi! While working on https://github.com/Kobzol/cargo-pgo, I noticed a peculiar thing about the invalidation of the PGO profile path.\r\nWhen PGO is used for compiling, we specify the path to the PGO profile using `-Cprofile-use=<path>`. When `<path>` changes, it invalidates the compilation session, so the code is recompiled again (as it should be, if the profile changes).\r\n\r\nHowever, if the path stays the same, but the contents of the profile file change, the code will not be recompiled. That can be a footgun, since users might try to gather profiles incrementally and then try to compile/benchmark using the new profiles, but if the profile path stays the same (if it's just overwritten each time), they might not notice that the code is not recompiled and they thus might get stale results.\r\n\r\nWould it be feasible to check the hash/modification time of the profile file instead of just the file path, w.r.t. invalidating recompilation? Is there any prior art to this in some other Rust flags?\r\n\r\nI think that hashing the file wouldn't be such a bottleneck (I think that it was done for `sccache` [here](https://github.com/mozilla/sccache/pull/952)), unless it would have to be done by every `rustc` invocation instead of just once per Cargo run? :thinking: I don't think that `-Cprofile-use` is that common that this would cause perf. problems, but it could resolve a potential footgun.\r\n\r\nCC @michaelwoerister", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100397/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100397/timeline", "performed_via_github_app": null, "state_reason": null}