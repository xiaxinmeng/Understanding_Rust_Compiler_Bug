{"url": "https://api.github.com/repos/rust-lang/rust/issues/7587", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7587/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7587/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7587/events", "html_url": "https://github.com/rust-lang/rust/issues/7587", "id": 16379332, "node_id": "MDU6SXNzdWUxNjM3OTMzMg==", "number": 7587, "title": "rustc stack overflow when using polymorphically recursive type", "user": {"login": "rntz", "id": 16143, "node_id": "MDQ6VXNlcjE2MTQz", "avatar_url": "https://avatars.githubusercontent.com/u/16143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rntz", "html_url": "https://github.com/rntz", "followers_url": "https://api.github.com/users/rntz/followers", "following_url": "https://api.github.com/users/rntz/following{/other_user}", "gists_url": "https://api.github.com/users/rntz/gists{/gist_id}", "starred_url": "https://api.github.com/users/rntz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rntz/subscriptions", "organizations_url": "https://api.github.com/users/rntz/orgs", "repos_url": "https://api.github.com/users/rntz/repos", "events_url": "https://api.github.com/users/rntz/events{/privacy}", "received_events_url": "https://api.github.com/users/rntz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2013-07-04T19:43:15Z", "updated_at": "2013-08-21T21:11:48Z", "closed_at": "2013-08-21T21:11:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Compiling the following file:\n\n```\n// Type of complete binary trees with data at the leaves.\nenum Tree<T> {\n    Leaf(T),\n    Branch(~Tree<(T,T)>),\n}\n\nfn main () {\n  // a completely trivial use\n  let _x: Tree<int> = Leaf(5);\n}\n```\n\nResults in rustc running for a while and eventually aborting:\n\n```\n$ time rustc hang-polymorphic-recursion.rs\nzsh: abort      rustc hang-polymorphic-recursion.rs\nrustc hang-polymorphic-recursion.rs  5.97s user 0.83s system 99% cpu 6.811 total\n```\n\nUsing gdb, the cause of this appears to be an infinite recursion resulting in stack overflow. Setting RUST_MAX_STACK=48000 to limit the size of the backtrace, and omitting a bunch of lines in the middle, we get:\n\n```\n#0  0x00007ffff37d5545 in raise () from /lib64/libc.so.6\n#1  0x00007ffff37d69c8 in abort () from /lib64/libc.so.6\n#2  0x00007ffff5e138f6 in rust_task::new_stack (this=0x7fffec20cce0, \n    requested_sz=<optimized out>) at /home/rntz/s/rust/src/rt/rust_task.cpp:538\n#3  0x00007ffff5e24629 in __morestack ()\n   from /home/rntz/p/bin/../lib/librustrt.so\n#4  0x00007ffff5e15f00 in call_on_c_stack (fn_ptr=<optimized out>, \n    args=0x7ffff287d140, this=0x7fffec20cce0)\n    at /home/rntz/s/rust/src/rt/rust_task.h:481\n#5  new_stack_fast (requested_sz=2097152, this=0x7fffec20cce0)\n    at /home/rntz/s/rust/src/rt/rust_task.h:597\n#6  next_stack (args_sz=0, args_addr=0x7ffff287d1e0, stk_sz=<optimized out>, \n    this=0x7fffec20cce0) at /home/rntz/s/rust/src/rt/rust_task.h:540\n#7  upcall_new_stack (stk_sz=<optimized out>, args_addr=0x7ffff287d1e0, \n    args_sz=0) at /home/rntz/s/rust/src/rt/rust_upcall.cpp:323\n#8  0x00007ffff790f3ae in __morestack ()\n   from /home/rntz/p/bin/../lib/libstd-6c65cf4b443341b1-0.7.so\n#9  0x00007ffff61849ec in vec::with_capacity_22951::_e02e2fffb267a2c::_0$x2e7\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#10 0x00007ffff63225a4 in vec::__extensions__::map_40734::_af9d6bbe4c97e84::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#11 0x00007ffff634a99a in middle::ty::fold_sty::_54deb1bc56a6c17::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#12 0x00007ffff634a419 in middle::ty::fold_sty_to_ty::_cfbe63c86e51edca::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#13 0x00007ffff634be59 in middle::ty::fold_regions_and_ty::_f3996f94f24f218::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#14 0x00007ffff6372ed5 in middle::subst::__extensions__::meth_46035::effectfulSubst::_e77fdc2970e65b2::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#15 0x00007ffff637355b in middle::subst::__extensions__::effectfulSubst::anon::expr_fn_46046 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#16 0x00007ffff63225ce in vec::__extensions__::map_40734::_af9d6bbe4c97e84::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#17 0x00007ffff634e893 in middle::ty::fold_regions_and_ty::fold_substs::_1f3b6299fc26c43a::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#18 0x00007ffff634bd6c in middle::ty::fold_regions_and_ty::_f3996f94f24f218::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#19 0x00007ffff6372ed5 in middle::subst::__extensions__::meth_46035::effectfulSubst::_e77fdc2970e65b2::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#20 0x00007ffff637355b in middle::subst::__extensions__::effectfulSubst::anon::expr_fn_46046 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#21 0x00007ffff634a5e5 in middle::ty::fold_sty::_54deb1bc56a6c17::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#22 0x00007ffff634a419 in middle::ty::fold_sty_to_ty::_cfbe63c86e51edca::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#23 0x00007ffff634be59 in middle::ty::fold_regions_and_ty::_f3996f94f24f218::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#24 0x00007ffff6372ed5 in middle::subst::__extensions__::meth_46035::effectfulSubst::_e77fdc2970e65b2::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#25 0x00007ffff63734fb in middle::subst::__extensions__::effectfulSubst::anon::expr_fn_46044 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#26 0x00007ffff63225ce in vec::__extensions__::map_40734::_af9d6bbe4c97e84::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#27 0x00007ffff634b470 in middle::ty::fold_sig::_88677926f15b4cd8::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#28 0x00007ffff634bf1e in middle::ty::fold_regions_and_ty::_f3996f94f24f218::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#29 0x00007ffff6372ed5 in middle::subst::__extensions__::meth_46035::effectfulSubst::_e77fdc2970e65b2::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#30 0x00007ffff634f50f in middle::subst::__extensions__::meth_43986::subst::_e77fdc2970e65b2::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#31 0x00007ffff61ec983 in middle::ty::subst::_60764340192f4aa4::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#32 0x00007ffff636ad0d in middle::ty::substd_enum_variants::anon::expr_fn_45497\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#33 0x00007ffff636ab96 in vec::__extensions__::from_iterator_45483::_d92c4743c97fe764::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#34 0x00007ffff6317fab in middle::ty::substd_enum_variants::_eb876c23233c1d77::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#35 0x00007ffff6352909 in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#36 0x00007ffff6354b10 in middle::ty::type_contents::tc_mt::_fccf794e93a99779::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#37 0x00007ffff6352acb in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#38 0x00007ffff6352983 in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#39 0x00007ffff6354b10 in middle::ty::type_contents::tc_mt::_fccf794e93a99779::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#40 0x00007ffff6352acb in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#41 0x00007ffff6352983 in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#42 0x00007ffff6354b10 in middle::ty::type_contents::tc_mt::_fccf794e93a99779::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n    ...\n    ... MANY LINES OMITTED HERE ...\n    ...\n#5205 0x00007ffff6354b10 in middle::ty::type_contents::tc_mt::_fccf794e93a99779::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5206 0x00007ffff6352acb in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5207 0x00007ffff6352983 in middle::ty::type_contents::tc_ty::_7cc6d67baf8e7d7e::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5208 0x00007ffff62ad57f in middle::ty::type_contents::_d97cb6e18e2777dc::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5209 0x00007ffff6356948 in middle::ty::type_moves_by_default::_8790fe2979702bc7::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5210 0x00007ffff6779e54 in middle::moves::__extensions__::meth_88738::consume_expr::_80ad785c8e2f39d6::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5211 0x00007ffff677053f in middle::moves::compute_modes_for_expr::_536438e3f6ba19f::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5212 0x00007ffff6773239 in visit::default_visitor_88498::anon::expr_fn_88570\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5213 0x00007ffff677588a in visit::default_visitor_88498::anon::expr_fn_88630\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5214 0x00007ffff6773bdb in visit::default_visitor_88498::anon::expr_fn_88587\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5215 0x00007ffff67735cf in visit::default_visitor_88498::anon::expr_fn_88575\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5216 0x00007ffff6778b93 in visit::default_visitor_88498::anon::expr_fn_88677\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5217 0x00007ffff677161f in visit::default_visitor_88498::anon::expr_fn_88530\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5218 0x00007ffff677083a in visit::default_visitor_88498::anon::expr_fn_88501\n    () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5219 0x00007ffff676c694 in middle::moves::compute_moves::_21d0e5db50b085::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5220 0x00007ffff681cd6f in driver::driver::compile_rest::_962c67cf6f6b38e6::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5221 0x00007ffff6851774 in __morestack ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5222 0x00007ffff681ffec in driver::driver::compile_upto::_eb1a36cc59485b2::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5223 0x00007ffff6820385 in driver::driver::compile_input::_9d565d13a71137c::_0$x2e7 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5224 0x00007ffff683f6b3 in run_compiler::_5e2f8a97d6ae9ffb::_0$x2e7 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5225 0x00007ffff685149e in main::anon::expr_fn_99541 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5226 0x00007ffff684ef47 in monitor::anon::expr_fn_99366 ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5227 0x00007ffff684685b in task::__extensions__::try_98227::anon::expr_fn_98665 () from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5228 0x00007ffff6851774 in __morestack ()\n   from /home/rntz/p/bin/../lib/librustc-d3cb8c2ccd84a7a7-0.7.so\n#5229 0x00007ffff7897f01 in task::spawn::spawn_raw_oldsched::make_child_wrapper::anon::expr_fn_18364 ()\n   from /home/rntz/p/bin/../lib/libstd-6c65cf4b443341b1-0.7.so\n#5230 0x00007ffff790f3dc in __morestack ()\n   from /home/rntz/p/bin/../lib/libstd-6c65cf4b443341b1-0.7.so\n#5231 0x00007ffff5e13b9b in task_start_wrapper (a=0x7fffec20dc90)\n    at /home/rntz/s/rust/src/rt/rust_task.cpp:164\n#5232 0x0000000000000000 in ?? ()\n```\n", "closed_by": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7587/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7587/timeline", "performed_via_github_app": null, "state_reason": "completed"}