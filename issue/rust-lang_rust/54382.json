{"url": "https://api.github.com/repos/rust-lang/rust/issues/54382", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54382/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54382/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54382/events", "html_url": "https://github.com/rust-lang/rust/issues/54382", "id": 362100805, "node_id": "MDU6SXNzdWUzNjIxMDA4MDU=", "number": 54382, "title": "NLL: lost \"borrowed value needs to live until here\" (diagnostic regression compared to AST-borrowck)", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867465998, "node_id": "MDU6TGFiZWw4Njc0NjU5OTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-diagnostics", "name": "NLL-diagnostics", "color": "f799ea", "default": false, "description": "Working torwads the \"diagnostic parity\" goal"}], "state": "closed", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-09-20T09:36:37Z", "updated_at": "2018-11-15T15:40:16Z", "closed_at": "2018-11-15T15:40:16Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Spun off of my investigation of #21114, #54556 \r\n\r\nConsider this code ([play](https://play.rust-lang.org/?gist=4affed0d73a59d45a9922a17e15c7a9a&version=nightly&mode=debug&edition=2015 )):\r\n\r\n```rust\r\n#![cfg_attr(use_nll, feature(nll))]\r\n\r\nfn main() {\r\n    {\r\n        let mut _thing1 = D(Box::new(\"thing1\"));\r\n        D(\"other\").next(&_thing1)\r\n    }\r\n\r\n    ;\r\n}\r\n\r\n#[derive(Debug)]\r\nstruct D<T: std::fmt::Debug>(T);\r\n\r\nimpl<T: std::fmt::Debug>  Drop for D<T> {\r\n    fn drop(&mut self) {\r\n        println!(\"dropping {:?})\", self);\r\n    }\r\n}\r\n\r\nimpl<T: std::fmt::Debug> D<T> {\r\n    fn next<U: std::fmt::Debug>(&self, _other: U) -> D<U> { D(_other) }\r\n    fn end(&self) { }\r\n}\r\n```\r\n\r\nUnder AST-borrowck, this emits the diagnostics:\r\n\r\n```\r\nStandard Error\r\n\r\n   Compiling playground v0.0.1 (/playground)\r\nerror[E0597]: `_thing1` does not live long enough\r\n --> src/main.rs:6:26\r\n  |\r\n6 |         D(\"other\").next(&_thing1)\r\n  |                          ^^^^^^^ borrowed value does not live long enough\r\n7 |     }\r\n  |     - `_thing1` dropped here while still borrowed\r\n8 | \r\n9 |     ;\r\n  |     - borrowed value needs to live until here\r\n```\r\n\r\nunder NLL, it only emits this:\r\n\r\n```\r\nerror[E0597]: `_thing1` does not live long enough\r\n --> src/main.rs:6:25\r\n  |\r\n6 |         D(\"other\").next(&_thing1)\r\n  |                         ^^^^^^^^ borrowed value does not live long enough\r\n7 |     }\r\n  |     - `_thing1` dropped here while still borrowed\r\n```\r\n\r\nIn particular, the note 8 \"borrowed value needs to live until here\" that highlights the semi-colon after the end of the block is no longer emitted.\r\n\r\nMy current plan for addressing #54556 is to improve diagnostics. The first step in that path, IMO, would be to figure out how to bring back the note about how long the borrowed value needs to live.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54382/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54382/timeline", "performed_via_github_app": null, "state_reason": "completed"}