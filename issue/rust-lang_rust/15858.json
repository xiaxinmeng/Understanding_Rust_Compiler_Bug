{"url": "https://api.github.com/repos/rust-lang/rust/issues/15858", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15858/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15858/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15858/events", "html_url": "https://github.com/rust-lang/rust/issues/15858", "id": 38303370, "node_id": "MDU6SXNzdWUzODMwMzM3MA==", "number": 15858, "title": "ICE with destructor with type param with a lifetime", "user": {"login": "tomaka", "id": 1412254, "node_id": "MDQ6VXNlcjE0MTIyNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1412254?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomaka", "html_url": "https://github.com/tomaka", "followers_url": "https://api.github.com/users/tomaka/followers", "following_url": "https://api.github.com/users/tomaka/following{/other_user}", "gists_url": "https://api.github.com/users/tomaka/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomaka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomaka/subscriptions", "organizations_url": "https://api.github.com/users/tomaka/orgs", "repos_url": "https://api.github.com/users/tomaka/repos", "events_url": "https://api.github.com/users/tomaka/events{/privacy}", "received_events_url": "https://api.github.com/users/tomaka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-07-21T13:40:24Z", "updated_at": "2014-08-01T03:33:02Z", "closed_at": "2014-08-01T03:33:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This code triggers an ICE:\n\n``` rust\n#![feature(unsafe_destructor)]\n\n\ntrait Bar<'b> {\n    fn do_something(&mut self);\n}\n\nstruct BarImpl<'b>;\n\nimpl<'b> Bar<'b> for BarImpl<'b> {\n    fn do_something(&mut self) {}\n}\n\n\nstruct Foo<B>;\n\n#[unsafe_destructor]\nimpl<'b, B: Bar<'b>> Drop for Foo<B> {\n    fn drop(&mut self) {}\n}\n\n\nfn main() {\n    // note: the call to unitialized() is not important, it's just here\n    // because the destructor needs to be called for the ICE to trigger\n    let x: Foo<BarImpl> = unsafe { std::mem::uninitialized() };\n}\n```\n\nMessage:\n\n```\n<anon>:1:1: 1:1 error: internal compiler error: Type parameter out of range when substituting in region 'b (root type=None)\n<anon>:1 #![feature(unsafe_destructor)]\n         ^\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /build/rust-git/src/rust/src/libsyntax/diagnostic.rs:115\n```\n\nI'm using today's nightly: `rustc 0.12.0-pre-nightly (5e0a597a1a15e36ac7d855ca400e5add9d86716b 2014-07-20 01:06:36 +0000)`\n\n```\n#0  0x61f88160 in rust_fail ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#1  0x61f889e1 in unwind::begin_unwind_inner::h4fffee852aa633cckJd ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#2  0x009592ca in _fu2550___ZN4heap5EMPTY20h1bc6e42db9ab7eee8baE ()\n   from C:\\Compilation\\Rust\\bin\\syntax-4e7c5e5c.dll\n#3  0x00959255 in diagnostic::SpanHandler::span_bug::hfc98dc31cc92aee7f2C ()\n   from C:\\Compilation\\Rust\\bin\\syntax-4e7c5e5c.dll\n#4  0x710b0efa in driver::session::Session::span_bug::hd325d65657ade8dcPox ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#5  0x712b77fb in _fu110___ZN6to_str10T.ToString9to_string15__STATIC_FMTSTR20h61\n3140a9ab0b6801GtdE () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#6  0x712b8578 in middle::ty_fold::VecPerParamSpace$LT$T$GT$.TypeFoldable::fold_\nwith::closure.$x22closure$x22$LP$115430$RP$ ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#7  0x712b7ae0 in _fu972___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#8  0x712b78f4 in middle::ty_fold::TypeFolder::fold_substs::h1606627659973584159\n5 () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#9  0x71436650 in middle::subst::T.Subst::subst_spanned::h794027968757634140\n    () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#10 0x7146b40a in _fu5851___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#11 0x7142780a in _fu5823___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#12 0x7146adcd in _fu1380___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#13 0x7146958c in _fu1378___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#14 0x71378feb in _fu1133___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#15 0x712e75b1 in middle::trans::base::get_res_dtor::h3c36fb0ca7cdef9foXa ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#16 0x712e6e89 in middle::trans::glue::trans_struct_drop::hc402b180302545504cY\n    () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#17 0x712e6db9 in middle::trans::glue::trans_struct_drop_flag::closure.$x22closu\nre$x22$LP$115788$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#18 0x712e6b92 in middle::trans::base::with_cond::h275549e08aca791bLQb ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#19 0x712e14f9 in middle::trans::glue::make_drop_glue::as_closure.$x22as_closure\n$x22$LP$115752$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#20 0x712e0763 in _fu1001___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#21 0x712dcbf8 in _fu9167___ZN11collections7hashmap5table25RawTable$LT$K$C$$x20V\n$GT$8read_mut15__STATIC_FMTSTR20h52ee9d52ccb78170sKdE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#22 0x712dc135 in middle::trans::glue::drop_ty::h22c19447361d791f2ZX ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#23 0x712ea368 in middle::trans::glue::drop_ty::as_closure.$x22as_closure$x22$LP\n$115802$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#24 0x71379c49 in middle::trans::base::iter_structural_ty::closure.$x22closure$x\n22$LP$118686$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#25 0x713795df in middle::trans::expr::with_field_tys::h7611866981621909557 ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#26 0x712db7f0 in _fu113___ZN6to_str10T.ToString9to_string15__STATIC_FMTSTR20h61\n3140a9ab0b6801GtdE () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#27 0x712e15d4 in middle::trans::glue::make_drop_glue::as_closure.$x22as_closure\n$x22$LP$115752$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#28 0x712e0763 in _fu1001___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#29 0x712dcbf8 in _fu9167___ZN11collections7hashmap5table25RawTable$LT$K$C$$x20V\n$GT$8read_mut15__STATIC_FMTSTR20h52ee9d52ccb78170sKdE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#30 0x712dc135 in middle::trans::glue::drop_ty::h22c19447361d791f2ZX ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#31 0x71409cd3 in middle::trans::cleanup::DropValue.Cleanup::trans::hda7eb6534d1\n8d883gIv () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#32 0x712e9728 in _fu5647___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#33 0x713232c3 in _fu1071___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#34 0x7131084f in _fu1057___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#35 0x712d18b9 in _fu5623___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#36 0x712d1d28 in middle::trans::controlflow::trans_block::h34c351d171e17f4batX\n() from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#37 0x713838df in _fu4142___ZN6option15Option$LT$T$GT$6unwrap15__STATIC_FMTSTR20\nhffe20199f09050f08XlE () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#38 0x712c5620 in _fu5608___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#39 0x712c7517 in _fu5613___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#40 0x712f67aa in _fu12025___ZN3ast11LOCAL_CRATE20hc864dbb6979b191fsscE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#41 0x712f2386 in _fu5653___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#42 0x713016ec in _fu1039___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#43 0x7130042d in middle::trans::callee::trans_method_call::closure.$x22closure$\nx22$LP$116143$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#44 0x712fbbfa in middle::trans::callee::trans_call_inner::hdd17f9ccbde0143d5j0\n() from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#45 0x7130010e in _fu5669___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#46 0x7131038f in _fu1057___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#47 0x712d18b9 in _fu5623___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#48 0x712d1d28 in middle::trans::controlflow::trans_block::h34c351d171e17f4batX\n() from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#49 0x713838df in _fu4142___ZN6option15Option$LT$T$GT$6unwrap15__STATIC_FMTSTR20\nhffe20199f09050f08XlE () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#50 0x712c5620 in _fu5608___ZN9LOG_LEVEL20h2c6669d829f5eb70diaE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#51 0x71389b17 in _fu1163___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#52 0x712c0a58 in _fu8738___ZN11collections7hashmap5table25RawTable$LT$K$C$$x20V\n$GT$4read15__STATIC_FMTSTR20h52ee9d52ccb78170qIdE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#53 0x71391bef in _fu1170___ZN3vec10PTR_MARKER20h9fed6267b1c4667cGIhE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#54 0x7171907a in driver::driver::phase_4_translate_to_llvm::h9a8bf621a6eccc8bCq\nw () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#55 0x71711f52 in _fu3969___ZN4cell29Ref$LT$$x27b$C$$x20T$GT$.Drop4drop15__STATI\nC_FMTSTR20hffe20199f09050f0xXiE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#56 0x717ad99e in _fu10354___ZN4cell32RefMut$LT$$x27b$C$$x20T$GT$.Drop4drop15__S\nTATIC_FMTSTR20hffe20199f09050f0O1iE ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#57 0x717aaf1d in driver::main_args::closure.$x22closure$x22$LP$137115$RP$ ()\n   from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#58 0x717bd18e in task::TaskBuilder$LT$S$GT$::try_future::closure.$x22closure$x2\n2$LP$138258$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#59 0x717bd0a2 in task::TaskBuilder$LT$S$GT$::spawn_internal::closure.$x22closur\ne$x22$LP$138235$RP$ () from C:\\Compilation\\Rust\\bin\\rustc-4e7c5e5c.dll\n#60 0x70c30298 in task::spawn_opts::closure.$x22closure$x22$LP$8580$RP$ ()\n   from C:\\Compilation\\Rust\\bin\\native-4e7c5e5c.dll\n#61 0x61f88155 in unwind::try::try_fn::hc576b70e5db0056b6zd ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#62 0x61fe73d6 in rust_try () from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#63 0x61f85ea7 in unwind::try::h1113533bcbfe97bdJxd ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#64 0x61f85c3a in task::Task::run::h22cb15a330ff15f29Xc ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#65 0x70c30137 in task::spawn_opts::closure.$x22closure$x22$LP$8526$RP$ ()\n   from C:\\Compilation\\Rust\\bin\\native-4e7c5e5c.dll\n#66 0x61f87caf in thread::thread_start::h8291a389c91d62bbHkd ()\n   from C:\\Compilation\\Rust\\bin\\rustrt-4e7c5e5c.dll\n#67 0x767e338a in KERNEL32!BaseThreadInitThunk ()\n   from C:\\Windows\\syswow64\\kernel32.dll\n#68 0x771c9f72 in ntdll!RtlInitializeExceptionChain ()\n   from C:\\Windows\\system32\\ntdll.dll\n#69 0x771c9f45 in ntdll!RtlInitializeExceptionChain ()\n   from C:\\Windows\\system32\\ntdll.dll\n#70 0x00000000 in ?? ()\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/15858/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15858/timeline", "performed_via_github_app": null, "state_reason": "completed"}