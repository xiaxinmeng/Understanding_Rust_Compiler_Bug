{"url": "https://api.github.com/repos/rust-lang/rust/issues/42655", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42655/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42655/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42655/events", "html_url": "https://github.com/rust-lang/rust/issues/42655", "id": 235942972, "node_id": "MDU6SXNzdWUyMzU5NDI5NzI=", "number": 42655, "title": "Rc/Arc equality checking could short-circuit on equal pointers if T: Eq", "user": {"login": "joliss", "id": 524783, "node_id": "MDQ6VXNlcjUyNDc4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/524783?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joliss", "html_url": "https://github.com/joliss", "followers_url": "https://api.github.com/users/joliss/followers", "following_url": "https://api.github.com/users/joliss/following{/other_user}", "gists_url": "https://api.github.com/users/joliss/gists{/gist_id}", "starred_url": "https://api.github.com/users/joliss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joliss/subscriptions", "organizations_url": "https://api.github.com/users/joliss/orgs", "repos_url": "https://api.github.com/users/joliss/repos", "events_url": "https://api.github.com/users/joliss/events{/privacy}", "received_events_url": "https://api.github.com/users/joliss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 657353545, "node_id": "MDU6TGFiZWw2NTczNTM1NDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-accepted", "name": "C-feature-accepted", "color": "f5f1fd", "default": false, "description": "Category: A feature request that has been accepted pending implementation."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-06-14T16:48:39Z", "updated_at": "2018-12-19T12:50:00Z", "closed_at": "2018-12-19T12:50:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The `PartialEq` implementations for `Rc` and `Arc` currently always defer to the equality implementations for their inner values ([rc.rs:770](https://github.com/rust-lang/rust/blob/554c685b0b3b25b7aa752717edf50b8d6bcab7a0/src/liballoc/rc.rs#L770-L788)):\r\n\r\n```rust\r\n    fn eq(&self, other: &Rc<T>) -> bool {\r\n        **self == **other\r\n    }\r\n```\r\n\r\nHowever, where `T: Eq`, we may assume that the inner values obey reflexivity (`a == a`), and so we could short-circuit the comparison if the pointers are equal. That is, instead of checking `**self == **other`, we could check `self.ptr_eq(other) || **self == **other`.\r\n\r\nIt is conceivable that in rare cases the equality-check on the inner value is so cheap that attempting to short-circuit adds more overhead than it saves. However, my sense is that `Rc` is usually used on types that are too complex to clone cheaply, and so it stands to reason that in most cases, the equality check on the inner value is expensive. (This is certainly true for the use cases I've encountered.) Checking equality on the pointers furthermore is very cheap, since we're dereferencing them anyway.\r\n\r\nI'm cautiously volunteering a pull request if people think that this is a reasonable change. *Update: Pull request at #42965.*", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42655/reactions", "total_count": 9, "+1": 9, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42655/timeline", "performed_via_github_app": null, "state_reason": "completed"}