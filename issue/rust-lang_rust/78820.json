{"url": "https://api.github.com/repos/rust-lang/rust/issues/78820", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78820/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78820/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78820/events", "html_url": "https://github.com/rust-lang/rust/issues/78820", "id": 738078738, "node_id": "MDU6SXNzdWU3MzgwNzg3Mzg=", "number": 78820, "title": "ICE with cargo-miri: vtable not supported on type std::pin::Pin<&mut dyn futures::Future<Output = std::result::Result<...", "user": {"login": "MikailBag", "id": 11889433, "node_id": "MDQ6VXNlcjExODg5NDMz", "avatar_url": "https://avatars.githubusercontent.com/u/11889433?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MikailBag", "html_url": "https://github.com/MikailBag", "followers_url": "https://api.github.com/users/MikailBag/followers", "following_url": "https://api.github.com/users/MikailBag/following{/other_user}", "gists_url": "https://api.github.com/users/MikailBag/gists{/gist_id}", "starred_url": "https://api.github.com/users/MikailBag/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MikailBag/subscriptions", "organizations_url": "https://api.github.com/users/MikailBag/orgs", "repos_url": "https://api.github.com/users/MikailBag/repos", "events_url": "https://api.github.com/users/MikailBag/events{/privacy}", "received_events_url": "https://api.github.com/users/MikailBag/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-11-06T22:27:29Z", "updated_at": "2020-11-22T11:35:03Z", "closed_at": "2020-11-22T11:35:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# Source\r\nI partially reduced the codebase: I was able to delete all not `tokio::sync::mpsc`-related staff.\r\nhttps://github.com/MikailBag/tokio/tree/ice\r\n# Command\r\n```\r\ncargo miri test -p tokio-util\r\n```\r\n# Full error text\r\n```\r\nerror: internal compiler error: /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/compiler/rustc_mir/src/interpret/place.rs:224:18: vtable not supported on type std::pin::Pin<&mut dyn futures::Future<Output = std::result::Result<tokio::sync::mpsc::Permit<std::string::String>, tokio::sync::mpsc::error::SendError<()>>>>\r\n```\r\n# Backtrace\r\n```\r\nthread 'rustc' panicked at 'Box<Any>', compiler/rustc_errors/src/lib.rs:945:9\r\nstack backtrace:\r\n   0:     0x7f1df5c40a20 - std::backtrace_rs::backtrace::libunwind::trace::h303a626d53553a64\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/../../backtrace/src/backtrace/libunwind.rs:100:5\r\n   1:     0x7f1df5c40a20 - std::backtrace_rs::backtrace::trace_unsynchronized::h6abb882733c3f18c\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x7f1df5c40a20 - std::sys_common::backtrace::_print_fmt::h57829321f1d9217a\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/sys_common/backtrace.rs:67:5\r\n   3:     0x7f1df5c40a20 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h400b66a054640aac\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/sys_common/backtrace.rs:46:22\r\n   4:     0x7f1df5cafe9c - core::fmt::write::h1857a60b204f1b6a\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/core/src/fmt/mod.rs:1076:17\r\n   5:     0x7f1df5c32642 - std::io::Write::write_fmt::h6453b28c8b27c6ea\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/io/mod.rs:1516:15\r\n   6:     0x7f1df5c459d5 - std::sys_common::backtrace::_print::h15cc4b3923cc9bc0\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/sys_common/backtrace.rs:49:5\r\n   7:     0x7f1df5c459d5 - std::sys_common::backtrace::print::h953c7be178c0674d\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/sys_common/backtrace.rs:36:9\r\n   8:     0x7f1df5c459d5 - std::panicking::default_hook::{{closure}}::h635d667f571198f0\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/panicking.rs:208:50\r\n   9:     0x7f1df5c45678 - std::panicking::default_hook::h3bc2efb48060abaa\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/panicking.rs:227:9\r\n  10:     0x7f1df650e618 - rustc_driver::report_ice::hbf1325c7565687ba\r\n  11:     0x7f1df5c46216 - std::panicking::rust_panic_with_hook::h887eb0c89f46b8b2\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/panicking.rs:581:17\r\n  12:     0x7f1df94baa2d - std::panicking::begin_panic::{{closure}}::hc1d905d2374ce0cc\r\n  13:     0x7f1df94ba936 - std::sys_common::backtrace::__rust_end_short_backtrace::ha1feaa73cb1e05ce\r\n  14:     0x7f1df94ba99f - std::panicking::begin_panic::h09616460625efa25\r\n  15:     0x7f1df94f1380 - rustc_errors::HandlerInner::bug::hbb6554bd4fbc8852\r\n  16:     0x7f1df94efe60 - rustc_errors::Handler::bug::h4feefeec7bb726ca\r\n  17:     0x7f1df8f61bc4 - rustc_middle::util::bug::opt_span_bug_fmt::{{closure}}::h22b92ed7b73b8340\r\n  18:     0x7f1df8f5ae0b - rustc_middle::ty::context::tls::with_opt::{{closure}}::h32bfd9cf0b0a9393\r\n  19:     0x7f1df8f5adb2 - rustc_middle::ty::context::tls::with_opt::h762464f893de2d96\r\n  20:     0x7f1df8f61ae9 - rustc_middle::util::bug::opt_span_bug_fmt::h05648c19bbf99518\r\n  21:     0x7f1df8f61a5e - rustc_middle::util::bug::bug_fmt::h5d4f7ed12a8f1d0d\r\n  22:     0x560054028180 - rustc_mir::interpret::terminator::<impl rustc_mir::interpret::eval_context::InterpCx<M>>::eval_fn_call::hc90b4c2ac00f799c\r\n  23:     0x56005403c2d5 - rustc_mir::interpret::step::<impl rustc_mir::interpret::eval_context::InterpCx<M>>::terminator::h502bf9e09df16a8c\r\n  24:     0x560053f378b7 - miri::eval::eval_main::h49029ec68dde781d\r\n  25:     0x560053e65169 - rustc_interface::passes::QueryContext::enter::h9abc318ed7891ffc\r\n  26:     0x560053e5ec33 - <miri::MiriCompilerCalls as rustc_driver::Callbacks>::after_analysis::h61bd73feff3da747\r\n  27:     0x7f1df65294d7 - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter::h6eb07f11eba80bd6\r\n  28:     0x7f1df64f02a2 - rustc_span::with_source_map::h3820d41b3a036910\r\n  29:     0x7f1df652a9c2 - rustc_interface::interface::create_compiler_and_run::h08ad396f4e7721e0\r\n  30:     0x7f1df6512d5a - scoped_tls::ScopedKey<T>::set::hd425a36fbe06985e\r\n  31:     0x7f1df652f9b5 - std::sys_common::backtrace::__rust_begin_short_backtrace::h23925571219dbc63\r\n  32:     0x7f1df64ad3ce - core::ops::function::FnOnce::call_once{{vtable.shim}}::h43b61b9af30b3669\r\n  33:     0x7f1df5c5521a - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h88864ee659ddb161\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/alloc/src/boxed.rs:1042:9\r\n  34:     0x7f1df5c5521a - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h9f03cbdc7ab33431\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/alloc/src/boxed.rs:1042:9\r\n  35:     0x7f1df5c5521a - std::sys::unix::thread::Thread::new::thread_start::h5979dd5560a11418\r\n                               at /rustc/ffa2e7ae8fbf9badc035740db949b9dae271c29f/library/std/src/sys/unix/thread.rs:89:17\r\n  36:     0x7f1df5b4a609 - start_thread\r\n  37:     0x7f1df5920293 - clone\r\n  38:                0x0 - <unknown>\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.49.0-nightly (ffa2e7ae8 2020-10-24) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\n```", "closed_by": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78820/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78820/timeline", "performed_via_github_app": null, "state_reason": "completed"}