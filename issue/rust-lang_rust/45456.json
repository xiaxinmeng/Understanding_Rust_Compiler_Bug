{"url": "https://api.github.com/repos/rust-lang/rust/issues/45456", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45456/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45456/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45456/events", "html_url": "https://github.com/rust-lang/rust/issues/45456", "id": 267501006, "node_id": "MDU6SXNzdWUyNjc1MDEwMDY=", "number": 45456, "title": "Bootstrapping rustc for sparc64-unknown-linux-gnu fails with linker errors", "user": {"login": "glaubitz", "id": 1647645, "node_id": "MDQ6VXNlcjE2NDc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1647645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glaubitz", "html_url": "https://github.com/glaubitz", "followers_url": "https://api.github.com/users/glaubitz/followers", "following_url": "https://api.github.com/users/glaubitz/following{/other_user}", "gists_url": "https://api.github.com/users/glaubitz/gists{/gist_id}", "starred_url": "https://api.github.com/users/glaubitz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glaubitz/subscriptions", "organizations_url": "https://api.github.com/users/glaubitz/orgs", "repos_url": "https://api.github.com/users/glaubitz/repos", "events_url": "https://api.github.com/users/glaubitz/events{/privacy}", "received_events_url": "https://api.github.com/users/glaubitz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 632899563, "node_id": "MDU6TGFiZWw2MzI4OTk1NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-SPARC", "name": "O-SPARC", "color": "6e6ec0", "default": false, "description": "Target: SPARC processors"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-10-22T21:38:01Z", "updated_at": "2017-10-25T19:13:11Z", "closed_at": "2017-10-25T19:13:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have tried to bootstrap rustc for sparc64-unknown-linux-gnu with:\r\n\r\n```\r\n$ ./configure --host=sparc64-unknown-linux-gnu && make\r\n```\r\n\r\nwhich fails with:\r\n\r\n```\r\nBuilding stage1 test artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n    Finished release [optimized] target(s) in 0.0 secs\r\nCopying stage1 test from stage1 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding stage1 compiler artifacts (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\n    Finished release [optimized] target(s) in 0.0 secs\r\nCopying stage1 rustc from stage1 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nAssembling stage2 compiler (x86_64-unknown-linux-gnu)\r\nUplifting stage1 std (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu)\r\nCopying stage2 std from stage1 (x86_64-unknown-linux-gnu -> x86_64-unknown-linux-gnu / x86_64-unknown-linux-gnu)\r\nBuilding stage1 std artifacts (x86_64-unknown-linux-gnu -> sparc64-unknown-linux-gnu)\r\n   Compiling std v0.0.0 (file:///home/glaubitz/rust/rust/src/libstd)\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-L\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/sparc64-unknown-linux-gnu/lib\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/de\\\r\nps/std-5e8ebc384e5dfd82.std0.rust-cgu.o\" \"-o\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/libstd-5e8ebc384e5dfd82.so\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux\\\r\n-gnu/release/deps/std-5e8ebc384e5dfd82.crate.metadata.rust-cgu.o\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.crate.allocator.rust-cgu.o\" \"-Wl,-z,relro,-z,now\" \"-Wl,-O1\" \"-nodefaultlibs\"\\\r\n \"-L\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps\" \"-L\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/release/deps\" \"-L\" \"/home/glaubitz/rust/rust/build/sparc64-unknown-linux-gnu/native\\\r\n/libbacktrace/.libs\" \"-L\" \"/home/glaubitz/rust/rust/build/sparc64-unknown-linux-gnu/native/jemalloc/lib\" \"-L\" \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/build/compiler_builtins-a1f49ad8dde16ae2/out\" \"-L\" \"/home/\\\r\nglaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/sparc64-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"-Wl,--whole-archive\" \"-l\" \"backtrace\" \"-Wl,--no-whole-archive\" \"-Wl,-Bdynamic\" \"-l\" \"dl\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-Wl,-Bstatic\" \"-Wl,--whole-archive\" \"/t\\\r\nmp/rustc.4vz7yahAsBSv/libpanic_unwind-368647e9b9ca3b39.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/libunwind-eda6aedbad712bc0.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/librand-efc56d5e4c2b1ee8.rlib\" \"\\\r\n-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/liballoc_system-67992b04c9027e70.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/liblibc-bdd38e4620ffab1c.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rust\\\r\nc.4vz7yahAsBSv/liballoc-c15d9e20191e711b.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/libstd_unicode-b3230a4723442795.rlib\" \"-Wl,--no-whole-archive\" \"-Wl,--whole-archive\" \"/tmp/rustc.4vz7yahAsBSv/libcore-3181dd9e46400ebd.rlib\" \"-Wl,--no-\\\r\nwhole-archive\" \"/tmp/rustc.4vz7yahAsBSv/libcompiler_builtins-fa8533728d55e42b.rlib\" \"-Wl,-Bdynamic\" \"-l\" \"gcc_s\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-l\" \"util\" \"-l\" \"util\" \"-shared\" \"-Wl,-rpath,$ORIGIN/../lib\"\r\n  = note: /usr/bin/ld: /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: Relocations in generic ELF (EM: 43)\r\n(...)\r\n          /usr/bin/ld: /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: Relocations in generic ELF (EM: 43)\r\n          /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: error adding symbols: File in wrong format\r\n          collect2: error: ld returned 1 exit status\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `std`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/home/glaubitz/rust/rust/build/bootstrap/debug/rustc --crate-name std src/libstd/lib.rs --error-format json --crate-type dylib --crate-type rlib --emit=dep-info,link -C prefer-dynamic -C opt-level=2 --cfg feature=\"alloc_jemalloc\" --c\\\r\nfg feature=\"backtrace\" --cfg feature=\"jemalloc\" --cfg feature=\"panic-unwind\" --cfg feature=\"panic_unwind\" -C metadata=5e8ebc384e5dfd82 -C extra-filename=-5e8ebc384e5dfd82 --out-dir /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-\\\r\ngnu/release/deps --target sparc64-unknown-linux-gnu -L dependency=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps -L dependency=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/release/deps --ex\\\r\ntern alloc_system=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/liballoc_system-67992b04c9027e70.rlib --extern compiler_builtins=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknow\\\r\nn-linux-gnu/release/deps/libcompiler_builtins-fa8533728d55e42b.rlib --extern unwind=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/libunwind-eda6aedbad712bc0.rlib --extern std_unicode=/home/glaubitz/rust/rust/bu\\\r\nild/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/libstd_unicode-b3230a4723442795.rlib --extern alloc=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/liballoc-c15d9e20191e711b.rlib --\\\r\nextern panic_unwind=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/libpanic_unwind-368647e9b9ca3b39.rlib --extern core=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu\\\r\n/release/deps/libcore-3181dd9e46400ebd.rlib --extern libc=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/liblibc-bdd38e4620ffab1c.rlib --extern collections=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu\\\r\n/stage1-std/sparc64-unknown-linux-gnu/release/deps/libcollections-17d6af9abb88abd5.rlib --extern rand=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/librand-efc56d5e4c2b1ee8.rlib --extern panic_abort=/home/glaub\\\r\nitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/libpanic_abort-3500a7ebf8df4faa.rlib --extern alloc_jemalloc=/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/liballoc\\\r\n_jemalloc-5c483b777c53a191.rlib -L native=/home/glaubitz/rust/rust/build/sparc64-unknown-linux-gnu/native/libbacktrace/.libs -l static=backtrace -l dl -l rt -l pthread -L native=/home/glaubitz/rust/rust/build/sparc64-unknown-linux-gnu/native/jemalloc/lib -L native=/home\\\r\n/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/build/compiler_builtins-a1f49ad8dde16ae2/out` (exit code: 101)\r\nthread 'main' panicked at 'command did not execute successfully: \"/home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\" \"build\" \"--target\" \"sparc64-unknown-linux-gnu\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/home\\\r\n/glaubitz/rust/rust/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\r\nexpected success, got: exit code: 101', src/bootstrap/compile.rs:873:8\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\nfailed to run: /home/glaubitz/rust/rust/build/bootstrap/debug/bootstrap build\r\nBuild completed unsuccessfully in 0:00:20\r\nMakefile:22: recipe for target 'all' failed\r\nmake: *** [all] Error 1\r\n```\r\n\r\nThe message ```/usr/bin/ld: /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: Relocations in generic ELF (EM: 43)``` is repeated several hundred times which is why I cut the all but two instances of that message out.\r\n\r\nFrom the error messages above, it seems that the build process is invoking the wrong linker binary:\r\n\r\n```\r\n/usr/bin/ld: /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: Relocations in generic ELF (EM: 43)\r\n          /home/glaubitz/rust/rust/build/x86_64-unknown-linux-gnu/stage1-std/sparc64-unknown-linux-gnu/release/deps/std-5e8ebc384e5dfd82.std0.rust-cgu.o: error adding symbols: File in wrong format\r\n          collect2: error: ld returned 1 exit status\r\n```\r\n\r\nIt's invoking ```/usr/bin/ld```, but it should actually invoke ```/usr/bin/sparc64-linux-gnu-ld```.\r\n\r\nI haven't looked at the code yet, but I would suggest that the build process should always call external compilers and binutils using the GNU triplet prefix.\r\n\r\nPS: I am one of Debian's sparc64 porters and I will be happy to provide to a fast SPARC-T5 porterbox to anyone who is interested in working on Rust on Linux/SPARC.", "closed_by": {"login": "glaubitz", "id": 1647645, "node_id": "MDQ6VXNlcjE2NDc2NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/1647645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glaubitz", "html_url": "https://github.com/glaubitz", "followers_url": "https://api.github.com/users/glaubitz/followers", "following_url": "https://api.github.com/users/glaubitz/following{/other_user}", "gists_url": "https://api.github.com/users/glaubitz/gists{/gist_id}", "starred_url": "https://api.github.com/users/glaubitz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glaubitz/subscriptions", "organizations_url": "https://api.github.com/users/glaubitz/orgs", "repos_url": "https://api.github.com/users/glaubitz/repos", "events_url": "https://api.github.com/users/glaubitz/events{/privacy}", "received_events_url": "https://api.github.com/users/glaubitz/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45456/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45456/timeline", "performed_via_github_app": null, "state_reason": "completed"}