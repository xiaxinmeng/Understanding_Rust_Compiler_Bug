{"url": "https://api.github.com/repos/rust-lang/rust/issues/89877", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89877/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89877/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89877/events", "html_url": "https://github.com/rust-lang/rust/issues/89877", "id": 1026178606, "node_id": "I_kwDOAAsO6M49Kj4u", "number": 89877, "title": "Doc comment is shown as snippet for trait not implemented instead of field", "user": {"login": "koivunej", "id": 1081634, "node_id": "MDQ6VXNlcjEwODE2MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1081634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/koivunej", "html_url": "https://github.com/koivunej", "followers_url": "https://api.github.com/users/koivunej/followers", "following_url": "https://api.github.com/users/koivunej/following{/other_user}", "gists_url": "https://api.github.com/users/koivunej/gists{/gist_id}", "starred_url": "https://api.github.com/users/koivunej/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/koivunej/subscriptions", "organizations_url": "https://api.github.com/users/koivunej/orgs", "repos_url": "https://api.github.com/users/koivunej/repos", "events_url": "https://api.github.com/users/koivunej/events{/privacy}", "received_events_url": "https://api.github.com/users/koivunej/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234948, "node_id": "MDU6TGFiZWwyMzQ5NDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-attributes", "name": "A-attributes", "color": "f7e101", "default": false, "description": "Area: #[attributes(..)]"}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}, {"id": 1839565265, "node_id": "MDU6TGFiZWwxODM5NTY1MjY1", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-terse", "name": "D-terse", "color": "c9f7a3", "default": false, "description": "A diagnostic that doesn't give enough information about the problem at hand"}, {"id": 2079070889, "node_id": "MDU6TGFiZWwyMDc5MDcwODg5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-proc-macros", "name": "A-proc-macros", "color": "f7e101", "default": false, "description": "Area: Procedural macros"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-10-14T09:34:10Z", "updated_at": "2023-03-16T08:02:08Z", "closed_at": "2023-03-15T23:38:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nGiven the following code: https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=fc1473e4afb90d6ab12751d3cc0cb6a8\r\n\r\n```rust\r\nfn main() {\r\n    todo!(\"does not compile\")\r\n}\r\n\r\n#[derive(Debug, serde::Deserialize)]\r\npub struct Root {\r\n    /// doc comment included as the snippet\r\n    foo: Bar,\r\n    // this has a regular comment, not shown as snippet\r\n    car: Bar,\r\n}\r\n\r\n/// this one didn't have deserialize derived by accident\r\n#[derive(Debug)]\r\npub struct Bar {\r\n    bar: u32\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\n   Compiling playground v0.0.1 (/playground)\r\nerror[E0277]: the trait bound `Bar: Deserialize<'_>` is not satisfied\r\n    --> src/main.rs:7:5\r\n     |\r\n7    |     /// doc comment included as the snippet\r\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n     |\r\nnote: required by `next_element`\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.130/src/de/mod.rs:1703:5\r\n     |\r\n1703 | /     fn next_element<T>(&mut self) -> Result<Option<T>, Self::Error>\r\n1704 | |     where\r\n1705 | |         T: Deserialize<'de>,\r\n     | |____________________________^\r\n\r\nerror[E0277]: the trait bound `Bar: Deserialize<'_>` is not satisfied\r\n    --> src/main.rs:10:5\r\n     |\r\n10   |     car: Bar,\r\n     |     ^^^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n     |\r\nnote: required by `next_element`\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.130/src/de/mod.rs:1703:5\r\n     |\r\n1703 | /     fn next_element<T>(&mut self) -> Result<Option<T>, Self::Error>\r\n1704 | |     where\r\n1705 | |         T: Deserialize<'de>,\r\n     | |____________________________^\r\n\r\nerror[E0277]: the trait bound `Bar: Deserialize<'_>` is not satisfied\r\n    --> src/main.rs:7:5\r\n     |\r\n7    |     /// doc comment included as the snippet\r\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n     |\r\nnote: required by `next_value`\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.130/src/de/mod.rs:1842:5\r\n     |\r\n1842 | /     fn next_value<V>(&mut self) -> Result<V, Self::Error>\r\n1843 | |     where\r\n1844 | |         V: Deserialize<'de>,\r\n     | |____________________________^\r\n\r\nerror[E0277]: the trait bound `Bar: Deserialize<'_>` is not satisfied\r\n    --> src/main.rs:10:5\r\n     |\r\n10   |     car: Bar,\r\n     |     ^^^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n     |\r\nnote: required by `next_value`\r\n    --> /playground/.cargo/registry/src/github.com-1ecc6299db9ec823/serde-1.0.130/src/de/mod.rs:1842:5\r\n     |\r\n1842 | /     fn next_value<V>(&mut self) -> Result<V, Self::Error>\r\n1843 | |     where\r\n1844 | |         V: Deserialize<'de>,\r\n     | |____________________________^\r\n\r\nFor more information about this error, try `rustc --explain E0277`.\r\nerror: could not compile `playground` due to 4 previous errors\r\n```\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the output should look like:\r\n\r\nInstead of:\r\n\r\n```\r\n7    |     /// doc comment included as the snippet\r\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n```\r\n\r\nIt should have like it already has with nightly 2021-10-13 (**not beta**):\r\n\r\n```\r\n7    | /     /// doc comment included as the snippet\r\n8    | |     foo: Bar,\r\n     | |____________^ the trait `Deserialize<'_>` is not implemented for `Bar`\r\n```\r\n\r\n<!--\r\nIf the problem is not self-explanatory, please provide a rationale for the\r\nchange.\r\n-->\r\n\r\nRationale: Comment is the whole snippet above. Nightlys version is much better with both the doc comment and the field shown, but at minimum the field should be always shown.\r\n\r\n<!--\r\nIf dramatically different output is caused by small changes, consider also\r\nadding them here.\r\n\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions. The output might also be\r\ndifferent depending on the Edition.\r\n-->\r\n\r\nThe field with plain `//` comment didn't trigger this, so it's related to handling of fields with doc comments.\r\n\r\nAlso plain `#[derive(Debug)]` being missing from `struct Bar` will not interestingly enough trigger this, but I didn't narrow it down further, just happened to find this while using serde.\r\n\r\nVersions:\r\n\r\nFound with stable 1.55.0. Looking at playground, *beta has the same bug*. `nightly 2021-10-13` in the playground does not. I couldn't find an issue for this problem, so reporting it to remind to backport the fix to beta.\r\n", "closed_by": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89877/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89877/timeline", "performed_via_github_app": null, "state_reason": "completed"}