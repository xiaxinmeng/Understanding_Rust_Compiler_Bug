{"url": "https://api.github.com/repos/rust-lang/rust/issues/104874", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104874/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104874/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104874/events", "html_url": "https://github.com/rust-lang/rust/issues/104874", "id": 1464233816, "node_id": "I_kwDOAAsO6M5XRm9Y", "number": 104874, "title": "Incremental Compile Bug On Moved Imports", "user": {"login": "tustvold", "id": 1781103, "node_id": "MDQ6VXNlcjE3ODExMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/1781103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tustvold", "html_url": "https://github.com/tustvold", "followers_url": "https://api.github.com/users/tustvold/followers", "following_url": "https://api.github.com/users/tustvold/following{/other_user}", "gists_url": "https://api.github.com/users/tustvold/gists{/gist_id}", "starred_url": "https://api.github.com/users/tustvold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tustvold/subscriptions", "organizations_url": "https://api.github.com/users/tustvold/orgs", "repos_url": "https://api.github.com/users/tustvold/repos", "events_url": "https://api.github.com/users/tustvold/events{/privacy}", "received_events_url": "https://api.github.com/users/tustvold/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-11-25T09:06:41Z", "updated_at": "2022-11-25T09:09:39Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nWhilst working on https://github.com/apache/arrow-rs I keep running into issues where incremental compilation gets confused by types that have been moved from one crate within the workspace to another.\r\n\r\nI'm not really sure how to come up with a reproducer, as it seems to rely on stale state from previous builds that I can't find a way to reproduce. However, @carols10cents recommended I file an issue to at least alert you guys that something isn't quite right :sweat_smile: \r\n\r\nAn example error would be\r\n\r\n```\r\n$ cargo check\r\n    Checking arrow-array v27.0.0 (/home/raphael/repos/external/arrow-rs/arrow-array)\r\n\r\nerror[E0432]: unresolved imports `arrow_schema::DECIMAL128_MAX_PRECISION`, `arrow_schema::DECIMAL128_MAX_SCALE`, `arrow_schema::DECIMAL256_MAX_PRECISION`, `arrow_schema::DECIMAL256_MAX_SCALE`, `arrow_schema::DECIMAL_DEFAULT_SCALE`\r\n  --> arrow-array/src/types.rs:26:51\r\n   |\r\n26 |     ArrowError, DataType, IntervalUnit, TimeUnit, DECIMAL128_MAX_PRECISION,\r\n   |                                                   ^^^^^^^^^^^^^^^^^^^^^^^^ no `DECIMAL128_MAX_PRECISION` in the root\r\n27 |     DECIMAL128_MAX_SCALE, DECIMAL256_MAX_PRECISION, DECIMAL256_MAX_SCALE,\r\n   |     ^^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^ no `DECIMAL256_MAX_SCALE` in the root\r\n   |     |                     |\r\n   |     |                     no `DECIMAL256_MAX_PRECISION` in the root\r\n   |     no `DECIMAL128_MAX_SCALE` in the root\r\n28 |     DECIMAL_DEFAULT_SCALE,\r\n   |     ^^^^^^^^^^^^^^^^^^^^^ no `DECIMAL_DEFAULT_SCALE` in the root\r\n```\r\n\r\nRelated to https://github.com/apache/arrow-rs/pull/3177\r\n\r\nAnd goes away with a `cargo clean`.\r\n\r\nEdit: Interestingly it didn't appear to recompile any of the dependent crates, such as arrow-data, despite the fact they have changed... Perhaps this is a cargo bug??\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0 (897e37553 2022-11-02)\r\nbinary: rustc\r\ncommit-hash: 897e37553bba8b42751c67658967889d11ecd120\r\ncommit-date: 2022-11-02\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.65.0\r\nLLVM version: 15.0.0\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104874/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104874/timeline", "performed_via_github_app": null, "state_reason": null}