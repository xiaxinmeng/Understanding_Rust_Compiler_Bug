{"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870", "repository_url": "https://api.github.com/repos/rust-lang/rust-clippy", "labels_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870/comments", "events_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870/events", "html_url": "https://github.com/rust-lang/rust-clippy/issues/10870", "id": 1737679896, "node_id": "I_kwDOAZm0i85nkuQY", "number": 10870, "title": "[regression in 1.70] [clippy] redundant clone ; cloned value is neither consumed nor mutated", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 149309557, "node_id": "MDU6TGFiZWwxNDkzMDk1NTc=", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/C-bug", "name": "C-bug", "color": "F5F1FD", "default": false, "description": "Category: Clippy is not doing the correct thing"}, {"id": 2593589230, "node_id": "MDU6TGFiZWwyNTkzNTg5MjMw", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/I-false-positive", "name": "I-false-positive", "color": "E10C02", "default": false, "description": "Issue: The lint was triggered on code it shouldn't have"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-06-02T07:29:20Z", "updated_at": "2023-06-15T02:46:01Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Code\n\n```Rust\n#[derive(Clone)]\r\npub struct Foo(&'static str);\r\n\r\npub fn foo(a: Foo, b: Option<Foo>) -> String {\r\n    let b = if let Some(b) = b { b } else { a.clone() };\r\n    let mut result = String::new();\r\n    result.push_str(a.0);\r\n    result.push_str(b.0);\r\n    result\r\n}\n```\n\n\n### Current output\n\n```Shell\nwarning: redundant clone\r\n --> src/lib.rs:5:46\r\n  |\r\n5 |     let b = if let Some(b) = b { b } else { a.clone() };\r\n  |                                              ^^^^^^^^ help: remove this\r\n  |\r\nnote: cloned value is neither consumed nor mutated\r\n --> src/lib.rs:5:45\r\n  |\r\n5 |     let b = if let Some(b) = b { b } else { a.clone() };\r\n  |                                             ^^^^^^^^^\r\n  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#redundant_clone\r\n  = note: `#[warn(clippy::redundant_clone)]` on by default\n```\n\n\n### Desired output\n\n```Shell\nNothing\n```\n\n\n### Rationale and extra context\n\nThis is what the compiler says without the clone:\r\n```\r\nerror[[E0382]](https://doc.rust-lang.org/stable/error_codes/E0382.html): borrow of moved value: `a`\r\n --> src/lib.rs:7:21\r\n  |\r\n4 | pub fn foo(a: Foo, b: Option<Foo>) -> String {\r\n  |            - move occurs because `a` has type `Foo`, which does not implement the `Copy` trait\r\n5 |     let b = if let Some(b) = b { b } else { a };\r\n  |                                             - value moved here\r\n6 |     let mut result = String::new();\r\n7 |     result.push_str(a.0);\r\n  |                     ^^^ value borrowed here after move\r\n  |\r\nhelp: consider cloning the value if the performance cost is acceptable\r\n  |\r\n5 |     let b = if let Some(b) = b { b } else { a.clone() };\r\n  |                                              ++++++++\r\n```\n\n### Other cases\n\n_No response_\n\n### Anything else?\n\n_No response_", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10870/timeline", "performed_via_github_app": null, "state_reason": null}