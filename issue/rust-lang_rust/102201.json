{"url": "https://api.github.com/repos/rust-lang/rust/issues/102201", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/102201/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/102201/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/102201/events", "html_url": "https://github.com/rust-lang/rust/issues/102201", "id": 1384094011, "node_id": "I_kwDOAAsO6M5Sf5k7", "number": 102201, "title": "Give a better error when HRTB require a function to be valid for 'static references", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}, {"id": 1259721467, "node_id": "MDU6TGFiZWwxMjU5NzIxNDY3", "url": "https://api.github.com/repos/rust-lang/rust/labels/AsyncAwait-Triaged", "name": "AsyncAwait-Triaged", "color": "d4c5f9", "default": false, "description": "Async-await issues that have been triaged during a working group meeting."}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}, {"id": 1839565265, "node_id": "MDU6TGFiZWwxODM5NTY1MjY1", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-terse", "name": "D-terse", "color": "c9f7a3", "default": false, "description": "A diagnostic that doesn't give enough information about the problem at hand"}], "state": "open", "locked": false, "assignee": {"login": "vincenzopalazzo", "id": 17150045, "node_id": "MDQ6VXNlcjE3MTUwMDQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17150045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vincenzopalazzo", "html_url": "https://github.com/vincenzopalazzo", "followers_url": "https://api.github.com/users/vincenzopalazzo/followers", "following_url": "https://api.github.com/users/vincenzopalazzo/following{/other_user}", "gists_url": "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vincenzopalazzo/subscriptions", "organizations_url": "https://api.github.com/users/vincenzopalazzo/orgs", "repos_url": "https://api.github.com/users/vincenzopalazzo/repos", "events_url": "https://api.github.com/users/vincenzopalazzo/events{/privacy}", "received_events_url": "https://api.github.com/users/vincenzopalazzo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "vincenzopalazzo", "id": 17150045, "node_id": "MDQ6VXNlcjE3MTUwMDQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17150045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vincenzopalazzo", "html_url": "https://github.com/vincenzopalazzo", "followers_url": "https://api.github.com/users/vincenzopalazzo/followers", "following_url": "https://api.github.com/users/vincenzopalazzo/following{/other_user}", "gists_url": "https://api.github.com/users/vincenzopalazzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/vincenzopalazzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vincenzopalazzo/subscriptions", "organizations_url": "https://api.github.com/users/vincenzopalazzo/orgs", "repos_url": "https://api.github.com/users/vincenzopalazzo/repos", "events_url": "https://api.github.com/users/vincenzopalazzo/events{/privacy}", "received_events_url": "https://api.github.com/users/vincenzopalazzo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2022-09-23T17:22:38Z", "updated_at": "2022-10-01T21:18:26Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Given the following code: https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=cace533e183828ffeb2772f434b0611e\n\n```rust\nuse std::future::Future;\nuse std::pin::Pin;\n\ntype BoxFuture<'a, T> = Pin<Box<dyn Future<Output = T> + Send + 'a>>;\n\n#[derive(Default)]\nstruct B(bool);\n\n#[derive(Default)]\nstruct A {\n    a: bool,\n    b: B,\n}\n\nimpl A {\n    fn b_mut(&mut self) -> &mut B {\n        &mut self.b\n    }\n}\n\nasync fn entrypoint() {\n    let mut a = A::default();\n    let list = vec![];\n\n    foo(&mut a, |b| Box::pin(baz(b, &list))).await;\n}\n\nasync fn foo<'a, F>(a: &'a mut A, f: F)\nwhere\n     F: for<'b> FnOnce(&'b mut B) -> BoxFuture<'b, ()>,\n{\n\n    f(a.b_mut()).await;\n}\n\nasync fn baz(b: &mut B, _: &[u8]) {\n    b.0 = !b.0;\n}\n```\n\nThe current output is:\n\n```\nerror[E0597]: `list` does not live long enough\n  --> src/lib.rs:25:38\n   |\n25 |     foo(&mut a, |b| Box::pin(baz(b, &list))).await;\n   |                 --- -----------------^^^^--\n   |                 |   |                |\n   |                 |   |                borrowed value does not live long enough\n   |                 |   returning this value requires that `list` is borrowed for `'static`\n   |                 value captured here\n26 | }\n   | - `list` dropped here while still borrowed\n```\n\nThis is *correct*, but hard to understand.\n<!-- The following is not always necessary. -->\nIdeally the output should look like:\n\n```\nerror[E0597]: `list` does not live long enough\n  --> src/lib.rs:25:38\n   |\n25 |     foo(&mut a, |b| Box::pin(baz(b, &list))).await;\n   |                 --- -----------------^^^^--\n   |                 |   |                |\n   |                 |   |                borrowed value does not live long enough\n   |                 |   returning this value requires that `list` is borrowed for `'static`\n   |                 value captured here\n26 | }\n   | - `list` dropped here while still borrowed\n   |\n   | = note: the lifetime cannot be shortened from `'static` to `'b` because closures are contravariant: https://doc.rust-lang.org/nomicon/subtyping.html#variance\n   |\n   | = note: the closure passed to `foo` must be valid for any lifetime, including the `'static` lifetime\n28 | async fn foo<'a, F>(a: &'a mut A, f: F)\n   |                                   ^^^^\n   |      F: for<'b> FnOnce(&'b mut B) -> BoxFuture<'b, ()>,\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n   |         |\n   |         due to the bound here\n```\n\n<!--\nIf the problem is not self-explanatory, please provide a rationale for the\nchange.\n-->\n\n<!--\nIf dramatically different output is caused by small changes, consider also\nadding them here.\n\nIf you're using the stable version of the compiler, you should also check if the\nbug also exists in the beta or nightly versions. The output might also be\ndifferent depending on the Edition.\n-->\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"vincenzopalazzo\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/102201/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/102201/timeline", "performed_via_github_app": null, "state_reason": null}