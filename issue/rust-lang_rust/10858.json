{"url": "https://api.github.com/repos/rust-lang/rust/issues/10858", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10858/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10858/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10858/events", "html_url": "https://github.com/rust-lang/rust/issues/10858", "id": 23921713, "node_id": "MDU6SXNzdWUyMzkyMTcxMw==", "number": 10858, "title": "Borrow checker has inconsistent behavior when handling nested pattern matching", "user": {"login": "ezyang", "id": 13564, "node_id": "MDQ6VXNlcjEzNTY0", "avatar_url": "https://avatars.githubusercontent.com/u/13564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ezyang", "html_url": "https://github.com/ezyang", "followers_url": "https://api.github.com/users/ezyang/followers", "following_url": "https://api.github.com/users/ezyang/following{/other_user}", "gists_url": "https://api.github.com/users/ezyang/gists{/gist_id}", "starred_url": "https://api.github.com/users/ezyang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ezyang/subscriptions", "organizations_url": "https://api.github.com/users/ezyang/orgs", "repos_url": "https://api.github.com/users/ezyang/repos", "events_url": "https://api.github.com/users/ezyang/events{/privacy}", "received_events_url": "https://api.github.com/users/ezyang/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-12-08T10:48:34Z", "updated_at": "2013-12-09T17:13:31Z", "closed_at": "2013-12-09T17:13:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Suppose we have this data type:\n\n``` rust\nenum Nat {\n    S(~Nat),\n    Z\n}\n```\n\nHere are four code snippets which should have the same operational meaning:\n\n(1) Non-nested, ampersand-match\n\n``` rust\nfn foo(input: &Nat) {\n    let mut n = input;\n    loop {\n        n = match n {\n            &S(~ref m) => m,\n            _ => return\n        }\n    }\n}\n```\n\n(2) Non-nested, asterisk-match\n\n``` rust\nfn foo(input: &Nat) {\n    let mut n = input;\n    loop {\n        n = match *n {\n            S(~ref m) => m,\n            _ => return\n        }\n    }\n}\n```\n\n(3) Nested, ampersand-match\n\n``` rust\nfn foo<T>(input: &Nat) {\n    let mut n = input;\n    loop {\n        n = match (n, 0) {\n            (&S(~ref m), _) => m,\n            _ => return\n        }\n    }\n}\n```\n\n(4) Nested, asterisk-match\n\n``` rust\nfn foo<T>(input: &Nat) {\n    let mut n = input;\n    loop {\n        n = match (*n, 0) {\n            (S(~ref m), _) => m,\n            _ => return\n        }\n    }\n}\n```\n\nOut of these snippets, only the fourth fails the borrow check:\n\n```\nbug.rs|10 col 16 error| borrowed value does not live long enough                               \nbug.rs|6 col 23 n| borrowed pointer must be valid for the anonymous lifetime #1 defined on the block at 6:23...\nbug.rs|9 col 12 n| ...but borrowed value is only valid for the match at 9:12\nbug.rs|9 col 19 error| cannot move out of dereference of & pointer\n```\n\nThis seems odd. To me, it would make sense if all four variants were accepted, or if only 1 and 3 were accepted, but for 2 to be accepted while 4 is not is very strange to me.\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10858/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10858/timeline", "performed_via_github_app": null, "state_reason": "completed"}