{"url": "https://api.github.com/repos/rust-lang/rust/issues/43575", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43575/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43575/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43575/events", "html_url": "https://github.com/rust-lang/rust/issues/43575", "id": 246901834, "node_id": "MDU6SXNzdWUyNDY5MDE4MzQ=", "number": 43575, "title": "rustc aborts when there is a compilation failure on FreeBSD and OpenBSD", "user": {"login": "dumbbell", "id": 159804, "node_id": "MDQ6VXNlcjE1OTgwNA==", "avatar_url": "https://avatars.githubusercontent.com/u/159804?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dumbbell", "html_url": "https://github.com/dumbbell", "followers_url": "https://api.github.com/users/dumbbell/followers", "following_url": "https://api.github.com/users/dumbbell/following{/other_user}", "gists_url": "https://api.github.com/users/dumbbell/gists{/gist_id}", "starred_url": "https://api.github.com/users/dumbbell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dumbbell/subscriptions", "organizations_url": "https://api.github.com/users/dumbbell/orgs", "repos_url": "https://api.github.com/users/dumbbell/repos", "events_url": "https://api.github.com/users/dumbbell/events{/privacy}", "received_events_url": "https://api.github.com/users/dumbbell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 311417367, "node_id": "MDU6TGFiZWwzMTE0MTczNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-openbsd", "name": "O-openbsd", "color": "6e6ec0", "default": false, "description": "Operating system: OpenBSD"}, {"id": 311417404, "node_id": "MDU6TGFiZWwzMTE0MTc0MDQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-freebsd", "name": "O-freebsd", "color": "6e6ec0", "default": false, "description": "Operating system: FreeBSD"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-07-31T22:21:53Z", "updated_at": "2021-06-26T21:06:55Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When there is a compilation failure, the Rust compiler aborts with the following output:\r\n\r\n```\r\n$ rustc invalid.rs\r\nerror: requires at least a format string argument\r\n --> invalid.rs:2:5\r\n  |\r\n2 |     print!()\r\n  |     ^^^^^^^^\r\n  |\r\n  = note: this error originates in a macro outside of the current crate\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nfatal runtime error: failed to initiate panic, error 5\r\nAbort trap (core dumped)\r\n```\r\n\r\nI used the following invalid source file:\r\n\r\n```rust\r\nfn main() {\r\n    print!()\r\n}\r\n```\r\n\r\nHere is the backtrace:\r\n\r\n```\r\n(gdb) r\r\nStarting program: /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/rustc invalid.rs\r\n[New LWP 101467 of process 50322]\r\nerror: requires at least a format string argument\r\n --> invalid.rs:2:5\r\n  |\r\n2 |     print!()\r\n  |     ^^^^^^^^\r\n  |\r\n  = note: this error originates in a macro outside of the current crate\r\n\r\nerror: aborting due to previous error(s)\r\n\r\nfatal runtime error: failed to initiate panic, error 5\r\n\r\nThread 2 received signal SIGABRT, Aborted.\r\n[Switching to LWP 101467 of process 50322]\r\n0x0000000801be1b5a in thr_kill () from /lib/libc.so.7\r\n(gdb) bt\r\n#0  0x0000000801be1b5a in thr_kill () from /lib/libc.so.7\r\n#1  0x0000000801be1b24 in __raise (s=6) at /mnt/home/dumbbell/Projects/freebsd/src/SVN/head/lib/libc/gen/raise.c:52\r\n#2  0x0000000801be1a99 in abort () at /mnt/home/dumbbell/Projects/freebsd/src/SVN/head/lib/libc/stdlib/abort.c:65\r\n#3  0x000000080184b5a1 in std::sys_common::util::abort::h1ff3fd43e3f3affb () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/libstd-8923652fdd8a524a.so\r\n#4  0x0000000801859f2e in rust_panic () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/libstd-8923652fdd8a524a.so\r\n#5  0x0000000801859e96 in std::panicking::rust_panic_with_hook::h625888e35dbc23f2 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/libstd-8923652fdd8a524a.so\r\n#6  0x0000000805b69a29 in std::panicking::begin_panic::h334ae91969cdd553 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/lib/../lib/librustc_errors-7119f0b402b67ca4.so\r\n#7  0x0000000805b84415 in rustc_errors::Handler::abort_if_errors::h0cb792d8711ba104 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/lib/../lib/librustc_errors-7119f0b402b67ca4.so\r\n#8  0x0000000801515cd8 in rustc_driver::driver::phase_2_configure_and_expand::_$u7b$$u7b$closure$u7d$$u7d$::hed28ccb91f2e1d2f ()\r\n   from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#9  0x000000080150df01 in rustc_driver::driver::phase_2_configure_and_expand::hfdbd55e50731a10a ()\r\n   from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#10 0x00000008015058f7 in rustc_driver::driver::compile_input::ha42b7de34a40dbc4 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#11 0x0000000801550877 in rustc_driver::run_compiler::h166e93bfe8677c78 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#12 0x00000008014744dc in std::sys_common::backtrace::__rust_begin_short_backtrace::h31e6f5e865f4c216 ()\r\n   from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#13 0x0000000801865907 in __rust_maybe_catch_panic () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/libstd-8923652fdd8a524a.so\r\n#14 0x000000080149a2e1 in _$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$::call_box::h8348efc58e17166f ()\r\n   from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/librustc_driver-d90bd0899d4860c7.so\r\n#15 0x0000000801858948 in std::sys::imp::thread::Thread::new::thread_start::h40165c228796f269 () from /var/ports/obj/mnt/home/dumbbell/Projects/freebsd/ports/SVN/lang/rust/work/rustc-1.19.0-src/build/x86_64-unknown-freebsd/stage2/bin/../lib/libstd-8923652fdd8a524a.so\r\n#16 0x00000008067e8bc5 in thread_start (curthread=0x80b8a2b00) at /mnt/home/dumbbell/Projects/freebsd/src/SVN/head/lib/libthr/thread/thr_create.c:289\r\n#17 0x0000000000000000 in ?? ()\r\nBacktrace stopped: Cannot access memory at address 0x7fffdfffe000\r\n```\r\n\r\nAs you can see in the paths, this is with Rust 1.19.0. The same happens with previous versions, so this isn't a regression (or not a recent one).\r\n\r\nIn the example, Rust was compiled with Clang 4.0.0, but the bundled LLVM was used.\r\n\r\nWhen I compile and run a program which panics, the panic looks to be handled correctly:\r\n```rust\r\nfn main() {\r\n    panic!()\r\n}\r\n```\r\n```\r\n$ RUST_BACKTRACE=1 ./panic \r\nthread 'main' panicked at 'explicit panic', panic.rs:2\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n   1: std::sys_common::backtrace::_print\r\n   2: std::panicking::default_hook::{{closure}}\r\n   3: std::panicking::default_hook\r\n   4: std::panicking::rust_panic_with_hook\r\n   5: std::panicking::begin_panic\r\n   6: panic::main\r\n   7: __rust_maybe_catch_panic\r\n   8: std::rt::lang_start\r\n   9: main\r\n  10: _start\r\n```\r\n\r\nI don't know how to debug this further. I tried with `debuginfo = true` and `debuginfo-lines = true` in `config.toml`, but then the problem vanishes. I'm willing to help but I would like some pointers to where to look :-)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43575/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43575/timeline", "performed_via_github_app": null, "state_reason": null}