{"url": "https://api.github.com/repos/rust-lang/rust/issues/52848", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52848/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52848/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52848/events", "html_url": "https://github.com/rust-lang/rust/issues/52848", "id": 345631518, "node_id": "MDU6SXNzdWUzNDU2MzE1MTg=", "number": 52848, "title": "Leading `::` semantics in macros depend on calling crate, not defining crate.", "user": {"login": "alercah", "id": 20842325, "node_id": "MDQ6VXNlcjIwODQyMzI1", "avatar_url": "https://avatars.githubusercontent.com/u/20842325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alercah", "html_url": "https://github.com/alercah", "followers_url": "https://api.github.com/users/alercah/followers", "following_url": "https://api.github.com/users/alercah/following{/other_user}", "gists_url": "https://api.github.com/users/alercah/gists{/gist_id}", "starred_url": "https://api.github.com/users/alercah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alercah/subscriptions", "organizations_url": "https://api.github.com/users/alercah/orgs", "repos_url": "https://api.github.com/users/alercah/repos", "events_url": "https://api.github.com/users/alercah/events{/privacy}", "received_events_url": "https://api.github.com/users/alercah/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-07-30T06:48:13Z", "updated_at": "2018-11-26T21:26:41Z", "closed_at": "2018-11-26T21:26:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Easiest reproduction is to make a 2018 crate (note: `rust_2018_preview` is not sufficient) that calls the `quote!` macro:\r\n\r\n```rust\r\n#![feature(proc_macro_quote, proc_macro_non_items)]\r\nuse proc_macro::{quote, TokenStream}\r\n\r\n#[proc_macro]\r\nfn macro(input: TokenStream) -> TokenStream {\r\n    quote! { $input }\r\n}\r\n```\r\n\r\nThis gives an error: ``can't find crate for `TokenStream` ``. Upon closer inspection, the offender is [this line](https://doc.rust-lang.org/nightly/src/proc_macro/quote.rs.html#76), and specifically, `::TokenStream::new()`.\r\n\r\nThe issue is that, even though hygiene dictates that this name should be looked up in the defining create, the semantics of leading `::` are not accounted for. In the defining crate, in Rust 2015, it means \"crate root\". In the using crate, Rust 2018, it means \"crate registrar\" (i.e., the thing that holds crate names).\r\n\r\n@petrochenkov, does this impact the stabilization of `Span`? I don't understand how hygeine works when a path has multiple pieces (identifiers or colons) from different caller/definer contexts. (Aside: I would prefer some elucidation for eventual documentation purposes.)\r\n\r\nSee also #44660. I don't think it impacts `$crate` at all, but I'm not sure.", "closed_by": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52848/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52848/timeline", "performed_via_github_app": null, "state_reason": "completed"}