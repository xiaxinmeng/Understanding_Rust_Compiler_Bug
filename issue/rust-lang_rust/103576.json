{"url": "https://api.github.com/repos/rust-lang/rust/issues/103576", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103576/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103576/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103576/events", "html_url": "https://github.com/rust-lang/rust/issues/103576", "id": 1424137620, "node_id": "I_kwDOAAsO6M5U4p2U", "number": 103576, "title": "-C self-contained=yes creates programs that crash on startup (on linux-gnu targets)", "user": {"login": "uweigand", "id": 4154057, "node_id": "MDQ6VXNlcjQxNTQwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4154057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uweigand", "html_url": "https://github.com/uweigand", "followers_url": "https://api.github.com/users/uweigand/followers", "following_url": "https://api.github.com/users/uweigand/following{/other_user}", "gists_url": "https://api.github.com/users/uweigand/gists{/gist_id}", "starred_url": "https://api.github.com/users/uweigand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uweigand/subscriptions", "organizations_url": "https://api.github.com/users/uweigand/orgs", "repos_url": "https://api.github.com/users/uweigand/repos", "events_url": "https://api.github.com/users/uweigand/events{/privacy}", "received_events_url": "https://api.github.com/users/uweigand/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-26T14:27:56Z", "updated_at": "2022-11-17T10:11:24Z", "closed_at": "2022-11-16T19:28:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Compiling and running a \"hello world\" with the `-C self-contained=yes` option on `x64_64-unknown-linux-gnu` results in:\r\n```\r\n$ cat hello.rs \r\nfn main() {\r\n    println!(\"Hello World!\");\r\n}\r\n$ rustc hello.rs -C link-self-contained=yes\r\n$ ./hello \r\nSegmentation fault (core dumped)\r\n```\r\nThis happens with any rust version I tried, in particular `rustc 1.64.0 (a55dd71d5 2022-09-19)`.\r\n\r\nLooking into more details reveals:\r\n```\r\n$ RUSTC_LOG=rustc_codegen_ssa::back::link=info rustc hello.rs -C link-self-contained=yes\r\n[...]\r\n INFO rustc_codegen_ssa::back::link linker stderr:\r\n/usr/bin/ld: warning: cannot find entry symbol _start; defaulting to 0000000000000320\r\n```\r\n\r\nSo what appears to happen is that there are no startup objects available in self-contained mode for the target, therefore no startup objects participate in the link command, and therefore the entry point symbol in the final ELF executable is set to some random address, causing the crash on startup.\r\n\r\nNow, the RELEASES.md file states that `link-self-contained` is not supported on linux-gnu (glibc) targets.  I assume this is still true (the \"normal\" documentation apparently doesn't say)?\r\n\r\nEven so, I guess it would still be much preferable to issue an error (or even just ignore the option), rather than silently creating broken binaries.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103576/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103576/timeline", "performed_via_github_app": null, "state_reason": "completed"}