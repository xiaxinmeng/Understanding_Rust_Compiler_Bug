{"url": "https://api.github.com/repos/rust-lang/rust/issues/93124", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93124/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93124/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93124/events", "html_url": "https://github.com/rust-lang/rust/issues/93124", "id": 1109694739, "node_id": "I_kwDOAAsO6M5CJJkT", "number": 93124, "title": "Windows: Audit, clarify, and add tests for `resolve_exe()` \"append .EXE extension if the extension is different\" (not just missing) behavior.", "user": {"login": "briansmith", "id": 16816, "node_id": "MDQ6VXNlcjE2ODE2", "avatar_url": "https://avatars.githubusercontent.com/u/16816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briansmith", "html_url": "https://github.com/briansmith", "followers_url": "https://api.github.com/users/briansmith/followers", "following_url": "https://api.github.com/users/briansmith/following{/other_user}", "gists_url": "https://api.github.com/users/briansmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/briansmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briansmith/subscriptions", "organizations_url": "https://api.github.com/users/briansmith/orgs", "repos_url": "https://api.github.com/users/briansmith/repos", "events_url": "https://api.github.com/users/briansmith/events{/privacy}", "received_events_url": "https://api.github.com/users/briansmith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2022-01-20T19:39:23Z", "updated_at": "2022-01-21T19:31:58Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I was reading the code for `resolve_exe()` for some reason and I saw this code:\r\n\r\n```rust\r\n    let has_exe_suffix = if exe_path.len() >= EXE_SUFFIX.len() {\r\n        exe_path.bytes()[exe_path.len() - EXE_SUFFIX.len()..]\r\n            .eq_ignore_ascii_case(EXE_SUFFIX.as_bytes())\r\n    } else {\r\n        false\r\n    };\r\n```\r\n(Incidentally, can't this be simplified?)\r\n\r\nThen later:\r\n\r\n```rust\r\n        if has_exe_suffix {\r\n             return [...];\r\n        };\r\n\r\n        // Append `.exe` if not already there.\r\n        path = path::append_suffix(path, EXE_SUFFIX.as_ref());\r\n        if path.try_exists().unwrap_or(false) {\r\n            return Ok(path);\r\n        } else {\r\n            // It's ok to use `set_extension` here because the intent is to\r\n            // remove the extension that was just added.\r\n            path.set_extension(\"\");\r\n            return Ok(path);\r\n        }\r\n```\r\n\r\nAppending EXE_SUFFIX if the extension isn't already EXE seems wrong to me; I think instead it would make more sense to use exactly the same rules that `CreateProcessW` is documented to use, which is roughly \"there is no extension,\" not \"the extension isn't .exe\".\r\n\r\n~~Further, let's say there is an extension that isn't EXE_SUFFIX, and we append EXE_SUFFIX and we find that the file doesn't exist. Then we remove the extension. The comment implies that this will reset the extension to what it was before, but this is only true if there was no extension at all. What if there was an extension that wasn't EXE_SUFFIX?~~", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93124/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93124/timeline", "performed_via_github_app": null, "state_reason": null}