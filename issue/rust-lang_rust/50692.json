{"url": "https://api.github.com/repos/rust-lang/rust/issues/50692", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50692/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50692/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50692/events", "html_url": "https://github.com/rust-lang/rust/issues/50692", "id": 322535533, "node_id": "MDU6SXNzdWUzMjI1MzU1MzM=", "number": 50692, "title": "Type inference error when accessing field", "user": {"login": "df5602", "id": 22869241, "node_id": "MDQ6VXNlcjIyODY5MjQx", "avatar_url": "https://avatars.githubusercontent.com/u/22869241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/df5602", "html_url": "https://github.com/df5602", "followers_url": "https://api.github.com/users/df5602/followers", "following_url": "https://api.github.com/users/df5602/following{/other_user}", "gists_url": "https://api.github.com/users/df5602/gists{/gist_id}", "starred_url": "https://api.github.com/users/df5602/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/df5602/subscriptions", "organizations_url": "https://api.github.com/users/df5602/orgs", "repos_url": "https://api.github.com/users/df5602/repos", "events_url": "https://api.github.com/users/df5602/events{/privacy}", "received_events_url": "https://api.github.com/users/df5602/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-05-12T19:09:50Z", "updated_at": "2018-05-15T15:50:09Z", "closed_at": "2018-05-15T15:50:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "I [was advised](https://users.rust-lang.org/t/strange-type-inference-error/17406) to open an issue here, so here goes:\r\n\r\nI stumbled upon a strange compile error today, that I have minimized to the following example ([Playground](https://play.rust-lang.org/?gist=3c4cca9e52544d0416622b9c15e714e7&version=stable&mode=debug)):\r\n\r\n```\r\n#[derive(Copy, Clone, Debug)]\r\nstruct Element {\r\n    next: Option<usize>,\r\n}\r\n\r\nfn main() {\r\n    let array = [Element { next: None }; 16];\r\n    let number: usize = 42;\r\n    let mut option = None;\r\n\r\n    match option {\r\n        Some(n) => {\r\n            // This alone compiles\r\n            let bar = array[n];\r\n            println!(\"Number is {:?}\", bar);\r\n\r\n            // The following doesn't compile:\r\n\r\n            // error[E0282]: type annotations needed\r\n            //  --> src/main.rs:19:23\r\n            //    |\r\n            // 19 |             let foo = array[n].next;\r\n            //    |                       ^^^^^^^^^^^^^ cannot infer type for `_`\r\n\r\n            let foo = array[n].next;\r\n            println!(\"Number is {:?}\", foo);\r\n        }\r\n        None => option = Some(number),\r\n    }\r\n\r\n    println!(\"{:?}\", option);\r\n}\r\n```\r\n\r\nWhat's strange is that when I add a purposefully wrong type annotation like this:\r\n```\r\nlet bar: bool = array[n];\r\n```\r\nthe compiler correctly recognizes that `bool` is the wrong type and even tells me the correct type:\r\n```\r\nerror[E0271]: type mismatch resolving `<usize as std::slice::SliceIndex<[Element]>>::Output == bool`\r\n  --> src/main.rs:14:29\r\n   |\r\n14 |             let bar: bool = array[n];\r\n   |                             ^^^^^^^^ expected struct `Element`, found bool\r\n   |\r\n   = note: expected type `Element`\r\n              found type `bool`\r\n```\r\nHowever, as soon as I try to access a field, type inference fails. (Basically it knows that `array[n]` is of type `Element`, but later cannot infer the type of `array[n].next`.)\r\n\r\nIs this a known limitation of type inference?\r\n\r\n(EDIT: I'm aware that I can get rid of the compile error by adding a type annotation to the declaration of `option`. I'm just surprised by the behaviour of type inference in this example..)", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50692/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50692/timeline", "performed_via_github_app": null, "state_reason": "completed"}