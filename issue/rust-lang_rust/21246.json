{"url": "https://api.github.com/repos/rust-lang/rust/issues/21246", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21246/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21246/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21246/events", "html_url": "https://github.com/rust-lang/rust/issues/21246", "id": 54604144, "node_id": "MDU6SXNzdWU1NDYwNDE0NA==", "number": 21246, "title": "rustdoc --test looking for non-existent shared object", "user": {"login": "mrobinson", "id": 13536, "node_id": "MDQ6VXNlcjEzNTM2", "avatar_url": "https://avatars.githubusercontent.com/u/13536?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrobinson", "html_url": "https://github.com/mrobinson", "followers_url": "https://api.github.com/users/mrobinson/followers", "following_url": "https://api.github.com/users/mrobinson/following{/other_user}", "gists_url": "https://api.github.com/users/mrobinson/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrobinson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrobinson/subscriptions", "organizations_url": "https://api.github.com/users/mrobinson/orgs", "repos_url": "https://api.github.com/users/mrobinson/repos", "events_url": "https://api.github.com/users/mrobinson/events{/privacy}", "received_events_url": "https://api.github.com/users/mrobinson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2015-01-16T17:49:49Z", "updated_at": "2016-05-24T21:41:38Z", "closed_at": "2015-04-16T20:35:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "In Servo, we use very few rustdoc examples. In one particular crate `util` there is a single rustdoc example, so Cargo runs `rustdoc --test`.  `util` depends on an external crate `rust-layers`, which in turn depends on an external crate `rust-azure`. Although, a compiled rlib of libazure is available, rustc will try to link against both the libazure rlib and `-lazure`. Since `-lazure` doesn't exist, linking fails.\n\nThe rustdoc command-line (apologies for the long command):\n\n```\nrustdoc\n--test lib.rs\n--crate-name util\n-L /home/martin/work/servo/components/servo/target\n-L /home/martin/work/servo/components/servo/target/deps\n--extern task_info=/home/martin/work/servo/components/servo/target/deps/libtask_info-5be8a31f468e0e09.rlib\n--extern time=/home/martin/work/servo/components/servo/target/deps/libtime-ad4e077cbdd35a18.rlib\n--extern xxhash=/home/martin/work/servo/components/servo/target/deps/libxxhash-245c85292ece0c63.rlib\n--extern encoding-index-korean=/home/martin/work/servo/components/servo/target/deps/libencoding-index-korean-7f619e1decbc8e76.rlib\n--extern skia-sys=/home/martin/work/servo/components/servo/target/deps/libskia-sys-a0c97fb5e4120410.rlib\n--extern script_traits=/home/martin/work/servo/components/servo/target/deps/libscript_traits-4a5ed80e950d9f94.rlib\n--extern layers=/home/martin/work/servo/components/servo/target/deps/liblayers-d7491f1d2aeed9ac.rlib\n--extern io_surface=/home/martin/work/servo/components/servo/target/deps/libio_surface-5397fd6555ddcd0c.rlib\n--extern openssl-sys=/home/martin/work/servo/components/servo/target/deps/libopenssl-sys-8d5618621883f42c.rlib\n--extern encoding-index-tradchinese=/home/martin/work/servo/components/servo/target/deps/libencoding-index-tradchinese-47f074fd879a44ba.rlib\n--extern text_writer=/home/martin/work/servo/components/servo/target/deps/libtext_writer-83aeadef5ad6c975.rlib\n--extern mucell=/home/martin/work/servo/components/servo/target/deps/libmucell-15aa001c80416321.rlib\n--extern url=/home/martin/work/servo/components/servo/target/deps/liburl-e5595358222a824d.rlib\n--extern stb_image=/home/martin/work/servo/components/servo/target/deps/libstb_image-8789d241efd7f3ef.rlib\n--extern hyper=/home/martin/work/servo/components/servo/target/deps/libhyper-890ae9892b5e4aec.rlib\n--extern png=/home/martin/work/servo/components/servo/target/deps/libpng-2a5686ec81c888ef.rlib\n--extern glfw=/home/martin/work/servo/components/servo/target/deps/libglfw-0fe09eeb0e447723.rlib\n--extern html5ever_macros=/home/martin/work/servo/components/servo/target/deps/libhtml5ever_macros-eafc84b872baff98.so\n--extern mime=/home/martin/work/servo/components/servo/target/deps/libmime-4b114bc7d7856ad5.rlib\n--extern core_graphics=/home/martin/work/servo/components/servo/target/deps/libcore_graphics-68ea1861802926eb.rlib\n--extern cgl=/home/martin/work/servo/components/servo/target/deps/libcgl-f832515e1e91a735.rlib\n--extern gl_common=/home/martin/work/servo/components/servo/target/deps/libgl_common-66a5d21dea94490e.rlib\n--extern plugins=/home/martin/work/servo/components/servo/target/deps/libplugins-46498ed719ee555c.so\n--extern devtools=/home/martin/work/servo/components/servo/target/deps/libdevtools-94abee49a4652e76.rlib\n--extern freetype-sys=/home/martin/work/servo/components/servo/target/deps/libfreetype-sys-2000ed3efd86d8e0.rlib\n--extern compositing=/home/martin/work/servo/components/servo/target/deps/libcompositing-c013b590201fd820.rlib\n--extern core_foundation=/home/martin/work/servo/components/servo/target/deps/libcore_foundation-81f453a644bdecba.rlib\n--extern servo=/home/martin/work/servo/components/servo/target/libservo-855886321a28c984.rlib\n--extern encoding-index-japanese=/home/martin/work/servo/components/servo/target/deps/libencoding-index-japanese-78d9d2f7567be380.rlib\n--extern gleam=/home/martin/work/servo/components/servo/target/deps/libgleam-e5559c03c0bebfba.rlib\n--extern gl_generator=/home/martin/work/servo/components/servo/target/deps/libgl_generator-14b70861eb330221.so\n--extern unsafe-any=/home/martin/work/servo/components/servo/target/deps/libunsafe-any-3d2f45b7c92200ea.rlib\n--extern devtools_traits=/home/martin/work/servo/components/servo/target/deps/libdevtools_traits-8c99a10e26f4a822.rlib\n--extern string_cache_macros=/home/martin/work/servo/components/servo/target/deps/libstring_cache_macros-c486c481d0b8fc2d.so\n--extern js=/home/martin/work/servo/components/servo/target/deps/libjs-7a5e44e37945e142.rlib\n--extern cssparser=/home/martin/work/servo/components/servo/target/deps/libcssparser-7a9a471368ea9b30.rlib\n--extern lazy_static=/home/martin/work/servo/components/servo/target/deps/liblazy_static-518089d616e0fe56.rlib\n--extern xml-rs=/home/martin/work/servo/components/servo/target/deps/libxml-a9be98b4dd785d98.rlib\n--extern freetype=/home/martin/work/servo/components/servo/target/deps/libfreetype-f9e33152a2a3bfec.rlib\n--extern encoding=/home/martin/work/servo/components/servo/target/deps/libencoding-5d9283f8df6a2add.rlib\n--extern semver=/home/martin/work/servo/components/servo/target/deps/libsemver-7a9674597d634bab.rlib\n--extern xlib=/home/martin/work/servo/components/servo/target/deps/libxlib-ecde648e63fc4987.rlib\n--extern mozjs-sys=/home/martin/work/servo/components/servo/target/deps/libmozjs-sys-c58a7d09513f4944.rlib\n--extern cookie=/home/martin/work/servo/components/servo/target/deps/libcookie-03a3f41cb989f010.rlib\n--extern azure=/home/martin/work/servo/components/servo/target/deps/libazure-83ae91b5b2ebf272.rlib\n--extern geom=/home/martin/work/servo/components/servo/target/deps/libgeom-92d0f13f38b09c46.rlib\n--extern layout=/home/martin/work/servo/components/servo/target/deps/liblayout-3ca85d45132c804e.rlib\n--extern layout_traits=/home/martin/work/servo/components/servo/target/deps/liblayout_traits-be835a4136e0cd58.rlib\n--extern phf_mac=/home/martin/work/servo/components/servo/target/deps/libphf_mac-3d2c5d82d0785fb6.so\n--extern png-sys=/home/martin/work/servo/components/servo/target/deps/libpng-sys-ea1e7c315521d32b.rlib\n--extern phf=/home/martin/work/servo/components/servo/target/deps/libphf-987a440fbd694b69.rlib\n--extern encoding_index_tests=/home/martin/work/servo/components/servo/target/deps/libencoding_index_tests-9b89d508f8de6115.rlib\n--extern style=/home/martin/work/servo/components/servo/target/deps/libstyle-2978bbcc267713b3.rlib\n--extern glx=/home/martin/work/servo/components/servo/target/deps/libglx-525f8d390c2e2b0a.rlib\n--extern encoding-index-singlebyte=/home/martin/work/servo/components/servo/target/deps/libencoding-index-singlebyte-e8309dce7b73ab02.rlib\n--extern gcc=/home/martin/work/servo/components/servo/target/deps/libgcc-aad54793e4efcc66.rlib\n--extern msg=/home/martin/work/servo/components/servo/target/deps/libmsg-20eac35e27b67ccc.rlib\n--extern glfw-sys=/home/martin/work/servo/components/servo/target/deps/libglfw-sys-362ff9a8d4dbbbbe.rlib\n--extern glfw_app=/home/martin/work/servo/components/servo/target/deps/libglfw_app-788e77e5e6af1978.rlib\n--extern uuid=/home/martin/work/servo/components/servo/target/deps/libuuid-7c7b259bcfa9d945.rlib\n--extern khronos_api=/home/martin/work/servo/components/servo/target/deps/libkhronos_api-e6fe334e9439e073.rlib\n--extern html5ever=/home/martin/work/servo/components/servo/target/deps/libhtml5ever-80898f0002ba0361.rlib\n--extern encoding-index-simpchinese=/home/martin/work/servo/components/servo/target/deps/libencoding-index-simpchinese-2d7c8c32f7e9f2b2.rlib\n--extern script=/home/martin/work/servo/components/servo/target/deps/libscript-220adde19382d644.rlib\n--extern fontconfig-sys=/home/martin/work/servo/components/servo/target/deps/libfontconfig-sys-4770bf8b8048ff82.rlib\n--extern egl=/home/martin/work/servo/components/servo/target/deps/libegl-90ba2a473034ea1d.rlib\n--extern core_text=/home/martin/work/servo/components/servo/target/deps/libcore_text-4b909a19bc1f7938.rlib\n--extern harfbuzz=/home/martin/work/servo/components/servo/target/deps/libharfbuzz-d615f1063bc88db4.rlib\n--extern canvas=/home/martin/work/servo/components/servo/target/deps/libcanvas-c458de241a3c060e.rlib\n--extern openssl=/home/martin/work/servo/components/servo/target/deps/libopenssl-089fe2b2f27936a4.rlib\n--extern fontconfig=/home/martin/work/servo/components/servo/target/deps/libfontconfig-c046fa4ca41605a4.rlib\n--extern net=/home/martin/work/servo/components/servo/target/deps/libnet-d859c8cdb0b02e68.rlib\n--extern gfx=/home/martin/work/servo/components/servo/target/deps/libgfx-97756b549a7d8f02.rlib\n--extern pkg-config=/home/martin/work/servo/components/servo/target/deps/libpkg-config-0d932ed646ef39a5.rlib\n--extern string_cache=/home/martin/work/servo/components/servo/target/deps/libstring_cache-1cf14970ab03ef33.rlib\n--extern util=/home/martin/work/servo/components/servo/target/deps/libutil-6e3cdc53c8c7e07c.rlib\n--extern expat-sys=/home/martin/work/servo/components/servo/target/deps/libexpat-sys-3543c70bfcd7875f.rlib\n```\n\nThe failing linking line produced by rustc:\n\n```\nerror: linking with `cc` failed: exit code: 1 note:\n    cc '-Wl,--as-needed' '-m64' '-L'\n    '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-o' '/tmp/rs-3179-0-rustdoctest/rust-out'\n    '/tmp/rs-3179-0-rustdoctest/rust_out.o'\n    '-Wl,--whole-archive'\n    '-lmorestack'\n    '-Wl,--no-whole-archive'\n    '-Wl,--gc-sections'\n    '-pie'\n    '-nodefaultlibs'\n    '/home/martin/work/servo/components/servo/target/deps/libutil-6e3cdc53c8c7e07c.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libcssparser-7a9a471368ea9b30.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/liblayers-d7491f1d2aeed9ac.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libazure-83ae91b5b2ebf272.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libgleam-e5559c03c0bebfba.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libgl_common-66a5d21dea94490e.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-5d9283f8df6a2add.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-index-simpchinese-2d7c8c32f7e9f2b2.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-index-tradchinese-47f074fd879a44ba.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libxlib-ecde648e63fc4987.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-index-singlebyte-e8309dce7b73ab02.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libglx-525f8d390c2e2b0a.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libtext_writer-83aeadef5ad6c975.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libtime-ad4e077cbdd35a18.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/liburl-e5595358222a824d.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-index-korean-7f619e1decbc8e76.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libfreetype-f9e33152a2a3bfec.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libencoding-index-japanese-78d9d2f7567be380.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libstring_cache-1cf14970ab03ef33.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libphf-987a440fbd694b69.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libxxhash-245c85292ece0c63.rlib'\n    '/home/martin/work/servo/components/servo/target/deps/libgeom-92d0f13f38b09c46.rlib'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-ltest-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lterm-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lserialize-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-llog-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lregex-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lgetopts-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lstd-4e7c5e5c'\n    '-L' '/home/martin/.servo/rust/2cfb5acb5a2751c759627377e602bac4f88f2d19/rust-0.13.0-dev-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib'\n    '-lrustrt-4e7c5e5c'\n    '-L' '/home/martin/work/servo/components/servo/target'\n    '-L' '/home/martin/work/servo/components/servo/target/deps'\n    '-L' '/home/martin/work/servo/components/util/.rust'\n    '-L' '/home/martin/work/servo/components/util'\n    '-Wl,--whole-archive'\n    '-Wl,-Bstatic'\n    '-Wl,--no-whole-archive'\n    '-Wl,-Bdynamic'\n    '-lGL'\n    '-lstdc++'\n    '-lfreetype'\n    '-lbz2'\n    '-lfontconfig'\n    '-lexpat'\n    '-lX11'\n    '-lazure'\n    '-lX11'\n    '-lrt'\n    '-lfreetype'\n    '-ldl'\n    '-lpthread'\n    '-lrt'\n    '-lgcc_s'\n    '-lpthread'\n    '-lc'\n    '-lm'\n    '-lcompiler-rt'\nnote: /usr/bin/ld: cannot find -lazure\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21246/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21246/timeline", "performed_via_github_app": null, "state_reason": "completed"}