{"url": "https://api.github.com/repos/rust-lang/rust/issues/17636", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/17636/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/17636/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/17636/events", "html_url": "https://github.com/rust-lang/rust/issues/17636", "id": 44360899, "node_id": "MDU6SXNzdWU0NDM2MDg5OQ==", "number": 17636, "title": "ICE - ReInfer left in a type when using closures", "user": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2014-09-29T21:43:47Z", "updated_at": "2014-10-18T15:07:23Z", "closed_at": "2014-10-18T15:07:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code (seems minimal) ICEs:\n\n``` Rust\ntrait MyItem<T> {} \nimpl<T> MyItem<T> for T {}\n\npub fn build_archive<'a, I: MyItem<&'a (|&uint|:'a)>>(files: I) {}\n\nfn main() {\n  build_archive(&(|_| { }));\n}\n```\n\nwith the following error\n\n```\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'assertion failed: !ty::type_needs_infer(ty)', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/librustc/middle/typeck/mod.rs:287\n\nstack backtrace:\n1: 0x7f589d110740 - rt::backtrace::imp::write::heebf58b6ac691aa6vUq\n2: 0x7f589d113900 - failure::on_fail::h204692c9d758e6bbXfr\n3: 0x7f58a18112d0 - unwind::begin_unwind_inner::h5df2dc6f14b19f71MTd\n4: 0x7f58a1e58dd0 - unwind::begin_unwind::h1137722113218807222\n5: 0x7f58a237e120 - middle::typeck::write_ty_to_tcx::h340434295f08522e9Cj\n6: 0x7f58a237b180 - middle::typeck::check::writeback::WritebackCx<'cx, 'tcx>::visit_node_id::h2f07137fb6ba1caenvL\n7: 0x7f58a23792a0 - middle::typeck::check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h1b9edac22fa294eenkL\n8: 0x7f58a23792a0 - middle::typeck::check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_expr::h1b9edac22fa294eenkL\n9: 0x7f58a237ac90 - middle::typeck::check::writeback::WritebackCx<'cx, 'tcx>.Visitor<'v>::visit_block::h636f3cf043625202KlL\n10: 0x7f58a237aad0 - middle::typeck::check::writeback::resolve_type_vars_in_fn::h2b973af1fdf4e8b0DfL\n11: 0x7f58a23c8cc0 - middle::typeck::check::check_bare_fn::h1bff9ee5f4e84535f9R\n12: 0x7f58a23c4a50 - middle::typeck::check::check_item::h1c01578942bc4bfaiBS\n13: 0x7f58a23c8770 - middle::typeck::check::check_item_types::hbc5ac40f3d3cae1ap8R\n14: 0x7f58a1e774b0 - util::common::time::h5723798609349898350\n15: 0x7f58a266fad0 - middle::typeck::check_crate::h5732ccea6ca40e95FVj\n16: 0x7f58a26d9600 - driver::driver::phase_3_run_analysis_passes::h5c6d0a55804972d1pqw\n17: 0x7f58a26d4d50 - driver::driver::compile_input::hd84cb07887cabc36m7v\n18: 0x7f58a2757000 - driver::run_compiler::h0b16c0ac7a7e28ceeXz\n19: 0x7f58a2756ee0 - driver::main_args::closure.145992\n20: 0x7f58a1e905f0 - task::TaskBuilder<S>::try_future::closure.101285\n21: 0x7f58a1e903e0 - task::TaskBuilder<S>::spawn_internal::closure.101256\n22: 0x7f58a1b60650 - task::spawn_opts::closure.8485\n23: 0x7f58a1867480 - rust_try_inner\n24: 0x7f58a1867470 - rust_try\n25: 0x7f58a180e910 - unwind::try::h8c8d3e6eb0ca16a6uId\n26: 0x7f58a180e770 - task::Task::run::hfb873359c59e1424cYc\n27: 0x7f58a1b603c0 - task::spawn_opts::closure.8425\n28: 0x7f58a1810360 - thread::thread_start::h2b0150e66287e12frid\n29: 0x7f589c4bcfe0 - start_thread\n30: 0x7f58a14e0bf9 - __clone\n31: 0x0 - <unknown>\n```\n\nThe issue seems to be a ReInfer left in a type, and it seems to be related to an heisenbug that me and eddyb faced while refactoring ty::t.\n\nThe issue seems to be present at least in versions 2550243b4 to 1f3cda8bd, but `play.rust-lang.org`'s Rust 0.11 seems to return a (seemingly wrong) type error instead of ICE'ing: \n`error: cannot determine a type for this bounded type parameter: unconstrained type`.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/17636/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/17636/timeline", "performed_via_github_app": null, "state_reason": "completed"}