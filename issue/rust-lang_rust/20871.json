{"url": "https://api.github.com/repos/rust-lang/rust/issues/20871", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20871/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20871/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20871/events", "html_url": "https://github.com/rust-lang/rust/issues/20871", "id": 53959005, "node_id": "MDU6SXNzdWU1Mzk1OTAwNQ==", "number": 20871, "title": "Make return type of the `Fn` traits an associated type", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}], "state": "closed", "locked": false, "assignee": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/22", "html_url": "https://github.com/rust-lang/rust/milestone/22", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/22/labels", "id": 924511, "node_id": "MDk6TWlsZXN0b25lOTI0NTEx", "number": 22, "title": "1.0 beta", "description": "", "creator": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 80, "state": "closed", "created_at": "2015-01-06T21:40:55Z", "updated_at": "2015-04-08T23:57:21Z", "due_on": null, "closed_at": "2015-04-08T23:57:21Z"}, "comments": 11, "created_at": "2015-01-10T14:03:02Z", "updated_at": "2015-01-28T14:42:26Z", "closed_at": "2015-01-28T14:42:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I think that the argument types cannot be an associated type, but the return type of the `Fn` traits can and ought to be.\n### Why make the return type associated?\n\nIt seems right: I don't think I want the ability to have functions overloaded purely on return type. A similar argument was [gracefully made by @aturon regarding binary operators recently](http://discuss.rust-lang.org/t/implicit-widening-polymorphic-indexing-and-similar-ideas/1141/15?u=nikomatsakis).\n\nBut also, it would make an impl like example (from @alexcrichton) legal:\n\n``` rust\nimpl<R,F> Foo for F : FnMut() -> R { ... }\n```\n\nRight now this is illegal because the type `R` is unconstrained. This is kind of counter-intuitive.\n### Why not make the argument types associated?\n\nThe reason that the argument types cannot be associated is because of HRTB. Imagine we have a constraint like `F : Fn(&i32) -> &i32`. Now, if both `A` and `R` were associated types, we'd have to be able to evaluate independent projections like `F::A` and `F::R` but ensure that we got consistent lifetimes in both cases -- unfortunately, we can't do that, because there is nothing linking the lifetimes together. Put another way, if `A` and `R` were associated types, then `F : Fn(&i32) -> &i32` would be sugared into three predicates internally:\n- `F : Fn`\n- `for<'a> <F as Fn>::A == &'a i32`\n- `for<'b> <F as Fn>::R == &'b i32`\n\nNote that the connection between A and R has been lost. (While implementing associated types, I spent a while trying to make this work out, and it really...just doesn't.)\n\nOn the other hand, if we convert _just_ the return type to be an associated type, the example works just fine. We desugar the `F : Fn(&i32) -> &i32` example into:\n- `for<'a> F : Fn<(&'a i32,)>`\n- `for<'a> <F as Fn<(&'a i32,)>>::R == &'a i32`\n\nAnother reason not to make the argument types associated is that it permits more overloading. For example, the \"identity\" function works (hat tip: @eddyb):\n\n``` rust\nstruct Identity;\nimpl<A> Fn(A) for Identity {\n    type R = A;\n    fn call(&self, (arg,): (A,)) -> A {\n        arg\n    }\n}\n```\n\ncc @aturon @huonw \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20871/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20871/timeline", "performed_via_github_app": null, "state_reason": "completed"}