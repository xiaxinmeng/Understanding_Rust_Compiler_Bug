{"url": "https://api.github.com/repos/rust-lang/rust/issues/36913", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36913/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36913/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36913/events", "html_url": "https://github.com/rust-lang/rust/issues/36913", "id": 180533659, "node_id": "MDU6SXNzdWUxODA1MzM2NTk=", "number": 36913, "title": "armhf binaries still use NEON", "user": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-10-02T20:36:37Z", "updated_at": "2016-10-06T22:05:50Z", "closed_at": "2016-10-04T23:30:43Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I was just investigating a [report](https://ml.mageia.org/l/arc/dev/2016-10/msg00040.html) that Fedora's rust binaries for armv7hl use NEON, but they should not per #35590, supposedly fixed in #35814.  (Fedora's build is 1.11, but I applied that patch.)  I can see the exact same issue in the latest official `rustc-nightly-armv7-unknown-linux-gnueabihf.tar.gz`, whose version file says `1.14.0-nightly (289f3a4ca 2016-09-29)`.\n\n```\n# arm-linux-gnu-objdump -d libstd-*.so | grep '<.*lang_start.*>:' -A30\n0006ccf0 <_ZN3std2rt10lang_start17hdfc48bc748089cb2E>:\n   6ccf0:       e92d4ff0        push    {r4, r5, r6, r7, r8, r9, sl, fp, lr}\n   6ccf4:       e24ddf45        sub     sp, sp, #276    ; 0x114\n   6ccf8:       e1a09001        mov     r9, r1\n   6ccfc:       e1a0b000        mov     fp, r0\n   6cd00:       e3a0000d        mov     r0, #13\n   6cd04:       e3a01001        mov     r1, #1\n   6cd08:       e1a0a002        mov     sl, r2\n   6cd0c:       ebff5534        bl      421e4 <signal@plt>\n   6cd10:       e3700001        cmn     r0, #1\n   6cd14:       0a000134        beq     6d1ec <_ZN3std2rt10lang_start17hdfc48bc748089cb2E+0x4fc>\n   6cd18:       e59f0788        ldr     r0, [pc, #1928] ; 6d4a8 <_ZN3std2rt10lang_start17hdfc48bc748089cb2E+0x7b8>\n   6cd1c:       e08f0000        add     r0, pc, r0\n   6cd20:       ebff5856        bl      42e80 <_ZN5alloc3oom15set_oom_handler17hfc02679a00c1734eE@plt>\n   6cd24:       e3a0001e        mov     r0, #30\n   6cd28:       ebff5509        bl      42154 <sysconf@plt>\n   6cd2c:       e1a07000        mov     r7, r0\n   6cd30:       e28d0050        add     r0, sp, #80     ; 0x50\n   6cd34:       f2c00050        vmov.i32        q8, #0  ; 0x00000000\n   6cd38:       e3a06000        mov     r6, #0\n   6cd3c:       e1a01000        mov     r1, r0\n   6cd40:       f4410acd        vst1.64 {d16-d17}, [r1]!\n   6cd44:       f4410acf        vst1.64 {d16-d17}, [r1]\n   6cd48:       e58d6070        str     r6, [sp, #112]  ; 0x70\n   6cd4c:       ebff57d1        bl      42c98 <pthread_attr_init@plt>\n   6cd50:       e59f1754        ldr     r1, [pc, #1876] ; 6d4ac <_ZN3std2rt10lang_start17hdfc48bc748089cb2E+0x7bc>\n   6cd54:       e28d8c01        add     r8, sp, #256    ; 0x100\n   6cd58:       e58d0100        str     r0, [sp, #256]  ; 0x100\n   6cd5c:       e3500000        cmp     r0, #0\n   6cd60:       e58d80f4        str     r8, [sp, #244]  ; 0xf4\n   6cd64:       e08f1001        add     r1, pc, r1\n```\n\nIn particular, they flagged that `vmov.i32 q8, #0` as a problem.  I'm no ARM expert, but from [this](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dht0002a/ch01s03s02.html) it appears the `qN` registers are NEON-only.  I believe those instructions using `{d16-d17}` are also a problem, because with VFP3-D16 we should only have `d0` to `d15`.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36913/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36913/timeline", "performed_via_github_app": null, "state_reason": "completed"}