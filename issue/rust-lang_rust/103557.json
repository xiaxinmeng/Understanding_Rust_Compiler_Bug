{"url": "https://api.github.com/repos/rust-lang/rust/issues/103557", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103557/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103557/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103557/events", "html_url": "https://github.com/rust-lang/rust/issues/103557", "id": 1423296802, "node_id": "I_kwDOAAsO6M5U1cki", "number": 103557, "title": "bootstrap: Document that setting `description` changes the version hash", "user": {"login": "mikebenfield", "id": 543755, "node_id": "MDQ6VXNlcjU0Mzc1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/543755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikebenfield", "html_url": "https://github.com/mikebenfield", "followers_url": "https://api.github.com/users/mikebenfield/followers", "following_url": "https://api.github.com/users/mikebenfield/following{/other_user}", "gists_url": "https://api.github.com/users/mikebenfield/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikebenfield/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikebenfield/subscriptions", "organizations_url": "https://api.github.com/users/mikebenfield/orgs", "repos_url": "https://api.github.com/users/mikebenfield/repos", "events_url": "https://api.github.com/users/mikebenfield/events{/privacy}", "received_events_url": "https://api.github.com/users/mikebenfield/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-10-26T01:17:04Z", "updated_at": "2023-02-03T05:46:32Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If I change `description = ` in `config.toml`, the Crate IDs change, which leads to different name mangling. In particular this means it's not possible to use PGO profiles produced by a compiler with one description to build a compiler with a different description. Is this intentional?\r\n\r\nI'm not sure if v0 mangling actually has anything to do with this, but that's where it was convenient for me to insert the code to print IDs. \r\n\r\nTo see this, apply this patch:\r\n```\r\nFrom 705dac4190d0e1c67a848b5af4ba6fc51e3aaa56 Mon Sep 17 00:00:00 2001\r\nFrom: Michael Benfield <mbenfield@google.com>\r\nDate: Wed, 26 Oct 2022 01:11:29 +0000\r\nSubject: [PATCH] print\r\n\r\n---\r\n compiler/rustc_symbol_mangling/src/v0.rs | 3 +++\r\n 1 file changed, 3 insertions(+)\r\n\r\ndiff --git a/compiler/rustc_symbol_mangling/src/v0.rs b/compiler/rustc_symbol_mangling/src/v0.rs\r\nindex ecfe6861e84..ee21131970f 100644\r\n--- a/compiler/rustc_symbol_mangling/src/v0.rs\r\n+++ b/compiler/rustc_symbol_mangling/src/v0.rs\r\n@@ -739,6 +739,9 @@ fn path_crate(self, cnum: CrateNum) -> Result<Self::Path, Self::Error> {\r\n         let stable_crate_id = self.tcx.def_path_hash(cnum.as_def_id()).stable_crate_id();\r\n         self.push_disambiguator(stable_crate_id.to_u64());\r\n         let name = self.tcx.crate_name(cnum);\r\n+        if name.as_str().contains(\"rustc_serialize\") {\r\n+            println!(\"XXX {} : {:X}\", name.as_str(), stable_crate_id.to_u64());\r\n+        }\r\n         self.push_ident(name.as_str());\r\n         Ok(self)\r\n     }\r\n-- \r\n```\r\n\r\nand make these two files:\r\n\r\n```\r\n% cat configA.toml \r\n[rust]\r\ndescription = \"A\"\r\nnew-symbol-mangling = true\r\n~/Code/rust3  [ mbenfield ]\r\n% cat configB.toml \r\n[rust]\r\ndescription = \"B\"\r\nnew-symbol-mangling = true\r\n```\r\n\r\nthen do \r\n```\r\n./x.py build --stage 2 --config configA.toml | grep XXX\r\n```\r\nand\r\n```\r\n./x.py build --stage 2 --config configB.toml | grep XXX\r\n```\r\n\r\nand you'll get different outputs.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103557/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103557/timeline", "performed_via_github_app": null, "state_reason": null}