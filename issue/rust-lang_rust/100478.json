{"url": "https://api.github.com/repos/rust-lang/rust/issues/100478", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/100478/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/100478/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/100478/events", "html_url": "https://github.com/rust-lang/rust/issues/100478", "id": 1337861340, "node_id": "I_kwDOAAsO6M5PviTc", "number": 100478, "title": "rustc enters an infinite loop when doing cargo check", "user": {"login": "cosven", "id": 4962134, "node_id": "MDQ6VXNlcjQ5NjIxMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4962134?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cosven", "html_url": "https://github.com/cosven", "followers_url": "https://api.github.com/users/cosven/followers", "following_url": "https://api.github.com/users/cosven/following{/other_user}", "gists_url": "https://api.github.com/users/cosven/gists{/gist_id}", "starred_url": "https://api.github.com/users/cosven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cosven/subscriptions", "organizations_url": "https://api.github.com/users/cosven/orgs", "repos_url": "https://api.github.com/users/cosven/repos", "events_url": "https://api.github.com/users/cosven/events{/privacy}", "received_events_url": "https://api.github.com/users/cosven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "chenyukang", "id": 230646, "node_id": "MDQ6VXNlcjIzMDY0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/230646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chenyukang", "html_url": "https://github.com/chenyukang", "followers_url": "https://api.github.com/users/chenyukang/followers", "following_url": "https://api.github.com/users/chenyukang/following{/other_user}", "gists_url": "https://api.github.com/users/chenyukang/gists{/gist_id}", "starred_url": "https://api.github.com/users/chenyukang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chenyukang/subscriptions", "organizations_url": "https://api.github.com/users/chenyukang/orgs", "repos_url": "https://api.github.com/users/chenyukang/repos", "events_url": "https://api.github.com/users/chenyukang/events{/privacy}", "received_events_url": "https://api.github.com/users/chenyukang/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2022-08-13T05:17:04Z", "updated_at": "2022-09-12T08:46:53Z", "closed_at": "2022-09-12T08:46:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\nalong with any information you feel relevant to replicating the bug.\n-->\n\nRun cargo check on this code: https://github.com/cosven/tikv/commit/861b3e593ccd56cbace41f4bca1c73c432fa18bf, cargo check hangs. \nWhen I change the code to https://github.com/cosven/tikv/commit/e546489502db49a7a0d4b39352a9fbd5c1eaee76, the problem goes away and the check passes. \n\nThe code has the following diff :)\n![image](https://user-images.githubusercontent.com/4962134/184469184-cc4a9fb9-175b-4bbe-9741-7aa940fbbe07.png)\n\nYou can also reproduce this problem with following steps\n```sh\ngit clone https://github.com/cosven/tikv.git\ncd tikv/\ngit checkout rustc-deadloop-repro\n# This commit can help repro the bug. \n# And rustc behaves well on the latest commit.\ngit checkout HEAD^\ncargo check --workspace --all-targets\n```\n\nI expected to see:  cargo check should report a error, because the function call lacks a parameter.\n\nInstead, this happened: cargo check hangs. The  CPU usage of the rustc process goes 100%.\n\n### Meta\n<!--\nIf you're using the stable version of the compiler, you should also check if the\nbug also exists in the beta or nightly versions.\n-->\n\n`rustc --version --verbose`:\n```\nrustc 1.64.0-nightly (0f4bcadb4 2022-07-30)\nbinary: rustc\ncommit-hash: 0f4bcadb46006bc484dad85616b484f93879ca4e\ncommit-date: 2022-07-30\nhost: x86_64-unknown-linux-gnu\nrelease: 1.64.0-nightly\nLLVM version: 14.0.6\n```\n\n<!--\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\n-->\nThe pstack result is as follows, I think (not very sure) the problem may be related to this piece of code\nhttps://github.com/rust-lang/rust/blob/46c59bbb79b3fa99950e2a7eaaeb161990561b8b/compiler/rustc_typeck/src/check/fn_ctxt/arg_matrix.rs#L224-L245\n<details><summary>Backtrace</summary>\n<p>\n\n\n```\n~ > pstack `pgrep rustc`                                                                                                                                                                                                              \nThread 2 (Thread 0x7f562277f700 (LWP 8210)):                                                                                                                                                                                          \n#0  0x00007f562c2e001e in _RNvXNtNtCsjGak25GVoR2_5alloc3vec14spec_from_iterINtB4_3VecjEINtB2_12SpecFromIterjINtNtNtNtCs4Bj0LzfGV1R_4core4iter8adapters10filter_map9FilterMapINtNtB1m_9enumerate9EnumerateINtNtNtB1q_5slice4iter4IterNtNtNtNtCsWyxMbfqFoB_12rustc_typeck5check7fn_ctxt10arg_matrix13CompatibilityEENCNvMs_B3f_NtB3f_9ArgMatrix10find_issue0EE9from_iterB3l_ () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                                                   \n#1  0x00007f562c20d532 in _RNvMs_NtNtNtCsWyxMbfqFoB_12rustc_typeck5check7fn_ctxt10arg_matrixNtB4_9ArgMatrix11find_errors () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                                                               \n#2  0x00007f562c1bf1ca in _RNvMNtNtNtCsWyxMbfqFoB_12rustc_typeck5check7fn_ctxt6checksNtB4_6FnCtxt17report_arg_errors () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                                                                   \n#3  0x00007f562a8f2e96 in _RNvMNtNtNtCsWyxMbfqFoB_12rustc_typeck5check7fn_ctxt6checksNtB4_6FnCtxt20check_argument_types () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                                                                \n#4  0x00007f562a8f6d3f in _RNvMNtNtCsWyxMbfqFoB_12rustc_typeck5check4exprNtNtB4_7fn_ctxt6FnCtxt36check_expr_with_expectation_and_args.llvm.9954290265029759861 () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                         \n#5  0x00007f562a8f593c in _RNvMNtNtCsWyxMbfqFoB_12rustc_typeck5check4exprNtNtB4_7fn_ctxt6FnCtxt36check_expr_with_expectation_and_args.llvm.9954290265029759861 () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                         \n#6  0x00007f562a90af3f in _RNvMNtNtNtCsWyxMbfqFoB_12rustc_typeck5check7fn_ctxt6checksNtB4_6FnCtxt25check_block_with_expected () from /root/.rustup/toolchains/nightly-2022-07-31-x86_64-unknown-linux-gnu/lib/librustc_driver-c25a516c3d8f3eb8.so                                                                                                                                                                                                                           \n```\n\n</p>\n</details>\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"chenyukang\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/100478/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/100478/timeline", "performed_via_github_app": null, "state_reason": "completed"}