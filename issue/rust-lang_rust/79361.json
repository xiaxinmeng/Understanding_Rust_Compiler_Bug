{"url": "https://api.github.com/repos/rust-lang/rust/issues/79361", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79361/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79361/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79361/events", "html_url": "https://github.com/rust-lang/rust/issues/79361", "id": 749098413, "node_id": "MDU6SXNzdWU3NDkwOTg0MTM=", "number": 79361, "title": "Tracking issue for `-Zrun-dsymutil`", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-11-23T20:22:40Z", "updated_at": "2021-01-29T04:06:38Z", "closed_at": "2021-01-29T04:06:38Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This is a (belatedly-opened) issue with the intention of tracking the `-Zrun-dsymutil` flag to the compiler. This flag was implemented long ago in https://github.com/rust-lang/rust/pull/47784 and the intention is to prevent rustc from automatically running `dsymutil` on macOS, which it automatically does today for builds with debuginfo. The purpose for doing this is that `dsymutil` is a pretty slow process and can make debug incremental compile times quite painful.\r\n\r\nThe purpose of `dsymutil` itself is to collect all debuginfo from the executable and all its dependencies into an adjacent `*.dSYM` folder next to the executable itself. This form of split-debuginfo is then read by debuggers and such. This consequently means that `dsymutil` is inherently not incremental. It will unconditionally run over the entire final binary and produce the entire `*.dSYM` folder each time. Since this runs over the final artifact which typically has a lot of debuginfo this can take quite a long time.\r\n\r\nAs discovered on https://github.com/rust-lang/rust/pull/47784, however, the reason this has been unstable for so long is that `dsymutil` was required for filenames and line numbers with `RUST_BACKTRACE` by default. It was too unreasonable for Cargo or other tooling to not run `dsymutil` because it broke this important feature.  With the advent of a Rust-based backtrace backend, however, we [now have support to parse debuginfo](https://github.com/rust-lang/backtrace-rs/pull/377) even if `dsymutil` hasn't run. This uses the same technique LLDB uses to give you debuginfo even when `dsymutil` hasn't run. This was then later [integrated into libstd](https://github.com/rust-lang/rust/pull/79237) and is purportedly [working well and greatly improving incremental compile time](https://github.com/rust-lang/rust/pull/79237#issuecomment-732348580).\r\n\r\nAs for the nitty-gritty of what this flag does:\r\n\r\n* If enabled `run-dsymutil` will execute `dsymutil` over the final binary. This flag is enabled  by default since it's always been rustc's default behavior.\r\n* If disabled, the compiler both does not run `dsymutil` *and* it doesn't delete the object files on disk relevant for the final compilation. This ensures that references in the binary to the object files for debuginfo can be followed and found.\r\n\r\nI'd like to, while opening this issue, also propose that this flag get stabilized. I think the interface is work bikeshedding (e.g. naming and such), but I think the functionality is all in what should be the final end state. I think the expected vision for how we ship this benefit to end users is to switch Cargo's defaults to passing `run-dsymutil=no` (or the equivalent) by default on macOS. That way macOS users should, by default, get the benefit of no `dsymutil` invocations but should retain the ability to debug executables as well as get filenames/line numbers with backtraces. Furthermore if `*.dSYM` is still required by the user, end-applications can always run it as part of a build process themselves.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79361/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 2, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79361/timeline", "performed_via_github_app": null, "state_reason": "completed"}