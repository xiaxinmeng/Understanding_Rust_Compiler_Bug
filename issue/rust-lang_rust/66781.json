{"url": "https://api.github.com/repos/rust-lang/rust/issues/66781", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66781/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66781/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66781/events", "html_url": "https://github.com/rust-lang/rust/issues/66781", "id": 528807951, "node_id": "MDU6SXNzdWU1Mjg4MDc5NTE=", "number": 66781, "title": "Panic/SIGSEGV in unwind cleanup", "user": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-11-26T15:42:15Z", "updated_at": "2019-12-08T14:47:08Z", "closed_at": "2019-12-08T14:47:07Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We had a Rust (1.39.0 stable on x86_64-unknown-linux-gnu) service running on a server that started to exhaust its resources - in particular, `mmap` calls were returning `ENOMEM`. While in this state, the standard library's unwinding glue started encountering some issues:\r\n\r\n1. Unwrapping a `None` value:\r\n\r\n```\r\n...\r\n   5: rust_begin_unwind\r\n             at src/libstd/panicking.rs:307\r\n   6: core::panicking::panic_fmt\r\n             at src/libcore/panicking.rs:85\r\n   7: core::panicking::panic\r\n             at src/libcore/panicking.rs:49\r\n   8: core::option::Option<T>::unwrap\r\n             at /rustc/4560ea788cb760f0a34127156c78e2552949f734/src/libcore/macros.rs:12\r\n      panic_unwind::imp::cleanup\r\n             at src/libpanic_unwind/gcc.rs:91\r\n      __rust_maybe_catch_panic\r\n             at src/libpanic_unwind/lib.rs:83\r\n   9: std::panicking::try\r\n             at /rustc/4560ea788cb760f0a34127156c78e2552949f734/src/libstd/panicking.rs:271\r\n      std::panic::catch_unwind\r\n             at /rustc/4560ea788cb760f0a34127156c78e2552949f734/src/libstd/panic.rs:394\r\n...\r\n```\r\n\r\nThat corresponds to this unwrap here: https://github.com/rust-lang/rust/blob/1.39.0/src/libpanic_unwind/gcc.rs#L91.\r\n\r\n2. A SIGSEGV inside of `__rust_maybe_catch_panic`:\r\n\r\n```\r\nSignal: 11 Code: 1\r\n0x0055d61629b70a - __rust_maybe_catch_panic (0x0055d61629b6f0) + 0x1a\r\n0x0055d615da0838 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h72262d2d5e42fdc2 (0x0055d615da07c0) + 0x78\r\n0x0055d6162839af - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h483711add4ba2330 (0x0055d616283970) + 0x3f\r\n0x0055d61629aae0 - std::sys::unix::thread::Thread::new::thread_start::h7c2a7f9b68fe4bba (0x0055d61629aa50) + 0x90\r\n0x007f6290088e65 - start_thread (0x007f6290088da0) + 0xc5\r\n0x007f628e8d188d - ???? \r\n```\r\n\r\nMy guess is that the inability to mmap somehow put the unwinder in a bad place?", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66781/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66781/timeline", "performed_via_github_app": null, "state_reason": "completed"}