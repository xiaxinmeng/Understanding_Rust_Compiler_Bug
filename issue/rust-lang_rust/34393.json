{"url": "https://api.github.com/repos/rust-lang/rust/issues/34393", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34393/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34393/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34393/events", "html_url": "https://github.com/rust-lang/rust/issues/34393", "id": 161352174, "node_id": "MDU6SXNzdWUxNjEzNTIxNzQ=", "number": 34393, "title": "Consider using stack maps over landing pads for executing destructors", "user": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2016-06-21T05:27:33Z", "updated_at": "2022-05-16T06:21:04Z", "closed_at": "2022-05-16T06:21:04Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "We may be adding LLVM stack map support for GC hooks in the future. It should be possible to leverage the same support to get rid of landing pads.\n\nCurrently, during a panic, we jump through a \"landing pad\" section of the function which runs destructors. We do the same for each frame in the call stack.\n\nLLVM lets us annotate call sites with extra data, which we will use for noting GC roots. This could also be used to note the locations of data which needs dropping, a vtable pointer to the drop trait, and when necessary the location of the drop flag. Thus, when panicking we unwind the stack and call appropriate destructors by looking up the call site in the stack map.\n\nThis may be slower, but the speed of panics isn't really important in Rust. It may also increase binary sizes (I'm not sure of this, others seem to think this isn't the case). @nikomatsakis noted that this decreases the .text size, which makes the icache more efficient since in regular usage you won't be hitting the landing pads anyway.\n\n@eddyb had some concerns (which I'm not sure I quite understand): I'm filing this issue so that they can be discussed \ud83d\ude04 \n\ncc @pnkfelix \n", "closed_by": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34393/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34393/timeline", "performed_via_github_app": null, "state_reason": "completed"}