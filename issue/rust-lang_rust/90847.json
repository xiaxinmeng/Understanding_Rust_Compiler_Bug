{"url": "https://api.github.com/repos/rust-lang/rust/issues/90847", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90847/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90847/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90847/events", "html_url": "https://github.com/rust-lang/rust/issues/90847", "id": 1052483170, "node_id": "I_kwDOAAsO6M4-u55i", "number": 90847, "title": "`#![feature(generic_const_exprs)]` ICE on evaluating constans both for type of generic const parameter and trait bound at the same type definition", "user": {"login": "AnthonyMikh", "id": 19252795, "node_id": "MDQ6VXNlcjE5MjUyNzk1", "avatar_url": "https://avatars.githubusercontent.com/u/19252795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnthonyMikh", "html_url": "https://github.com/AnthonyMikh", "followers_url": "https://api.github.com/users/AnthonyMikh/followers", "following_url": "https://api.github.com/users/AnthonyMikh/following{/other_user}", "gists_url": "https://api.github.com/users/AnthonyMikh/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnthonyMikh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnthonyMikh/subscriptions", "organizations_url": "https://api.github.com/users/AnthonyMikh/orgs", "repos_url": "https://api.github.com/users/AnthonyMikh/repos", "events_url": "https://api.github.com/users/AnthonyMikh/events{/privacy}", "received_events_url": "https://api.github.com/users/AnthonyMikh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}, {"id": 2341291797, "node_id": "MDU6TGFiZWwyMzQxMjkxNzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_const_exprs", "name": "F-generic_const_exprs", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_const_exprs)]`"}], "state": "closed", "locked": false, "assignee": {"login": "cameron1024", "id": 29902409, "node_id": "MDQ6VXNlcjI5OTAyNDA5", "avatar_url": "https://avatars.githubusercontent.com/u/29902409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cameron1024", "html_url": "https://github.com/cameron1024", "followers_url": "https://api.github.com/users/cameron1024/followers", "following_url": "https://api.github.com/users/cameron1024/following{/other_user}", "gists_url": "https://api.github.com/users/cameron1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/cameron1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cameron1024/subscriptions", "organizations_url": "https://api.github.com/users/cameron1024/orgs", "repos_url": "https://api.github.com/users/cameron1024/repos", "events_url": "https://api.github.com/users/cameron1024/events{/privacy}", "received_events_url": "https://api.github.com/users/cameron1024/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "cameron1024", "id": 29902409, "node_id": "MDQ6VXNlcjI5OTAyNDA5", "avatar_url": "https://avatars.githubusercontent.com/u/29902409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cameron1024", "html_url": "https://github.com/cameron1024", "followers_url": "https://api.github.com/users/cameron1024/followers", "following_url": "https://api.github.com/users/cameron1024/following{/other_user}", "gists_url": "https://api.github.com/users/cameron1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/cameron1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cameron1024/subscriptions", "organizations_url": "https://api.github.com/users/cameron1024/orgs", "repos_url": "https://api.github.com/users/cameron1024/repos", "events_url": "https://api.github.com/users/cameron1024/events{/privacy}", "received_events_url": "https://api.github.com/users/cameron1024/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2021-11-12T23:48:23Z", "updated_at": "2022-03-04T15:49:14Z", "closed_at": "2022-03-04T15:49:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\r\n\r\n```Rust\r\n#![feature(generic_const_exprs)]\r\n\r\nstruct Foo<const A: [(); 0 + 0]>\r\n    where [(); 0 + 0]: Sized;\r\n```\r\n\r\nNote that it is required for both array lengths to be not a literal in order to trigger this bug.\r\n\r\n### Meta\r\n\r\nQuite surprisingly, despite using `#![feature]`, it works not only on nightly but on beta and stable as well. Although backtraces differ, the failed assertion is the same.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.56.1 (59eed8a2a 2021-11-01)\r\nbinary: rustc\r\ncommit-hash: 59eed8a2aac0230a8b53e89d4e99d55912ba6b35\r\ncommit-date: 2021-11-01\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.56.1\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror[E0554]: `#![feature]` may not be used on the stable release channel\r\n --> lib.rs:1:1\r\n  |\r\n1 | #![feature(generic_const_exprs)]\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nwarning: the feature `generic_const_exprs` is incomplete and may not be safe to use and/or cause compiler crashes\r\n --> lib.rs:1:12\r\n  |\r\n1 | #![feature(generic_const_exprs)]\r\n  |            ^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(incomplete_features)]` on by default\r\n  = note: see issue #76560 <https://github.com/rust-lang/rust/issues/76560> for more information\r\n\r\nthread 'rustc' panicked at 'assertion failed: !arg.has_type_flags(!allowed_flags)', compiler\\rustc_typeck\\src\\collect\\type_of.rs:297:9\r\nstack backtrace:\r\n<snip, see below>\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.56.1 (59eed8a2a 2021-11-01) running on x86_64-pc-windows-msvc\r\n\r\nquery stack during panic:\r\n#0 [default_anon_const_substs] computing the default generic arguments for `Foo::{constant#1}`\r\n#1 [param_env] computing normalized predicates of `Foo`\r\n#2 [check_item_well_formed] checking that `Foo` is well-formed\r\n#3 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error; 1 warning emitted\r\n```\r\n\r\nSetting `RUST_BACKTRACE=1` revealed no stack frames at all so I used `RUST_BACKTRACE=full`.\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n   0:     0x7ffd4de87a9e - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h90fc78c6027cfe27\r\n   1:     0x7ffd4deb268a - core::fmt::write::h8afcb1031f89d60b\r\n   2:     0x7ffd4de7ae08 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::hb4b34c43836aedaf\r\n   3:     0x7ffd4de8b586 - std::panicking::take_hook::h8b2fe3f8f4cf4b43\r\n   4:     0x7ffd4de8b074 - std::panicking::take_hook::h8b2fe3f8f4cf4b43\r\n   5:       0x86d770a525 - <serde_json::value::WriterFormatter as std::io::Write>::flush::hc1d196eaca04d7a8\r\n   6:     0x7ffd4de8be99 - std::panicking::rust_panic_with_hook::h844a8dc19bbe524e\r\n   7:     0x7ffd4de8b90f - rust_begin_unwind\r\n   8:     0x7ffd4de883e7 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h90fc78c6027cfe27\r\n   9:     0x7ffd4de8b899 - rust_begin_unwind\r\n  10:     0x7ffd4dee8d10 - core::panicking::panic_fmt::h27a79246687269a4\r\n  11:     0x7ffd4dee8c5c - core::panicking::panic::h4b6e61fc90377b73\r\n  12:       0x86d9fa5c7e - <rustc_typeck::coherence::unsafety::UnsafetyChecker as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_item::h682aa4275916ccf2\r\n  13:       0x86dab4d8cc - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  14:       0x86daee596d - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  15:       0x86db8241cf - <rustc_trait_selection::traits::on_unimplemented::OnUnimplementedDirective as core::fmt::Debug>::fmt::hdad6ed0876437135\r\n  16:       0x86db8c3ca2 - <rustc_trait_selection::opaque_types::GenerateMemberConstraints as core::fmt::Debug>::fmt::h6351a5ad34a7afd7\r\n  17:       0x86db8f1c43 - <rustc_infer::infer::lub::Lub as rustc_middle::ty::relate::TypeRelation>::tcx::hd8dcd1498c2c37da\r\n  18:       0x86db83ff39 - <rustc_trait_selection::traits::specialize::OverlapError as core::fmt::Debug>::fmt::h82cecc3e256aff77\r\n  19:       0x86db8f0927 - rustc_trait_selection::traits::project::AssocTypeNormalizer::new::hf5a40d1813a3e002\r\n  20:       0x86db8ee8cd - <rustc_trait_selection::traits::wf::Elaborate as core::fmt::Debug>::fmt::h98a2adc5ad82cba2\r\n  21:       0x86db88ad3d - rustc_trait_selection::traits::normalize_param_env_or_error::h6c082e5471b3c0d8\r\n  22:       0x86db7a1b51 - <unicode_normalization::stream_safe::Decomposition as core::fmt::Debug>::fmt::h4cb36b1bc76a44b4\r\n  23:       0x86db889f8b - rustc_trait_selection::traits::type_known_to_meet_bound_modulo_regions::h6d992d2ac142b395\r\n  24:       0x86db88a1c2 - rustc_trait_selection::traits::normalize_param_env_or_error::h6c082e5471b3c0d8\r\n  25:       0x86da083bd1 - rustc_ty_utils::provide::hb69364e707605161\r\n  26:       0x86dab833cc - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  27:       0x86daeed260 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  28:       0x86da05f805 - rustc_typeck::check::intrinsic::check_platform_intrinsic_type::h1f8cb0a40e4e11fe\r\n  29:       0x86da05cece - rustc_typeck::check::intrinsic::check_platform_intrinsic_type::h1f8cb0a40e4e11fe\r\n  30:       0x86dab4ff32 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  31:       0x86daeee981 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  32:       0x86da066c9a - <rustc_typeck::check::wfcheck::CheckTypeWellFormedVisitor as rustc_hir::intravisit::Visitor>::visit_item::ha4fd906560a43a45\r\n  33:       0x86d9fcee58 - <rustc_typeck::check::writeback::Resolver as rustc_middle::ty::fold::TypeFolder>::fold_const::he13d4a92cbd78022\r\n  34:       0x86d9f89199 - <rustc_typeck::check::method::confirm::ConfirmResult as core::fmt::Debug>::fmt::h12133a562210cf53\r\n  35:       0x86d9eb3d01 - <rustc_typeck::check::PlaceOp as core::fmt::Debug>::fmt::h8616b96de76e95b0\r\n  36:       0x86d9e82ef1 - rustc_typeck::check_crate::h72808c5b688a43c3\r\n  37:       0x86d7849bd2 - rustc_interface::passes::analysis::h213d2025de663219\r\n  38:       0x86dab6cbd2 - <fixedbitset::FixedBitSet as core::fmt::Debug>::fmt::hedf20157683d04ae\r\n  39:       0x86daee5afc - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_mark_green::h02f98d8f46101c14\r\n  40:       0x86d775f28d - regex_syntax::hir::Error::pattern::h26de5cae1e560f3c\r\n  41:       0x86d77297b5 - rustc_driver::pretty::print_after_hir_lowering::h8daab7168b9a121b\r\n  42:       0x86d77614c7 - regex_syntax::hir::Error::pattern::h26de5cae1e560f3c\r\n  43:       0x86d772dfc0 - <tracing_subscriber::util::TryInitError as core::fmt::Display>::fmt::h6e9774f2c0dd7eb3\r\n  44:       0x86d772a248 - rustc_driver::pretty::print_after_hir_lowering::h8daab7168b9a121b\r\n  45:       0x86d771e67d - <rustc_driver::Compilation as core::fmt::Debug>::fmt::ha388fa55e25fcec9\r\n  46:     0x7ffd4de9a1cc - std::sys::windows::thread::Thread::new::h5ab92c811b2297f5\r\n  47:     0x7ffd825213d2 - BaseThreadInitThunk\r\n  48:     0x7ffd832754f4 - RtlUserThreadStart\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"cameron1024\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "AnthonyMikh", "id": 19252795, "node_id": "MDQ6VXNlcjE5MjUyNzk1", "avatar_url": "https://avatars.githubusercontent.com/u/19252795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnthonyMikh", "html_url": "https://github.com/AnthonyMikh", "followers_url": "https://api.github.com/users/AnthonyMikh/followers", "following_url": "https://api.github.com/users/AnthonyMikh/following{/other_user}", "gists_url": "https://api.github.com/users/AnthonyMikh/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnthonyMikh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnthonyMikh/subscriptions", "organizations_url": "https://api.github.com/users/AnthonyMikh/orgs", "repos_url": "https://api.github.com/users/AnthonyMikh/repos", "events_url": "https://api.github.com/users/AnthonyMikh/events{/privacy}", "received_events_url": "https://api.github.com/users/AnthonyMikh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90847/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90847/timeline", "performed_via_github_app": null, "state_reason": "completed"}