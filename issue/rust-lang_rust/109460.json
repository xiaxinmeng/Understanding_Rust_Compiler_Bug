{"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529", "repository_url": "https://api.github.com/repos/rust-lang/rust-clippy", "labels_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529/comments", "events_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529/events", "html_url": "https://github.com/rust-lang/rust-clippy/issues/10529", "id": 1635881259, "node_id": "I_kwDOAZm0i85hgZEr", "number": 10529, "title": "clippy --fix removes necessary parens when changing 'len > 0' to '!.is_empty()'", "user": {"login": "ingomancer", "id": 3876868, "node_id": "MDQ6VXNlcjM4NzY4Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/3876868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ingomancer", "html_url": "https://github.com/ingomancer", "followers_url": "https://api.github.com/users/ingomancer/followers", "following_url": "https://api.github.com/users/ingomancer/following{/other_user}", "gists_url": "https://api.github.com/users/ingomancer/gists{/gist_id}", "starred_url": "https://api.github.com/users/ingomancer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ingomancer/subscriptions", "organizations_url": "https://api.github.com/users/ingomancer/orgs", "repos_url": "https://api.github.com/users/ingomancer/repos", "events_url": "https://api.github.com/users/ingomancer/events{/privacy}", "received_events_url": "https://api.github.com/users/ingomancer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 149309557, "node_id": "MDU6TGFiZWwxNDkzMDk1NTc=", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/C-bug", "name": "C-bug", "color": "F5F1FD", "default": false, "description": "Category: Clippy is not doing the correct thing"}], "state": "closed", "locked": false, "assignee": {"login": "J-ZhengLi", "id": 32276130, "node_id": "MDQ6VXNlcjMyMjc2MTMw", "avatar_url": "https://avatars.githubusercontent.com/u/32276130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/J-ZhengLi", "html_url": "https://github.com/J-ZhengLi", "followers_url": "https://api.github.com/users/J-ZhengLi/followers", "following_url": "https://api.github.com/users/J-ZhengLi/following{/other_user}", "gists_url": "https://api.github.com/users/J-ZhengLi/gists{/gist_id}", "starred_url": "https://api.github.com/users/J-ZhengLi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/J-ZhengLi/subscriptions", "organizations_url": "https://api.github.com/users/J-ZhengLi/orgs", "repos_url": "https://api.github.com/users/J-ZhengLi/repos", "events_url": "https://api.github.com/users/J-ZhengLi/events{/privacy}", "received_events_url": "https://api.github.com/users/J-ZhengLi/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "J-ZhengLi", "id": 32276130, "node_id": "MDQ6VXNlcjMyMjc2MTMw", "avatar_url": "https://avatars.githubusercontent.com/u/32276130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/J-ZhengLi", "html_url": "https://github.com/J-ZhengLi", "followers_url": "https://api.github.com/users/J-ZhengLi/followers", "following_url": "https://api.github.com/users/J-ZhengLi/following{/other_user}", "gists_url": "https://api.github.com/users/J-ZhengLi/gists{/gist_id}", "starred_url": "https://api.github.com/users/J-ZhengLi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/J-ZhengLi/subscriptions", "organizations_url": "https://api.github.com/users/J-ZhengLi/orgs", "repos_url": "https://api.github.com/users/J-ZhengLi/repos", "events_url": "https://api.github.com/users/J-ZhengLi/events{/privacy}", "received_events_url": "https://api.github.com/users/J-ZhengLi/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2023-03-21T21:55:55Z", "updated_at": "2023-04-23T10:00:43Z", "closed_at": "2023-04-23T10:00:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\nalong with any information you feel relevant to replicating the bug.\n-->\n\nI have the following minimized example:\n\n```rust\nfn main() {\n    let a = [1, 2, 3];\n    (a.len() > 0).then(|| println!(\"Hello, world!\"));\n}\n```\nrunning cargo clippy on this produces the following warning:\n```rust\nwarning: length comparison to zero\n --> src/main.rs:3:5\n  |\n3 |     (a.len() > 0).then(|| println!(\"Hello, world!\"));\n  |     ^^^^^^^^^^^^^ help: using `!is_empty` is clearer and more explicit: `!a.is_empty()`\n  |\n  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#len_zero\n  = note: `#[warn(clippy::len_zero)]` on by default\n```\nwhich makes sense to me. \n\nI expected to see this happen: running 'cargo clippy --fix' changes the condition to the one suggested\n\nInstead, this happened: \n```rust\ncargo clippy --fix\n    Checking minimal_example v0.1.0 (/home/ingo/minimal_example)\nwarning: failed to automatically apply fixes suggested by rustc to crate `minimal_example`\n\nafter fixes were automatically applied the compiler reported errors within these files:\n\n  * src/main.rs\n\nThis likely indicates a bug in either rustc or cargo itself,\nand we would appreciate a bug report! You're likely to see\na number of compiler warnings after this message which cargo\nattempted to fix but failed. If you could open an issue at\nhttps://github.com/rust-lang/rust/issues\nquoting the full output of this command we'd be very appreciative!\nNote that you may be able to make some more progress in the near-term\nfixing code with the `--broken-code` flag\n\nThe following errors were reported:\nerror[E0600]: cannot apply unary operator `!` to type `std::option::Option<()>`\n --> src/main.rs:3:5\n  |\n3 |     !a.is_empty().then(|| println!(\"Hello, world!\"));\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot apply unary operator `!`\n\nerror: aborting due to previous error\n```\n\nReinserting parens around the condition makes it compile.\n```rust\nfn main() {\n    let a = [1, 2, 3];\n    (!a.is_empty()).then(|| println!(\"Hello, world!\"));\n}\n```\n\n### Meta\n<!--\nIf you're using the stable version of the compiler, you should also check if the\nbug also exists in the beta or nightly versions.\n-->\n\n`rustc --version --verbose`:\n```\nrustc 1.68.0 (2c8cc3432 2023-03-06)\nbinary: rustc\ncommit-hash: 2c8cc343237b8f7d5a3c3703e3a87f2eb2c54a74\ncommit-date: 2023-03-06\nhost: x86_64-unknown-linux-gnu\nrelease: 1.68.0\nLLVM version: 15.0.6\n```\n\nI get the same result on nightly, which is currently:\n'rustc +nightly --version --verbose':\n```\nrustc 1.70.0-nightly (44f518058 2023-03-20)\nbinary: rustc\ncommit-hash: 44f5180584404d18058cbbf224c55255db4fdcbb\ncommit-date: 2023-03-20\nhost: x86_64-unknown-linux-gnu\nrelease: 1.70.0-nightly\nLLVM version: 15.0.7\n```\n\nRegards,\ningo\n\n<!--\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\n-->\n<details><summary>Backtrace</summary>\n<p>\n\n\n</p>\n</details>\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"J-ZhengLi\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10529/timeline", "performed_via_github_app": null, "state_reason": "completed"}