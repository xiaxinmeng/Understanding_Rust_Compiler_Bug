{"url": "https://api.github.com/repos/rust-lang/rust/issues/68923", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68923/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68923/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68923/events", "html_url": "https://github.com/rust-lang/rust/issues/68923", "id": 561580522, "node_id": "MDU6SXNzdWU1NjE1ODA1MjI=", "number": 68923, "title": "Generators should be able to implement `for<'a> Generator<&'a mut T>`", "user": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 679846574, "node_id": "MDU6TGFiZWw2Nzk4NDY1NzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-generators", "name": "A-generators", "color": "f7e101", "default": false, "description": "Area: Generators"}, {"id": 1472513502, "node_id": "MDU6TGFiZWwxNDcyNTEzNTAy", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generators", "name": "F-generators", "color": "f9c0cc", "default": false, "description": "`#![feature(generators)]`"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-02-07T11:25:56Z", "updated_at": "2020-03-17T19:33:18Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "With https://github.com/rust-lang/rust/pull/68524, the `Generator` trait has gained a type parameter for the resume argument. Currently, this parameter will not be inferred to a type with late-bound regions. In some cases, this is required for soundness. For example, this generator stores the resume argument across a `yield`, which means that it can not accept arbitrary lifetimes in it:\r\n\r\n```rust\r\nlet gen = |arg: &mut bool| {\r\n    yield ();\r\n    *arg = true;\r\n};\r\n```\r\n\r\nThis generator ends up implementing `Generator<&'x mut bool>` with a specific `'x`, not `for<'x> Generator<&'x mut bool>`.\r\n\r\nHowever, if the resume argument *doesn't* get stored inside the generator state, it should be fine for the generator to implement `for<'x> Generator<&'x mut bool>` instead.\r\n\r\nThis is already how closures behave, since they can also store their arguments inside upvars, so it shouldn't be terribly difficult to extend this to generators. It would be good to come up with lots of test cases beforehand though (perhaps inspired by the tests for closures).", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68923/reactions", "total_count": 14, "+1": 14, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68923/timeline", "performed_via_github_app": null, "state_reason": null}