{"url": "https://api.github.com/repos/rust-lang/rust/issues/52877", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52877/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52877/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52877/events", "html_url": "https://github.com/rust-lang/rust/issues/52877", "id": 345939781, "node_id": "MDU6SXNzdWUzNDU5Mzk3ODE=", "number": 52877, "title": "NLL: rewrites should include actual source input, not solely the hypothesized rewrites", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867465998, "node_id": "MDU6TGFiZWw4Njc0NjU5OTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-diagnostics", "name": "NLL-diagnostics", "color": "f799ea", "default": false, "description": "Working torwads the \"diagnostic parity\" goal"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-07-30T21:20:58Z", "updated_at": "2018-08-01T10:42:51Z", "closed_at": "2018-08-01T10:42:51Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "While working on #52663, I noticed something I had not seen before: the `.nll.stderr` files for [borrowck-move-out-of-vec-tail.nll.stderr](https://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-move-out-of-vec-tail.nll.stderr) and [borrowck-vec-pattern-nesting.nll.stderr](https://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-vec-pattern-nesting.nll.stderr) have an odd characteristic: they print out highlighted spans that do not actually correspond to the actual input source code, but rather correspond to the hypothetical rewritten code that we are asking the user to type in.\r\n\r\n----\r\n\r\nLet me explain with actual pointers to lines in the files:\r\n\r\nThis is what the `.nll.stderr` files say we expect to see from the compiler (and what the compiler is actually printing under NLL mode, modulo details like the specific line numbers in the left-hand column):\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-move-out-of-vec-tail.nll.stderr#L6-L13\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-vec-pattern-nesting.nll.stderr#L65-L76\r\n\r\nIn the `.nll.stderr` files that I linked above, the highlighted spans correspond to these lines:\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-move-out-of-vec-tail.rs#L29-L34\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-vec-pattern-nesting.rs#L77-L79\r\n\r\n(Do you see the problem? If not, read on...)\r\n\r\n----\r\n\r\nThe problem I have with this is that when I see output from `rustc` like:\r\n```\r\nhere be some code\r\n     ^^\r\n```\r\nI expect to actually find the *actual text* `here is some code` in my source file. If the diagnostic wants to include a suggestion that we replace \"be\" with \"is\", then I expect that to appear as help text that says something like \"write `is` instead of `be`\" or even just \"write `is` here\" (with the \"be\" highlighted, as above)\r\n\r\nIn short, the user experience (at least for me) from the current NLL is a bit frustrating, because when I see the error message, it seems like it is saying \"insert a `ref` here\", but then from my point of view it is printing out the source code and my reaction is \"there *already is* a `ref` there\" (because I'm staring at the print-out in the user terminal and not the source code in my text editor).\r\n\r\n----\r\n\r\nThe fix for this should be simple: identify the cases that are creating these strange diagnostics, and replace them with something more traditional. Note in particular that in both the cases above, the AST-borrowck generated error is more normal:\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-move-out-of-vec-tail.stderr#L4-L14\r\n\r\nhttps://github.com/rust-lang/rust/blob/fefe81605d6111faa8dbb3635ab2c51d59de740a/src/test/ui/borrowck/borrowck-vec-pattern-nesting.stderr#L64-L69\r\n\r\nHowever, if someone can point me at at an established precedent for this pattern (lets say  at least three examples) in the current `rustc`, then I would also be willing to accept that this is something we already do and that I am just an old fogie who is unaware of how the UX tide is shifting.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52877/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52877/timeline", "performed_via_github_app": null, "state_reason": "completed"}