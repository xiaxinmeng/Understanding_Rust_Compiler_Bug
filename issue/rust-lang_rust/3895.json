{"url": "https://api.github.com/repos/rust-lang/rust/issues/3895", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/3895/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/3895/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/3895/events", "html_url": "https://github.com/rust-lang/rust/issues/3895", "id": 8020346, "node_id": "MDU6SXNzdWU4MDIwMzQ2", "number": 3895, "title": "rustc guards ICE: Assertion m.len() > 0u || chk.is_some() failed", "user": {"login": "dckc", "id": 150986, "node_id": "MDQ6VXNlcjE1MDk4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/150986?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dckc", "html_url": "https://github.com/dckc", "followers_url": "https://api.github.com/users/dckc/followers", "following_url": "https://api.github.com/users/dckc/following{/other_user}", "gists_url": "https://api.github.com/users/dckc/gists{/gist_id}", "starred_url": "https://api.github.com/users/dckc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dckc/subscriptions", "organizations_url": "https://api.github.com/users/dckc/orgs", "repos_url": "https://api.github.com/users/dckc/repos", "events_url": "https://api.github.com/users/dckc/events{/privacy}", "received_events_url": "https://api.github.com/users/dckc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/9", "html_url": "https://github.com/rust-lang/rust/milestone/9", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/9/labels", "id": 194126, "node_id": "MDk6TWlsZXN0b25lMTk0MTI2", "number": 9, "title": "0.6", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 203, "state": "closed", "created_at": "2012-10-11T18:15:24Z", "updated_at": "2015-01-21T01:43:22Z", "due_on": "2013-03-25T07:00:00Z", "closed_at": "2013-04-02T18:27:52Z"}, "comments": 5, "created_at": "2012-11-01T00:53:01Z", "updated_at": "2014-06-16T21:56:29Z", "closed_at": "2012-12-08T06:52:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\n$ rustc -v\nrustc 0.5 (57b4d10 2012-10-12 16:41:32 -0700)\nhost: x86_64-unknown-linux-gnu\n```\n\nI don't see how to attach files, so...\n\n```\nRUST_LOG=rustc=0,::rt::backtrace rustc mmfsm.rs --test\nrust: task failed at 'Assertion m.len() > 0u || chk.is_some() failed', /home/connolly/src/rust/src/rustc/middle/trans/alt.rs:866\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x5d)[0x2b977f842fdd]\n/usr/local/bin/../lib/librustrt.so(+0x3325d)[0x2b977f85b25d]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x1d0)[0x2b977f845930]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0xa0b)[0x2b977effab2b]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x2370aa)[0x2b977effa0aa]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base9with_cond16_fae091854fffba33_05E+0x143)[0x2b977ef34893]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt13compile_guard16_5e7459203dd95c83_05E+0x9b1)[0x2b977eff9891]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x63a)[0x2b977effa75a]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x2c55)[0x2b977effcd75]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x2b50)[0x2b977effcc70]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x2c55)[0x2b977effcd75]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x2c55)[0x2b977effcd75]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x2c55)[0x2b977effcd75]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt16compile_submatch16_fb9e6315b8870463_05E+0x11e6)[0x2b977effb306]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt15trans_alt_inner16_ad10ecb481ad2223_05E+0x895)[0x2b977efffb15]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x689840)[0x2b977f44c840]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x23c278)[0x2b977efff278]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10with_scope17_f715e64d24b410333_05E+0x442)[0x2b977ef34fc2]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans3alt9trans_alt17_4eb9527c11b030193_05E+0x1c5)[0x2b977ef76c45]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1afdda)[0x2b977ef72dda]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1ab21e)[0x2b977ef6e21e]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr14trans_to_datum15_1cbfbbbca52c293_05E+0x434)[0x2b977ef29ba4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1aed27)[0x2b977ef71d27]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr10trans_into16_6c850bd8fee452e3_05E+0x738)[0x2b977ef27338]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10trans_stmt17_902f2bbc1f1bf65e3_05E+0x3c8)[0x2b977ef269f8]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans11controlflow11trans_block16_26b9d945b6471483_05E+0x17d)[0x2b977ef250cd]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10with_scope17_f715e64d24b410333_05E+0x442)[0x2b977ef34fc2]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1b03ee)[0x2b977ef733ee]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr10trans_into16_6c850bd8fee452e3_05E+0x69e)[0x2b977ef2729e]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans11controlflow11trans_block16_26b9d945b6471483_05E+0x1d1)[0x2b977ef25121]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base13trans_closure15_5fd055394070353_05E+0x76b)[0x2b977efbe08b]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x2438c3)[0x2b977f0068c3]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans7closure13trans_expr_fn15_a663c1c9738d993_05E+0x7f7)[0x2b977ef6bbd7]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1b013c)[0x2b977ef7313c]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr10trans_into16_6c850bd8fee452e3_05E+0x69e)[0x2b977ef2729e]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1b024c)[0x2b977ef7324c]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1ab21e)[0x2b977ef6e21e]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr14trans_to_datum15_1cbfbbbca52c293_05E+0x434)[0x2b977ef29ba4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans6callee14trans_arg_expr17_1658b0a3d6341f653_05E+0x700)[0x2b977ef69620]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1a5e7c)[0x2b977ef68e7c]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans6callee10trans_args16_c46359aa314c3803_05E+0x391)[0x2b977ef68521]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1a4af9)[0x2b977ef67af9]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10with_scope17_f715e64d24b410333_05E+0x442)[0x2b977ef34fc2]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans6callee16trans_call_inner17_bce4bdcb48562e5c3_05E+0x114)[0x2b977ef5c914]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans6callee10trans_call17_adf4ba1882312adc3_05E+0x281)[0x2b977ef5c7a1]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x1afb3f)[0x2b977ef72b3f]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x689840)[0x2b977f44c840]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4expr10trans_into16_6c850bd8fee452e3_05E+0x69e)[0x2b977ef2729e]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10trans_stmt17_902f2bbc1f1bf65e3_05E+0x3c8)[0x2b977ef269f8]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans11controlflow11trans_block16_26b9d945b6471483_05E+0x17d)[0x2b977ef250cd]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base13trans_closure15_5fd055394070353_05E+0x76b)[0x2b977efbe08b]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base8trans_fn17_7b6cbffb898dd1b73_05E+0x145)[0x2b977eeb77b5]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base10trans_item16_45a6cab39b2a9983_05E+0x92a)[0x2b977eeb3f2a]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base9trans_mod17_917c80e8ce495a1d3_05E+0x8f)[0x2b977efc536f]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6middle5trans4base11trans_crate17_51569cb9b4ec671c3_05E+0x149a)[0x2b977efdeb5a]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6driver6driver12compile_upto17_f866b092d9b7dfd43_05E+0x2560)[0x2b977f422ac0]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(+0x689840)[0x2b977f44c840]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6driver6driver13compile_input17_c85efee3d65e343b3_05E+0xbd)[0x2b977f424ead]\nrustc[0x408eb7]\nrustc[0x412214]\nrustc[0x40e693]\nrustc[0x40d34c]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x7580f)[0x2b977e19b80f]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb50e0)[0x2b977e1db0e0]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x2b977f843784]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=0,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/connolly/src/rust/src/rustc/driver/rustc.rs:275\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x5d)[0x2b977f842fdd]\n/usr/local/bin/../lib/librustrt.so(+0x3325d)[0x2b977f85b25d]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x1d0)[0x2b977f845930]\nrustc(_rust_main+0x838)[0x411a28]\nrustc[0x412214]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x2b977f843784]\nrust: domain main @0xf19200 root task failed\nrust: task failed at 'killed', /home/connolly/src/rust/src/libcore/task.rs:663\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x5d)[0x2b977f842fdd]\n/usr/local/bin/../lib/librustrt.so(+0x3325d)[0x2b977f85b25d]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x1d0)[0x2b977f845930]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(_ZN4task5yield16_9531951b4f79f8b3_05E+0xbd)[0x2b977e184ddd]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x90246)[0x2b977e1b6246]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(_ZN7private11weaken_task16_cf742a1b771015c3_05E+0xd2)[0x2b977e1b6082]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x8ff7b)[0x2b977e1b5f7b]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb50e0)[0x2b977e1db0e0]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x8f2d0)[0x2b977e1b52d0]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x8ec6e)[0x2b977e1b4c6e]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x8e2d6)[0x2b977e1b42d6]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x7580f)[0x2b977e19b80f]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb50e0)[0x2b977e1db0e0]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x2b977f843784]\n```\n\nand the code:\n\n```\n/**\nstart = space start\n      | statement start\n      | comment start\n      | EOF\n\nstatement = '${' space+ | '$}' tspace | keyword_statement\nkeyword_statement = label? keyword expr proof? '$.' tspace\nlabel = label_char+ space+\nkeyword = ($a | $p | ...) space+\nexpr = symbol*\nsymbol = symbol_char+ space+\n\ncomment = '$(' space (not_$) space)* '$)' tspace\nispace = (space+ comment?)*  # inter-token space\n\ntspace = space+ | EOF\n\nproof = '$=' space+ label+ '$'  # TODO: compressed proof\n */\nuse core::vec::{any};\n\nextern mod std;\nuse std::rope;\n\nfn each_statement(text: rope::Rope) -> bool {\n    enum IsSpace { Space, Printable }\n    enum IsLabel { Label, NotLabel }\n\n    enum State {\n        Start,\n        StLabel,\n        StKeyword,\n        StExpr,\n        TSpace,\n\n        BadChar,  // TODO: line, col?\n        BadSyntax, // line, col?\n    }\n\n    let mut state = Start;\n    let mut ch1 = '\\u0000'; // LL(2)\n\n    do rope::loop_chars(text) |ch| {\n        let is_space = \" \\t\\r\\n\\x0A\".contains_char(ch);\n        let is_label = any(&[('A', 'Z'), ('a', 'z'), ('0', '9')],\n                           |r| match r { &(lo, hi) => ch >= lo && ch <= hi })\n            || \"'-_.\".contains_char(ch);\n\n        state = match (state, ch1, ch,\n               if (is_space) { Space } else { Printable },\n               if (is_label) { Label } else { NotLabel }) {\n          (_, _, _, Printable, _) if ch > '\\u007F' || ch < ' ' => BadChar,\n\n          (Start, _, _, Space, _) => Start,\n          (Start, _, _, _, Label) => StLabel,\n          (Start, _, _, _, _) => BadSyntax,  // not implemented\n\n          (StLabel, _, _, _, Label) => StLabel,\n          (StLabel, _, _, Space, _) => StKeyword,\n          (StLabel, _, _, _, _) => BadSyntax,\n\n          (StKeyword, _, _, Space, _) => StKeyword,\n          (StKeyword, '$', 'a', _, _) => StExpr,\n          (StKeyword, _, _, _, _) => BadSyntax,\n\n          (StExpr, '$', '.', _, _) => TSpace,\n          (StExpr, '$', _, _, _) => BadSyntax,\n          (StExpr, _, _, Printable, _) => StExpr,\n          (StExpr, _, _, Space, _) => StExpr,\n\n          (TSpace, _, _, Space, _) => TSpace,\n          (TSpace, _, _, Printable, _) => BadSyntax,\n\n          (BadChar, _, _, _, _)\n          | (BadSyntax, _, _, _, _) => fail fmt!(\"unexpected state: %?\", state)\n        };\n\n        ch1 = ch;\n        debug!(\"hi: %c\", ch);\n        match state {\n            BadChar | BadSyntax => false,\n            _ => true\n        }\n    };\n\n    match state {\n      TSpace => true,\n      _ => false\n    }\n}\n\n#[cfg(test)]\nmod test {\n    #[test]\n    fn each_statement1() {\n        let doc = rope::of_str(@~\"axiom.1 $a |- x = x $.\");\n        each_statement(doc);\n    }\n}\n\n```\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/3895/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/3895/timeline", "performed_via_github_app": null, "state_reason": "completed"}