{"url": "https://api.github.com/repos/rust-lang/rust/issues/20171", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20171/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20171/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20171/events", "html_url": "https://github.com/rust-lang/rust/issues/20171", "id": 52735511, "node_id": "MDU6SXNzdWU1MjczNTUxMQ==", "number": 20171, "title": "ICE with a wrong notation for an unboxed closure trait: Fn<A, R>", "user": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-12-23T12:06:41Z", "updated_at": "2015-01-22T10:12:06Z", "closed_at": "2015-01-22T10:12:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\nfn f<A, R, F> (_: F) where F: Fn<A, R> {\n}\n\nfn main() {\n    f(|| ())\n}\n```\n\nConfirmed with the Dec 20 snapshot (8443b09e3 2014-12-20 05:52:18 +0000)\n\n```\n$ RUST_BACKTRACE=1 rustc unboxed-closure-arg-type-tuple.rs                                                                                                                                          \nerror: internal compiler error: unexpected panic            \nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'assertion failed: begin <= end', /home/nodakai/prog/rust-HEAD/src/libcore/str.rs:1999\n\nstack backtrace:\n   1:     0x7f6270e39100 - sys::backtrace::write::hd1381419a8907f34Vpt\n   2:     0x7f6270e5a410 - failure::on_fail::h1a2313aec88ac0cbBPz\n   3:     0x7f6270dc5470 - rt::unwind::begin_unwind_inner::he6f0b79e492390441tz\n   4:     0x7f6270dc8e90 - rt::unwind::begin_unwind_fmt::hdaa836bd1e21d7fcorz\n   5:     0x7f6270e5a150 - rust_begin_unwind\n   6:     0x7f6270ea1c30 - panicking::panic_fmt::h01dc5ba2c34ad6dcrkl\n   7:     0x7f6270e9f930 - panicking::panic::hd3d47337924cd7abRhl\n   8:     0x7f6270eabbc0 - str::slice_error_fail::hd4b21ef2840fb40dkTs\n   9:     0x7f626f261c20 - util::ppaux::parameterized::h51a43fc8a427293bSfs\n  10:     0x7f626f0665d0 - util::ppaux::ty..TraitRef<$u{27}tcx$GT$.UserString$LT$$u{27}tcx$GT$::user_string::h03f731f486ca3ddeOut\n  11:     0x7f627032cb30 - util::ppaux::ty..Binder<T>.UserString<$u{27}tcx$GT$::user_string::h6183618980758325180\n  12:     0x7f62703280f0 - check::vtable::report_selection_error::h3de6d3cb962c4db3Pib\n  13:     0x7f6270327390 - check::vtable::report_fulfillment_errors::hfacd21a10cac75f3Chb\n  14:     0x7f6270326a90 - check::vtable::select_all_fcx_obligations_or_error::h52961fddf83aafdeyfb\n  15:     0x7f62703f4340 - check::check_bare_fn::h9105b5d7026edf36Ock\n  16:     0x7f62703ebe00 - check::check_item::hbc2b32ccaabfff70ewk\n  17:     0x7f62706418f0 - check_crate::unboxed_closure.42775\n  18:     0x7f627063c750 - check_crate::h77b071454fb3bba7FZy\n  19:     0x7f62713884e0 - driver::phase_3_run_analysis_passes::ha627213b53e57939Gta\n  20:     0x7f627136b850 - driver::compile_input::heda7e9242e791006tba\n  21:     0x7f6271511c30 - run_compiler::h9cf1054d2bef503aCYb\n  22:     0x7f62715107d0 - thunk::F.Invoke<A,$u{20}R$GT$::invoke::h16457268178976240300\n  23:     0x7f627150ee80 - rt::unwind::try::try_fn::h14045550633024131077\n  24:     0x7f6270ebe350 - rust_try_inner\n  25:     0x7f6270ebe340 - rust_try\n  26:     0x7f627150f1b0 - thunk::F.Invoke<A,$u{20}R$GT$::invoke::h17971573902123685032\n  27:     0x7f6270e49a50 - sys::thread::thread_start::h915aca80d28489b1tow\n  28:     0x7f626b7e8dc0 - start_thread\n  29:                0x0 - <unknown>\n$ rustc --version\nrustc 0.13.0-dev (8443b09e3 2014-12-20 05:52:18 +0000)\n```\n\nIncidentally, it should be clarified that `A` in `Fn<A, R>` is actually a meta variable for documentation and Rust only allows a concrete tuple of types there (otherwise we might end up with a closure object which no one can invoke.)\n\nFYI: Dec 15 snapshot didn't suffer from this bug:\n\n```\n$ rustc unboxed-closure-arg-type-tuple.rs \nunboxed-closure-arg-type-tuple.rs:5:5: 5:6 error: the trait `core::ops::Fn<_, _>` is not implemented for the type `||`\nunboxed-closure-arg-type-tuple.rs:5     f(|| ())\n                                        ^\nunboxed-closure-arg-type-tuple.rs:5:5: 5:6 note: required by `f`\nunboxed-closure-arg-type-tuple.rs:5     f(|| ())\n                                        ^\nerror: aborting due to previous error\n\n$ rustc --version\nrustc 0.13.0-dev (1b97cd338 2014-12-15 15:33:11 +0000)\n```\n", "closed_by": {"login": "nodakai", "id": 90726, "node_id": "MDQ6VXNlcjkwNzI2", "avatar_url": "https://avatars.githubusercontent.com/u/90726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nodakai", "html_url": "https://github.com/nodakai", "followers_url": "https://api.github.com/users/nodakai/followers", "following_url": "https://api.github.com/users/nodakai/following{/other_user}", "gists_url": "https://api.github.com/users/nodakai/gists{/gist_id}", "starred_url": "https://api.github.com/users/nodakai/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nodakai/subscriptions", "organizations_url": "https://api.github.com/users/nodakai/orgs", "repos_url": "https://api.github.com/users/nodakai/repos", "events_url": "https://api.github.com/users/nodakai/events{/privacy}", "received_events_url": "https://api.github.com/users/nodakai/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20171/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20171/timeline", "performed_via_github_app": null, "state_reason": "completed"}