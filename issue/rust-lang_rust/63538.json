{"url": "https://api.github.com/repos/rust-lang/rust/issues/63538", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63538/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63538/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63538/events", "html_url": "https://github.com/rust-lang/rust/issues/63538", "id": 480417863, "node_id": "MDU6SXNzdWU0ODA0MTc4NjM=", "number": 63538, "title": "Desugaring of struct update syntax is unnecessarily restrictive for private fields", "user": {"login": "Osspial", "id": 16296823, "node_id": "MDQ6VXNlcjE2Mjk2ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/16296823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Osspial", "html_url": "https://github.com/Osspial", "followers_url": "https://api.github.com/users/Osspial/followers", "following_url": "https://api.github.com/users/Osspial/following{/other_user}", "gists_url": "https://api.github.com/users/Osspial/gists{/gist_id}", "starred_url": "https://api.github.com/users/Osspial/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Osspial/subscriptions", "organizations_url": "https://api.github.com/users/Osspial/orgs", "repos_url": "https://api.github.com/users/Osspial/repos", "events_url": "https://api.github.com/users/Osspial/events{/privacy}", "received_events_url": "https://api.github.com/users/Osspial/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-13T23:44:11Z", "updated_at": "2020-06-03T18:15:25Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Take the following example struct:\r\n\r\n```rust\r\nmod module {\r\n    #[derive(Default)]\r\n    pub struct Foo {\r\n        pub a: i32,\r\n        b: u32\r\n    }\r\n}\r\n```\r\n\r\nLet's say you don't have access to `b`, and you want to create an instance of `Foo` with a non-default value for `a`. The idiomatic way to do that is with the struct update syntax, like so:\r\n\r\n```rust\r\nlet foo = Foo {\r\n    a: 2,\r\n    ..Foo::default()\r\n};\r\n```\r\n\r\nRight now, that fails with the following error:\r\n\r\n```\r\nerror[E0451]: field `b` of struct `main::module::Foo` is private\r\n  --> src/main.rs:15:7\r\n   |\r\n15 |     ..Foo::default()\r\n   |       ^^^^^^^^^^^^^^ field `b` is private\r\n```\r\n\r\nThat error is unintuitive since we never directly reference `b` in our source code. What's more, it's entirely unnecessary, since it's merely the side effect of what seems to be the current desugaring strategy, as follows:\r\n\r\n```rust\r\nlet foo = {\r\n    // we create temp_a before calling Foo::default() to preserve source code ordering\r\n    let temp_a = 2;\r\n    let temp = Foo::default();\r\n    Foo {\r\n        a: temp_a,\r\n        b: temp.b\r\n    }\r\n};\r\n```\r\n\r\nIdeally we'd desugar to the following, which would allow the initial example to compile as expected:\r\n\r\n```rust\r\nlet foo = {\r\n    let temp_a = 2;\r\n    let mut temp = Foo::default();\r\n    temp.a = temp_a;\r\n    temp\r\n};\r\n```\r\n\r\nThis issue proposes moving to the second method. I can't see any disadvantages to doing that, although that may just be because I'm not looking close enough.\r\n\r\nThis admittedly changes the language's behavior, but I'm submitting it as an issue instead of an RFC because the current behavior seems unintentional and this is an extremely minor change. I'll happily create an RFC if that's necessary, though.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63538/reactions", "total_count": 12, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 4, "rocket": 0, "eyes": 3}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63538/timeline", "performed_via_github_app": null, "state_reason": null}