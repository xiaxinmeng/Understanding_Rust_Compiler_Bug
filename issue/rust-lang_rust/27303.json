{"url": "https://api.github.com/repos/rust-lang/rust/issues/27303", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27303/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27303/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27303/events", "html_url": "https://github.com/rust-lang/rust/issues/27303", "id": 97331093, "node_id": "MDU6SXNzdWU5NzMzMTA5Mw==", "number": 27303, "title": "Document the correct FFI equivalent to a C opaque struct", "user": {"login": "crumblingstatue", "id": 1521976, "node_id": "MDQ6VXNlcjE1MjE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1521976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crumblingstatue", "html_url": "https://github.com/crumblingstatue", "followers_url": "https://api.github.com/users/crumblingstatue/followers", "following_url": "https://api.github.com/users/crumblingstatue/following{/other_user}", "gists_url": "https://api.github.com/users/crumblingstatue/gists{/gist_id}", "starred_url": "https://api.github.com/users/crumblingstatue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crumblingstatue/subscriptions", "organizations_url": "https://api.github.com/users/crumblingstatue/orgs", "repos_url": "https://api.github.com/users/crumblingstatue/repos", "events_url": "https://api.github.com/users/crumblingstatue/events{/privacy}", "received_events_url": "https://api.github.com/users/crumblingstatue/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2015-07-26T16:26:02Z", "updated_at": "2016-01-05T03:31:34Z", "closed_at": "2015-08-11T12:59:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "With recent changes to the `improper_ctypes` lint, it now rejects `#[repr(C)] struct Foo;` for representing a C opaque struct.\n\n``` Rust\n#[repr(C)]\npub struct Foo;\n\nextern \"C\" {\n    pub fn foo(arg: *const Foo);\n}\n\nfn main() {\n}\n```\n\n```\nfoo.rs:5:25: 5:28 warning: found zero-size struct in foreign module, consider adding a member to this struct, #[warn(improper_ctypes)] on by default\nfoo.rs:5    pub fn foo(arg: *const Foo);\n                                   ^~~\n\n```\n\nOn the #rust IRC channel, I have asked what is the proper way to represent a C opaque struct, but no definitive answer was reached.\n\nSome of the answers were:\n- `struct Foo;` is incorrect.\n- `struct Foo;` is fine, but it can break certain LLVM optimizations.\n- Use `c_void` instead. This isn't satisfactory when it is desirable to represent a C opaque struct as a distinct type in your API.\n- Use a newtype wrapper around `c_void`. Someone said this might not be correct either.\n- Rustc should allow `#repr(C) enum Foo {}`. It doesn't currently allow this.\n\nThis should be properly researched and then documented in the official documentation, so users know what to use for representing C opaque struct types in Rust when interfacing with C code.\n\nSome relevant issues:\n- https://github.com/rust-lang/rust/issues/17679\n- https://github.com/rust-lang/rust/issues/20660\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27303/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27303/timeline", "performed_via_github_app": null, "state_reason": "completed"}