{"url": "https://api.github.com/repos/rust-lang/rust/issues/9486", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/9486/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/9486/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/9486/events", "html_url": "https://github.com/rust-lang/rust/issues/9486", "id": 20019108, "node_id": "MDU6SXNzdWUyMDAxOTEwOA==", "number": 9486, "title": "Windows: stdout/stderr on `--subsystem windows`", "user": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2013-09-25T02:36:06Z", "updated_at": "2015-03-02T10:16:19Z", "closed_at": "2015-03-02T10:16:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\n$ cat a.rs\nfn main() { println(\"hello\"); }\n\n$ rustc.exe a.rs -o a.exe --link-args \"-Wl,--subsystem,windows\"\n```\n\n`--subsystem windows` means the program does not have console, and `_write(1, ...)` will return -1 with errno `EBADF`.\n\nSo at [fd_t::write()](https://github.com/mozilla/rust/blob/master/src/libstd/io.rs#L1266) `if nout < 0 as IoRet` is triggered, and `error!()` and `fail!()` are called.\nHowever, while printing error, `_write(2, ...)` also returns -1 and `fd_t::write()` raises another error. It causes segfault:\n\n```\n$ gdb ./a.exe\n(gdb) run\n...\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 40012.0x8888]\n0x7598d1d4 in KERNELBASE!FlushInstructionCache () from C:\\Windows\\SysWOW64\\KernelBase.dll\n\n(gdb) bt 10\n#0  0x7598d1d4 in KERNELBASE!FlushInstructionCache () from C:\\Windows\\SysWOW64\\KernelBase.dll\n#1  0x7598d1ae in KERNELBASE!FlushInstructionCache () from C:\\Windows\\SysWOW64\\KernelBase.dll\n#2  0x7598d37f in KERNELBASE!GetConsoleScreenBufferInfoEx () from C:\\Windows\\SysWOW64\\KernelBase.dll\n#3  0x75c1c427 in printf () from C:\\Windows\\SysWOW64\\msvcrt.dll\n#4  0xfffffffe in ?? ()\n#5  0x025750b4 in ?? ()\n#6  0x75c1bf52 in write () from C:\\Windows\\SysWOW64\\msvcrt.dll\n#7  0x00000002 in ?? ()\n#8  0x005e3810 in ?? ()\n#9  0x6258e108 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n(More stack frames follow...)\n\n(gdb) bt -20\n#9765 0x6258e321 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9766 0x625c8394 in rt::logging::Logger$StdErrLogger::log::hdc331d7fb995175b7waL::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9767 0x6258e321 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9768 0x625c8394 in rt::logging::Logger$StdErrLogger::log::hdc331d7fb995175b7waL::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9769 0x6258e321 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9770 0x625c8394 in rt::logging::Logger$StdErrLogger::log::hdc331d7fb995175b7waL::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9771 0x6258e321 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9772 0x625c8394 in rt::logging::Logger$StdErrLogger::log::hdc331d7fb995175b7waL::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9773 0x6258e321 in io::Writer$fd_t::write::hfc348125316ee38egak::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9774 0x00401429 in main::hccef5615fba560d8af::v0.0 ()\n#9775 0x625def1d in unstable::lang::start::anon::expr_fn::aD ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9776 0x625e613f in rt::task::__extensions__::build_start_wrapper::anon::anon::expr_fn::aL ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9777 0x625e4842 in rt::task::__extensions__::run::anon::expr_fn::a3 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9778 0x625e6409 in rt::task::Unwinder::try::try_fn::h2eb15e2727b07bNUaH::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9779 0x6e142196 in rust_try (f=0x625e63d0 <rt::task::Unwinder::try::try_fn::h2eb15e2727b07bNUaH::v0.8>,\n    fptr=0x625e4810, env=0x275d360) at C:/home/stone/rust/src/rt/rust_builtin.cpp:531\n#9780 0x625e46ef in rt::task::Unwinder::try::h199ab8d6eb226980NUa2::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9781 0x625e4558 in rt::task::Task::run::h199ab8d6eb226980I3a1::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9782 0x625e5d8e in rt::task::__extensions__::build_start_wrapper::anon::expr_fn::aC ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9783 0x62631262 in rt::context::Context::new::task_start_wrapper::h1b9fdc38dc3bcfa4xQaw::v0.8 ()\n   from C:\\home\\stone\\rust\\build\\i686-pc-mingw32\\stage2\\bin\\std-6c65cf4b443341b1-0.8.dll\n#9784 0x00000000 in ?? ()\n```\n", "closed_by": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/9486/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/9486/timeline", "performed_via_github_app": null, "state_reason": "completed"}