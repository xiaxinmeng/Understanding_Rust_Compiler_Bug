{"url": "https://api.github.com/repos/rust-lang/rust/issues/34089", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34089/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34089/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34089/events", "html_url": "https://github.com/rust-lang/rust/issues/34089", "id": 158546357, "node_id": "MDU6SXNzdWUxNTg1NDYzNTc=", "number": 34089, "title": "Bug: internal compiler error: unexpected panic | rust 1.8.0", "user": {"login": "gaditb", "id": 11385062, "node_id": "MDQ6VXNlcjExMzg1MDYy", "avatar_url": "https://avatars.githubusercontent.com/u/11385062?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gaditb", "html_url": "https://github.com/gaditb", "followers_url": "https://api.github.com/users/gaditb/followers", "following_url": "https://api.github.com/users/gaditb/following{/other_user}", "gists_url": "https://api.github.com/users/gaditb/gists{/gist_id}", "starred_url": "https://api.github.com/users/gaditb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gaditb/subscriptions", "organizations_url": "https://api.github.com/users/gaditb/orgs", "repos_url": "https://api.github.com/users/gaditb/repos", "events_url": "https://api.github.com/users/gaditb/events{/privacy}", "received_events_url": "https://api.github.com/users/gaditb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-06-05T09:39:44Z", "updated_at": "2016-06-05T15:58:45Z", "closed_at": "2016-06-05T15:58:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "Compiler panicked, I THINK when compiling a recursive call using part of an unpacked Enum.\n\nI tried this code:\n\n``` rust\nenum List<T> {\n    Elem(T, Box<List<T>>),\n    Nil\n}\n\n\nfn is_prime(x: i32, primes: &List<i32>) -> bool {\n    if x < 2 {\n        return false;\n    }\n    match primes {\n        &Nil => true,\n        &Elem(curr_prime, Box(rest_primes)) =>\n            x == curr_prime || x % curr_prime != 0 && is_prime(x, &rest_primes)\n    }\n}\n\nfn main() { }\n```\n\nI expected to see this happen:\n\nI'll be honest, I didn't expect this to work -- I expected this to spit out a heckuvalot of errors and stuff.\n\nI didn't expect to make it panic, though. I agree with the compiler -- it was unexpected.\n\nInstead, this happened:\n\nWell, the compiler panicked. (O_O)\n## Meta\n\n`rustc --version --verbose`:\n\nbinary: rustc\ncommit-hash: db2939409db26ab4904372c82492cd3488e4c44e\ncommit-date: 2016-04-11\nhost: x86_64-unknown-linux-gnu\nrelease: 1.8.0\n\nBacktrace:\n\n```\n$ RUST_BACKTRACE=1 rustc 004-primefacts.rs \n004-primefacts.rs:13:10: 13:14 error: unresolved enum variant, struct or const `Elem` [E0419]\n004-primefacts.rs:13         &Elem(curr_prime, Box(rest_primes)) =>\n                              ^~~~\n004-primefacts.rs:13:10: 13:14 help: run `rustc --explain E0419` to see a detailed explanation\n004-primefacts.rs:14:67: 14:79 error: mismatched types:\n expected `&List<i32>`,\n    found `&core::ptr::Unique<_>`\n(expected enum `List`,\n    found struct `core::ptr::Unique`) [E0308]\n004-primefacts.rs:14             x == curr_prime || x % curr_prime != 0 && is_prime(x, &rest_primes)\n                                                                                       ^~~~~~~~~~~~\n004-primefacts.rs:14:67: 14:79 help: run `rustc --explain E0308` to see a detailed explanation\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'index out of bounds: the len is 19 but the index is 21', ../src/libcollections/vec.rs:1178\nstack backtrace:\n   1:     0x7fcae3781330 - sys::backtrace::tracing::imp::write::h3675b4f0ca767761Xcv\n   2:     0x7fcae378a68b - panicking::default_handler::_$u7b$$u7b$closure$u7d$$u7d$::closure.44519\n   3:     0x7fcae378a1e3 - panicking::default_handler::h18faf4fbd296d909lSz\n   4:     0x7fcae374e9ac - sys_common::unwind::begin_unwind_inner::hfb5d07d6e405c6bbg1t\n   5:     0x7fcae374f448 - sys_common::unwind::begin_unwind_fmt::h8b491a76ae84af35m0t\n   6:     0x7fcae377ed91 - rust_begin_unwind\n   7:     0x7fcae37d17af - panicking::panic_fmt::h98b8cbb286f5298alcM\n   8:     0x7fcae37d1992 - panicking::panic_bounds_check::hdc4cd1d8a44957d1rbM\n   9:     0x7fcae0aa059f - middle::infer::InferCtxt<'a, 'tcx>::shallow_resolve::h52e879fe14a58134plE\n  10:     0x7fcae0b70b2b - middle::traits::fulfill::process_predicate::h5da25caa94a4806cjBU\n  11:     0x7fcae0b6f857 - obligation_forest::ObligationForest<O, T>::process_obligations::h1104985789425175896\n  12:     0x7fcae0b6aedf - middle::traits::fulfill::FulfillmentContext<'tcx>::select_where_possible::h36a34bf1ee9d49d2otU\n  13:     0x7fcae2d03f01 - check::FnCtxt<'a, 'tcx>::select_obligations_where_possible::hbeb814e1d6536f19JAq\n  14:     0x7fcae2d2a9ac - check::check_argument_types::hd87e5db73000b681J0q\n  15:     0x7fcae2dc233f - check::callee::confirm_builtin_call::h7ffe0a70871d3f9fdbm\n  16:     0x7fcae2d3c1dd - check::callee::check_call::hf63606df5d983743m2l\n  17:     0x7fcae2d53459 - check::check_expr_with_unifier::h1043101995598655204\n  18:     0x7fcae2d323b0 - check::op::check_binop::h54b43c346fbf3051IWn\n  19:     0x7fcae2d52d67 - check::check_expr_with_unifier::h1043101995598655204\n  20:     0x7fcae2d323b0 - check::op::check_binop::h54b43c346fbf3051IWn\n  21:     0x7fcae2d52d67 - check::check_expr_with_unifier::h1043101995598655204\n  22:     0x7fcae2d8169c - check::_match::check_match::_$u7b$$u7b$closure$u7d$$u7d$::closure.39392\n  23:     0x7fcae2d392d2 - check::_match::check_match::h566da3fd8c23ab55Thb\n  24:     0x7fcae2d52da2 - check::check_expr_with_unifier::h1043101995598655204\n  25:     0x7fcae2d0a90e - check::check_block_with_expected::hc4a627a63732f3b0jXs\n  26:     0x7fcae2d012b9 - check::check_fn::h6fb1443d16d6d1a1hOo\n  27:     0x7fcae2cfe9cf - check::check_bare_fn::h846d602fffbab51bLDo\n  28:     0x7fcae2cf9876 - check::check_item_body::h1bc79a321f78eb96h3o\n  29:     0x7fcae2cf032b - check::check_item_bodies::h5671f35c802ef7c1yBo\n  30:     0x7fcae2ce7bb3 - check_crate::h7bb847abc9f256eeeCC\n  31:     0x7fcae3cad667 - driver::phase_3_run_analysis_passes::_$u7b$$u7b$closure$u7d$$u7d$::closure.28550\n  32:     0x7fcae3cabc04 - middle::ty::context::ctxt<'tcx>::create_and_enter::h16192426302205697189\n  33:     0x7fcae3ca86ef - driver::phase_3_run_analysis_passes::h10920926650053012691\n  34:     0x7fcae3c7ba15 - driver::compile_input::h7ae6a86e23de0774Hca\n  35:     0x7fcae3c6ab47 - run_compiler::hb0408bcf47642fe6mPc\n  36:     0x7fcae3c682c1 - sys_common::unwind::try::try_fn::h7614151098073783683\n  37:     0x7fcae377ed1b - __rust_try\n  38:     0x7fcae37771fd - sys_common::unwind::inner_try::hadd81c754a64f07ciYt\n  39:     0x7fcae3c68b10 - boxed::F.FnBox<A>::call_box::h18261575856772421581\n  40:     0x7fcae3788c59 - sys::thread::Thread::new::thread_start::h9bc812305b5e01feFPy\n  41:     0x7fcadca490a3 - start_thread\n  42:     0x7fcae33f787c - clone\n  43:                0x0 - <unknown>\n```\n\n((Aside: is there ever such thing as an _expected_ panic? ;) ))\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34089/timeline", "performed_via_github_app": null, "state_reason": "completed"}