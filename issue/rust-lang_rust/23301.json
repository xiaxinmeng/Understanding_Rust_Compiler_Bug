{"url": "https://api.github.com/repos/rust-lang/rust/issues/23301", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23301/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23301/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23301/events", "html_url": "https://github.com/rust-lang/rust/issues/23301", "id": 60792447, "node_id": "MDU6SXNzdWU2MDc5MjQ0Nw==", "number": 23301, "title": "rustc --cfg parsing is lax; ICEs on --cfg \"\"", "user": {"login": "rprichard", "id": 1572855, "node_id": "MDQ6VXNlcjE1NzI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1572855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rprichard", "html_url": "https://github.com/rprichard", "followers_url": "https://api.github.com/users/rprichard/followers", "following_url": "https://api.github.com/users/rprichard/following{/other_user}", "gists_url": "https://api.github.com/users/rprichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/rprichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rprichard/subscriptions", "organizations_url": "https://api.github.com/users/rprichard/orgs", "repos_url": "https://api.github.com/users/rprichard/repos", "events_url": "https://api.github.com/users/rprichard/events{/privacy}", "received_events_url": "https://api.github.com/users/rprichard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-03-12T09:38:43Z", "updated_at": "2015-07-21T11:33:04Z", "closed_at": "2015-07-21T11:33:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\n$ RUST_BACKTRACE=1 rustc --cfg \"\"\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'position 0 does not resolve to a source location', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/codemap.rs:773\n\nstack backtrace:\n   1:     0x7fe3b3c72752 - sys::backtrace::write::haa06f2eb4ff4d5e5ADA\n   2:     0x7fe3b3c98792 - panicking::on_panic::hdcb20beee702c0b03IJ\n   3:     0x7fe3b3bded69 - rt::unwind::begin_unwind_inner::hbe159b4d97e14ee66oJ\n   4:     0x7fe3b3bdf111 - rt::unwind::begin_unwind_fmt::haee4ef7e01d3657fHnJ\n   5:     0x7fe3b1196a38 - codemap::CodeMap::lookup_filemap_idx::h96ac1c59c75dc900u7C\n   6:     0x7fe3b1194bc1 - codemap::CodeMap::lookup_char_pos::h51279553f4627f7bSUC\n   7:     0x7fe3b11950f5 - codemap::CodeMap::lookup_char_pos_adj::hcaba10a387a5285a5UC\n   8:     0x7fe3b119540d - codemap::CodeMap::span_to_string::hfafeb005cfdb9b99yVC\n   9:     0x7fe3b11edca2 - diagnostic::emit::h3699619c2b53fd34oCE\n  10:     0x7fe3b11eb5b7 - diagnostic::EmitterWriter.Emitter::emit::h192eeee6a59af027ZyE\n  11:     0x7fe3b11e9d67 - diagnostic::Handler::emit::h8baf6fed67201d3d3eE\n  12:     0x7fe3b119168a - diagnostic::SpanHandler::span_fatal::h087dc0374fe394cem2D\n  13:     0x7fe3b11fe744 - parse::parser::Parser<'a>::parse_ident::hdcb90b6ba49d1733g3H\n  14:     0x7fe3b124ebc6 - parse::attr::Parser<'a>.ParserAttr::parse_meta_item::h7d7f52f8f6262767m9T\n  15:     0x7fe3b1251b6e - parse::parse_meta_from_source_str::hbce91171fcad4c3axvU\n  16:     0x7fe3b1e62ec4 - iter::Map<I, F>.Iterator::next::h4056714858292786413\n  17:     0x7fe3b1e62a47 - session::config::parse_cfgspecs::h6d2932293b2e7b8azip\n  18:     0x7fe3b1e65459 - session::config::build_session_options::hbe60bdcd2bec83684ip\n  19:     0x7fe3b4336cdc - run_compiler::h6c6deadca3c1da44N6b\n  20:     0x7fe3b43356fc - thunk::F.Invoke<A, R>::invoke::h17587398869216592240\n  21:     0x7fe3b4334350 - rt::unwind::try::try_fn::h13136719022791656042\n  22:     0x7fe3b3d045b8 - rust_try_inner\n  23:     0x7fe3b3d045a5 - rust_try\n  24:     0x7fe3b4334adb - thunk::F.Invoke<A, R>::invoke::h15245498111397843904\n  25:     0x7fe3b3c85f95 - sys::thread::thread_start::hf986f8b6540d7d70daF\n  26:     0x7fe3adccf181 - start_thread\n  27:     0x7fe3b385747c - __clone\n  28:                0x0 - <unknown>\n```\n\nThe compiler is trying to report that the `--cfg` argument is invalid, but I guess it's not prepared to handle 0-length source code?\n\n```\n$ rustc --version --verbose\nrustc 1.0.0-nightly (cfea8ec41 2015-03-10) (built 2015-03-11)\nbinary: rustc\ncommit-hash: cfea8ec41699e25c8fb524d625190f0cb860dc71\ncommit-date: 2015-03-10\nbuild-date: 2015-03-11\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-nightly\n```\n\nI also think it's a little strange that I can pass arbitrary source code to the `--cfg` command-line argument, and trailing source code is frequently ignored:\n\ne.g. I _think_ these two invocations are equivalent:\n\n```\nrustc --cfg foo,bar --cfg '/*foo*/ feature=\"A\",\"B\" <-THIS IS IGNORED->' hello.rs\nrustc --cfg foo     --cfg 'feature=\"A\"' hello.rs\n```\n\nI'm also wondering if the syntax could be just `--cfg feature=A`.  The quoting is inconvenient.\n", "closed_by": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23301/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23301/timeline", "performed_via_github_app": null, "state_reason": "completed"}