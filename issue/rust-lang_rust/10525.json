{"url": "https://api.github.com/repos/rust-lang/rust/issues/10525", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10525/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10525/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10525/events", "html_url": "https://github.com/rust-lang/rust/issues/10525", "id": 22787706, "node_id": "MDU6SXNzdWUyMjc4NzcwNg==", "number": 10525, "title": "Argument expression move happens before all arguments are evaluated", "user": {"login": "yuriks", "id": 341401, "node_id": "MDQ6VXNlcjM0MTQwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/341401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuriks", "html_url": "https://github.com/yuriks", "followers_url": "https://api.github.com/users/yuriks/followers", "following_url": "https://api.github.com/users/yuriks/following{/other_user}", "gists_url": "https://api.github.com/users/yuriks/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuriks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuriks/subscriptions", "organizations_url": "https://api.github.com/users/yuriks/orgs", "repos_url": "https://api.github.com/users/yuriks/repos", "events_url": "https://api.github.com/users/yuriks/events{/privacy}", "received_events_url": "https://api.github.com/users/yuriks/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-11-16T23:42:18Z", "updated_at": "2014-03-31T21:39:05Z", "closed_at": "2014-03-31T21:39:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I briefly discussed this on IRC and was encouraged to submit an issue about it.\n\nWhen the expressions of two arguments to a function both borrow the same object, but with non-overlapping lifetimes, an error is issued anyway.\n\nFor example, in this testcase:\n\n``` rust\nstruct Room {\n    foo: ~str,\n}\n\nfn dummy_insert<K, V>(key: K, value: V) {\n}\n\nfn add_room(id: ~str) {\n    dummy_insert(id, Room { foo: id.clone() });\n}\n\nfn main() {\n}\n```\n\nProduces this error:\n\n```\nsrc/main.rs:9:30: 9:32 error: use of moved value: `id`\nsrc/main.rs:9   dummy_insert(id, Room { foo: id.clone() });\n                                             ^~\nsrc/main.rs:9:14: 9:16 note: `id` moved here because it has type `~str`, which is non-copyable (perhaps you meant to use clone()?)\nsrc/main.rs:9   dummy_insert(id, Room { foo: id.clone() });\n                             ^~\nerror: aborting due to previous error\ntask 'rustc' failed at 'explicit failure', /home/yuriks/rust/src/libsyntax/diagnostic.rs:101\ntask '<main>' failed at 'explicit failure', /home/yuriks/rust/src/librustc/lib.rs:396\n```\n\nEven though the `Room { ... }` constructor expression is fully evaluated before the function call happens. It seem that the moving is happening as part of the left-to-right evaluation of arguments, instead of that happening when the function is actually called. Cloning in the 1st argument instead works, but reads more confusingly to me.\n\nMaybe this is intended behaviour, but it doesn't seem ideal to me.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10525/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10525/timeline", "performed_via_github_app": null, "state_reason": "completed"}