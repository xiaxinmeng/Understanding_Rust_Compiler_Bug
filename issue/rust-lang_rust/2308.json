{"url": "https://api.github.com/repos/rust-lang/rust/issues/2308", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2308/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2308/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2308/events", "html_url": "https://github.com/rust-lang/rust/issues/2308", "id": 4317763, "node_id": "MDU6SXNzdWU0MzE3NzYz", "number": 2308, "title": "upcall fail 'ty_size: unhandled type' in src/rustc/middle/trans/native.rs", "user": {"login": "flaviusb", "id": 64478, "node_id": "MDQ6VXNlcjY0NDc4", "avatar_url": "https://avatars.githubusercontent.com/u/64478?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaviusb", "html_url": "https://github.com/flaviusb", "followers_url": "https://api.github.com/users/flaviusb/followers", "following_url": "https://api.github.com/users/flaviusb/following{/other_user}", "gists_url": "https://api.github.com/users/flaviusb/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaviusb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaviusb/subscriptions", "organizations_url": "https://api.github.com/users/flaviusb/orgs", "repos_url": "https://api.github.com/users/flaviusb/repos", "events_url": "https://api.github.com/users/flaviusb/events{/privacy}", "received_events_url": "https://api.github.com/users/flaviusb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2012-04-27T07:44:58Z", "updated_at": "2012-05-03T03:01:23Z", "closed_at": "2012-05-03T03:01:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "When compiling the sqlite bindings for rust from https://github.com/linuxfood/rustsqlite/ I hit the error\n`error: internal compiler error unexpected failure`.\n\nI am running on Rust HEAD (https://github.com/mozilla/rust/commit/43751e45d90ed3a2f5a9d0208d50125d88af6dfc).\n\nWhen I run\n`RUST_LOG=rustc=0,::rt::backtrace rustc sqlite.rc` after cloning linuxfood's rustsqlite repo, I get this as output:\n\n```\nrust: upcall fail 'ty_size: unhandled type', src/rustc/middle/trans/native.rs:104\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task4failEv+0x28)[0x7f04db110448]\n/usr/local/bin/../lib/librustrt.so(+0x2c009)[0x7f04db124009]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x137)[0x7f04db113297]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x121956)[0x7f04db473956]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x12184b)[0x7f04db47384b]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x1228e9)[0x7f04db4748e9]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x12236c)[0x7f04db47436c]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x124297)[0x7f04db476297]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x1264d7)[0x7f04db4784d7]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6middle5trans6native16trans_native_mod17_dc17af4b1c82a4f8202E+0x177)[0x7f04db4417c7]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6middle5trans4base10trans_item17_845a71205311a633202E+0x11c6)[0x7f04db41c066]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6middle5trans4base9trans_mod17_30dab49a877624cb202E+0x104)[0x7f04db4415b4]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6middle5trans4base11trans_crate17_13dfc7dba4ba76da202E+0x1231)[0x7f04db44efd1]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x392cdc)[0x7f04db6e4cdc]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6driver6driver12compile_upto17_3ab2da55639870be202E+0x2c14)[0x7f04db6ca374]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(+0x392cdc)[0x7f04db6e4cdc]\n/usr/local/bin/../lib/librustc-688fa7810161fd45-0.2.so(_ZN6driver6driver13compile_input17_886bcaf2bf8e4793202E+0xd4)[0x7f04db6cdf04]\nrustc[0x406801]\nrustc[0x40a158]\nrustc[0x4095de]\nrustc[0x409208]\n/usr/local/bin/../lib/libcore-d27e4777a53c3e50-0.2.so(+0x30ac5)[0x7f04dc733ac5]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x2b)[0x7f04db110d9b]\nerror: internal compiler error unexpected failure\nnote: The compiler hit an unexpected failure path. This is a bug. Try running with RUST_LOG=rustc=0,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: upcall fail 'explicit failure', src/rustc/driver/rustc.rs:226\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task4failEv+0x28)[0x7f04db110448]\n/usr/local/bin/../lib/librustrt.so(+0x2c009)[0x7f04db124009]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x137)[0x7f04db113297]\nrustc[0x408ba4]\nrustc[0x40a158]\nrustc[0x409b6a]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x2b)[0x7f04db110d9b]\nrust: domain main @0xbdfed0 root task failed\n```\n\nOutput of `uname -a` is\n\nLinux vvvvv 3.3.2-1-ARCH #1 SMP PREEMPT Sat Apr 14 09:48:37 CEST 2012 x86_64 Intel(R) Core(TM)2 Duo CPU T9400 @ 2.53GHz GenuineIntel GNU/Linux\n\nI went digging in src/rustc/middle/trans/native.rs, and the problem seems to be that fn ty_size(ty: TypeRef) -> uint is being called with a TypeRef of type  FunctionTyID (which gives an integer 11 in the alt).\n\nI am not sure where to go with this from here, and have not been able to put together a minimal test case.\n", "closed_by": {"login": "flaviusb", "id": 64478, "node_id": "MDQ6VXNlcjY0NDc4", "avatar_url": "https://avatars.githubusercontent.com/u/64478?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaviusb", "html_url": "https://github.com/flaviusb", "followers_url": "https://api.github.com/users/flaviusb/followers", "following_url": "https://api.github.com/users/flaviusb/following{/other_user}", "gists_url": "https://api.github.com/users/flaviusb/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaviusb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaviusb/subscriptions", "organizations_url": "https://api.github.com/users/flaviusb/orgs", "repos_url": "https://api.github.com/users/flaviusb/repos", "events_url": "https://api.github.com/users/flaviusb/events{/privacy}", "received_events_url": "https://api.github.com/users/flaviusb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2308/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2308/timeline", "performed_via_github_app": null, "state_reason": "completed"}