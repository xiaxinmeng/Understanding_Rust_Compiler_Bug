{"url": "https://api.github.com/repos/rust-lang/rust/issues/26619", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26619/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26619/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26619/events", "html_url": "https://github.com/rust-lang/rust/issues/26619", "id": 91455761, "node_id": "MDU6SXNzdWU5MTQ1NTc2MQ==", "number": 26619, "title": "Yet another bug with slice_patterns", "user": {"login": "leonardinius", "id": 371909, "node_id": "MDQ6VXNlcjM3MTkwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/371909?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leonardinius", "html_url": "https://github.com/leonardinius", "followers_url": "https://api.github.com/users/leonardinius/followers", "following_url": "https://api.github.com/users/leonardinius/following{/other_user}", "gists_url": "https://api.github.com/users/leonardinius/gists{/gist_id}", "starred_url": "https://api.github.com/users/leonardinius/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leonardinius/subscriptions", "organizations_url": "https://api.github.com/users/leonardinius/orgs", "repos_url": "https://api.github.com/users/leonardinius/repos", "events_url": "https://api.github.com/users/leonardinius/events{/privacy}", "received_events_url": "https://api.github.com/users/leonardinius/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 632838966, "node_id": "MDU6TGFiZWw2MzI4Mzg5NjY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-slice-patterns", "name": "A-slice-patterns", "color": "f7e101", "default": false, "description": "Area: slice patterns, https://github.com/rust-lang/rust/issues/23121"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2015-06-27T12:19:15Z", "updated_at": "2019-03-13T01:29:23Z", "closed_at": "2019-03-13T01:29:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm not particularly sure. It's either the bug with compiler failing to enforce lifetime rule or data corruption in Iterator ~~`flat_map`~~ `filter_map` (_Updated_). \n\n---\n\nI tried code found at https://github.com/leonardinius/git-wayback-machine.rs/tree/rust-bug:\n\nUnfortunately I fail to reproduce the bug in different conditions and fail to create standalone code snippet to reproduce  the bug.\n\nHow to repeat:\n\n``` shell\n#shell\n$ git clone https://github.com/leonardinius/git-wayback-machine.rs.git\n$ cd git-wayback-machine.rs\n$ git checkout rust-bug\n$ cargo build\n$ env RUST_LOG=debug  target/debug/git-wayback-machine 2>&1 | egrep \"3 Page - Inspect 1-2|3 Page - Inspect 2-2\"\n```\n\n---\n\nI expected to see this happen:\n\nSince they iterate the same vector data **_before_** and **_after_** `flat_map` (See [history.rs#L62-L71](https://github.com/leonardinius/git-wayback-machine.rs/blob/rust-bug/src/history.rs#L62-L71)) I expect the following lines to be as follows.  \n\n```\nDEBUG:git_wayback_machine::history: 3 Page - Inspect 1-2: Entry: \"9419034\" \"7 days ago\" \"Leonids Maslovs\": \"Personal e-mail?\"                                                                     \nDEBUG:git_wayback_machine::history: 3 Page - Inspect 2-2: Entry: \"9419034\" \"7 days ago\" \"Leonids Maslovs\": \"Personal e-mail?\"                                                                     \n```\n\n---\n\nInstead, this happened: See lines below. Line `3 Page - Inspect 1-2: Entry:` and `3 Page - Inspect 2-2: Entry:` entries should read the same. \n\n```\nDEBUG:git_wayback_machine::history: 3 Page - Inspect 1-2: Entry: \"368669f\" \"7 days ago\" \"Leonids Maslovs\": \"Try out execd command sample\"                                                         \nDEBUG:git_wayback_machine::history: 3 Page - Inspect 2-2: Entry: \"3\\u{2}\\u{107}\\u{7f}\\u{0}\" \"\\u{f}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{633}\" \"\\u{7}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{233}\\u{2\n}\\u{107}\\u{7f}\\u{0}\": \"\\u{107}\\u{7f}\\u{0}\\u{0}\\n\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{f3}\\u{2}\\u{107}\\u{7f}\\u{0}\\u{0}\\u{10}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\\u{0}\"                                        \n```\n\nMy assumptions / what went wrong:\n- ? Data corruption has happened at `flat_map` \n- ? Compiler didn't (but should) throw me away at [history.rs#L62-L71](https://github.com/leonardinius/git-wayback-machine.rs/blob/rust-bug/src/history.rs#L62-L71) and  [history.rs#L73-L82](https://github.com/leonardinius/git-wayback-machine.rs/blob/rust-bug/src/history.rs#L73-L82), returning `Option<Entry>` **_without_** reference classifier\n\n---\n## Meta\n\n`rustc --version --verbose`:\n\n```\nrustc 1.3.0-nightly (912ab64a0 2015-06-25)                                                                                                                                                        \nbinary: rustc                                                                                                                                                                                     \ncommit-hash: 912ab64a0de2c121a1c9f10bb1dbe75983b78c73                                                                                                                                             \ncommit-date: 2015-06-25                                                                                                                                                                           \nhost: x86_64-unknown-linux-gnu                                                                                                                                                                    \nrelease: 1.3.0-nightly\n```\n\nBacktrace:\n\nNo backtrace\n\n---\n\nPlease do not hesitate to ask me for more information and standalone code snippets, however  you might need to help me to create those ;)\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26619/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26619/timeline", "performed_via_github_app": null, "state_reason": "completed"}