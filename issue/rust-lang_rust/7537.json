{"url": "https://api.github.com/repos/rust-lang/rust/issues/7537", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7537/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7537/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7537/events", "html_url": "https://github.com/rust-lang/rust/issues/7537", "id": 16238953, "node_id": "MDU6SXNzdWUxNjIzODk1Mw==", "number": 7537, "title": "ICE when matching an enum from a sibling module with a {} variant", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-07-01T22:30:49Z", "updated_at": "2013-09-04T21:33:37Z", "closed_at": "2013-09-04T21:33:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I get ICEs with rust f348465283d6cd85b69bcdc1711d14985d154c39 (used in Servo) for the following code. There is no error if the enum and match are in the same module, or if the enum has no {} variant.\n\na.rs:\n\n```\nuse b::*;\nmod b;\n\npub fn fuuu(a: A) -> int {\n    match a {\n        lol => 42,\n        _ => 1,\n    }\n}\n```\n\nb.rs\n\n```\npub enum A {\n    lol,\n    fuu{a: int},\n}\n```\n\nc.rc\n\n```\npub mod a;\npub mod b;\nfn main(){}\n```\n\nOutput:\n\n```\n% RUST_LOG=rustc=1,::rt::backtrace rustc c.rc \nrust: task failed at 'struct variant kinds unimpl in enum_variants', /home/simon/projects/rust/src/librustc/middle/ty.rs:4098\n/home/simon/non-packages/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fcd62be870b]\n/home/simon/non-packages/bin/../lib/librustrt.so(+0x2a3a9)[0x7fcd62bf93a9]\n/home/simon/non-packages/bin/../lib/librustrt.so(upcall_fail+0x198)[0x7fcd62bea658]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(_ZN3sys13begin_unwind_16_615cb041c655a976_07preE+0x63)[0x7fcd64c28cc3]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x123c52)[0x7fcd64c28c52]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(_ZN3sys14__extensions__9meth_89449fail_with17_ac9eb45dc42bd6906_07preE+0x6b)[0x7fcd64b6835b]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x41fb20)[0x7fcd6323cb20]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x41f78c)[0x7fcd6323c78c]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle2ty13enum_variants16_bfaf9f09960f24c6_07preE+0x430)[0x7fcd62f562e0]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle2ty20enum_variant_with_id16_28d184f51b9a5546_07preE+0x6e)[0x7fcd630394fe]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check6_match17check_pat_variant16_89cbaa367e8eb636_07preE+0x825)[0x7fcd63305e55]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check6_match9check_pat17_aacdb0bc641839d36_07preE+0x7286)[0x7fcd63301216]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check6_match11check_match17_b2b718ab8c45a4176_07preE+0x409)[0x7fcd632f4e29]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check23check_expr_with_unifier17_de73127bc1f720266_07preE+0x5b52)[0x7fcd633de022]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check24check_expr_with_opt_hint17_3da35bbcf3bd40d56_07preE+0xa5)[0x7fcd633fa195]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check25check_block_with_expected16_d54a8e70ba2c25e6_07preE+0x7bd)[0x7fcd633a386d]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check8check_fn15_4e26cd1528d9fd6_07preE+0x15fd)[0x7fcd633a175d]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check13check_bare_fn14_db4ccfa8eddcf6_07preE+0x1e6)[0x7fcd6339fbf6]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check10check_item17_3b3d66d6c0e681126_07preE+0x56a)[0x7fcd6339eb0a]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x5813fd)[0x7fcd6339e3fd]\n/home/simon/non-packages/bin/../lib/libsyntax-84efebcb12c867a2-0.7-pre.so(+0xf90c7)[0x7fcd63e7c0c7]\n/home/simon/non-packages/bin/../lib/libsyntax-84efebcb12c867a2-0.7-pre.so(+0xf86aa)[0x7fcd63e7b6aa]\n/home/simon/non-packages/bin/../lib/libsyntax-84efebcb12c867a2-0.7-pre.so(+0xf9733)[0x7fcd63e7c733]\n/home/simon/non-packages/bin/../lib/libsyntax-84efebcb12c867a2-0.7-pre.so(+0xf86aa)[0x7fcd63e7b6aa]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x2d8dd1)[0x7fcd630f5dd1]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck5check16check_item_types17_9b946a891a2a91716_07preE+0x43e)[0x7fcd6339e18e]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x7180a2)[0x7fcd635350a2]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x717df9)[0x7fcd63534df9]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle6typeck11check_crate17_54349f39c7ca78196_07preE+0x295)[0x7fcd63532485]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver12compile_rest17_32718fb030861ff16_07preE+0x1555)[0x7fcd6384eb75]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver12compile_upto16_3b13f5438b2e4f86_07preE+0x192)[0x7fcd63854dd2]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver13compile_input17_812b75735864b8556_07preE+0x107)[0x7fcd63855257]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN12run_compiler17_e6dc2544c438b05b6_07preE+0x2bbb)[0x7fcd63884d5b]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0xa7a80e)[0x7fcd6389780e]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0xa781bc)[0x7fcd638951bc]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0xa71bec)[0x7fcd6388ebec]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0xa7aae8)[0x7fcd63897ae8]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0xece75)[0x7fcd64bf1e75]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x169058)[0x7fcd64c6e058]\n/home/simon/non-packages/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fcd62be9084]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/simon/projects/rust/src/librustc/rustc.rc:355\n/home/simon/non-packages/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fcd62be870b]\n/home/simon/non-packages/bin/../lib/librustrt.so(+0x2a3a9)[0x7fcd62bf93a9]\n/home/simon/non-packages/bin/../lib/librustrt.so(upcall_fail+0x198)[0x7fcd62bea658]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(_ZN3sys13begin_unwind_16_615cb041c655a976_07preE+0x63)[0x7fcd64c28cc3]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x123d72)[0x7fcd64c28d72]\n/home/simon/non-packages/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0xc3c34)[0x7fcd64bc8c34]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN7monitor15_f69b167efde7bb6_07preE+0x2415)[0x7fcd63888355]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0xa7aae8)[0x7fcd63897ae8]\n/home/simon/non-packages/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN4main15_c4de63b748e03d6_07preE+0x69)[0x7fcd63897749]\nrustc(_rust_main+0x2e)[0x400c0e]\n/home/simon/non-packages/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fcd62be9084]\nrust: domain main @0x193d410 root task failed\n```\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7537/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7537/timeline", "performed_via_github_app": null, "state_reason": "completed"}