{"url": "https://api.github.com/repos/rust-lang/rust/issues/42201", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42201/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42201/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42201/events", "html_url": "https://github.com/rust-lang/rust/issues/42201", "id": 231158939, "node_id": "MDU6SXNzdWUyMzExNTg5Mzk=", "number": 42201, "title": "Update docker images to share scripts when possible", "user": {"login": "malbarbo", "id": 1678126, "node_id": "MDQ6VXNlcjE2NzgxMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1678126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/malbarbo", "html_url": "https://github.com/malbarbo", "followers_url": "https://api.github.com/users/malbarbo/followers", "following_url": "https://api.github.com/users/malbarbo/following{/other_user}", "gists_url": "https://api.github.com/users/malbarbo/gists{/gist_id}", "starred_url": "https://api.github.com/users/malbarbo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/malbarbo/subscriptions", "organizations_url": "https://api.github.com/users/malbarbo/orgs", "repos_url": "https://api.github.com/users/malbarbo/repos", "events_url": "https://api.github.com/users/malbarbo/events{/privacy}", "received_events_url": "https://api.github.com/users/malbarbo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-05-24T20:18:18Z", "updated_at": "2017-07-13T10:50:35Z", "closed_at": "2017-07-13T10:50:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://github.com/rust-lang/rust/pull/41958 added the possibility of sharing scripts used in docker images. This allows, for example, to use the same script to install sccache in all images, consequently  updating sccache can be done updating only one file.\r\n\r\nWe should update all images to share scripts when possible.\r\n\r\nTo update an image, one can follow these sequence of steps:\r\n\r\n- Choose an unchecked image in the below list;\r\n- Replace long `RUN` lines in the dockerfile of the image with scripts (like `sccache.sh` and `dum-init.sh` in `src/ci/docker/scripts/`, see for example the updates of [`arm-android`](https://github.com/rust-lang/rust/pull/41958/commits/307d8e5aa5f0c66881b1028fe1dc7f17e5ea317a#diff-c8faa107ca2811fa1a407474fce154bd) and [`dist-android`](https://github.com/rust-lang/rust/pull/41958/commits/307d8e5aa5f0c66881b1028fe1dc7f17e5ea317a#diff-6a6a986ec80374b59c335e7f3726e3f5)). You can organize the dockerfile in sections to make it easy to follow. sccache should be installed last. This avoids the whole container rebuild when sscache is updated;\r\n- See if files in `COPY` lines are duplicated in other images (duplicated files can be found using the command `fdupes -r src/ci/`). If there are duplicated files, move then to `src/ci/docker/scripts/` and update the docker files;\r\n- Test with the command `src/ci/docker/run.sh image` with the modified image still works (docker is required).\r\n\r\nList of images (unchecked images need to be updated):\r\n\r\n- [x] arm-android\r\n- [ ] armhf-gnu\r\n- [x] cross\r\n- [ ] dist-aarch64-linux\r\n- [x] dist-android\r\n- [ ] dist-armhf-linux\r\n- [ ] dist-arm-linux\r\n- [ ] dist-armv7-linux\r\n- [ ] dist-fuchsia\r\n- [ ] dist-i586-gnu-i686-musl\r\n- [ ] dist-i686-freebsd\r\n- [ ] dist-i686-linux\r\n- [ ] dist-mips64el-linux\r\n- [ ] dist-mips64-linux\r\n- [ ] dist-mipsel-linux\r\n- [ ] dist-mips-linux\r\n- [ ] dist-powerpc64le-linux\r\n- [ ] dist-powerpc64-linux\r\n- [ ] dist-powerpc-linux\r\n- [ ] dist-s390x-linux\r\n- [ ] dist-x86_64-freebsd\r\n- [ ] dist-x86_64-linux\r\n- [ ] dist-x86_64-musl\r\n- [ ] dist-x86_64-netbsd\r\n- [ ] emscripten\r\n- [ ] i686-gnu\r\n- [ ] i686-gnu-nopt\r\n- [ ] x86_64-gnu\r\n- [ ] x86_64-gnu-aux\r\n- [ ] x86_64-gnu-debug\r\n- [ ] x86_64-gnu-distcheck\r\n- [ ] x86_64-gnu-full-bootstrap\r\n- [ ] x86_64-gnu-incremental\r\n- [ ] x86_64-gnu-llvm-3.7\r\n- [ ] x86_64-gnu-nopt", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42201/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42201/timeline", "performed_via_github_app": null, "state_reason": "completed"}