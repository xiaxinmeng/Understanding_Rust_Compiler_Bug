{"url": "https://api.github.com/repos/rust-lang/rust/issues/94656", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/94656/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/94656/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/94656/events", "html_url": "https://github.com/rust-lang/rust/issues/94656", "id": 1160496021, "node_id": "I_kwDOAAsO6M5FK8OV", "number": 94656, "title": "linking error when compiling for wasm-unknown-unknown ", "user": {"login": "bornjre", "id": 24917215, "node_id": "MDQ6VXNlcjI0OTE3MjE1", "avatar_url": "https://avatars.githubusercontent.com/u/24917215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bornjre", "html_url": "https://github.com/bornjre", "followers_url": "https://api.github.com/users/bornjre/followers", "following_url": "https://api.github.com/users/bornjre/following{/other_user}", "gists_url": "https://api.github.com/users/bornjre/gists{/gist_id}", "starred_url": "https://api.github.com/users/bornjre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bornjre/subscriptions", "organizations_url": "https://api.github.com/users/bornjre/orgs", "repos_url": "https://api.github.com/users/bornjre/repos", "events_url": "https://api.github.com/users/bornjre/events{/privacy}", "received_events_url": "https://api.github.com/users/bornjre/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-03-06T02:06:16Z", "updated_at": "2022-06-19T23:01:46Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "\r\nlinking error when compiling for `wasm-unknown-unknown`  target (wasmer, not browser/js), whenever i include a mod/file that is using Hashmap or some other library linking fails. Probably related to multivalue?\r\n\r\n`rustc 1.61.0-nightly (68369a041 2022-02-22)`\r\n[rust_err_example.zip](https://github.com/rust-lang/rust/files/8191827/rust_err_example.zip)\r\n\r\n\r\nminimal reproducible program \r\n\r\n```rust\r\n\r\n/*\r\n// .cargo/config\r\n\r\n[build]\r\ntarget = \"wasm32-unknown-unknown\"\r\nrustflags = [\"-C\", \"target-feature=+multivalue\"]\r\n\r\n*/\r\n\r\nuse std::{collections::HashMap};\r\n\r\n\r\n#[no_mangle]\r\npub extern \"C\" fn hello_wasm() {\r\n    let mut h = HashMap::new();\r\n    h.insert(\"aaa\", \"bbbb\");\r\n}\r\n\r\nextern \"C\" {\r\n    fn _eg_host_fn(dataptr: *const u8, datalen: usize);\r\n}\r\n\r\n\r\n\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\n\u276f RUST_BACKTRACE=1 cargo build\r\n   Compiling rust_err_example v0.1.0 (/home/madman/zhome/code/project1/project1/code/sdk/rust_err_example)\r\nerror: linking with `rust-lld` failed: exit status: 1\r\n  |\r\n  = note: \"rust-lld\" \"-flavor\" \"wasm\" \"--rsp-quoting=posix\" \"--export\" \"hello_wasm\" \"--export=__heap_base\" \"--export=__data_end\" \"-z\" \"stack-size=1048576\" \"--stack-first\" \"--allow-undefined\" \"--fatal-warnings\" \"--no-demangle\" \"--no-entry\" \"--export-dynamic\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.11iwiw9r0s5mzjb7.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1258ztn9pt5knfvs.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.12xhe7leq0aju6fd.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.188i91463q8e9p84.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1h0ysnt5937kmbzk.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1nlz73acqyac20pl.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1o38r4jvicv5u4p3.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1o40oc3xw3pw1jjz.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.1yz127u1anjmc6m.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.233m9qjz05hce2rg.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.23bw55ocu8niaw11.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.24f2ki5wkma8dv5c.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.27v0g9hmzq1z91ei.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.289rd83e4ctsbkwf.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2ctonn8v2m51gczi.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2hvia29cdkwujjdq.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2lcy2aajvfmjs2sd.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2md2e4m3cb9crd0p.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2rn6s3uoi53kzzet.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2rpk3k7cwb2uj22t.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2ursypg8rt1ogssm.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.2v0u5ndce2ic5iqp.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.30b2xblpnthpz8bh.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3cj95sxwxz854oln.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3cora075ycv7iqzq.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3d64wbyhsfmgqocf.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3gffdm44o345r9rw.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3ggpxa8xd4oolnh3.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3hd0somw0vpiectf.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3n5kna9tzigs0n0w.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3o5062kejcxwx2tk.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3rq4k7i4ust2vhb0.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.48kdz4t1twhak8f7.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4cvrgxhhfnkdrhli.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4gzneq5bphgbffd7.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4ia3e7uubejtgl2r.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4kth0yjzxkifma06.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4qshhnty03lrm7n0.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4t3icbkw15xe0ze4.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4valv0k3l3b09fxl.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4vb0osqimq4533q0.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.4wa36n7a72ay8zjk.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.54dqbdhad8e0i5v3.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.54gs9cii5q2nxfna.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.566dk5mgmrgcaur1.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.5a1bfzacojdeylyn.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.5q4z5jmgtaqrwkm.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.650nzpbq2sfvruu.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.gffu2pc0i2wzusr.rcgu.o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.66tx2mizddcosfb.rcgu.o\" \"-L\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps\" \"-L\" \"/home/madman/zhome/code/project1/project1/target/debug/deps\" \"-L\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libstd-d9a8e4ca4a56d589.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libpanic_abort-da549f624a11fc3f.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libdlmalloc-32eef8ba9e79754a.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/librustc_demangle-a4b3f55336174ba0.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libstd_detect-a6de6d9a3d929e91.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libhashbrown-e1fe72c54436e3c8.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libminiz_oxide-25ac77357ee76304.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libadler-da31b97afd77e5cd.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/librustc_std_workspace_alloc-e4890f293e1fb8b8.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libunwind-401a7652bd4b8049.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libcfg_if-7cf7d086fa3880b1.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/liblibc-bc607ebb983da335.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/liballoc-e7063ff5ba60248a.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/librustc_std_workspace_core-10bf4b0039d4de0f.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libcore-3365b6c50e94718e.rlib\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libcompiler_builtins-0a74812a9f34fee4.rlib\" \"-L\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib\" \"-L\" \"/home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/self-contained\" \"-o\" \"/home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.wasm\" \"--gc-sections\" \"--no-entry\" \"-O0\"\r\n  = note: rust-lld: error: function signature mismatch: _ZN9hashbrown3raw11Fallibility9alloc_err17h87bbeac836209cefE\r\n          >>> defined as (i32, i32, i32) -> i32 in /home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.233m9qjz05hce2rg.rcgu.o\r\n          >>> defined as (i32, i32, i32, i32) -> void in /home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libhashbrown-e1fe72c54436e3c8.rlib(hashbrown-e1fe72c54436e3c8.hashbrown.578d61c0-cgu.0.rcgu.o)\r\n          \r\n          rust-lld: error: function signature mismatch: _ZN9hashbrown3raw11Fallibility17capacity_overflow17h758747893b4c22b1E\r\n          >>> defined as (i32) -> i32 in /home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.233m9qjz05hce2rg.rcgu.o\r\n          >>> defined as (i32, i32) -> void in /home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libhashbrown-e1fe72c54436e3c8.rlib(hashbrown-e1fe72c54436e3c8.hashbrown.578d61c0-cgu.0.rcgu.o)\r\n          \r\n          rust-lld: error: function signature mismatch: _ZN3std3sys4wasm6common19hashmap_random_keys17h19d54f33dc288cf5E\r\n          >>> defined as () -> i64 in /home/madman/zhome/code/project1/project1/target/wasm32-unknown-unknown/debug/deps/rust_err_example.3cj95sxwxz854oln.rcgu.o\r\n          >>> defined as (i32) -> void in /home/madman/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/wasm32-unknown-unknown/lib/libstd-d9a8e4ca4a56d589.rlib(std-d9a8e4ca4a56d589.std.9d65eda6-cgu.0.rcgu.o)\r\n          \r\n\r\nerror: could not compile `rust_err_example` due to previous error\r\n\r\n```\r\n```\r\nrustup show\r\nDefault host: x86_64-unknown-linux-gnu\r\nrustup home:  /home/madman/.rustup\r\n\r\ninstalled toolchains\r\n--------------------\r\n\r\nstable-x86_64-unknown-linux-gnu\r\nnightly-2021-04-15-x86_64-unknown-linux-gnu\r\nnightly-2021-07-28-x86_64-unknown-linux-gnu\r\nnightly-x86_64-unknown-linux-gnu (default)\r\n\r\ninstalled targets for active toolchain\r\n--------------------------------------\r\n\r\nwasm32-unknown-unknown\r\nx86_64-unknown-linux-gnu\r\n\r\nactive toolchain\r\n----------------\r\n\r\nnightly-x86_64-unknown-linux-gnu (default)\r\nrustc 1.61.0-nightly (68369a041 2022-02-22)\r\n\r\n```\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/94656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/94656/timeline", "performed_via_github_app": null, "state_reason": null}