{"url": "https://api.github.com/repos/rust-lang/rust/issues/107057", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107057/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107057/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107057/events", "html_url": "https://github.com/rust-lang/rust/issues/107057", "id": 1548416750, "node_id": "I_kwDOAAsO6M5cSvbu", "number": 107057, "title": "In the other thread the code executes, but no effect occurs", "user": {"login": "Amazingkenneth", "id": 81886982, "node_id": "MDQ6VXNlcjgxODg2OTgy", "avatar_url": "https://avatars.githubusercontent.com/u/81886982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amazingkenneth", "html_url": "https://github.com/Amazingkenneth", "followers_url": "https://api.github.com/users/Amazingkenneth/followers", "following_url": "https://api.github.com/users/Amazingkenneth/following{/other_user}", "gists_url": "https://api.github.com/users/Amazingkenneth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amazingkenneth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amazingkenneth/subscriptions", "organizations_url": "https://api.github.com/users/Amazingkenneth/orgs", "repos_url": "https://api.github.com/users/Amazingkenneth/repos", "events_url": "https://api.github.com/users/Amazingkenneth/events{/privacy}", "received_events_url": "https://api.github.com/users/Amazingkenneth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2023-01-19T02:15:53Z", "updated_at": "2023-01-19T05:56:51Z", "closed_at": "2023-01-19T05:56:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\nI tried this code:\r\n\r\n```rust\r\nuse iced::widget::{container, text};\r\nuse iced::{Application, Command};\r\nuse rodio::source::SineWave;\r\nuse rodio::Sink;\r\nuse rodio::Source;\r\nuse std::mem::ManuallyDrop;\r\nuse std::sync::{Arc, Mutex};\r\nuse std::time::Duration;\r\n\r\npub fn main() -> iced::Result {\r\n    State::run(iced::Settings::default())\r\n}\r\n\r\n#[derive(Debug)]\r\nenum State {\r\n    Loading,\r\n    Loaded,\r\n}\r\n\r\n#[derive(Debug)]\r\nenum Message {\r\n    Loaded(State),\r\n}\r\n\r\nimpl Application for State {\r\n    type Executor = iced::executor::Default;\r\n    type Message = Message;\r\n    type Theme = iced::Theme;\r\n    type Flags = ();\r\n\r\n    fn new(_flags: ()) -> (State, Command<Message>) {\r\n        (\r\n            State::Loading,\r\n            Command::perform(initialize(), Message::Loaded),\r\n        )\r\n    }\r\n    fn title(&self) -> String {\r\n        String::from(\"Rodio - Iced\")\r\n    }\r\n\r\n    fn update(&mut self, _message: Message) -> Command<Message> {\r\n        Command::none()\r\n    }\r\n\r\n    fn view(&self) -> iced::Element<Message> {\r\n        container(text(\"Represent the bug.\")).into()\r\n    }\r\n}\r\n\r\nasync fn initialize() -> State {\r\n    let (_stream, stream_handle) = rodio::OutputStream::try_default().unwrap();\r\n    let sink = ManuallyDrop::new(Sink::try_new(&stream_handle).unwrap());\r\n    let sink_mutex = Arc::new(Mutex::new(sink));\r\n    std::thread::spawn(move || {\r\n        play_music(sink_mutex);\r\n    });\r\n    State::Loaded\r\n}\r\n\r\nfn play_music(sink_mutex: Arc<Mutex<ManuallyDrop<rodio::Sink>>>) {\r\n    println!(\"Here on play_music()\");\r\n    let source = SineWave::new(440.0)\r\n        .take_duration(Duration::from_secs_f32(10.0))\r\n        .amplify(0.20);\r\n    let sink = sink_mutex.lock().unwrap();\r\n    sink.append(source);\r\n}\r\n```\r\n\r\nI expected to see this happen: \r\nSound is produced when the Iced GUI window opens.\r\n\r\nInstead, this happened:\r\nNo sound was produced. I suspect this may be a problem with thread because when you move the code from `play_music()` into the `initialize()` function the window pops out after the music stops.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.66.0 (69f9c33d7 2022-12-12)\r\nbinary: rustc\r\ncommit-hash: 69f9c33d71c871fc16ac445211281c6e7a340943\r\ncommit-date: 2022-12-12\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.66.0\r\nLLVM version: 15.0.2\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```powershell\r\nPS C:\\Users\\amazi\\represent> $env:RUST_BACKTRACE=1 ; cargo run\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.18s\r\n     Running `target\\debug\\counter.exe`\r\nHere on play_music()\r\nPS C:\\Users\\amazi\\represent> # I then closed the window manually.\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "Amazingkenneth", "id": 81886982, "node_id": "MDQ6VXNlcjgxODg2OTgy", "avatar_url": "https://avatars.githubusercontent.com/u/81886982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amazingkenneth", "html_url": "https://github.com/Amazingkenneth", "followers_url": "https://api.github.com/users/Amazingkenneth/followers", "following_url": "https://api.github.com/users/Amazingkenneth/following{/other_user}", "gists_url": "https://api.github.com/users/Amazingkenneth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amazingkenneth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amazingkenneth/subscriptions", "organizations_url": "https://api.github.com/users/Amazingkenneth/orgs", "repos_url": "https://api.github.com/users/Amazingkenneth/repos", "events_url": "https://api.github.com/users/Amazingkenneth/events{/privacy}", "received_events_url": "https://api.github.com/users/Amazingkenneth/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107057/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107057/timeline", "performed_via_github_app": null, "state_reason": "completed"}