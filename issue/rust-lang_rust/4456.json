{"url": "https://api.github.com/repos/rust-lang/rust/issues/4456", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4456/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4456/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4456/events", "html_url": "https://github.com/rust-lang/rust/issues/4456", "id": 9909327, "node_id": "MDU6SXNzdWU5OTA5MzI3", "number": 4456, "title": "Destructor call order", "user": {"login": "AngryLawyer", "id": 1378607, "node_id": "MDQ6VXNlcjEzNzg2MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1378607?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AngryLawyer", "html_url": "https://github.com/AngryLawyer", "followers_url": "https://api.github.com/users/AngryLawyer/followers", "following_url": "https://api.github.com/users/AngryLawyer/following{/other_user}", "gists_url": "https://api.github.com/users/AngryLawyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/AngryLawyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AngryLawyer/subscriptions", "organizations_url": "https://api.github.com/users/AngryLawyer/orgs", "repos_url": "https://api.github.com/users/AngryLawyer/repos", "events_url": "https://api.github.com/users/AngryLawyer/events{/privacy}", "received_events_url": "https://api.github.com/users/AngryLawyer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 43009118, "node_id": "MDU6TGFiZWw0MzAwOTExOA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-destructors", "name": "A-destructors", "color": "f7e101", "default": false, "description": "Area: destructors (Drop, ..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/10", "html_url": "https://github.com/rust-lang/rust/milestone/10", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/10/labels", "id": 234060, "node_id": "MDk6TWlsZXN0b25lMjM0MDYw", "number": 10, "title": "0.7", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 110, "state": "closed", "created_at": "2012-12-22T22:31:59Z", "updated_at": "2013-07-04T01:21:16Z", "due_on": "2013-06-30T07:00:00Z", "closed_at": "2013-07-04T01:21:16Z"}, "comments": 4, "created_at": "2013-01-12T11:23:47Z", "updated_at": "2013-01-18T07:41:16Z", "closed_at": "2013-01-18T03:35:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "``` rust\nstruct Outer {\n    inner: Inner\n}\n\nimpl Outer : Drop {\n    fn finalize(&self) {\n        io::println(\"Outer has been dropped\");\n    }\n}\n\nstruct Inner {\n    dummy: bool\n}\n\nimpl Inner : Drop {\n    fn finalize(&self) {\n        io::println(\"Inner has been dropped\");\n    }\n}\n\nfn main() {\n    let outer = Outer{\n        inner: Inner{\n            dummy: true\n        }\n    };\n```\n\nI'd have expected the output to be as so\n\n```\nInner has been dropped\nOuter has been dropped\n```\n\nBut we get\n\n```\nOuter has been dropped\nInner has been dropped\n```\n\nIs this correct? There are cases when you're interfacing with external libs where stuff needs to be created in one order, and then destroyed in reverse, such as with SDL creating and releasing a surface should only happen in between Init and Exit commands. The way it currently stands means the outermost object gets its destructor called first, which means bad things happen.\n\nAm I missing the correct way to do this?\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4456/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4456/timeline", "performed_via_github_app": null, "state_reason": "completed"}