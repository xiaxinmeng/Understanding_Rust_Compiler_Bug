{"url": "https://api.github.com/repos/rust-lang/rust/issues/65490", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65490/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65490/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65490/events", "html_url": "https://github.com/rust-lang/rust/issues/65490", "id": 508326028, "node_id": "MDU6SXNzdWU1MDgzMjYwMjg=", "number": 65490, "title": "Tracking issue for bindings in sub-patterns after `@`s (`feature(bindings_after_at)`)", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 246778137, "node_id": "MDU6TGFiZWwyNDY3NzgxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/B-unstable", "name": "B-unstable", "color": "d304cb", "default": false, "description": "Implemented in the nightly compiler and unstable."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 1626322873, "node_id": "MDU6TGFiZWwxNjI2MzIyODcz", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-bindings_after_at", "name": "F-bindings_after_at", "color": "f9c0cc", "default": false, "description": "`#![feature(bindings_after_at)]`"}, {"id": 1976249039, "node_id": "MDU6TGFiZWwxOTc2MjQ5MDM5", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-patterns", "name": "A-patterns", "color": "f7e101", "default": false, "description": "Relating to patterns and pattern matching"}], "state": "closed", "locked": false, "assignee": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2019-10-17T08:44:11Z", "updated_at": "2021-08-05T12:49:30Z", "closed_at": "2021-08-05T12:49:30Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This is the tracking issue for `#![feature(bindings_after_at)]`, which allows patterns of form `binding @ pat` to have bindings in `pat`, for example `ref x @ Some(y)`.\r\n\r\n## Implementation history\r\n\r\n- On 2019-12-24, https://github.com/rust-lang/rust/pull/66296, containing the initial implementation, landed. The PR was written by @Centril and reviewed by @pnkfelix and @matthewjasper.\r\n\r\n- On 2020-02-10, https://github.com/rust-lang/rust/pull/68992 landed. The PR was written by @matthewjasper and reviewed by @Centril. The PR fixed a parser recovery bug wherein `mut x @ y` would make `y` a mutable binding, manifesting as issues https://github.com/rust-lang/rust/issues/67861 and https://github.com/rust-lang/rust/issues/67926.\r\n\r\n- On 2020-02-19, https://github.com/rust-lang/rust/pull/69236 landed. The PR was written by @Centril and reviewed by @estebank. The PR adjusted the parser changes in https://github.com/rust-lang/rust/pull/68992 to retain good error messages on e.g. `mut (x @ y)` patterns, suggesting `mut x @ mut y` as opposed to `mut x @ y`.\r\n\r\n- On 2020-03-08, https://github.com/rust-lang/rust/pull/69690 landed. The PR was written by @thekuom and reviewed by @Centril and added run-pass tests for the combination of bindings-after-at, or-patterns, box-patterns, slice-patterns.\r\n\r\n- On 2020-03-08, https://github.com/rust-lang/rust/pull/69810 landed. The PR was written by @thekuom and reviewed by @Centril and added dynamic-rop run-pass tests for bindings-after-at.\r\n\r\n- On 2020-03-10, https://github.com/rust-lang/rust/pull/69817, written by @thekuom and reviewed by @Centril, landed. The PR added borrow checker tests in combination with or-patterns & other pattern features.\r\n\r\n- On 2020-03-26, https://github.com/rust-lang/rust/pull/70389, written by @Centril and reviewed by @mark-i-m, landed. The PR fixed some bugs in diagnostics where we would end up using `_` as the name of the place when matching on a temporary. Now it says *\"value\"* in the diagnostic instead.\r\n\r\n## Old description\r\n\r\nPre-1.0 Rust used to support writing code like: \r\n\r\n```rust\r\nmatch x {\r\n    y @ z => { ... }\r\n}\r\n\r\nmatch a {\r\n    b @ Some(c) => { ... }\r\n}\r\n```\r\n\r\nPR #16053 disabled the ability to write such code. More precisely, it disabled the ability to introduce *any* kind of binding in subpattern `P` in the context of any binding-pattern `ident @ P`\r\n\r\nThe reason we did this was because it was too hard to handle them soundly in the AST-borrowck.\r\n\r\nHowever, now that we have migrated 100% to NLL and thus MIR-borrowck, we should be able to soundly re-enable this feature, without too much effort (I hope).\r\n * Back when the feature was removed, we made an [explicit note](https://github.com/rust-lang/rust/pull/16053#issuecomment-50881116) that the long term intention was to reenable it. \r\n * And this *is* a useful coding pattern at times. (The whole reason I went looking for this issue, and then decided to file it after discovering it did not seem to exist, was because I wanted to write code that required this feature, namely a pattern like: `ty::Ref(_, adt_ty @ ty::TyS { kind: ty::Adt(adt_def, _), .. }, _)`)\r\n\r\nNote that any attempt to re-enable the feature should do a careful survey of the various cases that can arise (copying, moving, mixing ref and non-ref, match ergonomics, ...)\r\n\r\nAlso, any attempt to re-enable the feature should also attempt to re-add all the tests that were removed with PR #16053", "closed_by": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65490/reactions", "total_count": 45, "+1": 45, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65490/timeline", "performed_via_github_app": null, "state_reason": "completed"}