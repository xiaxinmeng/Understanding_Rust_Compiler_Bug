{"url": "https://api.github.com/repos/rust-lang/rust/issues/38531", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38531/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38531/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38531/events", "html_url": "https://github.com/rust-lang/rust/issues/38531", "id": 197084300, "node_id": "MDU6SXNzdWUxOTcwODQzMDA=", "number": 38531, "title": "Enable building complete release artifacts on Travis / Appveyor", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2016-12-22T03:02:19Z", "updated_at": "2017-04-18T12:40:36Z", "closed_at": "2017-04-18T12:40:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## Updated description\r\n\r\nActive work items:\r\n\r\n* [x] Turn on Travis/AppVeyor nightlies - update secrets.toml\r\n* [x] Turn off Buildbot nightlies - comment out trigger in rust-buildbot\r\n* [x] Separate `--enable-extended` from `x.py test` builds on all platforms (only Windows remaining)\r\n* [x] Pull in Cargo as a submodule instead of from a pre-built location\r\n* [x] Run cargo's test suite on select bots.\r\n* [ ] Turn off Cargo uploads\r\n\r\n## Original description\r\n\r\nConverting our travis/appveyor CI to do full release builds. By doing release builds on every platform on every commit we should stop breaking nightlies so much.\r\n\r\n- [x] switch homu to travis/appveyor, leaving buildbot in place (https://github.com/rust-lang/rust/pull/38536#issuecomment-269211683)\r\n- [x] modify rustbuild to build stage1 by default, with option for stage2 (#38631)\r\n- [x] add stage2 bootstrap bot to verify the full bootstrap works (#38631)\r\n- [x] add sccache to bots (#38359)\r\n- [x] add remaining cross-host rustc/platform builders (#39042)\r\n- [x] add distcheck bot (#38708)\r\n- [x] have rustbuild produce .sha256 files on all dist output (#38748)\r\n- [x] modify all builds to 'make dist' and upload (#38748)\r\n- [x] confirm all matrix entries are correct\r\n\r\n## More steps\r\n\r\n- [x] Figure out rls submodule maintenance model\r\n  - in-tree vs. out-of-tree and how\r\n- [x] Move rls into rust-lang-nursery (tools team)\r\n- [ ] Add rls submodule/source to src/\r\n- [x] Add a `--enable-extended` / `--enable-platform` flag (#39245)\r\n  - teach bootstrap to only build, test and dist the rls when this flag is set\r\n  - think about the name of this flag because it's important\r\n- [x] Add `--enable-extended` to the Trivas/AppVeyor release builders (#39245)\r\n  - this will start uploading rls packages to rust-lang-ci\r\n- [x] Modify rust-buildbot to pass `--enable-extended` to host dist builds (#39245)\r\n  - Starts building and uploading the RLS\r\n\r\nAt this point we've got rls sufficiently packaged that we can flip the\r\nswitch. Next steps are to flip that switch.\r\n\r\n- [ ] Make and deploy patch to rust-buildbot to add rls to manifests as optional\r\n- [ ] Make a new nightly to test RLS deployment\r\n- [ ] Add rls to the combined installer via rust-packaging\r\n  - tarballs, .pkgs, .msis\r\n  - so that non-rustup users can access\r\n\r\nWe'd want to do all the above before the March 16 branch for 1.17 beta.\r\n\r\nAt this point we're delivering the RLS via the buildbot release\r\nbuilders. Next steps are to follow through on the release builder\r\nconversion.\r\n\r\n- [x] Add `--enable-dist-msi` and `--enable-dist-pkg` flags to configure (#39245)\r\n  - move those packaging steps from rust-packaging into the tree as\r\n    part of `make dist`\r\n  - remember that the rls is not included when `--enable-extended` is\r\n    not enabled... hm\r\n- [x] Again in-tree, create a new build target, `x.py dist\r\n  src/publish-ci-build` (or something) to do the final steps of\r\n  arranging the bins, signing, building the manifest, and uploading to\r\n  static.rust-lang.org (#39284)\r\n  - This is in-tree because it gives us a path for others being able\r\n    to produce their own rustup dist servers, and also because it's just\r\n    better to have all the code for packaging in the same git commit.\r\n  - Being in-tree has the complication that we have to run `./configure`\r\n    even though we don't need to build any Rust...\r\n  - All the steps need to (eventually) be discrete so that people\r\n    who want to build manifests without our CI infrastructure can do so,\r\n    but for our purposes we can have one `x.py dist publish-ci-build`\r\n  - 'publish-download' step:\r\n    - for any given channel, download the appropriate bins from rust-lang-ci\r\n      s3 bucket, put them in the right file system layout\r\n    - this might want to verify hashes\r\n  - 'publish-hash' step:\r\n  - 'publish-signing' step:\r\n  - 'publish-manifest-build' step:\r\n  - 'publish-upload' step:\r\n- [x] Build a docker container that runs a the above as a service\r\n  - publish to some staging area for testing before we turn it on in prod\r\n  - batch job every night\r\n  - cron job in a docker container?\r\n- [x] Set up aws machine to run that service\r\n  - let it run in parallel to existing build service\r\n  - test with RUSTUP_DIST_SERVER\r\n- [x] port cargo build to the rust extended build system\r\n  - simultaneously turn off cargo's existing publication\r\n- [x] modify docker images to use correct old glibcs (#39198)\r\n  - keep using crosstool ng\r\n- [x] disable llvm assertions for all DEPLOY travisveyor configs (#39198)\r\n- [x] switch over to the new release builds, turn off buildbot\r\n\r\n## Other misc\r\n\r\n* [x] Uploads can overwrite one another, probably messing up checksums (#39167)\r\n* [x] Need to change release channel of artifacts to nightly (#39050)\r\n* [x] Need to compile against libstdc++ statically (#39132)\r\n* [x] Need to update all gcc toolchains to very old glibc (#39198)\r\n* [x] Shouldn't pass `--enable-llvm-assertions` all the time, especially for stable/beta releases (#39198)\r\n* [x] need a story for stable/beta releases", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38531/reactions", "total_count": 10, "+1": 4, "-1": 0, "laugh": 0, "hooray": 6, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38531/timeline", "performed_via_github_app": null, "state_reason": "completed"}