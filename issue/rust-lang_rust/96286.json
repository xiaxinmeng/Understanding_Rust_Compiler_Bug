{"url": "https://api.github.com/repos/rust-lang/rust/issues/96286", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96286/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96286/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96286/events", "html_url": "https://github.com/rust-lang/rust/issues/96286", "id": 1211076052, "node_id": "I_kwDOAAsO6M5IL43U", "number": 96286, "title": "Unexpected occasional compilation error unnecessarily complaining about use after move", "user": {"login": "frol", "id": 304265, "node_id": "MDQ6VXNlcjMwNDI2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/304265?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frol", "html_url": "https://github.com/frol", "followers_url": "https://api.github.com/users/frol/followers", "following_url": "https://api.github.com/users/frol/following{/other_user}", "gists_url": "https://api.github.com/users/frol/gists{/gist_id}", "starred_url": "https://api.github.com/users/frol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frol/subscriptions", "organizations_url": "https://api.github.com/users/frol/orgs", "repos_url": "https://api.github.com/users/frol/repos", "events_url": "https://api.github.com/users/frol/events{/privacy}", "received_events_url": "https://api.github.com/users/frol/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-21T13:48:59Z", "updated_at": "2022-04-21T16:15:57Z", "closed_at": "2022-04-21T16:15:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have a super odd error that I cannot minimize at all, but it has 100% reproducible compilation error.\r\n\r\n<img width=\"1140\" alt=\"image\" src=\"https://user-images.githubusercontent.com/304265/164469371-a0a421d2-fa81-4fa1-b622-d1871ae7b295.png\">\r\n\r\nThe code in question does not need to copy the values since the values are instantiated once and moved to the `paint` function:\r\n\r\nhttps://github.com/near/nearcore/blob/c7eaf26ba3e934a1ee76af2d2ac4266fa276d28c/chain/client/src/info.rs#L107-L165\r\n\r\nThe odd thing is that when you compile the crate that causes the problem ([nearcore](https://github.com/near/nearcore/tree/c7eaf26ba3e934a1ee76af2d2ac4266fa276d28c)), it compiles just fine. Yet, when you compile a project that depends on nearcore, it fails: https://github.com/near/near-lake/tree/refactor/v0.1.2-broken (this is a reproduction branch, simple `cargo check` is enough to observe the issue).\r\n\r\nWhat is even more confusing is that other projects that depend on the same nearcore crates, compiled successfully just fine!\r\n\r\nHere is the hotfix we had to add to nearcore in order to circumvent the buggy behaviour: https://github.com/near/nearcore/commit/e127d2d9cf436ad4cf8e71ad7ce2419eafbecbdf, those clones are completely unnecessary there, but they fixed the ship (https://github.com/near/near-lake/pull/35/commits/456325f3c903599ac62782773ec38bb94dbb4f68).\r\n\r\nMy expectation is that https://github.com/near/near-lake/tree/refactor/v0.1.2-broken should be compilable just fine.\r\n\r\n### Meta\r\n\r\nWe checked this behavior on 4 different machines using stable (1.60), beta (1.61), and nightly (879aff385 2022-04-20) compilers. All the caches were cleaned.", "closed_by": {"login": "frol", "id": 304265, "node_id": "MDQ6VXNlcjMwNDI2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/304265?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frol", "html_url": "https://github.com/frol", "followers_url": "https://api.github.com/users/frol/followers", "following_url": "https://api.github.com/users/frol/following{/other_user}", "gists_url": "https://api.github.com/users/frol/gists{/gist_id}", "starred_url": "https://api.github.com/users/frol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frol/subscriptions", "organizations_url": "https://api.github.com/users/frol/orgs", "repos_url": "https://api.github.com/users/frol/repos", "events_url": "https://api.github.com/users/frol/events{/privacy}", "received_events_url": "https://api.github.com/users/frol/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96286/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96286/timeline", "performed_via_github_app": null, "state_reason": "completed"}