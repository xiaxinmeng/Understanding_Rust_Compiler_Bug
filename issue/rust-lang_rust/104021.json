{"url": "https://api.github.com/repos/rust-lang/rust/issues/104021", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104021/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104021/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104021/events", "html_url": "https://github.com/rust-lang/rust/issues/104021", "id": 1437161609, "node_id": "I_kwDOAAsO6M5VqViJ", "number": 104021, "title": "`rustc` crash trying to compile `p384` for Wasi on ppc64le", "user": {"login": "rjzak", "id": 1133882, "node_id": "MDQ6VXNlcjExMzM4ODI=", "avatar_url": "https://avatars.githubusercontent.com/u/1133882?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rjzak", "html_url": "https://github.com/rjzak", "followers_url": "https://api.github.com/users/rjzak/followers", "following_url": "https://api.github.com/users/rjzak/following{/other_user}", "gists_url": "https://api.github.com/users/rjzak/gists{/gist_id}", "starred_url": "https://api.github.com/users/rjzak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rjzak/subscriptions", "organizations_url": "https://api.github.com/users/rjzak/orgs", "repos_url": "https://api.github.com/users/rjzak/repos", "events_url": "https://api.github.com/users/rjzak/events{/privacy}", "received_events_url": "https://api.github.com/users/rjzak/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-11-05T19:32:44Z", "updated_at": "2022-11-05T19:34:49Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this code:\r\n* Compiling a project (https://github.com/profianinc/steward/), which uses the `p384` crate for `wasm32-wasi` on `powerpc64le-unknown-linux-gnu`.\r\n\r\nI expected to see this happen:\r\n* Compiling for `powerpc64le-unknown-linux-gnu` works fine.\r\n* Compiling for `x86_64-unknown-linux-gnu` and `wasm32-wasi` from `x86_64-unknown-linux-gnu` also works fine.\r\n* This code compiles fine in a PR, all unit tests pass for `x86_64-unknown-linux-gnu`, `x86_64-unknown-linux-musl`, and `wasm32-wasi` from Github's Ubuntu CI runner. https://github.com/profianinc/steward/pull/92\r\n\r\nInstead, this happened: `(signal: 11, SIGSEGV: invalid memory reference)`\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0 (897e37553 2022-11-02)\r\nbinary: rustc\r\ncommit-hash: 897e37553bba8b42751c67658967889d11ecd120\r\ncommit-date: 2022-11-02\r\nhost: powerpc64le-unknown-linux-gnu\r\nrelease: 1.65.0\r\nLLVM version: 15.0.0\r\n```\r\nI also tried nightly:\r\n```\r\nrustc 1.67.0-nightly (09508489e 2022-11-04)\r\nbinary: rustc\r\ncommit-hash: 09508489efc223287731fe8abbd2a81bbf7adf8e\r\ncommit-date: 2022-11-04\r\nhost: powerpc64le-unknown-linux-gnu\r\nrelease: 1.67.0-nightly\r\nLLVM version: 15.0.4\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\ncargo build --target=wasm32-wasi\r\n   Compiling version_check v0.9.4\r\n   Compiling proc-macro2 v1.0.47\r\n   Compiling unicode-ident v1.0.5\r\n   Compiling quote v1.0.21\r\n   Compiling typenum v1.15.0\r\n   Compiling const-oid v0.9.0\r\n   Compiling cfg-if v1.0.0\r\n   Compiling syn v1.0.102\r\n   Compiling wasi v0.11.0+wasi-snapshot-preview1\r\n   Compiling subtle v2.4.1\r\n   Compiling zeroize v1.5.7\r\n   Compiling base64ct v1.5.3\r\n   Compiling autocfg v1.1.0\r\n   Compiling flagset v0.4.3\r\n   Compiling libm v0.2.5\r\n   Compiling base16ct v0.1.1\r\n   Compiling ppv-lite86 v0.2.16\r\n   Compiling num-bigint-dig v0.8.1\r\n   Compiling spin v0.5.2\r\n   Compiling anyhow v1.0.66\r\n   Compiling smallvec v1.10.0\r\n   Compiling byteorder v1.4.3\r\n   Compiling base64 v0.13.1\r\n   Compiling lazy_static v1.4.0\r\n   Compiling getrandom v0.2.7\r\n   Compiling pem-rfc7468 v0.6.0\r\n   Compiling rustls-pemfile v1.0.1\r\n   Compiling generic-array v0.14.6\r\n   Compiling proc-macro-error-attr v1.0.4\r\n   Compiling proc-macro-error v1.0.4\r\n   Compiling rand_core v0.6.4\r\n   Compiling num-traits v0.2.15\r\n   Compiling num-integer v0.1.45\r\n   Compiling num-iter v0.1.43\r\n   Compiling ff v0.12.0\r\n   Compiling rand_chacha v0.3.1\r\n   Compiling group v0.12.1\r\n   Compiling rand v0.8.5\r\n   Compiling block-buffer v0.10.3\r\n   Compiling crypto-common v0.1.6\r\n   Compiling crypto-bigint v0.4.9\r\n   Compiling digest v0.10.5\r\n   Compiling hmac v0.12.1\r\n   Compiling signature v1.6.4\r\n   Compiling sha2 v0.10.6\r\n   Compiling rfc6979 v0.3.0\r\n   Compiling der_derive v0.6.0\r\n   Compiling der v0.6.0\r\n   Compiling spki v0.6.0\r\n   Compiling pkcs8 v0.9.0\r\n   Compiling x509-cert v0.1.0\r\n   Compiling sec1 v0.3.0\r\n   Compiling pkcs1 v0.4.1\r\n   Compiling rsa v0.7.1\r\n   Compiling elliptic-curve v0.12.3\r\n   Compiling ecdsa v0.14.8\r\n   Compiling p384 v0.11.2\r\n   Compiling p256 v0.11.1\r\n   Compiling cryptography v0.2.0 (/home/rjzak/CLionProjects/Profian/steward/crates/cryptography)\r\n/home/rjzak/.rustup/toolchains/nightly-powerpc64le-unknown-linux-gnu/bin/../lib/librustc_driver-a16a56f1ee9bc30d.so(+0xd1da4c)[0x3f5f2831da4c]\r\nlinux-vdso64.so.1(__kernel_sigtramp_rt64+0x0)[0x3f5f31e32444]\r\n/home/rjzak/.rustup/toolchains/nightly-powerpc64le-unknown-linux-gnu/bin/../lib/librustc_driver-a16a56f1ee9bc30d.so(+0x43d9eb0)[0x3f5f2b9d9eb0]\r\n--prior line repeated maybe 100 times--\r\n/home/rjzak/.rustup/toolchains/nightly-powerpc64le-unknown-linux-gnu/bin/../lib/librustc_driver-a16a56f1ee9bc30d.so(+0x43e39f0)[0x3f5f2b9e39f0]\r\nerror: could not compile `cryptography`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name cryptography --edition=2021 crates/cryptography/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 -C metadata=6488b55d5ee2565a -C extra-filename=-6488b55d5ee2565a --out-dir /home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps --target wasm32-wasi -C incremental=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/incremental -L dependency=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps -L dependency=/home/rjzak/CLionProjects/Profian/steward/target/debug/deps --extern anyhow=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libanyhow-1ba77a1f5c8dcfc8.rmeta --extern const_oid=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libconst_oid-b0de089666901db1.rmeta --extern der=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libder-270eb04288fc3862.rmeta --extern p256=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libp256-bd3b55e4430baa37.rmeta --extern p384=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libp384-867a0ed9c2a8f084.rmeta --extern rand=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/librand-2cff48b4013c83b5.rmeta --extern rsa=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/librsa-8725bf5d5b0de6bd.rmeta --extern rustls_pemfile=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/librustls_pemfile-ef9956d1b0020325.rmeta --extern sec1=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libsec1-f5887e063c6bdaba.rmeta --extern sha2=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libsha2-43a9895c64d32782.rmeta --extern signature=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libsignature-43977adb265e87d7.rmeta --extern spki=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libspki-a7058dda7ec5239b.rmeta --extern x509=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libx509_cert-9b66f6c9bc134ce0.rmeta --extern zeroize=/home/rjzak/CLionProjects/Profian/steward/target/wasm32-wasi/debug/deps/libzeroize-2a8947187ca03ce5.rmeta --cfg tokio_unstable` (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n</p>\r\n</details>\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104021/timeline", "performed_via_github_app": null, "state_reason": null}