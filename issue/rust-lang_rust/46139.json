{"url": "https://api.github.com/repos/rust-lang/rust/issues/46139", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46139/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46139/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46139/events", "html_url": "https://github.com/rust-lang/rust/issues/46139", "id": 275529099, "node_id": "MDU6SXNzdWUyNzU1MjkwOTk=", "number": 46139, "title": "vtable addresses differ based on the number of codegen units", "user": {"login": "PeterHatch", "id": 3161425, "node_id": "MDQ6VXNlcjMxNjE0MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161425?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PeterHatch", "html_url": "https://github.com/PeterHatch", "followers_url": "https://api.github.com/users/PeterHatch/followers", "following_url": "https://api.github.com/users/PeterHatch/following{/other_user}", "gists_url": "https://api.github.com/users/PeterHatch/gists{/gist_id}", "starred_url": "https://api.github.com/users/PeterHatch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PeterHatch/subscriptions", "organizations_url": "https://api.github.com/users/PeterHatch/orgs", "repos_url": "https://api.github.com/users/PeterHatch/repos", "events_url": "https://api.github.com/users/PeterHatch/events{/privacy}", "received_events_url": "https://api.github.com/users/PeterHatch/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 29, "created_at": "2017-11-20T23:03:03Z", "updated_at": "2022-10-30T13:57:18Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I'm seeing the ptr::eq function from the standard library sometimes return false when it should return true.  This is happening in debug mode in nightly and beta, but not stable, and not in any version in release mode.\r\n\r\nHere's the simplest I could get a reproduction of the issue:\r\n\r\n    use std::ptr;\r\n    use container::Container;\r\n\r\n    trait Trait {}\r\n    struct Struct {}\r\n    impl Trait for Struct {}\r\n\r\n    mod container {\r\n        use Trait;\r\n\r\n        pub(crate) struct Container<'a> {\r\n            pub(crate) item: &'a Trait,\r\n        }\r\n    }\r\n\r\n    impl<'a> Container<'a> {\r\n        fn new(item: &'a Struct) -> Container<'a> {\r\n            Container { item }\r\n        }\r\n    }\r\n\r\n    fn main() {\r\n        let item = Struct {};\r\n        let container = Container::new(&item);\r\n\r\n        assert!(ptr::eq(container.item, &item));\r\n    }\r\n\r\nExpected the assertion to pass, and it fails on beta and nightly, in debug mode only.\r\n\r\n## Meta\r\n`rustc +beta --version --verbose`:\r\nrustc 1.22.0-beta.3 (cc6ed0640 2017-11-13)\r\nbinary: rustc\r\ncommit-hash: cc6ed0640fbcd2dff95b4532fd12aa0d6c545f28\r\ncommit-date: 2017-11-13\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.22.0-beta.3\r\nLLVM version: 4.0\r\n\r\n`rustc +nightly --version --verbose`:\r\nrustc 1.23.0-nightly (5041b3bb3 2017-11-19)\r\nbinary: rustc\r\ncommit-hash: 5041b3bb3d953a14f32b15d1e41341c629acae12\r\ncommit-date: 2017-11-19\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.23.0-nightly\r\nLLVM version: 4.0", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46139/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46139/timeline", "performed_via_github_app": null, "state_reason": null}