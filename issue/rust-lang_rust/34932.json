{"url": "https://api.github.com/repos/rust-lang/rust/issues/34932", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34932/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34932/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34932/events", "html_url": "https://github.com/rust-lang/rust/issues/34932", "id": 166506465, "node_id": "MDU6SXNzdWUxNjY1MDY0NjU=", "number": 34932, "title": "In 1.11 beta, `#![cfg]` does not mask `#![feature]`", "user": {"login": "DanielKeep", "id": 77238, "node_id": "MDQ6VXNlcjc3MjM4", "avatar_url": "https://avatars.githubusercontent.com/u/77238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DanielKeep", "html_url": "https://github.com/DanielKeep", "followers_url": "https://api.github.com/users/DanielKeep/followers", "following_url": "https://api.github.com/users/DanielKeep/following{/other_user}", "gists_url": "https://api.github.com/users/DanielKeep/gists{/gist_id}", "starred_url": "https://api.github.com/users/DanielKeep/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DanielKeep/subscriptions", "organizations_url": "https://api.github.com/users/DanielKeep/orgs", "repos_url": "https://api.github.com/users/DanielKeep/repos", "events_url": "https://api.github.com/users/DanielKeep/events{/privacy}", "received_events_url": "https://api.github.com/users/DanielKeep/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-07-20T06:36:37Z", "updated_at": "2016-07-28T18:20:37Z", "closed_at": "2016-07-28T18:20:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It looks like `rustc` is checking `feature` attributes _before_ processing `cfg` attributes.  If so, this is a problem, because it looks like this makes it impossible to write code that optionally uses unstable features.\n\nIn the example below, the 1.10 compiler correctly ignores the test involving unstable features, but beta _does not._  In my specific case, this means my [CI testing on beta for `newtype_derive` is unavoidably failing](https://travis-ci.org/DanielKeep/rust-custom-derive/builds/146018015).\n\n1.12 nightly complaining about unused features is _probably_ the same issue.\n\n---\n\n`Cargo.toml`:\n\n``` toml\n[package]\nauthors = [\"Anonymous\"]\nname = \"example\"\nversion = \"0.1.0\"\n\n[[test]]\nname = \"dummy\"\npath = \"dummy.rs\"\n\n[features]\nenable-unstable = []\n```\n\n`lib.rs`:\n\n``` rust\n/* empty */\n```\n\n`dummy.rs`:\n\n``` rust\n#![cfg(feature=\"enable-unstable\")]\n#![feature(iter_arith_traits)]\n\n#[test]\nfn dummy() {}\n```\n\n---\n\n``` text\n> multirust run stable rustc -vV; multirust run beta rustc -vV; multirust run nightly rustc -vV\nrustc 1.10.0 (cfcb716cf 2016-07-03)\nbinary: rustc\ncommit-hash: cfcb716cf0961a7e3a4eceac828d94805cf8140b\ncommit-date: 2016-07-03\nhost: i686-pc-windows-gnu\nrelease: 1.10.0\nrustc 1.11.0-beta.1 (8dc253bcf 2016-07-05)\nbinary: rustc\ncommit-hash: 8dc253bcf3a565deb575108992b9f2e7d985aa17\ncommit-date: 2016-07-05\nhost: i686-pc-windows-gnu\nrelease: 1.11.0-beta.1\nrustc 1.12.0-nightly (7ad125c4e 2016-07-11)\nbinary: rustc\ncommit-hash: 7ad125c4eb3d620c12a868dbe77180f1a133021b\ncommit-date: 2016-07-11\nhost: i686-pc-windows-gnu\nrelease: 1.12.0-nightly\n> multirust run stable cargo test --no-default-features --features=\"\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\n     Running target\\debug\\dummy-ae1963bd31fb7672.exe\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured\n\n> multirust run stable cargo test --no-default-features --features=\"enable-unstable\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\ndummy.rs:2:1: 2:31 error: #[feature] may not be used on the stable release channel\ndummy.rs:2 #![feature(iter_arith_traits)]\n           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\nerror: Could not compile `example`.\n\nTo learn more, run the command again with --verbose.\n> multirust run beta cargo test --no-default-features --features=\"\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\ndummy.rs:2:1: 2:31 error: #[feature] may not be used on the beta release channel [E0554]\ndummy.rs:2 #![feature(iter_arith_traits)]\n           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\nerror: Could not compile `example`.\n\nTo learn more, run the command again with --verbose.\n> multirust run beta cargo test --no-default-features --features=\"enable-unstable\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\ndummy.rs:2:1: 2:31 error: #[feature] may not be used on the beta release channel [E0554]\ndummy.rs:2 #![feature(iter_arith_traits)]\n           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\nerror: Could not compile `example`.\n\nTo learn more, run the command again with --verbose.\n> multirust run nightly cargo test --no-default-features --features=\"\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\ndummy.rs:2:12: 2:29 warning: unused or unknown feature, #[warn(unused_features)] on by default\ndummy.rs:2 #![feature(iter_arith_traits)]\n                      ^~~~~~~~~~~~~~~~~\n     Running target\\debug\\dummy-ae1963bd31fb7672.exe\n\nrunning 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured\n\n> multirust run nightly cargo test --no-default-features --features=\"enable-unstable\"\n   Compiling example v0.1.0 (file:///F:/Programming/Rust/sandbox/issues/beta-cfg-feature)\ndummy.rs:2:12: 2:29 warning: unused or unknown feature, #[warn(unused_features)] on by default\ndummy.rs:2 #![feature(iter_arith_traits)]\n                      ^~~~~~~~~~~~~~~~~\n     Running target\\debug\\dummy-ae1963bd31fb7672.exe\n\nrunning 1 test\ntest dummy ... ok\n\ntest result: ok. 1 passed; 0 failed; 0 ignored; 0 measured\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34932/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34932/timeline", "performed_via_github_app": null, "state_reason": "completed"}