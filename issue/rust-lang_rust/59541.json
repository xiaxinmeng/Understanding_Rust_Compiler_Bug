{"url": "https://api.github.com/repos/rust-lang/rust/issues/59541", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59541/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59541/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59541/events", "html_url": "https://github.com/rust-lang/rust/issues/59541", "id": 427215199, "node_id": "MDU6SXNzdWU0MjcyMTUxOTk=", "number": 59541, "title": "x.py should indicate status code of failed commands", "user": {"login": "federicomenaquintero", "id": 7617, "node_id": "MDQ6VXNlcjc2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/7617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/federicomenaquintero", "html_url": "https://github.com/federicomenaquintero", "followers_url": "https://api.github.com/users/federicomenaquintero/followers", "following_url": "https://api.github.com/users/federicomenaquintero/following{/other_user}", "gists_url": "https://api.github.com/users/federicomenaquintero/gists{/gist_id}", "starred_url": "https://api.github.com/users/federicomenaquintero/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/federicomenaquintero/subscriptions", "organizations_url": "https://api.github.com/users/federicomenaquintero/orgs", "repos_url": "https://api.github.com/users/federicomenaquintero/repos", "events_url": "https://api.github.com/users/federicomenaquintero/events{/privacy}", "received_events_url": "https://api.github.com/users/federicomenaquintero/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-03-29T23:43:05Z", "updated_at": "2021-10-20T18:32:03Z", "closed_at": "2021-10-20T18:32:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "x.py's `run()` function just prints `failed to run: $command_name` when something fails, but it doesn't say why it failed, which makes debugging builds harder.\r\n\r\nAt Suse we just ran into the following.  In trying to bootstrap Rust 1.33, it turned out that the prebuilt compiler and cargo for 1.32 are probably broken for ppc64le.  Running `cargo` from the prebuilt binaries immediately causes it to die with `Illegal instruction`.  I have to do some digging to see what's going on there, but in the meantime, x.py only printed this:\r\n\r\n```\r\n[  123s] + ./x.py build -v\r\n[  124s] running: /home/abuild/rpmbuild/BUILD/rust-1.32.0-powerpc64le-unknown-linux-gnu/usr/bin/cargo build --manifest-path /home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/Cargo.toml --frozen\r\n[  124s] Traceback (most recent call last):\r\n[  124s]   File \"./x.py\", line 11, in <module>\r\n[  124s]     bootstrap.main()\r\n[  124s]   File \"/home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/bootstrap.py\", line 843, in main\r\n[  124s]     bootstrap(help_triggered)\r\n[  124s]   File \"/home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/bootstrap.py\", line 814, in bootstrap\r\n[  124s]     build.build_bootstrap()\r\n[  124s]   File \"/home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/bootstrap.py\", line 642, in build_bootstrap\r\n[  124s]     run(args, env=env, verbose=self.verbose)\r\n[  124s]   File \"/home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/bootstrap.py\", line 141, in run\r\n[  124s]     raise RuntimeError(err)\r\n[  124s] RuntimeError: failed to run: /home/abuild/rpmbuild/BUILD/rust-1.32.0-powerpc64le-unknown-linux-gnu/usr/bin/cargo build --manifest-path /home/abuild/rpmbuild/BUILD/rustc-1.33.0-src/src/bootstrap/Cargo.toml --frozen\r\n[  124s] error: Bad exit status from /var/tmp/rpm-tmp.jaylIJ (%build)\r\n[  124s] \r\n[  124s] \r\n[  124s] RPM build errors:\r\n[  124s]     Bad exit status from /var/tmp/rpm-tmp.jaylIJ (%build)\r\n```\r\n\r\nThis is not rpmbuild eating output or anything; running x.py by hand does the same thing.  I had to actually paste the `cargo` command line into a chroot inside the buildroot to be able to know that it had died due to an Illegal Instruction.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59541/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59541/timeline", "performed_via_github_app": null, "state_reason": "completed"}