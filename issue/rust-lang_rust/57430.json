{"url": "https://api.github.com/repos/rust-lang/rust/issues/57430", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57430/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57430/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57430/events", "html_url": "https://github.com/rust-lang/rust/issues/57430", "id": 396664895, "node_id": "MDU6SXNzdWUzOTY2NjQ4OTU=", "number": 57430, "title": "ICE in collect_and_partition_mono_items", "user": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-01-07T21:53:47Z", "updated_at": "2020-03-06T20:48:06Z", "closed_at": "2019-01-08T18:00:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I don't really know where to start minimizing this thing. The code is a nasty beast and not everything in the repository compiles right now (I'm currently struggling with HRTBs in there and such). Anyway:\r\n\r\n* Clone the https://github.com/vorner/spirit repository\r\n* Check out the commit 0ce253e4ec35a8accaf4924f17180cd0a9696e78\r\n* Run `cargo +nightly-2019-01-07 run --package spirit-reqwest --example make_request`\r\n* The following ICE falls out:\r\n\r\n```\r\nerror: internal compiler error: src/librustc_mir/monomorphize/collector.rs:747: Cannot create local mono-item for DefId(21/0:300 ~ config[6427]::file[0]::{{impl}}[0]::from_str[0])\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:590:9\r\nstack backtrace:\r\n   0:     0x7fd0230b01a3 - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h1492ea7cec121a33\r\n                               at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1:     0x7fd0230a8808 - std::sys_common::backtrace::_print::h28383da39102314d\r\n                               at src/libstd/sys_common/backtrace.rs:70\r\n   2:     0x7fd0230ac332 - std::panicking::default_hook::{{closure}}::h6958e24be6a075eb\r\n                               at src/libstd/sys_common/backtrace.rs:58\r\n                               at src/libstd/panicking.rs:200\r\n   3:     0x7fd0230ac0a4 - std::panicking::default_hook::h453a171789f64b19\r\n                               at src/libstd/panicking.rs:215\r\n   4:     0x7fd01f3114ff - rustc::util::common::panic_hook::hef4cee339a2b4fc5\r\n   5:     0x7fd0230acb19 - std::panicking::rust_panic_with_hook::hdef6b4d70bac6cdb\r\n                               at src/libstd/panicking.rs:482\r\n   6:     0x7fd01e17f4cc - std::panicking::begin_panic::hff504b5ae3f2aed9\r\n   7:     0x7fd01e19e38e - rustc_errors::Handler::bug::ha00d071a7722ac53\r\n   8:     0x7fd01f17e5de - rustc::util::bug::opt_span_bug_fmt::{{closure}}::hfd250b1fd98637e5\r\n   9:     0x7fd01f17d9c9 - rustc::ty::context::tls::with_opt::{{closure}}::h3796fb43b823cc58\r\n  10:     0x7fd01f17d8e4 - rustc::ty::context::tls::with_context_opt::h07df1bd288f39a1a\r\n  11:     0x7fd01f17d976 - rustc::ty::context::tls::with_opt::h4dd2a44bcfb8fb2b\r\n  12:     0x7fd01f17e4e4 - rustc::util::bug::opt_span_bug_fmt::hcb3688100a278b16\r\n  13:     0x7fd01f17e456 - rustc::util::bug::bug_fmt::h62900f94ae194a93\r\n  14:     0x7fd01ff28386 - rustc_mir::monomorphize::collector::should_monomorphize_locally::hb4972c21879246cd\r\n  15:     0x7fd01ff27ff4 - rustc_mir::monomorphize::collector::visit_instance_use::he2b609b042c96762\r\n  16:     0x7fd01ff27a78 - <rustc_mir::monomorphize::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_terminator_kind::h95660bab391f4e89\r\n  17:     0x7fd01ff24be6 - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  18:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  19:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  20:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  21:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  22:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  23:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  24:     0x7fd01ff2587f - rustc_mir::monomorphize::collector::collect_items_rec::h67da2bf4b1a5e7c4\r\n  25:     0x7fd01ff9f3ad - rustc_mir::monomorphize::collector::collect_crate_mono_items::{{closure}}::h2af1c87112323a03\r\n  26:     0x7fd01ff4c286 - rustc::util::common::time::h286b1dad20da2123\r\n  27:     0x7fd01ff23e0d - rustc_mir::monomorphize::collector::collect_crate_mono_items::h4e9b3a8e4f502e53\r\n  28:     0x7fd01ff4c3da - rustc::util::common::time::h3aed30c09566a540\r\n  29:     0x7fd01fcbb9e3 - rustc_mir::monomorphize::partitioning::collect_and_partition_mono_items::h67f94873bae784e8\r\n  30:     0x7fd0193e61b6 - rustc::ty::query::__query_compute::collect_and_partition_mono_items::h9f82d9bdf2152918\r\n  31:     0x7fd0193e6598 - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors<'tcx> for rustc::ty::query::queries::collect_and_partition_mono_items<'tcx>>::compute::hfe18cd95125d7663\r\n  32:     0x7fd01946b18e - rustc::dep_graph::graph::DepGraph::with_task_impl::h4e09c0812e8abf24\r\n  33:     0x7fd0193f2f38 - <rustc::ty::query::plumbing::JobOwner<'a, 'tcx, Q>>::start::hf6ee6068f239879a\r\n  34:     0x7fd01943cf15 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::force_query_with_job::h4d71449d6af3571d\r\n  35:     0x7fd01943358b - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::try_get_with::hec8615cd2811433c\r\n  36:     0x7fd0193d247d - rustc_codegen_ssa::base::codegen_crate::hf7f8c50778209cf8\r\n  37:     0x7fd01934f3f0 - <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_utils::codegen_backend::CodegenBackend>::codegen_crate::hcba196557f52fae6\r\n  38:     0x7fd023437bd0 - rustc_driver::driver::phase_4_codegen::hade065a8cf6f26a2\r\n  39:     0x7fd0234651d0 - rustc_driver::driver::compile_input::{{closure}}::hdd7466c093d6d3e7\r\n  40:     0x7fd02346312c - <std::thread::local::LocalKey<T>>::with::he31a810ca003f552\r\n  41:     0x7fd023403e0a - rustc::ty::context::TyCtxt::create_and_enter::h3a3af1489d7c446f\r\n  42:     0x7fd02342d4b6 - rustc_driver::driver::compile_input::h20eaf82f3f6aeec8\r\n  43:     0x7fd0233ad799 - rustc_driver::run_compiler_with_pool::hbe3be3b5f19e38c8\r\n  44:     0x7fd0233b8af5 - <scoped_tls::ScopedKey<T>>::set::h4aeac58e4b7eb0a1\r\n  45:     0x7fd0233ac60a - rustc_driver::run_compiler::hde99c109f350f677\r\n  46:     0x7fd0233b8caa - <scoped_tls::ScopedKey<T>>::set::hf1be8bd8767bcc8f\r\n  47:     0x7fd0233ea2a2 - syntax::with_globals::h2a92913243b46dbe\r\n  48:     0x7fd0230bddc9 - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:92\r\n  49:     0x7fd023494c40 - <F as alloc::boxed::FnBox<A>>::call_box::h4c895f5df8f64c8f\r\n  50:     0x7fd0230bcbbd - std::sys::unix::thread::Thread::new::thread_start::h967e067038c0ee09\r\n                               at /rustc/b92552d5578e4544006da0dd5e793a19c2149321/src/liballoc/boxed.rs:744\r\n                               at src/libstd/sys_common/thread.rs:14\r\n                               at src/libstd/sys/unix/thread.rs:81\r\n  51:     0x7fd022fc03c2 - <unknown>\r\n                               at /usr/src/debug/sys-libs/glibc-2.28-r4/glibc-2.28/nptl/pthread_create.c:486\r\n  52:     0x7fd022ed42de - clone\r\n                               at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n  53:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [collect_and_partition_mono_items] collect_and_partition_mono_items\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.33.0-nightly (b92552d55 2019-01-06) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `spirit-reqwest`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nIt runs fine with `rustc 1.33.0-nightly (9eac38634 2018-12-31)`, but fails with:\r\n\r\n```\r\n$ rustc +nightly-2019-01-07 --version --verbose\r\nrustc 1.33.0-nightly (b92552d55 2019-01-06)\r\nbinary: rustc\r\ncommit-hash: b92552d5578e4544006da0dd5e793a19c2149321\r\ncommit-date: 2019-01-06\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.33.0-nightly\r\nLLVM version: 8.0\r\n```", "closed_by": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57430/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57430/timeline", "performed_via_github_app": null, "state_reason": "completed"}