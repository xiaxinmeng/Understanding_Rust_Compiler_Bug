{"url": "https://api.github.com/repos/rust-lang/rust/issues/24957", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24957/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24957/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24957/events", "html_url": "https://github.com/rust-lang/rust/issues/24957", "id": 71984960, "node_id": "MDU6SXNzdWU3MTk4NDk2MA==", "number": 24957, "title": "unsized enums don't work", "user": {"login": "ericsink", "id": 3877005, "node_id": "MDQ6VXNlcjM4NzcwMDU=", "avatar_url": "https://avatars.githubusercontent.com/u/3877005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ericsink", "html_url": "https://github.com/ericsink", "followers_url": "https://api.github.com/users/ericsink/followers", "following_url": "https://api.github.com/users/ericsink/following{/other_user}", "gists_url": "https://api.github.com/users/ericsink/gists{/gist_id}", "starred_url": "https://api.github.com/users/ericsink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ericsink/subscriptions", "organizations_url": "https://api.github.com/users/ericsink/orgs", "repos_url": "https://api.github.com/users/ericsink/repos", "events_url": "https://api.github.com/users/ericsink/events{/privacy}", "received_events_url": "https://api.github.com/users/ericsink/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2015-04-29T20:42:26Z", "updated_at": "2015-10-24T18:56:53Z", "closed_at": "2015-10-24T18:56:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`rustc` is not checking that all types that are put into a sized-context are in fact sized.\n\nConsider for example:\n\n``` rust\npub enum BsonValue {\n    A([u8]),\n    B([BsonValue]),\n}\n\npub fn set_value(_v:&BsonValue)\n{\n}\n\nfn main()\n{\n}\n```\n\nThis yields an ICE:\n\n```\nthread 'rustc' panicked at 'Unexpected type returned from struct_tail: BsonValue for ty=BsonValue', /home/rustbuild/src/rust-buildbot/slave/beta-dist-rustc-linux/build/src/librustc_trans/trans/type_of.rs:366\n```\n## Original bug report follows\n\n```\nerics-air-2:Elmo eric$ rustc --version\nrustc 1.0.0-beta.3 (5241bf9c3 2015-04-25) (built 2015-04-25)\n```\n\nI'm on MacOS X Mavericks.\n\nHere's the source file that causes the problem (I'm a rust newbie):\n\n```\nenum BsonValue {\n    BDouble(f64),\n    BString(String),\n    BInt64(i64),\n    BInt32(i32),\n    BUndefined,\n    BObjectID([u8]),\n    BNull,\n    BRegex(String,String),\n    BJSCode(String),\n    BJSCodeWithScope(String),\n    BBinary(u8,[u8]),\n    BMinKey,\n    BMaxKey,\n    BDateTime(i64),\n    BTimeStamp(i64),\n    BBoolean(bool),\n    BArray([BsonValue]),\n    BDocument([(String,BsonValue)]),\n}\n\nfn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\n{\n}\n\nfn main()\n{\n}\n```\n\nAnd here's the output of the compiler:\n\n```\nerics-air-2:Elmo eric$ RUST_BACKTRACE=1 rustc b.rs\nb.rs:2:1: 21:2 warning: enum is never used: `BsonValue`, #[warn(dead_code)] on by default\nb.rs:2 enum BsonValue {\nb.rs:3     BDouble(f64),\nb.rs:4     BString(String),\nb.rs:5     BInt64(i64),\nb.rs:6     BInt32(i32),\nb.rs:7     BUndefined,\n       ...\nb.rs:23:1: 25:2 warning: function is never used: `setValueForKey`, #[warn(dead_code)] on by default\nb.rs:23 fn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\nb.rs:24 {\nb.rs:25 }\nb.rs:23:20: 23:23 warning: unused variable: `doc`, #[warn(unused_variables)] on by default\nb.rs:23 fn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\n                           ^~~\nb.rs:23:36: 23:37 warning: unused variable: `k`, #[warn(unused_variables)] on by default\nb.rs:23 fn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\n                                           ^\nb.rs:23:46: 23:47 warning: unused variable: `v`, #[warn(unused_variables)] on by default\nb.rs:23 fn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\n                                                     ^\nb.rs:23:1: 25:2 warning: function `setValueForKey` should have a snake case name such as `set_value_for_key`, #[warn(non_snake_case)] on by default\nb.rs:23 fn setValueForKey (doc:&BsonValue, k:String, v:&BsonValue)\nb.rs:24 {\nb.rs:25 }\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Unexpected type returned from struct_tail: BsonValue for ty=BsonValue', /Users/rustbuild/src/rust-buildbot/slave/beta-dist-rustc-mac/build/src/librustc_trans/trans/type_of.rs:366\n\nstack backtrace:\n   1:        0x1085cc33f - sys::backtrace::write::h0f2fc53eb11eb814gWr\n   2:        0x1085d4942 - panicking::on_panic::hd617a4042e8486fciUv\n   3:        0x108591375 - rt::unwind::begin_unwind_inner::hd84dfec22ac3667d1Bv\n   4:        0x108592206 - rt::unwind::begin_unwind_fmt::h5bb6fa95bd57b24bFAv\n   5:        0x10566046f - trans::type_of::in_memory_type_of::hb4e9c324c5b50f3epkL\n   6:        0x105732682 - trans::type_of::type_of_rust_fn::h693a4c7fdf6ff62b87K\n   7:        0x10566e00c - trans::declare::declare_rust_fn::hb0911ef870c7fe86SJz\n   8:        0x10569462f - trans::base::register_fn::ha9cdc6c185aa084bVmi\n   9:        0x10568f2d1 - trans::base::get_item_val::hfda21a63917f43e1Dzi\n  10:        0x10568b3c7 - trans::base::trans_item::h2033cab24c2319dbFbi\n  11:        0x10569a220 - trans::base::trans_crate::h3375b1d0f4de8d89F0i\n  12:        0x10511ed4e - driver::phase_4_translate_to_llvm::hc94112f0d91aac3chOa\n  13:        0x1050f72a4 - driver::compile_input::h4747d8bb1c595fdfQba\n  14:        0x1051be8f3 - run_compiler::hc8c95c5858347fdbz4b\n  15:        0x1051bc41a - boxed::F.FnBox<A>::call_box::h7872786064439979928\n  16:        0x1051bb8b7 - rt::unwind::try::try_fn::h10239991317224243769\n  17:        0x1086557c8 - rust_try_inner\n  18:        0x1086557b5 - rust_try\n  19:        0x1051bbb90 - boxed::F.FnBox<A>::call_box::h4543691575426869824\n  20:        0x1085d348d - sys::thread::create::thread_start::h499b3be451a7bbb8AZu\n  21:     0x7fff8aca1898 - _pthread_body\n  22:     0x7fff8aca1729 - _pthread_start\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24957/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24957/timeline", "performed_via_github_app": null, "state_reason": "completed"}