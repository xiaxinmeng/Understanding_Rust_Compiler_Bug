{"url": "https://api.github.com/repos/rust-lang/rust/issues/54049", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54049/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54049/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54049/events", "html_url": "https://github.com/rust-lang/rust/issues/54049", "id": 358267077, "node_id": "MDU6SXNzdWUzNTgyNjcwNzc=", "number": 54049, "title": "Infinite recursion can trigger undefined behavior (I think)", "user": {"login": "davidlattimore", "id": 8983542, "node_id": "MDQ6VXNlcjg5ODM1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8983542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidlattimore", "html_url": "https://github.com/davidlattimore", "followers_url": "https://api.github.com/users/davidlattimore/followers", "following_url": "https://api.github.com/users/davidlattimore/following{/other_user}", "gists_url": "https://api.github.com/users/davidlattimore/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidlattimore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidlattimore/subscriptions", "organizations_url": "https://api.github.com/users/davidlattimore/orgs", "repos_url": "https://api.github.com/users/davidlattimore/repos", "events_url": "https://api.github.com/users/davidlattimore/events{/privacy}", "received_events_url": "https://api.github.com/users/davidlattimore/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-09-08T05:44:58Z", "updated_at": "2018-09-08T07:58:08Z", "closed_at": "2018-09-08T07:58:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```rust\r\npub fn bar(i: i32) -> i32 {\r\n    if i < 1000 {\r\n        bar(i % 2)\r\n    } else {\r\n        1234567\r\n    }\r\n}\r\n\r\nfn main() {\r\n    println!(\"RESULT: {}\", bar(10));\r\n}\r\n```\r\n\r\nIf I cargo run this, I get a stack overflow as expected. If I cargo run --release however, I get:\r\nRESULT: 1234567\r\n\r\nThe else should be unreachable (with input 10). I suspect LLVM is correctly identifying that it will recurse indefinitely, but that it perhaps considers that undefined behavior, so decides that it's free to remove the if statement and just unconditionally return the constant value. Indeed, if I look at the assembly produced for bar, it's just:\r\n\r\n```asm\r\n\tmovl\t$1234567, %eax\r\n\tretq\r\n```\r\n\r\nrustc version 1.28.0", "closed_by": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54049/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54049/timeline", "performed_via_github_app": null, "state_reason": "completed"}