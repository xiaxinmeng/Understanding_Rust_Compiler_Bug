{"url": "https://api.github.com/repos/rust-lang/rust/issues/85598", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85598/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85598/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85598/events", "html_url": "https://github.com/rust-lang/rust/issues/85598", "id": 898987346, "node_id": "MDU6SXNzdWU4OTg5ODczNDY=", "number": 85598, "title": "Opaque error error message if LLVM OOMs during full LTO", "user": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-05-23T10:29:17Z", "updated_at": "2023-03-04T00:15:54Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Starting today, I am seeing the following error in rust-analyzer's CI\r\n\r\n```\r\n   Compiling ide_ssr v0.0.0 (D:\\a\\rust-analyzer\\rust-analyzer\\crates\\ide_ssr)\r\n   Compiling ide v0.0.0 (D:\\a\\rust-analyzer\\rust-analyzer\\crates\\ide)\r\nfatal runtime error: Rust cannot catch foreign exceptions\r\nerror: could not compile `rust-analyzer`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name rust_analyzer --edition=2018 crates\\rust-analyzer\\src/bin/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C opt-level=3 -C lto -C debuginfo=1 -C metadata=79e139aff8fa11a3 --out-dir D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps --target x86_64-pc-windows-msvc -C linker=rust-lld -L dependency=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps -L dependency=D:\\a\\rust-analyzer\\rust-analyzer\\target\\release\\deps --extern always_assert=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libalways_assert-a5c3950cbac605c2.rlib --extern anyhow=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libanyhow-b92146a0e6d6413a.rlib --extern cfg=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libcfg-3451d2c1a2e1dd21.rlib --extern crossbeam_channel=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libcrossbeam_channel-8dc7041ff99977ca.rlib --extern dissimilar=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libdissimilar-a85bc727a6ef040f.rlib --extern env_logger=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libenv_logger-0c1b28edc895da2b.rlib --extern flycheck=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libflycheck-5a3d33ebf8982c91.rlib --extern hir=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libhir-f1c482a9f52ec024.rlib --extern hir_def=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libhir_def-84f9901156f3c37e.rlib --extern hir_ty=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libhir_ty-a9ff862504d19d8d.rlib --extern ide=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libide-aca7a6f5717b60fb.rlib --extern ide_db=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libide_db-30818be798bb4bd5.rlib --extern ide_ssr=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libide_ssr-25d0dd581c0a1f21.rlib --extern itertools=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libitertools-795925f20865e421.rlib --extern jod_thread=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libjod_thread-7b553ff844830aa9.rlib --extern log=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\liblog-d97217edfa7fa3e7.rlib --extern lsp_server=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\liblsp_server-1e7f9bab880d71c8.rlib --extern lsp_types=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\liblsp_types-55078c6e33798392.rlib --extern oorandom=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\liboorandom-fdca57d9670229c1.rlib --extern parking_lot=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libparking_lot-7574759f69a57d6d.rlib --extern proc_macro_srv=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libproc_macro_srv-14eb3c78110c3882.rlib --extern profile=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libprofile-4da50626cb505dfd.rlib --extern project_model=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libproject_model-54a1bf11492f68c6.rlib --extern rayon=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\librayon-0a74d6af60e18fd2.rlib --extern rust_analyzer=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\librust_analyzer-2fedc7074222fbbe.rlib --extern rustc_hash=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\librustc_hash-fd535a62a1631d92.rlib --extern serde=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libserde-aa69b9bf35e75485.rlib --extern serde_json=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libserde_json-d9c58ca21bdb469a.rlib --extern serde_path_to_error=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libserde_path_to_error-4c50a4fa3dc519a6.rlib --extern stdx=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libstdx-f1ad487878f200cc.rlib --extern syntax=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libsyntax-f7fcb85a088de37a.rlib --extern text_edit=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libtext_edit-b086ec402917223c.rlib --extern threadpool=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libthreadpool-88302915b8bc103a.rlib --extern toolchain=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libtoolchain-4dec8cd4ff032434.rlib --extern tracing=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libtracing-c63fa0ca38f03367.rlib --extern tracing_subscriber=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libtracing_subscriber-a3129190deedb9fe.rlib --extern tracing_tree=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libtracing_tree-700f7dfac6fdc792.rlib --extern vfs=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libvfs-0da9b6babb9c702b.rlib --extern vfs_notify=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libvfs_notify-09fa85939f13d34c.rlib --extern winapi=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libwinapi-a329bfbc416edc71.rlib --extern xflags=D:\\a\\rust-analyzer\\rust-analyzer\\target\\x86_64-pc-windows-msvc\\release\\deps\\libxflags-3011d41fb4019847.rlib -D warnings -W unreachable-pub` \r\n(exit code: 0xc0000409, STATUS_STACK_BUFFER_OVERRUN)\r\nError: command `cargo build --manifest-path ./crates/rust-analyzer/Cargo.toml --bin rust-analyzer --target x86_64-pc-windows-msvc --release` failed, exit code: 101\r\nerror: process didn't exit successfully: `target\\debug\\xtask.exe dist` (exit code: 1)\r\nError: Process completed with exit code 1.\r\n```\r\n\r\nThis happens on windows builders, when compiling with `--target x86_64-pc-windows-msvc` or `--target aarch64-pc-windows-msvc`. The step which fails is compilation of the final binary crate. The binary is complied in `--release` mode with `lto=true`. I think the failure appeared after I added `debug=1` as well. \r\n\r\nSo my theory is that maybe this is just some OOM in the linker, and not a problem with rustc per se? The error message is rather unhelpful though. \r\n\r\nThe relevant CI run: https://github.com/rust-analyzer/rust-analyzer/runs/2649419225?check_suite_focus=true#step:5:330", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85598/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85598/timeline", "performed_via_github_app": null, "state_reason": null}