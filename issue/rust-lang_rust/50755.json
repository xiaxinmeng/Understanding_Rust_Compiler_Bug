{"url": "https://api.github.com/repos/rust-lang/rust/issues/50755", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50755/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50755/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50755/events", "html_url": "https://github.com/rust-lang/rust/issues/50755", "id": 322973689, "node_id": "MDU6SXNzdWUzMjI5NzM2ODk=", "number": 50755, "title": "Latest nightly rustc deadlocks/hangs indefinitely when trying to compile otherwise correct code (nightly-x86_64-unknown-linux-gnu 9fae15374 2018-05-13)", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-05-14T20:42:34Z", "updated_at": "2018-05-15T05:39:45Z", "closed_at": "2018-05-15T05:39:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "I apologize in advance as neither I nor the fine folks on #rust IRC were able to reduce this problem down to something manageable, so I leave a full repository (granted, not a terrible large amount of code) and just a few hints of what I know.\r\n\r\n[See here for the offending code.](https://github.com/augiii/nx_edit)\r\n\r\nNo matter how I invoke rustc (`cargo build`, `cargo rustc`, `cargo build -v -j 1`, etc.), it deadlocks some time after checking for correctness (typeck/borrowck) and emitting warnings. Originally I thought this was an RLS bug as it made RLS hang indefinitely, but after leaving rustc running for upwards of 8 hours, it refuses to complete compilation.\r\n\r\nIt started when writing [this line](https://github.com/augiii/nx_edit/blob/master/src/state.rs#L1015), when I initially solved the type error I had there by casting `offshoot` (a `u64`) to a `usize`. That could be a red herring, I don't know.\r\n\r\nI tried running `cargo build -v` under gdb, and this is the relevant `where` results that I got after suspending execution from within the deadlock, if it's any help:\r\n\r\n```\r\nwarning: unused variable: `padding_buf`\r\n    --> src/state.rs:1014:17\r\n     |\r\n1014 |             let padding_buf = [0u8; 7];\r\n     |                 ^^^^^^^^^^^ help: consider using `_padding_buf` instead\r\n     |\r\n     = note: #[warn(unused_variables)] on by default\r\n \r\nwarning: unused variable: `bitmap_data_offset`\r\n    --> src/state.rs:1034:13\r\n     |\r\n1034 |         let mut bitmap_data_offset = offset + 8 * bitmaps.len() as u64;\r\n     |             ^^^^^^^^^^^^^^^^^^^^^^ help: consider using `_bitmap_data_offset` instead\r\n \r\n^C\r\nThread 1 \"cargo\" received signal SIGINT, Interrupt.\r\n0x00007ffff77baffc in pthread_cond_wait@@GLIBC_2.3.2 () from /usr/lib/libpthread.so.0\r\n(gdb) where\r\n#0  0x00007ffff77baffc in pthread_cond_wait@@GLIBC_2.3.2 () from /usr/lib/libpthread.so.0\r\n#1  0x0000555555d105c7 in std::sys::unix::condvar::Condvar::wait () at libstd/sys/unix/condvar.rs:78\r\n#2  std::sys_common::condvar::Condvar::wait () at libstd/sys_common/condvar.rs:51\r\n#3  std::sync::condvar::Condvar::wait () at libstd/sync/condvar.rs:214\r\n#4  std::thread::park () at libstd/thread/mod.rs:803\r\n#5  0x0000555555d1a0d1 in std::sync::mpsc::blocking::WaitToken::wait () at libstd/sync/mpsc/blocking.rs:81\r\n#6  0x00005555556aa2db in <std::sync::mpsc::shared::Packet<T>>::recv ()\r\n#7  0x0000555555655b9b in <std::sync::mpsc::Receiver<T>>::recv ()\r\n#8  0x0000555555774152 in cargo::core::compiler::job_queue::JobQueue::drain_the_queue ()\r\n#9  0x00005555556e3867 in crossbeam::scoped::scope ()\r\n#10 0x000055555576c3e1 in cargo::core::compiler::context::Context::compile ()\r\n#11 0x00005555556bda59 in cargo::ops::cargo_compile::compile_ws ()\r\n#12 0x00005555556ba3b6 in cargo::ops::cargo_compile::compile_with_exec ()\r\n#13 0x0000555555715aaf in cargo::ops::cargo_run::run ()\r\n#14 0x00005555555f18de in cargo::commands::run::exec ()\r\n#15 0x00005555555eb0dc in cargo::cli::main ()\r\n#16 0x00005555555e1f44 in cargo::main ()\r\n#17 0x0000555555606613 in std::rt::lang_start::{{closure}} ()\r\n#18 0x0000555555cfd6a3 in std::rt::lang_start_internal::{{closure}} () at libstd/rt.rs:59\r\n#19 std::panicking::try::do_call () at libstd/panicking.rs:310\r\n#20 0x0000555555d28daa in __rust_maybe_catch_panic () at libpanic_unwind/lib.rs:105\r\n#21 0x0000555555d0a106 in std::panicking::try () at libstd/panicking.rs:289\r\n#22 std::panic::catch_unwind () at libstd/panic.rs:374\r\n#23 std::rt::lang_start_internal () at libstd/rt.rs:58\r\n#24 0x00005555555e4164 in main ()\r\n(gdb)\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50755/timeline", "performed_via_github_app": null, "state_reason": "completed"}