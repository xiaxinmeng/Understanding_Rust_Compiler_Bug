{"url": "https://api.github.com/repos/rust-lang/rust/issues/42399", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42399/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42399/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42399/events", "html_url": "https://github.com/rust-lang/rust/issues/42399", "id": 233342443, "node_id": "MDU6SXNzdWUyMzMzNDI0NDM=", "number": 42399, "title": "ICE in conservative_impl_trait over VecDeque<String> Iterator", "user": {"login": "Ruin0x11", "id": 6700637, "node_id": "MDQ6VXNlcjY3MDA2Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/6700637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ruin0x11", "html_url": "https://github.com/Ruin0x11", "followers_url": "https://api.github.com/users/Ruin0x11/followers", "following_url": "https://api.github.com/users/Ruin0x11/following{/other_user}", "gists_url": "https://api.github.com/users/Ruin0x11/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ruin0x11/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ruin0x11/subscriptions", "organizations_url": "https://api.github.com/users/Ruin0x11/orgs", "repos_url": "https://api.github.com/users/Ruin0x11/repos", "events_url": "https://api.github.com/users/Ruin0x11/events{/privacy}", "received_events_url": "https://api.github.com/users/Ruin0x11/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 631673608, "node_id": "MDU6TGFiZWw2MzE2NzM2MDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-impl-trait", "name": "A-impl-trait", "color": "f7e101", "default": false, "description": "Area: impl Trait. Universally / existentially quantified anonymous types with static dispatch."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-06-03T03:53:34Z", "updated_at": "2018-04-03T10:01:38Z", "closed_at": "2018-04-03T10:01:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "The following produces an ICE on nightly:\r\n\r\n```rust\r\n#![feature(conservative_impl_trait)]\r\n\r\nuse std::collections::VecDeque;\r\n\r\nstruct Dude {\r\n    pets: VecDeque<String>\r\n}\r\n\r\nimpl Dude {\r\n    pub fn new() -> Self {\r\n        let mut pets = VecDeque::new();\r\n        pets.push_front(\"Ardo\".to_string());\r\n        pets.push_front(\"Jamie\".to_string());\r\n        pets.push_front(\"Bowser\".to_string());\r\n\r\n        Dude {\r\n            pets: pets\r\n        }\r\n    }\r\n\r\n    pub fn iter_pets(&self) -> impl Iterator<Item=&str> {\r\n        self.pets.iter()\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let dude = Dude::new();\r\n    for pet in dude.iter_pets() {\r\n        println!(\"Pet: {}\", pet);\r\n    }\r\n}\r\n```\r\n\r\nBacktrace:\r\n\r\n```\r\nerror: internal compiler error: src/librustc_typeck/check/mod.rs:582: escaping regions in predicate Obligation(predicate=Binder(ProjectionPredicate(ProjectionTy { trait_ref: <_ as std::iter::Iterator>, item_name: Item(100) }, &str)),depth=0)\r\n  --> /var/folders/ps/gxj98yzj1hl7s0nbh2p67yrh0000gn/T/scratch.rs18590rMs:21:32\r\n   |\r\n21 |     pub fn iter_pets(&self) -> impl Iterator<Item=&str> {\r\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:421\r\nstack backtrace:\r\n   0:        0x10e7591a3 - std::sys::imp::backtrace::tracing::imp::unwind_backtrace::h884a721e113c3303\r\n   1:        0x10e766b78 - std::panicking::default_hook::{{closure}}::h7a7d734b2824d103\r\n   2:        0x10e76673f - std::panicking::default_hook::h3eb11bd6cbfdc331\r\n   3:        0x10e768fc7 - std::panicking::rust_panic_with_hook::h8b9b25777425677b\r\n   4:        0x10cf92a9b - std::panicking::begin_panic::h061689b360c0bfb1\r\n   5:        0x10cf8e566 - rustc_errors::Handler::span_bug::h2b4146ff57268dfc\r\n   6:        0x10cfb764e - rustc::session::opt_span_bug_fmt::{{closure}}::h34cfa07f23f68d87\r\n   7:        0x10cfb74ca - rustc::session::span_bug_fmt::h4f2cfdfd2015bbe7\r\n   8:        0x10d02dc14 - rustc_typeck::check::Inherited::register_predicate::h75c22e95f0c57291\r\n   9:        0x10cf8f671 - <rustc::ty::fold::BottomUpFolder<'a, 'gcx, 'tcx, F> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_ty::hfc1c4aa50b73a811\r\n  10:        0x10d033131 - rustc_typeck::check::check_fn::hb3437296de08eb34\r\n  11:        0x10d02fc2c - rustc_typeck::check::typeck_tables_of::{{closure}}::h1b6d5d70ecf6005f\r\n  12:        0x10d02f6e5 - rustc_typeck::check::typeck_tables_of::h4c463db39374b891\r\n  13:        0x10d5c5b87 - rustc::ty::maps::<impl rustc::ty::maps::queries::typeck_tables_of<'tcx>>::try_get::hfdb673b8a48ec6b9\r\n  14:        0x10d5e686a - rustc::ty::maps::TyCtxtAt::typeck_tables_of::hdf5c872430b487bf\r\n  15:        0x10d5e2a3e - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::typeck_tables_of::h306d67d8b4c45cea\r\n  16:        0x10d02ea5f - rustc_typeck::check::typeck_item_bodies::h8dfd9fcfc53b0892\r\n  17:        0x10d5c4fe0 - rustc::ty::maps::<impl rustc::ty::maps::queries::typeck_item_bodies<'tcx>>::try_get::hf3e901ad43954fdf\r\n  18:        0x10d5e66f6 - rustc::ty::maps::TyCtxtAt::typeck_item_bodies::hc4d4754d193e0320\r\n  19:        0x10d5e2a02 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::typeck_item_bodies::hc8ecc5004e34ae46\r\n  20:        0x10d08b8c0 - rustc_typeck::check_crate::h775d5fd81d3a9471\r\n  21:        0x109062998 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::h0ecedd6aa323696d\r\n  22:        0x1090533ca - rustc_driver::driver::phase_3_run_analysis_passes::h7d4e4be12a652e17\r\n  23:        0x109041910 - rustc_driver::driver::compile_input::h348e0421a5ad9950\r\n  24:        0x109087818 - rustc_driver::run_compiler::hcb92b90602044806\r\n  25:        0x108fb3c8b - std::sys_common::backtrace::__rust_begin_short_backtrace::h77667a403996a54f\r\n  26:        0x10e76c15a - __rust_maybe_catch_panic\r\n  27:        0x108fda02f - <F as alloc::boxed::FnBox<A>>::call_box::hf344d772b8631f42\r\n  28:        0x10e765bf5 - std::sys::imp::thread::Thread::new::thread_start::h993b7e5cb7871f66\r\n  29:        0x10f02baaa - _pthread_body\r\n  30:        0x10f02b9f6 - _pthread_start\r\n\r\n$ rustc --version\r\nrustc 1.19.0-nightly (e0cc22b4b 2017-05-31)\r\n```", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42399/timeline", "performed_via_github_app": null, "state_reason": "completed"}