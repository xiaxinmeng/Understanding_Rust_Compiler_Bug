{"url": "https://api.github.com/repos/rust-lang/rust/issues/18164", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18164/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18164/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18164/events", "html_url": "https://github.com/rust-lang/rust/issues/18164", "id": 46212014, "node_id": "MDU6SXNzdWU0NjIxMjAxNA==", "number": 18164, "title": "Static recursion checker doesn't like foreign items", "user": {"login": "bgamari", "id": 1010174, "node_id": "MDQ6VXNlcjEwMTAxNzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1010174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bgamari", "html_url": "https://github.com/bgamari", "followers_url": "https://api.github.com/users/bgamari/followers", "following_url": "https://api.github.com/users/bgamari/following{/other_user}", "gists_url": "https://api.github.com/users/bgamari/gists{/gist_id}", "starred_url": "https://api.github.com/users/bgamari/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bgamari/subscriptions", "organizations_url": "https://api.github.com/users/bgamari/orgs", "repos_url": "https://api.github.com/users/bgamari/repos", "events_url": "https://api.github.com/users/bgamari/events{/privacy}", "received_events_url": "https://api.github.com/users/bgamari/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-10-19T17:56:57Z", "updated_at": "2015-04-22T00:35:38Z", "closed_at": "2015-04-22T00:35:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given this example,\n\n``` rust\nstruct I2CReg {\n  test: u32\n}\n\nextern {\n  #[link_name=\"k20_iomem_I2C0\"] pub static I2C0: I2CReg;\n}\n\nstruct I2C {\n  reg: &'static I2CReg\n}\n\nstatic mut i2c0: I2C = I2C {\n  reg: &I2C0\n};\n```\n\nThe compiler fails with,\n\n```\n$ RUST_BACKTRACE=1 rustc ~/hi.rs\nerror: main function not found\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'expected item, found foreign item I2C0::I2C0 (id=10)', /opt/exp/rust/src/libsyntax/ast_map/mod.rs:327\n\nstack backtrace:\n   1:     0x7f8177084ac0 - rt::backtrace::imp::write::h1ca5678a3ff3db86FKq\n   2:     0x7f8177087bf0 - failure::on_fail::h5e5f8014b5357c8925q\n   3:     0x7f817784c120 - unwind::begin_unwind_inner::h8d456ef7c87c11498yd\n   4:     0x7f817784bc60 - unwind::begin_unwind_fmt::hca0e3d62c3383802Awd\n   5:     0x7f81735515a0 - ast_map::Map<'ast>::expect_item::h334acf2fbc39b3c5ZyA\n   6:     0x7f8177fcc880 - middle::check_static_recursion::CheckItemRecursionVisitor<'a, 'ast>.Visitor<'v>::visit_expr::he096ace2658f1b8bbBm\n   7:     0x7f8177fcc880 - middle::check_static_recursion::CheckItemRecursionVisitor<'a, 'ast>.Visitor<'v>::visit_expr::he096ace2658f1b8bbBm\n   8:     0x7f8177fcb690 - middle::check_static_recursion::CheckItemRecursionVisitor<'a, 'ast>.Visitor<'v>::visit_item::hed53c23550405e1ahAm\n   9:     0x7f8177fcb2c0 - middle::check_static_recursion::check_item_recursion::h5327b315a0b31aa3yzm\n  10:     0x7f8177fc96a0 - middle::check_static_recursion::check_item::hd99fb3896a763d44hym\n  11:     0x7f8177fca090 - middle::check_static_recursion::check_crate::hd6acd800f78889b5Axm\n  12:     0x7f8177da3360 - util::common::time::h12472689958318282120\n  13:     0x7f8178653240 - driver::driver::phase_3_run_analysis_passes::hce054544bc712d7cY9z\n  14:     0x7f817864e380 - driver::driver::compile_input::h63529e8fd125edb4KQz\n  15:     0x7f81786d9770 - driver::run_compiler::h7dbfcf2997d50ba64DD\n  16:     0x7f81786d9620 - driver::run::closure.145928\n  17:     0x7f8177dbd1f0 - task::TaskBuilder<S>::try_future::closure.103305\n  18:     0x7f8177dbcfd0 - task::TaskBuilder<S>::spawn_internal::closure.103276\n  19:     0x7f8178f3d040 - task::spawn_opts::closure.8464\n  20:     0x7f81779fdf40 - rust_try_inner\n  21:     0x7f81779fdf30 - rust_try\n  22:     0x7f81778499e0 - unwind::try::heab2ced16db50a7aQnd\n  23:     0x7f8177849860 - task::Task::run::h1f2a16a1fd2bfec6uDc\n  24:     0x7f8178f3cd80 - task::spawn_opts::closure.8404\n  25:     0x7f817784b130 - thread::thread_start::hfee97593d1ff979fFXc\n  26:     0x7f8176b4b0c0 - start_thread\n  27:     0x7f8177513f89 - __clone\n  28:                0x0 - <unknown>\n```\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18164/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18164/timeline", "performed_via_github_app": null, "state_reason": "completed"}