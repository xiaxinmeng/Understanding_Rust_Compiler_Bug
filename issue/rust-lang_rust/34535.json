{"url": "https://api.github.com/repos/rust-lang/rust/issues/34535", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34535/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34535/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34535/events", "html_url": "https://github.com/rust-lang/rust/issues/34535", "id": 162782338, "node_id": "MDU6SXNzdWUxNjI3ODIzMzg=", "number": 34535, "title": "rustc hangs", "user": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 27, "created_at": "2016-06-28T20:42:25Z", "updated_at": "2016-08-04T15:57:38Z", "closed_at": "2016-08-04T15:57:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "OS: Windows 10 x64\nrustc: `rustc 1.9.0 (e4e8b6668 2016-05-18)` and `rustc 1.11.0-nightly (ab0b87458 2016-06-13)`.\n\nFirst of all I am sorry I was unable to come up with a minimal example. I tried a couple of times but it just didn't trigger the issue. I am working on a simple [game](https://github.com/aochagavia/snake/tree/cd1b56c39d02cb7b6a0aa06b32f3e02e36b986e3), but instead of compiling in <10 seconds (as usual), it hangs indefinetly (I gave up after about 5 minutes).\n## Running with `time-passes`\n\nWhen compiling with nightly, the output of `cargo rustc -- -Ztime-passes` is:\n\n```\ntime: 0.032; rss: 27MB  parsing\ntime: 0.000; rss: 27MB  configuration 1\ntime: 0.000; rss: 27MB  recursion limit\ntime: 0.000; rss: 27MB  crate injection\ntime: 0.000; rss: 27MB  plugin loading\ntime: 0.000; rss: 27MB  plugin registration\ntime: 0.214; rss: 54MB  expansion\ntime: 0.000; rss: 54MB  gated configuration checking\ntime: 0.000; rss: 54MB  maybe building test harness\ntime: 0.000; rss: 54MB  checking for inline asm in case the target doesn't support it\ntime: 0.000; rss: 54MB  complete gated feature checking\ntime: 0.000; rss: 54MB  assigning node ids\ntime: 0.000; rss: 54MB  collecting defs\ntime: 0.849; rss: 131MB external crate/lib resolution\ntime: 0.000; rss: 131MB early lint checks\ntime: 0.000; rss: 131MB AST validation\n^C\n```\n\nAs you can see, the compiler is stuck after AST validation (note how I needed `^C` to kill Cargo).\n\nWhen compiling with stable, the output is:\n\n```\ntime: 0.003; rss: 41MB  parsing\ntime: 0.000; rss: 42MB  configuration 1\ntime: 0.000; rss: 42MB  recursion limit\ntime: 0.000; rss: 42MB  gated macro checking\ntime: 0.000; rss: 42MB  crate injection\ntime: 0.020; rss: 43MB  macro loading\ntime: 0.000; rss: 43MB  plugin loading\ntime: 0.000; rss: 43MB  plugin registration\ntime: 0.005; rss: 44MB  expansion\ntime: 0.000; rss: 44MB  complete gated feature checking 1\ntime: 0.001; rss: 44MB  configuration 2\ntime: 0.000; rss: 44MB  gated configuration checking\ntime: 0.000; rss: 44MB  maybe building test harness\ntime: 0.001; rss: 44MB  prelude injection\ntime: 0.000; rss: 44MB  checking that all macro invocations are gone\ntime: 0.000; rss: 44MB  checking for inline asm in case the target doesn't support it\ntime: 0.000; rss: 44MB  complete gated feature checking 2\ntime: 0.000; rss: 44MB  const fn bodies and arguments\ntime: 0.000; rss: 44MB  assigning node ids\ntime: 0.000; rss: 44MB  lowering ast -> hir\ntime: 0.000; rss: 44MB  indexing hir\ntime: 0.000; rss: 44MB  attribute checking\ntime: 0.000; rss: 44MB  early lint checks\ntime: 0.144; rss: 50MB  external crate/lib resolution\ntime: 0.000; rss: 50MB  language item collection\n^C\n```\n## Additional information (tested on stable):\n\nIf I remove the `controllers::keyboard` module, the compiler runs without problems.\n\nIf I replace [this line](https://github.com/aochagavia/snake/blob/cd1b56c39d02cb7b6a0aa06b32f3e02e36b986e3/src/controllers/keyboard.rs#L6) by `pub fn press(key: u8) {`, the output with `-Ztime-passes` changes:\n\n```\ntime: 0.003; rss: 41MB  parsing\ntime: 0.000; rss: 42MB  configuration 1\ntime: 0.000; rss: 42MB  recursion limit\ntime: 0.000; rss: 42MB  gated macro checking\ntime: 0.000; rss: 42MB  crate injection\ntime: 0.020; rss: 43MB  macro loading\ntime: 0.000; rss: 43MB  plugin loading\ntime: 0.000; rss: 43MB  plugin registration\ntime: 0.004; rss: 44MB  expansion\ntime: 0.000; rss: 44MB  complete gated feature checking 1\ntime: 0.001; rss: 44MB  configuration 2\ntime: 0.000; rss: 44MB  gated configuration checking\ntime: 0.000; rss: 44MB  maybe building test harness\ntime: 0.001; rss: 44MB  prelude injection\ntime: 0.000; rss: 44MB  checking that all macro invocations are gone\ntime: 0.000; rss: 44MB  checking for inline asm in case the target doesn't support it\ntime: 0.000; rss: 44MB  complete gated feature checking 2\ntime: 0.000; rss: 44MB  const fn bodies and arguments\ntime: 0.000; rss: 44MB  assigning node ids\ntime: 0.000; rss: 44MB  lowering ast -> hir\ntime: 0.000; rss: 44MB  indexing hir\ntime: 0.000; rss: 44MB  attribute checking\ntime: 0.000; rss: 44MB  early lint checks\ntime: 0.144; rss: 50MB  external crate/lib resolution\ntime: 0.000; rss: 50MB  language item collection\ntime: 0.020; rss: 66MB  resolution\ntime: 0.000; rss: 66MB  lifetime resolution\ntime: 0.000; rss: 66MB  looking for entry point\ntime: 0.000; rss: 66MB  looking for plugin registrar\ntime: 0.000; rss: 66MB  region resolution\ntime: 0.000; rss: 66MB  loop checking\ntime: 0.000; rss: 66MB  static item recursion checking\ntime: 0.000; rss: 66MB  load_dep_graph\ntime: 0.003; rss: 66MB  type collecting\ntime: 0.000; rss: 66MB  variance inference\ntime: 0.094; rss: 101MB coherence checking\ntime: 0.001; rss: 101MB wf checking\ntime: 0.002; rss: 101MB item-types checking\n^C\n```\n\nFor whatever reason, rustc is able to go a little bit further in this case.\n## Related issues\n\nMaybe this is a duplicate of https://github.com/rust-lang/rust/issues/33776\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34535/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34535/timeline", "performed_via_github_app": null, "state_reason": "completed"}