{"url": "https://api.github.com/repos/rust-lang/rust/issues/109676", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109676/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109676/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109676/events", "html_url": "https://github.com/rust-lang/rust/issues/109676", "id": 1642754779, "node_id": "I_kwDOAAsO6M5h6nLb", "number": 109676, "title": "Very weird behavior when printing dep nodes", "user": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-27T20:17:46Z", "updated_at": "2023-03-28T09:43:19Z", "closed_at": "2023-03-28T09:43:19Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Like all good stories, this one starts with an ICE. I was investigating #108481 and turned on `-Zincremental-verify-ich` and I got an unstable fingerprint error. Beautiful.\r\nhttps://github.com/rust-lang/rust/issues/108481#issuecomment-1485612737\r\n\r\nThere is something ***very*** wrong with this error.\r\n\r\n> thread 'rustc' panicked at 'Found unstable fingerprints for ErrorGuaranteed(()): all-is-cubes/src/mesh/chunked_mesh.rs:40:71: 41:5 (#0)', /rustc/db0cbc48d4aaa300713a95d9b317a365a474490c/compiler/rustc_query_system/src/query/plumbing.rs:711:9\r\n\r\n`ErrorGuaranteed` is not a dep node. This was on the latest nightly 2023-03-26. So then I tried my outdated-by-a-few-days master branch and got a normal error\r\n\r\n> thread 'rustc' panicked at 'Found unstable fingerprints for def_span(all_is_cubes[4f6c]::mesh::chunked_mesh::{impl#6}::{constant#0})`\r\n\r\nI then turned on thin lto locally (because thin lto is pretty suspicious to me now) and it still showed the right error. I also tried building it with a less outdated local compiler with thin lto and no debug assertions and it showed ErrorGuaranteed again. But after some more cleaning and playing around with trying to bisect the ErrorGuaranteed change (I didn't try an old nightly at that point) even nightly showed the proper error message.\r\n\r\nI then continued minimization and after some time I got ErrorGuaranteed again.\r\n\r\nAt one point I added a dbg of a dep node of the same type somewhere in interface, but it was printed normally (printing the key panicked as I was doing it wrong but the kind was shown correctly).\r\n\r\nMy current plan is to continue the ICE minimization as normal and then, once I hopefully have a smaller repro for the ICE, try it again.\r\n\r\nI haven't played around with it too much and didn't have a consistent environment so it's hard to say more. \r\n\r\nif someone had some spare time it would be neat if they could poke around with trying the repro and see what they get. I'm a little (maybe more than a little) worried that this is a sign of something very bad so I put up the issue for visibility.\r\n\r\nI am on x86_64-unknown-linux-gnu and did not try other toolchains.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109676/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109676/timeline", "performed_via_github_app": null, "state_reason": "completed"}