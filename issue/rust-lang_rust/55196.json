{"url": "https://api.github.com/repos/rust-lang/rust/issues/55196", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55196/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55196/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55196/events", "html_url": "https://github.com/rust-lang/rust/issues/55196", "id": 371861955, "node_id": "MDU6SXNzdWUzNzE4NjE5NTU=", "number": 55196, "title": "Dangerously misleading introduction to std::sync::atomic::Ordering", "user": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-19T08:45:58Z", "updated_at": "2018-11-29T15:24:42Z", "closed_at": "2018-11-29T15:24:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When looking at https://doc.rust-lang.org/std/sync/atomic/enum.Ordering.html, this is in the intro:\r\n\r\n> At its most restrictive, \"sequentially consistent\" atomics allow neither reads nor writes to be moved either before or after the atomic operation;\r\n\r\nThis is not true (even the explanations for variants disprove this, but if someone reads only the intro, they could get to the conclusion that using SeqCst is good enough everywhere, which it actually isn't).\r\n\r\nEg, from the docs below:\r\n\r\n> SeqCst: Like AcqRel with the additional guarantee that all threads see all sequentially consistent operations in the same order.\r\n\r\n> AcqRel: For loads it uses Acquire ordering. For stores it uses the Release ordering.\r\n\r\nSo, `atomic.load(Ordering::SeqCst)` has `Acquire` semantics (+ participating in the global timeline of all SeqCst operations), which means reads and writes are allowed to be reordered after the operation. And even failed CAS operation is effectively just a read, so operations are allowed to be reordered after the operation.\r\n\r\nI have the vague memory someone was updating it recently to actually point out these gotchas, but I can't find that now.\r\n\r\nI can try rewording it, but I'm not really that good at writing good concise documentation.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55196/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55196/timeline", "performed_via_github_app": null, "state_reason": "completed"}