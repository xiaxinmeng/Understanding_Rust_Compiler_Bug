{"url": "https://api.github.com/repos/rust-lang/rust/issues/34496", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34496/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34496/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34496/events", "html_url": "https://github.com/rust-lang/rust/issues/34496", "id": 162384771, "node_id": "MDU6SXNzdWUxNjIzODQ3NzE=", "number": 34496, "title": "It is unclear how UnsafeCell is special", "user": {"login": "diwic", "id": 9721510, "node_id": "MDQ6VXNlcjk3MjE1MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/9721510?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diwic", "html_url": "https://github.com/diwic", "followers_url": "https://api.github.com/users/diwic/followers", "following_url": "https://api.github.com/users/diwic/following{/other_user}", "gists_url": "https://api.github.com/users/diwic/gists{/gist_id}", "starred_url": "https://api.github.com/users/diwic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diwic/subscriptions", "organizations_url": "https://api.github.com/users/diwic/orgs", "repos_url": "https://api.github.com/users/diwic/repos", "events_url": "https://api.github.com/users/diwic/events{/privacy}", "received_events_url": "https://api.github.com/users/diwic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2016-06-27T06:52:05Z", "updated_at": "2016-08-04T05:56:41Z", "closed_at": "2016-08-04T05:56:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm raising this as an issue, even if it might look more like a question; I think the docs need to be clarified.\n\nI'm trying to figure out if and how `UnsafeCell` is special. Let's start with two statements, the first from [std API docs](http://doc.rust-lang.org/std/cell/struct.UnsafeCell.html)\n\n> The UnsafeCell<T> type is the only legal way to obtain aliasable data that is considered mutable. In general, transmuting an &T type into an &mut T is considered undefined behavior.\n\nThe second from [nomicon](https://doc.rust-lang.org/stable/nomicon/transmutes.html):\n\n> Transmuting an & to &mut is UB\n>    Transmuting an & to &mut is always UB\n>    No you can't do it\n>    No you're not special\n\nSo, this seems contradictory, and the first theory is that `UnsafeCell` is indeed special and that the Nomicon just forgot to mention it. The fact that unsafecell is a lang_item points in that direction too. But it seems there is more to it than that. The API docs mention `&mut T`, but `UnsafeCell` never hands out a `&mut T`, only a `*mut T`.  And for `*mut T`, the compiler cannot assume that two pointers are never the same; that is only true for `&mut T`. (Is this correct?)\n\nAnd AFAIK, none of the std wrappers allow for two `&mut T` - `Cell` never gives out a `&mut T`, it just copies values in and out, `RefCell`, `Mutex` and `RwLock` uses runtime checks to make sure there is only one `&mut T` at a time. And atomics never deal with `&mut` either.\n\nSo, that seems to point to the nomicon being correct, but then I don't see why we would need an `UnsafeCell` in the first place - `Cell` and friends could just implement their functionality on top of a `T` rather than an `UnsafeCell<T>`. \n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34496/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34496/timeline", "performed_via_github_app": null, "state_reason": "completed"}