{"url": "https://api.github.com/repos/rust-lang/rust/issues/21264", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21264/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21264/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21264/events", "html_url": "https://github.com/rust-lang/rust/issues/21264", "id": 54631132, "node_id": "MDU6SXNzdWU1NDYzMTEzMg==", "number": 21264, "title": "mem::zeroed unrolls hilariously enormous loops", "user": {"login": "richo", "id": 476418, "node_id": "MDQ6VXNlcjQ3NjQxOA==", "avatar_url": "https://avatars.githubusercontent.com/u/476418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richo", "html_url": "https://github.com/richo", "followers_url": "https://api.github.com/users/richo/followers", "following_url": "https://api.github.com/users/richo/following{/other_user}", "gists_url": "https://api.github.com/users/richo/gists{/gist_id}", "starred_url": "https://api.github.com/users/richo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richo/subscriptions", "organizations_url": "https://api.github.com/users/richo/orgs", "repos_url": "https://api.github.com/users/richo/repos", "events_url": "https://api.github.com/users/richo/events{/privacy}", "received_events_url": "https://api.github.com/users/richo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-01-16T22:09:06Z", "updated_at": "2015-01-19T14:13:31Z", "closed_at": "2015-01-19T14:13:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "test program:\n\n``` rust\nextern crate core;\n\nuse core::mem;\n\nconst SIZE: usize = 512 * 1024 * 1024;\n\nfn main() {\n    let memory: Box<[u8; SIZE]> = unsafe { Box::new(mem::zeroed()) };\n}\n```\n\nhangs for longer than I was willing to let it run. A smaller testcase, replacing 512 with 1 fails an assertion: `Assertion failed: ((!Node || ResNo < Node->getNumValues()) && \"Invalid result number for the given node!\"), function SDValue, file /Users/richo/code/ext/rust/src/llvm/include/llvm/CodeGen/SelectionDAGNodes.h, line 899.`\n\nFinally, in the original program I discovered this bug in generated this:\n\n``` asm\n__ZN3mem6zeroed21h15945040308467491263E:\n0000000000000890        cmpq    %gs:0x330, %rsp\n0000000000000899        ja      0x8b5\n000000000000089b        movabsq $0x8, %r10\n00000000000008a5        movabsq $0x0, %r11\n00000000000008af        callq   0x8b4\n00000000000008b4        retq\n00000000000008b5        pushq   %rbp\n00000000000008b6        movq    %rsp, %rbp\n00000000000008b9        movq    %rdi, %rax\n00000000000008bc        movb    $0x0, 0x46(%rdi)\n00000000000008c0        movb    $0x0, 0x45(%rdi)\n00000000000008c4        movb    $0x0, 0x44(%rdi)\n00000000000008c8        movb    $0x0, 0x43(%rdi)\n00000000000008cc        movb    $0x0, 0x42(%rdi)\n00000000000008d0        movb    $0x0, 0x41(%rdi)\n00000000000008d4        movb    $0x0, 0x40(%rdi)\n00000000000008d8        movb    $0x0, 0x3f(%rdi)\n00000000000008dc        movb    $0x0, 0x3e(%rdi)\n00000000000008e0        movb    $0x0, 0x3d(%rdi)\n00000000000008e4        movb    $0x0, 0x3c(%rdi)\n00000000000008e8        movb    $0x0, 0x3b(%rdi)\n00000000000008ec        movb    $0x0, 0x3a(%rdi)\n00000000000008f0        movb    $0x0, 0x39(%rdi)\n00000000000008f4        movb    $0x0, 0x38(%rdi)\n00000000000008f8        movb    $0x0, 0x37(%rdi)\n00000000000008fc        movb    $0x0, 0x36(%rdi)\n0000000000000900        movb    $0x0, 0x35(%rdi)\n0000000000000904        movb    $0x0, 0x34(%rdi)\n0000000000000908        movb    $0x0, 0x33(%rdi)\n000000000000090c        movb    $0x0, 0x32(%rdi)\n0000000000000910        movb    $0x0, 0x31(%rdi)\n0000000000000914        movb    $0x0, 0x30(%rdi)\n0000000000000918        movb    $0x0, 0x2f(%rdi)\n000000000000091c        movb    $0x0, 0x2e(%rdi)\n0000000000000920        movb    $0x0, 0x2d(%rdi)\n0000000000000924        movb    $0x0, 0x2c(%rdi)\n0000000000000928        movb    $0x0, 0x2b(%rdi)\n000000000000092c        movb    $0x0, 0x2a(%rdi)\n0000000000000930        movb    $0x0, 0x29(%rdi)\n0000000000000934        movb    $0x0, 0x28(%rdi)\n0000000000000938        movb    $0x0, 0x27(%rdi)\n000000000000093c        movb    $0x0, 0x26(%rdi)\n0000000000000940        movb    $0x0, 0x25(%rdi)\n0000000000000944        movb    $0x0, 0x24(%rdi)\n0000000000000948        movb    $0x0, 0x23(%rdi)\n000000000000094c        movb    $0x0, 0x22(%rdi)\n0000000000000950        movb    $0x0, 0x21(%rdi)\n0000000000000954        movb    $0x0, 0x20(%rdi)\n0000000000000958        movb    $0x0, 0x1f(%rdi)\n(Continues for several megabytes)\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21264/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21264/timeline", "performed_via_github_app": null, "state_reason": "completed"}