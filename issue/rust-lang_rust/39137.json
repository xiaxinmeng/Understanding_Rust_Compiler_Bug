{"url": "https://api.github.com/repos/rust-lang/rust/issues/39137", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39137/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39137/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39137/events", "html_url": "https://github.com/rust-lang/rust/issues/39137", "id": 201412332, "node_id": "MDU6SXNzdWUyMDE0MTIzMzI=", "number": 39137, "title": "Derived Hash for repr(u8) enum submits 8 bytes to Hasher instead of 1", "user": {"login": "kryptan", "id": 11528855, "node_id": "MDQ6VXNlcjExNTI4ODU1", "avatar_url": "https://avatars.githubusercontent.com/u/11528855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kryptan", "html_url": "https://github.com/kryptan", "followers_url": "https://api.github.com/users/kryptan/followers", "following_url": "https://api.github.com/users/kryptan/following{/other_user}", "gists_url": "https://api.github.com/users/kryptan/gists{/gist_id}", "starred_url": "https://api.github.com/users/kryptan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kryptan/subscriptions", "organizations_url": "https://api.github.com/users/kryptan/orgs", "repos_url": "https://api.github.com/users/kryptan/repos", "events_url": "https://api.github.com/users/kryptan/events{/privacy}", "received_events_url": "https://api.github.com/users/kryptan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2017-01-17T21:36:52Z", "updated_at": "2022-10-16T20:34:59Z", "closed_at": "2022-10-16T20:34:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Automatically derived `Hash` for an `enum` marked as `repr(u8)` will hash 8 bytes when it is only necessary to hash just one. When hashing large value containing many such enums this will lead to 8x slower hashing than necessary.\r\n\r\nExample:\r\n\r\n```rust\r\nuse std::hash::{Hash, Hasher};\r\n\r\nstruct H;\r\n\r\nimpl Hasher for H {\r\n    fn finish(&self) -> u64 {\r\n        unreachable!()\r\n    }\r\n\r\n    fn write(&mut self, bytes: &[u8]) {\r\n        println!(\"{:?}\", bytes);\r\n    }\r\n}\r\n\r\n#[repr(u8)]\r\n#[derive(Hash)]\r\nenum E {\r\n    A,\r\n    B,\r\n}\r\n\r\nfn main() { \r\n    E::A.hash(&mut H);\r\n}\r\n```\r\n\r\nprints `[0, 0, 0, 0, 0, 0, 0, 0]` while I expected it to print `[0]` just like `0u8.hash(&mut H)`.\r\n\r\nThis behavior is the same on recent stable, beta and nightly (1.14, 1.15, 1.16).\r\n\r\n---\r\nEDIT: Added second variant to the enum. Previous example with single variant doesn't print anything anymore because of #42709.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39137/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39137/timeline", "performed_via_github_app": null, "state_reason": "completed"}