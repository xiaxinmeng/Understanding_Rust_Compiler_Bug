{"url": "https://api.github.com/repos/rust-lang/rust/issues/29067", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/29067/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/29067/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/29067/events", "html_url": "https://github.com/rust-lang/rust/issues/29067", "id": 111527377, "node_id": "MDU6SXNzdWUxMTE1MjczNzc=", "number": 29067, "title": "Allow pub access to underlying 'Read' member of Take or Chain", "user": {"login": "peter-bertok", "id": 14988123, "node_id": "MDQ6VXNlcjE0OTg4MTIz", "avatar_url": "https://avatars.githubusercontent.com/u/14988123?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bertok", "html_url": "https://github.com/peter-bertok", "followers_url": "https://api.github.com/users/peter-bertok/followers", "following_url": "https://api.github.com/users/peter-bertok/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bertok/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bertok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bertok/subscriptions", "organizations_url": "https://api.github.com/users/peter-bertok/orgs", "repos_url": "https://api.github.com/users/peter-bertok/repos", "events_url": "https://api.github.com/users/peter-bertok/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bertok/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-10-15T01:34:41Z", "updated_at": "2017-04-26T06:16:21Z", "closed_at": "2017-04-26T06:16:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I asked this as [a question on StackOverflow](http://stackoverflow.com/questions/33114619/access-to-components-of-a-read-wrapped-by-take-or-chain), and it was suggested that I raise an issue.\n\nI'm writing a Rust implementation of the Google Brotli decompression algorithm, which uses a fixed number of \"implicit zeroes\" at the end of the stream to enable certain optimisations.\n\nThe Google C implementation does this using a spaghetti code of various counters, but I'd like to use the adaptors in the Rust std::io library instead. Something like:\n\n``` rust\npub struct StreamBitReader<R> {\n    reader: Chain<R,Take<Repeat>>,\n    ...\n}\n```\n\nwhere 'R' is the underlying `Read` that the bit reader struct is wrapping. However, there are a number of cases where the decompression algorithm checks to see if it has \"overrun\" the stream, and it does this by checking the number of implicit zero bytes that have been read. This appears to be impossible in safe Rust, as there is no way to obtain a reference to the underlying components of `Chain`, unless I'm missing something.\n\nWhen `Chain` is constructed, it takes ownership of (moves) the two `Read` structs, which then are hidden in private members.\n\nIs there any way to construct the `Take<Repeat>` part such that I can continue to access the `limit()` fn of `Take` even after the `Chain` adaptor takes ownership?\n\nIf not, then there ought to be either public members or functions that allow access to the base Read members of all such adaptors, to allow this type of code.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/29067/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/29067/timeline", "performed_via_github_app": null, "state_reason": "completed"}