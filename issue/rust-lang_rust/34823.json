{"url": "https://api.github.com/repos/rust-lang/rust/issues/34823", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34823/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34823/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34823/events", "html_url": "https://github.com/rust-lang/rust/issues/34823", "id": 165608594, "node_id": "MDU6SXNzdWUxNjU2MDg1OTQ=", "number": 34823, "title": "Unexpected compiler panic with a static Vec", "user": {"login": "rco-ableton", "id": 11273197, "node_id": "MDQ6VXNlcjExMjczMTk3", "avatar_url": "https://avatars.githubusercontent.com/u/11273197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rco-ableton", "html_url": "https://github.com/rco-ableton", "followers_url": "https://api.github.com/users/rco-ableton/followers", "following_url": "https://api.github.com/users/rco-ableton/following{/other_user}", "gists_url": "https://api.github.com/users/rco-ableton/gists{/gist_id}", "starred_url": "https://api.github.com/users/rco-ableton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rco-ableton/subscriptions", "organizations_url": "https://api.github.com/users/rco-ableton/orgs", "repos_url": "https://api.github.com/users/rco-ableton/repos", "events_url": "https://api.github.com/users/rco-ableton/events{/privacy}", "received_events_url": "https://api.github.com/users/rco-ableton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-07-14T16:52:53Z", "updated_at": "2016-07-14T17:37:21Z", "closed_at": "2016-07-14T17:37:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\n\nDuring some attempts at figuring out how to maintain a `static` vector (something I'm still not sure is actually possible, except maybe via `lazy_static`?) through the lifetime of a program, I came across this compiler bug:\n\n```\n\u2192 RUST_BACKTRACE=1 cargo build\n   Compiling static_vec_test v0.1.0 (redacted)\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'index out of bounds: the len is 4 but the index is 6', src/libcollections/vec.rs:1166\nstack backtrace:\n   1:        0x107664cc8 - std::sys::backtrace::tracing::imp::write::h4c73fcd3363076f5\n   2:        0x107671115 - std::panicking::default_hook::_$u7b$$u7b$closure$u7d$$u7d$::h0422dbb3077e6747\n   3:        0x107670c4f - std::panicking::default_hook::haac48fa641db8fa2\n   4:        0x1076358a6 - std::sys_common::unwind::begin_unwind_inner::h39d40f52add53ef7\n   5:        0x1076379ae - std::sys_common::unwind::begin_unwind_fmt::h64c0ff793199cc1b\n   6:        0x1076624c7 - rust_begin_unwind\n   7:        0x1076a7730 - core::panicking::panic_fmt::h73bf9d7e8e891a73\n   8:        0x1076a7940 - core::panicking::panic_bounds_check::hc30e971884568c27\n   9:        0x106109779 - _<rustc_data_structures..unify..UnificationTable<K>>::get::he21ecf90e8e4f73a\n  10:        0x10609db34 - rustc::infer::InferCtxt::shallow_resolve::he47cdea6677f40d2\n  11:        0x106206e51 - rustc::traits::fulfill::process_predicate::h8bbef05b37cf149a\n  12:        0x106205c63 - _<rustc_data_structures..obligation_forest..ObligationForest<O, T>>::process_obligations::h824becaa5c013776\n  13:        0x1062012bc - rustc::traits::fulfill::FulfillmentContext::select_where_possible::hf3fc6484c301b5bb\n  14:        0x1039ab024 - rustc_typeck::check::FnCtxt::select_obligations_where_possible::h623b6ae6ad660b2d\n  15:        0x1039bd29c - rustc_typeck::check::FnCtxt::resolve_type_vars_if_possible::ha2a2b0468a33b7be\n  16:        0x1039d263a - rustc_typeck::check::demand::coerce::hd43013069440cf8a\n  17:        0x1039d39e2 - rustc_typeck::check::check_expr_with_expectation_and_lvalue_pref::h76666174c4b17386\n  18:        0x103a0af16 - rustc_typeck::check::check_stmt::h90d31dcbe73b93a2\n  19:        0x1039b0dc7 - rustc_typeck::check::check_block_with_expected::h17e4ec74708f2b9a\n  20:        0x1039d2e31 - rustc_typeck::check::check_expr_with_expectation_and_lvalue_pref::h76666174c4b17386\n  21:        0x1039b0f94 - rustc_typeck::check::check_block_with_expected::h17e4ec74708f2b9a\n  22:        0x1039a8408 - rustc_typeck::check::check_fn::hab7334b30b5aec4a\n  23:        0x1039a5ca7 - rustc_typeck::check::check_bare_fn::h85926feaf1e6659d\n  24:        0x1039a0b79 - rustc_typeck::check::check_item_body::h1895344155d5b2b2\n  25:        0x1039989fb - rustc_typeck::check::check_item_bodies::h525c1aa0e1abb529\n  26:        0x10399022b - rustc_typeck::check_crate::h0ef96f4043e1e69a\n  27:        0x103716e08 - rustc_driver::driver::phase_3_run_analysis_passes::_$u7b$$u7b$closure$u7d$$u7d$::hc699330eb6f2bc1e\n  28:        0x103715042 - rustc::ty::context::TyCtxt::create_and_enter::h656b2d3a4956519e\n  29:        0x10371198c - rustc_driver::driver::phase_3_run_analysis_passes::h83da042ec4b8ea10\n  30:        0x1036e5231 - rustc_driver::driver::compile_input::h6491aaddd9e61258\n  31:        0x1036cba4f - rustc_driver::run_compiler::h80b2ba5e4d787c5f\n  32:        0x1036c8de2 - std::sys_common::unwind::try::try_fn::h34e27823ddd1d5e9\n  33:        0x10766245b - __rust_try\n  34:        0x1076623e3 - std::sys_common::unwind::inner_try::h9eebd8dc83f388a6\n  35:        0x1036c9679 - _<F as std..boxed..FnBox<A>>::call_box::h3d5d78986dfac5b2\n  36:        0x10766ffe8 - std::sys::thread::Thread::new::thread_start::h471ad90789353b5b\n  37:     0x7fff98c3599c - _pthread_body\n  38:     0x7fff98c35919 - _pthread_start\n\nerror: Could not compile `static_vec_test`.\n```\n\nThe code sample that triggers it is the following (prepare your eye baths now):\n\n```\nstatic mut v: &'static Option<Vec<u32>> = &None;\n\nfn main() {\n    unsafe {\n        v = &mut Vec::new();\n\n        match v {\n            &None => println!(\"None\"),\n            &Some(ref vec) => println!(\"{:?}\", vec),\n        }\n    }   \n}\n```\n\nThe output of `rustic --verbose --version` is:\n\n```\nrustc 1.9.0\nbinary: rustc\ncommit-hash: unknown\ncommit-date: unknown\nhost: x86_64-apple-darwin\nrelease: 1.9.0\n```\n\nHope this is useful to you!\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34823/timeline", "performed_via_github_app": null, "state_reason": "completed"}