{"url": "https://api.github.com/repos/rust-lang/rust/issues/25346", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25346/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25346/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25346/events", "html_url": "https://github.com/rust-lang/rust/issues/25346", "id": 75715077, "node_id": "MDU6SXNzdWU3NTcxNTA3Nw==", "number": 25346, "title": "Multicast with multiple NICs", "user": {"login": "GGist", "id": 5248583, "node_id": "MDQ6VXNlcjUyNDg1ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/5248583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GGist", "html_url": "https://github.com/GGist", "followers_url": "https://api.github.com/users/GGist/followers", "following_url": "https://api.github.com/users/GGist/following{/other_user}", "gists_url": "https://api.github.com/users/GGist/gists{/gist_id}", "starred_url": "https://api.github.com/users/GGist/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GGist/subscriptions", "organizations_url": "https://api.github.com/users/GGist/orgs", "repos_url": "https://api.github.com/users/GGist/repos", "events_url": "https://api.github.com/users/GGist/events{/privacy}", "received_events_url": "https://api.github.com/users/GGist/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-05-12T19:44:18Z", "updated_at": "2015-05-13T03:50:56Z", "closed_at": "2015-05-12T22:24:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am having some issues using UdpSockets to listen on multiple network interfaces for multicast messages. It seems that when I spin up two UdpSockets, one bound to the Local Area Connection and the other to Hamachi, and I subscribe to a specific multicast address on both sockets, only one of them (usually the default interface) will ever receive multicast messages during an execution of the program.\n\nI [coded up a quick C solution](https://gist.github.com/GGist/99f33cdf3e281afd81ad#file-receiver-c-L32-L57) and I was able to get my application working (I am using Windows so minor modifications should allow it to run on Linux).\n\nI noticed in the [libstd crate](https://github.com/rust-lang/rust/blob/master/src/libstd/sys/common/net.rs#L448) that for all UdpSockets it looks like the multicast interface is set as 0x0, aka, 0.0.0.0. As far as I know, in [Windows this tells the operating system to subscribe to multicast on the default interface](https://msdn.microsoft.com/en-us/library/windows/desktop/ms738695%28v=vs.85%29.aspx). And it looks like a [similar situation on linux](http://man7.org/linux/man-pages/man7/ip.7.html) (under IP_ADD_MEMBERSHIP). Although on Linux it uses the wording \"an appropriate interface is chosen by the system\" which may not mean the default interface but I am not sure.\n\nI know I read in a previous issue that the current sockets API was going to be revamped to allow greater flexibility for socket creation options, but to me it looks like the current implementation is possibly broken. For example, when I was doing some tests I noticed, again at least on Windows, that if I bind to a local interface that is not set as the default interface in the system and join multicast, I wont receive multicast at all from that socket.\n\nUnless it is a different situation in Linux, I think it would make a lot more sense to use the address bound to the UdpSocket as the interface in the ip_mreq struct instead of 0x0. Also, when/if the sockets API is revamped, it would be nice if I could bind to 0.0.0.0 and choose which interfaces I receive multicast from (like I did in my example) so I can use one socket for multiple receiving interfaces.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25346/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25346/timeline", "performed_via_github_app": null, "state_reason": "completed"}