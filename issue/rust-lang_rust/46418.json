{"url": "https://api.github.com/repos/rust-lang/rust/issues/46418", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46418/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46418/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46418/events", "html_url": "https://github.com/rust-lang/rust/issues/46418", "id": 278389378, "node_id": "MDU6SXNzdWUyNzgzODkzNzg=", "number": 46418, "title": "Library path issues on fedora cross compiling for windows", "user": {"login": "ssendev", "id": 450793, "node_id": "MDQ6VXNlcjQ1MDc5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/450793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssendev", "html_url": "https://github.com/ssendev", "followers_url": "https://api.github.com/users/ssendev/followers", "following_url": "https://api.github.com/users/ssendev/following{/other_user}", "gists_url": "https://api.github.com/users/ssendev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssendev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssendev/subscriptions", "organizations_url": "https://api.github.com/users/ssendev/orgs", "repos_url": "https://api.github.com/users/ssendev/repos", "events_url": "https://api.github.com/users/ssendev/events{/privacy}", "received_events_url": "https://api.github.com/users/ssendev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}, {"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-12-01T08:16:38Z", "updated_at": "2018-11-30T14:40:19Z", "closed_at": "2018-01-24T13:01:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Trying to compile `Hello, world!` on fedora results in\r\n\r\n```\r\nerror: linking with `x86_64-w64-mingw32-gcc` failed: exit code: 1\r\n  |\r\n  = note: \"x86_64-w64-mingw32-gcc\" \"-Wl,--enable-long-section-names\" \"-fno-use-linker-plugin\" \"-Wl,--nxcompat\" \"-nostdlib\" \"-m64\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/crt2.o\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/rsbegin.o\" \"-L\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver0.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver1.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver10.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver11.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver12.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver13.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver14.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver15.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver2.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver3.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver4.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver5.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver6.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver7.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver8.rust-cgu.o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.printserver9.rust-cgu.o\" \"-o\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.exe\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/printserver-4c9c9553ae081d85.crate.allocator.rust-cgu.o\" \"-Wl,--gc-sections\" \"-nodefaultlibs\" \"-L\" \"/app/target/x86_64-pc-windows-gnu/debug/deps\" \"-L\" \"/app/target/debug/deps\" \"-L\" \"/home/rust/.cargo/git/checkouts/winapi-rs-a54263a8eb5d0916/70e1da8/x86_64/lib\" \"-L\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib\" \"-Wl,-Bstatic\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libstd-60d4a252bdda9250.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/liballoc_system-a05404e5e059417a.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/librand-81cbf6f1d5a19206.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libpanic_unwind-0b63e20460046692.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/liballoc-f824a78e715239af.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libstd_unicode-2abaea46f194a6e1.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libunwind-7daa32005d584d8a.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/liblibc-49ff25caaa6e945f.rlib\" \"/app/target/x86_64-pc-windows-gnu/debug/deps/libwinapi-e1e9b0b9a817ecee.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libcore-f2bd2d524c6ace24.rlib\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/libcompiler_builtins-c6139fac5e899293.rlib\" \"-Wl,-Bdynamic\" \"-l\" \"advapi32\" \"-l\" \"ws2_32\" \"-l\" \"userenv\" \"-l\" \"shell32\" \"-Wl,-Bstatic\" \"-l\" \"gcc_eh\" \"-l\" \"pthread\" \"-Wl,-Bdynamic\" \"-l\" \"winspool\" \"-l\" \"user32\" \"-l\" \"kernel32\" \"-l\" \"msimg32\" \"-l\" \"opengl32\" \"-l\" \"gdi32\" \"-lmingwex\" \"-lmingw32\" \"-lgcc\" \"-lmsvcrt\" \"-luser32\" \"-lkernel32\" \"/home/rust/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-pc-windows-gnu/lib/rsend.o\"\r\n  = note: /usr/lib/gcc/x86_64-w64-mingw32/7.2.0/../../../../x86_64-w64-mingw32/bin/ld: cannot find -lpthread\r\n          collect2: error: ld returned 1 exit status\r\n```\r\n\r\nMy guess is that's related to the path on ubuntu being `/usr/x86_64-w64-mingw32/lib/libpthread.a` while on fedora it's `/usr/x86_64-w64-mingw32/sys-root/mingw/lib/libpthread.a` although running `RUSTFLAGS=\"-L /usr/x86_64-w64-mingw32/sys-root/mingw/lib\" cargo build` (i also tried all subpaths) did not help either\r\n\r\nHere is my test setup:\r\n\r\n```dockerfile\r\nFROM ubuntu\r\n\r\nRUN apt-get update && apt-get install -y \\\r\n    vim \\\r\n    curl \\\r\n    gcc \\\r\n    gcc-mingw-w64-x86-64 \\\r\n    && apt-get clean && rm -rf /var/lib/apt/lists/*\r\n\r\nWORKDIR /app\r\nENV HOME=/home/rust\r\nRUN groupadd -r -g 1000 rust \\\r\n    && useradd --no-log-init -r -g rust -u 1000 rust \\\r\n    && mkdir -p $HOME \\\r\n    && chown rust:rust $WORKDIR $HOME\r\nUSER rust\r\nRUN curl https://sh.rustup.rs -sSf | sh -s -- -y\r\nENV PATH=\"$HOME/.cargo/bin:$PATH\"\r\nRUN rustup target add x86_64-pc-windows-gnu\r\nRUN echo >>~/.cargo/config '[build]\\ntarget = \"x86_64-pc-windows-gnu\"\\n\\n[target.x86_64-pc-windows-gnu]\\nlinker = \"x86_64-w64-mingw32-gcc\"\\nar = \"x86_64-w64-mingw32-gcc-ar\"'\r\n```\r\n\r\n```dockerfile\r\nFROM fedora\r\n\r\nRUN dnf install -y \\\r\n    vim \\\r\n    gcc \\\r\n    mingw64-gcc \\\r\n  && dnf clean all\r\n\r\nWORKDIR /app\r\nENV HOME=/home/rust\r\nRUN groupadd -r -g 1000 rust \\\r\n    && useradd --no-log-init -r -g rust -u 1000 rust \\\r\n    && mkdir -p $HOME \\\r\n    && chown rust:rust $WORKDIR $HOME\r\nUSER rust\r\nRUN curl https://sh.rustup.rs -sSf | sh -s -- -y\r\nENV PATH=\"$HOME/.cargo/bin:$PATH\"\r\nRUN rustup target add x86_64-pc-windows-gnu\r\nRUN echo -e >>~/.cargo/config '[build]\\ntarget = \"x86_64-pc-windows-gnu\"\\n\\n[target.x86_64-pc-windows-gnu]\\nlinker = \"x86_64-w64-mingw32-gcc\"\\nar = \"x86_64-w64-mingw32-gcc-ar\"'\r\n```\r\n\r\n```shell\r\nmkdir test\r\ncd test\r\nclippaste >Dockerfile # put above snippet in Dockerfile\r\ndocker build -t rust-test .\r\ndocker run --rm -it rust-test bash\r\nUSER=a cargo init --bin\r\ncargo build # works with ubuntu but fails with fedora\r\n```\r\n\r\nI originally filed this here https://github.com/retep998/winapi-rs/issues/527 because i thought it only happened when i added the winapi crate.\r\n\r\nI found these similar issues https://github.com/rust-lang/rust/issues/32859 https://github.com/rust-lang/rust/issues/33465 https://github.com/rust-lang/rust/issues/44787 but they seem not to be the same.", "closed_by": {"login": "ssendev", "id": 450793, "node_id": "MDQ6VXNlcjQ1MDc5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/450793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssendev", "html_url": "https://github.com/ssendev", "followers_url": "https://api.github.com/users/ssendev/followers", "following_url": "https://api.github.com/users/ssendev/following{/other_user}", "gists_url": "https://api.github.com/users/ssendev/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssendev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssendev/subscriptions", "organizations_url": "https://api.github.com/users/ssendev/orgs", "repos_url": "https://api.github.com/users/ssendev/repos", "events_url": "https://api.github.com/users/ssendev/events{/privacy}", "received_events_url": "https://api.github.com/users/ssendev/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46418/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46418/timeline", "performed_via_github_app": null, "state_reason": "completed"}