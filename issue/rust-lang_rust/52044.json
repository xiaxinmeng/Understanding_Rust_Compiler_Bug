{"url": "https://api.github.com/repos/rust-lang/rust/issues/52044", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52044/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52044/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52044/events", "html_url": "https://github.com/rust-lang/rust/issues/52044", "id": 338097310, "node_id": "MDU6SXNzdWUzMzgwOTczMTA=", "number": 52044, "title": "panic code is not deterministically lto'ed", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 34, "created_at": "2018-07-04T00:56:40Z", "updated_at": "2018-07-13T02:21:41Z", "closed_at": "2018-07-12T06:29:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is something I noticed when comparing two builds of Firefox on automation. Both builds were done with the same flags, same toolchains, same paths, same everything. Without any sort of caching. And yet, they differed in exactly one way: the contents of `std::panicking::default_hook`.\r\n\r\nSee https://taskcluster-artifacts.net/IWpRV77rTgmt-9RKwTzJiA/0/public/diff.html\r\n\r\nI tried multiple times, and there seems to be only two variants of the generated code, and that's the only code, in all of what's generated by rust in Firefox build, that differs.\r\n\r\nIt turns out this is reproducible at a much smaller scale:\r\n```\r\n$ mkdir -p foo/src; cd foo\r\n$ cat > Cargo.toml <<EOF\r\n[package]\r\nname = \"foo\"\r\nversion = \"0.1.0\"\r\n\r\n[lib]\r\ncrate-type = [\"staticlib\"]\r\n\r\n[profile.release]\r\nopt-level = 2\r\nrpath = false\r\ndebug-assertions = false\r\npanic = \"abort\"\r\ncodegen-units = 1\r\nlto = true\r\nEOF\r\n$ cat > src/lib.rs <<EOF\r\n#[no_mangle]\r\npub extern \"C\" fn foo() {\r\n    panic!(\"foo\");\r\n}\r\nEOF\r\n$ cargo build --release\r\n$ mv target/release/libfoo.a .\r\n$ rm -rf target\r\n$ cargo build --release\r\n$ diff target/release/libfoo.a .\r\nBinary files target/release/libfoo.a and ./libfoo.a differ\r\n```\r\n\r\nIt can take a few attempts repeating the last three commands before differences show up, because there are only two variants, and you may end up getting the same variant multiple times in a row.\r\n\r\nCc: @alexcrichton @nikomatsakis ", "closed_by": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52044/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52044/timeline", "performed_via_github_app": null, "state_reason": "completed"}