{"url": "https://api.github.com/repos/rust-lang/rust/issues/110136", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110136/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110136/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110136/events", "html_url": "https://github.com/rust-lang/rust/issues/110136", "id": 1660391678, "node_id": "I_kwDOAAsO6M5i95D-", "number": 110136, "title": "Unable to resolve HRTB/GAT lifetimes trait bounds", "user": {"login": "StefanUlbrich", "id": 6009224, "node_id": "MDQ6VXNlcjYwMDkyMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6009224?v=4", "gravatar_id": "", "url": "https://api.github.com/users/StefanUlbrich", "html_url": "https://github.com/StefanUlbrich", "followers_url": "https://api.github.com/users/StefanUlbrich/followers", "following_url": "https://api.github.com/users/StefanUlbrich/following{/other_user}", "gists_url": "https://api.github.com/users/StefanUlbrich/gists{/gist_id}", "starred_url": "https://api.github.com/users/StefanUlbrich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/StefanUlbrich/subscriptions", "organizations_url": "https://api.github.com/users/StefanUlbrich/orgs", "repos_url": "https://api.github.com/users/StefanUlbrich/repos", "events_url": "https://api.github.com/users/StefanUlbrich/events{/privacy}", "received_events_url": "https://api.github.com/users/StefanUlbrich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-04-10T07:48:28Z", "updated_at": "2023-04-10T07:48:28Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\ntrait Trait {\r\n    // Trait with a 'normal' type and a GAT\r\n    type gat<'a>;\r\n    type normal;\r\n}\r\n\r\n// Struct A and B define the same types\r\n\r\nstruct StructA;\r\nimpl Trait for StructA {\r\n    type gat<'a> = ArrayView2<'a, f64>;\r\n    type normal = Array2<f64>;\r\n}\r\n\r\nstruct StructB;\r\nimpl Trait for StructB {\r\n    type gat<'a> = ArrayView2<'a, f64>;\r\n    type normal = Array2<f64>;\r\n}\r\n\r\nstruct C<S, T>\r\nwhere\r\n    S: for<'a> Trait<gat<'a> = T::gat<'a>, normal = T::normal>,\r\n    T: Trait,\r\n{\r\n    a: S,\r\n    b: T,\r\n}\r\n\r\nfn test() {\r\n    C {\r\n        a: StructA {},\r\n        b: StructB {},\r\n    };\r\n}\r\n```\r\n\r\nI expected that this should compile fine.\r\n\r\nInstead, I get a compiler error, which is not helpful (well, to a beginner like me at least)\r\n\r\n```\r\nerror[E0271]: type mismatch resolving `for<'a> <StructA as Trait>::gat<'a> == <_ as Trait>::gat<'a>`\r\n  --> src/main.rs:51:12\r\n   |\r\n51 |         a: StructA {},\r\n   |            ^^^^^^^^^^ type mismatch resolving `for<'a> <StructA as Trait>::gat<'a> == <_ as Trait>::gat<'a>`\r\n   |\r\nnote: expected this to be `<_ as Trait>::gat<'_>`\r\n  --> src/main.rs:30:20\r\n   |\r\n30 |     type gat<'a> = ArrayView2<'a, f64>;\r\n   |                    ^^^^^^^^^^^^^^^^^^^\r\n   = note: expected associated type `<_ as Trait>::gat<'_>`\r\n                       found struct `ndarray::ArrayBase<ndarray::ViewRepr<&f64>, ndarray::Dim<[usize; 2]>>`\r\n   = help: consider constraining the associated type `<_ as Trait>::gat<'_>` to `ndarray::ArrayBase<ndarray::ViewRepr<&f64>, ndarray::Dim<[usize; 2]>>` or calling a method that returns `<_ as Trait>::gat<'_>`\r\n   = note: for more information, visit https://doc.rust-lang.org/book/ch19-03-advanced-traits.html\r\nnote: required by a bound in `C`\r\n  --> src/main.rs:42:22\r\n   |\r\n40 | struct C<S, T>\r\n   |        - required by a bound in this\r\n41 | where\r\n42 |     S: for<'a> Trait<gat<'a> = T::gat<'a>, normal = T::normal>,\r\n   |                      ^^^^^^^^^^^^^^^^^^^^ required by this bound in `C`\r\n```\r\n\r\nThe amazing community already provided me with workarounds [here](https://users.rust-lang.org/t/hrtb-and-gat-lifetimes-in-trait-bounds/92249), but recommended filing an issue\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.68.2 (9eb3afe9e 2023-03-27)\r\nbinary: rustc\r\ncommit-hash: 9eb3afe9ebe9c7d2b84b71002d44f4a0edac95e0\r\ncommit-date: 2023-03-27\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.68.2\r\nLLVM version: 15.0.6\r\n```\r\n\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110136/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110136/timeline", "performed_via_github_app": null, "state_reason": null}