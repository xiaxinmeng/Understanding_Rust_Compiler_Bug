{"url": "https://api.github.com/repos/rust-lang/rust/issues/16848", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/16848/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/16848/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/16848/events", "html_url": "https://github.com/rust-lang/rust/issues/16848", "id": 41504094, "node_id": "MDU6SXNzdWU0MTUwNDA5NA==", "number": 16848, "title": "Compiler error \"trying to take the sizing type of str, an unsized type\"", "user": {"login": "ollie", "id": 53026, "node_id": "MDQ6VXNlcjUzMDI2", "avatar_url": "https://avatars.githubusercontent.com/u/53026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ollie", "html_url": "https://github.com/ollie", "followers_url": "https://api.github.com/users/ollie/followers", "following_url": "https://api.github.com/users/ollie/following{/other_user}", "gists_url": "https://api.github.com/users/ollie/gists{/gist_id}", "starred_url": "https://api.github.com/users/ollie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ollie/subscriptions", "organizations_url": "https://api.github.com/users/ollie/orgs", "repos_url": "https://api.github.com/users/ollie/repos", "events_url": "https://api.github.com/users/ollie/events{/privacy}", "received_events_url": "https://api.github.com/users/ollie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2014-08-29T14:10:36Z", "updated_at": "2014-09-17T20:08:47Z", "closed_at": "2014-09-17T06:56:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\n\nI don't know if this is related to https://github.com/rust-lang/rust/issues/16822 or not. I was following the example here http://doc.rust-lang.org/getopts/ and wanted to tweak it so the `program` is only the filename, not the whole path to it. So I started hacking around and extracted it into a function, which resulted into this error.\n\nI'm new to Rust, so\u2026 I'm doing silly things probably. :) Feel free to tell me.\nAnyway this is not the \"getopts\" code, I wanted to isolate the problem. I also made the types explicit for illustration.\n\n``` rust\nfn main() {\n    let filename: &str = &filename_of_foo();\n    // `filename` should be &\"foo\"\n    println!(\"The filename is {}\", filename);\n}\n\nfn filename_of_foo() -> str {\n    let path: Path     = Path::new(\"./bar/foo\");\n    let filename: &str = path.filename_str().unwrap();\n    *filename\n}\n```\n\n```\n$ RUST_BACKTRACE=1 rustc main.rs\nerror: internal compiler error: trying to take the sizing type of str, an unsized type\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /Users/olda/Code/rust/rust-lang/src/libsyntax/ast_util.rs:776\n\nstack backtrace:\n   1:        0x10e7ea9b5 - rt::backtrace::imp::write::hbe93ad1ca3375f7ai9q\n   2:        0x10e7edd33 - failure::on_fail::ha008d924473a588cbqr\n   3:        0x10eab3d23 - unwind::begin_unwind_inner::h53af0f566031f9f14fe\n   4:        0x10c7b643a - unwind::begin_unwind::h3612296561932415380\n   5:        0x10c7b6e40 - diagnostic::Handler::bug::h6cd4a0f0829e2050shF\n   6:        0x10b3a5c58 - driver::session::Session::bug::hba3620fae1af216dkXz\n   7:        0x10b75c121 - middle::trans::type_of::sizing_type_of::h7963730f82cd4b33Ma9\n   8:        0x10b78aeac - middle::trans::expr::trans_unadjusted::he74a35bd5ea421c1Fh3\n   9:        0x10b748380 - middle::trans::expr::trans::hd79efa6056358d2dEw2\n  10:        0x10b798ca1 - middle::trans::expr::trans_addr_of::hff42e1cdb8b6828bfI4\n  11:        0x10b78b4f8 - middle::trans::expr::trans_unadjusted::he74a35bd5ea421c1Fh3\n  12:        0x10b748380 - middle::trans::expr::trans::hd79efa6056358d2dEw2\n  13:        0x10b746b48 - middle::trans::expr::trans_into::h4adfb7ed4c8e4c8eIs2\n  14:        0x10b82a54f - middle::trans::_match::store_local::closure.119296\n  15:        0x10b82a321 - middle::trans::_match::mk_binding_alloca::h11723812663586266914\n  16:        0x10b7f2233 - middle::trans::_match::store_local::h15ef2e60d6b94e5cA2h\n  17:        0x10b7463b2 - middle::trans::base::init_local::hf1089f76e4fd41bdWFd\n  18:        0x10b7458ea - middle::trans::controlflow::trans_stmt::h2ab88f6dc40905eblhY\n  19:        0x10b74701c - middle::trans::controlflow::trans_block::hee6f69106b0dfacewmY\n  20:        0x10b7fd0e2 - middle::trans::base::trans_closure::h9bdf3049defa1b73vye\n  21:        0x10b7382a0 - middle::trans::base::trans_fn::hf0c57f353c923cd3iKe\n  22:        0x10b73361f - middle::trans::base::trans_item::hbe3f225a458737f5i2e\n  23:        0x10b8060bc - middle::trans::base::trans_crate::h430604ba8b62ae67JWf\n  24:        0x10bbc0811 - driver::driver::phase_4_translate_to_llvm::h3758d3df9e2a7401pzy\n  25:        0x10bbb9d3d - driver::driver::compile_input::hf84c86c09fa7f085Qby\n  26:        0x10bc43dc7 - driver::run_compiler::hd0616be9c11c6733JIB\n  27:        0x10bc42506 - driver::main_args::closure.138223\n  28:        0x10bc53dbb - task::TaskBuilder<S>::try_future::closure.139341\n  29:        0x10bc53cc3 - task::TaskBuilder<S>::spawn_internal::closure.139318\n  30:        0x10e71e2ec - task::spawn_opts::closure.8459\n  31:        0x10eb18b0c - rust_try_inner\n  32:        0x10eb18af6 - rust_try\n  33:        0x10eab1177 - unwind::try::h5bbc3fdef4df0c47k4d\n  34:        0x10eab0f3b - task::Task::run::h3fd23eb8e2343898bbd\n  35:        0x10e71e132 - task::spawn_opts::closure.8404\n  36:        0x10eab2cb6 - thread::thread_start::hb6d4d41faea4249bXzd\n  37:     0x7fff8ce03899 - _pthread_body\n  38:     0x7fff8ce0372a - _pthread_struct_init\n```\n\nMy system:\nOS X 10.9.4\n\n```\n$ uname -v\nDarwin Kernel Version 13.3.0: Tue Jun  3 21:27:35 PDT 2014; root:xnu-2422.110.17~1/RELEASE_X86_64\n$ rustc --version\nrustc 0.12.0-pre (0d3bd7720 2014-08-27 21:31:13 +0000)\n$ cargo --version\ncargo 0.0.1-pre (89259f1 2014-08-28 18:28:57 +0000)\n```\n\nThanks,\nOllie\n", "closed_by": {"login": "ollie", "id": 53026, "node_id": "MDQ6VXNlcjUzMDI2", "avatar_url": "https://avatars.githubusercontent.com/u/53026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ollie", "html_url": "https://github.com/ollie", "followers_url": "https://api.github.com/users/ollie/followers", "following_url": "https://api.github.com/users/ollie/following{/other_user}", "gists_url": "https://api.github.com/users/ollie/gists{/gist_id}", "starred_url": "https://api.github.com/users/ollie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ollie/subscriptions", "organizations_url": "https://api.github.com/users/ollie/orgs", "repos_url": "https://api.github.com/users/ollie/repos", "events_url": "https://api.github.com/users/ollie/events{/privacy}", "received_events_url": "https://api.github.com/users/ollie/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/16848/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/16848/timeline", "performed_via_github_app": null, "state_reason": "completed"}