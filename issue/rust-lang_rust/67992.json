{"url": "https://api.github.com/repos/rust-lang/rust/issues/67992", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67992/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67992/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67992/events", "html_url": "https://github.com/rust-lang/rust/issues/67992", "id": 546574833, "node_id": "MDU6SXNzdWU1NDY1NzQ4MzM=", "number": 67992, "title": "bad location list debug info", "user": {"login": "xdje42", "id": 5886382, "node_id": "MDQ6VXNlcjU4ODYzODI=", "avatar_url": "https://avatars.githubusercontent.com/u/5886382?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xdje42", "html_url": "https://github.com/xdje42", "followers_url": "https://api.github.com/users/xdje42/followers", "following_url": "https://api.github.com/users/xdje42/following{/other_user}", "gists_url": "https://api.github.com/users/xdje42/gists{/gist_id}", "starred_url": "https://api.github.com/users/xdje42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xdje42/subscriptions", "organizations_url": "https://api.github.com/users/xdje42/orgs", "repos_url": "https://api.github.com/users/xdje42/repos", "events_url": "https://api.github.com/users/xdje42/events{/privacy}", "received_events_url": "https://api.github.com/users/xdje42/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-01-08T00:14:48Z", "updated_at": "2020-08-16T21:16:19Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Compiling this program produces bad debug info in the location list entry for argument \"a\" of function \"foo\". GDB crashes on it, which is GDB's problem (https://sourceware.org/bugzilla/show_bug.cgi?id=25353), but Rust should also not generate bad debug info.\r\n\r\n```rust\r\nconst ARRAY_SIZE: usize = 1024;\r\n\r\nstruct Foo {\r\n    x: [u64; ARRAY_SIZE],\r\n}\r\n\r\nfn foo(a: Foo, i: usize) -> u64 {\r\n    a.x[i]\r\n}\r\n\r\nfn main() {\r\n    println!(\"Hello, world!\");\r\n\r\n    println!(\"{}\", foo(Foo{x: [0; ARRAY_SIZE]}, 42));\r\n}\r\n```\r\n\r\n```\r\nbash$ cargo build\r\nbash$ readelf -w target/debug/location-lists\r\n-->\r\n <2><cb0>: Abbrev Number: 3 (DW_TAG_subprogram)\r\n...\r\n    <cc3>   DW_AT_name        : (indirect string, offset: 0x7cb): foo\r\n...\r\n <3><ccd>: Abbrev Number: 4 (DW_TAG_formal_parameter)\r\n    <cce>   DW_AT_location    : 0x0 (location list)\r\n    <cd2>   DW_AT_name        : (indirect string, offset: 0x85bf2): a\r\n    <cd6>   DW_AT_decl_file   : 1\r\n    <cd7>   DW_AT_decl_line   : 7\r\n    <cd8>   DW_AT_type        : <0xd24>\r\n...\r\nContents of the .debug_loc section:\r\n\r\n    Offset   Begin            End              Expression\r\n    00000000 0000000000004469 000000000000447f (DW_OP_breg5 (rdi): 0)\r\n    00000014 000000000000447f 0000000000004490 (DW_OP_breg7 (rsp): 8; DW_OP_deref)\r\n    00000029 0000000000004490 0000000000004499 (DW_OP_reg2 (rcx))\r\n    0000003c 0000000000004499 00000000000044b0 (DW_OP_breg7 (rsp): 8; DW_OP_deref)\r\n    00000051 00000000000044b0 00000000000044b2 (DW_OP_reg4 (rsi))\r\n    00000064 <End of list>\r\n```\r\nNote the entries saying \"a\" lives in rcx and rsi (that is the value of \"a\" lives in the register, not its address).\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67992/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67992/timeline", "performed_via_github_app": null, "state_reason": null}