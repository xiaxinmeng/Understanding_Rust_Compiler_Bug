{"url": "https://api.github.com/repos/rust-lang/rust/issues/18275", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18275/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18275/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18275/events", "html_url": "https://github.com/rust-lang/rust/issues/18275", "id": 46738838, "node_id": "MDU6SXNzdWU0NjczODgzOA==", "number": 18275, "title": "ICE from syntax codemap for particular line counts, perhaps intertwined with macro expansion", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2014-10-24T13:33:58Z", "updated_at": "2014-10-24T16:01:10Z", "closed_at": "2014-10-24T15:59:50Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I was hitting an ICE from the snapshot compiler while trying to build `rustc`.  That's never fun, especially when it cannot provide very clear source location information.\n\nHere is my reduced test case:\n\n``` rust\n// Very\n\n// sensitive\npub struct BytePos(pub u32);\n\n// to particular\n\n// line numberings / offsets\n\nfn main() {\n    let x = BytePos(1);\n\n    assert!(x, x);\n}\n```\n\nplaypen link: http://is.gd/fmyjCb\n\nNow, once you have the test reduced to something this small, its clear what the problem in the above code actually is (namely, we are passing a non-boolean expression that is not overloaded on the `!`-operator as the first argument to `assert!`).  But the issue is that this causes an ICE in a particularly nasty fashion.\n\nRunning the above yields (in both the playpen and my laptop):\n\n```\n<std macros>:8:12: 13:14 error: cannot apply unary operator `!` to type `BytePos`\n<std macros>:8         if !$cond {\n<std macros>:9             fail!($($arg),+)\n<std macros>:10         }\n<std macros>:11     );\n<std macros>:12 )\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'index out of bounds: the len is 12 but the index is 12', /build/rust-git/src/rust/src/libsyntax/lib.rs:1\n```\n\nUnfortunately, as the test says, the test is very sensitive to particular choices for where the erroneous lines happen to fall.  So it would be good for someone to investigate this at some point against _this_ version of `rustc` (i'm running `rustc 0.13.0-dev (e8cc3f26e 2014-10-21 08:22:09 +0000)`; I don't know how to find what the playpen is using); if we simply wait a few versions and then re-test, this particular test may start succeeding but a nearby variant may still (or start to) fail.\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18275/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18275/timeline", "performed_via_github_app": null, "state_reason": "completed"}