{"url": "https://api.github.com/repos/rust-lang/rust/issues/42791", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42791/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42791/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42791/events", "html_url": "https://github.com/rust-lang/rust/issues/42791", "id": 237443023, "node_id": "MDU6SXNzdWUyMzc0NDMwMjM=", "number": 42791, "title": "std::Command::new fails for some CMD scripts on Windows 10 msvc nightly 1.19/1.20", "user": {"login": "budziq", "id": 221000, "node_id": "MDQ6VXNlcjIyMTAwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/221000?v=4", "gravatar_id": "", "url": "https://api.github.com/users/budziq", "html_url": "https://github.com/budziq", "followers_url": "https://api.github.com/users/budziq/followers", "following_url": "https://api.github.com/users/budziq/following{/other_user}", "gists_url": "https://api.github.com/users/budziq/gists{/gist_id}", "starred_url": "https://api.github.com/users/budziq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/budziq/subscriptions", "organizations_url": "https://api.github.com/users/budziq/orgs", "repos_url": "https://api.github.com/users/budziq/repos", "events_url": "https://api.github.com/users/budziq/events{/privacy}", "received_events_url": "https://api.github.com/users/budziq/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 21, "created_at": "2017-06-21T07:45:43Z", "updated_at": "2017-08-04T13:07:26Z", "closed_at": "2017-08-04T09:42:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "While working on [mdbook build.rs issue](https://github.com/azerupi/mdBook/issues/342) I've discovered that on nightly the std::Command::new() for a windows 10 batch script \"npm.cmd\" results in underlying node-js process to not find required resource paths.\r\n\r\nI tried this code:\r\n```rust\r\nuse std::process::Command;\r\n\r\nfn main() {\r\n    let status = Command::new(\"npm.cmd\")\r\n        .arg(\"-v\")\r\n        .output();\r\n\r\n    println!(\"Command exited with '{:?}'\", status);\r\n    let status = status.expect(\"Process spawn should succeed!\");\r\n    if !status.status.success() {\r\n        panic!(\"Command failed!\");\r\n    }\r\n}\r\n```\r\nI expected to see this happen:\r\nThis works on all channels for my linux and windows 7 boxes (did not test other than msvc here) as well as stable and beta for windows 10 box (and appveyor)\r\n```\r\nCommand exited with 'Ok(Output { status: ExitStatus(ExitStatus(0)), stdout: \"3.10.10\\n\", stderr: \"\" })'\r\n```\r\nInstead, this happened only on windows 10 (and appveyor) msvc nightly: \r\n```\r\nCommand exited with 'Ok(Output { status: ExitStatus(ExitStatus(1)), stdout: \"\", stderr: \"module.js:471\\r\\n    throw err;\\r\\n    ^\\r\\n\\r\\nError: Cannot find module \\'C:\\\\projects\\\\nightly-cmd-fail\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\\'\\r\\n    at Function.Module._resolveFilename (module.js:469:15)\\r\\n    at Function.Module._load (module.js:417:25)\\r\\n    at Module.runMain (module.js:604:10)\\r\\n    at run (bootstrap_node.js:389:7)\\r\\n    at startup (bootstrap_node.js:149:9)\\r\\n    at bootstrap_node.js:504:3\\r\\nmodule.js:471\\r\\n    throw err;\\r\\n    ^\\r\\n\\r\\nError: Cannot find module \\'C:\\\\projects\\\\nightly-cmd-fail\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\\'\\r\\n    at Function.Module._resolveFilename (module.js:469:15)\\r\\n    at Function.Module._load (module.js:417:25)\\r\\n    at Module.runMain (module.js:604:10)\\r\\n    at run (bootstrap_node.js:389:7)\\r\\n    at startup (bootstrap_node.js:149:9)\\r\\n    at bootstrap_node.js:504:3\\r\\n\" })'\r\nthread 'main' panicked at 'Command failed!', main.rs:11\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n```\r\nPlease note that the panic is explicitly triggered in main.rs to make appveyor report the error. \r\n\r\nThe [npm.cmd](https://github.com/nodejs/node/blob/a4444c546211cac0f5efba8b03a681546e3e184f/deps/npm/bin/npm.cmd) sets paths for node-js via environmental variables and these seem not to be forwarded properly.\r\n\r\nSorry for mostly useless description as I have no experience with npm/node and no access to the actual win10 box on which the problem was reproduced (I was only able to locate this problem via appveor logs).\r\n\r\n## Meta\r\n```\r\nrustc --version --verbose\r\nrustc 1.20.0-nightly (445077963 2017-06-20)\r\nbinary: rustc\r\ncommit-hash: 445077963c55297ef1e196a3525723090fe80b22\r\ncommit-date: 2017-06-20\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.20.0-nightly\r\nLLVM version: 4.0\r\n```\r\nBut the problem exists at least since (sorry no verbose output here. I have no access to that win10 box anymore)\r\n`rustc 1.19.0-nightly (04145943a 2017-06-19)`\r\n\r\nLink to appveyor showing the problem:\r\nhttps://ci.appveyor.com/project/budziq/nightly-cmd-fail/build/1.0.10", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42791/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42791/timeline", "performed_via_github_app": null, "state_reason": "completed"}