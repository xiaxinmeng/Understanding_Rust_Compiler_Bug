{"url": "https://api.github.com/repos/rust-lang/rust/issues/63026", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63026/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63026/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63026/events", "html_url": "https://github.com/rust-lang/rust/issues/63026", "id": 473561840, "node_id": "MDU6SXNzdWU0NzM1NjE4NDA=", "number": 63026, "title": "ICE: local variable without a name", "user": {"login": "khernyo", "id": 447532, "node_id": "MDQ6VXNlcjQ0NzUzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/447532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khernyo", "html_url": "https://github.com/khernyo", "followers_url": "https://api.github.com/users/khernyo/followers", "following_url": "https://api.github.com/users/khernyo/following{/other_user}", "gists_url": "https://api.github.com/users/khernyo/gists{/gist_id}", "starred_url": "https://api.github.com/users/khernyo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khernyo/subscriptions", "organizations_url": "https://api.github.com/users/khernyo/orgs", "repos_url": "https://api.github.com/users/khernyo/repos", "events_url": "https://api.github.com/users/khernyo/events{/privacy}", "received_events_url": "https://api.github.com/users/khernyo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-07-26T22:48:34Z", "updated_at": "2019-07-28T12:51:10Z", "closed_at": "2019-07-28T12:51:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code causes an internal compiler error on 1.37.0-beta.6 and 1.38.0-nightly. On stable it's a simple error, though the message could be improved (#63027).\r\n\r\n```rust\r\nuse std::collections::HashMap;\r\nuse std::hash::Hash;\r\n\r\nfn group_by<I, F, T>(xs: &mut I, f: F) -> HashMap<T, Vec<&I::Item>>\r\nwhere\r\n    I: Iterator,\r\n    F: Fn(&I::Item) -> T,\r\n    T: Eq + Hash,\r\n{\r\n    let mut result = HashMap::new();\r\n    for ref x in xs {\r\n        let key = f(x);\r\n        result.entry(key).or_insert(Vec::new()).push(x);\r\n    }\r\n    result\r\n}\r\n\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?version=beta&mode=debug&edition=2018&gist=7995a9dba0cccb204349d7b269b22aea))\r\n\r\nOutput of `rustup run nightly rustc --crate-type lib lib.rs`:\r\n\r\n```\r\nerror: internal compiler error: src/librustc_mir/borrow_check/conflict_errors.rs:1155: local variable without a name\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:646:9\r\nstack backtrace:\r\n   0:     0x7f1b61494ffb - backtrace::backtrace::libunwind::trace::hebd3abdfda411954\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/libunwind.rs:88\r\n   1:     0x7f1b61494ffb - backtrace::backtrace::trace_unsynchronized::h99ec2b04a3a3fae2\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/mod.rs:66\r\n   2:     0x7f1b61494ffb - std::sys_common::backtrace::_print::h4f8a08c3de6b2188\r\n                               at src/libstd/sys_common/backtrace.rs:47\r\n   3:     0x7f1b61494ffb - std::sys_common::backtrace::print::h577ed431dde2ed30\r\n                               at src/libstd/sys_common/backtrace.rs:36\r\n   4:     0x7f1b61494ffb - std::panicking::default_hook::{{closure}}::h8d03b1947aec3300\r\n                               at src/libstd/panicking.rs:200\r\n   5:     0x7f1b61494cd6 - std::panicking::default_hook::h339346c6666eb959\r\n                               at src/libstd/panicking.rs:214\r\n   6:     0x7f1b6323f151 - rustc::util::common::panic_hook::heb70e88bb67cd321\r\n   7:     0x7f1b61495856 - std::panicking::rust_panic_with_hook::h379f5a37ec5e89b3\r\n                               at src/libstd/panicking.rs:481\r\n   8:     0x7f1b636fa1fd - std::panicking::begin_panic::h1bfa8dd80157a330\r\n   9:     0x7f1b63717b0f - rustc_errors::Handler::bug::h77a54955c8e87e0c\r\n  10:     0x7f1b62fcb883 - rustc::util::bug::opt_span_bug_fmt::{{closure}}::hb18fb2b1678fff1d\r\n  11:     0x7f1b62fbfa63 - rustc::ty::context::tls::with_opt::{{closure}}::h71ce051429c1d0d3\r\n  12:     0x7f1b62fbf9d3 - rustc::ty::context::tls::with_context_opt::hf63c72df770439a6\r\n  13:     0x7f1b62fbfa17 - rustc::ty::context::tls::with_opt::h6e270c0412653eb9\r\n  14:     0x7f1b62fcb798 - rustc::util::bug::opt_span_bug_fmt::h0b2ec00e2c3d7335\r\n  15:     0x7f1b62fcb702 - rustc::util::bug::bug_fmt::h3c8524d7d8ffe695\r\n  16:     0x7f1b6226a787 - rustc_mir::borrow_check::conflict_errors::<impl rustc_mir::borrow_check::MirBorrowckCtxt>::try_report_cannot_return_reference_to_local::h0d03c084a154cf79\r\n  17:     0x7f1b62267bfd - rustc_mir::borrow_check::conflict_errors::<impl rustc_mir::borrow_check::MirBorrowckCtxt>::report_borrowed_value_does_not_live_long_enough::h6b10d8c35db41925\r\n  18:     0x7f1b621d44b1 - rustc_mir::borrow_check::path_utils::each_borrow_involving_path::hcdc94227f89c260a\r\n  19:     0x7f1b6227a3d1 - rustc_mir::borrow_check::MirBorrowckCtxt::access_place::hd484fc912b955c66\r\n  20:     0x7f1b622799c3 - <rustc_mir::borrow_check::MirBorrowckCtxt as rustc_mir::dataflow::DataflowResultsConsumer>::visit_terminator_entry::h2834094bca128fad\r\n  21:     0x7f1b62276427 - rustc_mir::borrow_check::do_mir_borrowck::hbf7ffdd9614e764c\r\n  22:     0x7f1b62324936 - rustc::ty::context::GlobalCtxt::enter_local::hbdb8f2f2c2455e45\r\n  23:     0x7f1b622745ee - rustc_mir::borrow_check::mir_borrowck::h9e91484bb6fbe128\r\n  24:     0x7f1b61b078a6 - rustc::ty::query::__query_compute::mir_borrowck::h4a723163f585f3b5\r\n  25:     0x7f1b61adcc2c - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::mir_borrowck>::compute::hdac7dc2bf600a691\r\n  26:     0x7f1b61b0aae4 - rustc::dep_graph::graph::DepGraph::with_task_impl::h306e313d4fc38690\r\n  27:     0x7f1b61aea688 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h7273bdc528b59869\r\n  28:     0x7f1b61adc99d - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::haee3db44174b2c94\r\n  29:     0x7f1b61ab5cbc - rustc::util::common::time::hf8cd301d6dcfb12b\r\n  30:     0x7f1b61a5ea59 - rustc_interface::passes::analysis::h611427e84b6d30de\r\n  31:     0x7f1b619463a5 - rustc::ty::query::__query_compute::analysis::h13f044dafe7e51d2\r\n  32:     0x7f1b6194760d - rustc::dep_graph::graph::DepGraph::with_task_impl::h3245cc04ae63d6c0\r\n  33:     0x7f1b619587df - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h59de3ec3903bd5d2\r\n  34:     0x7f1b6196792a - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::he15abda5d3eb7dd4\r\n  35:     0x7f1b61ab80ca - rustc_interface::passes::create_global_ctxt::{{closure}}::hdecf9455f9665b51\r\n  36:     0x7f1b6196a257 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h94c4f48e3489a9ef\r\n  37:     0x7f1b619a3802 - std::thread::local::LocalKey<T>::with::h592677f58f0e6cf5\r\n  38:     0x7f1b6197d94e - scoped_tls::ScopedKey<T>::set::h391138e22a7da238\r\n  39:     0x7f1b619b9aa4 - syntax::with_globals::hfcf7c84f68aca2a1\r\n  40:     0x7f1b6193bf02 - std::sys_common::backtrace::__rust_begin_short_backtrace::h9726e5336ccbb89e\r\n  41:     0x7f1b614a60fa - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:82\r\n  42:     0x7f1b6196b7c9 - core::ops::function::FnOnce::call_once{{vtable.shim}}::he23a0634afcd614f\r\n  43:     0x7f1b61478d5f - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h85753735885edbd7\r\n                               at /rustc/890881f8f4c77e8670d4b32104c0325fcfefc90f/src/liballoc/boxed.rs:766\r\n  44:     0x7f1b614a4d80 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h275915ff969a4972\r\n                               at /rustc/890881f8f4c77e8670d4b32104c0325fcfefc90f/src/liballoc/boxed.rs:766\r\n  45:     0x7f1b614a4d80 - std::sys_common::thread::start_thread::h633d1d20ef49db8f\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  46:     0x7f1b614a4d80 - std::sys::unix::thread::Thread::new::thread_start::h71de64bdf6dee07c\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  47:     0x7f1b613d4fa3 - start_thread\r\n  48:     0x7f1b612f44cf - clone\r\n  49:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [mir_borrowck] processing `group_by`\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.38.0-nightly (890881f8f 2019-07-25) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: --crate-type lib\r\n```\r\n\r\n`rustup run beta rustc --version --verbose`:\r\n```\r\nrustc 1.37.0-beta.6 (61d1607e0 2019-07-22)\r\nbinary: rustc\r\ncommit-hash: 61d1607e0f6a18bb4897d6f9b10abeac9e11eb8e\r\ncommit-date: 2019-07-22\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.37.0-beta.6\r\nLLVM version: 8.0\r\n```\r\n\r\n`rustup run nightly rustc --version --verbose`:\r\n```\r\nrustc 1.38.0-nightly (890881f8f 2019-07-25)\r\nbinary: rustc\r\ncommit-hash: 890881f8f4c77e8670d4b32104c0325fcfefc90f\r\ncommit-date: 2019-07-25\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.38.0-nightly\r\nLLVM version: 9.0\r\n```\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63026/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63026/timeline", "performed_via_github_app": null, "state_reason": "completed"}