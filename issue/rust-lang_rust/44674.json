{"url": "https://api.github.com/repos/rust-lang/rust/issues/44674", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44674/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44674/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44674/events", "html_url": "https://github.com/rust-lang/rust/issues/44674", "id": 258496409, "node_id": "MDU6SXNzdWUyNTg0OTY0MDk=", "number": 44674, "title": "Misleading error message about \"call to unsafe function\"", "user": {"login": "ruuda", "id": 506953, "node_id": "MDQ6VXNlcjUwNjk1Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/506953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ruuda", "html_url": "https://github.com/ruuda", "followers_url": "https://api.github.com/users/ruuda/followers", "following_url": "https://api.github.com/users/ruuda/following{/other_user}", "gists_url": "https://api.github.com/users/ruuda/gists{/gist_id}", "starred_url": "https://api.github.com/users/ruuda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ruuda/subscriptions", "organizations_url": "https://api.github.com/users/ruuda/orgs", "repos_url": "https://api.github.com/users/ruuda/repos", "events_url": "https://api.github.com/users/ruuda/events{/privacy}", "received_events_url": "https://api.github.com/users/ruuda/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-09-18T14:16:58Z", "updated_at": "2017-09-18T17:48:08Z", "closed_at": "2017-09-18T17:48:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code generates a misleading error message on Rust 1.20.0:\r\n\r\n```rust\r\nfn main() {\r\n    use std::mem;\r\n    unsafe {\r\n        const MAGIC: i32 = mem::transmute([1u8, 2, 3, 4]);\r\n        println!(\"{}\", MAGIC);\r\n    }\r\n}\r\n```\r\n\r\nObserved output:\r\n\r\n```\r\nerror[E0133]: call to unsafe function requires unsafe function or block\r\n --> src/main.rs:4:28\r\n  |\r\n4 |         const MAGIC: i32 = mem::transmute([1u8, 2, 3, 4]);\r\n  |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ call to unsafe function\r\n```\r\n\r\nIt is misleading, because the call is in fact inside an unsafe block. Expected output:\r\n\r\n    error[E0015]: calls in constants are limited to struct and enum constructors\r\n\r\nOn the current nightly the problem is even worse because the compiler also warns about an unused unsafe block, while at the same time telling that an unsafe block is required.", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44674/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44674/timeline", "performed_via_github_app": null, "state_reason": "completed"}