{"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390", "repository_url": "https://api.github.com/repos/rust-lang/rust-clippy", "labels_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390/comments", "events_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390/events", "html_url": "https://github.com/rust-lang/rust-clippy/issues/10390", "id": 1595124825, "node_id": "I_kwDOAZm0i85fE6xZ", "number": 10390, "title": "`needless_return` false positive in match arm", "user": {"login": "Thechi2000", "id": 70897464, "node_id": "MDQ6VXNlcjcwODk3NDY0", "avatar_url": "https://avatars.githubusercontent.com/u/70897464?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thechi2000", "html_url": "https://github.com/Thechi2000", "followers_url": "https://api.github.com/users/Thechi2000/followers", "following_url": "https://api.github.com/users/Thechi2000/following{/other_user}", "gists_url": "https://api.github.com/users/Thechi2000/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thechi2000/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thechi2000/subscriptions", "organizations_url": "https://api.github.com/users/Thechi2000/orgs", "repos_url": "https://api.github.com/users/Thechi2000/repos", "events_url": "https://api.github.com/users/Thechi2000/events{/privacy}", "received_events_url": "https://api.github.com/users/Thechi2000/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 149309557, "node_id": "MDU6TGFiZWwxNDkzMDk1NTc=", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/C-bug", "name": "C-bug", "color": "F5F1FD", "default": false, "description": "Category: Clippy is not doing the correct thing"}, {"id": 1179592412, "node_id": "MDU6TGFiZWwxMTc5NTkyNDEy", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/I-suggestion-causes-error", "name": "I-suggestion-causes-error", "color": "E10C02", "default": false, "description": "Issue: The suggestions provided by this Lint cause an ICE/error when applied"}, {"id": 2593591510, "node_id": "MDU6TGFiZWwyNTkzNTkxNTEw", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/I-false-negative", "name": "I-false-negative", "color": "E10C02", "default": false, "description": "Issue: The lint should have been triggered on code, but wasn't"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-01-04T10:52:34Z", "updated_at": "2023-02-22T13:41:34Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I ran `cargo clippy --fix` on my project, and it failed with the following output:\r\n```\r\n   Compiling uzurion-launcher v0.0.0 (/home/ludovic/Desktop/prog/react-uzurion-launcher/src-tauri)\r\nwarning: failed to automatically apply fixes suggested by rustc to crate `uzurion_launcher`\r\n\r\nafter fixes were automatically applied the compiler reported errors within these files:\r\n\r\n  * src/event.rs\r\n  * src/login/microsoft/mod.rs\r\n\r\nThis likely indicates a bug in either rustc or cargo itself,\r\nand we would appreciate a bug report! You're likely to see \r\na number of compiler warnings after this message which cargo\r\nattempted to fix but failed. If you could open an issue at\r\nhttps://github.com/rust-lang/rust/issues\r\nquoting the full output of this command we'd be very appreciative!\r\nNote that you may be able to make some more progress in the near-term\r\nfixing code with the `--broken-code` flag\r\n\r\nThe following errors were reported:\r\nwarning: `crate` references the macro call's crate\r\n  --> src/event.rs:29:13\r\n   |\r\n29 |             crate::consts::events::ERROR,\r\n   |             ^^^^^ help: to reference the macro definition's crate, use: `$crate`\r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#crate_in_macro_def\r\n   = note: `#[warn(clippy::crate_in_macro_def)]` on by default\r\n\r\nerror[E0308]: `match` arms have incompatible types\r\n   --> src/event.rs:12:9\r\n    |\r\n12  | /         {\r\n13  | |             let __event = $event;\r\n14  | |             let __payload = $payload;\r\n15  | |\r\n...   |\r\n19  | |             }\r\n20  | |         }\r\n    | |_________^ expected struct `tauri::Window`, found `()`\r\n    |\r\n   ::: src/login/microsoft/mod.rs:110:5\r\n    |\r\n110 | /     match WindowBuilder::new(&app, \"microsoft-login\", WindowUrl::External(url))\r\n111 | |         .focused(true)\r\n112 | |         .title(\"Microsoft login\")\r\n113 | |         .build()\r\n    | |________________- `match` arms have incompatible types\r\n114 |       {\r\n115 |           Ok(w) => w,\r\n    |                    - this is found to be of type `tauri::Window`\r\n...\r\n118 |               send_error!(app, \"Cannot create window\", e);\r\n    |               ------------------------------------------- in this macro invocation\r\n    |\r\n    = note: expected struct `tauri::Window`\r\n            found unit type `()`\r\n    = note: this error originates in the macro `$crate::send_event` which comes from the expansion of the macro `send_error` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: aborting due to previous error; 1 warning emitted\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\nOriginal diagnostics will follow.\r\n\r\nwarning: `crate` references the macro call's crate\r\n  --> src/event.rs:27:9\r\n   |\r\n27 |         crate::send_event!{\r\n   |         ^^^^^ help: to reference the macro definition's crate, use: `$crate`\r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#crate_in_macro_def\r\n   = note: `#[warn(clippy::crate_in_macro_def)]` on by default\r\n\r\nwarning: useless use of `format!`\r\n  --> src/login/microsoft/requests.rs:52:47\r\n   |\r\n52 |     let content_type = HeaderValue::from_str(&format!(\"{}\", \"application/x-www-form-urlencoded\")).expect(\"Header value creation bug\");\r\n   |                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider using `.to_string()`: `\"application/x-www-form-urlencoded\".to_string()`\r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#useless_format\r\n   = note: `#[warn(clippy::useless_format)]` on by default\r\n\r\nwarning: unneeded `return` statement\r\n  --> src/login/microsoft/mod.rs:63:25\r\n   |\r\n63 |                         return;\r\n   |                         ^^^^^^\r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_return\r\n   = note: `#[warn(clippy::needless_return)]` on by default\r\n   = help: remove `return`\r\n\r\nwarning: unneeded `return` statement\r\n  --> src/login/microsoft/mod.rs:67:25\r\n   |\r\n67 |                         return;\r\n   |                         ^^^^^^\r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_return\r\n   = help: remove `return`\r\n\r\nwarning: unneeded `return` statement\r\n   --> src/login/microsoft/mod.rs:119:13\r\n    |\r\n119 |             return;\r\n    |             ^^^^^^\r\n    |\r\n    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_return\r\n    = help: remove `return`\r\n\r\nwarning: unneeded `return` statement\r\n   --> src/login/microsoft/mod.rs:178:13\r\n    |\r\n178 |             return;\r\n    |             ^^^^^^\r\n    |\r\n    = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#needless_return\r\n    = help: remove `return`\r\n\r\nwarning: called `map(f)` on an `Option` value where `f` is a closure that returns the unit type `()`\r\n  --> src/routing/microsoft.rs:22:5\r\n   |\r\n22 |        app.get_window(windows::MICROSOFT_LOGIN).map(|w| {\r\n   |   _____^\r\n   |  |_____|\r\n   | ||\r\n23 | ||         if let Err(e) = w.close() {\r\n24 | ||             error!(\"Could not close microsoft-login window: {:?}\", e);\r\n25 | ||         }\r\n26 | ||     });\r\n   | ||______^- help: try this: `if let Some(w) = app.get_window(windows::MICROSOFT_LOGIN) { ... }`\r\n   | |_______|\r\n   | \r\n   |\r\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#option_map_unit_fn\r\n   = note: `#[warn(clippy::option_map_unit_fn)]` on by default\r\n\r\nwarning: `uzurion-launcher` (bin \"uzurion-launcher\" test) generated 7 warnings (1 duplicate)\r\nwarning: `uzurion-launcher` (bin \"uzurion-launcher\") generated 7 warnings (6 duplicates)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 6.03s\r\n```\r\n\r\n## Reproduction: \r\nI was working on [this project](https://github.com/Thechi2000/uzurion-launcher), on the commit [e5087b1591032157c90d28e7925e5282df8456eb](https://github.com/Thechi2000/uzurion-launcher/tree/e5087b1591032157c90d28e7925e5282df8456eb)\r\n\r\nVersions:\r\nrustup: 1.25.1\r\nrustc: 1.66.0\r\ncargo: 1.66.0\r\nclippy: 0.1.66\r\n\r\n## Issue\r\nThe problem is that clippy considers that the return at `src-tauri/src/login/microsoft/mod.rs:119` is unneeded, but it actually makes the function return at the end of the match arm, thus the arm does not need to return a `Window<Wry>`. When clippy removes it, the second arms return `()`, thus it is incompatible with the first one (which returns `Window<Wry>`).", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/10390/timeline", "performed_via_github_app": null, "state_reason": null}