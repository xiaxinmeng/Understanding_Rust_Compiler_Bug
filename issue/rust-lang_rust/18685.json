{"url": "https://api.github.com/repos/rust-lang/rust/issues/18685", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18685/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18685/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18685/events", "html_url": "https://github.com/rust-lang/rust/issues/18685", "id": 47928612, "node_id": "MDU6SXNzdWU0NzkyODYxMg==", "number": 18685, "title": "Unboxed closure ICE due to conflicting use of self param space", "user": {"login": "bkoropoff", "id": 2101303, "node_id": "MDQ6VXNlcjIxMDEzMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/2101303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bkoropoff", "html_url": "https://github.com/bkoropoff", "followers_url": "https://api.github.com/users/bkoropoff/followers", "following_url": "https://api.github.com/users/bkoropoff/following{/other_user}", "gists_url": "https://api.github.com/users/bkoropoff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bkoropoff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bkoropoff/subscriptions", "organizations_url": "https://api.github.com/users/bkoropoff/orgs", "repos_url": "https://api.github.com/users/bkoropoff/repos", "events_url": "https://api.github.com/users/bkoropoff/events{/privacy}", "received_events_url": "https://api.github.com/users/bkoropoff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2014-11-06T06:38:00Z", "updated_at": "2014-11-07T22:36:47Z", "closed_at": "2014-11-07T22:36:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Found while debugging #18661\n\n``` rust\n#![feature(unboxed_closures, overloaded_calls)]\n\ntrait Tr {\n    fn foo(&self);\n\n    fn bar(&self) {\n        (|:| { self.foo() })()\n    }\n}\n\nimpl Tr for () {\n    fn foo(&self) {}\n}\n\nfn main() {\n    ().bar();\n}\n```\n\nOutput:\n\n```\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' panicked at 'assertion failed: self.self_ty().is_none()', /home/bkoropoff/Projects/rust/src/librustc/middle/subst.rs:161\n\nstack backtrace:\n   1:     0x7f248d8634d0 - rt::backtrace::imp::write::hd5cf03b086df3c8bciq\n   2:     0x7f248d866550 - failure::on_fail::h1883f65e4859f99aODq\n   3:     0x7f248e014550 - unwind::begin_unwind_inner::h4724b673057aa7b2ZSd\n   4:     0x7f248e3ee820 - unwind::begin_unwind::h14014107635648236996\n   5:     0x7f248e73efe0 - middle::subst::Substs::with_self_ty::h2bc29c972ac1c03fKHV\n   6:     0x7f248e787cb0 - middle::trans::meth::trans_method_callee::h577047eddd14a758DZm\n   7:     0x7f248e787c30 - middle::trans::controlflow::trans_for::closure.122893\n   8:     0x7f248ed45840 - middle::trans::expr::trans_overloaded_call::closure.123736\n   9:     0x7f248e7862f0 - middle::trans::callee::trans_call_inner::h63140c053eb498d4Tr4\n  10:     0x7f248e7b8c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hcfd8c05e4d3c050aOA6\n  11:     0x7f248e77e510 - middle::trans::expr::trans_into::h513a5ff934428ca7Nb5\n  12:     0x7f248e77e930 - middle::trans::controlflow::trans_block::h1f8437f97d982780ys1\n  13:     0x7f248e81fa20 - middle::trans::base::trans_closure::hee28be544b5f82b7eAh\n  14:     0x7f248e771b70 - middle::trans::base::trans_fn::h4c36ddee4bfba9759Lh\n  15:     0x7f248e772280 - middle::trans::monomorphize::monomorphic_fn::h9b8dc1f03343f037YS0\n  16:     0x7f248e7a4330 - middle::trans::callee::trans_fn_ref_with_substs::h0704b46911f5f6dd953\n  17:     0x7f248e787cb0 - middle::trans::meth::trans_method_callee::h577047eddd14a758DZm\n  18:     0x7f248e7aafd0 - middle::trans::callee::trans_method_call::closure.123334\n  19:     0x7f248e7862f0 - middle::trans::callee::trans_call_inner::h63140c053eb498d4Tr4\n  20:     0x7f248e7aaad0 - middle::trans::callee::trans_method_call::h983e88dde8c4f64fln4\n  21:     0x7f248e7b8c30 - middle::trans::expr::trans_rvalue_dps_unadjusted::hcfd8c05e4d3c050aOA6\n  22:     0x7f248e77e510 - middle::trans::expr::trans_into::h513a5ff934428ca7Nb5\n  23:     0x7f248e77d970 - middle::trans::controlflow::trans_stmt_semi::hc8263f70f5ea8146Fr1\n  24:     0x7f248e77cf20 - middle::trans::controlflow::trans_stmt::h4ab602fde4741168sn1\n  25:     0x7f248e77e930 - middle::trans::controlflow::trans_block::h1f8437f97d982780ys1\n  26:     0x7f248e81fa20 - middle::trans::base::trans_closure::hee28be544b5f82b7eAh\n  27:     0x7f248e771b70 - middle::trans::base::trans_fn::h4c36ddee4bfba9759Lh\n  28:     0x7f248e76f290 - middle::trans::base::trans_item::h671a84973f340984n5h\n  29:     0x7f248e82a420 - middle::trans::base::trans_crate::hbe1167d59e4442a8s3i\n  30:     0x7f248ec6ab70 - driver::driver::phase_4_translate_to_llvm::hd4dc6d8be6267a8b5sB\n  31:     0x7f248ec61360 - driver::driver::compile_input::h8b6b9b7f64eba9a5ZZA\n  32:     0x7f248ece5c20 - driver::run_compiler::hf2410821f04b1325cQE\n  33:     0x7f248ece5b10 - driver::run::closure.145823\n  34:     0x7f248e4266e0 - task::TaskBuilder<S>::try_future::closure.104097\n  35:     0x7f248e4264d0 - task::TaskBuilder<S>::spawn_internal::closure.104068\n  36:     0x7f248f55e370 - task::NativeSpawner.Spawner::spawn::closure.8434\n  37:     0x7f248e06a4d0 - rust_try_inner\n  38:     0x7f248e06a4c0 - rust_try\n  39:     0x7f248e011ea0 - unwind::try::h2a8363f131a2efbejHd\n  40:     0x7f248e011d30 - task::Task::run::ha950d1ffc07a77f09Mc\n  41:     0x7f248f55e0b0 - task::NativeSpawner.Spawner::spawn::closure.8372\n  42:     0x7f248e013540 - thread::thread_start::hc29987e17333695ao8c\n  43:     0x7f248d32fe20 - start_thread\n  44:     0x7f248dcdeb59 - clone\n  45:                0x0 - <unknown>\n```\n\nThis is due to the self param space being used both for the unboxed closure itself within the implicit `FnOnce` impl, and for the self type of the enclosing trait.\n\nI don't think the first use is ever necessary since the `self` of the unboxed closure cannot actually be mentioned within it.  The unboxed closure type may need to be plumbed through some other way, though.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18685/timeline", "performed_via_github_app": null, "state_reason": "completed"}