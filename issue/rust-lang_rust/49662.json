{"url": "https://api.github.com/repos/rust-lang/rust/issues/49662", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49662/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49662/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49662/events", "html_url": "https://github.com/rust-lang/rust/issues/49662", "id": 311321574, "node_id": "MDU6SXNzdWUzMTEzMjE1NzQ=", "number": 49662, "title": "ICE: More than one activation introduced at the same location", "user": {"login": "Robbepop", "id": 8193155, "node_id": "MDQ6VXNlcjgxOTMxNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8193155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Robbepop", "html_url": "https://github.com/Robbepop", "followers_url": "https://api.github.com/users/Robbepop/followers", "following_url": "https://api.github.com/users/Robbepop/following{/other_user}", "gists_url": "https://api.github.com/users/Robbepop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Robbepop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Robbepop/subscriptions", "organizations_url": "https://api.github.com/users/Robbepop/orgs", "repos_url": "https://api.github.com/users/Robbepop/repos", "events_url": "https://api.github.com/users/Robbepop/events{/privacy}", "received_events_url": "https://api.github.com/users/Robbepop/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-04-04T17:27:16Z", "updated_at": "2018-04-05T06:54:53Z", "closed_at": "2018-04-05T06:54:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The Rust compiler told me to file an issue here.\r\n\r\nThis seems to be a NLL or Borrow-Checker regression as this works on `nightly-2018-04-03`. \r\n\r\nWhat happened: `cargo test --verbose` of my project with the new contents of:\r\n\r\n```rust\r\nenum ExprErrorKind {\r\n\tExtractHiOverflow { hi: usize, expr: Extract },\r\n\t// some other variants here\r\n}\r\n\r\nimpl fmt::Display for ExprError {\r\n\tfn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\r\n\t\tuse self::ExprErrorKind::*;\r\n\t\tmatch &self.kind {\r\n\t\t\tExtractHiOverflow { .. } => write!(f, \"dayum\"),\r\n\t\t\t// some other cases here\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\nLink to `Extract` struct used: [**click me!**](https://github.com/Robbepop/stevia/blob/master/src/ast/terms/cast/extract.rs#L17)\r\n\r\nRust compiler output points to [`librustc_mir/dataflow/impls/borrows.rs:216:21`](https://github.com/rust-lang/rust/blob/master/src/librustc_mir/dataflow/impls/borrows.rs#L216)\r\n\r\n```\r\nthread 'rustc' panicked at 'More than one activation introduced at the same location.', librustc_mir/dataflow/impls/borrows.rs:216:21\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::print\r\n             at libstd/sys_common/backtrace.rs:71\r\n             at libstd/sys_common/backtrace.rs:59\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/panicking.rs:207\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:223\r\n   4: core::ops::function::Fn::call\r\n   5: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:403\r\n   6: std::panicking::begin_panic\r\n   7: <rustc_mir::dataflow::impls::borrows::Borrows::new::GatherBorrows<'a, 'gcx, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_assign\r\n   8: rustc_mir::dataflow::impls::borrows::Borrows::new\r\n   9: rustc_mir::borrow_check::do_mir_borrowck\r\n  10: <std::thread::local::LocalKey<T>>::with\r\n  11: rustc::ty::context::GlobalCtxt::enter_local\r\n  12: rustc_mir::borrow_check::mir_borrowck\r\n  13: rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::compute_result\r\n  14: rustc::dep_graph::graph::DepGraph::with_task_impl\r\n  15: rustc_errors::Handler::track_diagnostics\r\n  16: rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check\r\n  17: rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::force\r\n  18: rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::try_get\r\n  19: rustc::ty::maps::TyCtxtAt::mir_borrowck\r\n  20: rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::mir_borrowck\r\n  21: rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::{{closure}}\r\n  22: <std::thread::local::LocalKey<T>>::with\r\n  23: <std::thread::local::LocalKey<T>>::with\r\n  24: rustc::ty::context::TyCtxt::create_and_enter\r\n  25: rustc_driver::driver::compile_input\r\n  26: rustc_driver::run_compiler_impl\r\n  27: syntax::with_globals\r\n\r\nerror: internal compiler error: unexpected panic\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\nnote: rustc 1.27.0-nightly (637ac17c5 2018-04-03) running on x86_64-unknown-linux-gnu\r\nnote: compiler flags: -C debuginfo=2 -C incremental\r\nnote: some of the compiler flags provided by cargo are hidden\r\nerror: Could not compile `stevia`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nFull `RUST_BACKTRACE`\r\n\r\n```\r\n   0:     0x7f3d1b99781b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::haf21fb2d1a534f52\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7f3d1b965950 - std::sys_common::backtrace::print::h222ac106928ee2b8\r\n                               at libstd/sys_common/backtrace.rs:71\r\n                               at libstd/sys_common/backtrace.rs:59\r\n   2:     0x7f3d1b98b25d - std::panicking::default_hook::{{closure}}::ha0ec7d04c7618490\r\n                               at libstd/panicking.rs:207\r\n   3:     0x7f3d1b98afbb - std::panicking::default_hook::h94862576a4900944\r\n                               at libstd/panicking.rs:223\r\n   4:     0x7f3d17fbd46d - core::ops::function::Fn::call::h7f5866913c0a5607\r\n   5:     0x7f3d1b98b7a9 - std::panicking::rust_panic_with_hook::ha4fb1372609c4048\r\n                               at libstd/panicking.rs:403\r\n   6:     0x7f3d18b514a5 - std::panicking::begin_panic::h2b7788e9181b7095\r\n   7:     0x7f3d18c7cd76 - <rustc_mir::dataflow::impls::borrows::Borrows::new::GatherBorrows<'a, 'gcx, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_assign::h35f9347a7832f8c4\r\n   8:     0x7f3d18c7b650 - rustc_mir::dataflow::impls::borrows::Borrows::new::h9c0408c0400a81c9\r\n   9:     0x7f3d18b2c7d1 - rustc_mir::borrow_check::do_mir_borrowck::h47e6140075bc43eb\r\n  10:     0x7f3d18ab60c8 - <std::thread::local::LocalKey<T>>::with::h6f6a4179110e7243\r\n  11:     0x7f3d18b90298 - rustc::ty::context::GlobalCtxt::enter_local::h6a5455630fef40da\r\n  12:     0x7f3d18b2b6bc - rustc_mir::borrow_check::mir_borrowck::hebec48d216acf899\r\n  13:     0x7f3d17ed643f - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::compute_result::he167f10bbbb61ef0\r\n  14:     0x7f3d17b5d500 - rustc::dep_graph::graph::DepGraph::with_task_impl::h26e8e7cd35f6e0c6\r\n  15:     0x7f3d17bc48dc - rustc_errors::Handler::track_diagnostics::h0169b067a940efbb\r\n  16:     0x7f3d17e248a7 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::h5f78a4f3ed5ba6ff\r\n  17:     0x7f3d17ed64d6 - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::force::h7c21a818484f92e3\r\n  18:     0x7f3d17ed6d70 - rustc::ty::maps::<impl rustc::ty::maps::queries::mir_borrowck<'tcx>>::try_get::h7511b02b472da79f\r\n  19:     0x7f3d17e8504e - rustc::ty::maps::TyCtxtAt::mir_borrowck::h5cc03182edce72e1\r\n  20:     0x7f3d17e817f8 - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::mir_borrowck::h7fad85c586aefb83\r\n  21:     0x7f3d1bd298e3 - rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}::{{closure}}::hc73ec1e4941c1f93\r\n  22:     0x7f3d1bd9d65a - <std::thread::local::LocalKey<T>>::with::h4190da1571fbd5ee\r\n  23:     0x7f3d1bda1256 - <std::thread::local::LocalKey<T>>::with::h8b90a925ea17281a\r\n  24:     0x7f3d1be150ae - rustc::ty::context::TyCtxt::create_and_enter::hf44c69229c58e5c3\r\n  25:     0x7f3d1bd0f217 - rustc_driver::driver::compile_input::h01406b737f8d9fb7\r\n  26:     0x7f3d1bdc236f - rustc_driver::run_compiler_impl::h72592b1443483e40\r\n  27:     0x7f3d1bd0c3c8 - syntax::with_globals::h861641f6eadc73c4\r\n  28:     0x7f3d1bd2a4dd - std::sys_common::backtrace::__rust_begin_short_backtrace::hce542848eb39a647\r\n  29:     0x7f3d1b9a5e7e - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  30:     0x7f3d1bd3630d - <F as alloc::boxed::FnBox<A>>::call_box::h9ee6f2e4318cb3c5\r\n  31:     0x7f3d1b99cf07 - std::sys_common::thread::start_thread::h4e87150995e528f2\r\n                               at /checkout/src/liballoc/boxed.rs:794\r\n                               at libstd/sys_common/thread.rs:24\r\n  32:     0x7f3d1b96bf78 - std::sys::unix::thread::Thread::new::thread_start::h77e7f544c30e5001\r\n                               at libstd/sys/unix/thread.rs:90\r\n  33:     0x7f3d15d0e08b - start_thread\r\n  34:     0x7f3d1b64ce7e - __GI___clone\r\n  35:                0x0 - <unknown>\r\n```\r\n\r\nCaused by:\r\n\r\n```\r\nCaused by: (normalized paths)\r\n  process didn't exit successfully: `rustc --crate-name stevia src/lib.rs --emit=dep-info,link -C debuginfo=2 --test -C metadata=881e46fe75c53b3a -C extra-filename=-881e46fe75c53b3a --out-dir src/stevia/target/debug/deps -C incremental=src/stevia/target/debug/incremental -L dependency=/src/stevia/target/debug/deps --extern vec_map=src/stevia/target/debug/deps/libvec_map-9f866549548d61ab.rlib --extern string_interner=src/stevia/target/debug/deps/libstring_interner-5cb7f2653f042239.rlib --extern smallvec=src/stevia/target/debug/deps/libsmallvec-2ac8459e26212a86.rlib --extern num=src/stevia/target/debug/deps/libnum-d6ba17589bd7fa8a.rlib --extern log=src/stevia/target/debug/deps/liblog-ffd9680ce992ac22.rlib --extern apint=src/stevia/target/debug/deps/libapint-c1a44822f4da5864.rlib --extern itertools=src/stevia/target/debug/deps/libitertools-55ed19e3ad349b48.rlib --extern unreachable=src/stevia/target/debug/deps/libunreachable-55873e15e2bf903b.rlib --extern either=src/stevia/target/debug/deps/libeither-b909279f6a7cb3fe.rlib --extern lazy_static=src/stevia/target/debug/deps/liblazy_static-7f08ac2d8dec98b9.rlib` (exit code: 101)\r\n```\r\n\r\nI can provide more information about the source code if necesary. :)", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49662/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49662/timeline", "performed_via_github_app": null, "state_reason": "completed"}