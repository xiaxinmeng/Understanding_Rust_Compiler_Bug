{"url": "https://api.github.com/repos/rust-lang/rust/issues/103796", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103796/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103796/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103796/events", "html_url": "https://github.com/rust-lang/rust/issues/103796", "id": 1429457676, "node_id": "I_kwDOAAsO6M5VM8sM", "number": 103796, "title": "How to add custom llvm pass into rustc", "user": {"login": "mengrj", "id": 68458329, "node_id": "MDQ6VXNlcjY4NDU4MzI5", "avatar_url": "https://avatars.githubusercontent.com/u/68458329?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mengrj", "html_url": "https://github.com/mengrj", "followers_url": "https://api.github.com/users/mengrj/followers", "following_url": "https://api.github.com/users/mengrj/following{/other_user}", "gists_url": "https://api.github.com/users/mengrj/gists{/gist_id}", "starred_url": "https://api.github.com/users/mengrj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mengrj/subscriptions", "organizations_url": "https://api.github.com/users/mengrj/orgs", "repos_url": "https://api.github.com/users/mengrj/repos", "events_url": "https://api.github.com/users/mengrj/events{/privacy}", "received_events_url": "https://api.github.com/users/mengrj/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-10-31T08:29:19Z", "updated_at": "2022-11-02T13:04:04Z", "closed_at": "2022-11-02T13:04:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to add my llvm pass into Rustc. Rustc has one compiling option `-C passes=val` where we could add extra LLVM passes to run. However, as my try, this option can only accept the pass when the pass code is placed inside the LLVM code tree, but I want to add my pass out-of-tree into Rustc. \r\n\r\nWhen I add my pass via this option:\r\n `export RUSTFLAGS=\"-C passes=my-pass\" && cargo build` \r\n Compiler reports errors:\\ `error: failed to run LLVM passes: unknown pass name 'my-pass'` \r\n\r\n Then I try to load my pass via `-C llvm-args=-fpass-plugin=/opt/new-pass/mypass.so -C passes=my-pass` in the `clang` way. It reports: `rustc -Cllvm-args=\"...\" with: Unknown command line argument '-fpass-plugin=/opt/new-pass/mypass.so'`. Also tried to replace `-fpass-plugin` with other options like `-load` and `-load-pass-plugin`, but they still cannot be recognized by rustc.\r\n \r\n How could I add my custom pass into Rustc?", "closed_by": {"login": "mengrj", "id": 68458329, "node_id": "MDQ6VXNlcjY4NDU4MzI5", "avatar_url": "https://avatars.githubusercontent.com/u/68458329?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mengrj", "html_url": "https://github.com/mengrj", "followers_url": "https://api.github.com/users/mengrj/followers", "following_url": "https://api.github.com/users/mengrj/following{/other_user}", "gists_url": "https://api.github.com/users/mengrj/gists{/gist_id}", "starred_url": "https://api.github.com/users/mengrj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mengrj/subscriptions", "organizations_url": "https://api.github.com/users/mengrj/orgs", "repos_url": "https://api.github.com/users/mengrj/repos", "events_url": "https://api.github.com/users/mengrj/events{/privacy}", "received_events_url": "https://api.github.com/users/mengrj/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103796/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103796/timeline", "performed_via_github_app": null, "state_reason": "completed"}