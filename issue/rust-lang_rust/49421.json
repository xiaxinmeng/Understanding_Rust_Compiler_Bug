{"url": "https://api.github.com/repos/rust-lang/rust/issues/49421", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49421/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49421/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49421/events", "html_url": "https://github.com/rust-lang/rust/issues/49421", "id": 309038918, "node_id": "MDU6SXNzdWUzMDkwMzg5MTg=", "number": 49421, "title": "run-make/relocation-model fails on mips64{el}-unknown-linux-gnuabi64", "user": {"login": "draganmladjenovic", "id": 37329008, "node_id": "MDQ6VXNlcjM3MzI5MDA4", "avatar_url": "https://avatars.githubusercontent.com/u/37329008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/draganmladjenovic", "html_url": "https://github.com/draganmladjenovic", "followers_url": "https://api.github.com/users/draganmladjenovic/followers", "following_url": "https://api.github.com/users/draganmladjenovic/following{/other_user}", "gists_url": "https://api.github.com/users/draganmladjenovic/gists{/gist_id}", "starred_url": "https://api.github.com/users/draganmladjenovic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/draganmladjenovic/subscriptions", "organizations_url": "https://api.github.com/users/draganmladjenovic/orgs", "repos_url": "https://api.github.com/users/draganmladjenovic/repos", "events_url": "https://api.github.com/users/draganmladjenovic/events{/privacy}", "received_events_url": "https://api.github.com/users/draganmladjenovic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 106552066, "node_id": "MDU6TGFiZWwxMDY1NTIwNjY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-MIPS", "name": "O-MIPS", "color": "6e6ec0", "default": false, "description": "Target: MIPS processors"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-03-27T16:17:41Z", "updated_at": "2020-04-20T20:07:00Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\nerror: make failed\r\nstatus: exit code: 2\r\ncommand: \"make\"\r\nstdout:\r\n------------------------------------------\r\nLD_LIBRARY_PATH=\"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64:/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib:/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage0-tools/mips64el-unknown-linux-gnuabi64/release/deps:/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage0-sysroot/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib:\" '/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/bin/rustc' --out-dir /home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64 -L /home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64  -C relocation-model=static foo.rs\r\nMakefile:17: recipe for target 'others' failed\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-L\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64/foo.foo0.rcgu.o\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64/foo.foo1.rcgu.o\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64/foo.foo2.rcgu.o\" \"-o\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64/foo\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64/foo.crate.allocator.rcgu.o\" \"-Wl,--gc-sections\" \"-no-pie\" \"-Wl,-z,relro,-z,now\" \"-nodefaultlibs\" \"-L\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/test/run-make/relocation-model.stage2-mips64el-unknown-linux-gnuabi64\" \"-L\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib\" \"-Wl,-Bstatic\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libstd-bf7adc3a3386a805.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libpanic_unwind-d6c1d0be350f8447.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libunwind-020f3ddad3c2aecc.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/liballoc_system-e7e2db07f1320e68.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/liblibc-ee093779b659c145.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/liballoc-9f2b8d7122a962b4.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libstd_unicode-dbcf6d09120f0b05.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libcore-a84829a54242b6cf.rlib\" \"/home/draganm/work/rust/build/mips64el-unknown-linux-gnuabi64/stage2/lib/rustlib/mips64el-unknown-linux-gnuabi64/lib/libcompiler_builtins-57fb30de8d4f53bc.rlib\" \"-Wl,-Bdynamic\" \"-l\" \"dl\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-l\" \"gcc_s\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-l\" \"util\"\r\n  = note: /usr/bin/ld: BFD (GNU Binutils for Debian) 2.30 assertion fail ../../bfd/elfxx-mips.c:11237\r\n          collect2: error: ld returned 1 exit status\r\n          \r\n\r\nerror: aborting due to previous error\r\n\r\nmake: *** [others] Error 101\r\n```\r\nAfter [D23652](https://reviews.llvm.org/D23652) (LLVM 5.0.0) mips64 backend respects relocation-model=static option. Unfortunately this does not work well with libc dynamic linking. The GNU LD allows creation of .plt stubs in this case only if whole application (more important .rel.plt section) lies in in lower 32-bits of address space. The default linker script for mips64 n64 abi puts __executable-start at 0x120000000 which results in a assert (see log above). Historically GCC would usually generate pic-like code for mips64 n64 even when static linking and fno-pic is involved except when \"-msym32\" (use 32-bit symbols) option is provided.  That option seems primarily targeted for bare-metal targets and stock LD does not provide suitable linker script for it, as far I know. So static relocation model can only be used for full static linking w/o messing with linker script.  \r\n\r\nI'm not sure if relocation-model=static is used commonly on non musl targets. If so then on mips64 targets it probably should be silently ignored, at least on linux-gnu targets. ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49421/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49421/timeline", "performed_via_github_app": null, "state_reason": null}