{"url": "https://api.github.com/repos/rust-lang/rust/issues/82462", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82462/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82462/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82462/events", "html_url": "https://github.com/rust-lang/rust/issues/82462", "id": 815036661, "node_id": "MDU6SXNzdWU4MTUwMzY2NjE=", "number": 82462, "title": "Diagnostic for iterator referencing temporary with Drop may suggest an invalid semicolon", "user": {"login": "sapir", "id": 896766, "node_id": "MDQ6VXNlcjg5Njc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/896766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sapir", "html_url": "https://github.com/sapir", "followers_url": "https://api.github.com/users/sapir/followers", "following_url": "https://api.github.com/users/sapir/following{/other_user}", "gists_url": "https://api.github.com/users/sapir/gists{/gist_id}", "starred_url": "https://api.github.com/users/sapir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sapir/subscriptions", "organizations_url": "https://api.github.com/users/sapir/orgs", "repos_url": "https://api.github.com/users/sapir/repos", "events_url": "https://api.github.com/users/sapir/events{/privacy}", "received_events_url": "https://api.github.com/users/sapir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596299768, "node_id": "MDU6TGFiZWwxNTk2Mjk5NzY4", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-invalid-suggestion", "name": "D-invalid-suggestion", "color": "c9f7a3", "default": false, "description": "A structured suggestion resulting in incorrect code"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-02-24T03:05:18Z", "updated_at": "2021-09-11T10:18:03Z", "closed_at": "2021-09-11T10:18:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given the following code on rust nightly (current nightly on playground is 2021-02-22 a15f484b918a4533ad63):\r\n\r\nhttps://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=286e1d81ecdd9df68dc94e9b1b8ead5f\r\n\r\n```rust\r\nstruct DroppingSlice<'a>(&'a [i32]);\r\n\r\nimpl Drop for DroppingSlice<'_> {\r\n    fn drop(&mut self) {\r\n        println!(\"hi from slice\");\r\n    }\r\n}\r\n\r\nimpl DroppingSlice<'_> {\r\n    fn iter(&self) -> std::slice::Iter<'_, i32> {\r\n        self.0.iter()\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let mut v = vec![1, 2, 3, 4];\r\n    for x in DroppingSlice(&*v).iter() {\r\n        v.push(*x);\r\n        break;\r\n    }\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0502]: cannot borrow `v` as mutable because it is also borrowed as immutable\r\n  --> src/main.rs:18:9\r\n   |\r\n17 |     for x in DroppingSlice(&*v).iter() {\r\n   |              ------------------      - ... and the immutable borrow might be used here, when that temporary is dropped and runs the `Drop` code for type `DroppingSlice`\r\n   |              |               |\r\n   |              |               immutable borrow occurs here\r\n   |              a temporary with access to the immutable borrow is created here ...\r\n18 |         v.push(*x);\r\n   |         ^^^^^^^^^^ mutable borrow occurs here\r\n   |\r\nhelp: consider adding semicolon after the expression so its temporaries are dropped sooner, before the local variables declared by the block are dropped\r\n   |\r\n17 |     for x in DroppingSlice(&*v).iter(); {\r\n   |                                       ^\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0502`.\r\nerror: could not compile `playground`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nThe suggestion regarding the semicolon is incorrect.\r\n\r\nAdditionally, it seems a little odd to me that the first half of the sentence beginning \"a temporary with access to the immutable borrow is created here ...\" is displayed below the second half, \"... and the immutable borrow might be used here, when that temporary is dropped and runs the `Drop` code for type `DroppingSlice`\".\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82462/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82462/timeline", "performed_via_github_app": null, "state_reason": "completed"}