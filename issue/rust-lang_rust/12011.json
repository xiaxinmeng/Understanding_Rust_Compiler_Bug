{"url": "https://api.github.com/repos/rust-lang/rust/issues/12011", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/12011/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/12011/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/12011/events", "html_url": "https://github.com/rust-lang/rust/issues/12011", "id": 26786356, "node_id": "MDU6SXNzdWUyNjc4NjM1Ng==", "number": 12011, "title": "Optimise std::vec's .sort_by for short vectors (remove/reduce allocations)", "user": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-02-03T08:21:01Z", "updated_at": "2014-02-14T04:34:41Z", "closed_at": "2014-02-14T04:34:07Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "For a vector of length `n`, it [currently allocates `2 * n` space](https://github.com/mozilla/rust/blob/62caad2c1addd49c350bad98e67f525a5cc82469/src/libstd/vec.rs#L1825), but for small vectors it only uses `n`... and _should_ be able get away without allocations completely.\n\nNote: the comparison function could unwind, so this will need to be careful about what it puts on the stack etc. to be failure safe... although there is [a test](https://github.com/mozilla/rust/blob/62caad2c1addd49c350bad98e67f525a5cc82469/src/test/run-pass/vector-sort-failure-safe.rs) that should help ensure that. `[].swap` is probably useful.\n\nRandom notes:\n- servo saw speed-ups from this: https://github.com/mozilla/servo/pull/1567 (apparently for vectors of length at most 16)\n- there may be some advantage to switching what implementation is used based on the size of the elements, e.g. for `&mut [uint]`, `[].swap` is cheap, but for `&mut [HundredKBStruct]`, many swaps may be more expensive than what one can do with an allocation.  (Pure speculation on my part.) Of course, we could just avoid doing this, and people could go faster by boxing it and storing `~HundredKBStruct`.\n", "closed_by": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/12011/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/12011/timeline", "performed_via_github_app": null, "state_reason": "completed"}