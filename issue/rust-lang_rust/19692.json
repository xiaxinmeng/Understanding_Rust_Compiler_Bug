{"url": "https://api.github.com/repos/rust-lang/rust/issues/19692", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/19692/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/19692/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/19692/events", "html_url": "https://github.com/rust-lang/rust/issues/19692", "id": 51540781, "node_id": "MDU6SXNzdWU1MTU0MDc4MQ==", "number": 19692, "title": "ICE calling unimplemented prelude trait methods.", "user": {"login": "orodley", "id": 1901719, "node_id": "MDQ6VXNlcjE5MDE3MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1901719?v=4", "gravatar_id": "", "url": "https://api.github.com/users/orodley", "html_url": "https://github.com/orodley", "followers_url": "https://api.github.com/users/orodley/followers", "following_url": "https://api.github.com/users/orodley/following{/other_user}", "gists_url": "https://api.github.com/users/orodley/gists{/gist_id}", "starred_url": "https://api.github.com/users/orodley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/orodley/subscriptions", "organizations_url": "https://api.github.com/users/orodley/orgs", "repos_url": "https://api.github.com/users/orodley/repos", "events_url": "https://api.github.com/users/orodley/events{/privacy}", "received_events_url": "https://api.github.com/users/orodley/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2014-12-10T10:18:21Z", "updated_at": "2014-12-24T20:41:32Z", "closed_at": "2014-12-24T20:41:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "The following (invalid) code triggers an ICE:\n\n``` rust\nstruct Foo;\n\nfn ice(x: Foo) {\n    let Some(ref y) = Some(x.nonexistent_method());\n    y.clone();\n}\n\nfn main() { }\n```\n\nThe same error occurs when replacing `clone` with some other methods from prelude traits with similar signatures - `to_c_str` or `into_string` for example.\n\nHowever, if I declare my own trait with a similar method, e.g.: `trait Bar { fn bar(&self) -> Self; }`, and then replace the method call with a call to `bar`, there is an identical error message, but no ICE.\n\nRemoving either the `Some` or the `ref` makes the ICE disappear.\n\nCompiler output:\n\n```\n$ RUST_BACKTRACE=1 rustc ice.rs\nice.rs:4:30: 4:50 error: type `Foo` does not implement any method in scope named `nonexistent_method`\nice.rs:4     let Some(ref y) = Some(x.nonexistent_method());\n                                      ^~~~~~~~~~~~~~~~~~~~\nice.rs:5:7: 5:14 error: the type of this value must be known in this context\nice.rs:5     y.clone();\n               ^~~~~~~\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' panicked at 'assertion failed: `(left == right) && (right == left)` (left: `None`, right: `Some(())`)', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/librustc_typeck/check/method/confirm.rs:153\n\nstack backtrace:\n   1:     0x7f5b9805ae50 - rt::backtrace::imp::write::hf87c140cfcd95fbaBly\n   2:     0x7f5b9805e0a0 - failure::on_fail::h343c4b97464b676eZNy\n   3:     0x7f5b97cb0fa0 - unwind::begin_unwind_inner::hb4b9831d2f5e86936Qc\n   4:     0x7f5b97cb0bd0 - unwind::begin_unwind_fmt::h5c8826b0094c4275hOc\n   5:     0x7f5b9717e800 - check::method::confirm::ConfirmContext<'a, 'tcx>::confirm::hb8176eb56afef6ceTxf\n   6:     0x7f5b972622e0 - check::check_expr_with_unifier::check_method_call::h7dd70ab5683f061e9mo\n   7:     0x7f5b972586a0 - check::check_expr_with_unifier::he91bcac7bd1c6fffYho\n   8:     0x7f5b97213a40 - check::check_block_with_expected::h31910f8cb7bf5a4dBhq\n   9:     0x7f5b971e7e20 - check::check_fn::h70c5e5169de64720PJk\n  10:     0x7f5b97210c00 - check::check_bare_fn::h3f9ce32de12dd011Tyk\n  11:     0x7f5b97208cd0 - check::check_item::h63605613fc52aeb74Sk\n  12:     0x7f5b975518b0 - check_crate::closure.42937\n  13:     0x7f5b9754f630 - util::common::time::h1247083444027210014\n  14:     0x7f5b9754e900 - check_crate::h5e7941cca32a8446ASz\n  15:     0x7f5b98495300 - driver::phase_3_run_analysis_passes::h63031984c677effauta\n  16:     0x7f5b98484100 - driver::compile_input::h022976239e8f5a3cpba\n  17:     0x7f5b98520d80 - run_compiler::h2b243518ea560709z4b\n  18:     0x7f5b98520c70 - run::closure.21242\n  19:     0x7f5b98532670 - task::TaskBuilder::try_future::closure.22690\n  20:     0x7f5b98033410 - task::TaskBuilder::spawn_internal::closure.31179\n  21:     0x7f5b97caed70 - task::Task::spawn::closure.5765\n  22:     0x7f5b97d0c280 - rust_try_inner\n  23:     0x7f5b97d0c270 - rust_try\n  24:     0x7f5b97caee50 - unwind::try::ha36bc8815a761f13pFc\n  25:     0x7f5b97caec10 - task::Task::run::h24525a73fb4c9bb3fOb\n  26:     0x7f5b97cae800 - task::Task::spawn::closure.5741\n  27:     0x7f5b97cb0250 - thread::thread_start::ha943fdda31374bc3i6b\n  28:     0x7f5b92b9ffe0 - start_thread\n  29:     0x7f5b97975c99 - __clone\n  30:                0x0 - <unknown>\n```\n\nThis occurs under:\n\n```\n$ uname -a\nLinux <hostname> 3.16.0-4-amd64 #1 SMP Debian 3.16.7-2 (2014-11-06) x86_64 GNU/Linux\n$ rustc --version=verbose\nrustc 0.13.0-nightly (8bca470c5 2014-12-08 00:12:30 +0000)\nbinary: rustc\ncommit-hash: 8bca470c5acf13aa20022a2c462a89f72de721fc\ncommit-date: 2014-12-08 00:12:30 +0000\nhost: x86_64-unknown-linux-gnu\nrelease: 0.13.0-nightly\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/19692/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/19692/timeline", "performed_via_github_app": null, "state_reason": "completed"}