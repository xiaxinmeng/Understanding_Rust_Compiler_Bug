{"url": "https://api.github.com/repos/rust-lang/rust/issues/72624", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/72624/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/72624/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/72624/events", "html_url": "https://github.com/rust-lang/rust/issues/72624", "id": 625135326, "node_id": "MDU6SXNzdWU2MjUxMzUzMjY=", "number": 72624, "title": "Missing wraparound checks in DroplessArena allocation", "user": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-26T19:24:20Z", "updated_at": "2020-12-04T02:29:32Z", "closed_at": "2020-12-04T02:29:32Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "DroplessArena::alloc_raw does not check for wraparound when computing the end of the allocation, pointer arithmetic using `self.ptr` and `bytes`:\r\n\r\nhttps://github.com/rust-lang/rust/blob/aeca4d6428c52cbf2c8d1f28657b0bdf92e4ea7c/src/libarena/lib.rs#L382-L391\r\n\r\nThis can be used to make the pointer wrap around, and \"allocate\", bumping the pointer, without growing the underlying allocation.\r\n\r\nCallers `alloc` and `alloc_slice` can possibly be argued to be safe due to practical size limits on values and slices, but at least `alloc_from_iter` can be used to trigger this bug and write out of bounds of an allocation.\r\n\r\nFixes to make\r\n\r\n1. Check arithmetic and ensure the allocation can fit into the current (or any) chunk\r\n\r\n(Suggested) cleanups to make\r\n\r\n1. The arith_offset intrinsic is the same thing as `<*mut T>::wrapping_add`, and the method should be preferred.\r\n2. `alloc_raw` should return something else than `&mut [u8]`, because the contents of the slice are uninit. For example a raw slice or a slice of `MaybeUninit`.\r\n\r\nThis came up in discussion in PR #72417", "closed_by": {"login": "Dylan-DPC-zz", "id": 12371125, "node_id": "MDQ6VXNlcjEyMzcxMTI1", "avatar_url": "https://avatars.githubusercontent.com/u/12371125?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC-zz", "html_url": "https://github.com/Dylan-DPC-zz", "followers_url": "https://api.github.com/users/Dylan-DPC-zz/followers", "following_url": "https://api.github.com/users/Dylan-DPC-zz/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC-zz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC-zz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC-zz/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC-zz/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC-zz/repos", "events_url": "https://api.github.com/users/Dylan-DPC-zz/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC-zz/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/72624/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/72624/timeline", "performed_via_github_app": null, "state_reason": "completed"}