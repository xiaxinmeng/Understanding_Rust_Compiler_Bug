{"url": "https://api.github.com/repos/rust-lang/rust/issues/53502", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53502/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53502/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53502/events", "html_url": "https://github.com/rust-lang/rust/issues/53502", "id": 351919291, "node_id": "MDU6SXNzdWUzNTE5MTkyOTE=", "number": 53502, "title": "unexpected behavior - match overshadowing variables... ", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-19T17:20:11Z", "updated_at": "2018-08-19T23:35:33Z", "closed_at": "2018-08-19T23:35:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "Code flow is broken via match overshadowing DLL_PROCESS... variables.  ( See A ) \r\nNo warnings is provided and code is \"correctly\" compiled and work at runtime. \r\nUnit tests provide us that the code flow is broken by doing so.\r\nCode flow is fixed by constants instead of let variables. ( See B ) \r\n\r\nA : \r\n```rust\r\n#[no_mangle]\r\npub extern \"system\" fn DllMain(_hinstDLL: u32, fdwReason: u32, _lpvReserved: *mut std::os::raw::c_void) -> bool\r\n{\r\n    let DLL_PROCESS_ATTACH = 1;\r\n    let DLL_PROCESS_DETACH = 0;\r\n\r\n    match fdwReason\r\n    {\r\n        DLL_PROCESS_ATTACH => PROCESS_ATTACH(),\r\n        DLL_PROCESS_DETACH => PROCESS_DETACH(),\r\n        _=> false,\r\n    }\r\n}\r\n\r\nfn PROCESS_ATTACH() -> bool { demoexec(); true }\r\nfn PROCESS_DETACH() -> bool { true }\r\n\r\nfn demoexec() \r\n{ \r\n    println!(\"flag : PROCESS_ATTACH\") \r\n}\r\n```\r\n\r\nB:\r\n```rust\r\n#[no_mangle]\r\npub extern \"system\" fn DllMain(_hinstDLL: u32, fdwReason: u32, _lpvReserved: *mut std::os::raw::c_void) -> bool\r\n{\r\n    const DLL_PROCESS_ATTACH: u32 = 1;\r\n    const DLL_PROCESS_DETACH: u32 = 0;\r\n\r\n    match fdwReason\r\n    {\r\n        DLL_PROCESS_ATTACH => PROCESS_ATTACH(),\r\n        DLL_PROCESS_DETACH => PROCESS_DETACH(),\r\n        _=> false,\r\n    }\r\n}\r\n\r\nfn PROCESS_ATTACH() -> bool { demoexec(); true }\r\nfn PROCESS_DETACH() -> bool { true }\r\n\r\nfn demoexec() \r\n{ \r\n    println!(\"flag : PROCESS_ATTACH\") \r\n}\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53502/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53502/timeline", "performed_via_github_app": null, "state_reason": "completed"}