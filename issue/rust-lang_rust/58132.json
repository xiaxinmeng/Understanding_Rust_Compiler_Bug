{"url": "https://api.github.com/repos/rust-lang/rust/issues/58132", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58132/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58132/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58132/events", "html_url": "https://github.com/rust-lang/rust/issues/58132", "id": 406141637, "node_id": "MDU6SXNzdWU0MDYxNDE2Mzc=", "number": 58132, "title": "Unfortunate export of `backtrace_uncompress_zdebug`", "user": {"login": "GregBowyer", "id": 125935, "node_id": "MDQ6VXNlcjEyNTkzNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/125935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GregBowyer", "html_url": "https://github.com/GregBowyer", "followers_url": "https://api.github.com/users/GregBowyer/followers", "following_url": "https://api.github.com/users/GregBowyer/following{/other_user}", "gists_url": "https://api.github.com/users/GregBowyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/GregBowyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GregBowyer/subscriptions", "organizations_url": "https://api.github.com/users/GregBowyer/orgs", "repos_url": "https://api.github.com/users/GregBowyer/repos", "events_url": "https://api.github.com/users/GregBowyer/events{/privacy}", "received_events_url": "https://api.github.com/users/GregBowyer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-02-03T22:56:09Z", "updated_at": "2020-03-04T02:09:51Z", "closed_at": "2020-03-04T01:54:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "This might be related to #34984, basically making a rust `staticlib` to be consumed from a C program *which* is linked under GCC and is using the address sanitizer collides on `backtrace_uncompress_zdebug`\r\n\r\nThis error shows up in our builds (not cargo sorry) like so\r\n\r\n```\r\nERROR: /home/greg/.cache/bazel/_bazel_greg/c75e2059c1e63a4c3c0afb06f978fe5a/external/rure/BUILD.bazel:30:1: Linking of rule '@rure//:rure_test' failed (Exit 1) gcc failed: error executing command /usr/bin/gcc -o bazel-out/k8-fastbuild/bin/external/rure/rure_test -Wl,--gc-sections '-fuse-ld=gold' -Wl,-no-as-needed -Wl,-z,relro,-z,now -B/usr/bin -pass-exit-codes -m64 -m64 '-fsanitize=address' ... (remaining 4 argument(s) skipped)\r\nUse --sandbox_debug to see verbose messages from the sandbox\r\n/usr/bin/ld.gold: error: bazel-out/k8-fastbuild/bin/external/rure/librure_impl-444955826.a(elf.o): multiple definition of 'backtrace_uncompress_zdebug'\r\n/usr/bin/ld.gold: /usr/lib/gcc/x86_64-linux-gnu/7/libasan.a(elf.o): previous definition here\r\ncollect2: error: ld returned 1 exit status\r\nINFO: Elapsed time: 0.837s, Critical Path: 0.28s\r\nINFO: 0 processes.\r\nFAILED: Build did NOT complete successfully\r\n```\r\n\r\n## Rust version\r\n```\r\ngreg@gregslaptop ~/work/core-ticketing-host $ ./bazel-core-ticketing-host/external/rust_linux_x86_64/bin/rustc --version\r\nrustc 1.31.0 (abe02cefd 2018-12-04)\r\ngreg@gregslaptop ~/work/core-ticketing-host $\r\n```\r\n\r\n## `*backtrace*` symbols from `librure_impl.a`\r\n\r\n```\r\nbingrep -D -s backtrace_* bazel-out/k8-fastbuild/bin/external/rure/librure_impl-444955826.a  | grep backtrace\r\n```\r\n\r\n```\r\nSymbol                            Owner\r\n  backtrace_alloc                   alloc.o\r\n  backtrace_free                    alloc.o\r\n  backtrace_vector_finish           alloc.o\r\n  backtrace_vector_grow             alloc.o\r\n  backtrace_vector_release          alloc.o\r\n  backtrace_full                    backtrace.o\r\n  backtrace_dwarf_add               dwarf.o\r\n  backtrace_pcinfo                  fileline.o\r\n  backtrace_syminfo                 fileline.o\r\n  backtrace_close                   posix.o\r\n  backtrace_open                    posix.o\r\n  backtrace_get_view                read.o\r\n  backtrace_release_view            read.o\r\n  backtrace_qsort                   sort.o\r\n  backtrace_create_state            state.o\r\n  backtrace_initialize              elf.o\r\n  backtrace_uncompress_zdebug       elf.o\r\n```\r\n\r\nRure in this case is the regex-capi from the regex crate.\r\n\r\nCompiling with clang, or without asan solves this, maybe something is missing in hiding symbols in `libbacktrace`?", "closed_by": {"login": "GregBowyer", "id": 125935, "node_id": "MDQ6VXNlcjEyNTkzNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/125935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GregBowyer", "html_url": "https://github.com/GregBowyer", "followers_url": "https://api.github.com/users/GregBowyer/followers", "following_url": "https://api.github.com/users/GregBowyer/following{/other_user}", "gists_url": "https://api.github.com/users/GregBowyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/GregBowyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GregBowyer/subscriptions", "organizations_url": "https://api.github.com/users/GregBowyer/orgs", "repos_url": "https://api.github.com/users/GregBowyer/repos", "events_url": "https://api.github.com/users/GregBowyer/events{/privacy}", "received_events_url": "https://api.github.com/users/GregBowyer/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58132/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58132/timeline", "performed_via_github_app": null, "state_reason": "completed"}