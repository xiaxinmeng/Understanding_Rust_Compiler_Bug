{"url": "https://api.github.com/repos/rust-lang/rust/issues/109987", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109987/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109987/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109987/events", "html_url": "https://github.com/rust-lang/rust/issues/109987", "id": 1656441466, "node_id": "I_kwDOAAsO6M5iu0p6", "number": 109987, "title": "LLVM submodule isn't checked out when building `riscv64gc-unknown-linux-musl` target", "user": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}], "state": "closed", "locked": false, "assignee": {"login": "KittyBorgX", "id": 82328083, "node_id": "MDQ6VXNlcjgyMzI4MDgz", "avatar_url": "https://avatars.githubusercontent.com/u/82328083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KittyBorgX", "html_url": "https://github.com/KittyBorgX", "followers_url": "https://api.github.com/users/KittyBorgX/followers", "following_url": "https://api.github.com/users/KittyBorgX/following{/other_user}", "gists_url": "https://api.github.com/users/KittyBorgX/gists{/gist_id}", "starred_url": "https://api.github.com/users/KittyBorgX/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KittyBorgX/subscriptions", "organizations_url": "https://api.github.com/users/KittyBorgX/orgs", "repos_url": "https://api.github.com/users/KittyBorgX/repos", "events_url": "https://api.github.com/users/KittyBorgX/events{/privacy}", "received_events_url": "https://api.github.com/users/KittyBorgX/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "KittyBorgX", "id": 82328083, "node_id": "MDQ6VXNlcjgyMzI4MDgz", "avatar_url": "https://avatars.githubusercontent.com/u/82328083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KittyBorgX", "html_url": "https://github.com/KittyBorgX", "followers_url": "https://api.github.com/users/KittyBorgX/followers", "following_url": "https://api.github.com/users/KittyBorgX/following{/other_user}", "gists_url": "https://api.github.com/users/KittyBorgX/gists{/gist_id}", "starred_url": "https://api.github.com/users/KittyBorgX/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KittyBorgX/subscriptions", "organizations_url": "https://api.github.com/users/KittyBorgX/orgs", "repos_url": "https://api.github.com/users/KittyBorgX/repos", "events_url": "https://api.github.com/users/KittyBorgX/events{/privacy}", "received_events_url": "https://api.github.com/users/KittyBorgX/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2023-04-05T23:34:27Z", "updated_at": "2023-04-13T22:54:35Z", "closed_at": "2023-04-13T22:54:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I cloned the Rust repo with the intention of building rustc for cross-compilation to the `riscv64gc-unknown-linux-musl` target. I did the following:\n\n1. `$x.py setup` - selected the \"codegen\" option\n2. Edited the `config.toml` file to append:\n\n```\n [target.riscv64gc-unknown-linux-musl]\n ar = \"riscv64-unknown-linux-musl-ar\"\n linker = \"riscv64-unknown-linux-musl-gcc\"\n cc = \"riscv64-unknown-linux-musl-gcc\"\n cxx = \"riscv64-unknown-linux-musl-g++\"\n musl-root = \"/home/tjc/riscv64-linux-musl-cross/riscv64-linux-musl\"\n```\n3. ` ./x.py build --target  x86_64-unknown-linux-gnu --target riscv64gc-unknown-linux-musl`\n\nThis failed; the end of the output is as follows:\n\n```\n Building stage1 library artifacts (x86_64-unknown-linux-gnu) \n[snip]\n Finished release [optimized] target(s) in 43.27s\nBuilding crtbegin.o and crtend.o\nrunning: \"riscv64-unknown-linux-musl-gcc\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-march=rv64gc\" \"-mabi=lp64d\" \"-mcmodel=medany\" \"-std=c11\" \"-DCRT_HAS_INITFINI_ARRAY\" \"-DEH_USE_FRAME_REGISTRY\" \"-o\" \"/home/tjc/rust2/build/riscv64gc-unknown-linux-musl/native/crt/crtbegin.o\" \"-c\" \"/home/tjc/rust2/src/llvm-project/compiler-rt/lib/crt/crtbegin.c\"\ncargo:warning=cc1: fatal error: /home/tjc/rust2/src/llvm-project/compiler-rt/lib/crt/crtbegin.c: No such file or directory\ncargo:warning=compilation terminated.\nexit status: 1\n\n\nerror occurred: Command \"riscv64-unknown-linux-musl-gcc\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-march=rv64gc\" \"-mabi=lp64d\" \"-mcmodel=medany\" \"-std=c11\" \"-DCRT_HAS_INITFINI_ARRAY\" \"-DEH_USE_FRAME_REGISTRY\" \"-o\" \"/home/tjc/rust2/build/riscv64gc-unknown-linux-musl/native/crt/crtbegin.o\" \"-c\" \"/home/tjc/rust2/src/llvm-project/compiler-rt/lib/crt/crtbegin.c\" with args \"riscv64-unknown-linux-musl-gcc\" did not execute successfully (status code exit status: 1).\n\n\nBuild completed unsuccessfully in 0:02:32\n```\n\nAfter I executed `git submodule update --init` and retried the build command, the LLVM submodule was checked out and the build was able to make progress. It seems like this should be done automatically. I'm not sure if the issue is specific to this target or if it's happening with other cross-compilation targets.\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"KittyBorgX\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109987/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109987/timeline", "performed_via_github_app": null, "state_reason": "completed"}