{"url": "https://api.github.com/repos/rust-lang/rust/issues/83784", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83784/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83784/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83784/events", "html_url": "https://github.com/rust-lang/rust/issues/83784", "id": 849260119, "node_id": "MDU6SXNzdWU4NDkyNjAxMTk=", "number": 83784, "title": "rustdoc: follow-up work for `--emit=toolchain-shared-resources`", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 2795630663, "node_id": "MDU6TGFiZWwyNzk1NjMwNjYz", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-docs-rs", "name": "T-docs-rs", "color": "bfd4f2", "default": false, "description": "Relevant to the docs-rs subteam, which will review and decide on the PR/issue."}, {"id": 5226909857, "node_id": "LA_kwDOAAsO6M8AAAABN4xQoQ", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cli", "name": "A-cli", "color": "f7e101", "default": false, "description": "Area: Command line interface to the compiler."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-04-02T14:46:28Z", "updated_at": "2023-03-05T01:55:15Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nThank you for creating a tracking issue! \ud83d\udcdc Tracking issues are for tracking a\r\nfeature from implementation to stabilisation. Make sure to include the relevant\r\nRFC for the feature if it has one. Otherwise provide a short summary of the\r\nfeature and link any relevant PRs or issues, and remove any sections that are\r\nnot relevant to the feature.\r\n\r\nRemember to add team labels to the tracking issue.\r\nFor a language team feature, this would e.g., be `T-lang`.\r\nSuch a feature should also be labeled with e.g., `F-my_feature`.\r\nThis label is used to associate issues (e.g., bugs and design questions) to the feature.\r\n-->\r\n\r\nThis is a tracking issue for the unstable feature `--emit=toolchain-shared-resources`, which requires `-Z unstable-options`. This feature is not meant to ever be stabilized; it's used by docs.rs to avoid copying the same files for each crate. Users other than docs.rs are not supported.\r\n\r\n### Unresolved Questions\r\n\r\n- Can we get rid of `unversioned-shared-resources` completely? It's unclear what the difference between a versioned and unversioned resource is; I don't know if rustdoc can promise its files will *never* change even across toolchains.\r\n- `main.js` is currently marked as a toolchain resource, which is wrong if the user passes `--theme` in RUSTDOCFLAGS.\r\n\r\n### Implementation history\r\n\r\n- [x] Initial implementation: https://github.com/rust-lang/rust/pull/83478\r\n- [x] Use in docs.rs https://github.com/rust-lang/docs.rs/pull/1340\r\n- [x] Remove `--print=unversioned-files`: https://github.com/rust-lang/rust/pull/85770\r\n\r\n<h3 id=\"why-does-this-feature-exist\">Why does this feature exist?</h3>\r\n\r\nDocs.rs has been having quite a lot of trouble with essential files. Here are the recent developments:\r\n\r\n1. rustdoc added a new crates.js file a few weeks ago, breaking search for all newly built crates https://github.com/rust-lang/docs.rs/issues/1300\r\n2. dtolnay added crates.js and also some other essential files that were missing https://github.com/rust-lang/docs.rs/pull/1301\r\n3. It turned out the other essential files had a typo, breaking all builds https://github.com/rust-lang/docs.rs/issues/1305. the typo was fixed by https://github.com/rust-lang/docs.rs/pull/1308\r\n4. rustdoc wanted to start adding *more* essential files (https://github.com/rust-lang/rust/pull/82732, https://github.com/rust-lang/rust/pull/80705) and I got fed up of dealing with it so I opened https://github.com/rust-lang/docs.rs/pull/1312\r\n5. rust-lang/docs.rs#1312 had a bug (https://github.com/rust-lang/docs.rs/pull/1312#issuecomment-803616354) if we copy more files than necessary. I opened https://github.com/rust-lang/docs.rs/pull/1324 giving precedence to local shared files over global ones which avoids the bug.\r\n6. https://github.com/rust-lang/docs.rs/pull/1324 broke docs that weren't using `--extern-html-root-url` (https://github.com/rust-lang/docs.rs/issues/1327#issuecomment-804447887). The tracking issue for rebuilding those is https://github.com/rust-lang/docs.rs/issues/1181.\r\n\r\nIn summary, docs.rs can't copy fewer shared files than rustdoc generates, and due to 2 months of broken builds about 3 years ago, it also can't copy *more*. So there has to be a way to know exactly which files should be shared and which shouldn't.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83784/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83784/timeline", "performed_via_github_app": null, "state_reason": null}