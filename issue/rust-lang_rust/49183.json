{"url": "https://api.github.com/repos/rust-lang/rust/issues/49183", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49183/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49183/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49183/events", "html_url": "https://github.com/rust-lang/rust/issues/49183", "id": 306591867, "node_id": "MDU6SXNzdWUzMDY1OTE4Njc=", "number": 49183, "title": "Segfault using `vec!` when running under valgrind", "user": {"login": "HeroicKatora", "id": 5550310, "node_id": "MDQ6VXNlcjU1NTAzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5550310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HeroicKatora", "html_url": "https://github.com/HeroicKatora", "followers_url": "https://api.github.com/users/HeroicKatora/followers", "following_url": "https://api.github.com/users/HeroicKatora/following{/other_user}", "gists_url": "https://api.github.com/users/HeroicKatora/gists{/gist_id}", "starred_url": "https://api.github.com/users/HeroicKatora/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HeroicKatora/subscriptions", "organizations_url": "https://api.github.com/users/HeroicKatora/orgs", "repos_url": "https://api.github.com/users/HeroicKatora/repos", "events_url": "https://api.github.com/users/HeroicKatora/events{/privacy}", "received_events_url": "https://api.github.com/users/HeroicKatora/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2018-03-19T19:01:15Z", "updated_at": "2019-02-28T13:57:36Z", "closed_at": "2018-11-03T15:09:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Allocations bigger than `0x2000` with `vec!` crash with a segfault when running under valgrind. \r\n\r\n```\r\nfn main() {\r\n    let mut data = vec![0; 0x2001]; // while 0x2000 runs fine\r\n}\r\n```\r\n\r\nThis was first noticed and reported as [an issue to `image`](https://github.com/PistonDevelopers/image/issues/719).\r\n\r\nMeta\r\n-----\r\n\r\n<details> \r\n<summary>rustc - 1.26.0-nightly</summary>\r\n<pre><code>\r\nrustc 1.26.0-nightly (adf2135ad 2018-03-17)\r\nbinary: rustc\r\ncommit-hash: adf2135adc4a65a78ba053f04c29d7fe0468eb87\r\ncommit-date: 2018-03-17\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.26.0-nightly\r\nLLVM version: 6.0\r\n</code></pre>\r\n</details>\r\n\r\n<details>\r\n<summary>valgrind - 3.13.0</summary>\r\n<pre><code>valgrind-3.13.0-16445:16446-vex-3396</blockquote></code></pre>\r\n</details>\r\n\r\n<details>\r\n<summary>Full backtrace</summary>\r\n<pre><code>\r\n$ valgrind target/release/hello_world  \r\n==10398== Memcheck, a memory error detector\r\n==10398== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==10398== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\r\n==10398== Command: target/release/hello_world\r\n==10398== \r\n==10398== Invalid read of size 8\r\n==10398==    at 0x129DD7: je_arena_sdalloc (arena.h:1516)\r\n==10398==    by 0x129DD7: je_isdalloct (jemalloc_internal.h:1195)\r\n==10398==    by 0x129DD7: je_isqalloc (jemalloc_internal.h:1205)\r\n==10398==    by 0x129DD7: isfree (jemalloc.c:1921)\r\n==10398==    by 0x129DD7: sdallocx (jemalloc.c:2669)\r\n==10398==    by 0x10F24E: hello_world::main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x10F1F2: std::rt::lang_start::{{closure}} (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x110FE7: {{closure}} (rt.rs:59)\r\n==10398==    by 0x110FE7: _ZN3std9panicking3try7do_call17h64f9d8eb811b164fE.llvm.10326519180759561980 (panicking.rs:306)\r\n==10398==    by 0x121C0E: __rust_maybe_catch_panic (lib.rs:102)\r\n==10398==    by 0x110205: try<i32,closure> (panicking.rs:285)\r\n==10398==    by 0x110205: catch_unwind<closure,i32> (panic.rs:361)\r\n==10398==    by 0x110205: std::rt::lang_start_internal (rt.rs:58)\r\n==10398==    by 0x10F2A3: main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==  Address 0x5e00000 is in a rwx anonymous segment\r\n==10398== \r\n==10398== Invalid read of size 4\r\n==10398==    at 0x524E9E0: pthread_mutex_lock (in /usr/lib/libpthread-2.26.so)\r\n==10398==    by 0x1336F5: je_malloc_mutex_lock (mutex.h:101)\r\n==10398==    by 0x1336F5: je_arena_dalloc_large (arena.c:3075)\r\n==10398==    by 0x10F24E: hello_world::main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x10F1F2: std::rt::lang_start::{{closure}} (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x110FE7: {{closure}} (rt.rs:59)\r\n==10398==    by 0x110FE7: _ZN3std9panicking3try7do_call17h64f9d8eb811b164fE.llvm.10326519180759561980 (panicking.rs:306)\r\n==10398==    by 0x121C0E: __rust_maybe_catch_panic (lib.rs:102)\r\n==10398==    by 0x110205: try<i32,closure> (panicking.rs:285)\r\n==10398==    by 0x110205: catch_unwind<closure,i32> (panic.rs:361)\r\n==10398==    by 0x110205: std::rt::lang_start_internal (rt.rs:58)\r\n==10398==    by 0x10F2A3: main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==  Address 0x400000 is not stack'd, malloc'd or (recently) free'd\r\n==10398== \r\n==10398== \r\n==10398== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==10398==  Access not within mapped region at address 0x400000\r\n==10398==    at 0x524E9E0: pthread_mutex_lock (in /usr/lib/libpthread-2.26.so)\r\n==10398==    by 0x1336F5: je_malloc_mutex_lock (mutex.h:101)\r\n==10398==    by 0x1336F5: je_arena_dalloc_large (arena.c:3075)\r\n==10398==    by 0x10F24E: hello_world::main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x10F1F2: std::rt::lang_start::{{closure}} (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==    by 0x110FE7: {{closure}} (rt.rs:59)\r\n==10398==    by 0x110FE7: _ZN3std9panicking3try7do_call17h64f9d8eb811b164fE.llvm.10326519180759561980 (panicking.rs:306)\r\n==10398==    by 0x121C0E: __rust_maybe_catch_panic (lib.rs:102)\r\n==10398==    by 0x110205: try<i32,closure> (panicking.rs:285)\r\n==10398==    by 0x110205: catch_unwind<closure,i32> (panic.rs:361)\r\n==10398==    by 0x110205: std::rt::lang_start_internal (rt.rs:58)\r\n==10398==    by 0x10F2A3: main (in /home/andreas/code/sandbox/image_issue/target/release/hello_world)\r\n==10398==  If you believe this happened as a result of a stack\r\n==10398==  overflow in your program's main thread (unlikely but\r\n==10398==  possible), you can try to increase the size of the\r\n==10398==  main thread stack using the --main-stacksize= flag.\r\n==10398==  The main thread stack size used in this run was 8388608.\r\n==10398== \r\n==10398== HEAP SUMMARY:\r\n==10398==     in use at exit: 32,804 bytes in 2 blocks\r\n==10398==   total heap usage: 7 allocs, 5 frees, 34,772 bytes allocated\r\n==10398== \r\n==10398== LEAK SUMMARY:\r\n==10398==    definitely lost: 32,772 bytes in 1 blocks\r\n==10398==    indirectly lost: 0 bytes in 0 blocks\r\n==10398==      possibly lost: 0 bytes in 0 blocks\r\n==10398==    still reachable: 32 bytes in 1 blocks\r\n==10398==         suppressed: 0 bytes in 0 blocks\r\n==10398== Rerun with --leak-check=full to see details of leaked memory\r\n==10398== \r\n==10398== For counts of detected and suppressed errors, rerun with: -v\r\n==10398== ERROR SUMMARY: 3 errors from 2 contexts (suppressed: 0 from 0)\r\nSpeicherzugriffsfehler (Speicherabzug geschrieben)\r\n</pre></code>\r\n</details>", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49183/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49183/timeline", "performed_via_github_app": null, "state_reason": "completed"}