{"url": "https://api.github.com/repos/rust-lang/rust/issues/60824", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60824/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60824/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60824/events", "html_url": "https://github.com/rust-lang/rust/issues/60824", "id": 443897031, "node_id": "MDU6SXNzdWU0NDM4OTcwMzE=", "number": 60824, "title": "Wrong pattern matching on enums", "user": {"login": "crone123", "id": 47423202, "node_id": "MDQ6VXNlcjQ3NDIzMjAy", "avatar_url": "https://avatars.githubusercontent.com/u/47423202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crone123", "html_url": "https://github.com/crone123", "followers_url": "https://api.github.com/users/crone123/followers", "following_url": "https://api.github.com/users/crone123/following{/other_user}", "gists_url": "https://api.github.com/users/crone123/gists{/gist_id}", "starred_url": "https://api.github.com/users/crone123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crone123/subscriptions", "organizations_url": "https://api.github.com/users/crone123/orgs", "repos_url": "https://api.github.com/users/crone123/repos", "events_url": "https://api.github.com/users/crone123/events{/privacy}", "received_events_url": "https://api.github.com/users/crone123/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-05-14T12:50:52Z", "updated_at": "2019-05-15T07:55:24Z", "closed_at": "2019-05-14T13:51:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\nThere is a bug with enums and pattern matching, please try this minimal code:\r\n\r\n```\r\npub enum TEST\r\n{\r\n\tA, B, C,\r\n}\r\nimpl TEST\r\n{\r\n\tpub fn match_half(&self) -> String\r\n\t{\r\n\t\tmatch(self)\r\n\t\t{\r\n\t\t\tA => String::from(\"A\"),\r\n\t\t\tB => String::from(\"B\"),\r\n\t\t\tC => String::from(\"C\"),\r\n\t\t}\r\n\t}\r\n\tpub fn match_full(&self) -> String\r\n        {\r\n                match(self)\r\n                {\r\n                        TEST::A => String::from(\"A\"),\r\n                        TEST::B => String::from(\"B\"),\r\n                        TEST::C => String::from(\"C\"),\r\n                }\r\n        }\r\n}\r\nfn main() {\r\n\tlet v = vec!(TEST::A, TEST::B, TEST::C);\r\n\tfor i in v\r\n\t{\r\n\t\tprintln!(\"Half: {} / Full: {}\", i.match_half(), i.match_full());\r\n\t}\r\n}\r\n```\r\n\r\nWhat I call \"half\" is when you type \"A\" instead of \"TEST::A\", and when I call \"full\" is the regular \"TEST::A\".\r\n\r\nResult:\r\n\r\n```\r\nHalf: A / Full: A\r\nHalf: A / Full: B\r\nHalf: A / Full: C\r\n```\r\nAttended result:\r\n\r\n```\r\nHalf: A / Full: A\r\nHalf: B / Full: B\r\nHalf: C / Full: C\r\n```\r\n\r\nYou see that, when you use the \"half\" notation, the pattern matching will always use the first case which is not the good behaviour.\r\nThis bug can make programs very hard to debug because generally we read: \"Ok, it's a pattern matching with rust, so it's safe\", but not here.\r\n\r\nThis bug was found with:\r\ncargo 1.36.0-nightly (b6581d383 2019-04-16)\r\nrustc 1.36.0-nightly (5d20ff4d2 2019-04-18)\r\n\r\nOn Ubuntu 19.04 LTS.\r\n\r\nNote that is you do a pattern matching to implement a trait the bug is the same, I found this by implementing ToString in one of my projects.\r\n\r\nThank you !", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60824/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60824/timeline", "performed_via_github_app": null, "state_reason": "completed"}