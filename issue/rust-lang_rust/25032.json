{"url": "https://api.github.com/repos/rust-lang/rust/issues/25032", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25032/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25032/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25032/events", "html_url": "https://github.com/rust-lang/rust/issues/25032", "id": 72464770, "node_id": "MDU6SXNzdWU3MjQ2NDc3MA==", "number": 25032, "title": "Building static lib for Android: no archive symbol table", "user": {"login": "pakoito", "id": 514871, "node_id": "MDQ6VXNlcjUxNDg3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/514871?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pakoito", "html_url": "https://github.com/pakoito", "followers_url": "https://api.github.com/users/pakoito/followers", "following_url": "https://api.github.com/users/pakoito/following{/other_user}", "gists_url": "https://api.github.com/users/pakoito/gists{/gist_id}", "starred_url": "https://api.github.com/users/pakoito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pakoito/subscriptions", "organizations_url": "https://api.github.com/users/pakoito/orgs", "repos_url": "https://api.github.com/users/pakoito/repos", "events_url": "https://api.github.com/users/pakoito/events{/privacy}", "received_events_url": "https://api.github.com/users/pakoito/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-05-01T16:14:14Z", "updated_at": "2015-05-05T00:18:32Z", "closed_at": "2015-05-01T21:15:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm on an OSX 10.10.2 machine, with the latest Rust nightly `rustc 1.1.0-dev (aecf3d8b6 2015-05-01) (built 2015-05-01)` on a homebuilt version with Android support setup via https://github.com/rust-lang/rust-wiki-backup/blob/master/Doc-building-for-android.md\n\nI'm trying a minimal case with \n\n```\n// lib.rs\n#[no_mangle]\npub extern fn double_input(input: i32) -> i32 {\n    input * 2\n}\n\n//thing.c\n#include <stdint.h>\n\nextern int32_t double_input(int32_t input);\n```\n\nlibrust.a lib is built using `rustc --target=arm-linux-androideabi -C linker=$ANDROID_TOOLCHAIN/bin/arm-linux-androideabi-gcc -C link-args=-pie src/lib.rs --crate-type=staticlib`\n\nand linking against my simple project \n\n```\nLOCAL_PATH := $(call my-dir)\ninclude $(CLEAR_VARS)\n\nLOCAL_MODULE := rust_prebuilt\nLOCAL_SRC_FILES := librust.a\ninclude $(PREBUILT_STATIC_LIBRARY)\n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE := HelloRust\nLOCAL_SRC_FILES := thing.c\nLOCAL_STATIC_LIBRARIES += rust_prebuilt\n\ninclude $(BUILD_SHARED_LIBRARY)\n```\n\nAfter all those steps, the build process fails during android linkage:\n\n```\ntoolchains/arm-linux-androideabi-4.8/prebuilt/darwin-x86_64/bin/../lib/gcc/arm-linux-androideabi/4.8/../../../../arm-linux-androideabi/bin/ld: \nerror: /Users/pakoito/Rust/RustyAndroid/app/src/main/jni/librust.a: no archive symbol table (run ranlib)\ncollect2: error: ld returned 1 exit status\n```\n\nAfter running ranlib on the file I get that's empty\n\n```\n$ranlib liblib.a \nwarning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: warning for library: liblib.a the table of contents is empty (no object file members in the library define global symbols)\n```\n\n`ar t` result:\n\n```\n__.SYMDEF SORTED\nlib.o\nr-morestack-morestack.o\nr-compiler-rt-absvdi2.o\nr-compiler-rt-absvsi2.o\nr-compiler-rt-absvti2.o\nr-compiler-rt-adddf3.o\nr-compiler-rt-adddf3vfp.o\nr-compiler-rt-addsf3.o\nr-compiler-rt-addsf3vfp.o\nr-compiler-rt-addvdi3.o\nr-compiler-rt-addvsi3.o\nr-compiler-rt-addvti3.o\nr-compiler-rt-aeabi_dcmp.o\nr-compiler-rt-aeabi_fcmp.o\nr-compiler-rt-aeabi_idivmod.o\nr-compiler-rt-aeabi_ldivmod.o\nr-compiler-rt-aeabi_memcmp.o\nr-compiler-rt-aeabi_memcpy.o\nr-compiler-rt-aeabi_memmove.o\nr-compiler-rt-aeabi_memset.o\nr-compiler-rt-aeabi_uidivmod.o\nr-compiler-rt-aeabi_uldivmod.o\nr-compiler-rt-apple_versioning.o\nr-compiler-rt-ashldi3.o\nr-compiler-rt-ashlti3.o\nr-compiler-rt-ashrdi3.o\nr-compiler-rt-ashrti3.o\nr-compiler-rt-bswapdi2.o\nr-compiler-rt-bswapsi2.o\nr-compiler-rt-clear_cache.o\nr-compiler-rt-clzdi2.o\nr-compiler-rt-clzsi2.o\nr-compiler-rt-clzti2.o\nr-compiler-rt-cmpdi2.o\nr-compiler-rt-cmpti2.o\nr-compiler-rt-comparedf2.o\nr-compiler-rt-comparesf2.o\nr-compiler-rt-comparetf2.o\nr-compiler-rt-ctzdi2.o\nr-compiler-rt-ctzsi2.o\nr-compiler-rt-ctzti2.o\nr-compiler-rt-divdc3.o\nr-compiler-rt-divdf3.o\nr-compiler-rt-divdf3vfp.o\nr-compiler-rt-divdi3.o\nr-compiler-rt-divmoddi4.o\nr-compiler-rt-divmodsi4.o\nr-compiler-rt-divsc3.o\nr-compiler-rt-divsf3.o\nr-compiler-rt-divsf3vfp.o\nr-compiler-rt-divsi3.o\nr-compiler-rt-divti3.o\nr-compiler-rt-divxc3.o\nr-compiler-rt-eprintf.o\nr-compiler-rt-eqdf2vfp.o\nr-compiler-rt-eqsf2vfp.o\nr-compiler-rt-extendsfdf2.o\nr-compiler-rt-extendsfdf2vfp.o\nr-compiler-rt-ffsdi2.o\nr-compiler-rt-ffsti2.o\nr-compiler-rt-fixdfdi.o\nr-compiler-rt-fixdfsi.o\nr-compiler-rt-fixdfsivfp.o\nr-compiler-rt-fixdfti.o\nr-compiler-rt-fixsfdi.o\nr-compiler-rt-fixsfsi.o\nr-compiler-rt-fixsfsivfp.o\nr-compiler-rt-fixsfti.o\nr-compiler-rt-fixunsdfdi.o\nr-compiler-rt-fixunsdfsi.o\nr-compiler-rt-fixunsdfsivfp.o\nr-compiler-rt-fixunsdfti.o\nr-compiler-rt-fixunssfdi.o\nr-compiler-rt-fixunssfsi.o\nr-compiler-rt-fixunssfsivfp.o\nr-compiler-rt-fixunssfti.o\nr-compiler-rt-fixunsxfdi.o\nr-compiler-rt-fixunsxfsi.o\nr-compiler-rt-fixunsxfti.o\nr-compiler-rt-fixxfdi.o\nr-compiler-rt-fixxfti.o\nr-compiler-rt-floatdidf.o\nr-compiler-rt-floatdisf.o\nr-compiler-rt-floatdixf.o\nr-compiler-rt-floatsidf.o\nr-compiler-rt-floatsidfvfp.o\nr-compiler-rt-floatsisf.o\nr-compiler-rt-floatsisfvfp.o\nr-compiler-rt-floattidf.o\nr-compiler-rt-floattisf.o\nr-compiler-rt-floattixf.o\nr-compiler-rt-floatundidf.o\nr-compiler-rt-floatundisf.o\nr-compiler-rt-floatundixf.o\nr-compiler-rt-floatunsidf.o\nr-compiler-rt-floatunsisf.o\nr-compiler-rt-floatunssidfvfp.o\nr-compiler-rt-floatunssisfvfp.o\nr-compiler-rt-floatuntidf.o\nr-compiler-rt-floatuntisf.o\nr-compiler-rt-floatuntixf.o\nr-compiler-rt-gcc_personality_v0.o\nr-compiler-rt-gedf2vfp.o\nr-compiler-rt-gesf2vfp.o\nr-compiler-rt-gtdf2vfp.o\nr-compiler-rt-gtsf2vfp.o\nr-compiler-rt-int_util.o\nr-compiler-rt-ledf2vfp.o\nr-compiler-rt-lesf2vfp.o\nr-compiler-rt-lshrdi3.o\nr-compiler-rt-lshrti3.o\nr-compiler-rt-ltdf2vfp.o\nr-compiler-rt-ltsf2vfp.o\nr-compiler-rt-moddi3.o\nr-compiler-rt-modsi3.o\nr-compiler-rt-modti3.o\nr-compiler-rt-muldc3.o\nr-compiler-rt-muldf3.o\nr-compiler-rt-muldf3vfp.o\nr-compiler-rt-muldi3.o\nr-compiler-rt-mulodi4.o\nr-compiler-rt-mulosi4.o\nr-compiler-rt-muloti4.o\nr-compiler-rt-mulsc3.o\nr-compiler-rt-mulsf3.o\nr-compiler-rt-mulsf3vfp.o\nr-compiler-rt-multi3.o\nr-compiler-rt-mulvdi3.o\nr-compiler-rt-mulvsi3.o\nr-compiler-rt-mulvti3.o\nr-compiler-rt-mulxc3.o\nr-compiler-rt-nedf2vfp.o\nr-compiler-rt-negdf2.o\nr-compiler-rt-negdf2vfp.o\nr-compiler-rt-negdi2.o\nr-compiler-rt-negsf2.o\nr-compiler-rt-negsf2vfp.o\nr-compiler-rt-negti2.o\nr-compiler-rt-negvdi2.o\nr-compiler-rt-negvsi2.o\nr-compiler-rt-negvti2.o\nr-compiler-rt-nesf2vfp.o\nr-compiler-rt-paritydi2.o\nr-compiler-rt-paritysi2.o\nr-compiler-rt-parityti2.o\nr-compiler-rt-popcountdi2.o\nr-compiler-rt-popcountsi2.o\nr-compiler-rt-popcountti2.o\nr-compiler-rt-powidf2.o\nr-compiler-rt-powisf2.o\nr-compiler-rt-powitf2.o\nr-compiler-rt-powixf2.o\nr-compiler-rt-restore_vfp_d8_d15_regs.o\nr-compiler-rt-save_vfp_d8_d15_regs.o\nr-compiler-rt-subdf3.o\nr-compiler-rt-subdf3vfp.o\nr-compiler-rt-subsf3.o\nr-compiler-rt-subsf3vfp.o\nr-compiler-rt-subvdi3.o\nr-compiler-rt-subvsi3.o\nr-compiler-rt-subvti3.o\nr-compiler-rt-switch16.o\nr-compiler-rt-switch32.o\nr-compiler-rt-switch8.o\nr-compiler-rt-switchu8.o\nr-compiler-rt-sync_synchronize.o\nr-compiler-rt-trampoline_setup.o\nr-compiler-rt-truncdfsf2.o\nr-compiler-rt-truncdfsf2vfp.o\nr-compiler-rt-ucmpdi2.o\nr-compiler-rt-ucmpti2.o\nr-compiler-rt-udivdi3.o\nr-compiler-rt-udivmoddi4.o\nr-compiler-rt-udivmodsi4.o\nr-compiler-rt-udivmodti4.o\nr-compiler-rt-udivsi3.o\nr-compiler-rt-udivti3.o\nr-compiler-rt-umoddi3.o\nr-compiler-rt-umodsi3.o\nr-compiler-rt-umodti3.o\nr-compiler-rt-unorddf2vfp.o\nr-compiler-rt-unordsf2vfp.o\nr-std-std-4e7c5e5c.o\nr-std-r-rust_builtin-rust_builtin.o\nr-std-r-rust_builtin-rust_android_dummy.o\nr-std-r-backtrace-atomic.o\nr-std-r-backtrace-dwarf.o\nr-std-r-backtrace-fileline.o\nr-std-r-backtrace-posix.o\nr-std-r-backtrace-print.o\nr-std-r-backtrace-sort.o\nr-std-r-backtrace-state.o\nr-std-r-backtrace-backtrace.o\nr-std-r-backtrace-simple.o\nr-std-r-backtrace-elf.o\nr-std-r-backtrace-mmapio.o\nr-std-r-backtrace-mmap.o\nr-std-r-rustrt_native-rust_try.o\nr-std-r-rustrt_native-record_sp.o\nr-collections-collections-4e7c5e5c.o\nr-rustc_unicode-rustc_unicode-4e7c5e5c.o\nr-rand-rand-4e7c5e5c.o\nr-alloc-alloc-4e7c5e5c.o\nr-alloc-r-jemalloc-jemalloc.pic.o\nr-alloc-r-jemalloc-arena.pic.o\nr-alloc-r-jemalloc-atomic.pic.o\nr-alloc-r-jemalloc-base.pic.o\nr-alloc-r-jemalloc-bitmap.pic.o\nr-alloc-r-jemalloc-chunk.pic.o\nr-alloc-r-jemalloc-chunk_dss.pic.o\nr-alloc-r-jemalloc-chunk_mmap.pic.o\nr-alloc-r-jemalloc-ckh.pic.o\nr-alloc-r-jemalloc-ctl.pic.o\nr-alloc-r-jemalloc-extent.pic.o\nr-alloc-r-jemalloc-hash.pic.o\nr-alloc-r-jemalloc-huge.pic.o\nr-alloc-r-jemalloc-mb.pic.o\nr-alloc-r-jemalloc-mutex.pic.o\nr-alloc-r-jemalloc-prof.pic.o\nr-alloc-r-jemalloc-quarantine.pic.o\nr-alloc-r-jemalloc-rtree.pic.o\nr-alloc-r-jemalloc-stats.pic.o\nr-alloc-r-jemalloc-tcache.pic.o\nr-alloc-r-jemalloc-util.pic.o\nr-alloc-r-jemalloc-tsd.pic.o\nr-alloc-r-jemalloc-valgrind.pic.o\nr-libc-libc-4e7c5e5c.o\nr-core-core-4e7c5e5c.o\n```\n\nResult of  `$ANDROID_TOOLCHAIN/bin/arm-linux-androideabi-nm lib.o`\n\n```\n         U _GLOBAL_OFFSET_TABLE_\n00000000 t _ZN12double_input10__rust_abiE\n         U _ZN9panicking5panic20h0c7496eebc6bd7aapLyE\n         U __aeabi_unwind_cpp_pr0\n         U __morestack\n00000000 r const782\n00000000 T double_input\n00000000 d panic_loc786\n00000000 r str783\n00000000 r str785\n```\n", "closed_by": {"login": "pakoito", "id": 514871, "node_id": "MDQ6VXNlcjUxNDg3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/514871?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pakoito", "html_url": "https://github.com/pakoito", "followers_url": "https://api.github.com/users/pakoito/followers", "following_url": "https://api.github.com/users/pakoito/following{/other_user}", "gists_url": "https://api.github.com/users/pakoito/gists{/gist_id}", "starred_url": "https://api.github.com/users/pakoito/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pakoito/subscriptions", "organizations_url": "https://api.github.com/users/pakoito/orgs", "repos_url": "https://api.github.com/users/pakoito/repos", "events_url": "https://api.github.com/users/pakoito/events{/privacy}", "received_events_url": "https://api.github.com/users/pakoito/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25032/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25032/timeline", "performed_via_github_app": null, "state_reason": "completed"}