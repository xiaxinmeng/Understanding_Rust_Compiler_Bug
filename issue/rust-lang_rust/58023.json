{"url": "https://api.github.com/repos/rust-lang/rust/issues/58023", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58023/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58023/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58023/events", "html_url": "https://github.com/rust-lang/rust/issues/58023", "id": 405230565, "node_id": "MDU6SXNzdWU0MDUyMzA1NjU=", "number": 58023, "title": "rustc 1.34.0-nightly (da6ab956e 2019-01-27) and later make encoding_rs with packed_simd go from one .s to 31 .rcgu.s files", "user": {"login": "hsivonen", "id": 478856, "node_id": "MDQ6VXNlcjQ3ODg1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/478856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hsivonen", "html_url": "https://github.com/hsivonen", "followers_url": "https://api.github.com/users/hsivonen/followers", "following_url": "https://api.github.com/users/hsivonen/following{/other_user}", "gists_url": "https://api.github.com/users/hsivonen/gists{/gist_id}", "starred_url": "https://api.github.com/users/hsivonen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hsivonen/subscriptions", "organizations_url": "https://api.github.com/users/hsivonen/orgs", "repos_url": "https://api.github.com/users/hsivonen/repos", "events_url": "https://api.github.com/users/hsivonen/events{/privacy}", "received_events_url": "https://api.github.com/users/hsivonen/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2019-01-31T12:49:20Z", "updated_at": "2019-02-05T11:12:03Z", "closed_at": "2019-02-05T11:12:03Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "# Steps to reproduce\r\n\r\n1. Clone https://github.com/hsivonen/encoding_rs\r\n2. `cd encoding_rs`\r\n3. `git checkout simd`\r\n4. `rustup default rustup default 1.32.0`\r\n5. `rustup target add  armv7-unknown-linux-gnueabihf`\r\n6. `RUSTC_BOOTSTRAP=1 RUSTFLAGS='-C target_feature=+neon,+thumb-mode,+thumb2' cargo rustc --target armv7-unknown-linux-gnueabihf --features simd-accel --release -- --emit asm`\r\n7. `find target | grep -c '\\.s$'`\r\n8. `rm -rf target`\r\n9. `git checkout packed_simd`\r\n10. `rustup default nightly`\r\n11. `rustup target add thumbv7neon-unknown-linux-gnueabihf`\r\n12. `cargo rustc --target thumbv7neon-unknown-linux-gnueabihf --features simd-accel --release -- --emit asm`\r\n13. `find target | grep -c '\\.s$'`\r\n\r\n# Actual results\r\n\r\nIn the `simd` + Rust 1.32 case, there is one `.s` file. In the `packed_simd` + Rust 1.34 case, `encoding_rs` is split across 31 `.s` files. These are all `.rcgu.s` files. Examining these files suggests lesser inlining within `encoding_rs`, although code from `packed_simd` and `core::arch` appears to have gotten inlined.\r\n\r\n# Expected result\r\n\r\nExpected one `.s` file with the same level of inlining in the `packed_simd` + Rust 1.34 case as with the `simd` + Rust 1.32 case.\r\n\r\n# Additional info\r\n\r\nWhen building an actual binary from a different top-level crate (`encoding_bench`), the  `packed_simd` + Rust 1.34 case regresses performance relative to the `simd` + Rust 1.32 on Exynos 5.", "closed_by": {"login": "hsivonen", "id": 478856, "node_id": "MDQ6VXNlcjQ3ODg1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/478856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hsivonen", "html_url": "https://github.com/hsivonen", "followers_url": "https://api.github.com/users/hsivonen/followers", "following_url": "https://api.github.com/users/hsivonen/following{/other_user}", "gists_url": "https://api.github.com/users/hsivonen/gists{/gist_id}", "starred_url": "https://api.github.com/users/hsivonen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hsivonen/subscriptions", "organizations_url": "https://api.github.com/users/hsivonen/orgs", "repos_url": "https://api.github.com/users/hsivonen/repos", "events_url": "https://api.github.com/users/hsivonen/events{/privacy}", "received_events_url": "https://api.github.com/users/hsivonen/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58023/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58023/timeline", "performed_via_github_app": null, "state_reason": "completed"}