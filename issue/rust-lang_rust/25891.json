{"url": "https://api.github.com/repos/rust-lang/rust/issues/25891", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/25891/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/25891/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/25891/events", "html_url": "https://github.com/rust-lang/rust/issues/25891", "id": 82620643, "node_id": "MDU6SXNzdWU4MjYyMDY0Mw==", "number": 25891, "title": "Linking a dylib/DLL is broken on windows", "user": {"login": "alexchandel", "id": 637714, "node_id": "MDQ6VXNlcjYzNzcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/637714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexchandel", "html_url": "https://github.com/alexchandel", "followers_url": "https://api.github.com/users/alexchandel/followers", "following_url": "https://api.github.com/users/alexchandel/following{/other_user}", "gists_url": "https://api.github.com/users/alexchandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexchandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexchandel/subscriptions", "organizations_url": "https://api.github.com/users/alexchandel/orgs", "repos_url": "https://api.github.com/users/alexchandel/repos", "events_url": "https://api.github.com/users/alexchandel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexchandel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-05-29T23:00:53Z", "updated_at": "2015-05-29T23:11:25Z", "closed_at": "2015-05-29T23:11:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "Attempting to link a crate as a \"dylib\" on windows, specifically the nightly i686-pc-windows-gnu, to produce a DLL results in a linker error if that crate uses array subscripting. For example, compiling with no options,\n\n``` rust\n#![crate_type = \"dylib\"]\npub unsafe extern \"system\" fn foo() -> f64 {\n    let x: [f64; 4] = [0.0, 1.0, 2.0, 3.0];\n    x[2]\n}\n```\n\nresults in a linker error,\n\n```\nerror: linking with `gcc` failed: exit code: 1\nnote: \"gcc\" \"-Wl,--enable-long-section-names\" \"-fno-use-linker-plugin\" \"-Wl,--nxcompat\" \"-Wl,--large-address-aware\" \"-shared-libgcc\" \"-L\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\" \"alg.o\" \"-o\" \"alg.dll\" \"alg.metadata.o\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libstd-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libcollections-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\librustc_unicode-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\librand-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\liballoc-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\liblibc-11582ce5.rlib\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libcore-11582ce5.rlib\" \"-L\" \"C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\" \"-L\" \"c:\\Users\\alex\\Projects\\XALG_Counter\\.rust\\bin\\i686-pc-windows-gnu\" \"-L\" \"c:\\Users\\alex\\Projects\\XALG_Counter\\bin\\i686-pc-windows-gnu\" \"-Wl,-Bstatic\" \"-Wl,-Bdynamic\" \"-l\" \"ws2_32\" \"-l\" \"userenv\" \"-l\" \"advapi32\" \"-shared\" \"-l\" \"compiler-rt\"\nnote: C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libcore-11582ce5.rlib(core-11582ce5.o):(.text+0x7fe4): undefined reference to `rust_begin_unwind'\nC:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libcore-11582ce5.rlib(core-11582ce5.o):(.eh_frame+0x9a67): undefined reference to `rust_eh_personality'\nld: C:\\tools\\rust32\\bin\\rustlib\\i686-pc-windows-gnu\\lib\\libcore-11582ce5.rlib(core-11582ce5.o): bad reloc address 0x9a67 in section `.eh_frame'\n\nerror: aborting due to previous error\n```\n\nPassing the `-C linker=C:/tools/rust32/bin/rustlib/i686-pc-windows-gnu/bin/gcc.exe`, doesn't help, nor does compiling for x86_64, nor with the flag `-C linker=\"C:/tools/rust/bin/rustlib/x86_64-pc-windows-gnu/bin/gcc.exe\"`.\n", "closed_by": {"login": "alexchandel", "id": 637714, "node_id": "MDQ6VXNlcjYzNzcxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/637714?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexchandel", "html_url": "https://github.com/alexchandel", "followers_url": "https://api.github.com/users/alexchandel/followers", "following_url": "https://api.github.com/users/alexchandel/following{/other_user}", "gists_url": "https://api.github.com/users/alexchandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexchandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexchandel/subscriptions", "organizations_url": "https://api.github.com/users/alexchandel/orgs", "repos_url": "https://api.github.com/users/alexchandel/repos", "events_url": "https://api.github.com/users/alexchandel/events{/privacy}", "received_events_url": "https://api.github.com/users/alexchandel/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/25891/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/25891/timeline", "performed_via_github_app": null, "state_reason": "completed"}