{"url": "https://api.github.com/repos/rust-lang/rust/issues/93372", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93372/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93372/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93372/events", "html_url": "https://github.com/rust-lang/rust/issues/93372", "id": 1116222307, "node_id": "I_kwDOAAsO6M5CiDNj", "number": 93372, "title": "SIGSEGV in LLVM 13", "user": {"login": "Jake-Shadle", "id": 2316028, "node_id": "MDQ6VXNlcjIzMTYwMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2316028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jake-Shadle", "html_url": "https://github.com/Jake-Shadle", "followers_url": "https://api.github.com/users/Jake-Shadle/followers", "following_url": "https://api.github.com/users/Jake-Shadle/following{/other_user}", "gists_url": "https://api.github.com/users/Jake-Shadle/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jake-Shadle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jake-Shadle/subscriptions", "organizations_url": "https://api.github.com/users/Jake-Shadle/orgs", "repos_url": "https://api.github.com/users/Jake-Shadle/repos", "events_url": "https://api.github.com/users/Jake-Shadle/events{/privacy}", "received_events_url": "https://api.github.com/users/Jake-Shadle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-01-27T13:34:42Z", "updated_at": "2022-08-01T09:04:22Z", "closed_at": "2022-08-01T09:04:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\n\r\nUnfortunately I don't have a minimal repro for this issue since this was a regression between rust versions reported by a user that I am just now getting around to filing, and the callstack is deep in LLVM so I have no hints as to the Rust code that might be triggering it.\r\n\r\nThe code in question is https://github.com/EmbarkStudios/texture-synthesis, the original issue reported by users is https://github.com/EmbarkStudios/texture-synthesis/issues/164.\r\n\r\nThis segfault only occurs with `cargo build --release`, debug builds are not affected.\r\n\r\n### Meta\r\n\r\nAll stable releases from 1.56.0 to 1.58.1 result in the same crash\r\n`rustc --version --verbose`:\r\n```\r\nbinary: rustc\r\ncommit-hash: 59eed8a2aac0230a8b53e89d4e99d55912ba6b35\r\ncommit-date: 2021-11-01\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.56.1\r\nLLVM version: 13.0.0\r\n\r\nrustc 1.58.1 (db9d1b20b 2022-01-20)\r\nbinary: rustc\r\ncommit-hash: db9d1b20bba1968c1ec1fc49616d4742c1725b4b\r\ncommit-date: 2022-01-20\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.58.1\r\nLLVM version: 13.0.0\r\n```\r\n\r\nRust 1.55.0 does not result in the crash\r\n```\r\nrustc 1.55.0 (c8dfcfe04 2021-09-06)\r\nbinary: rustc\r\ncommit-hash: c8dfcfe046a7680554bf4eb612bad840e7631c4b\r\ncommit-date: 2021-09-06\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.55.0\r\nLLVM version: 12.0.1\r\n```\r\n\r\nAnd neither does a recent nightly\r\n```\r\nrustc 1.60.0-nightly (8cdb3cd94 2022-01-25)\r\nbinary: rustc\r\ncommit-hash: 8cdb3cd94efece1e17cbd8f6edb1dc1a482779a0\r\ncommit-date: 2022-01-25\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.60.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n   Compiling texture-synthesis v0.8.1 (/home/jake/code/texture-synthesis/lib)\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x4dd233)[0x7faa3d01f233]\r\n/lib64/libc.so.6(+0x42750)[0x7faa3c5e0750]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution22isImpliedViaOperationsENS_7CmpInst9PredicateEPKNS_4SCEVES5_S5_S5_j+0x310)[0x7faa39e10400]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution27isImpliedCondOperandsHelperENS_7CmpInst9PredicateEPKNS_4SCEVES5_S5_S5_+0x500)[0x7faa39e0fab0]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution13isImpliedCondENS_7CmpInst9PredicateEPKNS_4SCEVES5_PKNS_5ValueEbPKNS_11InstructionE+0x36c1)[0x7faa39e089f1]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution27isLoopBackedgeGuardedByCondEPKNS_4LoopENS_7CmpInst9PredicateEPKNS_4SCEVES8_+0x936)[0x7faa39dfa266]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution19isKnownViaInductionENS_7CmpInst9PredicateEPKNS_4SCEVES5_+0x270)[0x7faa39e33450]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution31isKnownViaNonRecursiveReasoningENS_7CmpInst9PredicateEPKNS_4SCEVES5_+0x4d8)[0x7faa39dfb9b8]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution27isImpliedCondOperandsHelperENS_7CmpInst9PredicateEPKNS_4SCEVES5_S5_S5_+0x4d8)[0x7faa39e0fa88]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution13isImpliedCondENS_7CmpInst9PredicateEPKNS_4SCEVES5_PKNS_5ValueEbPKNS_11InstructionE+0x2e0a)[0x7faa39e0813a]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution30isBasicBlockEntryGuardedByCondEPKNS_10BasicBlockENS_7CmpInst9PredicateEPKNS_4SCEVES8_+0x1fa)[0x7faa39df84ea]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm15ScalarEvolution19evaluatePredicateAtENS_7CmpInst9PredicateEPKNS_4SCEVES5_PKNS_11InstructionE+0x80)[0x7faa39df5e30]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm17simplifyUsersOfIVEPNS_7PHINodeEPNS_15ScalarEvolutionEPNS_13DominatorTreeEPNS_8LoopInfoEPKNS_19TargetTransformInfoERNS_15SmallVectorImplINS_14WeakTrackingVHEEERNS_12SCEVExpanderEPNS_9IVVisitorE+0x689)[0x7faa39df3b79]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(+0x24e6eaa)[0x7faa39de6eaa]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(+0x24e6106)[0x7faa39de6106]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm13LPPassManager13runOnFunctionERNS_8FunctionE+0x42d)[0x7faa3a47f36d]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm13FPPassManager13runOnFunctionERNS_8FunctionE+0x6b8)[0x7faa3a2c23c8]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(+0x2c423d9)[0x7faa3a5423d9]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(_ZN4llvm6legacy15PassManagerImpl3runERNS_6ModuleE+0x23c)[0x7faa3a63a5cc]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/../lib/libLLVM-13-rust-1.58.1-stable.so(LLVMRunPassManager+0xa)[0x7faa3aad5e5a]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x2114fd5)[0x7faa3ec56fd5]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(_RNvXs1_Csdwtts9g0LY3_18rustc_codegen_llvmNtB5_18LlvmCodegenBackendNtNtNtCseZSgnbGVPHD_17rustc_codegen_ssa6traits5write19WriteBackendMethods13optimize_thin+0x67c)[0x7faa3ec6adfc]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x2144742)[0x7faa3ec86742]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x215cfde)[0x7faa3ec9efde]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x210ce23)[0x7faa3ec4ee23]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-f63adaab7e27a794.so(+0x2141f73)[0x7faa3ec83f73]\r\n/home/jake/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/libstd-4c74cbab78ec4891.so(rust_metadata_std_b2a2bae5f6ca25d7+0xaafc3)[0x7faa3c87cfc3]\r\n/lib64/libc.so.6(+0x8da87)[0x7faa3c62ba87]\r\n/lib64/libc.so.6(+0x112640)[0x7faa3c6b0640]\r\nerror: could not compile `texture-synthesis`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name texture_synthesis --edition=2018 lib/src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C opt-level=3 -C embed-bitcode=no -C metadata=87c473a03afc563c -C extra-filename=-87c473a03afc563c --out-dir /home/jake/code/texture-synthesis/target/release/deps -L dependency=/home/jake/code/texture-synthesis/target/release/deps --extern crossbeam_utils=/home/jake/code/texture-synthesis/target/release/deps/libcrossbeam_utils-905ebd46bf52a581.rmeta --extern image=/home/jake/code/texture-synthesis/target/release/deps/libimage-8bdff5c471e7e7c4.rmeta --extern num_cpus=/home/jake/code/texture-synthesis/target/release/deps/libnum_cpus-770261073a7d772a.rmeta --extern rand=/home/jake/code/texture-synthesis/target/release/deps/librand-364df1f4d518c2d0.rmeta --extern rand_pcg=/home/jake/code/texture-synthesis/target/release/deps/librand_pcg-dcc93c849e966929.rmeta --extern rstar=/home/jake/code/texture-synthesis/target/release/deps/librstar-3c02d13771cb22c5.rmeta` (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n\r\nSince this is not a panic but a segfault the normal rust backtrace is never printed.", "closed_by": {"login": "Jake-Shadle", "id": 2316028, "node_id": "MDQ6VXNlcjIzMTYwMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2316028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jake-Shadle", "html_url": "https://github.com/Jake-Shadle", "followers_url": "https://api.github.com/users/Jake-Shadle/followers", "following_url": "https://api.github.com/users/Jake-Shadle/following{/other_user}", "gists_url": "https://api.github.com/users/Jake-Shadle/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jake-Shadle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jake-Shadle/subscriptions", "organizations_url": "https://api.github.com/users/Jake-Shadle/orgs", "repos_url": "https://api.github.com/users/Jake-Shadle/repos", "events_url": "https://api.github.com/users/Jake-Shadle/events{/privacy}", "received_events_url": "https://api.github.com/users/Jake-Shadle/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93372/timeline", "performed_via_github_app": null, "state_reason": "completed"}