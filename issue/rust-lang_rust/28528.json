{"url": "https://api.github.com/repos/rust-lang/rust/issues/28528", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28528/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28528/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28528/events", "html_url": "https://github.com/rust-lang/rust/issues/28528", "id": 107370662, "node_id": "MDU6SXNzdWUxMDczNzA2NjI=", "number": 28528, "title": "read_link cannot open some files reported as symbolic links on windows", "user": {"login": "BurntSushi", "id": 456674, "node_id": "MDQ6VXNlcjQ1NjY3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/456674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BurntSushi", "html_url": "https://github.com/BurntSushi", "followers_url": "https://api.github.com/users/BurntSushi/followers", "following_url": "https://api.github.com/users/BurntSushi/following{/other_user}", "gists_url": "https://api.github.com/users/BurntSushi/gists{/gist_id}", "starred_url": "https://api.github.com/users/BurntSushi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BurntSushi/subscriptions", "organizations_url": "https://api.github.com/users/BurntSushi/orgs", "repos_url": "https://api.github.com/users/BurntSushi/repos", "events_url": "https://api.github.com/users/BurntSushi/events{/privacy}", "received_events_url": "https://api.github.com/users/BurntSushi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2015-09-20T03:50:12Z", "updated_at": "2016-02-14T21:24:54Z", "closed_at": "2016-02-14T21:24:54Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "rustc on Windows 7 32 bit:\n\n```\nC:\\Users\\andrew\\walkdir\\symlinks>rustc --version\nrustc 1.5.0-nightly (6e5a32547 2015-09-19)\n```\n\nTest program:\n\n``` rust\nuse std::fs;\n\nfn main() {\n    let md = fs::symlink_metadata(\"is_a_symlink\").unwrap();\n    println!(\"is symlink? {}\", md.file_type().is_symlink());\n    match fs::read_link(\"is_a_symlink\") {\n        Ok(p) => println!(\"{}\", p.display()),\n        Err(err) => println!(\"{:?}\", err),\n    }\n}\n```\n\nCreate a symlink on Windows at `is_a_symlink` pointing to `not_a_symlink` and\nrun above program (**working as intended**):\n\n```\nC:\\Users\\andrew\\walkdir\\symlinks>mklink is_a_symlink C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink\nsymbolic link created for is_a_symlink <<===>> C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink\n\nC:\\Users\\andrew\\walkdir\\symlinks>dir\n09/19/2015  11:40 PM    <DIR>          .\n09/19/2015  11:40 PM    <DIR>          ..\n09/19/2015  11:40 PM    <SYMLINK>      is_a_symlink [C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink]\n09/19/2015  11:32 PM                 0 not_a_symlink\n09/19/2015  11:36 PM         2,118,989 win_symlink_test.exe\n09/19/2015  11:36 PM               261 win_symlink_test.rs\n\nC:\\Users\\andrew\\walkdir\\symlinks>win_symlink_test.exe\nis symlink? true\n\\??\\C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink\n```\n\nThis correctly identifies the file as a symlink and resolves it correctly.\n\nIf we instead creation a junction and follow the same steps, we can observe an\ninconsistency between `file_type().is_symlink()` and the behavior of\n`fs::read_link`:\n\n```\nC:\\Users\\andrew\\walkdir\\symlinks>mklink /J is_a_symlink C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink\nJunction created for is_a_symlink <<===>> C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink\n\nC:\\Users\\andrew\\walkdir\\symlinks>dir\n09/19/2015  11:46 PM    <DIR>          .\n09/19/2015  11:46 PM    <DIR>          ..\n09/19/2015  11:46 PM    <JUNCTION>     is_a_symlink [C:\\Users\\andrew\\walkdir\\symlinks\\not_a_symlink]\n09/19/2015  11:32 PM                 0 not_a_symlink\n09/19/2015  11:44 PM         2,118,946 win_symlink_test.exe\n09/19/2015  11:44 PM               286 win_symlink_test.rs\n\nC:\\Users\\andrew\\walkdir\\symlinks>win_symlink_test.exe\nis symlink? true\nError { repr: Custom(Custom { kind: Other, error: StringError(\"not a symlink\") }) }\n```\n\n(The key difference is the use of `mklink /J` to create a junction.)\n\nThe output here shows that it is correctly detected as a symlink, but\n`read_link` chokes on it.\n\nI looked briefly at the implementation and I haven't the slightest clue what's\nwrong (I'm not familiar with Windows).\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28528/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28528/timeline", "performed_via_github_app": null, "state_reason": "completed"}