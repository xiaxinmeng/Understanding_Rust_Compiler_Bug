{"url": "https://api.github.com/repos/rust-lang/rust/issues/28066", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28066/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28066/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28066/events", "html_url": "https://github.com/rust-lang/rust/issues/28066", "id": 103755408, "node_id": "MDU6SXNzdWUxMDM3NTU0MDg=", "number": 28066, "title": "Building coreutils with LTO causes LLVM error", "user": {"login": "hexsel", "id": 299385, "node_id": "MDQ6VXNlcjI5OTM4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/299385?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hexsel", "html_url": "https://github.com/hexsel", "followers_url": "https://api.github.com/users/hexsel/followers", "following_url": "https://api.github.com/users/hexsel/following{/other_user}", "gists_url": "https://api.github.com/users/hexsel/gists{/gist_id}", "starred_url": "https://api.github.com/users/hexsel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hexsel/subscriptions", "organizations_url": "https://api.github.com/users/hexsel/orgs", "repos_url": "https://api.github.com/users/hexsel/repos", "events_url": "https://api.github.com/users/hexsel/events{/privacy}", "received_events_url": "https://api.github.com/users/hexsel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2015-08-28T16:55:40Z", "updated_at": "2016-03-11T07:51:54Z", "closed_at": "2016-03-11T07:51:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "Building [coreutils](https://github.com/uutils/coreutils) with LTO:\n\n```\nmake ENABLE_LTO=y ENABLE_STRIP=y\n```\n\ncauses the following error:\n\n```\n...\nrustc -O -L /Users/gustavo.hexsel/Dev/coreutils/build/ -C lto --extern uufalse=/Users/gustavo.hexsel/Dev/coreutils/build/libfalse.rlib --extern uutrue=/Users/gustavo.hexsel/Dev/coreutils/build/libtrue.rlib --extern uutest=/Users/gustavo.hexsel/Dev/coreutils/build/libtest.rlib -o /Users/gustavo.hexsel/Dev/coreutils/build/fmt /Users/gustavo.hexsel/Dev/coreutils/build/gen/fmt.rs\nInstruction does not dominate all uses!\n  %oldret2 = insertvalue %str_slice %oldret, i64 %newret1, 1\n  %.sink.i.i = phi %str_slice [ %oldret2, %\"_ZN6string52String.ops..Index$LT$ops..RangeFrom$LT$usize$GT$$GT$5index20he25fda6b1269058b8bgE.exit.i.i\" ], [ %oldret6, %\"_ZN6string52String.ops..Index$LT$ops..RangeFrom$LT$usize$GT$$GT$5index20he25fda6b1269058b8bgE.exit61.i.i\" ]\nInstruction does not dominate all uses!\n  %oldret6 = insertvalue %str_slice %oldret4, i64 %newret5, 1\n  %.sink.i.i = phi %str_slice [ %oldret2, %\"_ZN6string52String.ops..Index$LT$ops..RangeFrom$LT$usize$GT$$GT$5index20he25fda6b1269058b8bgE.exit.i.i\" ], [ %oldret6, %\"_ZN6string52String.ops..Index$LT$ops..RangeFrom$LT$usize$GT$$GT$5index20he25fda6b1269058b8bgE.exit61.i.i\" ]\nInstruction does not dominate all uses!\n  %143 = invoke fastcc { i8*, i64 } @_ZN3str3str9trim_left20h2c4602b77c2e6481olfE(i8* noalias nonnull readonly %.pre-phi.i.i.58.i.i, i64 %142)\n          to label %join7.i.i unwind label %unwind_ast_3291_.loopexit.split-lp.i\n  %newret3 = extractvalue { i8*, i64 } %143, 0\nInstruction does not dominate all uses!\n  %143 = invoke fastcc { i8*, i64 } @_ZN3str3str9trim_left20h2c4602b77c2e6481olfE(i8* noalias nonnull readonly %.pre-phi.i.i.58.i.i, i64 %142)\n          to label %join7.i.i unwind label %unwind_ast_3291_.loopexit.split-lp.i\n  %newret5 = extractvalue { i8*, i64 } %143, 1\nInstruction does not dominate all uses!\n  %130 = invoke fastcc { i8*, i64 } @_ZN3str3str9trim_left20h2c4602b77c2e6481olfE(i8* noalias nonnull readonly %.pre-phi.i.i.i.i, i64 %129)\n          to label %join7.i.i unwind label %unwind_ast_3291_.loopexit.split-lp.i\n  %newret = extractvalue { i8*, i64 } %130, 0\nInstruction does not dominate all uses!\n  %130 = invoke fastcc { i8*, i64 } @_ZN3str3str9trim_left20h2c4602b77c2e6481olfE(i8* noalias nonnull readonly %.pre-phi.i.i.i.i, i64 %129)\n          to label %join7.i.i unwind label %unwind_ast_3291_.loopexit.split-lp.i\n  %newret1 = extractvalue { i8*, i64 } %130, 1\nLLVM ERROR: Broken function found, compilation aborted!\nmake: *** [/Users/gustavo.hexsel/Dev/coreutils/build/fmt] Error 1\n```\n\nThis error does not occur if you remove `ENABLE_LTO=y`.\n\nThis is on OSX, Rust version is `rustc 1.4.0-nightly (63ba780fd 2015-08-23)` (coreutils only builds on nightly).\n", "closed_by": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28066/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28066/timeline", "performed_via_github_app": null, "state_reason": "completed"}