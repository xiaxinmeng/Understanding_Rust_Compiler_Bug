{"url": "https://api.github.com/repos/rust-lang/rust/issues/55714", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55714/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55714/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55714/events", "html_url": "https://github.com/rust-lang/rust/issues/55714", "id": 377810553, "node_id": "MDU6SXNzdWUzNzc4MTA1NTM=", "number": 55714, "title": "Build fails with LLVM trunk.", "user": {"login": "vext01", "id": 604955, "node_id": "MDQ6VXNlcjYwNDk1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/604955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vext01", "html_url": "https://github.com/vext01", "followers_url": "https://api.github.com/users/vext01/followers", "following_url": "https://api.github.com/users/vext01/following{/other_user}", "gists_url": "https://api.github.com/users/vext01/gists{/gist_id}", "starred_url": "https://api.github.com/users/vext01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vext01/subscriptions", "organizations_url": "https://api.github.com/users/vext01/orgs", "repos_url": "https://api.github.com/users/vext01/repos", "events_url": "https://api.github.com/users/vext01/events{/privacy}", "received_events_url": "https://api.github.com/users/vext01/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-11-06T11:44:31Z", "updated_at": "2018-11-07T12:25:46Z", "closed_at": "2018-11-06T16:22:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi,\r\n\r\nI'm not sure if you target LLVM trunk, but I guess this will have to be fixed some day anyway.\r\n\r\nUsing LLVM trunk as of today (commit `5bc1446f3bee779c5a15a0256169bc7623682121` in git) and Rust master (commit `24e66c28980442a48d9458f1a4f9b76cc722dc8a` in git), I have the following compilation error when building `src/libstd`:\r\n\r\n```\r\n   Compiling libc v0.2.43\r\n   Compiling rustc-demangle v0.1.9\r\n   Compiling memmap v0.6.2\r\n   Compiling num_cpus v1.8.0\r\n   Compiling rustc_llvm v0.0.0 (/home/vext01/source/rust/src/librustc_llvm)\r\nerror: failed to run custom build command for `rustc_llvm v0.0.0 (/home/vext01/source/rust/src/librustc_llvm)`\r\nprocess didn't exit successfully: `/home/vext01/source/rust/build/x86_64-unknown-linux-gnu/stage0-codegen/release/build/rustc_llvm-05b28adcfb95b2e9/build-script-build` (exit code: 101)\r\n--- stdout\r\ncargo:rerun-if-changed=/opt/llvm/bin/llvm-config\r\ncargo:rerun-if-env-changed=LLVM_CONFIG\r\ncargo:rustc-cfg=llvm_component=\"aarch64\"\r\ncargo:rustc-cfg=llvm_component=\"amdgpu\"\r\ncargo:rustc-cfg=llvm_component=\"arm\"\r\ncargo:rustc-cfg=llvm_component=\"asmparser\"\r\ncargo:rustc-cfg=llvm_component=\"bitreader\"\r\ncargo:rustc-cfg=llvm_component=\"bitwriter\"\r\ncargo:rustc-cfg=llvm_component=\"hexagon\"\r\ncargo:rustc-cfg=llvm_component=\"instrumentation\"\r\ncargo:rustc-cfg=llvm_component=\"interpreter\"\r\ncargo:rustc-cfg=llvm_component=\"ipo\"\r\ncargo:rustc-cfg=llvm_component=\"linker\"\r\ncargo:rustc-cfg=llvm_component=\"lto\"\r\ncargo:rustc-cfg=llvm_component=\"mcjit\"\r\ncargo:rustc-cfg=llvm_component=\"mips\"\r\ncargo:rustc-cfg=llvm_component=\"msp430\"\r\ncargo:rustc-cfg=llvm_component=\"nvptx\"\r\ncargo:rustc-cfg=llvm_component=\"powerpc\"\r\ncargo:rustc-cfg=llvm_component=\"sparc\"\r\ncargo:rustc-cfg=llvm_component=\"systemz\"\r\ncargo:rustc-cfg=llvm_component=\"webassembly\"\r\ncargo:rustc-cfg=llvm_component=\"x86\"\r\ncargo:rerun-if-changed-env=LLVM_RUSTLLVM\r\ncargo:rerun-if-changed=../rustllvm/llvm-rebuild-trigger\r\ncargo:rerun-if-changed=../rustllvm/.editorconfig\r\ncargo:rerun-if-changed=../rustllvm/RustWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm/rustllvm.h\r\ncargo:rerun-if-changed=../rustllvm/ArchiveWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm/PassWrapper.cpp\r\ncargo:rerun-if-changed=../rustllvm/Linker.cpp\r\ncargo:rerun-if-changed=../rustllvm/README\r\nTARGET = Some(\"x86_64-unknown-linux-gnu\")\r\nOPT_LEVEL = Some(\"2\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCXX_x86_64-unknown-linux-gnu = Some(\"c++\")\r\nCXXFLAGS_x86_64-unknown-linux-gnu = Some(\"-ffunction-sections -fdata-sections -fPIC -m64\")\r\nDEBUG = Some(\"false\")\r\nrunning: \"c++\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-m64\" \"-I/opt/llvm/include\" \"-fPIC\" \"-fvisibility-inlines-hidden\" \"-Werror=date-time\" \"-std=c++11\" \"-Wall\" \"-Wextra\" \"-Wno-unused-parameter\" \"-Wwrite-strings\" \"-Wcast-qual\" \"-Wno-missing-field-initializers\" \"-pedantic\" \"-Wno-long-long\" \"-Wno-maybe-uninitialized\" \"-Wdelete-non-virtual-dtor\" \"-Wno-comment\" \"-g\" \"-fno-exceptions\" \"-fno-rtti\" \"-D_GNU_SOURCE\" \"-D_DEBUG\" \"-D__STDC_CONSTANT_MACROS\" \"-D__STDC_FORMAT_MACROS\" \"-D__STDC_LIMIT_MACROS\" \"-DLLVM_COMPONENT_AARCH64\" \"-DLLVM_COMPONENT_AMDGPU\" \"-DLLVM_COMPONENT_ARM\" \"-DLLVM_COMPONENT_ASMPARSER\" \"-DLLVM_COMPONENT_BITREADER\" \"-DLLVM_COMPONENT_BITWRITER\" \"-DLLVM_COMPONENT_HEXAGON\" \"-DLLVM_COMPONENT_INSTRUMENTATION\" \"-DLLVM_COMPONENT_INTERPRETER\" \"-DLLVM_COMPONENT_IPO\" \"-DLLVM_COMPONENT_LINKER\" \"-DLLVM_COMPONENT_LTO\" \"-DLLVM_COMPONENT_MCJIT\" \"-DLLVM_COMPONENT_MIPS\" \"-DLLVM_COMPONENT_MSP430\" \"-DLLVM_COMPONENT_NVPTX\" \"-DLLVM_COMPONENT_POWERPC\" \"-DLLVM_COMPONENT_SPARC\" \"-DLLVM_COMPONENT_SYSTEMZ\" \"-DLLVM_COMPONENT_WEBASSEMBLY\" \"-DLLVM_COMPONENT_X86\" \"-o\" \"/home/vext01/source/rust/build/x86_64-unknown-linux-gnu/stage0-codegen/x86_64-unknown-linux-gnu/release/build/rustc_llvm-e2b8d44760d75287/out/../rustllvm/PassWrapper.o\" \"-c\" \"../rustllvm/PassWrapper.cpp\"\r\nexit code: 0\r\nrunning: \"c++\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-m64\" \"-I/opt/llvm/include\" \"-fPIC\" \"-fvisibility-inlines-hidden\" \"-Werror=date-time\" \"-std=c++11\" \"-Wall\" \"-Wextra\" \"-Wno-unused-parameter\" \"-Wwrite-strings\" \"-Wcast-qual\" \"-Wno-missing-field-initializers\" \"-pedantic\" \"-Wno-long-long\" \"-Wno-maybe-uninitialized\" \"-Wdelete-non-virtual-dtor\" \"-Wno-comment\" \"-g\" \"-fno-exceptions\" \"-fno-rtti\" \"-D_GNU_SOURCE\" \"-D_DEBUG\" \"-D__STDC_CONSTANT_MACROS\" \"-D__STDC_FORMAT_MACROS\" \"-D__STDC_LIMIT_MACROS\" \"-DLLVM_COMPONENT_AARCH64\" \"-DLLVM_COMPONENT_AMDGPU\" \"-DLLVM_COMPONENT_ARM\" \"-DLLVM_COMPONENT_ASMPARSER\" \"-DLLVM_COMPONENT_BITREADER\" \"-DLLVM_COMPONENT_BITWRITER\" \"-DLLVM_COMPONENT_HEXAGON\" \"-DLLVM_COMPONENT_INSTRUMENTATION\" \"-DLLVM_COMPONENT_INTERPRETER\" \"-DLLVM_COMPONENT_IPO\" \"-DLLVM_COMPONENT_LINKER\" \"-DLLVM_COMPONENT_LTO\" \"-DLLVM_COMPONENT_MCJIT\" \"-DLLVM_COMPONENT_MIPS\" \"-DLLVM_COMPONENT_MSP430\" \"-DLLVM_COMPONENT_NVPTX\" \"-DLLVM_COMPONENT_POWERPC\" \"-DLLVM_COMPONENT_SPARC\" \"-DLLVM_COMPONENT_SYSTEMZ\" \"-DLLVM_COMPONENT_WEBASSEMBLY\" \"-DLLVM_COMPONENT_X86\" \"-o\" \"/home/vext01/source/rust/build/x86_64-unknown-linux-gnu/stage0-codegen/x86_64-unknown-linux-gnu/release/build/rustc_llvm-e2b8d44760d75287/out/../rustllvm/RustWrapper.o\" \"-c\" \"../rustllvm/RustWrapper.cpp\"\r\ncargo:warning=../rustllvm/RustWrapper.cpp: In function \u2018LLVMOpaqueMetadata* LLVMRustDIBuilderCreateStaticVariable(LLVMRustDIBuilderRef, LLVMMetadataRef, const char*, const char*, LLVMMetadataRef, unsigned int, LLVMMetadataRef, bool, LLVMValueRef, LLVMMetadataRef, uint32_t)\u2019:\r\ncargo:warning=../rustllvm/RustWrapper.cpp:799:55: error: invalid conversion from \u2018uint32_t {aka unsigned int}\u2019 to \u2018llvm::MDTuple*\u2019 [-fpermissive]\r\ncargo:warning=       InitExpr, unwrapDIPtr<MDNode>(Decl), AlignInBits);\r\ncargo:warning=                                                       ^\r\ncargo:warning=In file included from ../rustllvm/rustllvm.h:63:0,\r\ncargo:warning=                 from ../rustllvm/RustWrapper.cpp:11:\r\ncargo:warning=/opt/llvm/include/llvm/IR/DIBuilder.h:582:33: note:   initializing argument 10 of \u2018llvm::DIGlobalVariableExpression* llvm::DIBuilder::createGlobalVariableExpression(llvm::DIScope*, llvm::StringRef, llvm::StringRef, llvm::DIFile*, unsigned int, llvm::DIType*, bool, llvm::DIExpression*, llvm::MDNode*, llvm::MDTuple*, uint32_t)\u2019\r\ncargo:warning=     DIGlobalVariableExpression *createGlobalVariableExpression(\r\ncargo:warning=                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nexit code: 1\r\n\r\n--- stderr\r\nthread 'main' panicked at '\r\n\r\nInternal error occurred: Command \"c++\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-m64\" \"-I/opt/llvm/include\" \"-fPIC\" \"-fvisibility-inlines-hidden\" \"-Werror=date-time\" \"-std=c++11\" \"-Wall\" \"-Wextra\" \"-Wno-unused-parameter\" \"-Wwrite-strings\" \"-Wcast-qual\" \"-Wno-missing-field-initializers\" \"-pedantic\" \"-Wno-long-long\" \"-Wno-maybe-uninitialized\" \"-Wdelete-non-virtual-dtor\" \"-Wno-comment\" \"-g\" \"-fno-exceptions\" \"-fno-rtti\" \"-D_GNU_SOURCE\" \"-D_DEBUG\" \"-D__STDC_CONSTANT_MACROS\" \"-D__STDC_FORMAT_MACROS\" \"-D__STDC_LIMIT_MACROS\" \"-DLLVM_COMPONENT_AARCH64\" \"-DLLVM_COMPONENT_AMDGPU\" \"-DLLVM_COMPONENT_ARM\" \"-DLLVM_COMPONENT_ASMPARSER\" \"-DLLVM_COMPONENT_BITREADER\" \"-DLLVM_COMPONENT_BITWRITER\" \"-DLLVM_COMPONENT_HEXAGON\" \"-DLLVM_COMPONENT_INSTRUMENTATION\" \"-DLLVM_COMPONENT_INTERPRETER\" \"-DLLVM_COMPONENT_IPO\" \"-DLLVM_COMPONENT_LINKER\" \"-DLLVM_COMPONENT_LTO\" \"-DLLVM_COMPONENT_MCJIT\" \"-DLLVM_COMPONENT_MIPS\" \"-DLLVM_COMPONENT_MSP430\" \"-DLLVM_COMPONENT_NVPTX\" \"-DLLVM_COMPONENT_POWERPC\" \"-DLLVM_COMPONENT_SPARC\" \"-DLLVM_COMPONENT_SYSTEMZ\" \"-DLLVM_COMPONENT_WEBASSEMBLY\" \"-DLLVM_COMPONENT_X86\" \"-o\" \"/home/vext01/source/rust/build/x86_64-unknown-linux-gnu/stage0-codegen/x86_64-unknown-linux-gnu/release/build/rustc_llvm-e2b8d44760d75287/out/../rustllvm/RustWrapper.o\" \"-c\" \"../rustllvm/RustWrapper.cpp\" with args \"c++\" did not execute successfully (status code exit code: 1).\r\n\r\n', /home/vext01/.cargo/registry/src/github.com-1ecc6299db9ec823/cc-1.0.25/src/lib.rs:2260:5\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::print\r\n             at libstd/sys_common/backtrace.rs:71\r\n             at libstd/sys_common/backtrace.rs:59\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/panicking.rs:211\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:227\r\n   4: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:476\r\n   5: std::panicking::continue_panic_fmt\r\n             at libstd/panicking.rs:390\r\n   6: std::panicking::begin_panic_fmt\r\n             at libstd/panicking.rs:345\r\n   7: cc::fail\r\n   8: cc::Build::compile\r\n   9: build_script_build::main\r\n  10: std::rt::lang_start::{{closure}}\r\n  11: std::panicking::try::do_call\r\n             at libstd/rt.rs:59\r\n             at libstd/panicking.rs:310\r\n  12: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:102\r\n  13: std::rt::lang_start_internal\r\n             at libstd/panicking.rs:289\r\n             at libstd/panic.rs:392\r\n             at libstd/rt.rs:58\r\n  14: main\r\n  15: __libc_start_main\r\n  16: _start\r\n\r\ncommand did not execute successfully: \"/home/vext01/source/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\" \"rustc\" \"--target\" \"x86_64-unknown-linux-gnu\" \"-j\" \"4\" \"--release\" \"--manifest-path\" \"/home/vext01/source/rust/src/librustc_codegen_llvm/Cargo.toml\" \"--features\" \"\" \"--message-format\" \"json\"\r\nexpected success, got: exit code: 101\r\nthread 'main' panicked at 'cargo must succeed', bootstrap/compile.rs:1101:9\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::print\r\n             at libstd/sys_common/backtrace.rs:71\r\n             at libstd/sys_common/backtrace.rs:59\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/panicking.rs:211\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:227\r\n   4: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:476\r\n   5: std::panicking::begin_panic\r\n             at libstd/panicking.rs:410\r\n   6: bootstrap::compile::run_cargo\r\n             at bootstrap/compile.rs:1101\r\n   7: <bootstrap::compile::CodegenBackend as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:686\r\n   8: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1215\r\n   9: <bootstrap::compile::Assemble as bootstrap::builder::Step>::run\r\n             at bootstrap/compile.rs:964\r\n  10: bootstrap::builder::Builder::ensure\r\n             at bootstrap/builder.rs:1215\r\n  11: bootstrap::builder::Builder::compiler\r\n             at bootstrap/builder.rs:579\r\n  12: <bootstrap::compile::Test as bootstrap::builder::Step>::make_run\r\n             at bootstrap/compile.rs:328\r\n  13: bootstrap::builder::StepDescription::maybe_run\r\n             at bootstrap/builder.rs:191\r\n  14: bootstrap::builder::StepDescription::run\r\n             at bootstrap/builder.rs:234\r\n  15: bootstrap::builder::Builder::run_step_descriptions\r\n             at bootstrap/builder.rs:571\r\n  16: bootstrap::builder::Builder::execute_cli\r\n             at bootstrap/builder.rs:561\r\n  17: bootstrap::Build::build\r\n             at bootstrap/lib.rs:479\r\n  18: bootstrap::main\r\n             at bootstrap/bin/main.rs:29\r\n  19: std::rt::lang_start::{{closure}}\r\n             at libstd/rt.rs:74\r\n  20: std::panicking::try::do_call\r\n             at libstd/rt.rs:59\r\n             at libstd/panicking.rs:310\r\n  21: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:102\r\n  22: std::rt::lang_start_internal\r\n             at libstd/panicking.rs:289\r\n             at libstd/panic.rs:392\r\n             at libstd/rt.rs:58\r\n  23: std::rt::lang_start\r\n             at libstd/rt.rs:74\r\n  24: main\r\n  25: __libc_start_main\r\n  26: _start\r\nfailed to run: /home/vext01/source/rust/build/bootstrap/debug/bootstrap build --config .buildbot.toml --stage 1 src/libtest\r\nBuild completed unsuccessfully in 0:09:54\r\n```\r\n\r\nMy `config.toml`:\r\n```\r\n[rust]\r\ncodegen-units = 0\r\ndebuginfo = true\r\n\r\n[target.x86_64-unknown-linux-gnu]\r\nllvm-config = \"/opt/llvm/bin/llvm-config\"\r\n```\r\n\r\nI'm using Debian 9.\r\n\r\nI'll try to get a fix, but I'm no LLVM expert.", "closed_by": {"login": "vext01", "id": 604955, "node_id": "MDQ6VXNlcjYwNDk1NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/604955?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vext01", "html_url": "https://github.com/vext01", "followers_url": "https://api.github.com/users/vext01/followers", "following_url": "https://api.github.com/users/vext01/following{/other_user}", "gists_url": "https://api.github.com/users/vext01/gists{/gist_id}", "starred_url": "https://api.github.com/users/vext01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vext01/subscriptions", "organizations_url": "https://api.github.com/users/vext01/orgs", "repos_url": "https://api.github.com/users/vext01/repos", "events_url": "https://api.github.com/users/vext01/events{/privacy}", "received_events_url": "https://api.github.com/users/vext01/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55714/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55714/timeline", "performed_via_github_app": null, "state_reason": "completed"}