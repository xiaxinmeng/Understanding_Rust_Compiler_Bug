{"url": "https://api.github.com/repos/rust-lang/rust/issues/43788", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43788/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43788/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43788/events", "html_url": "https://github.com/rust-lang/rust/issues/43788", "id": 249408759, "node_id": "MDU6SXNzdWUyNDk0MDg3NTk=", "number": 43788, "title": "panic=abort compatible test harness", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 630810559, "node_id": "MDU6TGFiZWw2MzA4MTA1NTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-libtest", "name": "A-libtest", "color": "f7e101", "default": false, "description": "Area: #[test] related"}, {"id": 657353545, "node_id": "MDU6TGFiZWw2NTczNTM1NDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-accepted", "name": "C-feature-accepted", "color": "f5f1fd", "default": false, "description": "Category: A feature request that has been accepted pending implementation."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-08-10T16:43:59Z", "updated_at": "2017-08-10T18:24:06Z", "closed_at": "2017-08-10T18:24:06Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Right now developing a `panic=abort` project can be relatively painful when running tests. A `cargo build` will compile everything with `panic=abort` but a `cargo test` will recompile everything with `panic=unwind`. This is currently due to the fact that libtest *requires* panic=unwind to correctly operate. Otherwise it can't catch test failures!\r\n\r\nWe may wish to explore a panic=abort compatible test harness to [remove Cargo's special casing](https://github.com/rust-lang/cargo/blob/8720d63bc14e64b66e6f866b37cddd620c01b057/src/cargo/util/toml/mod.rs#L1031-L1036). Some possible ways to implement this may be:\r\n\r\n* Instead of starting a thread for all tests we could instead start a process. This process could be a re-execution of the executable itself and we'd just do that once per test. The downside of this is that it may be super slow.\r\n* We could continue to start a thread for each test but override the panic handler for the process. This panic handler would do \"test related things\" and provide an opportunity for a \"clean exit\". The downside of this is that you wouldn't get a set of all tests that failed, just the first few (maybe)\r\n\r\nI think that we'll also need support in the compiler for this, we'd have to inject different test frameworks or backends depending on the `-C panic=...` configured mode.", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43788/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43788/timeline", "performed_via_github_app": null, "state_reason": "completed"}