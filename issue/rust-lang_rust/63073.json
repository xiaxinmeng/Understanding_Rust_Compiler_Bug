{"url": "https://api.github.com/repos/rust-lang/rust/issues/63073", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63073/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63073/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63073/events", "html_url": "https://github.com/rust-lang/rust/issues/63073", "id": 473721797, "node_id": "MDU6SXNzdWU0NzM3MjE3OTc=", "number": 63073, "title": "New trait for types which can report memory usage", "user": {"login": "windelbouwman", "id": 1816500, "node_id": "MDQ6VXNlcjE4MTY1MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1816500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/windelbouwman", "html_url": "https://github.com/windelbouwman", "followers_url": "https://api.github.com/users/windelbouwman/followers", "following_url": "https://api.github.com/users/windelbouwman/following{/other_user}", "gists_url": "https://api.github.com/users/windelbouwman/gists{/gist_id}", "starred_url": "https://api.github.com/users/windelbouwman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/windelbouwman/subscriptions", "organizations_url": "https://api.github.com/users/windelbouwman/orgs", "repos_url": "https://api.github.com/users/windelbouwman/repos", "events_url": "https://api.github.com/users/windelbouwman/events{/privacy}", "received_events_url": "https://api.github.com/users/windelbouwman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-07-28T08:55:27Z", "updated_at": "2019-12-22T01:20:58Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "Hi all,\r\n\r\nIn the course of implementing the sizeof operator in rustpython, we stumbled upon a feature we possibly lack: the ability to request the true memory usage of a struct. Meaning, the memory usage of the struct itself, as reported by `std::mem::size_of` and friends, but also the size of the dynamically allocated heap structures, such as `Vec`.\r\n\r\nOur current approach is to dive into the inner workings of the bigint type, but this is probably undesirable, since the resulting code is unsafe.\r\n\r\nThe proposed change can be viewed here:\r\n\r\nhttps://github.com/RustPython/RustPython/pull/1172/files\r\n\r\nMy request, would be to have a trait in the `alloc` crate or `std::mem` crate, which can be implemented by other packages, which support the reporting of dynamic memory by an object.\r\n\r\nExample of the trait:\r\n\r\n```rust\r\ntrait DynamicSizeOf {\r\n    /// Returns the memory used by this type, including all its nested fields\r\n    /// which are dynamically allocated.\r\n    fn sizeof(&self) -> usize\r\n}\r\n\r\nimpl DynamicSizeOf for BigInt {\r\n    fn sizeof(&self) -> usize {\r\n         // arbitrarily deep query on sub structures memory usage.\r\n    }\r\n}\r\n\r\n```\r\n\r\nPlease also see the related issue here: https://github.com/rust-num/num-bigint/issues/98\r\n\r\nIs this a good idea? Are there other options available to achieve the same behavior?\r\n\r\n@askaholic and @cuviper what are your opinions on this topic? Do you see other ideas?", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63073/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63073/timeline", "performed_via_github_app": null, "state_reason": null}