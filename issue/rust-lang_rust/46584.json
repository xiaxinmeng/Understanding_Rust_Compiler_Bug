{"url": "https://api.github.com/repos/rust-lang/rust/issues/46584", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46584/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46584/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46584/events", "html_url": "https://github.com/rust-lang/rust/issues/46584", "id": 280495410, "node_id": "MDU6SXNzdWUyODA0OTU0MTA=", "number": 46584, "title": "[ICE] with universal_impl_trait", "user": {"login": "rizakrko", "id": 18172179, "node_id": "MDQ6VXNlcjE4MTcyMTc5", "avatar_url": "https://avatars.githubusercontent.com/u/18172179?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rizakrko", "html_url": "https://github.com/rizakrko", "followers_url": "https://api.github.com/users/rizakrko/followers", "following_url": "https://api.github.com/users/rizakrko/following{/other_user}", "gists_url": "https://api.github.com/users/rizakrko/gists{/gist_id}", "starred_url": "https://api.github.com/users/rizakrko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rizakrko/subscriptions", "organizations_url": "https://api.github.com/users/rizakrko/orgs", "repos_url": "https://api.github.com/users/rizakrko/repos", "events_url": "https://api.github.com/users/rizakrko/events{/privacy}", "received_events_url": "https://api.github.com/users/rizakrko/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-12-08T13:50:25Z", "updated_at": "2018-01-23T16:02:25Z", "closed_at": "2018-01-23T16:02:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Following code produces ICE:\r\n`main.rs`\r\n\r\n```\r\nextern crate test_project;\r\n\r\nstruct Foo {}\r\n\r\nimpl test_project::T for Foo {}\r\n\r\nfn main() {\r\n    test_project::test_fn(Foo {});\r\n}\r\n```\r\n`lib.rs`\r\n```\r\n#![feature(universal_impl_trait)]\r\n\r\npub trait T {}\r\npub fn test_fn(t: impl T) {}\r\n```\r\nI expected to see this happen: Code compiles\r\nInstead, this happened: \r\n```\r\nerror: internal compiler error: /checkout/src/librustc_trans_utils/collector.rs:743: Cannot create local trans-item for DefId(11/0:4 ~ test_project[7b49]::test_fn[0])\r\n```\r\n## Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.24.0-nightly (c8ddf2852 2017-12-07)\r\nbinary: rustc\r\ncommit-hash: c8ddf28527119a06a9f5da9bd34c97ae97afe531\r\ncommit-date: 2017-12-07\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.24.0-nightly\r\nLLVM version: 4.0\r\n```\r\nBacktrace:\r\n```\r\nthread 'rustc' panicked at 'Box<Any>', /checkout/src/librustc_errors/lib.rs:501:8\r\nstack backtrace:\r\n   0:     0x7fa24b53c29b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::he397ff399ab10f70\r\n                               at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7fa24b54a50e - std::sys_common::backtrace::print::hb3c6b7045fdb6844\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:68\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:57\r\n   2:     0x7fa24b543ef0 - std::panicking::default_hook::{{closure}}::ha933d0ad7dfae7df\r\n                               at /checkout/src/libstd/panicking.rs:381\r\n   3:     0x7fa24b543bf5 - std::panicking::default_hook::hb335bd8cf8a46857\r\n                               at /checkout/src/libstd/panicking.rs:391\r\n   4:     0x7fa24b5443cb - std::panicking::rust_panic_with_hook::h97bc3b62dd4043a0\r\n                               at /checkout/src/libstd/panicking.rs:577\r\n   5:     0x7fa245d7ff17 - std::panicking::begin_panic::haa21720f5950667e\r\n   6:     0x7fa245d9d981 - rustc_errors::Handler::bug::h530dee93ced7726c\r\n   7:     0x7fa2475c30bf - <std::thread::local::LocalKey<T>>::with::h661c270223aa7d49\r\n   8:     0x7fa2477d3fee - rustc::ty::context::tls::with_opt::h04a8f43ade461d80\r\n   9:     0x7fa2473de937 - rustc::session::opt_span_bug_fmt::h4a68404fdea86ebf\r\n  10:     0x7fa2473de846 - rustc::session::bug_fmt::h0f3f82c9190314e7\r\n  11:     0x7fa2486a2328 - rustc_trans_utils::collector::should_trans_locally::h7f6e93eff47ee0aa\r\n  12:     0x7fa2486a20f4 - rustc_trans_utils::collector::visit_instance_use::hb4dfc2f5ac03ee18\r\n  13:     0x7fa2486a20b4 - rustc_trans_utils::collector::visit_fn_use::h948027a218a5f140\r\n  14:     0x7fa2486a18ea - <rustc_trans_utils::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_terminator_kind::h77fe79a7ec747854\r\n  15:     0x7fa24869f0fa - rustc::mir::visit::Visitor::visit_mir::h6b0d43fd9b906726\r\n  16:     0x7fa2486a028e - rustc_trans_utils::collector::collect_items_rec::heb5ce4fd21f8755b\r\n  17:     0x7fa24869f5dd - rustc_trans_utils::collector::collect_crate_translation_items::h8d911e4ec1f7fab7\r\n  18:     0x7fa2499d57af - rustc::util::common::time::h9594a33375515789\r\n  19:     0x7fa249904ab0 - rustc_trans::base::collect_and_partition_translation_items::h04375b7d84f115ae\r\n  20:     0x7fa2476f6e00 - rustc::dep_graph::graph::DepGraph::with_task_impl::h7e60845912e15129\r\n  21:     0x7fa247359f98 - rustc_errors::Handler::track_diagnostics::hb811bb8b256bd17d\r\n  22:     0x7fa24787b790 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::h162d730623a0a166\r\n  23:     0x7fa2475264bf - rustc::ty::maps::<impl rustc::ty::maps::queries::collect_and_partition_translation_items<'tcx>>::force::h4de6323b20aea870\r\n  24:     0x7fa247526c1e - rustc::ty::maps::<impl rustc::ty::maps::queries::collect_and_partition_translation_items<'tcx>>::try_get::h90f7144b602ec2df\r\n  25:     0x7fa247637ca7 - rustc::ty::maps::TyCtxtAt::collect_and_partition_translation_items::ha98b2ff74f983210\r\n  26:     0x7fa2478d943e - rustc::ty::maps::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'lcx>>::collect_and_partition_translation_items::h259e7450f896c098\r\n  27:     0x7fa2499029f8 - rustc_trans::base::trans_crate::h0f50ca66a934980d\r\n  28:     0x7fa249994c46 - <rustc_trans::LlvmTransCrate as rustc_trans_utils::trans_crate::TransCrate>::trans_crate::h014a424647baa493\r\n  29:     0x7fa24b8ff8a7 - rustc::util::common::time::h8f3dc720d560e0e5\r\n  30:     0x7fa24b92f40d - rustc_driver::driver::phase_4_translate_to_llvm::h26bdd0eda70a9cfb\r\n  31:     0x7fa24b9727b2 - rustc_driver::driver::compile_input::{{closure}}::h029d7e3a020dd2aa\r\n  32:     0x7fa24b96ba11 - <std::thread::local::LocalKey<T>>::with::ha09fe06cbd6872eb\r\n  33:     0x7fa24b9680e6 - <std::thread::local::LocalKey<T>>::with::h3bd11e5486ef383b\r\n  34:     0x7fa24b9b49a7 - rustc::ty::context::TyCtxt::create_and_enter::ha7b863438f1f46a0\r\n  35:     0x7fa24b92a5f4 - rustc_driver::driver::compile_input::h30cbeda331948b93\r\n  36:     0x7fa24b9c4153 - rustc_driver::run_compiler::h8871ce8dbc735fff\r\n  37:     0x7fa24b909241 - std::sys_common::backtrace::__rust_begin_short_backtrace::hf1041df6796406b7\r\n  38:     0x7fa24b5765ce - __rust_maybe_catch_panic\r\n                               at /checkout/src/libpanic_unwind/lib.rs:101\r\n  39:     0x7fa24b985f72 - <F as alloc::boxed::FnBox<A>>::call_box::h7606daa916ddac39\r\n  40:     0x7fa24b5326cb - std::sys::unix::thread::Thread::new::thread_start::hae1fcb3fb5b43dda\r\n                               at /checkout/src/liballoc/boxed.rs:827\r\n                               at /checkout/src/libstd/sys/unix/thread.rs:90\r\n  41:     0x7fa2454f57fb - start_thread\r\n  42:     0x7fa24b218b0e - clone\r\n  43:                0x0 - <unknown>\r\n\r\nerror: Could not compile `test_project`.\r\n\r\n```", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46584/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46584/timeline", "performed_via_github_app": null, "state_reason": "completed"}