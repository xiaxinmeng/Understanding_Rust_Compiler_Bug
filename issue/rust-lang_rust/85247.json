{"url": "https://api.github.com/repos/rust-lang/rust/issues/85247", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85247/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85247/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85247/events", "html_url": "https://github.com/rust-lang/rust/issues/85247", "id": 890732380, "node_id": "MDU6SXNzdWU4OTA3MzIzODA=", "number": 85247, "title": "rustc is too strict about reserved registers on ARM", "user": {"login": "Skirmisher", "id": 1535247, "node_id": "MDQ6VXNlcjE1MzUyNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1535247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Skirmisher", "html_url": "https://github.com/Skirmisher", "followers_url": "https://api.github.com/users/Skirmisher/followers", "following_url": "https://api.github.com/users/Skirmisher/following{/other_user}", "gists_url": "https://api.github.com/users/Skirmisher/gists{/gist_id}", "starred_url": "https://api.github.com/users/Skirmisher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Skirmisher/subscriptions", "organizations_url": "https://api.github.com/users/Skirmisher/orgs", "repos_url": "https://api.github.com/users/Skirmisher/repos", "events_url": "https://api.github.com/users/Skirmisher/events{/privacy}", "received_events_url": "https://api.github.com/users/Skirmisher/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2046313052, "node_id": "MDU6TGFiZWwyMDQ2MzEzMDUy", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-asm", "name": "F-asm", "color": "f9c0cc", "default": false, "description": "`#![feature(asm)]` (not `llvm_asm`)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-05-13T05:49:05Z", "updated_at": "2022-02-22T17:44:09Z", "closed_at": "2022-02-22T17:44:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "Recently, [this commit](https://github.com/rust-lang/rust/commit/e6a731eb90fe3d47d89416e199832af4248399f6#diff-8818a2f974f5c898a567797bb58287139c8a4256ba8344e1e63eb556ac06bc82) came to my attention, as it added r9 to the list of LLVM-reserved registers on ARM according to rustc, breaking existing inline asm. I decided to look into this further, and found [this page](https://developer.arm.com/documentation/101754/0615/armclang-Reference/Compiler-specific-Keywords-and-Operators/Global-named-register-variables) (section \"Restrictions\") which concisely states under what conditions certain registers are reserved in the ABI (with regards to armclang as described in the page, but it applies more generally). The relevant points are:\r\n\r\n- If RWPI (read-write position independent) code is enabled, R9 is reserved.\r\n- If needed, R7 is reserved for the frame pointer in T32 mode, and R11 is reserved in A32 mode.\r\n\r\nHowever, rustc reserves these registers unconditionally. This seems incorrect, as both RWPI and frame pointers can be disabled via codegen options or a custom target. In our case, the custom target file (`armv4t-none-eabi.json`) has both `\"eliminate-frame-pointer\": true` and `\"relocation-model\": \"static\"` set, but rustc will reject uses of r9 and r11 with their respective error messages (\"r9 is used internally by llvm\" and \"frame pointer (r11) cannot be used as an operand\").", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85247/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85247/timeline", "performed_via_github_app": null, "state_reason": "completed"}