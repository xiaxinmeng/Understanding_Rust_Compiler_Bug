{"url": "https://api.github.com/repos/rust-lang/rust/issues/62536", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/62536/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/62536/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/62536/events", "html_url": "https://github.com/rust-lang/rust/issues/62536", "id": 465871123, "node_id": "MDU6SXNzdWU0NjU4NzExMjM=", "number": 62536, "title": "ICE: \"can't hash a TyVid\" when failing to infer a const generic", "user": {"login": "carado", "id": 407034, "node_id": "MDQ6VXNlcjQwNzAzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/407034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/carado", "html_url": "https://github.com/carado", "followers_url": "https://api.github.com/users/carado/followers", "following_url": "https://api.github.com/users/carado/following{/other_user}", "gists_url": "https://api.github.com/users/carado/gists{/gist_id}", "starred_url": "https://api.github.com/users/carado/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/carado/subscriptions", "organizations_url": "https://api.github.com/users/carado/orgs", "repos_url": "https://api.github.com/users/carado/repos", "events_url": "https://api.github.com/users/carado/events{/privacy}", "received_events_url": "https://api.github.com/users/carado/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1282665911, "node_id": "MDU6TGFiZWwxMjgyNjY1OTEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-generics", "name": "A-const-generics", "color": "f7e101", "default": false, "description": "Area: const generics (parameters and arguments)"}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1486687397, "node_id": "MDU6TGFiZWwxNDg2Njg3Mzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-const_generics", "name": "F-const_generics", "color": "f9c0cc", "default": false, "description": "`#![feature(const_generics)]`"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-07-09T16:15:26Z", "updated_at": "2019-10-21T19:46:21Z", "closed_at": "2019-10-21T19:46:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "A clean rust project on the latest nightly rustc with just this `src/main.rs`:\r\n```rust\r\n#![feature(const_generics)]\r\n\r\nstruct S<T, const N: usize>([T; N]);\r\n\r\nfn f<T, const N: usize>(x: T) -> S<T, {N}> { panic!() }\r\n\r\nfn main() {\r\n\tf(0u8);\r\n}\r\n```\r\nproduces the following error on cargo check/build:\r\n<details>\r\n\r\n```\r\ncarado@ram:~/tmp/rust13 $ RUST_BACKTRACE=full cargo check\r\n    Checking rust13 v0.1.0 (/home/carado/tmp/rust13)\r\nwarning: the feature `const_generics` is incomplete and may cause the compiler to crash\r\n --> src/main.rs:1:12\r\n  |\r\n1 | #![feature(const_generics)]\r\n  |            ^^^^^^^^^^^^^^\r\n\r\nerror: internal compiler error: src/librustc/ich/impls_ty.rs:213: ty::TyKind::hash_stable() - can't hash a TyVid _#0t.\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:649:9\r\nstack backtrace:\r\n   0:     0x7fe25657923b - backtrace::backtrace::libunwind::trace::h4f04af92f39f2b78\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/libunwind.rs:88\r\n   1:     0x7fe25657923b - backtrace::backtrace::trace_unsynchronized::hb28ce8d2b7fb3e31\r\n                               at /cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.29/src/backtrace/mod.rs:66\r\n   2:     0x7fe25657923b - std::sys_common::backtrace::_print::he3f49d2d13a51ff1\r\n                               at src/libstd/sys_common/backtrace.rs:47\r\n   3:     0x7fe25657923b - std::sys_common::backtrace::print::h46c2f3b13519e9bf\r\n                               at src/libstd/sys_common/backtrace.rs:36\r\n   4:     0x7fe25657923b - std::panicking::default_hook::{{closure}}::h6694acddafc67583\r\n                               at src/libstd/panicking.rs:200\r\n   5:     0x7fe256578f17 - std::panicking::default_hook::hb4761d2feeb6d93c\r\n                               at src/libstd/panicking.rs:214\r\n   6:     0x7fe25833eab1 - rustc::util::common::panic_hook::h048f1ff4bc2b561b\r\n   7:     0x7fe256579a99 - std::panicking::rust_panic_with_hook::h7a5f9620b0a832bc\r\n                               at src/libstd/panicking.rs:481\r\n   8:     0x7fe2587d3f5d - std::panicking::begin_panic::hb73227afb9857db6\r\n   9:     0x7fe2587f8f7f - rustc_errors::Handler::bug::h2054eb06936e67b5\r\n  10:     0x7fe257f6d4e3 - rustc::util::bug::opt_span_bug_fmt::{{closure}}::h3c0421ab2fdc9ea6\r\n  11:     0x7fe257f6ca73 - rustc::ty::context::tls::with_opt::{{closure}}::hd2fbc2b0ebae2095\r\n  12:     0x7fe257f6c4e8 - rustc::ty::context::tls::with_context_opt::h941a3adb8b126e2b\r\n  13:     0x7fe257f6c527 - rustc::ty::context::tls::with_opt::h3eb1995ec6f2c295\r\n  14:     0x7fe257f6d3f8 - rustc::util::bug::opt_span_bug_fmt::h5a2a260784b50bee\r\n  15:     0x7fe257f6d362 - rustc::util::bug::bug_fmt::h7e4e2350b3fe730c\r\n  16:     0x7fe25840f4b2 - rustc::ich::impls_ty::<impl rustc_data_structures::stable_hasher::HashStable<rustc::ich::hcx::StableHashingContext> for rustc::ty::sty::TyVid>::hash_stable::h1463ce28b76e87fc\r\n  17:     0x7fe258470fa7 - rustc::ty::sty::_DERIVE_rustc_data_structures_stable_hasher_HashStable_rustc_ich_StableHashingContext_ctx_FOR_TyKind::<impl rustc_data_structures::stable_hasher::HashStable<rustc::ich::hcx::StableHashingContext> for rustc::ty::sty::TyKind>::hash_stable::h7dcfc11871930cfb\r\n  18:     0x7fe257eb7be2 - rustc::ich::impls_ty::<impl rustc_data_structures::stable_hasher::HashStable<rustc::ich::hcx::StableHashingContext> for rustc::ty::subst::Kind>::hash_stable::h5c3796ae412cb81f\r\n  19:     0x7fe2584eb052 - rustc::infer::canonical::_DERIVE_rustc_data_structures_stable_hasher_HashStable_rustc_ich_StableHashingContext_ctx_FOR_Canonical::<impl rustc_data_structures::stable_hasher::HashStable<rustc::ich::hcx::StableHashingContext> for rustc::infer::canonical::Canonical<V>>::hash_stable::h8e0f5f69f3ed9b3c\r\n  20:     0x7fe257e5c85b - rustc::dep_graph::graph::DepGraph::with_task_impl::hebe93126a1c46ef0\r\n  21:     0x7fe2580f06e3 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h668eeb3ee62e8a11\r\n  22:     0x7fe257ddde3c - rustc::traits::query::dropck_outlives::<impl rustc::infer::at::At>::dropck_outlives::hb3441b0093584465\r\n  23:     0x7fe25700a8f9 - rustc_typeck::check::dropck::check_safety_of_destructor_if_necessary::h39fe2f333c370e50\r\n  24:     0x7fe256f839d7 - rustc_typeck::check::regionck::RegionCtxt::check_safety_of_rvalue_destructor_if_necessary::h5dee61f898d3b300\r\n  25:     0x7fe256f82296 - <rustc_typeck::check::regionck::RegionCtxt as rustc::hir::intravisit::Visitor>::visit_expr::h170804856875af5e\r\n  26:     0x7fe2570c872f - rustc::hir::intravisit::walk_expr::h7747ebb77c7fd9e3\r\n  27:     0x7fe256f8277b - <rustc_typeck::check::regionck::RegionCtxt as rustc::hir::intravisit::Visitor>::visit_expr::h170804856875af5e\r\n  28:     0x7fe256f80f5e - rustc_typeck::check::regionck::RegionCtxt::visit_fn_body::hf253f947ee1a5219\r\n  29:     0x7fe256f171a9 - rustc_typeck::check::regionck::<impl rustc_typeck::check::FnCtxt>::regionck_fn::h0fc45e22409227c9\r\n  30:     0x7fe2570a325a - rustc::ty::context::GlobalCtxt::enter_local::h7659f32b1ea661a0\r\n  31:     0x7fe256f4a755 - rustc_typeck::check::typeck_tables_of::hfb1f10d39fb5fa69\r\n  32:     0x7fe256f6bbbe - rustc::ty::query::__query_compute::typeck_tables_of::h037cb95db35bf44f\r\n  33:     0x7fe25701f5db - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::h535de4befaa63b09\r\n  34:     0x7fe256fa0c72 - rustc::dep_graph::graph::DepGraph::with_task_impl::hbcc48ac4d5a17f83\r\n  35:     0x7fe25705b74d - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h7a171614700603c7\r\n  36:     0x7fe25701c3ef - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::h14b7ec1cc219548f\r\n  37:     0x7fe256f4a25d - rustc_typeck::check::typeck_item_bodies::h09210f3d89e8e316\r\n  38:     0x7fe256f6c019 - rustc::ty::query::__query_compute::typeck_item_bodies::h2b59bdafb83bcacf\r\n  39:     0x7fe256fa18a4 - rustc::dep_graph::graph::DepGraph::with_task_impl::hc80a68025f840170\r\n  40:     0x7fe257039316 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h2d01be60148cc515\r\n  41:     0x7fe256f70b5e - rustc::util::common::time::h3ea0d1c7348e741b\r\n  42:     0x7fe257140557 - rustc_typeck::check_crate::h2dccc5ff35a7fab7\r\n  43:     0x7fe256b31795 - rustc_interface::passes::analysis::hcc2364d20e32d836\r\n  44:     0x7fe256ab5f05 - rustc::ty::query::__query_compute::analysis::hb6494d9db9853dcd\r\n  45:     0x7fe256ab8439 - rustc::dep_graph::graph::DepGraph::with_task_impl::hc526faaa29e0549a\r\n  46:     0x7fe256a24e4e - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hc2ff9ebdf5b52ec2\r\n  47:     0x7fe256a4299a - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h14f5a411e02f867a\r\n  48:     0x7fe256b7932a - rustc_interface::passes::create_global_ctxt::{{closure}}::h373e0b54add389be\r\n  49:     0x7fe256a454a8 - rustc_interface::interface::run_compiler_in_existing_thread_pool::he615c75133ce557e\r\n  50:     0x7fe256a589e2 - std::thread::local::LocalKey<T>::with::h01d8730b937bafe6\r\n  51:     0x7fe256a6bc61 - scoped_tls::ScopedKey<T>::set::h93202ef68249584c\r\n  52:     0x7fe256a837e4 - syntax::with_globals::hec7bd40bfbb002de\r\n  53:     0x7fe256aad39d - std::sys_common::backtrace::__rust_begin_short_backtrace::h1b4bf6169be40163\r\n  54:     0x7fe25658a4fa - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:82\r\n  55:     0x7fe256a2bfd9 - core::ops::function::FnOnce::call_once{{vtable.shim}}::hb217ce5152f7b02c\r\n  56:     0x7fe25655ce7f - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h352281c34878505f\r\n                               at /rustc/78ca1bda3522b14bc0336bc01dd1d49fdba2cda7/src/liballoc/boxed.rs:766\r\n  57:     0x7fe2565891e0 - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h77507a97b5d0b6ca\r\n                               at /rustc/78ca1bda3522b14bc0336bc01dd1d49fdba2cda7/src/liballoc/boxed.rs:766\r\n  58:     0x7fe2565891e0 - std::sys_common::thread::start_thread::h8e874688d93a6d97\r\n                               at src/libstd/sys_common/thread.rs:13\r\n  59:     0x7fe2565891e0 - std::sys::unix::thread::Thread::new::thread_start::hbfd3b1248521427e\r\n                               at src/libstd/sys/unix/thread.rs:79\r\n  60:     0x7fe2564bffa8 - start_thread\r\n                               at /builddir/glibc-2.29/nptl/pthread_create.c:486\r\n  61:     0x7fe2563e1b9f - __GI___clone\r\n  62:                0x0 - <unknown>\r\nquery stack during panic:\r\n#0 [dropck_outlives] computing dropck types for `Canonical { max_universe: U0, variables: [CanonicalVarInfo { kind: Const(U0) }], value: ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: UserFacing, def_id: None }, value: S<u8, _: usize> } }`\r\n#1 [typeck_tables_of] processing `main`\r\n#2 [typeck_item_bodies] type-checking all item bodies\r\n#3 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.38.0-nightly (78ca1bda3 2019-07-08) running on x86_64-unknown-linux-gnu\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `rust13`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n</details>\r\n\r\nThe error is most likely caused by the inability to deduce the value of the const generic parameter `N`; when it is made clear (with, say, `let x: S<_, {3}> = f(0u8);`) the ICE no longer occurs.\r\nThus the expected behavior is probably still a failure to build (just not an ICE).", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/62536/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/62536/timeline", "performed_via_github_app": null, "state_reason": "completed"}