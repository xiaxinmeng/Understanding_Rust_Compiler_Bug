{"url": "https://api.github.com/repos/rust-lang/rust/issues/2718", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2718/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2718/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2718/events", "html_url": "https://github.com/rust-lang/rust/issues/2718", "id": 5240243, "node_id": "MDU6SXNzdWU1MjQwMjQz", "number": 2718, "title": "LLVM assert (possibly class-related)", "user": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2012-06-25T00:07:31Z", "updated_at": "2014-06-16T21:56:25Z", "closed_at": "2012-06-26T18:15:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm trying to use classes in some code where I would normally use a resource, since resources are going away. I get the following LLVM assertion and backtrace.\n\n```\nAssertion failed: (Ty->isSized() && \"Cannot getTypeInfo() on a type that is unsized!\"), function getTypeSizeInBits, file /Users/eholk/Documents/projects/mozilla/rust/src/llvm/lib/Target/TargetData.cpp, line 466.\n\nProgram received signal SIGABRT, Aborted.\n[Switching to process 40424 thread 0x1e03]\n0x00007fff8fda7ce2 in __pthread_kill ()\n(gdb) bt\n#0  0x00007fff8fda7ce2 in __pthread_kill ()\n#1  0x00007fff962897d2 in pthread_kill ()\n#2  0x0000000101f3eca6 in abort ()\n#3  0x0000000101f3ecf8 in __assert_rtn ()\n#4  0x0000000101d777d0 in llvm::TargetData::getTypeSizeInBits ()\n#5  0x000000010128307a in LLVMSizeOfTypeInBits__c_stack_shim ()\n#6  0x000000010163becc in __morestack () at rust_task.cpp:1327\n#7  0x000000010162b7ce in rust_task::call_on_c_stack (this=0x10281e000, args=0x105026750, fn_ptr=0x105026750) at rust_task.h:392\n#8  0x000000010162c357 in rust_task::record_stack_limit () at /Users/eholk/Documents/projects/mozilla/rust/src/rt/rust_task.h:58\n#9  0x000000010162c357 in upcall_call_shim_on_c_stack (args=0x105026750, fn_ptr=0x101283040) at rust_upcall.cpp:64\n#10 0x0000000100f1c556 in middle::trans::shape::static_size_of_enum::anon ()\n#11 0x0000000100e3bc67 in middle::trans::shape::static_size_of_enum::_17b77bb34c1ffe7e::_02 ()\n#12 0x0000000100e34b9e in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#13 0x0000000100e3528e in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#14 0x0000000100f1c52b in middle::trans::shape::static_size_of_enum::anon ()\n#15 0x0000000100e3bc67 in middle::trans::shape::static_size_of_enum::_17b77bb34c1ffe7e::_02 ()\n#16 0x0000000100e34b9e in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#17 0x0000000100e34f8e in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#18 0x0000000100e34e39 in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#19 0x0000000100e3528e in middle::trans::type_of::type_of::_f3f689176c62646a::_02 ()\n#20 0x0000000101286d59 in __morestack ()\nPrevious frame inner to this frame (gdb could not unwind past this frame)\n```\n\nHere is a sampling of the code, some of which might be related.\n\n```\n    class send_packet<T: send> {\n        let mut p: option<*packet<T>>;\n        new(p: *packet<T>) { self.p = some(p); }\n        drop {\n            if self.p != none {\n                let mut p = none;\n                p <-> self.p;\n                sender_terminate(option::unwrap(p))\n            }\n        }\n        fn unwrap() -> *packet<T> {\n            let mut p = none;\n            p <-> self.p;\n            option::unwrap(p)\n        }\n    }\n\n    enum state {\n        empty,\n        full,\n        blocked,\n        terminated\n    }\n\n    type packet<T: send> = {\n        mut state: state,\n        mut blocked_task: option<task::task>,\n        mut payload: option<T>\n    };\n```\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2718/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2718/timeline", "performed_via_github_app": null, "state_reason": "completed"}