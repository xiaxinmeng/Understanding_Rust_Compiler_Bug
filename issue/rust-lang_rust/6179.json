{"url": "https://api.github.com/repos/rust-lang/rust/issues/6179", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/6179/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/6179/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/6179/events", "html_url": "https://github.com/rust-lang/rust/issues/6179", "id": 13882026, "node_id": "MDU6SXNzdWUxMzg4MjAyNg==", "number": 6179, "title": "Why did/does disable-optimize expose a hidden infinite loop", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/10", "html_url": "https://github.com/rust-lang/rust/milestone/10", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/10/labels", "id": 234060, "node_id": "MDk6TWlsZXN0b25lMjM0MDYw", "number": 10, "title": "0.7", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 110, "state": "closed", "created_at": "2012-12-22T22:31:59Z", "updated_at": "2013-07-04T01:21:16Z", "due_on": "2013-06-30T07:00:00Z", "closed_at": "2013-07-04T01:21:16Z"}, "comments": 9, "created_at": "2013-05-02T08:45:51Z", "updated_at": "2014-06-16T21:56:31Z", "closed_at": "2013-06-26T19:59:44Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This is spawned off of Issues #6061 and #6049 \n\nThose were bugs were some developers could not bootstrap Rust because it was hitting stack exhaustion issues during the bootstrap process.  The stack exhaustion was due to an infinite loop in a core routine.  However, the curious question is why that core routine was not being invoked uniformly for all builds.\n\nFrom my attempts to isolate the problem (see notes on #6061), it appears like the behavior of the binaries generated by `configure --disable-optimize` have significant _semantically-visible_ differences from binaries generated by `configure`.\n\nWe have since plugged in a fix for the infinite loop in the core routine, so that everyone can bootstrap and we're all happy.  Except we're not, because there's still a bug here that was _exposed_ by the infinite loop (namely the difference when you toggle `--disable-optimize`) and was not fixed when the infinite loop was fixed.\n\nThere are at least two ways to go about reproducing this problem at this stage (where we have not narrowed it down too much).  The first and most robust way is to actually check out the code from the commit where this bug was encountered and before it the infinite loop was removed, say for example SHA: 1d53babd2f23439975518fda94d9122b15e779c9\n(The problem with that strategy is that if the underlying bug gets fixed in the meantime by someone else, you might not know it, and waste a lot of time investigating an issue that has since been resolved.)\n\nThe second way to reproduce the problem is to revert the fix to the infinite loop (which is a tiny patch) and then attempt a bootstrap build with and without `--disable-optimize`.  I demonstrate that strategy here:\n\n```\n% git diff\ndiff --git a/src/libcore/rand.rs b/src/libcore/rand.rs\nindex 80f69f0..8b77539 100644\n--- a/src/libcore/rand.rs\n+++ b/src/libcore/rand.rs\n@@ -843,7 +843,7 @@ pub fn task_rng() -> @IsaacRng {\n // Allow direct chaining with `task_rng`\n impl<R: Rng> Rng for @R {\n     #[inline(always)]\n-    fn next(&self) -> u32 { (**self).next() }\n+    fn next(&self) -> u32 { (*self).next() }\n }\n\n /**\n% mkdir objdir-default\n% mkdir objdir-dis-opt\n% cd objdir-default/\n% ../configure > ../invoke-config-default.log\nsed: 1: \"tools/Makefile\": undefined label 'ools/Makefile'\n% make rustc-stage1 -j4 >> ../invoke-make-default.log 2>&1\n% cd ../objdir-dis-opt/\n% ../configure --disable-optimize > ../invoke-config-dis-opt.log\nsed: 1: \"tools/Makefile\": undefined label 'ools/Makefile'\n% make rustc-stage1 -j4 > ../invoke-make-dis-opt.log  2>&1\n[ERROR#1] % tail ../invoke-make-dis-opt.log\n                                                         ^~~~~\nwarning: no debug symbols in executable (-arch x86_64)\ncompile_and_link: x86_64-apple-darwin/stage0/lib/rustc/x86_64-apple-darwin/bin/rustc\ncp: x86_64-apple-darwin/stage1/lib/librustc.dylib\nwarning: no debug symbols in executable (-arch x86_64)\ncp: x86_64-apple-darwin/stage1/bin/rustc\ncompile_and_link: x86_64-apple-darwin/stage1/lib/rustc/x86_64-apple-darwin/lib/libcore.dylib\nrust: task 7ff2a040ac80 ran out of stack\n/bin/sh: line 1: 80249 Abort trap: 6           x86_64-apple-darwin/stage1/bin/rustc --cfg stage1 --target=x86_64-apple-darwin -o x86_64-apple-darwin/stage1/lib/rustc/x86_64-apple-darwin/lib/libcore.dylib /tmp/rust/src/libcore/core.rc\nmake: *** [x86_64-apple-darwin/stage1/lib/rustc/x86_64-apple-darwin/lib/libcore.dylib] Error 134\n% \n```\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/6179/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/6179/timeline", "performed_via_github_app": null, "state_reason": "completed"}