{"url": "https://api.github.com/repos/rust-lang/rust/issues/53312", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53312/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53312/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53312/events", "html_url": "https://github.com/rust-lang/rust/issues/53312", "id": 350178497, "node_id": "MDU6SXNzdWUzNTAxNzg0OTc=", "number": 53312, "title": "Missing codegen option corresponding to clang's prefer-vector-width", "user": {"login": "hdevalence", "id": 44879, "node_id": "MDQ6VXNlcjQ0ODc5", "avatar_url": "https://avatars.githubusercontent.com/u/44879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hdevalence", "html_url": "https://github.com/hdevalence", "followers_url": "https://api.github.com/users/hdevalence/followers", "following_url": "https://api.github.com/users/hdevalence/following{/other_user}", "gists_url": "https://api.github.com/users/hdevalence/gists{/gist_id}", "starred_url": "https://api.github.com/users/hdevalence/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hdevalence/subscriptions", "organizations_url": "https://api.github.com/users/hdevalence/orgs", "repos_url": "https://api.github.com/users/hdevalence/repos", "events_url": "https://api.github.com/users/hdevalence/events{/privacy}", "received_events_url": "https://api.github.com/users/hdevalence/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-08-13T20:19:23Z", "updated_at": "2020-06-03T18:14:35Z", "closed_at": "2020-06-03T18:14:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Clang 7 added a codegen option, `-mprefer-vector-width=`, which allows specifying the preferred vector width for autovectorization.  This allows preventing wide vector operations in codegen. Why? Because eagerly using wide vector operations can hurt performance on Intel CPUs in at least two ways:\r\n\r\n1.  Wide vector operations can knock the CPU out of the highest turbo states, reducing the frequency for the next few million cycles;\r\n2.  Some CPUs implement wide operations by fusing execution ports, so interspersing wider operations with narrower ones can reduce overall throughput.\r\n\r\nOn the other hand, AVX512 doubles the number of vector registers, so it's useful for performance to enable `target_cpu=skylake-avx512`, even without using 512-bit operations.\r\n\r\nUnfortunately, there doesn't seem to be a way to use this option with rustc: it's not one of the `-C` codegen options, and passing `-C llvm-args=-prefer-vector-width=256` gives\r\n```\r\nrustc: Unknown command line argument '-prefer-vector-width=256'.  Try: 'rustc -help'\r\nrustc: Did you mean '-force-vector-width=256'?\r\n```\r\n\r\nIt would be great if rustc had a way to set the preferred vector width.", "closed_by": {"login": "hdevalence", "id": 44879, "node_id": "MDQ6VXNlcjQ0ODc5", "avatar_url": "https://avatars.githubusercontent.com/u/44879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hdevalence", "html_url": "https://github.com/hdevalence", "followers_url": "https://api.github.com/users/hdevalence/followers", "following_url": "https://api.github.com/users/hdevalence/following{/other_user}", "gists_url": "https://api.github.com/users/hdevalence/gists{/gist_id}", "starred_url": "https://api.github.com/users/hdevalence/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hdevalence/subscriptions", "organizations_url": "https://api.github.com/users/hdevalence/orgs", "repos_url": "https://api.github.com/users/hdevalence/repos", "events_url": "https://api.github.com/users/hdevalence/events{/privacy}", "received_events_url": "https://api.github.com/users/hdevalence/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53312/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53312/timeline", "performed_via_github_app": null, "state_reason": "completed"}