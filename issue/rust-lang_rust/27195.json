{"url": "https://api.github.com/repos/rust-lang/rust/issues/27195", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27195/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27195/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27195/events", "html_url": "https://github.com/rust-lang/rust/issues/27195", "id": 96374077, "node_id": "MDU6SXNzdWU5NjM3NDA3Nw==", "number": 27195, "title": "Rust and C use different in-struct f64 alignment on x86 linux", "user": {"login": "Gankra", "id": 1136864, "node_id": "MDQ6VXNlcjExMzY4NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1136864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Gankra", "html_url": "https://github.com/Gankra", "followers_url": "https://api.github.com/users/Gankra/followers", "following_url": "https://api.github.com/users/Gankra/following{/other_user}", "gists_url": "https://api.github.com/users/Gankra/gists{/gist_id}", "starred_url": "https://api.github.com/users/Gankra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Gankra/subscriptions", "organizations_url": "https://api.github.com/users/Gankra/orgs", "repos_url": "https://api.github.com/users/Gankra/repos", "events_url": "https://api.github.com/users/Gankra/events{/privacy}", "received_events_url": "https://api.github.com/users/Gankra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}, {"id": 55301991, "node_id": "MDU6TGFiZWw1NTMwMTk5MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86", "name": "O-x86", "color": "6e6ec0", "default": false, "description": "Target: x86 processors"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-07-21T17:39:02Z", "updated_at": "2016-08-29T23:14:02Z", "closed_at": "2016-08-29T23:14:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In particular the x86 linux C ABI has f64 aligned to 8 bytes normally, but only 4 bytes while in a struct. Rust gives f64 an unconditional 8 byte alignment. In addition, the Rust struct is not padded for its size to be a multiple of its alignment, meaning that the struct's alignment requirements will not be respected by e.g. an array. This may or may not cause exotic problems. Although it should be noted that it is \"fine\" to load an f64 on a 4 byte alignment (as C clearly does this).\n\n``` rust\n#[repr(C)]\nstruct S {\n    i: i32,\n    d: f64\n}\n\nfn main() {\n    println!(\"{} {}\", std::mem::size_of::<f64>(), std::mem::size_of::<S>());\n    println!(\"{} {}\", std::mem::align_of::<f64>(), std::mem::align_of::<S>());\n}\n```\n\n```\n8 12 \n8 8\n```\n\n``` cpp\n#include <iostream>\n\nstruct S {\n  int i;\n  double d;\n};\n\nint main() {\n  std::cout << sizeof(double) << ' ' << sizeof(S) << '\\n';\n  std::cout << alignof(double) << ' ' << alignof(S) << '\\n';\n}\n```\n\n```\n8 12\n8 4\n```\n", "closed_by": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27195/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27195/timeline", "performed_via_github_app": null, "state_reason": "completed"}