{"url": "https://api.github.com/repos/rust-lang/rust/issues/52475", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/52475/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/52475/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/52475/events", "html_url": "https://github.com/rust-lang/rust/issues/52475", "id": 342141599, "node_id": "MDU6SXNzdWUzNDIxNDE1OTk=", "number": 52475, "title": "CTFE fails to detect a certain class of infinite loops", "user": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 900795185, "node_id": "MDU6TGFiZWw5MDA3OTUxODU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-eval", "name": "A-const-eval", "color": "f7e101", "default": false, "description": "Area: constant evaluation (mir interpretation)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-07-18T01:16:40Z", "updated_at": "2019-11-20T18:02:07Z", "closed_at": "2019-11-20T18:02:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "#51702 implemented a limited form of infinite loop detection during const evaluation by periodically comparing MIR interpreter states.\r\n\r\nCurrently, the detector [considers `AllocId`s](https://github.com/rust-lang/rust/pull/51702#discussion_r197620054) when comparing interpreter memory. It is possible for two interpreter states which have different `AllocId`s to be functionally equivalent if the underlying allocations have the same structure and values. For example, the following code, which could easily be terminated by the infinite loop detector, causes const evaluation to continue forever.\r\n\r\n```rust\r\n#![feature(const_fn, const_let)]\r\n\r\nconst fn churn_alloc_id() -> usize {\r\n    let mut x: &i32 = &5;\r\n    loop {\r\n        x = &5;\r\n    }\r\n    0\r\n}\r\n\r\nfn main() {\r\n    let _ = [(); churn_alloc_id()];\r\n}\r\n```\r\n\r\nThis hangs the current nightly build (2017-07-16).\r\n\r\n@oli-obk [suggested](https://github.com/rust-lang/rust/pull/51702#discussion_r197585664) to ignore `AllocId`s by traversing all allocations in interpreter memory at a given moment in time in a predictable order. If two traversals observe logically equivalent `Allocation`s in the same order, the interpreter state as a whole is logically equivalent as well.\r\n\r\nI have some free time again, so I'll try to implement this.", "closed_by": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/52475/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/52475/timeline", "performed_via_github_app": null, "state_reason": "completed"}