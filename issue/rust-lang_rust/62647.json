{"url": "https://api.github.com/repos/rust-lang/cargo/issues/7133", "repository_url": "https://api.github.com/repos/rust-lang/cargo", "labels_url": "https://api.github.com/repos/rust-lang/cargo/issues/7133/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/cargo/issues/7133/comments", "events_url": "https://api.github.com/repos/rust-lang/cargo/issues/7133/events", "html_url": "https://github.com/rust-lang/cargo/issues/7133", "id": 467887558, "node_id": "MDU6SXNzdWU0Njc4ODc1NTg=", "number": 7133, "title": "Some symbol names somehow depend on the source directory location", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-07-13T04:50:49Z", "updated_at": "2019-07-14T22:25:23Z", "closed_at": "2019-07-14T22:25:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I've tried many different things, optimizations on, off, debug-info, no debug-info, and that made no difference. Here are steps to reproduce that \"works\" every time for me (using --release reduces the number of symbols affected, since so many are eliminated in this case):\r\n```\r\n$ cargo --version\r\ncargo 1.36.0 (c4fcfb725 2019-05-15)\r\n$ rustc --version\r\nrustc 1.36.0 (a53f9df32 2019-07-03)\r\n$ cargo new t1\r\n$ cp -r t1 t2\r\n$ cd t1\r\n$ CARGO_INCREMENTAL=0 cargo rustc --release -- --remap-path-prefix=$PWD=. -C codegen-units=1\r\n   Compiling t1 v0.1.0 (/tmp/t1)\r\n    Finished release [optimized] target(s) in 0.29s\r\n$ cd ../t2\r\n$ CARGO_INCREMENTAL=0 cargo rustc --release -- --remap-path-prefix=$PWD=. -C codegen-units=1\r\n   Compiling t1 v0.1.0 (/tmp/t2)\r\n    Finished release [optimized] target(s) in 0.27s\r\n$ cd ..\r\n$ diffoscope t[12]/target/release/t1\r\n--- t1/target/release/t1\r\n+++ t2/target/release/t1\r\n\u251c\u2500\u2500 readelf --wide --symbols {}\r\n\u2502 @@ -129,20 +129,20 @@\r\n\u2502      41: 0000000000004180     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones\r\n\u2502      42: 00000000000041b0     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones\r\n\u2502      43: 00000000000041f0     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux\r\n\u2502      44: 0000000000030038     1 OBJECT  LOCAL  DEFAULT   28 completed.7325\r\n\u2502      45: 000000000002e168     0 OBJECT  LOCAL  DEFAULT   23 __do_global_dtors_aux_fini_array_entry\r\n\u2502      46: 0000000000004230     0 FUNC    LOCAL  DEFAULT   14 frame_dummy\r\n\u2502      47: 000000000002e160     0 OBJECT  LOCAL  DEFAULT   22 __frame_dummy_init_array_entry\r\n\u2502 -    48: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS t1.akdfy859-cgu.0\r\n\u2502 -    49: 0000000000004270    71 FUNC    LOCAL  DEFAULT   14 _ZN2t14main17hc5d68b83d81d2494E\r\n\u2502 -    50: 0000000000004240     7 FUNC    LOCAL  DEFAULT   14 _ZN3std2rt10lang_start28_$u7b$$u7b$closure$u7d$$u7d$17h5d4bc421a6240ab3E\r\n\u2502 -    51: 0000000000004250     7 FUNC    LOCAL  DEFAULT   14 _ZN4core3ops8function6FnOnce40call_once$u7b$$u7b$vtable.shim$u7d$$u7d$17h5825211e365a5efdE\r\n\u2502 -    52: 0000000000004260     1 FUNC    LOCAL  DEFAULT   14 _ZN4core3ptr18real_drop_in_place17h5e90b097dfd8451cE\r\n\u2502 -    53: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS 45oartxzl9zxvu7a\r\n\u2502 +    48: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS t1.aywbp33t-cgu.0\r\n\u2502 +    49: 0000000000004270    71 FUNC    LOCAL  DEFAULT   14 _ZN2t14main17h18e047a624f74a19E\r\n\u2502 +    50: 0000000000004240     7 FUNC    LOCAL  DEFAULT   14 _ZN3std2rt10lang_start28_$u7b$$u7b$closure$u7d$$u7d$17hbdbfcf746a94100cE\r\n\u2502 +    51: 0000000000004250     7 FUNC    LOCAL  DEFAULT   14 _ZN4core3ops8function6FnOnce40call_once$u7b$$u7b$vtable.shim$u7d$$u7d$17hd8c4386471704473E\r\n\u2502 +    52: 0000000000004260     1 FUNC    LOCAL  DEFAULT   14 _ZN4core3ptr18real_drop_in_place17h66f94376c5a38a4aE\r\n\u2502 +    53: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS 3d9navqc0k273olq\r\n\u2502      54: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS std.7lpsvnrb-cgu.0\r\n\u2502      55: 000000000002c7d4     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table1000\r\n\u2502      56: 000000000002c800     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table1002\r\n\u2502      57: 000000000002c81c     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table1006\r\n\u2502      58: 000000000002ba48     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table102\r\n\u2502      59: 000000000002c838     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table1031\r\n\u2502      60: 000000000002c864     0 NOTYPE  LOCAL  DEFAULT   19 GCC_except_table1039\r\n\u251c\u2500\u2500 objdump --line-numbers --disassemble --demangle --reloc --section=.text {}\r\n\u2502 @@ -75,42 +75,42 @@\r\n\u2502  frame_dummy():\r\n\u2502      4230:\te9 7b ff ff ff       \tjmpq   41b0 <register_tm_clones>\r\n\u2502      4235:\t66 2e 0f 1f 84 00 00 \tnopw   %cs:0x0(%rax,%rax,1)\r\n\u2502      423c:\t00 00 00 \r\n\u2502      423f:\t90                   \tnop\r\n\u2502  \r\n\u2502  0000000000004240 <std::rt::lang_start::{{closure}}>:\r\n\u2502 -_ZN3std2rt10lang_start28_$u7b$$u7b$closure$u7d$$u7d$17h5d4bc421a6240ab3E():\r\n\u2502 +_ZN3std2rt10lang_start28_$u7b$$u7b$closure$u7d$$u7d$17hbdbfcf746a94100cE():\r\n\u2502      4240:\t50                   \tpush   %rax\r\n\u2502      4241:\tff 17                \tcallq  *(%rdi)\r\n\u2502      4243:\t31 c0                \txor    %eax,%eax\r\n\u2502      4245:\t59                   \tpop    %rcx\r\n\u2502      4246:\tc3                   \tretq   \r\n\u2502      4247:\t66 0f 1f 84 00 00 00 \tnopw   0x0(%rax,%rax,1)\r\n\u2502      424e:\t00 00 \r\n\u2502  \r\n\u2502  0000000000004250 <core::ops::function::FnOnce::call_once{{vtable-shim}}>:\r\n\u2502 -_ZN4core3ops8function6FnOnce40call_once$u7b$$u7b$vtable.shim$u7d$$u7d$17h5825211e365a5efdE():\r\n\u2502 +_ZN4core3ops8function6FnOnce40call_once$u7b$$u7b$vtable.shim$u7d$$u7d$17hd8c4386471704473E():\r\n\u2502      4250:\t50                   \tpush   %rax\r\n\u2502      4251:\tff 17                \tcallq  *(%rdi)\r\n\u2502      4253:\t31 c0                \txor    %eax,%eax\r\n\u2502      4255:\t59                   \tpop    %rcx\r\n\u2502      4256:\tc3                   \tretq   \r\n\u2502      4257:\t66 0f 1f 84 00 00 00 \tnopw   0x0(%rax,%rax,1)\r\n\u2502      425e:\t00 00 \r\n\u2502  \r\n\u2502  0000000000004260 <core::ptr::real_drop_in_place>:\r\n\u2502 -_ZN4core3ptr18real_drop_in_place17h5e90b097dfd8451cE():\r\n\u2502 +_ZN4core3ptr18real_drop_in_place17h66f94376c5a38a4aE():\r\n\u2502      4260:\tc3                   \tretq   \r\n\u2502      4261:\t66 2e 0f 1f 84 00 00 \tnopw   %cs:0x0(%rax,%rax,1)\r\n\u2502      4268:\t00 00 00 \r\n\u2502      426b:\t0f 1f 44 00 00       \tnopl   0x0(%rax,%rax,1)\r\n\u2502  \r\n\u2502  0000000000004270 <t1::main>:\r\n\u2502 -_ZN2t14main17hc5d68b83d81d2494E():\r\n\u2502 +_ZN2t14main17h18e047a624f74a19E():\r\n\u2502      4270:\t48 83 ec 38          \tsub    $0x38,%rsp\r\n\u2502      4274:\t48 8d 05 25 9f 02 00 \tlea    0x29f25(%rip),%rax        \r\n\u2502      427b:\t48 89 44 24 08       \tmov    %rax,0x8(%rsp)\r\n\u2502      4280:\t48 c7 44 24 10 01 00 \tmovq   $0x1,0x10(%rsp)\r\n\u2502      4287:\t00 00 \r\n\u2502      4289:\t48 c7 44 24 18 00 00 \tmovq   $0x0,0x18(%rsp)\r\n\u2502      4290:\t00 00\r\n\u251c\u2500\u2500 readelf --wide --decompress --hex-dump=.strtab {}\r\n\u2502 @@ -5,33 +5,33 @@\r\n\u2502    0x00000020 005f5f64 6f5f676c 6f62616c 5f64746f .__do_global_dto\r\n\u2502    0x00000030 72735f61 75780063 6f6d706c 65746564 rs_aux.completed\r\n\u2502    0x00000040 2e373332 35005f5f 646f5f67 6c6f6261 .7325.__do_globa\r\n\u2502    0x00000050 6c5f6474 6f72735f 6175785f 66696e69 l_dtors_aux_fini\r\n\u2502    0x00000060 5f617272 61795f65 6e747279 00667261 _array_entry.fra\r\n\u2502    0x00000070 6d655f64 756d6d79 005f5f66 72616d65 me_dummy.__frame\r\n\u2502    0x00000080 5f64756d 6d795f69 6e69745f 61727261 _dummy_init_arra\r\n\u2502 -  0x00000090 795f656e 74727900 74312e61 6b646679 y_entry.t1.akdfy\r\n\u2502 -  0x000000a0 3835392d 6367752e 30005f5a 4e327431 859-cgu.0._ZN2t1\r\n\u2502 -  0x000000b0 346d6169 6e313768 63356436 38623833 4main17hc5d68b83\r\n\u2502 -  0x000000c0 64383164 32343934 45005f5a 4e337374 d81d2494E._ZN3st\r\n\u2502 +  0x00000090 795f656e 74727900 74312e61 79776270 y_entry.t1.aywbp\r\n\u2502 +  0x000000a0 3333742d 6367752e 30005f5a 4e327431 33t-cgu.0._ZN2t1\r\n\u2502 +  0x000000b0 346d6169 6e313768 31386530 34376136 4main17h18e047a6\r\n\u2502 +  0x000000c0 32346637 34613139 45005f5a 4e337374 24f74a19E._ZN3st\r\n\u2502    0x000000d0 64327274 31306c61 6e675f73 74617274 d2rt10lang_start\r\n\u2502    0x000000e0 32385f24 75376224 24753762 24636c6f 28_$u7b$$u7b$clo\r\n\u2502    0x000000f0 73757265 24753764 24247537 64243137 sure$u7d$$u7d$17\r\n\u2502 -  0x00000100 68356434 62633432 31613632 34306162 h5d4bc421a6240ab\r\n\u2502 -  0x00000110 3345005f 5a4e3463 6f726533 6f707338 3E._ZN4core3ops8\r\n\u2502 +  0x00000100 68626462 66636637 34366139 34313030 hbdbfcf746a94100\r\n\u2502 +  0x00000110 6345005f 5a4e3463 6f726533 6f707338 cE._ZN4core3ops8\r\n\u2502    0x00000120 66756e63 74696f6e 36466e4f 6e636534 function6FnOnce4\r\n\u2502    0x00000130 3063616c 6c5f6f6e 63652475 37622424 0call_once$u7b$$\r\n\u2502    0x00000140 75376224 76746162 6c652e73 68696d24 u7b$vtable.shim$\r\n\u2502 -  0x00000150 75376424 24753764 24313768 35383235 u7d$$u7d$17h5825\r\n\u2502 -  0x00000160 32313165 33363561 35656664 45005f5a 211e365a5efdE._Z\r\n\u2502 +  0x00000150 75376424 24753764 24313768 64386334 u7d$$u7d$17hd8c4\r\n\u2502 +  0x00000160 33383634 37313730 34343733 45005f5a 386471704473E._Z\r\n\u2502    0x00000170 4e34636f 72653370 74723138 7265616c N4core3ptr18real\r\n\u2502    0x00000180 5f64726f 705f696e 5f706c61 63653137 _drop_in_place17\r\n\u2502 -  0x00000190 68356539 30623039 37646664 38343531 h5e90b097dfd8451\r\n\u2502 -  0x000001a0 63450034 356f6172 74787a6c 397a7876 cE.45oartxzl9zxv\r\n\u2502 -  0x000001b0 75376100 7374642e 376c7073 766e7262 u7a.std.7lpsvnrb\r\n\u2502 +  0x00000190 68363666 39343337 36633561 33386134 h66f94376c5a38a4\r\n\u2502 +  0x000001a0 61450033 64396e61 76716330 6b323733 aE.3d9navqc0k273\r\n\u2502 +  0x000001b0 6f6c7100 7374642e 376c7073 766e7262 olq.std.7lpsvnrb\r\n\u2502    0x000001c0 2d636775 2e300047 43435f65 78636570 -cgu.0.GCC_excep\r\n\u2502    0x000001d0 745f7461 626c6531 30303000 4743435f t_table1000.GCC_\r\n\u2502    0x000001e0 65786365 70745f74 61626c65 31303032 except_table1002\r\n\u2502    0x000001f0 00474343 5f657863 6570745f 7461626c .GCC_except_tabl\r\n\u2502    0x00000200 65313030 36004743 435f6578 63657074 e1006.GCC_except\r\n\u2502    0x00000210 5f746162 6c653130 32004743 435f6578 _table102.GCC_ex\r\n\u2502    0x00000220 63657074 5f746162 6c653130 33310047 cept_table1031.G\r\n```\r\n\r\nThe reason I opened this saying \"depend on the source directory location\" is that if I do cleanup everything, and do a new build in the same location, the result *is* identical:\r\n```\r\n$ cp -r t1 t3\r\n$ cd t1\r\n$ rm -rf target\r\n$ CARGO_INCREMENTAL=0 cargo rustc --release -- --remap-path-prefix=$PWD=. -C codegen-units=1\r\n   Compiling t1 v0.1.0 (/tmp/t1)\r\n    Finished release [optimized] target(s) in 0.31s\r\n$ cd ..\r\n$ diffoscope t[13]/target/release/t1\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/cargo/issues/7133/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/cargo/issues/7133/timeline", "performed_via_github_app": null, "state_reason": "completed"}