{"url": "https://api.github.com/repos/rust-lang/rust/issues/82753", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82753/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82753/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82753/events", "html_url": "https://github.com/rust-lang/rust/issues/82753", "id": 821939162, "node_id": "MDU6SXNzdWU4MjE5MzkxNjI=", "number": 82753, "title": "On RISC-V, `tp` register cannot be used in Rust's inline assembly", "user": {"login": "luojia65", "id": 40385009, "node_id": "MDQ6VXNlcjQwMzg1MDA5", "avatar_url": "https://avatars.githubusercontent.com/u/40385009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luojia65", "html_url": "https://github.com/luojia65", "followers_url": "https://api.github.com/users/luojia65/followers", "following_url": "https://api.github.com/users/luojia65/following{/other_user}", "gists_url": "https://api.github.com/users/luojia65/gists{/gist_id}", "starred_url": "https://api.github.com/users/luojia65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luojia65/subscriptions", "organizations_url": "https://api.github.com/users/luojia65/orgs", "repos_url": "https://api.github.com/users/luojia65/repos", "events_url": "https://api.github.com/users/luojia65/events{/privacy}", "received_events_url": "https://api.github.com/users/luojia65/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 91598611, "node_id": "MDU6TGFiZWw5MTU5ODYxMQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inline-assembly", "name": "A-inline-assembly", "color": "f7e101", "default": false, "description": "Area: inline asm!(..)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1210355734, "node_id": "MDU6TGFiZWwxMjEwMzU1NzM0", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-riscv", "name": "O-riscv", "color": "6e6ec0", "default": false, "description": "Target: RISC-V architecture"}, {"id": 2046313052, "node_id": "MDU6TGFiZWwyMDQ2MzEzMDUy", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-asm", "name": "F-asm", "color": "f9c0cc", "default": false, "description": "`#![feature(asm)]` (not `llvm_asm`)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-03-04T09:26:01Z", "updated_at": "2021-03-11T15:04:24Z", "closed_at": "2021-03-11T15:04:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI am developing my own operating system kernel on RISC-V. In RISC-V, `tp` and `gp` registers are not often used by user level application, but is significant in developing kernels. \r\n\r\nI tried this code:\r\n\r\n```rust\r\nasm!(\"\", lateout(\"tp\") tp);\r\n```\r\n\r\nI expected to see the `tp` register is read, but instead, this error happened:\r\n\r\n```\r\nerror: invalid register `tp`: the thread pointer cannot be used as an operand for inline asm\r\n  --> tornado-kernel\\src\\hart.rs:32:26\r\n   |\r\n32 |                 asm!(\"\", lateout(\"tp\") tp);\r\n   | \r\n```\r\n\r\nThe `tp` and `gp` register is significantly useful when we develop kernels that interacts to user applications with shared memory blocks. Register values in `tp` and `gp` can act as a hint to what address space and resources the current task uses.\r\n\r\nMaybe we should allow to use these two registers by writing and reading `tp`, `gp` register in new inline assembly, so that we can use them in operating system development. This can benefit operating system kernel design, and user level applications can use them to design runtimes and shared buffers.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.52.0-nightly (4f20caa62 2021-03-01)\r\nbinary: rustc\r\ncommit-hash: 4f20caa6258d4c74ce6b316fd347e3efe81cf557\r\ncommit-date: 2021-03-01\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.52.0-nightly\r\nLLVM version: 11.0.1\r\n```\r\n", "closed_by": {"login": "luojia65", "id": 40385009, "node_id": "MDQ6VXNlcjQwMzg1MDA5", "avatar_url": "https://avatars.githubusercontent.com/u/40385009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luojia65", "html_url": "https://github.com/luojia65", "followers_url": "https://api.github.com/users/luojia65/followers", "following_url": "https://api.github.com/users/luojia65/following{/other_user}", "gists_url": "https://api.github.com/users/luojia65/gists{/gist_id}", "starred_url": "https://api.github.com/users/luojia65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luojia65/subscriptions", "organizations_url": "https://api.github.com/users/luojia65/orgs", "repos_url": "https://api.github.com/users/luojia65/repos", "events_url": "https://api.github.com/users/luojia65/events{/privacy}", "received_events_url": "https://api.github.com/users/luojia65/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82753/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82753/timeline", "performed_via_github_app": null, "state_reason": "completed"}