{"url": "https://api.github.com/repos/rust-lang/rust/issues/43039", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43039/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43039/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43039/events", "html_url": "https://github.com/rust-lang/rust/issues/43039", "id": 240266045, "node_id": "MDU6SXNzdWUyNDAyNjYwNDU=", "number": 43039, "title": "Cannot link with Win32 libraries using the MSVC toolchain", "user": {"login": "Tomcc", "id": 553214, "node_id": "MDQ6VXNlcjU1MzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/553214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tomcc", "html_url": "https://github.com/Tomcc", "followers_url": "https://api.github.com/users/Tomcc/followers", "following_url": "https://api.github.com/users/Tomcc/following{/other_user}", "gists_url": "https://api.github.com/users/Tomcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tomcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tomcc/subscriptions", "organizations_url": "https://api.github.com/users/Tomcc/orgs", "repos_url": "https://api.github.com/users/Tomcc/repos", "events_url": "https://api.github.com/users/Tomcc/events{/privacy}", "received_events_url": "https://api.github.com/users/Tomcc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2017-07-03T21:14:47Z", "updated_at": "2020-02-20T21:13:11Z", "closed_at": "2017-07-14T23:35:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've switched my environment over from GNU to MSVC, to be able to debug in VSCode. \r\nIf I try to build anything, I get an error like this one as soon as some win32-specific library is built:\r\n```\r\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise>cargo install cargo-update\r\n    Updating registry `https://github.com/rust-lang/crates.io-index`\r\n  Installing cargo-update v1.1.1\r\n   Compiling winapi v0.2.8\r\n   Compiling unicode-width v0.1.4\r\n   Compiling vcpkg v0.2.2\r\n   Compiling utf8-ranges v1.0.0\r\n   Compiling bitflags v0.9.1\r\n   Compiling lazy_static v0.2.8\r\n   Compiling libc v0.2.24\r\n   Compiling winapi-build v0.1.1\r\n   Compiling array_tool v0.4.0\r\n   Compiling tabwriter v1.0.3\r\n   Compiling pkg-config v0.3.9\r\n   Compiling gcc v0.3.51\r\n   Compiling advapi32-sys v0.2.0\r\n   Compiling unicode-segmentation v1.1.0\r\nerror: linking with `link.exe` failed: exit code: 1181\r\n  |\r\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Enterprise\\\\VC\\\\Tools\\\\MSVC\\\\14.10.25017\\\\bin\\\\HostX86\\\\x86\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\tochecch\\\\AppData\\\\Local\\\\Temp\\\\cargo-install.abPCagDNmi5f\\\\release\\\\build\\\\advapi32-sys-a27db48c38a94830\\\\build_script_build-a27db48c38a94830.0.o\" \"/OUT:C:\\\\Users\\\\tochecch\\\\AppData\\\\Local\\\\Temp\\\\cargo-install.abPCagDNmi5f\\\\release\\\\build\\\\advapi32-sys-a27db48c38a94830\\\\build_script_build-a27db48c38a94830.exe\" \"/OPT:REF,ICF\" \"/DEBUG\" \"/LIBPATH:C:\\\\Users\\\\tochecch\\\\AppData\\\\Local\\\\Temp\\\\cargo-install.abPCagDNmi5f\\\\release\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\tochecch\\\\AppData\\\\Local\\\\Temp\\\\cargo-install.abPCagDNmi5f\\\\release\\\\deps\\\\libbuild-cc558114ba27a576.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-0a78323911070f99.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librand-c279a51d66700350.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcollections-d7bf31a4ca1ea637.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd_unicode-d367c3ba0db49600.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-2d4bf02140c11dcb.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-add7a84d7e82d084.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-84688accbc86d6b7.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-fe2e68b21f0bdd7a.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc_system-7fc0381594c93f56.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-ea9d77e7c23fe65c.rlib\" \"C:\\\\Users\\\\tochecch\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-91b619d34dd1f5aa.rlib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"shell32.lib\" \"msvcrt.lib\"\r\n  = note: LINK : fatal error LNK1181: cannot open input file 'userenv.lib'\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `advapi32-sys`.\r\nBuild failed, waiting for other jobs to finish...\r\n```\r\n\r\nOther crates fail at `kernel32-sys` or others.\r\nI've installed the VS2015 build tools, tried running this in the 2015/17 MSBuild Command Prompt  (the one that runs `vcvarsall.bat`) but I get the same error everywhere.\r\nI've also tried switching between using VS2017's linker and the linker that came with the Build Tools, and also got no luck.\r\nI know the files it needs are installed, but I have no idea how to let `cargo` start using them.\r\n\r\nSorry if it's a known issue, but the similar threads I could find didn't solve my problem.", "closed_by": {"login": "Tomcc", "id": 553214, "node_id": "MDQ6VXNlcjU1MzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/553214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Tomcc", "html_url": "https://github.com/Tomcc", "followers_url": "https://api.github.com/users/Tomcc/followers", "following_url": "https://api.github.com/users/Tomcc/following{/other_user}", "gists_url": "https://api.github.com/users/Tomcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Tomcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Tomcc/subscriptions", "organizations_url": "https://api.github.com/users/Tomcc/orgs", "repos_url": "https://api.github.com/users/Tomcc/repos", "events_url": "https://api.github.com/users/Tomcc/events{/privacy}", "received_events_url": "https://api.github.com/users/Tomcc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43039/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43039/timeline", "performed_via_github_app": null, "state_reason": "completed"}