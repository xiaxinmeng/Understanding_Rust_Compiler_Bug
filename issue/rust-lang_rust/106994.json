{"url": "https://api.github.com/repos/rust-lang/rust/issues/106994", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/106994/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/106994/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/106994/events", "html_url": "https://github.com/rust-lang/rust/issues/106994", "id": 1536840668, "node_id": "I_kwDOAAsO6M5bmlPc", "number": 106994, "title": "`generic_const_exprs` does not work properly with const/type param defaults", "user": {"login": "BoxyUwU", "id": 21149742, "node_id": "MDQ6VXNlcjIxMTQ5NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/21149742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BoxyUwU", "html_url": "https://github.com/BoxyUwU", "followers_url": "https://api.github.com/users/BoxyUwU/followers", "following_url": "https://api.github.com/users/BoxyUwU/following{/other_user}", "gists_url": "https://api.github.com/users/BoxyUwU/gists{/gist_id}", "starred_url": "https://api.github.com/users/BoxyUwU/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BoxyUwU/subscriptions", "organizations_url": "https://api.github.com/users/BoxyUwU/orgs", "repos_url": "https://api.github.com/users/BoxyUwU/repos", "events_url": "https://api.github.com/users/BoxyUwU/events{/privacy}", "received_events_url": "https://api.github.com/users/BoxyUwU/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 762300676, "node_id": "MDU6TGFiZWw3NjIzMDA2NzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/S-blocked", "name": "S-blocked", "color": "d3dddd", "default": false, "description": "Status: marked as blocked \u274c on something else such as an RFC or other implementation work."}, {"id": 1282665911, "node_id": "MDU6TGFiZWwxMjgyNjY1OTEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-const-generics", "name": "A-const-generics", "color": "f7e101", "default": false, "description": "Area: const generics (parameters and arguments)"}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 2341291797, "node_id": "MDU6TGFiZWwyMzQxMjkxNzk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generic_const_exprs", "name": "F-generic_const_exprs", "color": "f9c0cc", "default": false, "description": "`#![feature(generic_const_exprs)]`"}, {"id": 5226739262, "node_id": "LA_kwDOAAsO6M8AAAABN4m2Pg", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-incomplete-features", "name": "requires-incomplete-features", "color": "76dcde", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-01-17T18:25:29Z", "updated_at": "2023-05-10T16:22:24Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "In order to make `feature(generic_const_exprs)` not completely broken when used with `feature(const_generics_defaults)`, #86580 was landed. From the description of the PR:\r\n\r\n> This PR doesn't handle the predicates of the const so\r\n> ```rust\r\n> trait Foo<const N: usize> { const Assoc: usize; }\r\n> pub struct Bar<const N: usize = { <()>::Assoc }> where (): Foo<N>;\r\n> ```\r\n> Resolves to `<() as Foo<N>>::Assoc` which can allow for using fwd declared params indirectly.\r\n> \r\n> ```rust\r\n> trait Foo<const N: usize> {}\r\n> struct Bar<const N: usize = { 2 + 3 }> where (): Foo<N>;\r\n> ```\r\n> This code also ICEs under this PR because instantiating the default's predicates causes an ICE as predicates_of contains predicates with fwd declared params\r\n\r\nbecause of this these two features are still pretty incompatible with eachother. This issue tracks this as there have been a large volume of issues that are all about which makes looking through `F-generic_const-exprs` issues harder than it needs to be.\r\n\r\nIt was previously attempted to fix this in #106847 but that was closed:\r\n\r\n> I don't feel super comfortable merging more hacks to make `generic_const_exprs` + `const_generics_defaults` work in the presence of each other. #86580 alone was already rather hacky and I think this PR just makes it way too much to be reasonable.  It's also unclear to me whether this is going to interfere with fixing some of the other issues we have with const generics and I don't want to make that any harder than necessary. \r\n> \r\n> `feature(generic_const_exprs)` is an incomplete feature (both literally and according to the `incomplete_features` lint), having it in a broken state because we are not currently in a good position to properly fix this seems fine to me. Thanks for making the PR anyway but I expect this issue will stay open until we make a lot more progress on `generic_const_exprs` :sweat_smile:  \r\n    \r\n\r\n### duplicate issues\r\n\r\nWhen this is fixed the following should be revisited and checked to make sure everything works as intended:\r\n\r\n- [ ] [#106473 description](https://github.com/rust-lang/rust/issues/106473#issue-1519743404)\r\n- [ ] [#106473 comment](https://github.com/rust-lang/rust/issues/106473#issuecomment-1373778123)\r\n- [ ] [#101036 comment](https://github.com/rust-lang/rust/issues/101036#issuecomment-1228413898)\r\n- [ ] [#101036 comment 2](https://github.com/rust-lang/rust/issues/101036#issuecomment-1345297071)\r\n- [ ] [#94846 description](https://github.com/rust-lang/rust/issues/94846#issue-1166441076)\r\n- [ ] [#93182 description](https://github.com/rust-lang/rust/issues/93182#issue-1111159495)\r\n- [ ] [#105631 description](https://github.com/rust-lang/rust/issues/105631#issue-1492669743)\r\n- [ ] [#111055 description](https://github.com/rust-lang/rust/issues/111055#issue-1690612999)\r\n- [ ] [#111419 description](https://github.com/rust-lang/rust/issues/111419#issue-1703197021)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/106994/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/106994/timeline", "performed_via_github_app": null, "state_reason": null}