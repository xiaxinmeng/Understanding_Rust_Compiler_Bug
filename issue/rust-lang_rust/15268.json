{"url": "https://api.github.com/repos/rust-lang/rust/issues/15268", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/15268/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/15268/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/15268/events", "html_url": "https://github.com/rust-lang/rust/issues/15268", "id": 36781209, "node_id": "MDU6SXNzdWUzNjc4MTIwOQ==", "number": 15268, "title": "ICE inside `quote_item!` when building a syntax extension (adding a block of {...} breaks things)", "user": {"login": "killerswan", "id": 195060, "node_id": "MDQ6VXNlcjE5NTA2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/195060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killerswan", "html_url": "https://github.com/killerswan", "followers_url": "https://api.github.com/users/killerswan/followers", "following_url": "https://api.github.com/users/killerswan/following{/other_user}", "gists_url": "https://api.github.com/users/killerswan/gists{/gist_id}", "starred_url": "https://api.github.com/users/killerswan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killerswan/subscriptions", "organizations_url": "https://api.github.com/users/killerswan/orgs", "repos_url": "https://api.github.com/users/killerswan/repos", "events_url": "https://api.github.com/users/killerswan/events{/privacy}", "received_events_url": "https://api.github.com/users/killerswan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2014-06-30T09:18:52Z", "updated_at": "2015-06-29T19:54:29Z", "closed_at": "2015-06-29T19:54:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From here, again: https://github.com/killerswan/ovid/blob/ad2efdabb2eb834ca7a50cbda5806ccd033d6283/CSVProvider.rs\n\nThis change...\n\n```\novid $ git diff\ndiff --git a/CSVProvider.rs b/CSVProvider.rs\nindex 4fa650f..deed5f5 100644\n--- a/CSVProvider.rs\n+++ b/CSVProvider.rs\n@@ -158,9 +158,11 @@ fn provide_csv_given_labels(cx: &mut ExtCtxt, sp: Span, tts: &[Token\n\n    fn define_my_csv(cx0: &mut ExtCtxt) -> Option<Gc<syntax::ast::Item>> {\n       let item1: Option<Gc<syntax::ast::Item>>  = quote_item!(cx0,\n+       {\n          pub struct MyCSV {\n             pub data: Vec<(String)>,\n          }\n+       }\n       );\n       return item1;\n    }\n```\n\n...causes this error:\n\n```\novid $ cat build.sh \n#!/bin/sh\n\nrustc CSVProvider.rs \\\n&& RUST_BACKTRACE=1 rustc --test -L . CSVSample.rs \\\n&& ./CSVSample \\\n#&& rustc --test -L . --pretty expanded CSVSample.rs\novid $ \novid $ \novid $ ./build.sh \nprovide_csv_given_labels: name:   MyCSV\nprovide_csv_given_labels: path:   ./sample1.txt\nprovide_csv_given_labels: labels: Verse\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Should be able to construct MyCSV.', /Users/kevin/code/rust/src/libcore/option.rs:246\n\nstack backtrace:\n   1:        0x10ec9df15 - rt::backtrace::imp::write::haf310d3bcd19b564mPp::v0.11.0.pre\n   2:        0x10eca44b7 - failure::on_fail::hc45df1f86e771253B5p::v0.11.0.pre\n   3:        0x10ef578c9 - unwind::begin_unwind_inner::h3b3465087007e9d3VSd::v0.11.0.pre\n   4:        0x10ef5737d - unwind::begin_unwind_fmt::h4f93c5d06986f385oQd::v0.11.0.pre\n   5:        0x10ef571d1 - rust_begin_unwind\n   6:        0x10efa392e - failure::begin_unwind::h719e8df35cbc239aX2v::v0.11.0.pre\n   7:        0x1103c1c43 - option::Option<T>::expect::h2580405981230248213::v0.1.pre\n   8:        0x1103765b9 - provide_csv_given_labels::ha0300b7498e0c1ec8ea::v0.1.pre\n   9:        0x10e554a93 - ext::base::BasicMacroExpander.MacroExpander::expand::h154f68f6a6e6f5a3WuR::v0.11.0.pre\n  10:        0x10e583437 - ext::expand::expand_item_mac::hb101d2d66713086aMoS::v0.11.0.pre\n  11:        0x10e58047d - ext::expand::expand_item::h4d9519cde48986adRhS::v0.11.0.pre\n  12:        0x10e57d9b3 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::h1074a02b3c56a71baZS::v0.11.0.pre\n  13:        0x10e5894cc - fold::noop_fold_mod::closure.36443\n  14:        0x10e58904b - iter::Iterator::collect::h2886547492356325285::v0.11.0.pre\n  15:        0x10e58747b - fold::Folder::fold_mod::h13372765266361103463::v0.11.0.pre\n  16:        0x10e585204 - fold::noop_fold_item::h4835347241229306232::v0.11.0.pre\n  17:        0x10e58039e - ext::expand::expand_item::h4d9519cde48986adRhS::v0.11.0.pre\n  18:        0x10e57d9b3 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::h1074a02b3c56a71baZS::v0.11.0.pre\n  19:        0x10e5a97bc - fold::noop_fold_stmt::h312506400242028249::v0.11.0.pre\n  20:        0x10e592090 - ext::expand::expand_non_macro_stmt::he6be1fb8eacd6231dGS::v0.11.0.pre\n  21:        0x10e59006a - ext::expand::expand_stmt::h873ade29a19e6467LyS::v0.11.0.pre\n  22:        0x10e5b2403 - ext::expand::expand_block_elts::closure.36942\n  23:        0x10e57f33c - ext::expand::expand_block_elts::h127b1d2eb496eb44kOS::v0.11.0.pre\n  24:        0x10e579e1c - ext::expand::MacroExpander<'a, 'b>.Folder::fold_block::h55de8bcdc64621e3PZS::v0.11.0.pre\n  25:        0x10e58514e - fold::noop_fold_item::h4835347241229306232::v0.11.0.pre\n  26:        0x10e580621 - ext::expand::expand_item::h4d9519cde48986adRhS::v0.11.0.pre\n  27:        0x10e57d9b3 - ext::expand::MacroExpander<'a, 'b>.Folder::fold_item::h1074a02b3c56a71baZS::v0.11.0.pre\n  28:        0x10e5894cc - fold::noop_fold_mod::closure.36443\n  29:        0x10e58904b - iter::Iterator::collect::h2886547492356325285::v0.11.0.pre\n  30:        0x10e58747b - fold::Folder::fold_mod::h13372765266361103463::v0.11.0.pre\n  31:        0x10e5b7a1b - ext::expand::expand_crate::h25aa9100b57efc54W0S::v0.11.0.pre\n  32:        0x10c5d5ea4 - driver::driver::phase_2_configure_and_expand::closure.114250\n  33:        0x10c07ed36 - driver::driver::phase_2_configure_and_expand::h7689d645fa58c25di0p::v0.11.0.pre\n  34:        0x10c57c58d - driver::driver::compile_input::hc0c03ab596166c0f0Tp::v0.11.0.pre\n  35:        0x10c643bdb - driver::run_compiler::h76f7d2d37cdffc51ZDs::v0.11.0.pre\n  36:        0x10c6413f6 - driver::main_args::closure.117268\n  37:        0x10c655a7b - task::TaskBuilder<S>::try_future::closure.118406\n  38:        0x10c655914 - task::TaskBuilder<S>::spawn_internal::closure.118383\n  39:        0x10bc4fd2c - task::spawn_opts::closure.7597\n  40:        0x10efbce4c - rust_try\n  41:        0x10ef53d6a - unwind::try::hc87b0c05dd7c713akHd::v0.11.0.pre\n  42:        0x10ef53a6c - task::Task::run::hcd249873983c9e78cTc::v0.11.0.pre\n  43:        0x10bc4fbbb - task::spawn_opts::closure.7542\n  44:        0x10ef565d9 - thread::thread_start::h131e955cf3141f2fKfd::v0.11.0.pre\n  45:     0x7fff98ec3899 - _pthread_body\n  46:     0x7fff98ec372a - _pthread_struct_init\n```\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/15268/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/15268/timeline", "performed_via_github_app": null, "state_reason": "completed"}