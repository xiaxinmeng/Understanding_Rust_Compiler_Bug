{"url": "https://api.github.com/repos/rust-lang/rust/issues/96637", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96637/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96637/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96637/events", "html_url": "https://github.com/rust-lang/rust/issues/96637", "id": 1222911551, "node_id": "I_kwDOAAsO6M5I5CY_", "number": 96637, "title": "Building a powerpc 32bit be #[no_std] crate fails to link due to `memcpy` and other libc symbols", "user": {"login": "aruiz", "id": 2845, "node_id": "MDQ6VXNlcjI4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aruiz", "html_url": "https://github.com/aruiz", "followers_url": "https://api.github.com/users/aruiz/followers", "following_url": "https://api.github.com/users/aruiz/following{/other_user}", "gists_url": "https://api.github.com/users/aruiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/aruiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aruiz/subscriptions", "organizations_url": "https://api.github.com/users/aruiz/orgs", "repos_url": "https://api.github.com/users/aruiz/repos", "events_url": "https://api.github.com/users/aruiz/events{/privacy}", "received_events_url": "https://api.github.com/users/aruiz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-05-02T13:47:02Z", "updated_at": "2022-05-02T17:40:25Z", "closed_at": "2022-05-02T17:40:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to write bootloader code for an OpenFirmware/PowerPC environment. This environment runs on 32bit big endian by default.\r\n\r\nWhen trying to build this crate:\r\nhttps://gitlab.com/aruiz/of-rs/-/commit/92313671f4698d1cf536e08f49b1986f3c7b4ae9\r\n\r\nI am using the following config:\r\n```\r\n[target.powerpc-unknown-linux-gnu]\r\nlinker = \"ppc64le-linux-gnu-gcc\"\r\nar = \"ppc64le-linux-gnu-gcc-ar\"\r\nrustflags = [\r\n    \"-C\", \"link-args=-nostdlib -ffreestanding -fPIC -Ttext 100000 -mbig-endian\",\r\n    \"-C\", \"target-feature=+crt-static\",\r\n]\r\n```\r\nWhen building I am getting the following output\r\n``` \r\nof-rs]$ cargo build --release --target powerpc-unknown-linux-gnu                                                                                                                                                                \r\n   Compiling of-rs v0.1.0 (/home/aruiz/src/of-rs)                                                                                                                                                                                                                                         \r\nerror: linking with `ppc64le-linux-gnu-gcc` failed: exit status: 1                                                                                                                   \r\n  |                                                                                                                          \r\n  = note: \"ppc64le-linux-gnu-gcc\" \"-m32\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.0.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.1.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdb\r\nadcd8183455.of_rs.3b2575c0-cgu.2.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.3.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.4.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdb\r\nadcd8183455.of_rs.3b2575c0-cgu.5.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.6.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.7.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdb\r\nadcd8183455.of_rs.3b2575c0-cgu.8.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.9.rcgu.o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.1oigfcn2hdkojrar.rcgu.o\" \"-Wl,--as-needed\" \"-L\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/relea\r\nse/deps\" \"-L\" \"/home/aruiz/src/of-rs/target/release/deps\" \"-L\" \"/home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"/home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/liballoc-0e688580a2c0f1da.rlib\" \"/home/aruiz/.rustup/toolchains/nightl\r\ny-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/librustc_std_workspace_core-b5138896df06464a.rlib\" \"/home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib\" \"/home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/li\r\nb/libcompiler_builtins-543943e6cd456e9c.rlib\" \"-Wl,-Bdynamic\" \"-Wl,--eh-frame-hdr\" \"-Wl,-znoexecstack\" \"-L\" \"/home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib\" \"-o\" \"/home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455\" \"-Wl,--gc-sections\" \"-static\" \"-no-pie\" \"-Wl,-zre\r\nlro,-znow\" \"-Wl,-O1\" \"-Wl,--strip-all\" \"-nodefaultlibs\" \"-nostdlib\" \"-ffreestanding\" \"-fPIC\" \"-Ttext\" \"100000\" \"-mbig-endian\"                                                                                                                                                                                                                                              \r\n  = note: /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/liballoc-0e688580a2c0f1da.rlib(alloc-0e688580a2c0f1da.alloc.ae58703c-cgu.0.rcgu.o): in function `core::intrinsics::copy_nonoverlapping':                                                                            \r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3/library/core/src/intrinsics.rs:2123: undefined reference to `memcpy'                                                                                                                                                                                                                                             \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3/library/core/src/intrinsics.rs:2123: undefined reference to `memcpy'                    \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::bignum::Big32x40::mul_digits': \r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:314: undefined reference to `memset'                                                           \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:320: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:314: undefined reference to `memset'                                                                                                                                                                                                          \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:320: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:314: undefined reference to `memset'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:320: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:314: undefined reference to `memset'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:320: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:314: undefined reference to `memset'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:320: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::bignum::Big32x40::from_u64':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:108: undefined reference to `memset'                                                           \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:108: undefined reference to `memset'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:108: undefined reference to `memset'                                                                                                                                                                                                          \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::bignum::Big32x40::from_small':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:96: undefined reference to `memset'                                                            \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `<core::num::bignum::Big32x40 as core::clone::Clone>::clone':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                                                                                                                                                                                                                                             \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                                                                                                                                                                                                          \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::flt2dec::round_up':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:155: undefined reference to `memset'                                                      \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:163: undefined reference to `memset'                   \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::bignum::Big32x40::from_u64':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:108: undefined reference to `memset'                                                           \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::bignum::Big32x40::from_small':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:96: undefined reference to `memset'                                                                                                                                                                                                                                              \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `<core::num::bignum::Big32x40 as core::clone::Clone>::clone':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                                                                                                                                                                                                                                             \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                                                                                                                                                                                                          \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/bignum.rs:406: undefined reference to `memcpy'                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::flt2dec::strategy::dragon::format_exact':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/strategy/dragon.rs:332: undefined reference to `memset'                                          \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/.rustup/toolchains/nightly-x86_64-unknown-linux-gnu/lib/rustlib/powerpc-unknown-linux-gnu/lib/libcore-fcdccfd5c975b8ca.rlib(core-fcdccfd5c975b8ca.core.2d6c0169-cgu.0.rcgu.o): in function `core::num::flt2dec::round_up':\r\n          /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:155: undefined reference to `memset'                                                                                                                                                                                                                                        \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:163: undefined reference to `memset'                   \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:155: undefined reference to `memset'                                                                                                                                                                                                     \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /rustc/60e50fc1cfe0bb693a5f4f93eb83ef70854531e3//library/core/src/num/flt2dec/mod.rs:163: undefined reference to `memset'                   \r\n          /usr/bin/powerpc64le-linux-gnu-ld: /home/aruiz/src/of-rs/target/powerpc-unknown-linux-gnu/release/deps/of_rs-c0bdbadcd8183455.of_rs.3b2575c0-cgu.9.rcgu.o: in function `__rg_realloc':                                                                                                                                                                           \r\n          of_rs.3b2575c0-cgu.9:(.text.__rg_realloc+0xb0): undefined reference to `memcpy'                                                                                                \r\n          collect2: error: ld returned 1 exit status                                                                                                                                     \r\n                                                                                                                                                                                                                                                                                                                                                                           \r\n  = help: some `extern` functions couldn't be found; some native libraries may need to be installed or have their path specified                                                         \r\n  = note: use the `-l` flag to specify native libraries to link                                                                                                                      \r\n  = note: use the `cargo:rustc-link-lib` directive to specify the native libraries to link with Cargo (see https://doc.rust-lang.org/cargo/reference/build-scripts.html#cargorustc-link-libkindname)                                                                                                                                                                       \r\n                                                                                                                                                                                         \r\nerror: could not compile `of-rs` due to previous error   \r\n```\r\n\r\nI am not sure why a #![no_std] crate would have to link to code that expects stdlib functions like memset or memcpy, I am guessing there is a bug in the toolchain here somehow.", "closed_by": {"login": "aruiz", "id": 2845, "node_id": "MDQ6VXNlcjI4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aruiz", "html_url": "https://github.com/aruiz", "followers_url": "https://api.github.com/users/aruiz/followers", "following_url": "https://api.github.com/users/aruiz/following{/other_user}", "gists_url": "https://api.github.com/users/aruiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/aruiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aruiz/subscriptions", "organizations_url": "https://api.github.com/users/aruiz/orgs", "repos_url": "https://api.github.com/users/aruiz/repos", "events_url": "https://api.github.com/users/aruiz/events{/privacy}", "received_events_url": "https://api.github.com/users/aruiz/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96637/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96637/timeline", "performed_via_github_app": null, "state_reason": "completed"}