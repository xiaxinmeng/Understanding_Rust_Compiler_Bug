{"url": "https://api.github.com/repos/rust-lang/rust/issues/102997", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/102997/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/102997/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/102997/events", "html_url": "https://github.com/rust-lang/rust/issues/102997", "id": 1407001842, "node_id": "I_kwDOAAsO6M5T3STy", "number": 102997, "title": "Niche optimisation with disjoint tags", "user": {"login": "robertbastian", "id": 4706271, "node_id": "MDQ6VXNlcjQ3MDYyNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/4706271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robertbastian", "html_url": "https://github.com/robertbastian", "followers_url": "https://api.github.com/users/robertbastian/followers", "following_url": "https://api.github.com/users/robertbastian/following{/other_user}", "gists_url": "https://api.github.com/users/robertbastian/gists{/gist_id}", "starred_url": "https://api.github.com/users/robertbastian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robertbastian/subscriptions", "organizations_url": "https://api.github.com/users/robertbastian/orgs", "repos_url": "https://api.github.com/users/robertbastian/repos", "events_url": "https://api.github.com/users/robertbastian/events{/privacy}", "received_events_url": "https://api.github.com/users/robertbastian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1944310735, "node_id": "MDU6TGFiZWwxOTQ0MzEwNzM1", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-layout", "name": "A-layout", "color": "f7e101", "default": false, "description": "Area: Memory layout of types"}, {"id": 2352122097, "node_id": "MDU6TGFiZWwyMzUyMTIyMDk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-discussion", "name": "C-discussion", "color": "f5f1fd", "default": false, "description": "Category: Discussion or questions that doesn't represent real issues."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-10-13T01:29:35Z", "updated_at": "2023-04-15T12:38:44Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "These two types *could* be laid out the same. However, the second type makes it explicit that the tag is logically split across different bytes. Is this something we'd be okay with the compiler doing on its own? Inspecting the next part of the tag might require an extra load.\r\n\r\n```rust\r\nenum ShortSlice<T> {\r\n    Empty,\r\n    Single(T),\r\n    Multi(Box<[T]>),\r\n}\r\ndbg!(size_of::<ShortSlice<NonZeroUsize>>()); // 24\r\n\r\nenum ShortSlice2<T> {\r\n    ZeroOne(Option<T>),\r\n    Multi(Box<[T]>),\r\n}\r\n\r\ndbg!(size_of::<ShortSlice2<NonZeroUsize>>()); // 16\r\n```\r\nhttps://play.rust-lang.org/?version=nightly&mode=release&edition=2021&gist=a15d6b9d5389d781c5d778b250a02627", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/102997/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/102997/timeline", "performed_via_github_app": null, "state_reason": null}