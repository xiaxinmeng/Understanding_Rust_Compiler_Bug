{"url": "https://api.github.com/repos/rust-lang/rust/issues/34150", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34150/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34150/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34150/events", "html_url": "https://github.com/rust-lang/rust/issues/34150", "id": 159025399, "node_id": "MDU6SXNzdWUxNTkwMjUzOTk=", "number": 34150, "title": "usize downcast issues", "user": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235137, "node_id": "MDU6TGFiZWwyMzUxMzc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lint", "name": "A-lint", "color": "f7e101", "default": false, "description": "Area: Lints (warnings about flaws in source code) such as unused_mut."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-06-07T21:10:15Z", "updated_at": "2017-06-22T16:54:21Z", "closed_at": "2017-06-22T16:54:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The PR #33460 **added** something, which is good, but it also introduces problems with library authors who want to provide support (or don't want to provide support) for those platforms.\n\nIn my code I have added a macro:\n\n``` rust\nmacro_rules! convert_to_usize {\n( $val:expr, $val_type:ident ) => { {\n    let converted :usize = $val as usize;\n    if $val != converted as $val_type {\n        try!(Err(LibraryError::BufferNotAddressable));\n    }\n    converted\n}}\n}\n```\n\nIts very useful and nice.\n\nRight now I only use it when the outcome of a calculation could theoretically be larger than the 32 bit address space, when converting u64 values to usize, as rust up to now only supported platforms with at least 32 bits.\n\nNow it seems I'll have to add it to u32 -> usize conversions as well.\n\nIn order for me to do the transition some `#![forbid(downcast_to_usize)]` like feature would be nice, otherwise I'd miss something.\n\nAlso that feature would help library authors who wish to not support 16 bit architectures (due to the additional maintenance burden because now they had to watch every usize downcast) to simply add such a `#![forbid(downcast_to_usize)]` to their code, and it stops from compiling.\n\nIts always better to have code not compile than having to explain things in the docs.\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34150/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34150/timeline", "performed_via_github_app": null, "state_reason": "completed"}