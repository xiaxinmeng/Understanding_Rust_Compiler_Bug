{"url": "https://api.github.com/repos/rust-lang/rust/issues/104979", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/104979/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/104979/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/104979/events", "html_url": "https://github.com/rust-lang/rust/issues/104979", "id": 1465433184, "node_id": "I_kwDOAAsO6M5XWLxg", "number": 104979, "title": "Do not suggest introducing lifetime parameters in structs", "user": {"login": "kornelski", "id": 72159, "node_id": "MDQ6VXNlcjcyMTU5", "avatar_url": "https://avatars.githubusercontent.com/u/72159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kornelski", "html_url": "https://github.com/kornelski", "followers_url": "https://api.github.com/users/kornelski/followers", "following_url": "https://api.github.com/users/kornelski/following{/other_user}", "gists_url": "https://api.github.com/users/kornelski/gists{/gist_id}", "starred_url": "https://api.github.com/users/kornelski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kornelski/subscriptions", "organizations_url": "https://api.github.com/users/kornelski/orgs", "repos_url": "https://api.github.com/users/kornelski/repos", "events_url": "https://api.github.com/users/kornelski/events{/privacy}", "received_events_url": "https://api.github.com/users/kornelski/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-11-27T12:58:03Z", "updated_at": "2022-12-06T20:56:37Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given the following code: [playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&code=struct%20Person%20%7B%0A%20%20%20%20name%3A%20%26str%2C%0A%7D%0A)\r\n\r\n```rust\r\nstruct Person {\r\n    name: &str,\r\n}\r\n```\r\n\r\nThe current diagnostic output includes a fix suggestion:\r\n\r\n```\r\nhelp: consider introducing a named lifetime parameter\r\n  |\r\n1 ~ struct Person<'a> {\r\n2 ~     name: &'a str,\r\n```\r\n\r\nbut a more common, better solution is to change the type instead:\r\n\r\n```\r\nhelp: consider using an owning type instead:\r\n\r\n1 ~ struct Person {\r\n2 ~     name: String,\r\n```\r\n\r\n\r\nStructs that actually are meant to be temporary views of data are less common, and likely to be used by programmers who already understand borrowing. OTOH it's very common for novices learning Rust to confuse Rust's references with owning data \"by reference\" in structs. Introduction of a lifetime in a struct that is not supposed to have one has serious consequences and sets up novice users for failure. It has an effect of virally introducing lifetime annotations and constraints throughout the program, causing unnecessary fights with the borrow checker.\r\n\r\nIt would be helpful to change the fix suggestion from `&'a T` to `Box<T>`, to steer users away from the gotcha of inappropriate temporary references in structs. On top of that to avoid relatively unusual `Box<str>` and `Box<[T]>` types, they could be special-cased to suggest their more common growable relatives like `String` and `Vec<T>`.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/104979/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/104979/timeline", "performed_via_github_app": null, "state_reason": null}