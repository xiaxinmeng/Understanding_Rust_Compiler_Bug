{"url": "https://api.github.com/repos/rust-lang/rust/issues/93579", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93579/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93579/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93579/events", "html_url": "https://github.com/rust-lang/rust/issues/93579", "id": 1121829931, "node_id": "I_kwDOAAsO6M5C3cQr", "number": 93579, "title": "Spurious \"Unrecognized option\" message on rustdoc panic", "user": {"login": "ijackson", "id": 2090772, "node_id": "MDQ6VXNlcjIwOTA3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2090772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ijackson", "html_url": "https://github.com/ijackson", "followers_url": "https://api.github.com/users/ijackson/followers", "following_url": "https://api.github.com/users/ijackson/following{/other_user}", "gists_url": "https://api.github.com/users/ijackson/gists{/gist_id}", "starred_url": "https://api.github.com/users/ijackson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ijackson/subscriptions", "organizations_url": "https://api.github.com/users/ijackson/orgs", "repos_url": "https://api.github.com/users/ijackson/repos", "events_url": "https://api.github.com/users/ijackson/events{/privacy}", "received_events_url": "https://api.github.com/users/ijackson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-02-02T11:50:40Z", "updated_at": "2022-02-03T20:55:48Z", "closed_at": "2022-02-03T20:55:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\nWith a version of rustdoc affected by #93428, I observe this when this bug occurs:\r\n\r\n```\r\nrustcargo@zealot:/home/ian/Rustup/Arti/Build/arti$ cargo doc --all-features\r\n Documenting tor-dirmgr v0.0.4 (/volatile/rustcargo/Rustup/Arti/arti/crates/tor-dirmgr)\r\nthread 'rustc' panicked at 'no entry found for key', src/librustdoc/passes/collect_intra_doc_links.rs:929:16\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nerror: Unrecognized option: 'default-theme'\r\n\r\nerror: could not document `tor-dirmgr`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustdoc --edition=2018 --crate-type lib --crate-name tor_dirmgr crates/tor-dirmgr/src/lib.rs -o /volatile/rustcargo/Rustup/Arti/arti/target/doc --cfg 'feature=\"default\"' --cfg 'feature=\"memmap2\"' --cfg 'feature=\"mmap\"' --cfg 'feature=\"routerdesc\"' --cfg 'feature=\"static\"' --error-format=json --json=diagnostic-rendered-ansi,artifacts,future-incompat -C metadata=aa53d6299379729d -L dependency=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps --extern async_trait=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libasync_trait-25efcc67c068c75d.so --extern base64=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libbase64-fc54b7dac8c37ff8.rmeta --extern derive_builder=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libderive_builder-e0d29543f3ee71f0.rmeta --extern digest=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libdigest-5294b49980fdd964.rmeta --extern event_listener=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libevent_listener-e7e03de28283491f.rmeta --extern fslock=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libfslock-b312da71e00a939e.rmeta --extern futures=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libfutures-12328c3c53c18ce6.rmeta --extern hex=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libhex-52738f6114d4bb1b.rmeta --extern humantime_serde=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libhumantime_serde-a8656ada3a9f6f8c.rmeta --extern itertools=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libitertools-ed6d9e96085d6069.rmeta --extern memmap2=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libmemmap2-00f241de9244ddb8.rmeta --extern once_cell=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libonce_cell-88ef809ea5bdbc77.rmeta --extern postage=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libpostage-3cd2da63b038b761.rmeta --extern rand=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/librand-f007c982c8c51a12.rmeta --extern retry_error=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libretry_error-0d1a42193f831f72.rmeta --extern rusqlite=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/librusqlite-d24ed85c86b154d0.rmeta --extern serde=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libserde-9913dbbfcd998186.rmeta --extern signature=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libsignature-bfa06a9a193347a4.rmeta --extern thiserror=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libthiserror-e3a57847eed1a010.rmeta --extern time=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtime-974a8c2e4079d94d.rmeta --extern tor_checkable=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_checkable-e335accabe64e5a3.rmeta --extern tor_circmgr=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_circmgr-cfe77275198ffc13.rmeta --extern tor_config=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_config-f4196bf5d1cab21d.rmeta --extern tor_consdiff=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_consdiff-0616a72a65b2c3a7.rmeta --extern tor_dirclient=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_dirclient-374a51644580a5f2.rmeta --extern tor_llcrypto=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_llcrypto-a259a67655059250.rmeta --extern tor_netdir=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_netdir-77e64a6473cb5820.rmeta --extern tor_netdoc=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_netdoc-749221325fef0cc1.rmeta --extern tor_rtcompat=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtor_rtcompat-3cd44dd5107fb13d.rmeta --extern tracing=/volatile/rustcargo/Rustup/Arti/arti/target/debug/deps/libtracing-90e2cc81476e06ab.rmeta --default-theme ayu --crate-version 0.0.4` (exit status: 1)\r\nrustcargo@zealot:/home/ian/Rustup/Arti/Build/arti$ \r\n```\r\n\r\nNote the message\r\n```\r\nerror: Unrecognized option: 'default-theme'\r\n```\r\nwhich seems to be entirely spurious.  The output in #93428 and the dupe #93539 has\r\n```\r\nerror: Unrecognized option: 'crate-version'\r\n```\r\n\r\nI think I am getting the complaint about `default-theme` instead of `crate-version` because I have that set in my `rustdocflags` in `~/.cargo/config`.  Both the complained-about options do exist, and everything works when rustdoc isn't panicking.\r\n\r\nIt seems that something must be wrong with the panic handling.  It restarts argument processing somehow?\r\n\r\nI checked a random ICE issue (93578) and it appears that rustc is not affected, or that the rustdoc \"no entry found for key\" panic is special, or something.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n```\r\nrustcargo@zealot:/home/ian/Rustup/Arti/Build/arti$ rustdoc --version --verbose\r\nrustdoc 1.60.0-nightly (6abb6385b 2022-01-26)\r\nbinary: rustdoc\r\ncommit-hash: 6abb6385b2cb7249f67b9b3ce7522527767dd907\r\ncommit-date: 2022-01-26\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.60.0-nightly\r\nLLVM version: 13.0.0\r\nrustcargo@zealot:/home/ian/Rustup/Arti/Build/arti$ \r\n```\r\n\r\nNot including a backtrace since there seem to be plenty of these about.\r\n\r\n(NB this bug is not about the original panic; it is about the subsequent messages.  So while #93428 is relevant since it provides a convenient repro, this bug is not the same as that one.)", "closed_by": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93579/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93579/timeline", "performed_via_github_app": null, "state_reason": "completed"}