{"url": "https://api.github.com/repos/rust-lang/rust/issues/7814", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7814/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7814/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7814/events", "html_url": "https://github.com/rust-lang/rust/issues/7814", "id": 16788781, "node_id": "MDU6SXNzdWUxNjc4ODc4MQ==", "number": 7814, "title": "Closure does not propagate lifetimes properly", "user": {"login": "bluss", "id": 3209739, "node_id": "MDQ6VXNlcjMyMDk3Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/3209739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bluss", "html_url": "https://github.com/bluss", "followers_url": "https://api.github.com/users/bluss/followers", "following_url": "https://api.github.com/users/bluss/following{/other_user}", "gists_url": "https://api.github.com/users/bluss/gists{/gist_id}", "starred_url": "https://api.github.com/users/bluss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bluss/subscriptions", "organizations_url": "https://api.github.com/users/bluss/orgs", "repos_url": "https://api.github.com/users/bluss/repos", "events_url": "https://api.github.com/users/bluss/events{/privacy}", "received_events_url": "https://api.github.com/users/bluss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-07-16T01:38:43Z", "updated_at": "2013-07-16T21:38:50Z", "closed_at": "2013-07-16T21:01:09Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Rustc does not seem to reason correctly about lifetimes of borrowed pointers in the environment of returned closures.\n\nPlease look at the following example, I'm not sure if it should work, but it would be nice if it did:\n\nConsider this code that I _want_ to insert into std::hashmap\n\n```\n/// Visit the values representing the intersection\nfn intersection_iter<'a>(&'a self, other: &'a HashSet<T>) \n    -> FilterIterator<'a, &'a T, HashSetIterator<'a,T>> {\n    self.iter().filter(|elt| other.contains(*elt))\n}\n```\n\nRustc can not make sense of the lifetimes:\n\n```\n$ rustc --test std.rs\nhashmap.rs:796:26: 796:54 error: cannot infer an appropriate lifetime due to conflicting requirements\nhashmap.rs:796         self.iter().filter(|elt| other.contains(*elt))\n                     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\nhashmap.rs:795:60: 797:5 note: first, the lifetime cannot outlive the block at 795:60...\nhashmap.rs:795         -> FilterIterator<'a, &'a T, HashSetIterator<'a,T>> {\nhashmap.rs:796         self.iter().filter(|elt| other.contains(*elt))\nhashmap.rs:797     }\nhashmap.rs:796:26: 796:54 note: ...due to the following expression\nhashmap.rs:796         self.iter().filter(|elt| other.contains(*elt))\n                     ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\nhashmap.rs:795:60: 797:5 note: but, the lifetime must be valid for the lifetime &'a  as defined on the block at 795:60...\nhashmap.rs:795         -> FilterIterator<'a, &'a T, HashSetIterator<'a,T>> {\nhashmap.rs:796         self.iter().filter(|elt| other.contains(*elt))\nhashmap.rs:797     }\nhashmap.rs:796:8: 797:5 note: ...due to the following expression\nhashmap.rs:796         self.iter().filter(|elt| other.contains(*elt))\nhashmap.rs:797     }\nerror: aborting due to previous error\n```\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7814/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7814/timeline", "performed_via_github_app": null, "state_reason": "completed"}