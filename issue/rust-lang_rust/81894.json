{"url": "https://api.github.com/repos/rust-lang/rust/issues/81894", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81894/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81894/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81894/events", "html_url": "https://github.com/rust-lang/rust/issues/81894", "id": 803950678, "node_id": "MDU6SXNzdWU4MDM5NTA2Nzg=", "number": 81894, "title": "Incorrect debug information leading to bad visualzization for &str and slice arguments in MSVC debuggers.", "user": {"login": "nanguye2496", "id": 74681961, "node_id": "MDQ6VXNlcjc0NjgxOTYx", "avatar_url": "https://avatars.githubusercontent.com/u/74681961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nanguye2496", "html_url": "https://github.com/nanguye2496", "followers_url": "https://api.github.com/users/nanguye2496/followers", "following_url": "https://api.github.com/users/nanguye2496/following{/other_user}", "gists_url": "https://api.github.com/users/nanguye2496/gists{/gist_id}", "starred_url": "https://api.github.com/users/nanguye2496/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nanguye2496/subscriptions", "organizations_url": "https://api.github.com/users/nanguye2496/orgs", "repos_url": "https://api.github.com/users/nanguye2496/repos", "events_url": "https://api.github.com/users/nanguye2496/events{/privacy}", "received_events_url": "https://api.github.com/users/nanguye2496/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-02-08T20:55:01Z", "updated_at": "2021-03-30T20:52:43Z", "closed_at": "2021-03-30T20:52:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "(Fix for this problem: https://github.com/rust-lang/rust/pull/81898)\r\n\r\nWhen lowering MIR to LLVM IR, the compiler decomposes every function argument of type &str or slice into two components: a pointer to the memory address referenced to by the &str or slice and an integer represent the length of the str or slice. Then, the original argument is constructed in the body of the function from the data pointer and the integer arguments. Since the original argument is declared in the body of the function that owns it, it should be marked as a LocalVariable instead of an ArgumentVariable. This confusion makes MSVC debuggers unable to visualize &str and slice arguments correctly. Because these debuggers implicit treat arguments whose sizes are greater than that of a pointer as pass by reference, the values of &str or slice arguments are treated as their reference, leading to incorrect visualization for &str and slice arguments. \r\n\r\nI tried this code:\r\n\r\n```rust\r\n#[inline(never)]\r\npub fn nam_foo_function(first_var: &str) -> usize {\r\n    first_var.len()\r\n}\r\n\r\nfn main() {\r\n    s = \"hello\";\r\n    nam_foo_function(&s[1..3]);\r\n}\r\n```\r\n\r\nWhen stepping through the code in VS Code C++ debugger, I expected to see this happen:\r\n![image](https://user-images.githubusercontent.com/74681961/107279546-07538d00-6a0c-11eb-8ff1-26fb19dc2828.png)\r\n\r\nInstead, this happened:\r\n![image](https://user-images.githubusercontent.com/74681961/107279588-15a1a900-6a0c-11eb-8ff9-d4ecf013c4da.png)\r\n\r\n\r\n### Meta\r\nThis error is found on rust 1.51.0-dev, 1.50, and 1.49.\r\n", "closed_by": {"login": "nanguye2496", "id": 74681961, "node_id": "MDQ6VXNlcjc0NjgxOTYx", "avatar_url": "https://avatars.githubusercontent.com/u/74681961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nanguye2496", "html_url": "https://github.com/nanguye2496", "followers_url": "https://api.github.com/users/nanguye2496/followers", "following_url": "https://api.github.com/users/nanguye2496/following{/other_user}", "gists_url": "https://api.github.com/users/nanguye2496/gists{/gist_id}", "starred_url": "https://api.github.com/users/nanguye2496/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nanguye2496/subscriptions", "organizations_url": "https://api.github.com/users/nanguye2496/orgs", "repos_url": "https://api.github.com/users/nanguye2496/repos", "events_url": "https://api.github.com/users/nanguye2496/events{/privacy}", "received_events_url": "https://api.github.com/users/nanguye2496/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81894/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81894/timeline", "performed_via_github_app": null, "state_reason": "completed"}