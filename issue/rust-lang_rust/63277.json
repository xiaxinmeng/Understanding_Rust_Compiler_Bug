{"url": "https://api.github.com/repos/rust-lang/rust/issues/63277", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63277/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63277/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63277/events", "html_url": "https://github.com/rust-lang/rust/issues/63277", "id": 476683032, "node_id": "MDU6SXNzdWU0NzY2ODMwMzI=", "number": 63277, "title": "Different error messages between async and regular functions", "user": {"login": "Patryk27", "id": 3395477, "node_id": "MDQ6VXNlcjMzOTU0Nzc=", "avatar_url": "https://avatars.githubusercontent.com/u/3395477?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Patryk27", "html_url": "https://github.com/Patryk27", "followers_url": "https://api.github.com/users/Patryk27/followers", "following_url": "https://api.github.com/users/Patryk27/following{/other_user}", "gists_url": "https://api.github.com/users/Patryk27/gists{/gist_id}", "starred_url": "https://api.github.com/users/Patryk27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Patryk27/subscriptions", "organizations_url": "https://api.github.com/users/Patryk27/orgs", "repos_url": "https://api.github.com/users/Patryk27/repos", "events_url": "https://api.github.com/users/Patryk27/events{/privacy}", "received_events_url": "https://api.github.com/users/Patryk27/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-05T06:41:46Z", "updated_at": "2019-08-05T17:35:49Z", "closed_at": "2019-08-05T17:35:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi,\r\n\r\nLet's consider following code:\r\n```rust\r\nfn foo() -> Result<bool, ()> {\r\n    unimplemented!()\r\n}\r\n\r\nfn bar() -> Result<(), ()> {\r\n    foo()?;\r\n    ()\r\n}\r\n```\r\nThere's an error in the penultimate line - it should say `Ok(())` and Rust correctly helps to spot the mistake:\r\n```\r\n  |\r\n7 | fn bar() -> Result<(), ()> {\r\n  |             -------------- expected `std::result::Result<(), ()>` because of return type\r\n8 |     foo()?;\r\n9 |     ()\r\n  |     ^^ expected enum `std::result::Result`, found ()\r\n  |\r\n  = note: expected type `std::result::Result<(), ()>`\r\n             found type `()`\r\n```\r\nThe situation changes a bit when we switch to async functions:\r\n\r\n```rust\r\n#![feature(async_await)]\r\n\r\nasync fn foo() -> Result<bool, ()> {\r\n    unimplemented!()\r\n}\r\n\r\nasync fn bar() -> Result<(), ()> {\r\n    foo().await?;\r\n    ()\r\n}\r\n```\r\nThe error message now says `the '?' operator can only be used in a function that returns 'Result' or 'Option'`, which is totally unhelpful, since the function *is* (or at least *should be*) returning a `Result`, according to its signature.\r\n\r\nIt seems that, when dispatching error messages, the actual return types have precedence over signatures in async functions, but it's exactly the other way around in regular functions, which leads to kinda unexpected and confusing error messages.", "closed_by": {"login": "cramertj", "id": 5963049, "node_id": "MDQ6VXNlcjU5NjMwNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/5963049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cramertj", "html_url": "https://github.com/cramertj", "followers_url": "https://api.github.com/users/cramertj/followers", "following_url": "https://api.github.com/users/cramertj/following{/other_user}", "gists_url": "https://api.github.com/users/cramertj/gists{/gist_id}", "starred_url": "https://api.github.com/users/cramertj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cramertj/subscriptions", "organizations_url": "https://api.github.com/users/cramertj/orgs", "repos_url": "https://api.github.com/users/cramertj/repos", "events_url": "https://api.github.com/users/cramertj/events{/privacy}", "received_events_url": "https://api.github.com/users/cramertj/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63277/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63277/timeline", "performed_via_github_app": null, "state_reason": "completed"}