{"url": "https://api.github.com/repos/rust-lang/rust/issues/95575", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/95575/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/95575/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/95575/events", "html_url": "https://github.com/rust-lang/rust/issues/95575", "id": 1190335156, "node_id": "I_kwDOAAsO6M5G8xK0", "number": 95575, "title": "Failure compiling Fuchsia compiler", "user": {"login": "AdrianDanis", "id": 8218913, "node_id": "MDQ6VXNlcjgyMTg5MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/8218913?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdrianDanis", "html_url": "https://github.com/AdrianDanis", "followers_url": "https://api.github.com/users/AdrianDanis/followers", "following_url": "https://api.github.com/users/AdrianDanis/following{/other_user}", "gists_url": "https://api.github.com/users/AdrianDanis/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdrianDanis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdrianDanis/subscriptions", "organizations_url": "https://api.github.com/users/AdrianDanis/orgs", "repos_url": "https://api.github.com/users/AdrianDanis/repos", "events_url": "https://api.github.com/users/AdrianDanis/events{/privacy}", "received_events_url": "https://api.github.com/users/AdrianDanis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2022-04-01T22:33:20Z", "updated_at": "2022-04-06T06:08:35Z", "closed_at": "2022-04-06T06:08:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "Building the Rust compiler for Fuchsia fails with an error when building libunwind since . I don't have a fully minimal set of build steps (actual steps are documented in https://fuchsia.dev/fuchsia-src/development/build/rust_toolchain?hl=en), but one relevant piece of the config.toml is that we set `llvm-libunwind = \"in-tree\"`\r\n\r\nWhen running `x.py` the build fails with\r\n\r\n```\r\nBuilding stage2 std artifacts (x86_64-unknown-linux-gnu -> aarch64-fuchsia)\r\n   Compiling cc v1.0.69\r\n   Compiling core v0.0.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/core)\r\n   Compiling libc v0.2.116\r\n   Compiling memchr v2.4.1\r\n   Compiling std v0.0.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/std)\r\n   Compiling compiler_builtins v0.1.70\r\n   Compiling unwind v0.0.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/unwind)\r\n   Compiling profiler_builtins v0.0.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/profiler_builtins)\r\n   Compiling rustc-std-workspace-core v1.99.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/rustc-std-workspace-core)\r\n   Compiling alloc v0.0.0 (/b/s/w/ir/x/w/fuchsia-third_party-rust/library/alloc)\r\n   Compiling cfg-if v0.1.10\r\n   Compiling adler v0.2.3\r\n   Compiling rustc-demangle v0.1.21\r\nerror: overriding linking modifiers from command line is not supported\r\n  --> library/unwind/src/libunwind.rs:96:1\r\n   |\r\n96 | / extern \"C-unwind\" {\r\n97 | |     pub fn _Unwind_Resume(exception: *mut _Unwind_Exception) -> !;\r\n98 | | }\r\n   | |_^\r\n```\r\n\r\nThis happens building the Rust compiler since b75f384d0b0227000eff393e5d4e11bda56b293f was merged, and does not happen on any commit prior to that. Any newer commit can also be made to work by just reverting 1004783ef9bdcf006f0ed33badacf83a5934feb2 so this seems to be caused by https://github.com/rust-lang/rust/pull/93901\r\n\r\nRunning `x.py -v` shows\r\n\r\n```\r\n\"/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2/bin/rustc\" \"--crate-name\" \"unwind\" \"--edition=2021\" \"library/unwind/src/lib.rs\" \"--error-format=json\" \"--json=diagnostic-rendered-ansi,artifacts,future-incompat\" \"--crate-type\" \"lib\" \"--emit=dep-info,metadata,link\" \"-C\" \"opt-level=3\" \"-C\" \"embed-bitcode=no\" \"-C\" \"codegen-units=1\" \"-C\" \"debuginfo=2\" \"--cfg\" \"feature=\\\"llvm-libunwind\\\"\" \"-C\" \"metadata=7bb16b80dd794b17\" \"-C\" \"extra-filename=-7bb16b80dd794b17\" \"--out-dir\" \"/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps\" \"--target\" \"aarch64-fuchsia\" \"-L\" \"dependency=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps\" \"-L\" \"dependency=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/release/deps\" \"--extern\" \"cfg_if=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps/libcfg_if-9d1324248f6fe0fb.rmeta\" \"--extern\" \"compiler_builtins=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps/libcompiler_builtins-f51c9f6078312b82.rmeta\" \"--extern\" \"core=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps/libcore-2599389f0623040c.rmeta\" \"--extern\" \"libc=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/deps/liblibc-91b3aeedfc9688eb.rmeta\" \"--remap-path-prefix\" \"/home/adanis/test_rust_build=rustlib/src/rust\" \"-C\" \"link-arg=--sysroot=/home/adanis/test_rust_build/cipd/sdk/arch/arm64/sysroot\" \"-Lnative=/home/adanis/test_rust_build/cipd/sdk/arch/arm64/sysroot/lib\" \"-Lnative=/home/adanis/test_rust_build/cipd/sdk/arch/arm64/lib\" \"-C\" \"panic=abort\" \"-C\" \"force-unwind-tables=yes\" \"-Csymbol-mangling-version=legacy\" \"-Zunstable-options\" \"-Zunstable-options\" \"--check-cfg=names()\" \"--check-cfg=values()\" \"--check-cfg=values(bootstrap)\" \"--check-cfg=values(stdarch_intel_sde)\" \"--check-cfg=values(no_fp_fmt_parse)\" \"--check-cfg=values(no_global_oom_handling)\" \"--check-cfg=values(freebsd12)\" \"--check-cfg=values(backtrace_in_libstd)\" \"--check-cfg=values(target_env,\\\"libnx\\\")\" \"--check-cfg=values(target_os,\\\"watchos\\\")\" \"--check-cfg=values(target_arch,\\\"asmjs\\\",\\\"spirv\\\",\\\"nvptx\\\",\\\"nvptx64\\\",\\\"le32\\\",\\\"xtensa\\\")\" \"--check-cfg=values(dont_compile_me)\" \"-Zmacro-backtrace\" \"-Zsave-analysis\" \"-Cprefer-dynamic\" \"-Cembed-bitcode=yes\" \"-Zcrate-attr=doc(html_root_url=\\\"https://doc.rust-lang.org/nightly/\\\")\" \"-Z\" \"binary-dep-depinfo\" \"-l\" \"unwind\" \"-L\" \"native=/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2-std/aarch64-fuchsia/release/build/compiler_builtins-73408b68b88664ba/out\" \"-Wrust_2018_idioms\" \"-Wunused_lifetimes\" \"-Wsemicolon_in_expressions_from_macros\" \"-Dwarnings\" \"--sysroot\" \"/home/adanis/test_rust_build/fuchsia-build/x86_64-unknown-linux-gnu/stage2\" \"-Z\" \"force-unstable-if-unmarked\"\r\n```\r\n\r\nAnd the main thing of interest there is the `-l unwind` that for a Fuchsia build with `in-tree` libunwind does not match the modifiers in  [libunwind](https://github.com/rust-lang/rust/blob/23ce5fc4655ed546f74a85fc8836e95bec0c64fd/library/unwind/src/libunwind.rs#L91) and so the error therefore occurs.\r\n\r\nI can manually make that invocation work by either dropping the `-l unwind` or adding the modifier via `-l unwind,-bundle`, but I don't know how to do that as part of the actual build so I'm not sure if that is the last issue. \r\n\r\nFrom my inexperienced perspective linking against libunwind when building libunwind seems incorrect, but perhaps that's correct and there's something else going wrong?\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/95575/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/95575/timeline", "performed_via_github_app": null, "state_reason": "completed"}