{"url": "https://api.github.com/repos/rust-lang/rust/issues/90904", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/90904/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/90904/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/90904/events", "html_url": "https://github.com/rust-lang/rust/issues/90904", "id": 1052975505, "node_id": "I_kwDOAAsO6M4-wyGR", "number": 90904, "title": "Presence of `std::simd` sometimes breaks type inference", "user": {"login": "EFanZh", "id": 2160692, "node_id": "MDQ6VXNlcjIxNjA2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2160692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EFanZh", "html_url": "https://github.com/EFanZh", "followers_url": "https://api.github.com/users/EFanZh/followers", "following_url": "https://api.github.com/users/EFanZh/following{/other_user}", "gists_url": "https://api.github.com/users/EFanZh/gists{/gist_id}", "starred_url": "https://api.github.com/users/EFanZh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EFanZh/subscriptions", "organizations_url": "https://api.github.com/users/EFanZh/orgs", "repos_url": "https://api.github.com/users/EFanZh/repos", "events_url": "https://api.github.com/users/EFanZh/events{/privacy}", "received_events_url": "https://api.github.com/users/EFanZh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/87", "html_url": "https://github.com/rust-lang/rust/milestone/87", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/87/labels", "id": 7260815, "node_id": "MI_kwDOAAsO6M4AbsqP", "number": 87, "title": "1.58.0", "description": null, "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 539, "state": "closed", "created_at": "2021-10-17T19:18:18Z", "updated_at": "2022-01-18T15:20:17Z", "due_on": null, "closed_at": "2022-01-18T15:20:17Z"}, "comments": 12, "created_at": "2021-11-14T16:03:47Z", "updated_at": "2022-01-08T11:30:07Z", "closed_at": "2022-01-08T11:30:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\nuse std::mem;\r\n\r\npub fn minimum_total(triangle: Vec<Vec<i32>>) -> i32 {\r\n    let mut temp_cache = Vec::with_capacity(triangle.len());\r\n    let mut cache = Vec::with_capacity(triangle.len());\r\n\r\n    for row in triangle {\r\n        temp_cache.resize(row.len(), 0);\r\n\r\n        for (i, (target, source)) in temp_cache.iter_mut().zip(row).enumerate() {\r\n            *target = match (cache.get(i.wrapping_sub(1)), cache.get(i)) {\r\n                (None, None) => source,\r\n                (None, Some(val)) | (Some(val), None) => source + val,\r\n                (Some(left), Some(right)) => source + left.min(right),\r\n            };\r\n        }\r\n\r\n        mem::swap(&mut cache, &mut temp_cache);\r\n    }\r\n\r\n    cache.into_iter().min().unwrap()\r\n}\r\n```\r\n\r\nI expected to see this happen: The code compiles successfully.\r\n\r\nInstead, this happened: The code failed to compile:\r\n\r\n```text\r\n  --> src/lib.rs:11:36\r\n   |\r\n5  |     let mut cache = Vec::with_capacity(triangle.len());\r\n   |         --------- consider giving `cache` the explicit type `Vec<T>`, where the type parameter `T` is specified\r\n...\r\n11 |             *target = match (cache.get(i.wrapping_sub(1)), cache.get(i)) {\r\n   |                                    ^^^ cannot infer type for type parameter `T`\r\n   |\r\n   = note: type must be known at this point\r\n\r\nFor more information about this error, try `rustc --explain E0282`.\r\nerror: could not compile `playground` due to previous error\r\n```\r\n\r\nPlayground link: <https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=446e975abb9c2a303485f483494a6512>.\r\n\r\nThe code works fine with stable toolchain.\r\n\r\n### Meta\r\n\r\nRustc version: 1.58.0-nightly (2021-11-13 b416e3892d9526709f3a)", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/90904/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/90904/timeline", "performed_via_github_app": null, "state_reason": "completed"}