{"url": "https://api.github.com/repos/rust-lang/rust/issues/34280", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34280/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34280/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34280/events", "html_url": "https://github.com/rust-lang/rust/issues/34280", "id": 160302828, "node_id": "MDU6SXNzdWUxNjAzMDI4Mjg=", "number": 34280, "title": "Use after free in safe code. Trait bound with +'static is ignored when implementing some trait", "user": {"login": "vacavaca", "id": 19508396, "node_id": "MDQ6VXNlcjE5NTA4Mzk2", "avatar_url": "https://avatars.githubusercontent.com/u/19508396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vacavaca", "html_url": "https://github.com/vacavaca", "followers_url": "https://api.github.com/users/vacavaca/followers", "following_url": "https://api.github.com/users/vacavaca/following{/other_user}", "gists_url": "https://api.github.com/users/vacavaca/gists{/gist_id}", "starred_url": "https://api.github.com/users/vacavaca/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vacavaca/subscriptions", "organizations_url": "https://api.github.com/users/vacavaca/orgs", "repos_url": "https://api.github.com/users/vacavaca/repos", "events_url": "https://api.github.com/users/vacavaca/events{/privacy}", "received_events_url": "https://api.github.com/users/vacavaca/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-06-14T22:53:12Z", "updated_at": "2016-06-14T23:22:48Z", "closed_at": "2016-06-14T23:22:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "This code compiles on stable and it supposed to be safe:\n\n```\nuse std::fmt::Display;\n\ntrait Printer {\n    fn print<P: Display>(&self, printable: P);\n}\n\nstruct TestObj;\n\nimpl Printer for TestObj {\n    fn print<P: Display + 'static>(&self, printable: P) {}\n}\n\nfn main() {}\n```\n\nRust Playground: https://play.rust-lang.org/?gist=4831916a69026aa1eb6ebca8719fddcd&version=stable&backtrace=2\n\nBut I expected to see an error like \"`P: 'static` appears on the impl method but not on the corresponding trait method\".\nFurthermore only bounds defined on the function in Trait definition are checked when I use methods on the `TestObj` struct\nso I can pass a non `'static` reference to the struct method `print` and it assumed to be `'static`.\n\nWith that I can write something like this:\n\n```\nuse std::fmt::Display;\n\ntrait Printer {\n    fn set_string<S: Display>(&mut self, S);\n\n    fn print(&self);\n}\n\n#[derive(Default)]\nstruct ConcretePrinter {\n    string: Option<Box<Display>>,\n}\n\nimpl Printer for ConcretePrinter {\n    fn set_string<S: Display + 'static>(&mut self, string: S) {\n        self.string = Some(Box::new(string));  // save string for the later use\n    }\n\n    fn print(&self) {\n        self.string\n            .as_ref()\n            .map(|some_string| println!(\"{}\", some_string));\n    }\n}\n\nfn main() {\n    let mut a = ConcretePrinter::default();\n\n    {\n        let heap_string = \"hello\".to_string();\n        let reference = &heap_string;   // displayable but not static\n\n        a.set_string(reference);        // only Printer bounds checked here\n    }                                   // 'hello' string dropped\n\n    a.print();                          // use after free\n}\n```\n\nrustc 1.9.0 (e4e8b6668 2016-05-18)\nbinary: rustc\ncommit-hash: e4e8b666850a763fdf1c3c2c142856ab51e32779\ncommit-date: 2016-05-18\nhost: x86_64-unknown-linux-gnu\nrelease: 1.9.0\n\nRust Playground: https://play.rust-lang.org/?gist=e95ac4f83f16b062ee8b7c53ed52d5e2&version=stable&backtrace=0\n", "closed_by": {"login": "vacavaca", "id": 19508396, "node_id": "MDQ6VXNlcjE5NTA4Mzk2", "avatar_url": "https://avatars.githubusercontent.com/u/19508396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vacavaca", "html_url": "https://github.com/vacavaca", "followers_url": "https://api.github.com/users/vacavaca/followers", "following_url": "https://api.github.com/users/vacavaca/following{/other_user}", "gists_url": "https://api.github.com/users/vacavaca/gists{/gist_id}", "starred_url": "https://api.github.com/users/vacavaca/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vacavaca/subscriptions", "organizations_url": "https://api.github.com/users/vacavaca/orgs", "repos_url": "https://api.github.com/users/vacavaca/repos", "events_url": "https://api.github.com/users/vacavaca/events{/privacy}", "received_events_url": "https://api.github.com/users/vacavaca/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34280/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34280/timeline", "performed_via_github_app": null, "state_reason": "completed"}