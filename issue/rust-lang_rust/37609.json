{"url": "https://api.github.com/repos/rust-lang/rust/issues/37609", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37609/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37609/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37609/events", "html_url": "https://github.com/rust-lang/rust/issues/37609", "id": 187531139, "node_id": "MDU6SXNzdWUxODc1MzExMzk=", "number": 37609, "title": "Upgrade to LLVM 4.0", "user": {"login": "shepmaster", "id": 174509, "node_id": "MDQ6VXNlcjE3NDUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/174509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shepmaster", "html_url": "https://github.com/shepmaster", "followers_url": "https://api.github.com/users/shepmaster/followers", "following_url": "https://api.github.com/users/shepmaster/following{/other_user}", "gists_url": "https://api.github.com/users/shepmaster/gists{/gist_id}", "starred_url": "https://api.github.com/users/shepmaster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shepmaster/subscriptions", "organizations_url": "https://api.github.com/users/shepmaster/orgs", "repos_url": "https://api.github.com/users/shepmaster/repos", "events_url": "https://api.github.com/users/shepmaster/events{/privacy}", "received_events_url": "https://api.github.com/users/shepmaster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234876, "node_id": "MDU6TGFiZWwyMzQ4NzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-hard", "name": "E-hard", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Hard / a lot"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 49, "created_at": "2016-11-05T23:35:48Z", "updated_at": "2017-04-26T23:44:06Z", "closed_at": "2017-04-25T01:21:33Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The AVR-Rust post continues to track AVR-LLVM, which is tracking upstream LLVM. That means we are running into changes from the future LLVM 4.0. I figured we could open up this issue now to track the changes required to stay compatible. \r\n\r\nThis is the current list of upgrade hazards. Note that some of the text may be nonsensical as I don't truly grok all the internals of LLVM so some changes are wild stabs in the dark. It's also possible that some failed fix for earlier problems actually caused later problems:\r\n\r\n- [x] DIDescriptorFlags became a real C++ enum and not a bitset (#37857)\r\n- [x] An EH personality is required for every function that can unwind (#37862)\r\n- [x] `AlwaysInliner` pass changed header and constructor name (#37861)\r\n- [x] `createBasicType` changed API (#38317)\r\n- [x] Bitcode/ReaderWriter.h has been renamed / API changed (#38156)\r\n- [x] [`powidf2` / `powisf2` calling convention changed](https://github.com/rust-lang/rust/issues/37609#issuecomment-261109814) ([LLVM 31685](https://llvm.org/bugs/show_bug.cgi?id=31685))\r\n- [x] `llvm::AttrBuilder` changed API (#37831)\r\n- [x] `DIBuilder::createNameSpace` changed API (#38000)\r\n- [x] `LLVMRustPrintPasses` prefers `StringRef` over `char *` (#38027)\r\n- [x] `OptimizationDiagnostic` string type changes (#37982)\r\n- [x] `llvm::StringRef` is not guaranteed to be null terminated (#38048)\r\n- [x] `getPassName` changed return types (#38195)\r\n- [x] Archive support changed error handling types (#38196)\r\n- [x] Teach Rust about an LLVM 4.0 API change for creating debug info\r\nfor global variables (#38295)\r\n- [x] Check all errors in LLVMRustArchiveIterator API (#38676)\r\n- [x] Upgrade emscripten (kripken/emscripten-fastcomp#165, kripken/emscripten-fastcomp-clang#13)\r\n- [x] Alignment now represented with 32 bits instead of 64 (#39529)\r\n- [x] `DIBuilder::createGlobalVariable` API changed again (#39528)\r\n- [x] `llvm::DIBuilder::createCompileUnit` now takes an `llvm::DIFile*` instead of a `Filename` and `Directory` (#39747)\r\n- [x] Symbol lookup error when linking dylibs (#39782)\r\n- [x] Undefined behavior in `repr(packed)` tests (#40373)\r\n- [x] Unoptimised builds of compiler_builtins on ARM have references to `core::panicking::panic` (#40508)\r\n\r\n----\r\n\r\nA WIP PR that performs the upgrade!  #40123\r\n\r\n-----\r\n\r\nSome issues whose resolution is believed to be blocked on LLVM 4.0:\r\n\r\n- [ ] https://github.com/rust-lang/rust/issues/39015", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37609/reactions", "total_count": 22, "+1": 9, "-1": 0, "laugh": 0, "hooray": 3, "confused": 0, "heart": 10, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37609/timeline", "performed_via_github_app": null, "state_reason": "completed"}