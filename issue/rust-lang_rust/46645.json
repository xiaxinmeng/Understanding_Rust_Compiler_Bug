{"url": "https://api.github.com/repos/rust-lang/rust/issues/46645", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46645/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46645/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46645/events", "html_url": "https://github.com/rust-lang/rust/issues/46645", "id": 280850231, "node_id": "MDU6SXNzdWUyODA4NTAyMzE=", "number": 46645, "title": "WASM module base address is always 0, prevents multiple modules with single imported memory", "user": {"login": "Arnavion", "id": 1096010, "node_id": "MDQ6VXNlcjEwOTYwMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1096010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Arnavion", "html_url": "https://github.com/Arnavion", "followers_url": "https://api.github.com/users/Arnavion/followers", "following_url": "https://api.github.com/users/Arnavion/following{/other_user}", "gists_url": "https://api.github.com/users/Arnavion/gists{/gist_id}", "starred_url": "https://api.github.com/users/Arnavion/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Arnavion/subscriptions", "organizations_url": "https://api.github.com/users/Arnavion/orgs", "repos_url": "https://api.github.com/users/Arnavion/repos", "events_url": "https://api.github.com/users/Arnavion/events{/privacy}", "received_events_url": "https://api.github.com/users/Arnavion/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-12-10T22:10:55Z", "updated_at": "2018-09-24T08:58:22Z", "closed_at": "2018-03-06T17:08:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Every wasm module's base address [currently defaults to 0](https://github.com/rust-lang/rust/blob/2537a499c2f1983011ad04ba2e59e5ff2e2989b6/src/librustc_binaryen/BinaryenWrapper.cpp#L41) with [no way for the crate to override it.](https://github.com/rust-lang/rust/blob/41e03c3c469d1c89735fa518a9af4eb3df8b0728/src/librustc_binaryen/lib.rs#L68-L114) This means multiple modules compiled with `#![wasm_import_memory]` can't use a single imported memory without clobbering each other's data.\r\n\r\nDoes it make sense to add a crate attribute like `#![wasm_base_address(100)]` to set that module's base address in binaryen's options to `100` ? This does mean that the user will have to manually update every crate's base address according to the base addresses of every other crate. So this doesn't work for crates they don't own [1].\r\n\r\nThe proper solution would be for the compiler to emit relocation information so that a post-processor like `wasm-gc` or a loader in the host environment can relocate the modules. As of now that isn't possible, since pointers to static data are indistinguishable from integers.\r\n\r\n[1]: Doesn't work for top-level crates (that compile into WASM modules) they don't own that is. rlib dependency crates are fine.", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46645/timeline", "performed_via_github_app": null, "state_reason": "completed"}