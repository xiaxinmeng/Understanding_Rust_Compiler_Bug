{"url": "https://api.github.com/repos/rust-lang/rust/issues/58516", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58516/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58516/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58516/events", "html_url": "https://github.com/rust-lang/rust/issues/58516", "id": 411099410, "node_id": "MDU6SXNzdWU0MTEwOTk0MTA=", "number": 58516, "title": "LLVM ERROR: Undefined temporary symbol when compiling wasm-bindgen-macro-support on powerpc64+powerpc64le linux", "user": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 515028847, "node_id": "MDU6TGFiZWw1MTUwMjg4NDc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-PowerPC", "name": "O-PowerPC", "color": "6e6ec0", "default": false, "description": "Target: PowerPC processors"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-02-16T18:33:40Z", "updated_at": "2019-05-19T23:39:27Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "See log here https://buildd.debian.org/status/fetch.php?pkg=rust-wasm-bindgen-macro-support&arch=ppc64el&ver=0.2.33-1&stamp=1549258418&raw=0\r\n\r\nThe same issue is reproducible with the rustc binary from [here](https://static.rust-lang.org/dist/rust-1.32.0-powerpc64le-unknown-linux-gnu.tar.gz), but one needs to first work around #58334/#57345 by building your cargo, e.g. the Debian `cargo` package works.\r\n\r\nStack traces, but locals are optimised out:\r\n\r\nDebian rustc\r\n~~~~\r\n$ cargo build --verbose --verbose\r\n[..]\r\n$ rust-gdb -q rustc\r\n[..]\r\n(gdb) break llvm::report_fatal_error\r\n[..]\r\n(gdb) run --crate-name wasm_bindgen_macro_support crates/macro-support/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 --cfg 'feature=\"spans\"' --cfg 'feature=\"wasm-bindgen-backend\"' -C metadata=267ded4c6ac04022 -C extra-filename=-267ded4c6ac04022 --out-dir $HOME/wasm-bindgen/target/debug/deps -C incremental=$HOME/wasm-bindgen/target/debug/incremental -L dependency=$HOME/wasm-bindgen/target/debug/deps --extern proc_macro2=$HOME/wasm-bindgen/target/debug/deps/libproc_macro2-ddf6fe723d049424.rlib --extern quote=$HOME/wasm-bindgen/target/debug/deps/libquote-bd5442aa4aee0f1c.rlib --extern syn=$HOME/wasm-bindgen/target/debug/deps/libsyn-a5d8e6188798fcb2.rlib --extern wasm_bindgen_backend=$HOME/wasm-bindgen/target/debug/deps/libwasm_bindgen_backend-c8bf27854c4fe469.rlib --extern wasm_bindgen_shared=$HOME/wasm-bindgen/target/debug/deps/libwasm_bindgen_shared-216cd9cb4202c473.rlib\r\n[..]\r\n(gdb) bt\r\n#0  __gthread_mutex_lock () at /usr/lib/gcc/powerpc64le-linux-gnu/8/../../../../include/powerpc64le-linux-gnu/c++/8/bits/gthr-default.h:747\r\n#1  lock () at /usr/lib/gcc/powerpc64le-linux-gnu/8/../../../../include/c++/8/bits/std_mutex.h:103\r\n#2  lock_guard () at /usr/lib/gcc/powerpc64le-linux-gnu/8/../../../../include/c++/8/bits/std_mutex.h:162\r\n#3  report_fatal_error () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/Support/ErrorHandling.cpp:101\r\n#4  0x00003fffb202973c in llvm::MCContext::reportError(llvm::SMLoc, llvm::Twine const&) () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/MCContext.cpp:628\r\n#5  0x00003fffb20056a8 in computeSymbolTable () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/ELFObjectWriter.cpp:645\r\n#6  writeObject () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/ELFObjectWriter.cpp:1151\r\n#7  0x00003fffb171ed30 in ?? () from /usr/lib/powerpc64le-linux-gnu/libLLVM-7.so.1\r\n#8  0x00003fffb201b9b4 in Finish () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/MCAssembler.cpp:849\r\n#9  0x00003fffb204aef0 in FinishImpl () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/MCObjectStreamer.cpp:683\r\n#10 0x00003fffb2039474 in FinishImpl () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/MCELFStreamer.cpp:674\r\n#11 0x00003fffb20561c4 in Finish () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/MC/MCStreamer.cpp:863\r\n#12 0x00003fffb1718324 in doFinalization () at /build/llvm-toolchain-7-4s73DP/llvm-toolchain-7-7.0.1/lib/CodeGen/AsmPrinter/AsmPrinter.cpp:1548\r\n#13 0x0000000000000000 in ?? ()\r\n~~~~\r\n\r\nUpstream rustc\r\n~~~~\r\n$ export PATH=$HOME/vroot/usr/bin:$HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/bin:/usr/local/bin:/usr/bin:/bin\r\n$ export LD_LIBRARY_PATH=$HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rust-std-powerpc64le-unknown-linux-gnu/lib/rustlib/powerpc64le-unknown-linux-gnu/lib\r\n$ export RUSTFLAGS=\"-L $LD_LIBRARY_PATH\"\r\n$ export RUSTDOCFLAGS=\"-L $LD_LIBRARY_PATH\"\r\n$ which cargo\r\n$HOME/vroot/usr/bin/cargo\r\n$ which rustc\r\n$HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/bin/rustc\r\n$ cargo build --verbose --verbose\r\n[..]\r\n$ rust-gdb -q rustc\r\n[..]\r\n(gdb) break llvm::report_fatal_error\r\n[..]\r\n(gdb) run --crate-name wasm_bindgen_macro_support crates/macro-support/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 --cfg 'feature=\"spans\"' --cfg 'feature=\"wasm-bindgen-backend\"' -C metadata=56e98bc84653fd36 -C extra-filename=-56e98bc84653fd36 --out-dir $HOME/wasm-bindgen/target/debug/deps -C incremental=$HOME/wasm-bindgen/target/debug/incremental -L dependency=$HOME/wasm-bindgen/target/debug/deps --extern proc_macro2=$HOME/wasm-bindgen/target/debug/deps/libproc_macro2-a9b42ce46045ad3d.rlib --extern quote=$HOME/wasm-bindgen/target/debug/deps/libquote-b533d9dc523383f1.rlib --extern syn=$HOME/wasm-bindgen/target/debug/deps/libsyn-73f28adcf440f43e.rlib --extern wasm_bindgen_backend=$HOME/wasm-bindgen/target/debug/deps/libwasm_bindgen_backend-0d6dbe292e1636ee.rlib --extern wasm_bindgen_shared=$HOME/wasm-bindgen/target/debug/deps/libwasm_bindgen_shared-7b78e47489df9616.rlib -L $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rust-std-powerpc64le-unknown-linux-gnu/lib/rustlib/powerpc64le-unknown-linux-gnu/lib\r\n[..]\r\n(gdb) bt\r\n#0  0x00003fffb3ab339c in llvm::report_fatal_error(llvm::Twine const&, bool) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#1  0x00003fffb395f540 in llvm::MCContext::reportError(llvm::SMLoc, llvm::Twine const&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#2  0x00003fffb393488c in (anonymous namespace)::ELFWriter::computeSymbolTable(llvm::MCAssembler&, llvm::MCAsmLayout const&, llvm::DenseMap<llvm::MCSectionELF const*, unsigned int, llvm::DenseMapInfo<llvm::MCSectionELF const*>, llvm::detail::DenseMapPair<llvm::MCSectionELF const*, unsigned int> > const&, llvm::DenseMap<llvm::MCSymbol const*, unsigned int, llvm::DenseMapInfo<llvm::MCSymbol const*>, llvm::detail::DenseMapPair<llvm::MCSymbol const*, unsigned int> > const&, std::map<llvm::MCSectionELF const*, std::pair<unsigned long, unsigned long>, std::less<llvm::MCSectionELF const*>, std::allocator<std::pair<llvm::MCSectionELF const* const, std::pair<unsigned long, unsigned long> > > >&) () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#3  0x00003fffb393695c in (anonymous namespace)::ELFWriter::writeObject(llvm::MCAssembler&, llvm::MCAsmLayout const&) [clone .constprop.391] ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#4  0x00003fffb3938e30 in (anonymous namespace)::ELFSingleObjectWriter::writeObject(llvm::MCAssembler&, llvm::MCAsmLayout const&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#5  0x00003fffb3950fa8 in llvm::MCAssembler::Finish() () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#6  0x00003fffb39852d0 in llvm::MCObjectStreamer::FinishImpl() ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#7  0x00003fffb3972e60 in llvm::MCELFStreamer::FinishImpl() () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#8  0x00003fffb3993468 in llvm::MCStreamer::Finish() () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#9  0x00003fffb29e4810 in llvm::AsmPrinter::doFinalization(llvm::Module&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#10 0x00003fffb1b5d774 in (anonymous namespace)::PPCLinuxAsmPrinter::doFinalization(llvm::Module&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#11 0x00003fffb379b188 in llvm::FPPassManager::doFinalization(llvm::Module&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#12 0x00003fffb37aa888 in llvm::legacy::PassManagerImpl::run(llvm::Module&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#13 0x00003fffb37aab3c in llvm::legacy::PassManager::run(llvm::Module&) ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#14 0x00003fffb1710244 in LLVMRustWriteOutputFile () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#15 0x00003fffb162baac in rustc_codegen_llvm::back::write::write_output_file ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#16 0x00003fffb162f638 in rustc_codegen_llvm::back::write::codegen::{{closure}} ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#17 0x00003fffb162e92c in rustc_codegen_llvm::back::write::codegen ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#18 0x00003fffb15e43a0 in rustc_codegen_ssa::back::write::execute_work_item ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#19 0x00003fffb16d0d9c in std::sys_common::backtrace::__rust_begin_short_backtrace ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#20 0x00003fffb15a2fd8 in std::panicking::try::do_call () from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#21 0x00003fffb7c62e84 in __rust_maybe_catch_panic () at src/libpanic_unwind/lib.rs:102\r\n#22 0x00003fffb15ac188 in <F as alloc::boxed::FnBox<A>>::call_box ()\r\n   from $HOME/rust-1.32.0-powerpc64le-unknown-linux-gnu/rustc/lib/rustlib/powerpc64le-unknown-linux-gnu/codegen-backends/librustc_codegen_llvm-llvm.so\r\n#23 0x00003fffb7c5787c in _$LT$alloc..boxed..Box$LT$$LP$dyn$u20$alloc..boxed..FnBox$LT$A$C$$u20$Output$u3d$R$GT$$u20$$u2b$$u20$$u27$a$RP$$GT$$u20$as$u20$core..ops..function..FnOnce$LT$A$GT$$GT$::call_once::hcb2877104e64de51 () at /rustc/9fda7c2237db910e41d6a712e9a2139b352e558b/src/liballoc/boxed.rs:683\r\n#24 std::sys_common::thread::start_thread () at src/libstd/sys_common/thread.rs:24\r\n#25 std::sys::unix::thread::Thread::new::thread_start () at src/libstd/sys/unix/thread.rs:90\r\n#26 0x00003fffb4f28e04 in start_thread (arg=0x0) at pthread_create.c:486\r\n#27 0x00003fffb7ad3cd8 in clone () at ../sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S:82\r\n~~~~\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58516/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58516/timeline", "performed_via_github_app": null, "state_reason": null}