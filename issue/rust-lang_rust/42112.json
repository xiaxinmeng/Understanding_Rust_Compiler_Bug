{"url": "https://api.github.com/repos/rust-lang/rust/issues/42112", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/42112/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/42112/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/42112/events", "html_url": "https://github.com/rust-lang/rust/issues/42112", "id": 230143990, "node_id": "MDU6SXNzdWUyMzAxNDM5OTA=", "number": 42112, "title": "Span markers in diagnostics can be confusing if text above wraps", "user": {"login": "crumblingstatue", "id": 1521976, "node_id": "MDQ6VXNlcjE1MjE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1521976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crumblingstatue", "html_url": "https://github.com/crumblingstatue", "followers_url": "https://api.github.com/users/crumblingstatue/followers", "following_url": "https://api.github.com/users/crumblingstatue/following{/other_user}", "gists_url": "https://api.github.com/users/crumblingstatue/gists{/gist_id}", "starred_url": "https://api.github.com/users/crumblingstatue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crumblingstatue/subscriptions", "organizations_url": "https://api.github.com/users/crumblingstatue/orgs", "repos_url": "https://api.github.com/users/crumblingstatue/repos", "events_url": "https://api.github.com/users/crumblingstatue/events{/privacy}", "received_events_url": "https://api.github.com/users/crumblingstatue/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 693665463, "node_id": "MDU6TGFiZWw2OTM2NjU0NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/WG-diagnostics", "name": "WG-diagnostics", "color": "c2e0c6", "default": false, "description": "Working group: diagnostics"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2017-05-20T10:08:31Z", "updated_at": "2018-01-31T10:54:37Z", "closed_at": "2018-01-31T10:54:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Code:\r\n```rust\r\nuse std::rc::Rc;\r\nuse std::cell::RefCell;\r\n\r\nstruct MyType;\r\n\r\nfn exec_closure<F: Fn() + 'static>(f: F) {}\r\n\r\nfn just_do_it(my_arg_1: Rc<RefCell<MyType>>, my_arg_2: &MyType, my_arg_3: Rc<RefCell<MyType>>, my_arg_4: Rc<RefCell<MyType>>){\r\n    exec_closure(move || {\r\n        my_arg_1;\r\n    });\r\n}\r\n\r\nfn main() {}\r\n\r\n```\r\n\r\nThis is how the error is displayed on a 80 column terminal\r\n```\r\nerror[E0507]: cannot move out of captured outer variable in an `Fn` closure\r\n  --> foo.rs:10:9\r\n   |\r\n8  | fn just_do_it(my_arg_1: Rc<RefCell<MyType>>, my_arg_2: &MyType, my_arg_3: R\r\nc<RefCell<MyType>>, my_arg_4: Rc<RefCell<MyType>>){ % Wrapped line %\r\n   |               -------- captured outer variable % Makes it look like it's\r\n                                                      Pointing to my_arg_4 %\r\n9  |     exec_closure(move || {\r\n10 |         my_arg_1;\r\n   |         ^^^^^^^^ cannot move out of captured outer variable in an `Fn` clos\r\nure\r\n\r\n```\r\n\r\nIt's even worse in the real-life scenario that inspired this:\r\n![](http://i.imgur.com/a9DjSCm.png)\r\n\r\nThe second span marker just lazily points to the top of the closure.\r\n\r\nPossible improvements:\r\n\r\n- Perhaps the irrelevant part could be omitted:\r\n    ```\r\n\terror[E0507]: cannot move out of captured outer variable in an `Fn` closure\r\n\t  --> foo.rs:10:9\r\n\t   |\r\n\t8  | fn just_do_it(my_arg_1: Rc<RefCell<MyType>>, ...\r\n\t   |               -------- captured outer variable \r\n\t   |\r\n\t9  |     exec_closure(move || {\r\n\t10 |         my_arg_1;\r\n\t   |         ^^^^^^^^ cannot move out of captured outer variable in an `Fn` clos\r\n\ture\r\n\r\n    ```\r\n   An additional advantage of this method is that there is less spam overall. The less irrelevant information there is, the more comprehensible the diagnostic becomes. It can also be applied in both directions. For example, if the relevant arg is in the middle, it could be displayed like `fn just_do_it(..., relevant_arg, ...)`.\r\n\r\n- If the overflowing part should be kept for some reason, maybe it could be modified to make\r\n  the span marker fit in somehow.\r\n    ```\r\n\terror[E0507]: cannot move out of captured outer variable in an `Fn` closure\r\n\t  --> foo.rs:10:9\r\n\t   |\r\n\t8  | fn just_do_it(my_arg_1: Rc<RefCell<MyType>>, my_arg_2: &MyType, my_arg_3: R\r\n\tc<RefCell<MyType>>,-------- my_arg_4: Rc<RefCell<MyType>>){ % Wrapped line %\r\n\t   |               | captured outer variable\r\n\t   |\r\n\t9  |     exec_closure(move || {\r\n\t10 |         my_arg_1;\r\n\t   |         ^^^^^^^^ cannot move out of captured outer variable in an `Fn` clos\r\n\ture\r\n\r\n    ```\r\n\r\n- `my_arg_1` could be highlighted directly. This would require the use of color or making the font bold.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/42112/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/42112/timeline", "performed_via_github_app": null, "state_reason": "completed"}