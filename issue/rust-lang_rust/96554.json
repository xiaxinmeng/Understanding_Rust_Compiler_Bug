{"url": "https://api.github.com/repos/rust-lang/rust/issues/96554", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96554/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96554/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96554/events", "html_url": "https://github.com/rust-lang/rust/issues/96554", "id": 1221011921, "node_id": "I_kwDOAAsO6M5IxynR", "number": 96554, "title": "Support using different LLVM build for stage0 and stage1+ when bootstrapping", "user": {"login": "chbaker0", "id": 6291976, "node_id": "MDQ6VXNlcjYyOTE5NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6291976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chbaker0", "html_url": "https://github.com/chbaker0", "followers_url": "https://api.github.com/users/chbaker0/followers", "following_url": "https://api.github.com/users/chbaker0/following{/other_user}", "gists_url": "https://api.github.com/users/chbaker0/gists{/gist_id}", "starred_url": "https://api.github.com/users/chbaker0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chbaker0/subscriptions", "organizations_url": "https://api.github.com/users/chbaker0/orgs", "repos_url": "https://api.github.com/users/chbaker0/repos", "events_url": "https://api.github.com/users/chbaker0/events{/privacy}", "received_events_url": "https://api.github.com/users/chbaker0/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2022-04-29T14:52:05Z", "updated_at": "2022-10-27T16:09:58Z", "closed_at": "2022-10-27T16:09:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "rustc can be linked against a custom LLVM build: https://github.com/rust-lang/rust/blob/master/config.toml.example#L672\r\n\r\nMy project uses its own build of LLVM and Clang. The first stage only supports code gen for the host platform, and is built as native libraries. The final stage supports all targets, but is built with LTO so the LLVM libs have bitcode.\r\n\r\nOur Rust build is configured to use our custom LLVM build, but there's a dilemma:\r\n* The prebuilt stage0 Rust toolchain uses an earlier version of LLVM, so it can't handle the newer bitcode in our production LLVM build\r\n* Our first stage LLVM build can be processed by the stage0 Rust toolchain because they're native libraries, but then our Rust toolchain won't support all the targets we need\r\n\r\nIdeally, we could link our stage0 artifacts with our first stage LLVM then link stage1+ artifacts with the final, LTO LLVM libraries. Then\r\n* The stage1 toolchain won't have full target support, but it can handle bitcode generated by our newer LLVM revision\r\n* The stage1+ artifacts will be linked with our production LLVM libs and will have support for all targets\r\n\r\nWhat's a good way to achieve this?\r\n\r\nMy original idea was to add a new config.toml option `llvm-config-bootstrap`, like `llvm-config` but used only when building stage0 artifacts.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96554/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96554/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}