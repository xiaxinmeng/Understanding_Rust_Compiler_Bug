{"url": "https://api.github.com/repos/rust-lang/rust/issues/97520", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97520/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97520/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97520/events", "html_url": "https://github.com/rust-lang/rust/issues/97520", "id": 1251909033, "node_id": "I_kwDOAAsO6M5Knp2p", "number": 97520, "title": "cargo install in a Docker buildx image fails", "user": {"login": "Allaman", "id": 12184268, "node_id": "MDQ6VXNlcjEyMTg0MjY4", "avatar_url": "https://avatars.githubusercontent.com/u/12184268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Allaman", "html_url": "https://github.com/Allaman", "followers_url": "https://api.github.com/users/Allaman/followers", "following_url": "https://api.github.com/users/Allaman/following{/other_user}", "gists_url": "https://api.github.com/users/Allaman/gists{/gist_id}", "starred_url": "https://api.github.com/users/Allaman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Allaman/subscriptions", "organizations_url": "https://api.github.com/users/Allaman/orgs", "repos_url": "https://api.github.com/users/Allaman/repos", "events_url": "https://api.github.com/users/Allaman/events{/privacy}", "received_events_url": "https://api.github.com/users/Allaman/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2022-05-29T14:48:25Z", "updated_at": "2022-06-13T16:54:20Z", "closed_at": "2022-05-30T16:31:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\nI was trying to install [stylua](https://github.com/JohnnyMorganz/StyLua) via [crates.io](https://github.com/JohnnyMorganz/StyLua#from-cratesio) in a Docker [Multi platform](https://www.docker.com/blog/faster-multi-platform-builds-dockerfile-cross-compilation-guide/) image. \r\nHowever, my build always failed when building the `linux/amd64` image while the `linux/arm64` build was succesful (and running) fine.\r\n\r\nMy Host:\r\n- MacBook Pro 2021 M1 Pro 32GB RAM\r\n- MacOS 12.4\r\n- Docker for Desktop 4.8.2 (79419)\r\n\r\nDocker engine config\r\n```json\r\n{\r\n  \"builder\": {\r\n    \"gc\": {\r\n      \"defaultKeepStorage\": \"20GB\",\r\n      \"enabled\": true\r\n    }\r\n  },\r\n  \"experimental\": false,\r\n  \"features\": {\r\n    \"buildkit\": true\r\n  }\r\n}\r\n```\r\n\r\nMinimal Dockerfile to illustrate my issue:\r\n\r\n```Dockerfile\r\nARG ARCH\r\nFROM ${ARCH}debian:stable-slim\r\n\r\nENV PATH=$PATH:/root/.cargo/bin\r\nRUN apt-get update && apt-get -y install curl gcc\r\nRUN curl https://sh.rustup.rs -sSf | bash -s -- -y  && cargo install stylua\r\n```\r\n\r\nRunning `docker buildx build --platform linux/arm64 -t cargo-test . --load` and everything is as expected\r\n<img width=\"1168\" alt=\"arm64\" src=\"https://user-images.githubusercontent.com/12184268/170875089-70d24f34-51c4-41c4-8f2c-b225988144d9.png\">\r\n\r\nRunning `docker buildx build --platform linux/amd64 -t cargo-test . --load` it fails with error code 137 indicating an OOM issue\r\n<img width=\"1465\" alt=\"amd64\" src=\"https://user-images.githubusercontent.com/12184268/170875149-53f58e2c-292e-4add-b5b4-50950f11ae29.png\">\r\n\r\nRunning the same command again but with 15GB instead of previously 8GB assigned memory to Docker I get the following error:\r\n<img width=\"1905\" alt=\"amd64_2\" src=\"https://user-images.githubusercontent.com/12184268/170875228-539561a7-f0cf-4df7-acfe-0e412cfb5daa.png\">\r\n\r\nIs there anything I am missing?\r\n\r\nCheers\r\nMichael\r\n\r\nDisclaimer: I am neither familiar with Rust nor the Rust ecosystem.", "closed_by": {"login": "Allaman", "id": 12184268, "node_id": "MDQ6VXNlcjEyMTg0MjY4", "avatar_url": "https://avatars.githubusercontent.com/u/12184268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Allaman", "html_url": "https://github.com/Allaman", "followers_url": "https://api.github.com/users/Allaman/followers", "following_url": "https://api.github.com/users/Allaman/following{/other_user}", "gists_url": "https://api.github.com/users/Allaman/gists{/gist_id}", "starred_url": "https://api.github.com/users/Allaman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Allaman/subscriptions", "organizations_url": "https://api.github.com/users/Allaman/orgs", "repos_url": "https://api.github.com/users/Allaman/repos", "events_url": "https://api.github.com/users/Allaman/events{/privacy}", "received_events_url": "https://api.github.com/users/Allaman/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97520/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97520/timeline", "performed_via_github_app": null, "state_reason": "completed"}