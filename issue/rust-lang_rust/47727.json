{"url": "https://api.github.com/repos/rust-lang/rust/issues/47727", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47727/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47727/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47727/events", "html_url": "https://github.com/rust-lang/rust/issues/47727", "id": 291391051, "node_id": "MDU6SXNzdWUyOTEzOTEwNTE=", "number": 47727, "title": "UdpSocket::set_ttl does not set IPv6 hoplimit field", "user": {"login": "eleksaggr", "id": 7849236, "node_id": "MDQ6VXNlcjc4NDkyMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/7849236?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eleksaggr", "html_url": "https://github.com/eleksaggr", "followers_url": "https://api.github.com/users/eleksaggr/followers", "following_url": "https://api.github.com/users/eleksaggr/following{/other_user}", "gists_url": "https://api.github.com/users/eleksaggr/gists{/gist_id}", "starred_url": "https://api.github.com/users/eleksaggr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eleksaggr/subscriptions", "organizations_url": "https://api.github.com/users/eleksaggr/orgs", "repos_url": "https://api.github.com/users/eleksaggr/repos", "events_url": "https://api.github.com/users/eleksaggr/events{/privacy}", "received_events_url": "https://api.github.com/users/eleksaggr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": {"login": "kckeiks", "id": 24687641, "node_id": "MDQ6VXNlcjI0Njg3NjQx", "avatar_url": "https://avatars.githubusercontent.com/u/24687641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kckeiks", "html_url": "https://github.com/kckeiks", "followers_url": "https://api.github.com/users/kckeiks/followers", "following_url": "https://api.github.com/users/kckeiks/following{/other_user}", "gists_url": "https://api.github.com/users/kckeiks/gists{/gist_id}", "starred_url": "https://api.github.com/users/kckeiks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kckeiks/subscriptions", "organizations_url": "https://api.github.com/users/kckeiks/orgs", "repos_url": "https://api.github.com/users/kckeiks/repos", "events_url": "https://api.github.com/users/kckeiks/events{/privacy}", "received_events_url": "https://api.github.com/users/kckeiks/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "kckeiks", "id": 24687641, "node_id": "MDQ6VXNlcjI0Njg3NjQx", "avatar_url": "https://avatars.githubusercontent.com/u/24687641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kckeiks", "html_url": "https://github.com/kckeiks", "followers_url": "https://api.github.com/users/kckeiks/followers", "following_url": "https://api.github.com/users/kckeiks/following{/other_user}", "gists_url": "https://api.github.com/users/kckeiks/gists{/gist_id}", "starred_url": "https://api.github.com/users/kckeiks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kckeiks/subscriptions", "organizations_url": "https://api.github.com/users/kckeiks/orgs", "repos_url": "https://api.github.com/users/kckeiks/repos", "events_url": "https://api.github.com/users/kckeiks/events{/privacy}", "received_events_url": "https://api.github.com/users/kckeiks/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2018-01-24T22:58:24Z", "updated_at": "2022-03-31T20:13:04Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "It is not possible to set a hoplimit in an IPv6 packet sent over UDP. `UdpSocket::set_ttl` does not modify the hoplimit in the IPv6 packet and there seems to be no other way to do so.\n\n**I tried this code:**\n\n    use std::net::{Ipv6Addr, SocketAddrV6, UdpSocket};\n\n    fn main() {\n        let laddr = SocketAddrV6::new(Ipv6Addr::new(0,0,0,0,0,0,0,1), 50000, 0, 0);\n        let destination = SocketAddrV6::new(Ipv6Addr::new(0,0,0,0,0,0,0,1), 50000, 0, 0);\n\n        let socket = UdpSocket::bind(laddr).unwrap();\n        socket.connect(destination).unwrap();\n        socket.set_ttl(10).unwrap();\n        println!(\"{:?}\", socket.ttl().unwrap());\n\n        let payload = [1,2,3,4,5,6,7,8];\n        socket.send(&payload).unwrap();\n    }\n\n**I expected to see this happen:** \nSince `UdpSocket` has no other function that would set the hoplimit in an IPv6 packet, I believe `set_ttl` should be doing this. I expected to capture a UDP packet with an IPv6 hoplimit field of 10.\n\n**Instead, this happened:** \nThe output of the program is as expected:\n\n    10\n\nI used `tcpdump -v -i lo udp port 50000` to capture the packet:\n\n    tcpdump: listening on lo, link-type EN10MB (Ethernet), capture size 262144 bytes\n    23:43:02.146680 IP6 (flowlabel 0x487a1, hlim 64, next-header UDP (17) payload length: 16) localhost.localdomain.50000 > localhost.localdomain.50000: [bad udp cksum 0x0023 -> 0x6917!] UDP, length 8\n\nThe hoplimit field of the packet is still set to the default value of 64.\n\n## Meta\n\n`rustc --version --verbose`:\n\n    rustc 1.23.0\n    binary: rustc\n    commit-hash: unknown\n    commit-date: unknown\n    host: x86_64-unknown-linux-gnu\n    release: 1.23.0\n    LLVM version: 4.0\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"kckeiks\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47727/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47727/timeline", "performed_via_github_app": null, "state_reason": null}