{"url": "https://api.github.com/repos/rust-lang/rust/issues/21600", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21600/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21600/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21600/events", "html_url": "https://github.com/rust-lang/rust/issues/21600", "id": 55385958, "node_id": "MDU6SXNzdWU1NTM4NTk1OA==", "number": 21600, "title": "Internal compiler error: aliasability violation with closure", "user": {"login": "nhaehnle", "id": 1221193, "node_id": "MDQ6VXNlcjEyMjExOTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1221193?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nhaehnle", "html_url": "https://github.com/nhaehnle", "followers_url": "https://api.github.com/users/nhaehnle/followers", "following_url": "https://api.github.com/users/nhaehnle/following{/other_user}", "gists_url": "https://api.github.com/users/nhaehnle/gists{/gist_id}", "starred_url": "https://api.github.com/users/nhaehnle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nhaehnle/subscriptions", "organizations_url": "https://api.github.com/users/nhaehnle/orgs", "repos_url": "https://api.github.com/users/nhaehnle/repos", "events_url": "https://api.github.com/users/nhaehnle/events{/privacy}", "received_events_url": "https://api.github.com/users/nhaehnle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-01-24T21:45:11Z", "updated_at": "2015-01-29T22:54:22Z", "closed_at": "2015-01-29T22:54:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "I ran across the error mentioned in the title and was prompted to report it here. rustc --version says:\n\n> rustc 1.0.0-dev (a0f86de49 2015-01-20 16:05:33 +0000)\n\nI boiled the problematic source down to the following:\n\n``` rust\nuse std::rand::{Rng, StdRng};\n\nfn maker<T, F: Fn(usize) -> T>(count: usize, f: F) -> Vec<T> {\n    let mut vec = Vec::with_capacity(count);\n    for i in (0..count) {\n        vec.push(f(i))\n    }\n    vec\n}\n\nfn main() {\n    let mut rng = StdRng::new().unwrap();\n    let outer = maker(10, |i: usize| {\n        maker(10, |j: usize| {\n            rng.gen::<i32>()\n        })\n    });\n}\n```\n\nCompiling this with rustc results in the following:\n\n```\ndivmod.rs:14:19: 16:10 error: internal compiler error: aliasability violation with closure\ndivmod.rs:14         maker(10, |j: usize| {\ndivmod.rs:15             rng.gen::<i32>()\ndivmod.rs:16         })\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/haehnle/software/rust/rust/src/libsyntax/diagnostic.rs:126\n\nstack backtrace:\n   1:     0x7f21c4060770 - sys::backtrace::write::hbfbe574d5ac79465eRt\n   2:     0x7f21c4082640 - failure::on_fail::hac49ad8bfddefde2J4z\n   3:     0x7f21c3ff0ec0 - rt::unwind::begin_unwind_inner::hd718a69632d588d7XJz\n   4:     0x7f21beba4880 - rt::unwind::begin_unwind::h8730598182994992412\n   5:     0x7f21beba4810 - diagnostic::SpanHandler::span_bug::h1e2d9daefb0dc2baEpF\n   6:     0x7f21c1f328c0 - session::Session::span_bug::hceb8496714e777dfAcp\n   7:     0x7f21c2abbfd0 - borrowck::BorrowckCtxt<'a, 'tcx>::report_aliasability_violation::hfb956e845bfbedc6i3f\n   8:     0x7f21c2ac35c0 - borrowck::gather_loans::check_aliasability::h6869eada53537427Ouc\n   9:     0x7f21c2ac1120 - borrowck::gather_loans::GatherLoanCtxt<'a, 'tcx>.euv..Delegate<'tcx>::borrow::h766d85cacc46a23cBpc\n  10:     0x7f21c2ab3a30 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_captures::unboxed_closure.13697\n  11:     0x7f21c2aae650 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_expr::h5881053512374983811\n  12:     0x7f21c2ab33f0 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::consume_expr::h15904022551803142840\n  13:     0x7f21c2aae650 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_expr::h5881053512374983811\n  14:     0x7f21c2ab33f0 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::consume_expr::h15904022551803142840\n  15:     0x7f21c2aae160 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_block::h6225175670038727907\n  16:     0x7f21c2aae650 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_expr::h5881053512374983811\n  17:     0x7f21c2ab33f0 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::consume_expr::h15904022551803142840\n  18:     0x7f21c2aae160 - middle::expr_use_visitor::ExprUseVisitor<'d, 't, 'tcx, TYPER>::walk_block::h6225175670038727907\n  19:     0x7f21c2ad88f0 - borrowck::build_borrowck_dataflow_data::h20fbbabc08a99758cQe\n  20:     0x7f21c2ad5630 - borrowck::borrowck_fn::h7db236c4f7804f18zNe\n  21:     0x7f21c2ad7770 - visit::walk_expr::h9297717943178526058\n  22:     0x7f21c2ad7770 - visit::walk_expr::h9297717943178526058\n  23:     0x7f21c2ad7d20 - visit::walk_block::h2927548346589881657\n  24:     0x7f21c2ad5630 - borrowck::borrowck_fn::h7db236c4f7804f18zNe\n  25:     0x7f21c2ad6540 - borrowck::borrowck_item::h0f3b90d02a71b9f1xMe\n  26:     0x7f21c2ad6ab0 - borrowck::check_crate::hc5485323970718eapHe\n  27:     0x7f21c45bf480 - driver::phase_3_run_analysis_passes::hd1f98033b42f7478WFa\n  28:     0x7f21c45acca0 - driver::compile_input::hfc013628096d192cCba\n  29:     0x7f21c4677a10 - run_compiler::h017fe6509f8a740fl9b\n  30:     0x7f21c4676180 - thunk::F.Invoke<A, R>::invoke::h5504034000784657795\n  31:     0x7f21c46750e0 - rt::unwind::try::try_fn::h6064716710695359836\n  32:     0x7f21c40f3e10 - rust_try_inner\n  33:     0x7f21c40f3e00 - rust_try\n  34:     0x7f21c4675390 - thunk::F.Invoke<A, R>::invoke::h9170660814324098360\n  35:     0x7f21c40702b0 - sys::thread::thread_start::he7e2984bcefcedbdzGw\n  36:     0x7f21be3bbfe0 - start_thread\n  37:     0x7f21c3c91859 - __clone\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21600/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21600/timeline", "performed_via_github_app": null, "state_reason": "completed"}