{"url": "https://api.github.com/repos/rust-lang/rust/issues/101707", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/101707/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/101707/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/101707/events", "html_url": "https://github.com/rust-lang/rust/issues/101707", "id": 1369175531, "node_id": "I_kwDOAAsO6M5Rm_Xr", "number": 101707, "title": "ICE when compiling `eyre` on `no_std`", "user": {"login": "TheButlah", "id": 6969415, "node_id": "MDQ6VXNlcjY5Njk0MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6969415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheButlah", "html_url": "https://github.com/TheButlah", "followers_url": "https://api.github.com/users/TheButlah/followers", "following_url": "https://api.github.com/users/TheButlah/following{/other_user}", "gists_url": "https://api.github.com/users/TheButlah/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheButlah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheButlah/subscriptions", "organizations_url": "https://api.github.com/users/TheButlah/orgs", "repos_url": "https://api.github.com/users/TheButlah/repos", "events_url": "https://api.github.com/users/TheButlah/events{/privacy}", "received_events_url": "https://api.github.com/users/TheButlah/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2022-09-12T02:13:01Z", "updated_at": "2022-09-17T21:01:57Z", "closed_at": "2022-09-17T21:01:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\nPlease note that the error disappears when the `eyre` dependency is removed.\r\nhttps://github.com/SlimeVR/SlimeVR-Rust/tree/ice-1\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0-nightly (228710758 2022-09-10)\r\nbinary: rustc\r\ncommit-hash: 2287107588d92889d282e6cd3c1ca5df34cd34a5\r\ncommit-date: 2022-09-10\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.65.0-nightly\r\nLLVM version: 15.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n Compiling compiler_builtins v0.1.79\r\n   Compiling core v0.0.0 (C:\\Users\\Ryan\\.rustup\\toolchains\\nightly-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\core)\r\n   Compiling proc-macro2 v1.0.43\r\n   Compiling quote v1.0.21\r\n   Compiling unicode-ident v1.0.3\r\n   Compiling memchr v2.5.0\r\n   Compiling syn v1.0.99\r\n   Compiling regex-syntax v0.6.27\r\n   Compiling lazy_static v1.4.0\r\n   Compiling version_check v0.9.4\r\n   Compiling autocfg v1.1.0\r\n   Compiling strsim v0.10.0\r\n   Compiling fnv v1.0.7\r\n   Compiling ident_case v1.0.1\r\n   Compiling riscv v0.8.0\r\n   Compiling semver v1.0.13\r\n   Compiling paste v1.0.8\r\n   Compiling esp32c3 v0.5.0\r\n   Compiling atomic-polyfill v1.0.1\r\n   Compiling futures-core v0.3.24\r\n   Compiling defmt v0.3.2\r\n   Compiling futures-task v0.3.24\r\n   Compiling esp-hal-common v0.1.0 (https://github.com/esp-rs/esp-hal?rev=da3ec47b30a5f598e904ffac0e10f94716cb4023#da3ec47b)\r\n   Compiling defmt-macros v0.3.2\r\n   Compiling defmt-parser v0.3.1\r\n   Compiling futures-util v0.3.24\r\n   Compiling esp32c3-hal v0.1.0 (https://github.com/esp-rs/esp-hal?rev=da3ec47b30a5f598e904ffac0e10f94716cb4023#da3ec47b)\r\n   Compiling libm v0.2.5\r\n   Compiling critical-section v0.2.7\r\n   Compiling log v0.4.17\r\n   Compiling esp-println v0.2.2\r\n   Compiling typenum v1.15.0\r\n   Compiling defmt-rtt v0.3.2\r\n   Compiling eyre v0.6.8\r\n   Compiling esp-backtrace v0.1.0\r\n   Compiling embassy-executor v0.1.0 (https://github.com/embassy-rs/embassy?rev=cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b#cb9f0ef5)\r\n   Compiling proc-macro-error-attr v1.0.4\r\n   Compiling proc-macro-error v1.0.4\r\n   Compiling num-traits v0.2.15\r\n   Compiling num-integer v0.1.45\r\n   Compiling num-rational v0.4.1\r\n   Compiling aho-corasick v0.7.19\r\n   Compiling rustc_version v0.4.0\r\n   Compiling heapless v0.7.16\r\n   Compiling regex v1.6.0\r\n   Compiling riscv-target v0.1.2\r\n   Compiling riscv-rt v0.9.0\r\n   Compiling riscv-atomic-emulation-trap v0.1.1\r\n   Compiling riscv v0.7.0\r\n   Compiling esp-wifi v0.1.0 (https://github.com/esp-rs/esp-wifi?rev=1fb0a1562a7faccb5a624fcff5a51806f9c14b09#1fb0a156)\r\n   Compiling darling_core v0.14.1\r\n   Compiling darling_core v0.13.4\r\n   Compiling riscv-rt-macros v0.2.0\r\n   Compiling darling_macro v0.14.1\r\n   Compiling darling_macro v0.13.4\r\n   Compiling darling v0.14.1\r\n   Compiling darling v0.13.4\r\n   Compiling esp-hal-procmacros v0.1.0 (https://github.com/esp-rs/esp-hal?rev=da3ec47b30a5f598e904ffac0e10f94716cb4023#da3ec47b)\r\n   Compiling embassy-macros v0.1.0 (https://github.com/embassy-rs/embassy?rev=cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b#cb9f0ef5)\r\n   Compiling rustc-std-workspace-core v1.99.0 (C:\\Users\\Ryan\\.rustup\\toolchains\\nightly-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\rustc-std-workspace-core)\r\n   Compiling alloc v0.0.0 (C:\\Users\\Ryan\\.rustup\\toolchains\\nightly-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\alloc)\r\n    Checking nb v1.0.0\r\n    Checking bare-metal v1.0.0\r\n    Checking bit_field v0.10.1\r\n    Checking void v1.0.2\r\n    Checking cfg-if v1.0.0\r\n    Checking critical-section v1.1.0\r\n    Checking r0 v1.0.0\r\n    Checking vcell v0.1.3\r\n    Checking gcd v2.1.0\r\n    Checking byteorder v1.4.3\r\n    Checking bitflags v1.3.2\r\n    Checking stable_deref_trait v1.2.0\r\n    Checking pin-utils v0.1.0\r\n    Checking managed v0.8.0\r\n    Checking linked_list_allocator v0.10.3\r\n    Checking pin-project-lite v0.2.9\r\n    Checking indenter v0.3.3\r\n    Checking embedded-io v0.3.0\r\n    Checking once_cell v1.14.0\r\n    Checking embassy-futures v0.1.0 (https://github.com/embassy-rs/embassy?rev=cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b#cb9f0ef5)\r\n    Checking nb v0.1.3\r\n    Checking embedded-hal v1.0.0-alpha.8\r\nthread 'rustc' panicked at 'identifier: \"metadata_std_required\", attr: None, args: FluentArgs([(\"add_info\", String(\"\")), (\"crate_name\", String(\"std\")), (\"locator_triple\", String(\"riscv32imac-unknown-none-elf\"))]), errors: [ResolverError(Reference(Variable { id: \"current_crate\" }))]', compiler\\rustc_errors\\src\\translation.rs:91:17\r\nstack backtrace:\r\n   0:     0x7ffbc75290f2 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hf35025dfc3e99720\r\n   1:     0x7ffbc756459b - core::fmt::write::h63a906fee2a3ab5d\r\n   2:     0x7ffbc751b79a - <std::io::IoSlice as core::fmt::Debug>::fmt::heed42498161d7b5a\r\n   3:     0x7ffbc752c6e4 - std::panicking::default_hook::h236acf19113b7a6a\r\n   4:     0x7ffbc752c31a - std::panicking::default_hook::h236acf19113b7a6a\r\n    Checking fugit v0.3.6\r\n    Checking embedded-hal v0.2.7\r\n   5:     0x7ffbca25b18b - rustc_driver[3883b99043dbd0d]::describe_lints\r\n   6:     0x7ffbc752d0e2 - std::panicking::rust_panic_with_hook::h0b9d1a8fb544c891\r\n   7:     0x7ffbc752ce6d - <std::panicking::begin_panic_handler::StrPanicPayload as core::panic::BoxMeUp>::get::he2f45151bac0e625\r\n   8:     0x7ffbc7529dff - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hf35025dfc3e99720\r\n   9:     0x7ffbc752cb30 - rust_begin_unwind\r\n  10:     0x7ffbc7599df5 - core::panicking::panic_fmt::hfb4a9b7f2fc8e120\r\n  11:     0x7ffbc8a442b6 - <rustc_errors[725ee6d1248fa06b]::emitter::FileWithAnnotatedLines>::collect_annotations\r\n  12:     0x7ffbc8a3c008 - <rustc_errors[725ee6d1248fa06b]::emitter::EmitterWriter>::ui_testing\r\n  13:     0x7ffbc8a3ca45 - <rustc_errors[725ee6d1248fa06b]::emitter::EmitterWriter>::ui_testing\r\n  14:     0x7ffbc8a37584 - <rustc_errors[725ee6d1248fa06b]::emitter::EmitterWriter as rustc_errors[725ee6d1248fa06b]::emitter::Emitter>::emit_diagnostic\r\n  15:     0x7ffbc8a31f04 - <rustc_errors[725ee6d1248fa06b]::json::JsonEmitter as rustc_errors[725ee6d1248fa06b]::emitter::Emitter>::emit_artifact_notification\r\n  16:     0x7ffbc8a312ef - <rustc_errors[725ee6d1248fa06b]::json::JsonEmitter as rustc_errors[725ee6d1248fa06b]::emitter::Emitter>::emit_diagnostic\r\n  17:     0x7ffbc8a2efae - <rustc_errors[725ee6d1248fa06b]::HandlerInner>::emit_diagnostic\r\n  18:     0x7ffbc8a2e112 - <rustc_errors[725ee6d1248fa06b]::Handler>::emit_diagnostic\r\n  19:     0x7ffbcc6052db - <rustc_errors[725ee6d1248fa06b]::ErrorGuaranteed as rustc_errors[725ee6d1248fa06b]::diagnostic_builder::EmissionGuarantee>::diagnostic_builder_emit_producing_guarantee\r\n  20:     0x7ffbcc1206f5 - <rustc_metadata[fcf7fe61921e0dd9]::rmeta::ProcMacroData as rustc_serialize[b2c7da44c7113ca]::serialize::Encodable<rustc_metadata[fcf7fe61921e0dd9]::rmeta::encoder::EncodeContext>>::encode\r\n  21:     0x7ffbcc11be9c - <rustc_metadata[fcf7fe61921e0dd9]::locator::MetadataError as core[be660d2aa9fa5454]::fmt::Display>::fmt\r\n  22:     0x7ffbc87d1f0f - <rustc_metadata[fcf7fe61921e0dd9]::creader::CrateLoader>::into_cstore\r\n  23:     0x7ffbc87d3986 - <rustc_metadata[fcf7fe61921e0dd9]::creader::CrateLoader>::process_extern_crate\r\n  24:     0x7ffbc98156d5 - <rustc_resolve[2fc444a2449b3d64]::build_reduced_graph::BuildReducedGraphVisitor as rustc_ast[2e96cc40c1434c55]::visit::Visitor>::visit_item\r\n  25:     0x7ffbc842797c - <rustc_resolve[2fc444a2449b3d64]::build_reduced_graph::BuildReducedGraphVisitor as rustc_ast[2e96cc40c1434c55]::visit::Visitor>::visit_crate\r\n  26:     0x7ffbc97f991b - <rustc_resolve[2fc444a2449b3d64]::Resolver as rustc_expand[e0b81650263632b7]::base::ResolverExpand>::visit_ast_fragment_with_placeholders\r\n  27:     0x7ffbc9de9816 - <rustc_expand[e0b81650263632b7]::expand::MacroExpander>::fully_expand_fragment\r\n  28:     0x7ffbc8845992 - <rustc_expand[e0b81650263632b7]::expand::MacroExpander>::expand_crate\r\n  29:     0x7ffbc7b9721f - rustc_interface[349b21d0ff016796]::callbacks::setup_callbacks\r\n  30:     0x7ffbc7b8b4c4 - <rustc_interface[349b21d0ff016796]::queries::Queries>::expansion\r\n  31:     0x7ffbc7b4a2c0 - rustc_driver[3883b99043dbd0d]::main\r\n  32:     0x7ffbc7b7d392 - rustc_driver[3883b99043dbd0d]::args::arg_expand_all\r\n  33:     0x7ffbc7b4b7f0 - rustc_driver[3883b99043dbd0d]::main\r\n  34:     0x7ffbc7b7ded7 - rustc_driver[3883b99043dbd0d]::args::arg_expand_all\r\n  35:     0x7ffbc7b6e499 - rustc_driver[3883b99043dbd0d]::main\r\n  36:     0x7ffbc7b6e8fd - rustc_driver[3883b99043dbd0d]::main\r\n  37:     0x7ffbc753d8fc - std::sys::windows::thread::Thread::new::hbba233cde4ca4894\r\n  38:     0x7ffc76087034 - BaseThreadInitThunk\r\n  39:     0x7ffc78062651 - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.65.0-nightly (228710758 2022-09-10) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type lib -C embed-bitcode=no -C debuginfo=2 -Z unstable-options -C force-frame-pointers -C link-arg=-Tlinkall.x -C link-arg=-Tdefmt.x\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\nerror: could not compile `once_cell`\r\n```\r\n\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n    Checking fugit v0.3.6\r\nthread 'rustc' panicked at 'identifier: \"metadata_std_required\", attr: None, args: FluentArgs([(\"add_info\", String(\"\")), (\"crate_name\", String(\"std\")), (\"locator_triple\", String(\"riscv32imac-unknown-none-elf\"))]), errors: [ResolverError(Reference(Variable { id: \"current_crate\" }))]', compiler\\rustc_errors\\src\\translation.rs:91:17\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.65.0-nightly (228710758 2022-09-10) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type lib -C embed-bitcode=no -C debuginfo=2 -Z unstable-options -C force-frame-pointers -C link-arg=-Tlinkall.x -C link-arg=-Tdefmt.x\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\n    Checking static_cell v1.0.0\r\nerror: could not compile `once_cell`\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "TheButlah", "id": 6969415, "node_id": "MDQ6VXNlcjY5Njk0MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6969415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheButlah", "html_url": "https://github.com/TheButlah", "followers_url": "https://api.github.com/users/TheButlah/followers", "following_url": "https://api.github.com/users/TheButlah/following{/other_user}", "gists_url": "https://api.github.com/users/TheButlah/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheButlah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheButlah/subscriptions", "organizations_url": "https://api.github.com/users/TheButlah/orgs", "repos_url": "https://api.github.com/users/TheButlah/repos", "events_url": "https://api.github.com/users/TheButlah/events{/privacy}", "received_events_url": "https://api.github.com/users/TheButlah/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/101707/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/101707/timeline", "performed_via_github_app": null, "state_reason": "completed"}