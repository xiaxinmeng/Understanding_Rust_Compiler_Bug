{"url": "https://api.github.com/repos/rust-lang/rust/issues/36284", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36284/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36284/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36284/events", "html_url": "https://github.com/rust-lang/rust/issues/36284", "id": 175111522, "node_id": "MDU6SXNzdWUxNzUxMTE1MjI=", "number": 36284, "title": "`Box<[T]>::into_raw` is useless", "user": {"login": "vinipsmaker", "id": 865914, "node_id": "MDQ6VXNlcjg2NTkxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/865914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vinipsmaker", "html_url": "https://github.com/vinipsmaker", "followers_url": "https://api.github.com/users/vinipsmaker/followers", "following_url": "https://api.github.com/users/vinipsmaker/following{/other_user}", "gists_url": "https://api.github.com/users/vinipsmaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/vinipsmaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vinipsmaker/subscriptions", "organizations_url": "https://api.github.com/users/vinipsmaker/orgs", "repos_url": "https://api.github.com/users/vinipsmaker/repos", "events_url": "https://api.github.com/users/vinipsmaker/events{/privacy}", "received_events_url": "https://api.github.com/users/vinipsmaker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36996, "node_id": "MDU6TGFiZWwzNjk5Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-easy", "name": "E-easy", "color": "02e10c", "default": false, "description": "Call for participation: Experience needed to fix: Easy / not much (good first issue)"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2016-09-05T17:56:02Z", "updated_at": "2017-10-02T12:19:51Z", "closed_at": "2017-10-02T07:03:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Sorry about the horrible title, but I really don't know how to else \"summarize\" this problem.\n\nI tried to get an answer for this several times on StackOverflow (after documentation proved useless) and now I'm coming here. Maybe it's just a matter of updating documentation to have guarantees of a behaviour that will continue to work on future versions of Rust (the main purpose of documentation in the first place) or maybe the error is me who failed to spot the useful part.\n\nI need to expose a Rust library to C applications and I need to expose an array of size only know at runtime to a function which will own this data and later will call a Rust function to deallocate it. I have a `Vec<u8>` and I need to get this `(*mut u8, usize)` tuple out of it. Later I need to get receive this same tuple and deallocate its data.\n\nOne option is to [use `mem::forget` + `Vec::from_raw_parts`](https://github.com/maidsafe/safe_core/commit/97bca53a826eddf12ce87bf823983ecff788c5e6#diff-6c72b345033f35005d017f9f5a1e1c9eR59), but this is far from ideal as `shrink_to_fit` isn't guaranteed to work and I'd also need to store capacity (the C library really shouldn't need to worry about that).\n\nThe perfect option would be to use `Vec::into_boxed_slice`. However, it crashed when I tried to use the pointer for the first element (`slice::as_mut_ptr`) to `Box::from_raw`, as it should. And I cannot pass the pointer return from `Box::into_raw` to the C function, as the memory layout is unspecified and I don't have any guarantee it'll be a pointer to the first element.\n\nHow do we fix this? Update documentation? Add some extra function to `Box<[T]>` like `Box<[T]>::from_raw_parts(ptr: *mut T, len: usize)`?\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36284/timeline", "performed_via_github_app": null, "state_reason": "completed"}