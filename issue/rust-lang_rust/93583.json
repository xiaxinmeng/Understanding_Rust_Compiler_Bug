{"url": "https://api.github.com/repos/rust-lang/rust/issues/93583", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93583/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93583/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93583/events", "html_url": "https://github.com/rust-lang/rust/issues/93583", "id": 1121904615, "node_id": "I_kwDOAAsO6M5C3ufn", "number": 93583, "title": "Automatic type coercion fails when implementing a trait for multiple types.", "user": {"login": "jvdwrf", "id": 61914700, "node_id": "MDQ6VXNlcjYxOTE0NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/61914700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jvdwrf", "html_url": "https://github.com/jvdwrf", "followers_url": "https://api.github.com/users/jvdwrf/followers", "following_url": "https://api.github.com/users/jvdwrf/following{/other_user}", "gists_url": "https://api.github.com/users/jvdwrf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jvdwrf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jvdwrf/subscriptions", "organizations_url": "https://api.github.com/users/jvdwrf/orgs", "repos_url": "https://api.github.com/users/jvdwrf/repos", "events_url": "https://api.github.com/users/jvdwrf/events{/privacy}", "received_events_url": "https://api.github.com/users/jvdwrf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-02-02T13:06:40Z", "updated_at": "2022-02-03T11:01:48Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "If I define the following trait, with a single implementation for `&str`, then this code compiles just fine.\r\n```rust\r\ntrait Trait<T> {\r\n    fn function(self, t: T);\r\n}\r\n\r\nimpl Trait<&str> for () {\r\n    fn function(self, t: &str) {}\r\n}\r\n\r\nfn main() {\r\n    // this is what gives the error\r\n    ().function(&\"test\".to_string());\r\n\r\n    // also an error\r\n    <() as Trait<_>>::function((), &\"test\".to_string());\r\n     \r\n    // this is fine\r\n    <() as Trait<&str>>::function((), &\"test\".to_string());\r\n\r\n    // also fine\r\n    ().function(&\"test\".to_string() as &str);\r\n}\r\n\r\n// uncommenting this gives an error\r\n// impl Trait<()> for () {\r\n//    fn function(self, t: ()) {}\r\n// }\r\n```\r\n\r\nHowever when uncommenting the last block, the following error is returned:\r\n```\r\nthe trait bound `(): Trait<&String>` is not satisfied\r\nthe following implementations were found:\r\n  <() as Trait<&str>>\r\n  <() as Trait<()>>\r\n```\r\n\r\nMy interpretation is that the &String gets coerced automatically to &str if there is a single Trait implementation to choose from. However once more than on Trait implementation is available, automatic coercion stops working, and manual coercion is necessary. This is even the case if there is only one valid type to coerce to as can be seen in this example (`&String` can never be coerced to `()`).\r\n\r\n\r\nThis issue is similar to the [following](https://github.com/rust-lang/rust/issues/92178) issue created by @compiler-errors. I have also talked with him on Zulip before posting it here.\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93583/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93583/timeline", "performed_via_github_app": null, "state_reason": null}