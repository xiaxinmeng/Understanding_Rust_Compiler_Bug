{"url": "https://api.github.com/repos/rust-lang/rust/issues/96362", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/96362/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/96362/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/96362/events", "html_url": "https://github.com/rust-lang/rust/issues/96362", "id": 1213662888, "node_id": "I_kwDOAAsO6M5IVwao", "number": 96362, "title": "fix rustc build with llvm head", "user": {"login": "nico", "id": 3487, "node_id": "MDQ6VXNlcjM0ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3487?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nico", "html_url": "https://github.com/nico", "followers_url": "https://api.github.com/users/nico/followers", "following_url": "https://api.github.com/users/nico/following{/other_user}", "gists_url": "https://api.github.com/users/nico/gists{/gist_id}", "starred_url": "https://api.github.com/users/nico/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nico/subscriptions", "organizations_url": "https://api.github.com/users/nico/orgs", "repos_url": "https://api.github.com/users/nico/repos", "events_url": "https://api.github.com/users/nico/events{/privacy}", "received_events_url": "https://api.github.com/users/nico/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2022-04-24T13:59:15Z", "updated_at": "2022-04-29T12:58:33Z", "closed_at": "2022-04-25T00:40:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "building rust started failing like so:\r\n\r\n```\r\nrustc/x86_64-unknown-linux-gnu/release/build/rustc_llvm-475f372969e8d34a/out/llvm-wrapper/PassWrapper.o\" \"-c\" \"llvm-wrapper/PassWrapper.cpp\"\r\n   cargo:warning=llvm-wrapper/PassWrapper.cpp:124:15: error: use of undeclared identifier 'createAddressSanitizerFunctionPass'; did you mean 'createHWAddressSanitizerLegacyPassPass'?\r\n   cargo:warning=  return wrap(createAddressSanitizerFunctionPass(CompileKernel, Recover, UseAfterScope));\r\n   cargo:warning=              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n   cargo:warning=              createHWAddressSanitizerLegacyPassPass\r\n   cargo:warning=/b/s/w/ir/cache/builder/src/third_party/llvm/llvm/include/llvm/Transforms/Instrumentation/HWAddressSanitizer.h:54:1: note: 'createHWAddressSanitizerLegacyPassPass' declared here\r\n   cargo:warning=createHWAddressSanitizerLegacyPassPass(bool CompileKernel = false,\r\n   cargo:warning=^\r\n   cargo:warning=llvm-wrapper/PassWrapper.cpp:130:15: error: use of undeclared identifier 'createModuleAddressSanitizerLegacyPassPass'; did you mean 'createHWAddressSanitizerLegacyPassPass'?\r\n   cargo:warning=  return wrap(createModuleAddressSanitizerLegacyPassPass(CompileKernel, Recover));\r\n   cargo:warning=              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n   cargo:warning=              createHWAddressSanitizerLegacyPassPass\r\n   cargo:warning=/b/s/w/ir/cache/builder/src/third_party/llvm/llvm/include/llvm/Transforms/Instrumentation/HWAddressSanitizer.h:54:1: note: 'createHWAddressSanitizerLegacyPassPass' declared here\r\n   cargo:warning=createHWAddressSanitizerLegacyPassPass(bool CompileKernel = false,\r\n   cargo:warning=^\r\n   cargo:warning=llvm-wrapper/PassWrapper.cpp:136:15: error: use of undeclared identifier 'createMemorySanitizerLegacyPassPass'\r\n   cargo:warning=  return wrap(createMemorySanitizerLegacyPassPass(\r\n   cargo:warning=              ^\r\n   cargo:warning=llvm-wrapper/PassWrapper.cpp:168:17: error: no member named 'populateThinLTOPassManager' in 'llvm::PassManagerBuilder'; did you mean 'populateModulePassManager'?\r\n   cargo:warning=  unwrap(PMBR)->populateThinLTOPassManager(*unwrap(PMR));\r\n   cargo:warning=                ^~~~~~~~~~~~~~~~~~~~~~~~~~\r\n   cargo:warning=                populateModulePassManager\r\n   cargo:warning=/b/s/w/ir/cache/builder/src/third_party/llvm/llvm/include/llvm/Transforms/IPO/PassManagerBuilder.h:226:8: note: 'populateModulePassManager' declared here\r\n   cargo:warning=  void populateModulePassManager(legacy::PassManagerBase &MPM);\r\n   cargo:warning=       ^\r\n   cargo:warning=4 errors generated.\r\n   exit status: 1\r\n```\r\n\r\nNeed to update rust code to work after https://reviews.llvm.org/D124216 (createAddressSanitizerFunctionPass, createModuleAddressSanitizerLegacyPassPass removal, https://reviews.llvm.org/D123882 populateThinLTOPassManager removal).\r\n\r\nhttps://github.com/rust-lang/rust/commit/6234a5694936cb0f7c9a3fb456ae4c0aeee69f11 has a related example.\r\n\r\n@nikic Do you know if Augie (or anyone else) has a patch for this already?\r\n\r\n@adetaylor ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/96362/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/96362/timeline", "performed_via_github_app": null, "state_reason": "completed"}