{"url": "https://api.github.com/repos/rust-lang/rust/issues/22793", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22793/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22793/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22793/events", "html_url": "https://github.com/rust-lang/rust/issues/22793", "id": 58850820, "node_id": "MDU6SXNzdWU1ODg1MDgyMA==", "number": 22793, "title": "setlocale and var_os interaction.", "user": {"login": "dpc", "id": 9209, "node_id": "MDQ6VXNlcjkyMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/9209?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dpc", "html_url": "https://github.com/dpc", "followers_url": "https://api.github.com/users/dpc/followers", "following_url": "https://api.github.com/users/dpc/following{/other_user}", "gists_url": "https://api.github.com/users/dpc/gists{/gist_id}", "starred_url": "https://api.github.com/users/dpc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dpc/subscriptions", "organizations_url": "https://api.github.com/users/dpc/orgs", "repos_url": "https://api.github.com/users/dpc/repos", "events_url": "https://api.github.com/users/dpc/events{/privacy}", "received_events_url": "https://api.github.com/users/dpc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2015-02-25T05:01:11Z", "updated_at": "2015-02-25T20:28:38Z", "closed_at": "2015-02-25T20:28:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In my ncurses program if I have two pieces of code:\n\n1:\n\n```\n          if env::var_os(\"ESCDELAY\").is_none() {} \n```\n\n2:\n\n```\n         unsafe {                                                                                                                                                      \n              let _ = locale::setlocale(locale::LC_ALL, b\"en_US.UTF-8\".as_ptr() as *const i8);                                                                          \n          }  \n```\n\nIf 2 is before 1, then unicode in my program breaks. If 1 is before 2 everything is fine. \n\nThe bindings to setlocale that I use are:\n\n```\n  mod locale {\n      use libc::{c_int, c_char};                                                                                                                                        \n      pub const LC_ALL: c_int = 6; \n      extern \"C\" {\n           pub fn setlocale(category: c_int, locale: *const c_char) -> *mut c_char;\n      }\n}\n```\n\nMy guess is that `std::env` is not expecting `setlocale` changing the underlying environment or something like that. I'm not sure if it's OK, and should it be documented, but decided to let you know, as it was really confusing. \n", "closed_by": {"login": "dpc", "id": 9209, "node_id": "MDQ6VXNlcjkyMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/9209?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dpc", "html_url": "https://github.com/dpc", "followers_url": "https://api.github.com/users/dpc/followers", "following_url": "https://api.github.com/users/dpc/following{/other_user}", "gists_url": "https://api.github.com/users/dpc/gists{/gist_id}", "starred_url": "https://api.github.com/users/dpc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dpc/subscriptions", "organizations_url": "https://api.github.com/users/dpc/orgs", "repos_url": "https://api.github.com/users/dpc/repos", "events_url": "https://api.github.com/users/dpc/events{/privacy}", "received_events_url": "https://api.github.com/users/dpc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22793/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22793/timeline", "performed_via_github_app": null, "state_reason": "completed"}