{"url": "https://api.github.com/repos/rust-lang/rust/issues/31365", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31365/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31365/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31365/events", "html_url": "https://github.com/rust-lang/rust/issues/31365", "id": 130688643, "node_id": "MDU6SXNzdWUxMzA2ODg2NDM=", "number": 31365, "title": "Internal compiler error when variant_size_differences lint is enabled", "user": {"login": "madadam", "id": 5271, "node_id": "MDQ6VXNlcjUyNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madadam", "html_url": "https://github.com/madadam", "followers_url": "https://api.github.com/users/madadam/followers", "following_url": "https://api.github.com/users/madadam/following{/other_user}", "gists_url": "https://api.github.com/users/madadam/gists{/gist_id}", "starred_url": "https://api.github.com/users/madadam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madadam/subscriptions", "organizations_url": "https://api.github.com/users/madadam/orgs", "repos_url": "https://api.github.com/users/madadam/repos", "events_url": "https://api.github.com/users/madadam/events{/privacy}", "received_events_url": "https://api.github.com/users/madadam/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-02-02T13:50:46Z", "updated_at": "2016-02-02T17:26:32Z", "closed_at": "2016-02-02T17:26:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\n\nWhen the `variant_size_differences` lint check is enabled and there is an enum which triggers it, the compiler ICE's. Here is a minimal code to reproduce:\n\n```\n#![warn(variant_size_differences)]\n\nenum Stuff {\n  Foo(u32),\n  Bar([u32; 100]),\n}\n\nfn main() {\n}\n```\n\nThis is the output of `cargo build`:\n\n```\n> RUST_BACKTRACE=1 cargo build\n   Compiling sandbox v0.1.0 (file:///home/adam/projects/sandbox)\nsrc/main.rs:3:1: 6:2 warning: enum is never used: `Stuff`, #[warn(dead_code)] on by default\nsrc/main.rs:3 enum Stuff {\nsrc/main.rs:4   Foo(u32),\nsrc/main.rs:5   Bar([u32; 100]),\nsrc/main.rs:6 }\nsrc/main.rs:3:1: 6:2 warning: enum variant is more than three times larger (400 bytes) than the next largest (ignoring padding)\nsrc/main.rs:3 enum Stuff {\nsrc/main.rs:4   Foo(u32),\nsrc/main.rs:5   Bar([u32; 100]),\nsrc/main.rs:6 }\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'no entry found for key', ../src/libcore/option.rs:335\nstack backtrace:\n   1:     0x7eff4eb2dbf0 - sys::backtrace::tracing::imp::write::haa19c02b4de52f3bG0t\n   2:     0x7eff4eb347d5 - panicking::log_panic::_<closure>::closure.41218\n   3:     0x7eff4eb3426f - panicking::log_panic::h527fe484e9de8fe1W7x\n   4:     0x7eff4eafd8c3 - sys_common::unwind::begin_unwind_inner::h51f64b1a34c60827fTs\n   5:     0x7eff4eafe228 - sys_common::unwind::begin_unwind_fmt::h0845853a1913f45blSs\n   6:     0x7eff4eb2ba41 - rust_begin_unwind\n   7:     0x7eff4eb7c4ff - panicking::panic_fmt::h3967afc085fe8067LFK\n   8:     0x7eff4c62105a - lint::context::raw_emit_lint::h25d2b7814a8a10221tp\n   9:     0x7eff4da33cf4 - trans::base::trans_item::h174e1e77e61839f8xoj\n  10:     0x7eff4da3e044 - trans::base::trans_crate::hfa80b52afc9f6ffea8j\n  11:     0x7eff4f03eab1 - driver::phase_4_translate_to_llvm::ha2dc8a5f89b36c86dTa\n  12:     0x7eff4f038a06 - driver::phase_3_run_analysis_passes::_<closure>::closure.25599\n  13:     0x7eff4f017813 - middle::ty::context::_<impl>::create_and_enter::create_and_enter::h13716335538836217011\n  14:     0x7eff4f013251 - driver::phase_3_run_analysis_passes::h5249241190295309167\n  15:     0x7eff4efe8559 - driver::compile_input::h58ee58653fb11a3ehca\n  16:     0x7eff4efda77b - run_compiler::hd4933b7af1175e4aOwc\n  17:     0x7eff4efd7436 - sys_common::unwind::try::try_fn::try_fn::h5795434642313485966\n  18:     0x7eff4eb2b888 - __rust_try\n  19:     0x7eff4eb2318b - sys_common::unwind::try::inner_try::h771fec597ec8f35cNPs\n  20:     0x7eff4efd7790 - boxed::_<impl>::call_box::call_box::h18189923456789545281\n  21:     0x7eff4eb32cd3 - sys::thread::_<impl>::new::thread_start::haf749b76474da6b089w\n  22:     0x7eff487c26a9 - start_thread\n  23:     0x7eff4e7b9eec - clone\n  24:                0x0 - <unknown>\n\nCould not compile `sandbox`.\n\nTo learn more, run the command again with --verbose.\n```\n\nWithout the `variant_size_differences` lint, the code compiles fine.\n\n```\n> rustc --version --verbose\nrustc 1.6.0 (c30b771ad 2016-01-19)\nbinary: rustc\ncommit-hash: c30b771ad9d44ab84f8c88b80c25fcfde2433126\ncommit-date: 2016-01-19\nhost: x86_64-unknown-linux-gnu\nrelease: 1.6.0\n```\n", "closed_by": {"login": "madadam", "id": 5271, "node_id": "MDQ6VXNlcjUyNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5271?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madadam", "html_url": "https://github.com/madadam", "followers_url": "https://api.github.com/users/madadam/followers", "following_url": "https://api.github.com/users/madadam/following{/other_user}", "gists_url": "https://api.github.com/users/madadam/gists{/gist_id}", "starred_url": "https://api.github.com/users/madadam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madadam/subscriptions", "organizations_url": "https://api.github.com/users/madadam/orgs", "repos_url": "https://api.github.com/users/madadam/repos", "events_url": "https://api.github.com/users/madadam/events{/privacy}", "received_events_url": "https://api.github.com/users/madadam/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31365/timeline", "performed_via_github_app": null, "state_reason": "completed"}