{"url": "https://api.github.com/repos/rust-lang/rust/issues/54514", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54514/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54514/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54514/events", "html_url": "https://github.com/rust-lang/rust/issues/54514", "id": 362979862, "node_id": "MDU6SXNzdWUzNjI5Nzk4NjI=", "number": 54514, "title": "#[derive(Clone)] places unnecessary Clone constraint on type parameter", "user": {"login": "iitalics", "id": 1772927, "node_id": "MDQ6VXNlcjE3NzI5Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1772927?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iitalics", "html_url": "https://github.com/iitalics", "followers_url": "https://api.github.com/users/iitalics/followers", "following_url": "https://api.github.com/users/iitalics/following{/other_user}", "gists_url": "https://api.github.com/users/iitalics/gists{/gist_id}", "starred_url": "https://api.github.com/users/iitalics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iitalics/subscriptions", "organizations_url": "https://api.github.com/users/iitalics/orgs", "repos_url": "https://api.github.com/users/iitalics/repos", "events_url": "https://api.github.com/users/iitalics/events{/privacy}", "received_events_url": "https://api.github.com/users/iitalics/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-23T21:41:18Z", "updated_at": "2018-09-23T21:48:14Z", "closed_at": "2018-09-23T21:48:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Consider we make a parameterize type which references an associated type but not the parameter itself.\r\n\r\n```rust\r\ntrait Actor {\r\n  type Msg;\r\n  fn send(&self, m: Self::Msg);\r\n}\r\n\r\n#[derive(Clone)]\r\nstruct TwoMsgs<A: Actor>(A::Msg, A::Msg);\r\n\r\nfn thing<A>(ac: &A, tm: &TwoMsgs<A>)\r\nwhere A: Actor, A::Msg: Clone {\r\n    let tm2: TwoMsgs<A> = tm.clone();\r\n    ac.send(tm2.0);\r\n    ac.send(tm2.1);\r\n}\r\n```\r\n\r\nThe line `tm.clone()` dispatches incorrectly, because `TwoMsgs<A>: Clone` is not satisfied. It turns out that the way to satisfy it is to add the trait bound `A: Clone`.\r\n\r\n```rust\r\nfn thing<A>(ac: &A, tm: &TwoMsgs<A>)\r\nwhere A: Actor, A: Clone, A::Msg: Clone {\r\n    let tm2: TwoMsgs<A> = tm.clone();\r\n    ac.send(tm2.0);\r\n    ac.send(tm2.1);\r\n}\r\n```\r\n\r\nHowever, this does not make sense -- we do not wish to clone the actor, so requiring `A: Clone` is unnecessarily restrictive! There is no reason that the bound `A: Clone` should be required, since `TwoMsgs<A>` does not contain any `A` in its fields.\r\n\r\n**Expected behavior**: The derived `Clone` instance should look something like:\r\n```rust\r\nimpl<A> Clone for TwoMsgs<A>\r\nwhere A: Actor, A::Msg: Clone {\r\n    fn clone(&self) -> Self {\r\n        TwoMsgs(self.0.clone(), self.1.clone())\r\n    }\r\n}\r\n``` \r\n\r\nThat is, it does not require `A: Clone`.", "closed_by": {"login": "iitalics", "id": 1772927, "node_id": "MDQ6VXNlcjE3NzI5Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1772927?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iitalics", "html_url": "https://github.com/iitalics", "followers_url": "https://api.github.com/users/iitalics/followers", "following_url": "https://api.github.com/users/iitalics/following{/other_user}", "gists_url": "https://api.github.com/users/iitalics/gists{/gist_id}", "starred_url": "https://api.github.com/users/iitalics/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iitalics/subscriptions", "organizations_url": "https://api.github.com/users/iitalics/orgs", "repos_url": "https://api.github.com/users/iitalics/repos", "events_url": "https://api.github.com/users/iitalics/events{/privacy}", "received_events_url": "https://api.github.com/users/iitalics/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54514/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54514/timeline", "performed_via_github_app": null, "state_reason": "completed"}