{"url": "https://api.github.com/repos/rust-lang/rust/issues/21224", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21224/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21224/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21224/events", "html_url": "https://github.com/rust-lang/rust/issues/21224", "id": 54541834, "node_id": "MDU6SXNzdWU1NDU0MTgzNA==", "number": 21224, "title": "ICE dereferencing raw ptr after transmute", "user": {"login": "Axylos", "id": 5732879, "node_id": "MDQ6VXNlcjU3MzI4Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/5732879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Axylos", "html_url": "https://github.com/Axylos", "followers_url": "https://api.github.com/users/Axylos/followers", "following_url": "https://api.github.com/users/Axylos/following{/other_user}", "gists_url": "https://api.github.com/users/Axylos/gists{/gist_id}", "starred_url": "https://api.github.com/users/Axylos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Axylos/subscriptions", "organizations_url": "https://api.github.com/users/Axylos/orgs", "repos_url": "https://api.github.com/users/Axylos/repos", "events_url": "https://api.github.com/users/Axylos/events{/privacy}", "received_events_url": "https://api.github.com/users/Axylos/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-01-16T05:45:21Z", "updated_at": "2015-01-16T06:11:21Z", "closed_at": "2015-01-16T06:11:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Included both a traceback, version, and then code below.  when dereferencing a raw ptr in unsafe code that points to a struct, the compiler throws an ICE.\n\n```\nUST_BACKTRACE=1 rustc main.rs\nmain.rs:36:10: 36:12 error: internal compiler error: this path should not cause illegal move\nmain.rs:36         (*h);\n                    ^~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libsyntax/diagnostic.rs:123\n\nstack backtrace:\n   1:     0x7f49e808aed0 - sys::backtrace::write::hf251c2373d8c39658Rt\n   2:     0x7f49e80ac8b0 - failure::on_fail::h2ff2bf5f19ce9580S5z\n   3:     0x7f49e801b7b0 - rt::unwind::begin_unwind_inner::h639cf27e708a803eKKz\n   4:     0x7f49e2e031e0 - rt::unwind::begin_unwind::h13718395300347571823\n   5:     0x7f49e2e03170 - diagnostic::SpanHandler::span_bug::h30199d6c35e77bdfuVF\n   6:     0x7f49e618e620 - session::Session::span_bug::h746560f6bbc10d03h6q\n   7:     0x7f49e6d537f0 - borrowck::build_borrowck_dataflow_data::h04fa03f458e1d20bKRe\n   8:     0x7f49e6d50620 - borrowck::borrowck_fn::ha56ab0aeb4243b356Oe\n   9:     0x7f49e6d51530 - borrowck::borrowck_item::hc035adeb2d3ecbcc3Ne\n  10:     0x7f49e6d51aa0 - borrowck::check_crate::h971105b7551dfbd3UIe\n  11:     0x7f49e85dcff0 - driver::phase_3_run_analysis_passes::h039ad5f8102225f2EEa\n  12:     0x7f49e85cadd0 - driver::compile_input::haa1e0a1302dab243Aba\n  13:     0x7f49e868c6c0 - run_compiler::h385e1ee7d7e284bee5b\n  14:     0x7f49e868ae30 - thunk::F.Invoke<A, R>::invoke::h17064898529926817575\n  15:     0x7f49e8689d90 - rt::unwind::try::try_fn::h13784017587596973898\n  16:     0x7f49e8113a60 - rust_try_inner\n  17:     0x7f49e8113a50 - rust_try\n  18:     0x7f49e868a040 - thunk::F.Invoke<A, R>::invoke::h10896099676476614463\n  19:     0x7f49e809a550 - sys::thread::thread_start::h9cd6def278b6034eVJw\n  20:     0x7f49e26200c0 - start_thread\n  21:     0x7f49e7cbbec9 - __clone\n  22:                0x0 - <unknown>\n\nsrc | 00:39:54 -->\nrustc --verbose --version\nrustc 1.0.0-nightly (170c4399e 2015-01-14 00:41:55 +0000)\nbinary: rustc\ncommit-hash: 170c4399e614fe599c3d41306b3429ca8b3b68c6\ncommit-date: 2015-01-14 00:41:55 +0000\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-nightly\n```\n\n``` rust\nuse std::mem;\nstruct Thing {\n    y: u64,\n    z: u64\n }\n\n fn main() {\n\n    let x = Thing { y: 2347087u64, z: 283098734u64 };\n    let x2: *const Thing = &x;\n    let x3: *const u8 = x2 as *const u8;\n\n    let s: &[u8] = unsafe {\n        std::mem::transmute(std::raw::Slice {\n            data: x3,\n            len: std::mem::size_of::<Thing>()\n        })\n    };\n\n    let z = s.clone();\n    let foo = unsafe {\n        let s2: std::raw::Slice<Thing> = std::mem::transmute(z);\n        let h: *const Thing = s2.data as *const Thing;\n        (*h);\n    };\n}\n```\n", "closed_by": {"login": "Axylos", "id": 5732879, "node_id": "MDQ6VXNlcjU3MzI4Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/5732879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Axylos", "html_url": "https://github.com/Axylos", "followers_url": "https://api.github.com/users/Axylos/followers", "following_url": "https://api.github.com/users/Axylos/following{/other_user}", "gists_url": "https://api.github.com/users/Axylos/gists{/gist_id}", "starred_url": "https://api.github.com/users/Axylos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Axylos/subscriptions", "organizations_url": "https://api.github.com/users/Axylos/orgs", "repos_url": "https://api.github.com/users/Axylos/repos", "events_url": "https://api.github.com/users/Axylos/events{/privacy}", "received_events_url": "https://api.github.com/users/Axylos/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21224/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21224/timeline", "performed_via_github_app": null, "state_reason": "completed"}