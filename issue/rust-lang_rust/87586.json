{"url": "https://api.github.com/repos/rust-lang/rust/issues/87586", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/87586/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/87586/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/87586/events", "html_url": "https://github.com/rust-lang/rust/issues/87586", "id": 955828709, "node_id": "MDU6SXNzdWU5NTU4Mjg3MDk=", "number": 87586, "title": "Ignored doctests are run with `cargo test -- --ignored`.", "user": {"login": "thomcc", "id": 860665, "node_id": "MDQ6VXNlcjg2MDY2NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/860665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomcc", "html_url": "https://github.com/thomcc", "followers_url": "https://api.github.com/users/thomcc/followers", "following_url": "https://api.github.com/users/thomcc/following{/other_user}", "gists_url": "https://api.github.com/users/thomcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomcc/subscriptions", "organizations_url": "https://api.github.com/users/thomcc/orgs", "repos_url": "https://api.github.com/users/thomcc/repos", "events_url": "https://api.github.com/users/thomcc/events{/privacy}", "received_events_url": "https://api.github.com/users/thomcc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 1118559391, "node_id": "MDU6TGFiZWwxMTE4NTU5Mzkx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-doctests", "name": "A-doctests", "color": "f7e101", "default": false, "description": "Area: Documentation tests, run by rustdoc"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2021-07-29T13:11:49Z", "updated_at": "2023-02-02T21:34:57Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "If you use `rust,ignore` to ignore doctests which don't compile (often because you want to include example code that's entirely expository in your documentation \u2014\u00a0something that doesn't compile at all, and should merely syntax highlight as Rust), they still are attempted to compile and run when you pass `--ignored` to the test runner.\r\n\r\nThis is unfortunate, as this is what you use to run `#[ignore]`d tests, which are good (intended?) for tests that are too slow to complete in normal execution, often ones which are exhaustive. Having doctests that fail to compile be mixed in here means this use of `#[ignore]` is effectively broken.\r\n\r\nThe workaround I know for this is rather gross, e.g. using a `const _: &str = stringify!{ /* code that doesn't compile here */ }` wrapper ([for example](https://github.com/serde-rs/serde/blob/d9c338ec4abd1dd6fdd305e208bff1fd7faaabff/serde_test/src/lib.rs#L28-L30) \u2014 even if using `ignore` wouldn't have been an alternative here since it's large enough that you'd rather ensure it compiles in practice, this is the pattern I'm referring to).\r\n\r\nI think it's honestly a bug that this is the effect of `rust,ignore`, and think that instead it should be to just not emit the test.\r\n\r\n(This is related to, but distinct from https://github.com/rust-lang/rust/issues/30032)\r\n\r\nI bugged @jyn514 about this once and he indicated he thought it might require an RFC to fix, but when I was complaining about it elsewhere recently, someone pointed out that there was no bug on file for it already.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/87586/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/87586/timeline", "performed_via_github_app": null, "state_reason": null}