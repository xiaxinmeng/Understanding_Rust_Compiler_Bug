{"url": "https://api.github.com/repos/rust-lang/rust/issues/28217", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/28217/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/28217/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/28217/events", "html_url": "https://github.com/rust-lang/rust/issues/28217", "id": 104788860, "node_id": "MDU6SXNzdWUxMDQ3ODg4NjA=", "number": 28217, "title": "thread 'rustc' panicked at 'index out of bounds: [...] src/libcollections/vec.rs:1047", "user": {"login": "Mange", "id": 1599, "node_id": "MDQ6VXNlcjE1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mange", "html_url": "https://github.com/Mange", "followers_url": "https://api.github.com/users/Mange/followers", "following_url": "https://api.github.com/users/Mange/following{/other_user}", "gists_url": "https://api.github.com/users/Mange/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mange/subscriptions", "organizations_url": "https://api.github.com/users/Mange/orgs", "repos_url": "https://api.github.com/users/Mange/repos", "events_url": "https://api.github.com/users/Mange/events{/privacy}", "received_events_url": "https://api.github.com/users/Mange/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-09-03T21:51:53Z", "updated_at": "2016-05-24T21:23:06Z", "closed_at": "2016-05-24T21:23:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "I can't use the `json!` macro on latest `master` (2015-09-03).\n\n**I tried this code:**\n\nsrc/main.rs\n\n``` rust\n#![feature(plugin)]\n#![plugin(json_macros)]\nextern crate rustc_serialize;\n\nfn main() {\n    let payload = json!({\"test\": \"1\"});\n    println!(payload.to_string());\n}\n```\n\nCargo.toml:\n\n``` toml\n[package]\n\nname = \"rust-bug\"\nversion = \"0.0.1\"\nauthors = [ \"Magnus Bergmark <magnus.bergmark@gmail.com>\" ]\n\n[dependencies]\njson_macros = \"0.2.5\"\nrustc-serialize = \"*\"\n```\n\n```\ncargo run\n```\n\n**I expected to see this happen:** `{\"test\":\"1\"}`\n\n**Instead, this happened:** `note: the compiler unexpectedly panicked. this is a bug.`\n## Meta\n\n`rustc --version --verbose`:\n\n```\nrustc 1.4.0-nightly (9e9c83b89 2015-09-03)\nbinary: rustc\ncommit-hash: 9e9c83b8994fab4f69fc75838c8c856b57caa5d1\ncommit-date: 2015-09-03\nhost: x86_64-apple-darwin\nrelease: 1.4.0-nightly\n```\n\n`cargo --version`:\n\n```\ncargo 0.5.0 (7ea8265 2015-09-03)\n```\n\n**Backtrace:**\n\n```\n\u203a RUST_BACKTRACE=1 cargo run --verbose\n       Fresh rustc-serialize v0.3.16\n       Fresh json_macros v0.2.5\n   Compiling rust-bug v0.0.1 (file:///Users/mange/Desktop/rust-bug)\n     Running `rustc src/main.rs --crate-name rust_bug --crate-type bin -g --out-dir /Users/mange/Desktop/rust-bug/target/debug --emit=dep-info,link -L dependency=/Users/mange/Desktop/rust-bug/target/debug -L dependency=/Users/mange/Desktop/rust-bug/target/debug/deps --extern json_macros=/Users/mange/Desktop/rust-bug/target/debug/deps/libjson_macros-588fa665176505c5.dylib --extern rustc_serialize=/Users/mange/Desktop/rust-bug/target/debug/deps/librustc_serialize-7ff5bfc027146194.rlib`\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'index out of bounds: the len is 60 but the index is 67', src/libcollections/vec.rs:1047\n```\n\n```\nstack backtrace:\n   1:        0x111149940 - sys::backtrace::tracing::imp::write::hd0176e40ebe71d28Vks\n   2:        0x11115191b - panicking::on_panic::h929e7e75bc4f2c31NXw\n   3:        0x111113c12 - rt::unwind::begin_unwind_inner::h9d2d49cde66c0c4b0sw\n   4:        0x11111499d - rt::unwind::begin_unwind_fmt::h30d162ea92169f156rw\n   5:        0x111151527 - rust_begin_unwind\n   6:        0x1111925b0 - panicking::panic_fmt::ha85fd08dcab4df5d8PE\n   7:        0x11118c710 - panicking::panic_bounds_check::h74acb99379ef18f4ePE\n   8:        0x117aba24b - parse::token::InternedString::new_from_name::hf3d5b4c0153b6a85EiT\n   9:        0x117bb7014 - parse::parser::Parser<'a>::parse_optional_str::hcbe96d5b0fc32f68b5M\n  10:        0x117bb7183 - parse::parser::Parser<'a>::parse_str::h9f9ed6f8c5ab3308o6M\n  11:        0x112a0fdfc - plugin::parse_json::closure.10831\n  12:        0x112a0f3bd - parse::parser::Parser<'a>::parse_seq_to_before_end::h13189328464236698498\n  13:        0x112a0ee2c - parse::parser::Parser<'a>::parse_seq_to_end::h14254503023922733831\n  14:        0x1129d35a6 - plugin::parse_json::hfd1a1f8297018b85lba\n  15:        0x1129d307e - plugin::expand::h6ee2acb00f38e3fauaa\n  16:        0x1157258e9 - ext::base::F.TTMacroExpander::expand::h14210021944373090710\n  17:        0x10eee9137 - ext::expand::expand_expr::closure.68004\n  18:        0x10eee5f45 - ext::expand::expand_expr::h4484ab514eace144rqb\n  19:        0x10ef0ea40 - ext::expand::expand_non_macro_stmt::closure.68390\n  20:        0x10ef0e1f0 - ext::expand::expand_non_macro_stmt::closure.68388\n  21:        0x10ef0b5a3 - ext::expand::expand_stmt::hbe43f4150453a1b4t7b\n  22:        0x10ef3085e - ext::expand::expand_block_elts::closure.68722\n  23:        0x10ef305ba - iter::FlatMap<I, U, F>.Iterator::next::h5626001629407774195\n  24:        0x10ef2fc77 - vec::Vec<T>.FromIterator<T>::from_iter::h5081602814983063810\n  25:        0x10ef2f86f - ext::expand::expand_block_elts::closure.68715\n  26:        0x10eef6794 - ext::expand::expand_block_elts::h46bebebd90c7c5fdnic\n  27:        0x10ef2f4bd - ext::expand::expand_block::h0a7e72090e4cf398Ihc\n  28:        0x10eef6293 - ext::expand::expand_and_rename_fn_decl_and_block::h384c6a1c45a18003wGc\n  29:        0x10eefc539 - ext::expand::expand_item_underscore::h8b5990810bd9fc6e4Vb\n  30:        0x10ef50f0a - fold::noop_fold_item_simple::h10230394405410749093\n  31:        0x10ef50a79 - fold::noop_fold_item::h6703425555223222517\n  32:        0x10eefa32a - ext::expand::expand_annotatable::h707bae4d90aeefc9Bsc\n  33:        0x10eef6938 - ext::expand::expand_item::h8d338912a8cd204dtVb\n  34:        0x10ef02985 - iter::FlatMap<I, U, F>.Iterator::next::h12350997629097857049\n  35:        0x10ef0249c - vec::Vec<T>.FromIterator<T>::from_iter::h7763438502537858767\n  36:        0x10ef021ca - fold::noop_fold_mod::h6321912319619061707\n  37:        0x10eefcdc9 - ext::expand::expand_item_underscore::h8b5990810bd9fc6e4Vb\n  38:        0x10ef50f0a - fold::noop_fold_item_simple::h10230394405410749093\n  39:        0x10ef50a79 - fold::noop_fold_item::h6703425555223222517\n  40:        0x10eefb34e - ext::expand::expand_annotatable::h707bae4d90aeefc9Bsc\n  41:        0x10eef6938 - ext::expand::expand_item::h8d338912a8cd204dtVb\n  42:        0x10ef5a6b0 - ext::expand::expand_crate::hd42c32144acafe9dkRc\n  43:        0x10d62a56a - driver::phase_2_configure_and_expand::closure.27279\n  44:        0x10d5bd270 - driver::phase_2_configure_and_expand::h9a043ebdf303a32b3ta\n  45:        0x10d5ad050 - driver::compile_input::h277a8ae423a5a9f3Yba\n  46:        0x10d711e50 - run_compiler::h9482972dfd518dccbqc\n  47:        0x10d70f749 - boxed::F.FnBox<A>::call_box::h12200329393199643738\n  48:        0x10d70f142 - rt::unwind::try::try_fn::h12741742821322866078\n  49:        0x1111514d8 - __rust_try\n  50:        0x11113dcb0 - rt::unwind::try::inner_try::h03cd26bf8e2ee1ceTow\n  51:        0x10d70f2f2 - boxed::F.FnBox<A>::call_box::h16465870040843100935\n  52:        0x11115084d - sys::thread::Thread::new::thread_start::he62641fb2961f41aBNv\n  53:     0x7fff8608f267 - _pthread_body\n  54:     0x7fff8608f1e4 - _pthread_start\n```\n\n```\nCould not compile `rust-bug`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/main.rs --crate-name rust_bug --crate-type bin -g --out-dir /Users/mange/Desktop/rust-bug/target/debug --emit=dep-info,link -L dependency=/Users/mange/Desktop/rust-bug/target/debug -L dependency=/Users/mange/Desktop/rust-bug/target/debug/deps --extern json_macros=/Users/mange/Desktop/rust-bug/target/debug/deps/libjson_macros-588fa665176505c5.dylib --extern rustc_serialize=/Users/mange/Desktop/rust-bug/target/debug/deps/librustc_serialize-7ff5bfc027146194.rlib` (exit code: 101)\n```\n\n(I broke the output into three so it's more obvious where the backtrace begins and ends.)\n\n---\n\nLet me know if there's anything else I can add or try.\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/28217/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/28217/timeline", "performed_via_github_app": null, "state_reason": "completed"}