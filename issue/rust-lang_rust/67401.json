{"url": "https://api.github.com/repos/rust-lang/rust/issues/67401", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67401/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67401/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67401/events", "html_url": "https://github.com/rust-lang/rust/issues/67401", "id": 539790414, "node_id": "MDU6SXNzdWU1Mzk3OTA0MTQ=", "number": 67401, "title": "typeck can't check too nested impl specialized values under async", "user": {"login": "vertexclique", "id": 578559, "node_id": "MDQ6VXNlcjU3ODU1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/578559?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vertexclique", "html_url": "https://github.com/vertexclique", "followers_url": "https://api.github.com/users/vertexclique/followers", "following_url": "https://api.github.com/users/vertexclique/following{/other_user}", "gists_url": "https://api.github.com/users/vertexclique/gists{/gist_id}", "starred_url": "https://api.github.com/users/vertexclique/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vertexclique/subscriptions", "organizations_url": "https://api.github.com/users/vertexclique/orgs", "repos_url": "https://api.github.com/users/vertexclique/repos", "events_url": "https://api.github.com/users/vertexclique/events{/privacy}", "received_events_url": "https://api.github.com/users/vertexclique/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-18T16:33:55Z", "updated_at": "2019-12-18T20:50:38Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "I have a crate that has too deep impl-parameterized traits used with dyn dispatch under async context.\r\nI was running `cargo bench` so opt level was 3. Lowered to 2, didn't work either.\r\nLowering codegen-units also doesn't prevent ICE.\r\nCode was basically thrown from here:\r\n```\r\npub async fn get_stuff(&self, opts: Options) -> Result<(), oneshot::Canceled> {\r\n    ....\r\n    Ok(join_all(receivers).map(|_| ()).await)\r\n}\r\n```\r\n\r\nICE output is below:\r\n```\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /rustc/6d77e45f01079fe3d40180b3e256e414ab379f63/src/libcore/macros/mod.rs:15:40\r\nstack backtrace:\r\n   0:        0x10f8c7ee5 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h9927a5acb00f5b46\r\n   1:        0x10f8fec00 - core::fmt::write::h716e97fa61c74d22\r\n   2:        0x10f8bb76b - std::io::Write::write_fmt::h9ed933cdc2bbdebe\r\n   3:        0x10f8cc2f3 - std::panicking::default_hook::{{closure}}::h5a4a3929a87e54d2\r\n   4:        0x10f8cbffa - std::panicking::default_hook::hf3d2407dcbb15ec2\r\n   5:        0x110324412 - rustc_driver::report_ice::hdd639ffbf10ba844\r\n   6:        0x10f8ccaec - std::panicking::rust_panic_with_hook::hcd2edad9d6bc8993\r\n   7:        0x10f8cc589 - rust_begin_unwind\r\n   8:        0x10f8f82ac - core::panicking::panic_fmt::h3fe087d29d29b34b\r\n   9:        0x10f8f8204 - core::panicking::panic::hcd0b1c112a9c77fe\r\n  10:        0x110812110 - rustc_typeck::check::typeck_tables_of::h36d92f46d5ae3c1b\r\n  11:        0x1109c345b - rustc::ty::query::__query_compute::typeck_tables_of::hf934a8cd1195bb63\r\n  12:        0x1109163eb - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::hc5c7f184e1838be8\r\n  13:        0x1108bd77b - rustc::dep_graph::graph::DepGraph::with_task_impl::hc9704b526fd49f63\r\n  14:        0x11096b127 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hac3830ab2ceb8097\r\n  15:        0x111d2f25b - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::hc5c7f184e1838be8\r\n  16:        0x111867f74 - rustc::dep_graph::graph::DepGraph::with_task_impl::ha1ae721dcad2cd74\r\n  17:        0x111c1ede6 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h790b2c7f68da386f\r\n  18:        0x111748d2b - rustc::traits::error_reporting::<impl rustc::infer::InferCtxt>::note_obligation_cause::h96f5ff5a50e020fa\r\n  19:        0x11174473a - rustc::traits::error_reporting::<impl rustc::infer::InferCtxt>::report_selection_error::hd8cb3d7cba90514a\r\n  20:        0x1117357d7 - rustc::traits::error_reporting::<impl rustc::infer::InferCtxt>::report_fulfillment_errors::h95718fd70769c192\r\n  21:        0x110823776 - rustc_typeck::check::FnCtxt::check_argument_types::h861105bc2ba9b5f4\r\n  22:        0x11080c134 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt>::confirm_builtin_call::ha05b073544338f3b\r\n  23:        0x11080a423 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt>::check_call::h3d469ef388db6ccf\r\n  24:        0x1107ef01c - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::h5f8b04bffbb9867b\r\n  25:        0x1107ee3d7 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::haede1aa672ab7050\r\n  26:        0x11082392e - rustc_typeck::check::FnCtxt::check_argument_types::h861105bc2ba9b5f4\r\n  27:        0x11080c134 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt>::confirm_builtin_call::ha05b073544338f3b\r\n  28:        0x11080a423 - rustc_typeck::check::callee::<impl rustc_typeck::check::FnCtxt>::check_call::h3d469ef388db6ccf\r\n  29:        0x1107ef01c - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::h5f8b04bffbb9867b\r\n  30:        0x1107ee3d7 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::haede1aa672ab7050\r\n  31:        0x1108260b6 - rustc_typeck::check::FnCtxt::check_decl_initializer::h520c4c9f63c065dc\r\n  32:        0x110826176 - rustc_typeck::check::FnCtxt::check_decl_local::hae7f5225236e0932\r\n  33:        0x1108264fa - rustc_typeck::check::FnCtxt::check_stmt::h9ab1686db542efae\r\n  34:        0x110826d8c - rustc_typeck::check::FnCtxt::check_block_with_expected::h340b4fbad9be816a\r\n  35:        0x1107ef033 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_kind::h5f8b04bffbb9867b\r\n  36:        0x1107ee3d7 - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_expr_with_expectation_and_needs::haede1aa672ab7050\r\n  37:        0x1107f8ece - rustc_typeck::check::expr::<impl rustc_typeck::check::FnCtxt>::check_return_expr::he97d9780391aa9a5\r\n  38:        0x1108131df - rustc_typeck::check::check_fn::h4643092eb2ac19bb\r\n  39:        0x11099b4fb - rustc::ty::context::tls::with_context::{{closure}}::hda1f439a7d7a1388\r\n  40:        0x110811f40 - rustc_typeck::check::typeck_tables_of::h36d92f46d5ae3c1b\r\n  41:        0x1109c345b - rustc::ty::query::__query_compute::typeck_tables_of::hf934a8cd1195bb63\r\n  42:        0x1109163eb - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::hc5c7f184e1838be8\r\n  43:        0x1108bd77b - rustc::dep_graph::graph::DepGraph::with_task_impl::hc9704b526fd49f63\r\n  44:        0x11096b127 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hac3830ab2ceb8097\r\n  45:        0x110912cd0 - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::hfb26fdcc159c27c1\r\n  46:        0x110811945 - rustc_typeck::check::typeck_item_bodies::h88ecdccf3a3f79a6\r\n  47:        0x1109c3863 - rustc::ty::query::__query_compute::typeck_item_bodies::h7dc7f2b69a66b0ad\r\n  48:        0x1108c1dfd - rustc::dep_graph::graph::DepGraph::with_task_impl::hf52238fad90fa207\r\n  49:        0x1109588aa - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h7892f3f2ec6f606c\r\n  50:        0x1109cc845 - rustc_typeck::check_crate::hd092b7253fc55ed7\r\n  51:        0x1104578b8 - rustc_interface::passes::analysis::hc9bb48837b8e270b\r\n  52:        0x1102c10bf - rustc::ty::query::__query_compute::analysis::hb8b2237fc608cad1\r\n  53:        0x1103082f7 - rustc::dep_graph::graph::DepGraph::with_task_impl::h8cc6d5ec60201fc1\r\n  54:        0x11032b276 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h7c4340e59461ffc8\r\n  55:        0x1102dcd77 - rustc::ty::context::tls::enter_global::h14cc9ee028e4b749\r\n  56:        0x1102ed4d8 - rustc_interface::interface::run_compiler_in_existing_thread_pool::h099840c4405dc1be\r\n  57:        0x1102c45c4 - std::thread::local::LocalKey<T>::with::h77e521599e158fc2\r\n  58:        0x1102beb62 - scoped_tls::ScopedKey<T>::set::h5add591ec6de4a50\r\n  59:        0x11032f575 - syntax::with_globals::h32042b85526bf9e5\r\n  60:        0x11033100d - std::sys_common::backtrace::__rust_begin_short_backtrace::h743524a8ee09f50d\r\n  61:        0x10f8dc25f - __rust_maybe_catch_panic\r\n  62:        0x1102d4077 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h71052d92588be69f\r\n  63:        0x10f8add2e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h70de9d2b021f9bb9\r\n  64:        0x10f8daf9e - std::sys::unix::thread::Thread::new::thread_start::h5a035c16b89d62cd\r\n  65:     0x7fff6711dd36 - _pthread_start\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.41.0-nightly (6d77e45f0 2019-12-04) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C opt-level=2\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [typeck_tables_of] processing `XXXX`\r\n#1 [typeck_tables_of] processing `XXXX{{closure}}#0`\r\n#2 [typeck_tables_of] processing `get_stuff`\r\n#3 [typeck_item_bodies] type-checking all item bodies\r\n#4 [analysis] running analysis passes on this crate\r\nend of query stack\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67401/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67401/timeline", "performed_via_github_app": null, "state_reason": null}