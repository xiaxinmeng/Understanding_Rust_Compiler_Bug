{"url": "https://api.github.com/repos/rust-lang/rust/issues/7527", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7527/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7527/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7527/events", "html_url": "https://github.com/rust-lang/rust/issues/7527", "id": 16217587, "node_id": "MDU6SXNzdWUxNjIxNzU4Nw==", "number": 7527, "title": "ICE: Compiler crashes during match on enum.", "user": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2013-07-01T14:44:58Z", "updated_at": "2013-07-16T07:35:33Z", "closed_at": "2013-07-11T11:03:37Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Sorry for the unspecific title but I could not narrow it done much further myself. The error message does not give a particular reason for the crash:\n\n```\ncompile_and_link: x86_64-unknown-linux-gnu/stage0/lib/rustc/x86_64-unknown-linux-gnu/lib/librustc.so\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\n```\n\nThe offending code looks very innocent:\n\n``` rust\n// in middle/trans/debuginfo.rs\nfn create_enum_type(cx: &mut CrateContext, enum_type: ty::t) -> DIType {\n\n    let repr = adt::represent_type(cx, enum_type);\n\n    match *repr {\n        adt::CEnum(*) => (), // Without this line, the ICE does not occur.\n        _ => ()\n    }\n\n    return create_unimpl_ty(cx, enum_type);\n}\n```\n\nI tried to build a minimal example that causes the bug but the error does not seem to occur in simple one-file-examples. I ran rustc under gdb (as suggested by jdm) which gave the following backtrace:\n\n```\n(gdb) backtrace\n#0  rust_task_fail (task=0x7fffec206700, expr=0x7ffff6a24900 <str46663> \"struct variant kinds unimpl in enum_variants\", \n    file=0x7ffff6a22d70 <str43718> \"/home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/librustc/middle/ty.rs\", line=4001)\n    at /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_task.cpp:90\n#1  0x00007ffff5fb7991 in __morestack () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustrt.so\n#2  0x00007ffff5fa9766 in call_on_c_stack (fn_ptr=0x7ffff5fa8700 <upcall_s_fail(s_fail_args*)>, args=0x7ffff2f2ab20, this=0x7fffec206700)\n    at /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_task.h:484\n#3  call_upcall_on_c_stack (fn_ptr=0x7ffff5fa8700 <upcall_s_fail(s_fail_args*)>, args=0x7ffff2f2ab20, task=<optimized out>)\n    at /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_upcall.cpp:51\n#4  upcall_fail (expr=<optimized out>, file=0x7ffff6a22d70 <str43718> \"/home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/librustc/middle/ty.rs\", line=4001)\n    at /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_upcall.cpp:134\n#5  0x00007ffff78b7954 in sys::begin_unwind_::_89e154cd0915671::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#6  0x00007ffff78b7ab2 in sys::__extensions__::fail_with::anon::anon::expr_fn_22321 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#7  0x00007ffff78b7591 in str::as_buf_22312::_f8c6f4a6f9cb738::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#8  0x00007ffff78b7a6c in sys::__extensions__::fail_with::anon::expr_fn_22319 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#9  0x00007ffff78b7591 in str::as_buf_22312::_f8c6f4a6f9cb738::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#10 0x00007ffff781f5e4 in sys::__extensions__::meth_10910::fail_with::_db4c44d01ce4116::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#11 0x00007ffff651e638 in middle::ty::enum_variants::anon::expr_fn_46658 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#12 0x00007ffff62fce7b in middle::ty::enum_variants::_407653a2de1a99e::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#13 0x00007ffff6384107 in middle::ty::enum_variant_with_id::_a5c062cbed4f5e3f::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#14 0x00007ffff65b66d5 in middle::typeck::check::_match::check_pat_variant::_852febe08815e777::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#15 0x00007ffff65b1d8e in middle::typeck::check::_match::check_pat::_d898e8a974c05dde::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#16 0x00007ffff65ac040 in middle::typeck::check::_match::check_match::_5ab547d9408883ef::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#17 0x00007ffff66567f0 in middle::typeck::check::check_expr_with_unifier::_9669b8d4e7c569fc::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#18 0x00007ffff65afd41 in middle::typeck::check::check_expr_has_type::_c215b8c213dcd16::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#19 0x00007ffff6671b82 in middle::typeck::check::check_stmt::_513f15cae6c42cd7::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#20 0x00007ffff6630e5a in middle::typeck::check::check_block_with_expected::_2754828d55c92f7a::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#21 0x00007ffff662fc11 in middle::typeck::check::check_fn::_791b2ba4eb4954d::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#22 0x00007ffff662e3fb in middle::typeck::check::check_bare_fn::_e813fe72aa13b5ef::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#23 0x00007ffff662d86b in middle::typeck::check::check_item::_6117ebd159b5e52b::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#24 0x00007ffff662d3b1 in middle::typeck::check::check_item_types::anon::expr_fn_56451 ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#25 0x00007ffff6fafb13 in visit::mk_simple_visitor::anon::expr_fn_18826 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#26 0x00007ffff6f82bc5 in visit::visit_mod_15705::_dcae3b4d2918559::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#27 0x00007ffff6faf47b in visit::mk_simple_visitor::anon::expr_fn_18815 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#28 0x00007ffff6f8376d in visit::visit_item_15803::_253e6a618d13ee88::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#29 0x00007ffff6fafb2d in visit::mk_simple_visitor::anon::expr_fn_18826 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#30 0x00007ffff6f82bc5 in visit::visit_mod_15705::_dcae3b4d2918559::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#31 0x00007ffff6faf47b in visit::mk_simple_visitor::anon::expr_fn_18815 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#32 0x00007ffff6f8376d in visit::visit_item_15803::_253e6a618d13ee88::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#33 0x00007ffff6fafb2d in visit::mk_simple_visitor::anon::expr_fn_18826 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#34 0x00007ffff6f82bc5 in visit::visit_mod_15705::_dcae3b4d2918559::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#35 0x00007ffff6faf47b in visit::mk_simple_visitor::anon::expr_fn_18815 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#36 0x00007ffff6f8376d in visit::visit_item_15803::_253e6a618d13ee88::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#37 0x00007ffff6fafb2d in visit::mk_simple_visitor::anon::expr_fn_18826 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#38 0x00007ffff6f82bc5 in visit::visit_mod_15705::_dcae3b4d2918559::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#39 0x00007ffff6faf47b in visit::mk_simple_visitor::anon::expr_fn_18815 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libsyntax-9c7e57a146ef6bf1-0.7-pre.so\n#40 0x00007ffff645e5af in visit::visit_crate_36172::_fc583e46af3e4cce::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#41 0x00007ffff662d177 in middle::typeck::check::check_item_types::_638c8e928c5a75d::_07pre ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#42 0x00007ffff674d050 in util::common::time_64074::_ca7a0b06553c34::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n---Type <return> to continue, or q <return> to quit---\n#43 0x00007ffff674b939 in middle::typeck::check_crate::_26e0ee666c766a42::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#44 0x00007ffff69dc2dc in driver::driver::compile_rest::_56166fb9107c34f1::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#45 0x00007ffff69df66f in driver::driver::compile_upto::_d59cf2fff90872::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#46 0x00007ffff69dfa25 in driver::driver::compile_input::_54deb49bebfdba53::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#47 0x00007ffff69fe3ab in run_compiler::_47d776cb9d5e738::_07pre () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#48 0x00007ffff6a17f5e in main::anon::expr_fn_98726 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#49 0x00007ffff6a158ad in monitor::anon::expr_fn_98552 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#50 0x00007ffff6a0cb8b in task::__extensions__::try_97434::anon::expr_fn_97954 () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#51 0x00007ffff6a18258 in __morestack () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/librustc-ec14752a4b1d63-0.7-pre.so\n#52 0x00007ffff7886b08 in task::spawn::spawn_raw_oldsched::make_child_wrapper::anon::expr_fn_18707 ()\n   from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#53 0x00007ffff790965c in __morestack () from /home/mw/rust/x86_64-unknown-linux-gnu/stage0/bin/../lib/libstd-6c65cf4b443341b1-0.7-pre.so\n#54 0x00007ffff5fa7dc2 in task_start_wrapper (a=0x7fffec2076c0) at /home/rustbuild/src/rust-buildbot/slave/snap3-linux/build/src/rt/rust_task.cpp:165\n#55 0x0000000000000000 in ?? ()\n```\n\nThe error seems to occur in `ty::enum_variants()`. I created a branch on my Rust fork which exhibits the bug:\nhttps://github.com/michaelwoerister/rust/tree/adt_repr_ice\n\nI'll post here if I find out anything more useful.\n", "closed_by": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7527/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7527/timeline", "performed_via_github_app": null, "state_reason": "completed"}