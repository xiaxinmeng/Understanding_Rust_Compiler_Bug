{"url": "https://api.github.com/repos/rust-lang/rust/issues/50286", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50286/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50286/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50286/events", "html_url": "https://github.com/rust-lang/rust/issues/50286", "id": 318470873, "node_id": "MDU6SXNzdWUzMTg0NzA4NzM=", "number": 50286, "title": "Panic implementing Hash using using impl Trait in argument positions", "user": {"login": "maciej-irl", "id": 2553960, "node_id": "MDQ6VXNlcjI1NTM5NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/2553960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maciej-irl", "html_url": "https://github.com/maciej-irl", "followers_url": "https://api.github.com/users/maciej-irl/followers", "following_url": "https://api.github.com/users/maciej-irl/following{/other_user}", "gists_url": "https://api.github.com/users/maciej-irl/gists{/gist_id}", "starred_url": "https://api.github.com/users/maciej-irl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maciej-irl/subscriptions", "organizations_url": "https://api.github.com/users/maciej-irl/orgs", "repos_url": "https://api.github.com/users/maciej-irl/repos", "events_url": "https://api.github.com/users/maciej-irl/events{/privacy}", "received_events_url": "https://api.github.com/users/maciej-irl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-04-27T16:22:32Z", "updated_at": "2018-04-28T11:18:46Z", "closed_at": "2018-04-28T11:18:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "When implementing the Hash trait using impl Trait in argument positions the compiler panics.\r\n\r\n```rust\r\nuse std::hash::{Hash, Hasher};\r\n\r\nstruct Foo;\r\n\r\nimpl Hash for Foo {\r\n    fn hash(&self, s: &mut impl Hasher) { }\r\n}\r\n```\r\n\r\nThe excepted error is:\r\n\r\n```rust\r\nerror[E0643]: method `zots` has incompatible signature for trait\r\n  --> src/main.rs:10:28\r\n   |\r\n6  |     fn zots<B: Barer>(&self, s: &mut B);\r\n   |             - annotation in trait\r\n...\r\n10 |     fn zots(&self, s: &mut impl Barer) { }   \r\n   |                            ^^^^^^^^^^ annotation in impl\r\n```\r\n\r\nwhich can be reproduced using:\r\n\r\n```rust\r\nstruct Foo;\r\n\r\ntrait Barer { }\r\n\r\ntrait Bar {\r\n    fn zots<B: Barer>(&self, s: &mut B);\r\n}\r\n\r\nimpl Bar for Foo {\r\n    fn zots(&self, s: &mut impl Barer) { }   \r\n}\r\n```\r\n\r\nI tried to reproducing it outside of the Hash trait but to no avail. I'm using the latest (as of writing) nightly.\r\n\r\n### Compiler Version\r\n```\r\nrustc 1.27.0-nightly (7f3444e1b 2018-04-26)\r\nbinary: rustc\r\ncommit-hash: 7f3444e1baf0d335b4bf379f845dbc28cdd0509c\r\ncommit-date: 2018-04-26\r\nhost: x86_64-apple-darwin\r\nrelease: 1.27.0-nightly\r\nLLVM version: 6.0\r\n```\r\n\r\n### Backtrace\r\n\r\n```\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', libcore/option.rs:335:21\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n   1: std::sys_common::backtrace::print\r\n   2: std::panicking::default_hook::{{closure}}\r\n   3: std::panicking::default_hook\r\n   4: rustc::util::common::panic_hook\r\n   5: std::panicking::rust_panic_with_hook\r\n   6: std::panicking::begin_panic_fmt\r\n   7: rust_begin_unwind\r\n   8: core::panicking::panic_fmt\r\n   9: core::panicking::panic\r\n  10: rustc_typeck::check::compare_method::compare_impl_method\r\n  11: rustc_typeck::check::check_item_type\r\n  12: rustc::hir::Crate::visit_all_item_likes\r\n  13: rustc::util::common::time\r\n  14: rustc_typeck::check_crate\r\n  15: rustc::ty::context::tls::enter_context\r\n  16: <std::thread::local::LocalKey<T>>::with\r\n  17: rustc::ty::context::TyCtxt::create_and_enter\r\n  18: rustc_driver::driver::compile_input\r\n  19: rustc_driver::run_compiler_impl\r\n  20: syntax::with_globals\r\n  21: rustc_driver::run\r\n  22: rustc_driver::main\r\n  23: std::rt::lang_start::{{closure}}\r\n  24: std::panicking::try::do_call\r\n  25: __rust_maybe_catch_panic\r\n  26: std::rt::lang_start_internal\r\n  27: main\r\nquery stack during panic:\r\nend of query stack\r\n```", "closed_by": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50286/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50286/timeline", "performed_via_github_app": null, "state_reason": "completed"}