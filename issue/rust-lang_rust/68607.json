{"url": "https://api.github.com/repos/rust-lang/rust/issues/68607", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68607/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68607/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68607/events", "html_url": "https://github.com/rust-lang/rust/issues/68607", "id": 556347989, "node_id": "MDU6SXNzdWU1NTYzNDc5ODk=", "number": 68607, "title": "\"memory allocation of _ bytes failed\" when compiling certain crates", "user": {"login": "nwn", "id": 5771789, "node_id": "MDQ6VXNlcjU3NzE3ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/5771789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nwn", "html_url": "https://github.com/nwn", "followers_url": "https://api.github.com/users/nwn/followers", "following_url": "https://api.github.com/users/nwn/following{/other_user}", "gists_url": "https://api.github.com/users/nwn/gists{/gist_id}", "starred_url": "https://api.github.com/users/nwn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nwn/subscriptions", "organizations_url": "https://api.github.com/users/nwn/orgs", "repos_url": "https://api.github.com/users/nwn/repos", "events_url": "https://api.github.com/users/nwn/events{/privacy}", "received_events_url": "https://api.github.com/users/nwn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-28T17:08:05Z", "updated_at": "2020-01-28T20:50:39Z", "closed_at": "2020-01-28T17:09:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "When trying to compile Rocket as a dependency on nightly, the build intermittently fails after making a large allocation, typically of about 34GB.\r\n\r\nIn the process, the system memory usage quickly reaches capacity and then the error occurs after a few seconds.\r\n\r\nPossibly related: rust-lang/cargo#7840\r\n\r\n## Reproduction\r\nRun `cargo.exe new rocket_test`.\r\nAdd `rocket = \"0.4\"` as a dependency to `Cargo.toml`.\r\nRun `cargo.exe build` on nightly.\r\n\r\n## Meta\r\n**System**\r\nWindows 10\r\n16GB RAM\r\n\r\n**Rustc version**\r\n```\r\n$ rustc.exe --version --verbose\r\nrustc 1.42.0-nightly (8a79d08fa 2020-01-27)\r\nbinary: rustc\r\ncommit-hash: 8a79d08fa57e1c257d647c9848e35defcb379c07\r\ncommit-date: 2020-01-27\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.42.0-nightly\r\nLLVM version: 9.0\r\n```\r\n\r\n**Cargo output**\r\n```\r\n$ cargo.exe --verbose build\r\n       Fresh unicode-xid v0.1.0\r\n       Fresh version_check v0.1.5\r\n       Fresh smallvec v1.1.0\r\n       Fresh matches v0.1.8\r\n       Fresh yansi v0.4.0\r\n       Fresh cc v1.0.50\r\n       Fresh cfg-if v0.1.10\r\n       Fresh percent-encoding v1.0.1\r\n       Fresh version_check v0.9.1\r\n       Fresh autocfg v1.0.0\r\n       Fresh safemem v0.3.3\r\n       Fresh yansi v0.5.0\r\n       Fresh untrusted v0.6.2\r\n       Fresh language-tags v0.2.2\r\n       Fresh typeable v0.1.2\r\n       Fresh traitobject v0.1.0\r\n       Fresh state v0.4.1\r\n       Fresh unicode-normalization v0.1.12\r\n       Fresh unicode-bidi v0.3.4\r\n   Compiling ring v0.13.5\r\n     Running `rustc --crate-name build_script_build C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\ring-0.13.5\\build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" --cf\r\ng \"feature=\\\"dev_urandom_fallback\\\"\" --cfg \"feature=\\\"use_heap\\\"\" -C metadata=1a15ad6c82b60c04 -C extra-filename=-1a15ad6c82b60c04 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\build\\ring-1a15ad6c82b60c04 -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\dep\r\ns --extern cc=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libcc-946cf986cc7db055.rlib --cap-lints allow`\r\n   Compiling rocket_codegen v0.4.2\r\n   Compiling rocket v0.4.2\r\n   Compiling proc-macro2 v0.4.30\r\n   Compiling libc v0.2.66\r\n   Compiling byteorder v1.3.2\r\n     Running `rustc --crate-name build_script_build C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\rocket_codegen-0.4.2\\build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=284f14c65bf\r\n013fe -C extra-filename=-284f14c65bf013fe --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\build\\rocket_codegen-284f14c65bf013fe -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --extern version_check=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libve\r\nrsion_check-8db3cc685504e6bd.rlib --extern yansi=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libyansi-6a6e593e43fda685.rlib --cap-lints allow`\r\n     Running `rustc --crate-name build_script_build C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\rocket-0.4.2\\build.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" --c\r\nfg \"feature=\\\"private-cookies\\\"\" -C metadata=f3930abe81925812 -C extra-filename=-f3930abe81925812 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\build\\rocket-f3930abe81925812 -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --extern version_check=C:\\Use\r\nrs\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libversion_check-8db3cc685504e6bd.rlib --extern yansi=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libyansi-6a6e593e43fda685.rlib --cap-lints allow`\r\n     Running `rustc --crate-name proc_macro2 C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\proc-macro2-0.4.30\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 --cfg \"feat\r\nure=\\\"default\\\"\" --cfg \"feature=\\\"nightly\\\"\" --cfg \"feature=\\\"proc-macro\\\"\" -C metadata=c0ae366126deddd3 -C extra-filename=-c0ae366126deddd3 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --extern un\r\nicode_xid=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps\\libunicode_xid-8104dae258f2c7fd.rmeta --cap-lints allow --cfg u128 --cfg use_proc_macro --cfg wrap_proc_macro --cfg proc_macro_span`\r\n     Running `rustc --crate-name libc C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\libc-0.2.66\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 --cfg \"feature=\\\"default\\\r\n\"\" --cfg \"feature=\\\"std\\\"\" -C metadata=99fc6d3d0ed157f9 -C extra-filename=-99fc6d3d0ed157f9 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --cap-lints allow --cfg freebsd11 --cfg libc_priv_mod_use --\r\ncfg libc_union --cfg libc_const_size_of --cfg libc_align --cfg libc_core_cvoid --cfg libc_packedN`\r\n   Compiling winapi v0.3.8\r\n     Running `rustc --crate-name byteorder C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\byteorder-1.3.2\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 --cfg \"feature=\\\r\n\"default\\\"\" --cfg \"feature=\\\"std\\\"\" -C metadata=8e0e2ef74f6e6b59 -C extra-filename=-8e0e2ef74f6e6b59 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --cap-lints allow --cfg byteorder_i128`\r\n     Running `rustc --crate-name winapi C:\\Users\\Nathan\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\winapi-0.3.8\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi,artifacts --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 --cfg \"feature=\\\"conso\r\nleapi\\\"\" --cfg \"feature=\\\"minwinbase\\\"\" --cfg \"feature=\\\"minwindef\\\"\" --cfg \"feature=\\\"ntdef\\\"\" --cfg \"feature=\\\"processenv\\\"\" --cfg \"feature=\\\"profileapi\\\"\" --cfg \"feature=\\\"std\\\"\" --cfg \"feature=\\\"sysinfoapi\\\"\" --cfg \"feature=\\\"timezoneapi\\\"\" --cfg \"feature=\\\"winbase\\\"\" -\r\nC metadata=219eb773078db546 -C extra-filename=-219eb773078db546 --out-dir C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps -L dependency=C:\\Users\\Nathan\\Desktop\\rocket\\target\\debug\\deps --cap-lints allow --cfg \"feature=\\\"wincontypes\\\"\" --cfg \"feature=\\\"excpt\\\"\" --cfg \"featu\r\nre=\\\"cfgmgr32\\\"\" --cfg \"feature=\\\"wincon\\\"\" --cfg \"feature=\\\"basetsd\\\"\" --cfg \"feature=\\\"devpropdef\\\"\" --cfg \"feature=\\\"wingdi\\\"\" --cfg \"feature=\\\"ktmtypes\\\"\" --cfg \"feature=\\\"vcruntime\\\"\" --cfg \"feature=\\\"cfg\\\"\" --cfg \"feature=\\\"winnt\\\"\" --cfg \"feature=\\\"libloaderapi\\\"\" --\r\ncfg \"feature=\\\"guiddef\\\"\" --cfg \"feature=\\\"winreg\\\"\" --cfg \"feature=\\\"vadefs\\\"\" --cfg \"feature=\\\"windef\\\"\" --cfg \"feature=\\\"processthreadsapi\\\"\" --cfg \"feature=\\\"ntstatus\\\"\" --cfg \"feature=\\\"fileapi\\\"\" -l dylib=advapi32 -l dylib=cfgmgr32 -l dylib=gdi32 -l dylib=kernel32 -l\r\ndylib=msimg32 -l dylib=opengl32 -l dylib=user32 -l dylib=winspool`\r\n   Compiling idna v0.1.5\r\nmemory allocation of 36641439744 bytes failed\r\n```", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68607/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68607/timeline", "performed_via_github_app": null, "state_reason": "completed"}