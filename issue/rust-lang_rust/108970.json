{"url": "https://api.github.com/repos/rust-lang/rust/issues/108970", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/108970/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/108970/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/108970/events", "html_url": "https://github.com/rust-lang/rust/issues/108970", "id": 1618555858, "node_id": "I_kwDOAAsO6M5geTPS", "number": 108970, "title": "Stable fails to build a crate: trimmed_def_paths constructed but no error emitted; use `DelayDm` for lints or `with_no_trimmed_paths` for debugging", "user": {"login": "wiktor-k", "id": 1718963, "node_id": "MDQ6VXNlcjE3MTg5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/1718963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wiktor-k", "html_url": "https://github.com/wiktor-k", "followers_url": "https://api.github.com/users/wiktor-k/followers", "following_url": "https://api.github.com/users/wiktor-k/following{/other_user}", "gists_url": "https://api.github.com/users/wiktor-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/wiktor-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wiktor-k/subscriptions", "organizations_url": "https://api.github.com/users/wiktor-k/orgs", "repos_url": "https://api.github.com/users/wiktor-k/repos", "events_url": "https://api.github.com/users/wiktor-k/events{/privacy}", "received_events_url": "https://api.github.com/users/wiktor-k/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2023-03-10T08:23:11Z", "updated_at": "2023-03-27T06:40:36Z", "closed_at": "2023-03-27T06:40:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\nhow to create smaller examples.\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\n-->\n\nHi,\n\nOne of my dependencies fails to build on the stable. I've [reported this](https://github.com/rust-lang/rust/issues/104257#issuecomment-1453410017) when the compiler was in beta.\n\n### Code\n\nThe simplest way to reproduce is just to install the crate (for reproducibility here shown in docker):\n\n```\n$ docker run --rm -it rust\n\n// install crate's native dependencies\n$ apt update && apt install -y clang llvm pkg-config nettle-dev libpcsclite-dev\n\n$ cargo version\ncargo 1.68.0 (115f34552 2023-02-26)\n\n$ cargo install openpgp-card-tools\nCompiling pest_derive v2.5.6\nerror: internal compiler error: no warnings or errors encountered even though `delayed_good_path_bugs` issued\n...\n```\n\n\n### Meta\n<!--\nIf you're using the stable version of the compiler, you should also check if the\nbug also exists in the beta or nightly versions.\n-->\n\n`cargo +nightly install openpgp-card-tools` succeeds (after installing nightly toolchains with `rustup toolchain add nightly`).\n\n`rustc --version --verbose`:\n```\nrustc 1.68.0 (2c8cc3432 2023-03-06)\nbinary: rustc\ncommit-hash: 2c8cc343237b8f7d5a3c3703e3a87f2eb2c54a74\ncommit-date: 2023-03-06\nhost: x86_64-unknown-linux-gnu\nrelease: 1.68.0\nLLVM version: 15.0.6\n```\n\n### Error output\n\n```\nerror: internal compiler error: no warnings or errors encountered even though `delayed_good_path_bugs` issued\n\nerror: internal compiler error: trimmed_def_paths constructed but no error emitted; use `DelayDm` for lints or `with_no_trimmed_paths` for debugging\n  |\n  = note: delayed at    0: <rustc_errors::Handler>::delay_good_path_bug::<&str>\n             1: rustc_middle::ty::print::pretty::trimmed_def_paths\n             2: rustc_query_system::query::plumbing::try_execute_query::<rustc_query_impl::queries::trimmed_def_paths, rustc_query_impl::plumbing::QueryCtxt>\n             3: rustc_query_system::query::plumbing::get_query::<rustc_query_impl::queries::trimmed_def_paths, rustc_query_impl::plumbing::QueryCtxt, rustc_middle::dep_graph::dep_node::DepKind>\n             4: <rustc_middle::ty::print::pretty::FmtPrinter as rustc_middle::ty::print::Printer>::print_def_path\n             5: <rustc_middle::ty::print::pretty::FmtPrinter as rustc_middle::ty::print::Printer>::print_def_path\n             6: <rustc_middle::ty::print::pretty::FmtPrinter as rustc_middle::ty::print::pretty::PrettyPrinter>::in_binder::<rustc_middle::ty::sty::ExistentialTraitRef>\n             7: <rustc_middle::ty::sty::Binder<rustc_middle::ty::sty::ExistentialTraitRef> as core::fmt::Display>::fmt\n             8: <rustc_lint::BuiltinCombinedModuleLateLintPass as rustc_lint::passes::LateLintPass>::check_item\n             9: rustc_hir::intravisit::walk_mod::<rustc_lint::late::LateContextAndPass<rustc_lint::BuiltinCombinedModuleLateLintPass>>\n            10: rustc_lint::late::late_lint_mod::<rustc_lint::BuiltinCombinedModuleLateLintPass>\n            11: rustc_lint::lint_mod\n            12: rustc_query_system::query::plumbing::try_execute_query::<rustc_query_impl::queries::lint_mod, rustc_query_impl::plumbing::QueryCtxt>\n            13: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::lint_mod\n            14: rustc_data_structures::sync::par_for_each_in::<&[rustc_hir::hir_id::OwnerId], <rustc_middle::hir::map::Map>::par_for_each_module<rustc_lint::late::check_crate<rustc_lint::BuiltinCombinedLateLintPass, rustc_interface::passes::analysis::{closure#5}::{closure#1}::{closure#2}::{closure#0}::{closure#0}>::{closure#1}::{closure#0}::{closure#0}>::{closure#0}>\n            15: <rustc_session::session::Session>::time::<(), rustc_lint::late::check_crate<rustc_lint::BuiltinCombinedLateLintPass, rustc_interface::passes::analysis::{closure#5}::{closure#1}::{closure#2}::{closure#0}::{closure#0}>::{closure#1}::{closure#0}>\n            16: <rustc_session::session::Session>::time::<(), rustc_interface::passes::analysis::{closure#5}::{closure#1}::{closure#2}::{closure#0}>\n            17: <core::panic::unwind_safe::AssertUnwindSafe<rustc_interface::passes::analysis::{closure#5}::{closure#1}> as core::ops::function::FnOnce<()>>::call_once\n            18: <rustc_session::session::Session>::time::<(), rustc_interface::passes::analysis::{closure#5}>\n            19: rustc_interface::passes::analysis\n            20: rustc_query_system::query::plumbing::try_execute_query::<rustc_query_impl::queries::analysis, rustc_query_impl::plumbing::QueryCtxt>\n            21: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::analysis\n            22: <rustc_interface::passes::QueryContext>::enter::<rustc_driver::run_compiler::{closure#1}::{closure#2}::{closure#2}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\n            23: rustc_span::with_source_map::<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_interface::interface::run_compiler<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_driver::run_compiler::{closure#1}>::{closure#0}::{closure#0}>\n            24: <scoped_tls::ScopedKey<rustc_span::SessionGlobals>>::set::<rustc_interface::interface::run_compiler<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_driver::run_compiler::{closure#1}>::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\n            25: std::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface::util::run_in_thread_pool_with_globals<rustc_interface::interface::run_compiler<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_driver::run_compiler::{closure#1}>::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>::{closure#0}::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>\n            26: <<std::thread::Builder>::spawn_unchecked_<rustc_interface::util::run_in_thread_pool_with_globals<rustc_interface::interface::run_compiler<core::result::Result<(), rustc_errors::ErrorGuaranteed>, rustc_driver::run_compiler::{closure#1}>::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>::{closure#0}::{closure#0}, core::result::Result<(), rustc_errors::ErrorGuaranteed>>::{closure#1} as core::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\n            27: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\n                       at /rustc/2c8cc343237b8f7d5a3c3703e3a87f2eb2c54a74/library/alloc/src/boxed.rs:1988:9\n            28: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\n                       at /rustc/2c8cc343237b8f7d5a3c3703e3a87f2eb2c54a74/library/alloc/src/boxed.rs:1988:9\n            29: std::sys::unix::thread::Thread::new::thread_start\n                       at /rustc/2c8cc343237b8f7d5a3c3703e3a87f2eb2c54a74/library/std/src/sys/unix/thread.rs:108:17\n            30: start_thread\n            31: clone\n          \n\nnote: the compiler unexpectedly panicked. this is a bug.\n\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\n\nnote: rustc 1.68.0 (2c8cc3432 2023-03-06) running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: --crate-type lib -C opt-level=3 -C embed-bitcode=no -C codegen-units=1\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\nerror: could not compile `openpgp-card`\nwarning: build failed, waiting for other jobs to finish...\n```\n\n(Backtrace is the same so I omitted it)\n\nThanks for help! :wave: \n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"reez12g\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "wiktor-k", "id": 1718963, "node_id": "MDQ6VXNlcjE3MTg5NjM=", "avatar_url": "https://avatars.githubusercontent.com/u/1718963?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wiktor-k", "html_url": "https://github.com/wiktor-k", "followers_url": "https://api.github.com/users/wiktor-k/followers", "following_url": "https://api.github.com/users/wiktor-k/following{/other_user}", "gists_url": "https://api.github.com/users/wiktor-k/gists{/gist_id}", "starred_url": "https://api.github.com/users/wiktor-k/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wiktor-k/subscriptions", "organizations_url": "https://api.github.com/users/wiktor-k/orgs", "repos_url": "https://api.github.com/users/wiktor-k/repos", "events_url": "https://api.github.com/users/wiktor-k/events{/privacy}", "received_events_url": "https://api.github.com/users/wiktor-k/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/108970/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/108970/timeline", "performed_via_github_app": null, "state_reason": "completed"}