{"url": "https://api.github.com/repos/rust-lang/rust/issues/110717", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/110717/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/110717/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/110717/events", "html_url": "https://github.com/rust-lang/rust/issues/110717", "id": 1679979322, "node_id": "I_kwDOAAsO6M5kInM6", "number": 110717, "title": "Regression: `.format` from `itertools` started runtime panicking with rustc 1.71.0", "user": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "lukas-code", "id": 26522220, "node_id": "MDQ6VXNlcjI2NTIyMjIw", "avatar_url": "https://avatars.githubusercontent.com/u/26522220?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lukas-code", "html_url": "https://github.com/lukas-code", "followers_url": "https://api.github.com/users/lukas-code/followers", "following_url": "https://api.github.com/users/lukas-code/following{/other_user}", "gists_url": "https://api.github.com/users/lukas-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/lukas-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lukas-code/subscriptions", "organizations_url": "https://api.github.com/users/lukas-code/orgs", "repos_url": "https://api.github.com/users/lukas-code/repos", "events_url": "https://api.github.com/users/lukas-code/events{/privacy}", "received_events_url": "https://api.github.com/users/lukas-code/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "lukas-code", "id": 26522220, "node_id": "MDQ6VXNlcjI2NTIyMjIw", "avatar_url": "https://avatars.githubusercontent.com/u/26522220?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lukas-code", "html_url": "https://github.com/lukas-code", "followers_url": "https://api.github.com/users/lukas-code/followers", "following_url": "https://api.github.com/users/lukas-code/following{/other_user}", "gists_url": "https://api.github.com/users/lukas-code/gists{/gist_id}", "starred_url": "https://api.github.com/users/lukas-code/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lukas-code/subscriptions", "organizations_url": "https://api.github.com/users/lukas-code/orgs", "repos_url": "https://api.github.com/users/lukas-code/repos", "events_url": "https://api.github.com/users/lukas-code/events{/privacy}", "received_events_url": "https://api.github.com/users/lukas-code/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2023-04-23T10:57:51Z", "updated_at": "2023-04-28T06:32:00Z", "closed_at": "2023-04-28T06:32:00Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Code\r\n\r\nI tried this code:\r\n\r\n```rust\r\nuse itertools::Itertools;\r\nfn main() {\r\n    let mut v = Vec::new();\r\n    v.push(\"foo\");\r\n    assert!(\r\n        v.is_empty(),\r\n        \"{}\",\r\n        v.iter().format(\", \"),\r\n    );\r\n}\r\n```\r\n\r\n[Playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=b3f2e9bb3ea1013edde8c1320637ac74)\r\n\r\nI expected to see this happen: No panic during runtime\r\n\r\nInstead, this happened: Panicked during runtime\r\n\r\n<details>\r\n\r\n<summary>Format: was already formatted once</summary>\r\n\r\n```\r\nthread 'main' panicked at 'thread 'main' panicked at 'Format: was already formatted once', /playground/.cargo/registry/src/index.crates.io-6f17d22bba15001f/itertools-0.10.5/src/format.rs:81:21\r\nstack backtrace:\r\n   0:     0x55575722e373 - std::backtrace_rs::backtrace::libunwind::trace::hb9265895128f1f9c\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/../../backtrace/src/backtrace/libunwind.rs:93:5\r\n   1:     0x55575722e373 - std::backtrace_rs::backtrace::trace_unsynchronized::h028901cb3a0224b1\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x55575722e373 - std::sys_common::backtrace::_print_fmt::hfa5c37f64d314fee\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:65:5\r\n   3:     0x55575722e373 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h5b30f1684e8bd3e6\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:44:22\r\n   4:     0x55575724982f - core::fmt::write::h997ecd0e22e2af7a\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/fmt/mod.rs:1247:17\r\n   5:     0x55575722c621 - std::io::Write::write_fmt::h291317e85b978e13\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/io/mod.rs:1698:15\r\n   6:     0x55575722e185 - std::sys_common::backtrace::_print::h0133b24def7b99d9\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:47:5\r\n   7:     0x55575722e185 - std::sys_common::backtrace::print::h4a42174c7f3bd207\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:34:9\r\n   8:     0x55575722f4ff - std::panicking::default_hook::{{closure}}::h0847452fe926d6e5\r\n   9:     0x55575722f1b7 - std::panicking::default_hook::hbcdd7833994c05d0\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:293:9\r\n  10:     0x55575722fa21 - std::panicking::rust_panic_with_hook::hb55c52c8e21298f0\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:700:13\r\n  11:     0x555757215394 - std::panicking::begin_panic::{{closure}}::hb08efbb470f664d6\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:624:9\r\n  12:     0x5557572152bd - std::sys_common::backtrace::__rust_end_short_backtrace::hbf8634da0334b4e2\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:150:18\r\n  13:     0x555757215307 - std::panicking::begin_panic::h61b21b87c2e55e8f\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:623:12\r\n  14:     0x555757214cdb - itertools::format::Format<I>::format::heb0f74abc06f4991\r\n                               at /playground/.cargo/registry/src/index.crates.io-6f17d22bba15001f/itertools-0.10.5/src/format.rs:81:21\r\n  15:     0x5557572149b3 - <itertools::format::Format<I> as core::fmt::Display>::fmt::h064530a6ea8ffcbf\r\n                               at /playground/.cargo/registry/src/index.crates.io-6f17d22bba15001f/itertools-0.10.5/src/format.rs:105:21\r\n  16:     0x55575724982f - core::fmt::write::h997ecd0e22e2af7a\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/fmt/mod.rs:1247:17\r\n  17:     0x55575724982f - core::fmt::write::h997ecd0e22e2af7a\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/fmt/mod.rs:1247:17\r\n  18:     0x55575722c621 - std::io::Write::write_fmt::h291317e85b978e13\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/io/mod.rs:1698:15\r\n  19:     0x55575722f3b3 - std::panicking::default_hook::{{closure}}::h0847452fe926d6e5\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:255:21\r\n  20:     0x55575722f1b7 - std::panicking::default_hook::hbcdd7833994c05d0\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:293:9\r\n  21:     0x55575722fa21 - std::panicking::rust_panic_with_hook::hb55c52c8e21298f0\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:700:13\r\n  22:     0x55575722f913 - std::panicking::begin_panic_handler::{{closure}}::h51ad0ee3ee1b4d02\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:595:13\r\n  23:     0x55575722e7b6 - std::sys_common::backtrace::__rust_end_short_backtrace::hd1006853c72eedaf\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:150:18\r\n  24:     0x55575722f612 - rust_begin_unwind\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:584:5\r\n  25:     0x555757212ed3 - core::panicking::panic_fmt::h0405aceea833a54b\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/panicking.rs:67:14\r\n  26:     0x555757213f7f - core::panicking::panic_display::he369e4705b14dda4\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/panicking.rs:150:5\r\n  27:     0x555757215201 - playground::main::hed8c86f138364518\r\n                               at /playground/src/main.rs:5:5\r\n  28:     0x5557572137db - core::ops::function::FnOnce::call_once::hbebd13fb81ee85e2\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/ops/function.rs:250:5\r\n  29:     0x5557572134ee - std::sys_common::backtrace::__rust_begin_short_backtrace::h8be5514a066de9a8\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/sys_common/backtrace.rs:134:18\r\n  30:     0x555757213561 - std::rt::lang_start::{{closure}}::h283d7d606f728596\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/rt.rs:166:18\r\n  31:     0x55575722a432 - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once::ha628a292c7e4d1fe\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/core/src/ops/function.rs:284:13\r\n  32:     0x55575722a432 - std::panicking::try::do_call::haef2b0ee78305734\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:490:40\r\n  33:     0x55575722a432 - std::panicking::try::h18b79ccaa1dcd46e\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:454:19\r\n  34:     0x55575722a432 - std::panic::catch_unwind::h44fa38099b98dbce\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panic.rs:140:14\r\n  35:     0x55575722a432 - std::rt::lang_start_internal::{{closure}}::h90d1d020380fa86c\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/rt.rs:148:48\r\n  36:     0x55575722a432 - std::panicking::try::do_call::h96eb402652927015\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:490:40\r\n  37:     0x55575722a432 - std::panicking::try::h9ac5ba472c3806a8\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panicking.rs:454:19\r\n  38:     0x55575722a432 - std::panic::catch_unwind::ha6f72383b6160344\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/panic.rs:140:14\r\n  39:     0x55575722a432 - std::rt::lang_start_internal::hc00ff9425137690f\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/rt.rs:148:20\r\n  40:     0x55575721353a - std::rt::lang_start::hf0c3703aafa2e063\r\n                               at /rustc/b628260df0587ae559253d8640ecb8738d3de613/library/std/src/rt.rs:165:17\r\n  41:     0x55575721523e - main\r\n  42:     0x7f45f2cf9083 - __libc_start_main\r\n  43:     0x55575721340e - _start\r\n  44:                0x0 - <unknown>\r\nthread panicked while panicking. aborting.\r\ntimeout: the monitored command dumped core\r\n```\r\n\r\n</details>\r\n\r\n### Version it worked on\r\n\r\n<!--\r\nProvide the most recent version this worked on, for example:\r\n\r\nIt most recently worked on: Rust 1.47\r\n-->\r\n\r\nIt most recently worked on: Rust 1.70 (beta) and Rust 1.69 (stable)\r\n\r\n### Version with regression\r\n\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.71.0-nightly (b628260df 2023-04-22)\r\nbinary: rustc\r\ncommit-hash: b628260df0587ae559253d8640ecb8738d3de613\r\ncommit-date: 2023-04-22\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.71.0-nightly\r\nLLVM version: 16.0.2\r\n```\r\n\r\n### Backtrace\r\n\r\nNone\r\n\r\n## Other\r\n\r\nI also reported this here https://github.com/rust-itertools/itertools/issues/694, but I think this one is on `rustc`.\r\n\r\n@m-ou-se assigning you, because I suspect this has something to do with recent `format_args!` changes.\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/110717/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/110717/timeline", "performed_via_github_app": null, "state_reason": "completed"}