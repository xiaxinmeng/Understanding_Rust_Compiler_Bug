{"url": "https://api.github.com/repos/rust-lang/rust/issues/112171", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/112171/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/112171/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/112171/events", "html_url": "https://github.com/rust-lang/rust/issues/112171", "id": 1735910692, "node_id": "I_kwDOAAsO6M5nd-Uk", "number": 112171, "title": "Cargo 1.71.0-beta.1 produces a buggy build of the Helix text editor (since `dfe3188`)", "user": {"login": "tricjury70", "id": 133672211, "node_id": "U_kgDOB_etEw", "avatar_url": "https://avatars.githubusercontent.com/u/133672211?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tricjury70", "html_url": "https://github.com/tricjury70", "followers_url": "https://api.github.com/users/tricjury70/followers", "following_url": "https://api.github.com/users/tricjury70/following{/other_user}", "gists_url": "https://api.github.com/users/tricjury70/gists{/gist_id}", "starred_url": "https://api.github.com/users/tricjury70/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tricjury70/subscriptions", "organizations_url": "https://api.github.com/users/tricjury70/orgs", "repos_url": "https://api.github.com/users/tricjury70/repos", "events_url": "https://api.github.com/users/tricjury70/events{/privacy}", "received_events_url": "https://api.github.com/users/tricjury70/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-06-01T09:47:10Z", "updated_at": "2023-06-04T15:11:09Z", "closed_at": "2023-06-01T19:10:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am just a newbie playing with the awesome language and text editor, so I sorry that I can't point out the exact code that causes this.\r\nHelix text editors built with beta and nightly rust toolchains crash easily. In stable this does not happen.\r\nGiven the very strong assurances of stability of Rust, I felt it appropriate to report this bug to rustc rather than helix.\r\n\r\n### How to Reproduce\r\n1. Run the following in your shell\r\n```bash\r\ngit clone https://github.com/helix-editor/helix.git\r\ncd helix\r\nln -s $PWD/runtime ~/.config/helix/runtime\r\ncargo +beta run -- --tutor\r\n```\r\n2. Type `ii`. (Like Vim, it means switch to insert mode and insert `i`.)\r\n3. Crash\r\n<details><summary>Helix's Backtrace</summary>\r\n<p>\r\n\r\n```\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.22s\r\n     Running `target/debug/hx --tutor`\r\nthread 'tokio-runtime-worker' panicked at 'entered unreachable code', /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/smallvec-1.10.0/src/lib.rs:510:18\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panicking.rs:593:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/panicking.rs:67:14\r\n   2: core::panicking::panic\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/panicking.rs:117:5\r\n   3: smallvec::SmallVecData<A>::heap\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/smallvec-1.10.0/src/lib.rs:510:18\r\n   4: smallvec::SmallVec<A>::triple\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/smallvec-1.10.0/src/lib.rs:756:34\r\n   5: <smallvec::SmallVec<A> as core::ops::deref::Deref>::deref\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/smallvec-1.10.0/src/lib.rs:1547:33\r\n   6: <smallvec::SmallVec<A> as core::convert::AsRef<[<A as smallvec::Array>::Item]>>::as_ref\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/smallvec-1.10.0/src/lib.rs:1566:9\r\n   7: ropey::tree::node_text::inner::NodeSmallString::as_str\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/tree/node_text.rs:292:47\r\n   8: <ropey::tree::node_text::NodeText as core::ops::deref::Deref>::deref\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/tree/node_text.rs:175:9\r\n   9: ropey::tree::node::Node::leaf_text\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/tree/node.rs:630:13\r\n  10: ropey::iter::Chunks::new_with_range_at_byte\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/iter.rs:1371:25\r\n  11: ropey::iter::Chunks::new_with_range\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/iter.rs:1314:9\r\n  12: ropey::slice::RopeSlice::chunks\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/slice.rs:864:19\r\n  13: <ropey::slice::RopeSlice as core::cmp::PartialEq<ropey::slice::RopeSlice>>::eq\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.0/src/slice.rs:1800:31\r\n  14: imara_diff::intern::Interner<T>::intern::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/imara-diff-0.1.5/src/intern.rs:128:58\r\n  15: hashbrown::raw::inner::RawTable<T,A>::find::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.12.3/src/raw/mod.rs:817:13\r\n  16: hashbrown::raw::inner::RawTableInner<A>::find_inner\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.12.3/src/raw/mod.rs:1179:27\r\n  17: hashbrown::raw::inner::RawTable<T,A>::find\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.12.3/src/raw/mod.rs:816:22\r\n  18: hashbrown::raw::inner::RawTable<T,A>::get\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/hashbrown-0.12.3/src/raw/mod.rs:831:15\r\n  19: imara_diff::intern::Interner<T>::intern\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/imara-diff-0.1.5/src/intern.rs:128:31\r\n  20: imara_diff::intern::InternedInput<T>::update_after::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/imara-diff-0.1.5/src/intern.rs:85:45\r\n  21: core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &mut F>::call_once\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/ops/function.rs:305:13\r\n  22: core::option::Option<T>::map\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/option.rs:1075:29\r\n  23: <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::next\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/iter/adapters/map.rs:103:26\r\n  24: alloc::vec::Vec<T,A>::extend_desugared\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/alloc/src/vec/mod.rs:2811:35\r\n  25: <alloc::vec::Vec<T,A> as alloc::vec::spec_extend::SpecExtend<T,I>>::spec_extend\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/alloc/src/vec/spec_extend.rs:17:9\r\n  26: <alloc::vec::Vec<T,A> as core::iter::traits::collect::Extend<T>>::extend\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/alloc/src/vec/mod.rs:2785:9\r\n  27: imara_diff::intern::InternedInput<T>::update_after\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/imara-diff-0.1.5/src/intern.rs:85:9\r\n  28: helix_vcs::diff::line_cache::InternedRopeLines::update_doc_impl\r\n             at ./helix-vcs/src/diff/line_cache.rs:113:9\r\n  29: helix_vcs::diff::line_cache::InternedRopeLines::update_doc\r\n             at ./helix-vcs/src/diff/line_cache.rs:81:13\r\n  30: helix_vcs::diff::worker::DiffWorker::run::{{closure}}::{{closure}}\r\n             at ./helix-vcs/src/diff/worker.rs:57:21\r\n  31: tokio::runtime::context::exit_runtime\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/context.rs:418:9\r\n  32: tokio::runtime::scheduler::multi_thread::worker::block_in_place\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:356:9\r\n  33: tokio::task::blocking::block_in_place\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/task/blocking.rs:78:9\r\n  34: helix_vcs::diff::worker::DiffWorker::run::{{closure}}\r\n             at ./helix-vcs/src/diff/worker.rs:71:13\r\n  35: tokio::runtime::task::core::Core<T,S>::poll::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/core.rs:223:17\r\n  36: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/loom/std/unsafe_cell.rs:14:9\r\n  37: tokio::runtime::task::core::Core<T,S>::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/core.rs:212:13\r\n  38: tokio::runtime::task::harness::poll_future::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:476:19\r\n  39: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/panic/unwind_safe.rs:271:9\r\n  40: std::panicking::try::do_call\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panicking.rs:500:40\r\n  41: __rust_try\r\n  42: std::panicking::try\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panicking.rs:464:19\r\n  43: std::panic::catch_unwind\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panic.rs:142:14\r\n  44: tokio::runtime::task::harness::poll_future\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:464:18\r\n  45: tokio::runtime::task::harness::Harness<T,S>::poll_inner\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:198:27\r\n  46: tokio::runtime::task::harness::Harness<T,S>::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:152:15\r\n  47: tokio::runtime::task::raw::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/raw.rs:255:5\r\n  48: tokio::runtime::task::raw::RawTask::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/raw.rs:200:18\r\n  49: tokio::runtime::task::LocalNotified<S>::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/mod.rs:394:9\r\n  50: tokio::runtime::scheduler::multi_thread::worker::Context::run_task::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:464:13\r\n  51: tokio::runtime::coop::with_budget\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/coop.rs:107:5\r\n  52: tokio::runtime::coop::budget\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/coop.rs:73:5\r\n  53: tokio::runtime::scheduler::multi_thread::worker::Context::run_task\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:463:9\r\n  54: tokio::runtime::scheduler::multi_thread::worker::Context::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:426:24\r\n  55: tokio::runtime::scheduler::multi_thread::worker::run::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:406:17\r\n  56: tokio::macros::scoped_tls::ScopedKey<T>::set\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/macros/scoped_tls.rs:61:9\r\n  57: tokio::runtime::scheduler::multi_thread::worker::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:403:5\r\n  58: tokio::runtime::scheduler::multi_thread::worker::Launch::launch::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/scheduler/multi_thread/worker.rs:365:45\r\n  59: <tokio::runtime::blocking::task::BlockingTask<T> as core::future::future::Future>::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/blocking/task.rs:42:21\r\n  60: tokio::runtime::task::core::Core<T,S>::poll::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/core.rs:223:17\r\n  61: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/loom/std/unsafe_cell.rs:14:9\r\n  62: tokio::runtime::task::core::Core<T,S>::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/core.rs:212:13\r\n  63: tokio::runtime::task::harness::poll_future::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:476:19\r\n  64: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/core/src/panic/unwind_safe.rs:271:9\r\n  65: std::panicking::try::do_call\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panicking.rs:500:40\r\n  66: __rust_try\r\n  67: std::panicking::try\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panicking.rs:464:19\r\n  68: std::panic::catch_unwind\r\n             at /rustc/eff24c06d8f4397802b546aa2e52450e1022fc02/library/std/src/panic.rs:142:14\r\n  69: tokio::runtime::task::harness::poll_future\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:464:18\r\n  70: tokio::runtime::task::harness::Harness<T,S>::poll_inner\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:198:27\r\n  71: tokio::runtime::task::harness::Harness<T,S>::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/harness.rs:152:15\r\n  72: tokio::runtime::task::raw::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/raw.rs:255:5\r\n  73: tokio::runtime::task::raw::RawTask::poll\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/raw.rs:200:18\r\n  74: tokio::runtime::task::UnownedTask<S>::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/task/mod.rs:431:9\r\n  75: tokio::runtime::blocking::pool::Task::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/blocking/pool.rs:159:9\r\n  76: tokio::runtime::blocking::pool::Inner::run\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/blocking/pool.rs:513:17\r\n  77: tokio::runtime::blocking::pool::Spawner::spawn_thread::{{closure}}\r\n             at /home/ubuntu-latest/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.28.2/src/runtime/blocking/pool.rs:471:13\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Version with regression\r\n\r\nsearched nightlies: from nightly-2023-04-14 to nightly-2023-05-26\r\nregressed nightly: nightly-2023-05-09\r\nsearched commit range: https://github.com/rust-lang/rust/compare/c4190f2d3a46a59f435f7b42f58bc22b2f4d6917...2f2c438dce75d8cc532c3baa849eeddc0901802c\r\nregressed commit: https://github.com/rust-lang/rust/commit/dfe31889e10e36eed53327d1ca624fbf21b475a5\r\n\r\n<details>\r\n<summary>bisected with <a href='https://github.com/rust-lang/cargo-bisect-rustc'>cargo-bisect-rustc</a> v0.6.6</summary>\r\n\r\nHost triple: x86_64-unknown-linux-gnu\r\nReproduce with:\r\n```bash\r\ncargo bisect-rustc --prompt --start=2023-04-14 --end=2023-05-26\r\n```\r\n</details>\r\n\r\n@rustbot modify labels: +regression-from-stable-to-beta -regression-untriaged", "closed_by": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/112171/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/112171/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}