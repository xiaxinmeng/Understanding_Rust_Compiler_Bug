{"url": "https://api.github.com/repos/rust-lang/rust/issues/44365", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/44365/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/44365/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/44365/events", "html_url": "https://github.com/rust-lang/rust/issues/44365", "id": 255559855, "node_id": "MDU6SXNzdWUyNTU1NTk4NTU=", "number": 44365, "title": "Reloading a dylib stops working when moving from 1.19.0 to 1.20.0", "user": {"login": "Ryan1729", "id": 2133026, "node_id": "MDQ6VXNlcjIxMzMwMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2133026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ryan1729", "html_url": "https://github.com/Ryan1729", "followers_url": "https://api.github.com/users/Ryan1729/followers", "following_url": "https://api.github.com/users/Ryan1729/following{/other_user}", "gists_url": "https://api.github.com/users/Ryan1729/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ryan1729/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ryan1729/subscriptions", "organizations_url": "https://api.github.com/users/Ryan1729/orgs", "repos_url": "https://api.github.com/users/Ryan1729/repos", "events_url": "https://api.github.com/users/Ryan1729/events{/privacy}", "received_events_url": "https://api.github.com/users/Ryan1729/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 45472092, "node_id": "MDU6TGFiZWw0NTQ3MjA5Mg==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-ffi", "name": "A-ffi", "color": "f7e101", "default": false, "description": "Area: Foreign Function Interface (FFI)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 39, "created_at": "2017-09-06T10:44:21Z", "updated_at": "2017-10-26T20:49:21Z", "closed_at": "2017-10-26T08:58:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have been writing programs which check if a dynamic library's modification time has changed and reload it if so. This allows me to interact with the program, producing transient state but then make changes to the dynamic libraries code and load it to see the result of the changes on the transient state without closing the program. \r\n\r\nThis feature of my programs has stopped working since I updated to 1.20.0. If I switch back to 1.19.0 with `rustup default 1.19.0` then it works again. Switching back with `rustup default stable` breaks it again.\r\n\r\nI've made a small example program that does the lib reloading which you can see [here](https://github.com/Ryan1729/tiny-live-code-example). On 1.19.0 if I launch the program and change, say, [this line](https://github.com/Ryan1729/tiny-live-code-example/blob/master/state_manipulation/src/lib.rs#L14) to something like `state.counter += 1000;` and rebuild the dynamic library, (or just the whole crate,) the running version of the program will eventually notice the different modification time and start incrementing the counter by 1000 instead of 1. On 1.20.0 this no longer works. On [this branch](https://github.com/Ryan1729/tiny-live-code-example/tree/show_modification_time) in particular you can see that the new modification time is noticed and the library reloading code is run but it doesn't do anything.\r\n\r\nLooking through [the patch notes](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1200-2017-08-31) for 1.20.0 I noticed that [`ManuallyDrop`](https://doc.rust-lang.org/std/mem/union.ManuallyDrop.html) had been stabilized. So I tried using it in [this branch](https://github.com/Ryan1729/tiny-live-code-example/tree/manually_drop) but it didn't cause any (noticeable) change in behaviour, (besides compile errors on 1.19.0 of course.)", "closed_by": {"login": "Ryan1729", "id": 2133026, "node_id": "MDQ6VXNlcjIxMzMwMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2133026?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ryan1729", "html_url": "https://github.com/Ryan1729", "followers_url": "https://api.github.com/users/Ryan1729/followers", "following_url": "https://api.github.com/users/Ryan1729/following{/other_user}", "gists_url": "https://api.github.com/users/Ryan1729/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ryan1729/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ryan1729/subscriptions", "organizations_url": "https://api.github.com/users/Ryan1729/orgs", "repos_url": "https://api.github.com/users/Ryan1729/repos", "events_url": "https://api.github.com/users/Ryan1729/events{/privacy}", "received_events_url": "https://api.github.com/users/Ryan1729/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/44365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/44365/timeline", "performed_via_github_app": null, "state_reason": "completed"}