{"url": "https://api.github.com/repos/rust-lang/rust/issues/79567", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79567/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79567/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79567/events", "html_url": "https://github.com/rust-lang/rust/issues/79567", "id": 753576902, "node_id": "MDU6SXNzdWU3NTM1NzY5MDI=", "number": 79567, "title": "Library builds fail when path contains a percent char (%)", "user": {"login": "nospam3089", "id": 75258959, "node_id": "MDQ6VXNlcjc1MjU4OTU5", "avatar_url": "https://avatars.githubusercontent.com/u/75258959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nospam3089", "html_url": "https://github.com/nospam3089", "followers_url": "https://api.github.com/users/nospam3089/followers", "following_url": "https://api.github.com/users/nospam3089/following{/other_user}", "gists_url": "https://api.github.com/users/nospam3089/gists{/gist_id}", "starred_url": "https://api.github.com/users/nospam3089/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nospam3089/subscriptions", "organizations_url": "https://api.github.com/users/nospam3089/orgs", "repos_url": "https://api.github.com/users/nospam3089/repos", "events_url": "https://api.github.com/users/nospam3089/events{/privacy}", "received_events_url": "https://api.github.com/users/nospam3089/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1568663381, "node_id": "MDU6TGFiZWwxNTY4NjYzMzgx", "url": "https://api.github.com/repos/rust-lang/rust/labels/ICEBreaker-LLVM", "name": "ICEBreaker-LLVM", "color": "74cc28", "default": false, "description": "Bugs identified for the LLVM ICE-breaker group"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-11-30T15:32:21Z", "updated_at": "2021-04-16T05:41:27Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I have read [CONTRIBUTING.md](https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md) as well as [the contributing guidelines](https://rustc-dev-guide.rust-lang.org/contributing.html#contributing-to-rust). Searching for ['%'](https://github.com/rust-lang/rust/issues?q=is%3Aissue+%25) and ['percent'](https://github.com/rust-lang/rust/issues?q=is%3Aissue+percent) does not seem to lead to any relevant existing issues. From my understanding of `man cargo`, `man cargo-build` and [The Cargo Book](https://doc.rust-lang.org/cargo/), they do not make it obvious that restrictions like these should be imposed. Neither does `man rustc` seem to state that the `%`-character should be treated special in any way.\r\n\r\nI tried this code:\r\n\r\n```sh\r\nmkdir -p '%/foo'\r\ncd '%/foo'\r\ncargo init --lib\r\ncargo build\r\n```\r\n\r\n```\r\n   Compiling foo v0.1.0 (/%/foo)\r\n     Running `rustc --crate-name foo --edition=2018 src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 -C metadata=bed926cd50182e06 -C extra-filename=-bed926cd50182e06 --out-dir '/%/foo/target/debug/deps' -C 'incremental=/%/foo/target/debug/incremental' -L 'dependency=/%/foo/target/debug/deps'`\r\nerror: failed to build archive: No such file or directory\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `foo`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name foo --edition=2018 src/lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C embed-bitcode=no -C debuginfo=2 -C metadata=bed926cd50182e06 -C extra-filename=-bed926cd50182e06 --out-dir '/%/foo/target/debug/deps' -C 'incremental=/%/foo/target/debug/incremental' -L 'dependency=/%/foo/target/debug/deps'` (exit code: 1)\r\n% \r\n```\r\n\r\nI expected to see this happen: A successful build, comparable to if doing\r\n\r\n```sh\r\nmkdir -p '%/bar'\r\ncd '%/bar'\r\ncargo init --bin\r\ncargo build --verbose\r\n```\r\n\r\n```\r\ncargo build\r\n   Compiling bar v0.1.0 (/%/bar)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.65s\r\n% \r\n```\r\n\r\nInstead, this happened: The build fails, whenever the actual directory or any parent contains at least one percent character. I can only speculate on why, but it would be likely to assume some tool upon which rustc depends treats percent characters as special, and that rustc is missing some escaping which should be performed.\r\n\r\nFor what its worth, this was found due to it causing real issues with our specific use of a fairly common continuous integration system. We can work around it, but it would be great if the need for such mitigation could be removed.\r\n\r\n### Meta\r\nThis applies to 1.47.0, 1.48.0 as well as 1.50.0-nightly (bfca1cd22 2020-11-24), on at least linux and illumos.\r\n\r\n`uname -srvmpio; rustc --version --verbose`:\r\n```\r\nSunOS 5.11 omnios-r151030-58b4169e77 i86pc i386 i86pc illumos\r\nrustc 1.48.0\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: x86_64-unknown-illumos\r\nrelease: 1.48.0\r\nLLVM version: 11.0\r\n```\r\n\r\n`uname -srvmpio; rustc +nightly --version --verbose`:\r\n```\r\nLinux 5.9.0-1-amd64 #1 SMP Debian 5.9.1-1 (2020-10-17) x86_64 unknown unknown GNU/Linux\r\ncargo +nightly --verbose --version\r\ncargo 1.50.0-nightly (bfca1cd22 2020-11-24)\r\nrelease: 1.50.0\r\ncommit-hash: bfca1cd22bf514d5f2b6c1089b0ded0ba7dfaa6e\r\ncommit-date: 2020-11-24\r\n```\r\n\r\n### Backtrace\r\n<p>\r\n\r\n```\r\nN/A Build fails.\r\n```\r\n\r\n</p>", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79567/timeline", "performed_via_github_app": null, "state_reason": null}