{"url": "https://api.github.com/repos/rust-lang/rust/issues/81895", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81895/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81895/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81895/events", "html_url": "https://github.com/rust-lang/rust/issues/81895", "id": 803978836, "node_id": "MDU6SXNzdWU4MDM5Nzg4MzY=", "number": 81895, "title": "Why does panicking in a Drop impl cause SIGILL?", "user": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 2352122097, "node_id": "MDU6TGFiZWwyMzUyMTIyMDk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-discussion", "name": "C-discussion", "color": "f5f1fd", "default": false, "description": "Category: Discussion or questions that doesn't represent real issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 23, "created_at": "2021-02-08T21:21:01Z", "updated_at": "2023-04-26T15:56:38Z", "closed_at": "2023-04-26T15:56:38Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Why does this code trigger a SIGILL when run? I think what's happening is the\r\nfirst element is dropped, which causes a panic, and then the second element is\r\ndropped, which causes another panic. But why does that cause SIGILL?\r\n\r\nMy understanding from #53814 is that this is expected behavior (not a bug), but\r\nI'm curious why it happens. I would think if anything it would trigger a\r\nSIGABRT.\r\n\r\n#### code\r\n\r\n([playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=3e5353eb44709e8a8364367ade09d3b8))\r\n\r\n```rust\r\nstruct Foo(Vec<u8>);\r\n\r\nimpl Drop for Foo {\r\n    fn drop(&mut self) {\r\n        panic!()\r\n    }\r\n}\r\n\r\nfn main() {\r\n    let foos = vec![Foo(vec![]), Foo(vec![1, 2, 3])];\r\n}\r\n```\r\n\r\n#### stderr\r\n\r\n```\r\n   Compiling playground v0.0.1 (/playground)\r\nwarning: unused variable: `foos`\r\n  --> src/main.rs:10:9\r\n   |\r\n10 |     let foos = vec![Foo(vec![]), Foo(vec![1, 2, 3])];\r\n   |         ^^^^ help: if this is intentional, prefix it with an underscore: `_foos`\r\n   |\r\n   = note: `#[warn(unused_variables)]` on by default\r\n\r\nwarning: 1 warning emitted\r\n\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.83s\r\n     Running `target/debug/playground`\r\nthread 'main' panicked at 'explicit panic', src/main.rs:5:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nthread 'main' panicked at 'explicit panic', src/main.rs:5:9\r\nstack backtrace:\r\n   0:     0x561934642290 - std::backtrace_rs::backtrace::libunwind::trace::h04d12fdcddff82aa\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/../../backtrace/src/backtrace/libunwind.rs:100:5\r\n   1:     0x561934642290 - std::backtrace_rs::backtrace::trace_unsynchronized::h1459b974b6fbe5e1\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x561934642290 - std::sys_common::backtrace::_print_fmt::h9b8396a669123d95\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:67:5\r\n   3:     0x561934642290 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::he009dcaaa75eed60\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:46:22\r\n   4:     0x56193465b18c - core::fmt::write::h77b4746b0dea1dd3\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/fmt/mod.rs:1078:17\r\n   5:     0x5619346407a2 - std::io::Write::write_fmt::heb7e50902e98831c\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/io/mod.rs:1518:15\r\n   6:     0x5619346443f5 - std::sys_common::backtrace::_print::h2d880c9e69a21be9\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:49:5\r\n   7:     0x5619346443f5 - std::sys_common::backtrace::print::h5f02b1bb49f36879\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:36:9\r\n   8:     0x5619346443f5 - std::panicking::default_hook::{{closure}}::h658e288a7a809b29\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:208:50\r\n   9:     0x561934644098 - std::panicking::default_hook::hb52d73f0da9a4bb8\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:227:9\r\n  10:     0x561934644b31 - std::panicking::rust_panic_with_hook::hfe7e1c684e3e6462\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:593:17\r\n  11:     0x56193462e40a - std::panicking::begin_panic::{{closure}}::h614b3cbb40c6ac97\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:522:9\r\n  12:     0x56193462e1d8 - std::sys_common::backtrace::__rust_end_short_backtrace::h80519f17256a9add\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:141:18\r\n  13:     0x56193462e347 - std::panicking::begin_panic::h3645bdd6626a0ee3\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:521:12\r\n  14:     0x56193463102d - <playground::Foo as core::ops::drop::Drop>::drop::hce9ef5afe53ec370\r\n                               at /playground/src/main.rs:5:9\r\n  15:     0x56193462e682 - core::ptr::drop_in_place::h26876705d1b946dc\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/ptr/mod.rs:175:1\r\n  16:     0x56193462e780 - core::ptr::drop_in_place::h4b57af26293eab52\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/ptr/mod.rs:175:1\r\n  17:     0x561934630ca2 - <alloc::vec::Vec<T> as core::ops::drop::Drop>::drop::hb6788eaf6b5dc8d0\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/alloc/src/vec.rs:2595:13\r\n  18:     0x56193462e812 - core::ptr::drop_in_place::h77d15d17e0480110\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/ptr/mod.rs:175:1\r\n  19:     0x561934631126 - playground::main::h09e49a94267467fc\r\n                               at /playground/src/main.rs:11:1\r\n  20:     0x56193462e61b - core::ops::function::FnOnce::call_once::h5041d89337c06587\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/ops/function.rs:227:5\r\n  21:     0x56193462e20e - std::sys_common::backtrace::__rust_begin_short_backtrace::hf3c8a86706865b3d\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/sys_common/backtrace.rs:125:18\r\n  22:     0x56193462e2b1 - std::rt::lang_start::{{closure}}::hb426d5912cbdfebe\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/rt.rs:66:18\r\n  23:     0x561934644f57 - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once::h57e2a071d427b24c\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/core/src/ops/function.rs:259:13\r\n  24:     0x561934644f57 - std::panicking::try::do_call::h81cbbe0c3b30a28e\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:381:40\r\n  25:     0x561934644f57 - std::panicking::try::hbeeb95b4e1f0a876\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panicking.rs:345:19\r\n  26:     0x561934644f57 - std::panic::catch_unwind::h59c48ccb40a0bf20\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/panic.rs:396:14\r\n  27:     0x561934644f57 - std::rt::lang_start_internal::ha53ab63f88fee728\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/rt.rs:51:25\r\n  28:     0x56193462e287 - std::rt::lang_start::hb78caef74d29b421\r\n                               at /rustc/e1884a8e3c3e813aada8254edfa120e85bf5ffca/library/std/src/rt.rs:65:5\r\n  29:     0x5619346311aa - main\r\n  30:     0x7f173d6a50b3 - __libc_start_main\r\n  31:     0x56193462e09e - _start\r\n  32:                0x0 - <unknown>\r\nthread panicked while panicking. aborting.\r\ntimeout: the monitored command dumped core\r\n/playground/tools/entrypoint.sh: line 11:     7 Illegal instruction     timeout --signal=KILL ${timeout} \"$@\"\r\n```\r\n", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81895/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81895/timeline", "performed_via_github_app": null, "state_reason": "completed"}