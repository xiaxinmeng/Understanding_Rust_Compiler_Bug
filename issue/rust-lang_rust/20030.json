{"url": "https://api.github.com/repos/rust-lang/rust/issues/20030", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/20030/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/20030/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/20030/events", "html_url": "https://github.com/rust-lang/rust/issues/20030", "id": 52493847, "node_id": "MDU6SXNzdWU1MjQ5Mzg0Nw==", "number": 20030, "title": "ICE: Explicit deref of non-derefable type: _", "user": {"login": "Munksgaard", "id": 230613, "node_id": "MDQ6VXNlcjIzMDYxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/230613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Munksgaard", "html_url": "https://github.com/Munksgaard", "followers_url": "https://api.github.com/users/Munksgaard/followers", "following_url": "https://api.github.com/users/Munksgaard/following{/other_user}", "gists_url": "https://api.github.com/users/Munksgaard/gists{/gist_id}", "starred_url": "https://api.github.com/users/Munksgaard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Munksgaard/subscriptions", "organizations_url": "https://api.github.com/users/Munksgaard/orgs", "repos_url": "https://api.github.com/users/Munksgaard/repos", "events_url": "https://api.github.com/users/Munksgaard/events{/privacy}", "received_events_url": "https://api.github.com/users/Munksgaard/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2014-12-19T15:23:14Z", "updated_at": "2015-01-06T10:48:23Z", "closed_at": "2015-01-06T10:48:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code gives an ICE when compiled:\n\n``` rust\n#![feature(default_type_params)]\n\n// rustc 0.13.0-dev (4265e8684 2014-12-17 02:42:57 +0000)\n\nuse std::thunk::Invoke;\n\nfn foo(x: Box<for <'a>Invoke<&'a int, ()>>) {\n}\n\nfn main() {\n    foo( box () (move |: &_| () ))\n}\n```\n\nOutput:\n\n```\n$ RUST_BACKTRACE=1 rustc explicit-deref.rs \nexplicit-deref.rs:12:26: 12:28 error: internal compiler error: Explicit deref of non-derefable type: _\nexplicit-deref.rs:12     foo( box () (move |: &_| () ))\n                                              ^~\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' panicked at 'Box<Any>', /home/munksgaard/src/rust/src/libsyntax/diagnostic.rs:129\n\nstack backtrace:\n   1:     0x7f41e499fca0 - rt::backtrace::imp::write::hd4a9cfbe8082d91dzUx\n   2:     0x7f41e49a3070 - failure::on_fail::h26f370a0d22fbb17Xly\n   3:     0x7f41e45e2000 - unwind::begin_unwind_inner::h5ace27216ec1673faNc\n   4:     0x7f41e1d09670 - unwind::begin_unwind::h1054071810082905820\n   5:     0x7f41e1d095f0 - diagnostic::SpanHandler::span_bug::h30a4545ac7c98afaJBF\n   6:     0x7f41e28391f0 - session::Session::span_bug::h9a53e6550a58f741cPt\n   7:     0x7f41e3bbf8b0 - middle::mem_categorization::MemCategorizationContext<'t, TYPER>::cat_pattern::h10177201984355271765\n   8:     0x7f41e3bafb20 - check::regionck::link_pattern::h35a895da286f3895Ore\n   9:     0x7f41e3ba3400 - check::regionck::Rcx<'a, 'tcx>::visit_fn_body::hd1ee126d75f2aff4lQc\n  10:     0x7f41e3ba5e90 - check::regionck::visit_expr::ha321fc84257baab2Med\n  11:     0x7f41e3ba5e90 - check::regionck::visit_expr::ha321fc84257baab2Med\n  12:     0x7f41e3ba5e90 - check::regionck::visit_expr::ha321fc84257baab2Med\n  13:     0x7f41e3baefe0 - visit::walk_expr::h3435874749311967551\n  14:     0x7f41e3ba5e90 - check::regionck::visit_expr::ha321fc84257baab2Med\n  15:     0x7f41e3ba3400 - check::regionck::Rcx<'a, 'tcx>::visit_fn_body::hd1ee126d75f2aff4lQc\n  16:     0x7f41e3c5d620 - check::check_bare_fn::ha9618fa92c6d5d7aPak\n  17:     0x7f41e3c551b0 - check::check_item::ha0a6918c3b42e132fuk\n  18:     0x7f41e3eacf40 - check_crate::unboxed_closure.42721\n  19:     0x7f41e3ea7c50 - check_crate::hb8d06b5288aaca2cOXy\n  20:     0x7f41e4df3570 - driver::phase_3_run_analysis_passes::hb1a44959f8a27734Eta\n  21:     0x7f41e4dd6910 - driver::compile_input::h2b05d4d9b39fe45erba\n  22:     0x7f41e4f8aa60 - run_compiler::he30e6bab9642f5dcAYb\n  23:     0x7f41e4f816a0 - thunk::F.Invoke<A, R>::invoke::h7411267982134486946\n  24:     0x7f41e4978050 - thunk::F.Invoke<A, R>::invoke::h10640087870277716145\n  25:     0x7f41e45e0770 - task::Task::spawn_thunk::closure.5783\n  26:     0x7f41e463f990 - rust_try_inner\n  27:     0x7f41e463f980 - rust_try\n  28:     0x7f41e45e0880 - unwind::try::h79904bb3da835e1arCc\n  29:     0x7f41e45e0610 - task::Task::run::haabf090164d55ae3sNb\n  30:     0x7f41e45dfd80 - thunk::F.Invoke<A, R>::invoke::h9717026625883013397\n  31:     0x7f41e45e16d0 - thread::thread_start::hb74c10cb2e902108M4b\n  32:     0x7f41df3e4160 - <unknown>\n  33:     0x7f41e42bfc69 - __clone\n  34:                0x0 - <unknown>\n\n```\n\nVersion:\n\n```\n$ rustc --version\nrustc 0.13.0-dev (4265e8684 2014-12-17 02:42:57 +0000)\n```\n\nThis is likely related to #19919.\n", "closed_by": {"login": "Munksgaard", "id": 230613, "node_id": "MDQ6VXNlcjIzMDYxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/230613?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Munksgaard", "html_url": "https://github.com/Munksgaard", "followers_url": "https://api.github.com/users/Munksgaard/followers", "following_url": "https://api.github.com/users/Munksgaard/following{/other_user}", "gists_url": "https://api.github.com/users/Munksgaard/gists{/gist_id}", "starred_url": "https://api.github.com/users/Munksgaard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Munksgaard/subscriptions", "organizations_url": "https://api.github.com/users/Munksgaard/orgs", "repos_url": "https://api.github.com/users/Munksgaard/repos", "events_url": "https://api.github.com/users/Munksgaard/events{/privacy}", "received_events_url": "https://api.github.com/users/Munksgaard/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/20030/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/20030/timeline", "performed_via_github_app": null, "state_reason": "completed"}