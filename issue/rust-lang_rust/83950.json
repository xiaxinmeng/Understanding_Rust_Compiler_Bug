{"url": "https://api.github.com/repos/rust-lang/rust/issues/83950", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83950/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83950/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83950/events", "html_url": "https://github.com/rust-lang/rust/issues/83950", "id": 851840357, "node_id": "MDU6SXNzdWU4NTE4NDAzNTc=", "number": 83950, "title": "Different version in dev-dependencies and dependencies seems to cause a crash", "user": {"login": "Deisss", "id": 1627057, "node_id": "MDQ6VXNlcjE2MjcwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1627057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Deisss", "html_url": "https://github.com/Deisss", "followers_url": "https://api.github.com/users/Deisss/followers", "following_url": "https://api.github.com/users/Deisss/following{/other_user}", "gists_url": "https://api.github.com/users/Deisss/gists{/gist_id}", "starred_url": "https://api.github.com/users/Deisss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Deisss/subscriptions", "organizations_url": "https://api.github.com/users/Deisss/orgs", "repos_url": "https://api.github.com/users/Deisss/repos", "events_url": "https://api.github.com/users/Deisss/events{/privacy}", "received_events_url": "https://api.github.com/users/Deisss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 239393, "node_id": "MDU6TGFiZWwyMzkzOTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-resolve", "name": "A-resolve", "color": "f7e101", "default": false, "description": "Area: Path resolution"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-04-06T21:58:36Z", "updated_at": "2022-12-04T00:27:32Z", "closed_at": "2022-12-04T00:27:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\n\r\nFirst, feel free to close or something, it just said to report a bug but I'm not sure it should be reported...\r\n\r\nThe bug appears after changing Cargo.toml:\r\n\r\n```toml\r\n[dependencies]\r\nactix-web = \"4.0.0-beta.4\"\r\nactix-service = \"2.0.0-beta.5\"\r\n\r\n(...)\r\n\r\n[dev-dependencies]\r\nactix-http = \"2.2.0\"\r\nactix-rt = \"2.2.0\"\r\n```\r\n\r\nFailing to compile, but \"working\", and this is the one breaking it:\r\n```toml\r\n\r\n[dependencies]\r\nactix-web = \"4.0.0-beta.4\"\r\nactix-service = \"2.0.0-beta.5\"\r\n\r\n(...)\r\n\r\n[dev-dependencies]\r\nactix-service = \"1.0.6\"\r\nactix-http = \"2.2.0\"\r\nactix-rt = \"2.2.0\"\r\n```\r\n\r\nThe add of mismatched `actix-service` in dev-deps cause the crash,  the code hasn't changed in between (and was not compiling before and after of course so not sure it has any use).\r\n\r\nHere is the code just in case, but like said, wasn't compiling anyway:\r\n```Rust\r\n#[cfg(test)]\r\nmod tests {\r\n    use super::*;\r\n    use actix_web::test;\r\n    use actix_service::Service;\r\n    use actix_http::Request;\r\n\r\n    pub async fn unit_test_main() -> impl Service<Request> {\r\n        let _guard = logger::create_basic_logger_std_out_std_err(None);\r\n\r\n        // Parsing configuration\r\n        let settings = Settings::new();\r\n        if settings.is_err() {\r\n            crit!(\"Wrong configuration: {:?}\", settings.as_ref().err());\r\n        }\r\n        let config = settings.unwrap();\r\n        let port = config.port.clone();\r\n        let pool = create_config_from_settings(&config).create_pool(NoTls).unwrap();\r\n\r\n        let p = WebData {\r\n            config,\r\n            pool\r\n        };\r\n\r\n        test::init_service(\r\n            App::new()\r\n                .data(p.clone())\r\n                .service(\r\n                    web::resource(\"/convert\")\r\n                        .route(web::post().to(convert::convert))\r\n                )\r\n        ).await\r\n    }\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.50.0 (cb75ad5db 2021-02-10)\r\nbinary: rustc\r\ncommit-hash: cb75ad5db02783e8b0222fee363c5f63f7e2cf5b\r\ncommit-date: 2021-02-10\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.50.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nthread 'rustc' panicked at 'compiler\\rustc_resolve\\src\\imports.rs:904:25: inconsistent resolution for an import', /rustc/cb75ad5db02783e8b0222fee363c5f63f7e2cf5b\\compiler\\rustc_middle\\src\\util\\bug.rs:34:26\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.50.0 (cb75ad5db 2021-02-10) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental -C target-cpu=native\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n<backtrace>\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83950/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83950/timeline", "performed_via_github_app": null, "state_reason": "completed"}