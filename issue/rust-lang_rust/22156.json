{"url": "https://api.github.com/repos/rust-lang/rust/issues/22156", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22156/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22156/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22156/events", "html_url": "https://github.com/rust-lang/rust/issues/22156", "id": 57230993, "node_id": "MDU6SXNzdWU1NzIzMDk5Mw==", "number": 22156, "title": "Linking error between a Rust binary and a Rust library with a function that contains an assertion", "user": {"login": "tomaka", "id": 1412254, "node_id": "MDQ6VXNlcjE0MTIyNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1412254?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomaka", "html_url": "https://github.com/tomaka", "followers_url": "https://api.github.com/users/tomaka/followers", "following_url": "https://api.github.com/users/tomaka/following{/other_user}", "gists_url": "https://api.github.com/users/tomaka/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomaka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomaka/subscriptions", "organizations_url": "https://api.github.com/users/tomaka/orgs", "repos_url": "https://api.github.com/users/tomaka/repos", "events_url": "https://api.github.com/users/tomaka/events{/privacy}", "received_events_url": "https://api.github.com/users/tomaka/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-02-10T20:22:40Z", "updated_at": "2015-02-10T21:36:51Z", "closed_at": "2015-02-10T21:36:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "How to reproduce:\n- Clone the `vb-slice` branch of `https://github.com/tomaka/glium` (or the commit `14bb0fecdb6443afac36945956dfbbe9b70c81c4`)\n- Run `cargo test`\n\n[I'm trying](https://github.com/tomaka/glium/pull/482) to add a `VertexBufferSlice` struct which implements a method named `write`. [You can see it here](https://github.com/tomaka/glium/blob/14bb0fecdb6443afac36945956dfbbe9b70c81c4/src/vertex/buffer.rs#L291-293). Nothing fancy except that it contains an assertion.\n\nHowever, when I try to call this function it in an external test (ie. a binary program that is linked to the library), I'm getting the following linking error:\n\n> error: linking with `cc` failed: exit code: 1\n> \n> note: \"cc\" '\"-Wl,--as-needed\"' '\"-m64\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-o\"' '\"/home/travis/build/tomaka/glium/target/vertex_buffer-1e2aae9fd3ad25cf\"' '\"/home/travis/build/tomaka/glium/target/vertex_buffer-1e2aae9fd3ad25cf.o\"' '\"-Wl,--whole-archive\"' '\"-lmorestack\"' '\"-Wl,--no-whole-archive\"' '\"-Wl,--gc-sections\"' '\"-pie\"' '\"-nodefaultlibs\"' '\"-L\"' '\"/home/travis/build/tomaka/glium/target/deps\"' '\"-lglium_macros-5f17c65ec5d278d1\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lrustc-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lrbml-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lgraphviz-4e7c5e5c\"' '\"/home/travis/build/tomaka/glium/target/libglium-97a51fd64d277807.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/libimage-09875835c1e4fda6.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/libnum-916609c89539ae45.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/libglutin-abe6f4e5d9a1c8bb.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/libnalgebra-5f50089564df46a9.rlib\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lrustc_llvm-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-ltest-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lgetopts-4e7c5e5c\"' '\"/home/travis/build/tomaka/glium/target/deps/libcgmath-5bccc911b6378e31.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/librand-786334d103466ef3.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/librustc-serialize-db8cde5690079042.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/libgl_common-ec39142a57c733b7.rlib\"' '\"/home/travis/build/tomaka/glium/target/deps/liblibc-8d21de95f4de7169.rlib\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lflate-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lrustc_back-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lsyntax-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lfmt_macros-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lserialize-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-larena-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lterm-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-llog-4e7c5e5c\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-lstd-4e7c5e5c\"' '\"-L\"' '\"/home/travis/build/tomaka/glium/target\"' '\"-L\"' '\"/home/travis/build/tomaka/glium/target/deps\"' '\"-L\"' '\"/home/travis/rust/lib/rustlib/x86_64-unknown-linux-gnu/lib\"' '\"-L\"' '\"/home/travis/build/tomaka/glium/.rust/lib/x86_64-unknown-linux-gnu\"' '\"-L\"' '\"/home/travis/build/tomaka/glium/lib/x86_64-unknown-linux-gnu\"' '\"-Wl,--whole-archive\"' '\"-Wl,-Bstatic\"' '\"-Wl,--no-whole-archive\"' '\"-Wl,-Bdynamic\"' '\"-lOSMesa\"' '\"-lGL\"' '\"-lX11\"' '\"-lXxf86vm\"' '\"-lXcursor\"' '\"-lpthread\"' '\"-lrt\"' '\"-ldl\"' '\"-lm\"' '\"-lc\"' '\"-lm\"' '\"-ldl\"' '\"-lpthread\"' '\"-lrt\"' '\"-lgcc_s\"' '\"-lpthread\"' '\"-lc\"' '\"-lm\"' '\"-lcompiler-rt\"'\n> \n> note: /home/travis/build/tomaka/glium/target/vertex_buffer-1e2aae9fd3ad25cf.o: In function `vertex::buffer::VertexBufferSlice$LT$$u27$b$C$$u20$T$GT$::write::h17392329038169427709':\n> \n> vertex_buffer.0.rs:(.text._ZN6vertex6buffer40VertexBufferSlice$LT$$u27$b$C$$u20$T$GT$5write21h17392329038169427709E+0xb1): undefined reference to `vertex::buffer::VertexBufferSlice$LT$$u27$b$C$$u20$T$GT$::write::_FILE_LINE::h990f1092ce3964981zg'\n> \n> collect2: ld returned 1 exit status\n\nRemoving the assertion from the function fixes the error.\n\nThis error happens on both windows and linux. The error happens every time I compile, so it's not some sort of data race. The version is `rustc 1.0.0-nightly (74b874071 2015-02-08 00:24:03 +0000)`.\n", "closed_by": {"login": "tomaka", "id": 1412254, "node_id": "MDQ6VXNlcjE0MTIyNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1412254?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomaka", "html_url": "https://github.com/tomaka", "followers_url": "https://api.github.com/users/tomaka/followers", "following_url": "https://api.github.com/users/tomaka/following{/other_user}", "gists_url": "https://api.github.com/users/tomaka/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomaka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomaka/subscriptions", "organizations_url": "https://api.github.com/users/tomaka/orgs", "repos_url": "https://api.github.com/users/tomaka/repos", "events_url": "https://api.github.com/users/tomaka/events{/privacy}", "received_events_url": "https://api.github.com/users/tomaka/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22156/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22156/timeline", "performed_via_github_app": null, "state_reason": "completed"}