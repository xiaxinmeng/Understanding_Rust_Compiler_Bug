{"url": "https://api.github.com/repos/rust-lang/rust/issues/75572", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75572/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75572/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75572/events", "html_url": "https://github.com/rust-lang/rust/issues/75572", "id": 679632276, "node_id": "MDU6SXNzdWU2Nzk2MzIyNzY=", "number": 75572, "title": "thread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value'", "user": {"login": "Systemcluster", "id": 2847328, "node_id": "MDQ6VXNlcjI4NDczMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2847328?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Systemcluster", "html_url": "https://github.com/Systemcluster", "followers_url": "https://api.github.com/users/Systemcluster/followers", "following_url": "https://api.github.com/users/Systemcluster/following{/other_user}", "gists_url": "https://api.github.com/users/Systemcluster/gists{/gist_id}", "starred_url": "https://api.github.com/users/Systemcluster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Systemcluster/subscriptions", "organizations_url": "https://api.github.com/users/Systemcluster/orgs", "repos_url": "https://api.github.com/users/Systemcluster/repos", "events_url": "https://api.github.com/users/Systemcluster/events{/privacy}", "received_events_url": "https://api.github.com/users/Systemcluster/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1927601458, "node_id": "MDU6TGFiZWwxOTI3NjAxNDU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir-opt", "name": "A-mir-opt", "color": "f7e101", "default": false, "description": "Area: MIR optimizations"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-15T19:49:45Z", "updated_at": "2020-08-16T07:21:47Z", "closed_at": "2020-08-16T07:21:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "This issue appears in the nightly compiler since toolchain version `nightly-2020-08-14` (`rustc 1.47.0-nightly (81dc88f88 2020-08-13)`). It does not appear with toolchain `nightly-2020-08-13` (`rustc 1.47.0-nightly (576d27c5a 2020-08-12)`) or earlier.\r\n\r\n\r\n### Code\r\n\r\nCreate an empty project and add the following dependency.\r\n\r\n```toml\r\n[dependencies]\r\nnaga = {git = \"https://github.com/gfx-rs/naga\", rev = \"1eb637038dd15fc1dad770eca8e6943424dbc122\"}\r\n```\r\nUpon `cargo run`, rustc panics with the below output.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.47.0-nightly (8e21bd063 2020-08-14)\r\nbinary: rustc\r\ncommit-hash: 8e21bd0633b8d970646ee6eb706c9e8acfad19af\r\ncommit-date: 2020-08-14\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.47.0-nightly\r\nLLVM version: 10.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nCompiling naga v0.1.0 (https://github.com/gfx-rs/naga?rev=1eb637038dd15fc1dad770eca8e6943424dbc122#1eb63703)\r\n     Running `rustc --crate-name naga --edition=2018 C:\\Users\\Chris\\.cargo\\git\\checkouts\\naga-dbb2b19faed49210\\1eb6370\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -Cembed-bitcode=no -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" -C metadata=b78cb55e6bbf7f02 -C extra-filename=-b78cb55e6bbf7f02 --out-dir C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps -L dependency=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps --extern bitflags=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libbitflags-b3aa381b8c8a158c.rmeta --extern fxhash=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libfxhash-abd942eca949d6c8.rmeta --extern log=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\liblog-5edde9ce5ee6a1cc.rmeta --extern num_traits=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libnum_traits-55b459a906b3f58a.rmeta --extern thiserror=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libthiserror-cd69ea1eee32f495.rmeta --cap-lints allow`\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', src\\librustc_mir\\transform\\match_branches.rs:54:81\r\nstack backtrace:\r\n   0:     0x7fff5d918ff9 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hfae6a97726d8b736\r\n   1:     0x7fff5d94599c - core::fmt::write::hce2ddfec834877b8\r\n   2:     0x7fff5d90ad9c - <std::io::IoSlice as core::fmt::Debug>::fmt::h57a15d9f0ff2a3bc\r\n   3:     0x7fff5d91e5cb - std::panicking::take_hook::h1925373a96008b93\r\n   4:     0x7fff5d91e218 - std::panicking::take_hook::h1925373a96008b93\r\n   5:     0x7fff246954fa - rustc_driver::report_ice::h91547ccde81af24e\r\n   6:     0x7fff5d91ef70 - std::panicking::rust_panic_with_hook::h7f7de81d557f54d3\r\n   7:     0x7fff5d91eaa5 - rust_begin_unwind\r\n   8:     0x7fff5d9198af - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hfae6a97726d8b736\r\n   9:     0x7fff5d91ea59 - rust_begin_unwind\r\n  10:     0x7fff5d9422e0 - core::panicking::panic_fmt::h599cc82b32e741b9\r\n  11:     0x7fff5d94222c - core::panicking::panic::h4d7ada597da16bd9\r\n  12:     0x7fff27526e42 - <rustc_mir::transform::match_branches::MatchBranchSimplification as rustc_mir::transform::MirPass>::run_pass::hb91e63ab8948ed14\r\n  13:     0x7fff2766e0d9 - rustc_mir::transform::run_passes::hc006433f70a0d186\r\n  14:     0x7fff27670942 - rustc_mir::transform::run_passes::hc006433f70a0d186\r\n  15:     0x7fff27670eac - rustc_mir::transform::run_passes::hc006433f70a0d186\r\n  16:     0x7fff27670bf3 - rustc_mir::transform::run_passes::hc006433f70a0d186\r\n  17:     0x7fff2855369d - rustc_feature::UnstableFeatures::is_nightly_build::hf20f74c3bb454638\r\n  18:     0x7fff286135e9 - ZN12rustc_middle2ty5print6pretty66_DERIVE_rustc_middle_ty_Lift_lifted_FOR_TraitRefPrintOnlyTraitPath121_$LT$impl$u20$rustc_middle..ty..context..Lift$u20$for$u20$rustc_middle..ty..print..pretty..TraitRefPrintOnlyTraitPath$GT$11lift_to_tcx17h98c3c4fb98b9687\r\n  19:     0x7fff28419e29 - rustc_feature::UnstableFeatures::is_nightly_build::hf20f74c3bb454638\r\n  20:     0x7fff28709dbb - rustc_middle::ty::<impl rustc_middle::ty::context::TyCtxt>::instance_mir::h76dbaaa3af662a3c\r\n  21:     0x7fff27443394 - <rustc_mir::monomorphize::collector::RootCollector as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_impl_item::h5cd1c489b5156be3\r\n  22:     0x7fff2743df69 - rustc_mir::monomorphize::collector::collect_crate_mono_items::h353c8d9ad96cacce\r\n  23:     0x7fff275546d6 - <rustc_mir::dataflow::impls::borrows::BorrowIndex as core::fmt::Debug>::fmt::h983c54cf04b64bf1\r\n  24:     0x7fff2743c7ac - rustc_mir::monomorphize::collector::collect_crate_mono_items::h353c8d9ad96cacce\r\n  25:     0x7fff27707ef0 - rustc_mir::monomorphize::partitioning::compute_codegen_unit_name::h5212d0f143645fd4\r\n  26:     0x7fff27854537 - <rustc_codegen_ssa::meth::VirtualIndex as core::fmt::Debug>::fmt::he98a319022b78233\r\n  27:     0x7fff278324f3 - <rustc_codegen_ssa::mir::block::<impl rustc_codegen_ssa::mir::FunctionCx<Bx>>::codegen_panic_intrinsic::AssertIntrinsic as core::fmt::Debug>::fmt::hf03f9321433764a5\r\n  28:     0x7fff277d77d0 - <rustc_codegen_ssa::coverageinfo::map::ExpressionRegion as core::fmt::Debug>::fmt::h6ac1c379b5cb3970\r\n  29:     0x7fff278145b3 - <rustc_codegen_ssa::mir::block::<impl rustc_codegen_ssa::mir::FunctionCx<Bx>>::codegen_panic_intrinsic::AssertIntrinsic as core::fmt::Debug>::fmt::hf03f9321433764a5\r\n  30:     0x7fff278613c1 - rustc_codegen_ssa::back::symbol_export::crates_export_threshold::h701789d39c12c5bb\r\n  31:     0x7fff27a0a88e - rustc_plugin_impl::build::provide::h31aa2c45a0b2beac\r\n  32:     0x7fff27bd213e - ZN14rustc_metadata5rmeta7decoder17__ty_decoder_impl186_$LT$impl$u20$rustc_serialize..serialize..SpecializedDecoder$LT$$RF$rustc_middle..mir..interpret..allocation..Allocation$GT$$u20$for$u20$rustc_metadata..rmeta..decoder..DecodeContext$GT$18specialized_d\r\n  33:     0x7fff27be1b10 - ZN14rustc_metadata5rmeta7decoder17__ty_decoder_impl186_$LT$impl$u20$rustc_serialize..serialize..SpecializedDecoder$LT$$RF$rustc_middle..mir..interpret..allocation..Allocation$GT$$u20$for$u20$rustc_metadata..rmeta..decoder..DecodeContext$GT$18specialized_d\r\n  34:     0x7fff27b42987 - <u32 as rustc_metadata::rmeta::table::FixedSizeEncoding>::write_to_bytes_at::ha75ed890010d59b5\r\n  35:     0x7fff27a1d0c6 - <rustc_metadata::rmeta::encoder::EncodeContext as rustc_serialize::serialize::SpecializedEncoder<rustc_data_structures::fingerprint::Fingerprint>>::specialized_encode::h27f2383a265888ea\r\n  36:     0x7fff27a2c9b2 - <rustc_metadata::rmeta::encoder::PrefetchVisitor as rustc_hir::itemlikevisit::ParItemLikeVisitor>::visit_impl_item::h41f95b5bba7b4361\r\n  37:     0x7fff27acc6cd - rustc_metadata::dynamic_lib::DynamicLibrary::open::hd9e07ef0fa8b5dfe\r\n  38:     0x7fff27bf3e62 - rustc_metadata::rmeta::decoder::cstore_impl::<impl rustc_middle::middle::cstore::CrateStore for rustc_metadata::creader::CStore>::encode_metadata::h5b49c2aa9357f24e\r\n  39:     0x7fff28702bce - rustc_middle::ty::context::TyCtxt::encode_metadata::he08193cbd631d4ff\r\n  40:     0x7fff24a348bf - rustc_interface::passes::BoxedResolver::to_resolver_outputs::h1d6186a99825b11e\r\n  41:     0x7fff24961176 - rustc_interface::queries::Queries::ongoing_codegen::h43c89a54be4efc35\r\n  42:     0x7fff246d40e3 - <rustc_infer::infer::canonical::canonicalizer::Canonicalizer as rustc_middle::ty::fold::TypeFolder>::tcx::h4ddcddb18f09f250\r\n  43:     0x7fff2469aa7c - <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref::h75f1e721d5dee9b1\r\n  44:     0x7fff246d609c - <rustc_infer::infer::canonical::canonicalizer::Canonicalizer as rustc_middle::ty::fold::TypeFolder>::tcx::h4ddcddb18f09f250\r\n  45:     0x7fff246c1fb0 - <regex::sparse::SparseSet as core::ops::deref::Deref>::deref::hcab2bfd369f1a834\r\n  46:     0x7fff246c4989 - <regex::sparse::SparseSet as core::ops::deref::Deref>::deref::hcab2bfd369f1a834\r\n  47:     0x7fff24679953 - <aho_corasick::prefilter::RareByteOffset as core::default::Default>::default::hd78c1f669c18c07d\r\n  48:     0x7fff5d92ee4a - std::sys::windows::thread::Thread::new::h84550e08827b3a3a\r\n  49:     0x7fffdb216fd4 - BaseThreadInitThunk\r\n  50:     0x7fffdccbcec1 - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.47.0-nightly (8e21bd063 2020-08-14) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [optimized_mir] optimizing MIR for `proc::validator::Validator::validate`\r\n#1 [collect_and_partition_mono_items] collect_and_partition_mono_items\r\n#2 [exported_symbols] exported_symbols\r\nend of query stack\r\nerror: could not compile `naga`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name naga --edition=2018 C:\\Users\\Chris\\.cargo\\git\\checkouts\\naga-dbb2b19faed49210\\1eb6370\\src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -Cembed-bitcode=no -C debuginfo=2 --cfg \"feature=\\\"default\\\"\" -C metadata=b78cb55e6bbf7f02 -C extra-filename=-b78cb55e6bbf7f02 --out-dir C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps -L dependency=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps --extern bitflags=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libbitflags-b3aa381b8c8a158c.rmeta --extern fxhash=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libfxhash-abd942eca949d6c8.rmeta --extern log=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\liblog-5edde9ce5ee6a1cc.rmeta --extern num_traits=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libnum_traits-55b459a906b3f58a.rmeta --extern thiserror=C:\\Users\\Chris\\Development\\ice-test-2020-08-15\\target\\debug\\deps\\libthiserror-cd69ea1eee32f495.rmeta --cap-lints allow` (exit code: 101)\r\n```\r\n\r\n\r\n", "closed_by": {"login": "Systemcluster", "id": 2847328, "node_id": "MDQ6VXNlcjI4NDczMjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2847328?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Systemcluster", "html_url": "https://github.com/Systemcluster", "followers_url": "https://api.github.com/users/Systemcluster/followers", "following_url": "https://api.github.com/users/Systemcluster/following{/other_user}", "gists_url": "https://api.github.com/users/Systemcluster/gists{/gist_id}", "starred_url": "https://api.github.com/users/Systemcluster/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Systemcluster/subscriptions", "organizations_url": "https://api.github.com/users/Systemcluster/orgs", "repos_url": "https://api.github.com/users/Systemcluster/repos", "events_url": "https://api.github.com/users/Systemcluster/events{/privacy}", "received_events_url": "https://api.github.com/users/Systemcluster/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75572/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75572/timeline", "performed_via_github_app": null, "state_reason": "completed"}