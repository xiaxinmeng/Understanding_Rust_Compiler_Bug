{"url": "https://api.github.com/repos/rust-lang/rust/issues/92833", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/92833/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/92833/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/92833/events", "html_url": "https://github.com/rust-lang/rust/issues/92833", "id": 1100942525, "node_id": "I_kwDOAAsO6M5Bnwy9", "number": 92833, "title": "Stack overflow with `impl Trait` and multiple lifetimes... and a closure.", "user": {"login": "steffahn", "id": 3986214, "node_id": "MDQ6VXNlcjM5ODYyMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3986214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steffahn", "html_url": "https://github.com/steffahn", "followers_url": "https://api.github.com/users/steffahn/followers", "following_url": "https://api.github.com/users/steffahn/following{/other_user}", "gists_url": "https://api.github.com/users/steffahn/gists{/gist_id}", "starred_url": "https://api.github.com/users/steffahn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steffahn/subscriptions", "organizations_url": "https://api.github.com/users/steffahn/orgs", "repos_url": "https://api.github.com/users/steffahn/repos", "events_url": "https://api.github.com/users/steffahn/events{/privacy}", "received_events_url": "https://api.github.com/users/steffahn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 631673608, "node_id": "MDU6TGFiZWw2MzE2NzM2MDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-impl-trait", "name": "A-impl-trait", "color": "f7e101", "default": false, "description": "Area: impl Trait. Universally / existentially quantified anonymous types with static dispatch."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-01-13T00:17:26Z", "updated_at": "2022-01-13T00:36:35Z", "closed_at": "2022-01-13T00:36:18Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Seems to stack overflow (I think it's one... on Linux it does give \"segfault\", technically, and on Windows it produces \"thread 'rustc' has overflowed its stack\").\r\n\r\n(Current nightly behaves like current stable.)\r\n````rs\r\ntrait Fn1<T>: Fn(T) -> <Self as Fn1<T>>::Output {\r\n    type Output;\r\n}\r\nimpl<F: ?Sized, T, O> Fn1<T> for F where F: Fn(T) -> O {type Output = O;}\r\n\r\ntrait Trait<'a1, 'a2> {}\r\nimpl<S: ?Sized> Trait<'_, '_> for S {}\r\n\r\nfn foo<'a>(request: &'a str) -> impl for<'b> Fn1<&'b (), Output = impl Trait<'a, 'b>> {\r\n    move |_: &()| ()\r\n}\r\n````\r\n([playground](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2021&gist=58fb9ef12312ff34f7e0161ea701255e))\r\n\r\n~~Haven't tried much to minimize further yet, perhaps this can also be done, somehow, without using a closure?~~ Nevermind, I removed the need for closures now\r\n````rs\r\ntrait Fn1<T> {\r\n    type Output;\r\n}\r\nimpl<T, S: ?Sized> Fn1<T> for S {\r\n    type Output = ();\r\n}\r\n\r\ntrait Trait<'a> {}\r\nimpl<'a, S: ?Sized> Trait<'a> for S {}\r\n\r\nfn foo() -> impl for<'b> Fn1<&'b (), Output = impl Trait<'b>> {\r\n    ()\r\n}\r\n````\r\n\r\nThe same code used to give various ICEs in older Rust versions, stack overflow seems to be since 1.57. I don't have time to investigate further today.\r\n\r\n@rustbot label I-crash, A-impl-trait, A-lifetimes, ~~A-closures,~~ T-compiler\r\n@rustbot label -A-closures\r\n\r\n<hr>\r\n\r\nLabeling question: is `ICE -> crash` a regression?", "closed_by": {"login": "steffahn", "id": 3986214, "node_id": "MDQ6VXNlcjM5ODYyMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3986214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steffahn", "html_url": "https://github.com/steffahn", "followers_url": "https://api.github.com/users/steffahn/followers", "following_url": "https://api.github.com/users/steffahn/following{/other_user}", "gists_url": "https://api.github.com/users/steffahn/gists{/gist_id}", "starred_url": "https://api.github.com/users/steffahn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steffahn/subscriptions", "organizations_url": "https://api.github.com/users/steffahn/orgs", "repos_url": "https://api.github.com/users/steffahn/repos", "events_url": "https://api.github.com/users/steffahn/events{/privacy}", "received_events_url": "https://api.github.com/users/steffahn/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/92833/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/92833/timeline", "performed_via_github_app": null, "state_reason": "completed"}