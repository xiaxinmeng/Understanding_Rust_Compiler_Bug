{"url": "https://api.github.com/repos/rust-lang/rust/issues/61784", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61784/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61784/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61784/events", "html_url": "https://github.com/rust-lang/rust/issues/61784", "id": 455411407, "node_id": "MDU6SXNzdWU0NTU0MTE0MDc=", "number": 61784, "title": "Make `ptr_rotate` faster", "user": {"login": "AaronKutch", "id": 32419308, "node_id": "MDQ6VXNlcjMyNDE5MzA4", "avatar_url": "https://avatars.githubusercontent.com/u/32419308?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AaronKutch", "html_url": "https://github.com/AaronKutch", "followers_url": "https://api.github.com/users/AaronKutch/followers", "following_url": "https://api.github.com/users/AaronKutch/following{/other_user}", "gists_url": "https://api.github.com/users/AaronKutch/gists{/gist_id}", "starred_url": "https://api.github.com/users/AaronKutch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AaronKutch/subscriptions", "organizations_url": "https://api.github.com/users/AaronKutch/orgs", "repos_url": "https://api.github.com/users/AaronKutch/repos", "events_url": "https://api.github.com/users/AaronKutch/events{/privacy}", "received_events_url": "https://api.github.com/users/AaronKutch/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-06-12T20:33:14Z", "updated_at": "2019-08-09T16:47:51Z", "closed_at": "2019-08-09T16:47:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was going to directly PR the performance improvement, but since this is my first time writing a bunch of unsafe code, and because `x.py` will not work for me (#61611), I decided to open an issue and point to [this repository](https://github.com/AaronKutch/ptr_rotate_bench_demonstration) filled with all the benchmarks I wrote.\r\n\r\nI tried over 20 different variations on algorithms before settling on this one.\r\nThe only thing I am concerned with is that I am directly using `T` values in algorithm 1 instead of indirect copies and swaps, which the microbenchmarks did not like. I am pretty sure that it is panic safe, since there is no `T: clone` anywhere.\r\n\r\nI benchmarked on both Intel and AMD CPUs, and found that only on the `x1031s149_new` benchmark did my algorithm perform significantly worse (probably due to the fact that 1031 and 149 are both primes), and the `u8_new` benchmark on my AMD CPU. I do not know what is causing the `u8_new` to be much worse on the new algorithm on my AMD CPU, and if the problem persists on newer AMD hardware. Every other benchmark indicates that my algorithm is as fast or faster than the old one (note that because there are so many benchmarks, there may be outliers which you should benchmark again).\r\n\r\nOf course, when I do the PR I am not going to include all of those benchmarks, but I am not sure what subset to include.", "closed_by": {"login": "AaronKutch", "id": 32419308, "node_id": "MDQ6VXNlcjMyNDE5MzA4", "avatar_url": "https://avatars.githubusercontent.com/u/32419308?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AaronKutch", "html_url": "https://github.com/AaronKutch", "followers_url": "https://api.github.com/users/AaronKutch/followers", "following_url": "https://api.github.com/users/AaronKutch/following{/other_user}", "gists_url": "https://api.github.com/users/AaronKutch/gists{/gist_id}", "starred_url": "https://api.github.com/users/AaronKutch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AaronKutch/subscriptions", "organizations_url": "https://api.github.com/users/AaronKutch/orgs", "repos_url": "https://api.github.com/users/AaronKutch/repos", "events_url": "https://api.github.com/users/AaronKutch/events{/privacy}", "received_events_url": "https://api.github.com/users/AaronKutch/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61784/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61784/timeline", "performed_via_github_app": null, "state_reason": "completed"}