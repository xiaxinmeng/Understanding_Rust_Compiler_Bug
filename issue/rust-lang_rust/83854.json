{"url": "https://api.github.com/repos/rust-lang/rust/issues/83854", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83854/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83854/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83854/events", "html_url": "https://github.com/rust-lang/rust/issues/83854", "id": 849916852, "node_id": "MDU6SXNzdWU4NDk5MTY4NTI=", "number": 83854, "title": "UI test `issue-64655-extern-rust-must-allow-unwind.rs#thin0` triggers LLVM assert when compiled for i586 target with CGUs = 1 ", "user": {"login": "the8472", "id": 1065730, "node_id": "MDQ6VXNlcjEwNjU3MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1065730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the8472", "html_url": "https://github.com/the8472", "followers_url": "https://api.github.com/users/the8472/followers", "following_url": "https://api.github.com/users/the8472/following{/other_user}", "gists_url": "https://api.github.com/users/the8472/gists{/gist_id}", "starred_url": "https://api.github.com/users/the8472/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the8472/subscriptions", "organizations_url": "https://api.github.com/users/the8472/orgs", "repos_url": "https://api.github.com/users/the8472/repos", "events_url": "https://api.github.com/users/the8472/events{/privacy}", "received_events_url": "https://api.github.com/users/the8472/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 45472092, "node_id": "MDU6TGFiZWw0NTQ3MjA5Mg==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-ffi", "name": "A-ffi", "color": "f7e101", "default": false, "description": "Area: Foreign Function Interface (FFI)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-04-04T17:02:19Z", "updated_at": "2021-07-31T20:20:15Z", "closed_at": "2021-07-31T20:20:15Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This was discovered in https://github.com/rust-lang/rust/pull/81942#issuecomment-813048100 which lowers the UI test default CGU count to 1. The test was modified to explicitly request 2CGUs to make it pass, but the underlying issue remains.\r\n\r\nA similar errors but affecting different test-cases was also encountered in https://github.com/rust-lang/rust/pull/81825#issuecomment-808791588 \r\n\r\nSteps to reproduce\r\n\r\n* checkout aef11409b43 (master may work too)\r\n* add `-Ccodegen-units=1` to `issue-64655-extern-rust-must-allow-unwind.rs#thin0`\r\n* modify `src/ci/docker/host-x86_64/dist-i586-gnu-i586-i686-musl/Dockerfile` to only run UI tests\r\n* run `./src/ci/docker/run.sh dist-i586-gnu-i586-i686-musl`\r\n\r\nOutput\r\n\r\n```\r\nfailures:\r\n\r\n---- [ui] ui/extern/issue-64655-extern-rust-must-allow-unwind.rs#thin0 stdout ----\r\n\r\nerror in revision `thin0`: test compilation failed although it shouldn't!\r\nstatus: signal: 6 (core dumped)\r\ncommand: \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage1/bin/rustc\" \"/checkout/src/test/ui/extern/issue-64655-extern-rust-must-allow-unwind.rs\" \"-Zthreads=1\" \"--target=i586-unknown-linux-gnu\" \"--cfg\" \"thin0\" \"--error-format\" \"json\" \"-Ccodegen-units=1\" \"-Zui-testing\" \"-Zdeduplicate-diagnostics=no\" \"-Zemit-future-incompat-report\" \"-o\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/test/ui/extern/issue-64655-extern-rust-must-allow-unwind.thin0/a\" \"-Crpath\" \"-Cdebuginfo=0\" \"-Zunstable-options\" \"-Lnative=/checkout/obj/build/i586-unknown-linux-gnu/native/rust-test-helpers\" \"-Clinker=cc\" \"-C\" \"opt-level=0\" \"-C\" \"lto=thin\" \"-L\" \"/checkout/obj/build/x86_64-unknown-linux-gnu/test/ui/extern/issue-64655-extern-rust-must-allow-unwind.thin0/auxiliary\"\r\nstdout:\r\n------------------------------------------\r\n\r\n------------------------------------------\r\nstderr:\r\n------------------------------------------\r\nrustc: /checkout/src/llvm-project/llvm/lib/CodeGen/RegAllocFast.cpp:883: void {anonymous}::RegAllocFast::defineVirtReg(llvm::MachineInstr&, unsigned int, llvm::Register, bool): Assertion `PhysReg != 0 && \"Register not assigned\"' failed.\r\n\r\n------------------------------------------\r\n\r\n\r\n\r\nfailures:\r\n    [ui] ui/extern/issue-64655-extern-rust-must-allow-unwind.rs#thin0\r\n```\r\n\r\nAdditionally `ui/extern/issue-64655-allow-unwind-when-calling-panic-directly.rs#thin` fails with 1 CGU under the `i686-gnu-nopt` runner.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83854/timeline", "performed_via_github_app": null, "state_reason": "completed"}