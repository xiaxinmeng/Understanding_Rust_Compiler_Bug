{"url": "https://api.github.com/repos/rust-lang/rust/issues/70399", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/70399/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/70399/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/70399/events", "html_url": "https://github.com/rust-lang/rust/issues/70399", "id": 587874956, "node_id": "MDU6SXNzdWU1ODc4NzQ5NTY=", "number": 70399, "title": "Layout for enums does not match MIR (and types) very well", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}, {"id": 1944310735, "node_id": "MDU6TGFiZWwxOTQ0MzEwNzM1", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-layout", "name": "A-layout", "color": "f7e101", "default": false, "description": "Area: Memory layout of types"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-03-25T17:44:16Z", "updated_at": "2020-10-08T00:00:25Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Enum layout computation entirely ignores ZST uninhabited (\"absent\") variants, which can lead to the layout being quite different in structure from the user-visible enum:\r\n* if there are more than 1 non-absent variants, `Variants::Multiple` is used.\r\n* if there is exactly 1 non-absent variant, `Variants::Single` is used.\r\n* if all variants are absent, the layout of `!` is used, so the entire thing ends up looking like a union with 0 fields.\r\n\r\nWhen actually asking for the layout of such an absent variant, it has to be made up \"on the spot\".\r\n\r\nIn terms of testing things like Miri (or anything else that needs to work with layout variants information), this leads to the \"interesting\" situation that we need an enum with at least 3 variants where 1 is \"absent\" to make sure that `Variants::Multiple` with absent variants is handled correctly.\r\n\r\nThis could be improved by generalizing `Variants::Multiple` to also support \"discriminants\" of \"type\" `()` and `!`, thus uniformly handling all enums.\r\n\r\nAlso see the second half of https://github.com/rust-lang/rust/issues/69763#issuecomment-595699745, and discussion below https://github.com/rust-lang/rust/issues/69763#issuecomment-603657246.\r\n\r\nCc @eddyb", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/70399/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/70399/timeline", "performed_via_github_app": null, "state_reason": null}