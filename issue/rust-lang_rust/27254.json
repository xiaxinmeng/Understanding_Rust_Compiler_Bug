{"url": "https://api.github.com/repos/rust-lang/rust/issues/27254", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27254/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27254/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27254/events", "html_url": "https://github.com/rust-lang/rust/issues/27254", "id": 96965178, "node_id": "MDU6SXNzdWU5Njk2NTE3OA==", "number": 27254, "title": "Setting --libdir breaks rustc build", "user": {"login": "saschmit", "id": 13304324, "node_id": "MDQ6VXNlcjEzMzA0MzI0", "avatar_url": "https://avatars.githubusercontent.com/u/13304324?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saschmit", "html_url": "https://github.com/saschmit", "followers_url": "https://api.github.com/users/saschmit/followers", "following_url": "https://api.github.com/users/saschmit/following{/other_user}", "gists_url": "https://api.github.com/users/saschmit/gists{/gist_id}", "starred_url": "https://api.github.com/users/saschmit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saschmit/subscriptions", "organizations_url": "https://api.github.com/users/saschmit/orgs", "repos_url": "https://api.github.com/users/saschmit/repos", "events_url": "https://api.github.com/users/saschmit/events{/privacy}", "received_events_url": "https://api.github.com/users/saschmit/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-07-24T04:55:21Z", "updated_at": "2016-01-22T11:37:00Z", "closed_at": "2016-01-22T11:37:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "Fedora x86_64 builds install libraries to /usr/lib64 so that 32-bit and 64-bit libraries can coexist on the same system.  However, with `configure --prefix=/usr --libdir=/usr/lib64 && make`, the build breaks:\n\n```\n...\nrustc: x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore\nrustc: x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc\n/home/builder/rust/src/liblibc/lib.rs:81:38: 81:56 error: can't find crate for `core`\n/home/builder/rust/src/liblibc/lib.rs:81 #[cfg(not(feature = \"cargo-build\"))] extern crate core;\n                                                                              ^~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n/home/builder/rust/mk/target.mk:162: recipe for target 'x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.libc' failed\nmake: *** [x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.libc] Error 101\n```\n\nIt appears that libraries are getting generated at stage0/lib but the build is (maybe?) looking for them at stage0/lib64. The results of `find x86_64-unknown-linux-gnu/stage0`:\n\n```\nx86_64-unknown-linux-gnu/stage0\nx86_64-unknown-linux-gnu/stage0/bin\nx86_64-unknown-linux-gnu/stage0/bin/rustc\nx86_64-unknown-linux-gnu/stage0/lib64\nx86_64-unknown-linux-gnu/stage0/lib64/rustlib\nx86_64-unknown-linux-gnu/stage0/lib64/rustlib/x86_64-unknown-linux-gnu\nx86_64-unknown-linux-gnu/stage0/lib64/rustlib/x86_64-unknown-linux-gnu/bin\nx86_64-unknown-linux-gnu/stage0/lib64/rustlib/x86_64-unknown-linux-gnu/lib\nx86_64-unknown-linux-gnu/stage0/test\nx86_64-unknown-linux-gnu/stage0/lib\nx86_64-unknown-linux-gnu/stage0/lib/rustlib\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/bin\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.libc.start_time\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-e9599659.rlib\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler-rt.a\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmorestack.a\nx86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.core\n```\n\nI can only assume the same problem will probably propagate through later stages.\n\nThis is from doing a bootstrap build of the 1.1.0 tag (i.e., commit 35ceea3) in rust git, but I've also tried bootstrapping using commit 320bd6f and gotten the same results.\n\nI've tried hunting down hard-coded \"lib\" and replacing it with $CFG_LIBDIR_RELATIVE. However, that did not resolve the problem, so perhaps something else is going on.\n\nPossibly related:  #11671, #22831, #16552\n\nOutput of `./x86_64-unknown-linux-gnu/stage0/bin/rustc --version --verbose`:\n\n```\nrustc 1.1.0-dev (857ef6e27 2015-04-27) (built 2015-04-27)\nbinary: rustc\ncommit-hash: 857ef6e272e5634cb9f3e6ee50eb6bc2a2e71651\ncommit-date: 2015-04-27\nbuild-date: 2015-04-27\nhost: x86_64-unknown-linux-gnu\nrelease: 1.1.0-dev\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27254/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27254/timeline", "performed_via_github_app": null, "state_reason": "completed"}