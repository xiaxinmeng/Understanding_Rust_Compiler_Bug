{"url": "https://api.github.com/repos/rust-lang/rust/issues/87211", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/87211/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/87211/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/87211/events", "html_url": "https://github.com/rust-lang/rust/issues/87211", "id": 946784636, "node_id": "MDU6SXNzdWU5NDY3ODQ2MzY=", "number": 87211, "title": "Confusing error: Immutable reference to future is not a future", "user": {"login": "Darksonn", "id": 928074, "node_id": "MDQ6VXNlcjkyODA3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/928074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Darksonn", "html_url": "https://github.com/Darksonn", "followers_url": "https://api.github.com/users/Darksonn/followers", "following_url": "https://api.github.com/users/Darksonn/following{/other_user}", "gists_url": "https://api.github.com/users/Darksonn/gists{/gist_id}", "starred_url": "https://api.github.com/users/Darksonn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Darksonn/subscriptions", "organizations_url": "https://api.github.com/users/Darksonn/orgs", "repos_url": "https://api.github.com/users/Darksonn/repos", "events_url": "https://api.github.com/users/Darksonn/events{/privacy}", "received_events_url": "https://api.github.com/users/Darksonn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 1049510487, "node_id": "MDU6TGFiZWwxMDQ5NTEwNDg3", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-async-await", "name": "A-async-await", "color": "f7e101", "default": false, "description": "Area: Async & Await"}, {"id": 1259721467, "node_id": "MDU6TGFiZWwxMjU5NzIxNDY3", "url": "https://api.github.com/repos/rust-lang/rust/labels/AsyncAwait-Triaged", "name": "AsyncAwait-Triaged", "color": "d4c5f9", "default": false, "description": "Async-await issues that have been triaged during a working group meeting."}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}], "state": "open", "locked": false, "assignee": {"login": "rahul-ar", "id": 35124987, "node_id": "MDQ6VXNlcjM1MTI0OTg3", "avatar_url": "https://avatars.githubusercontent.com/u/35124987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rahul-ar", "html_url": "https://github.com/rahul-ar", "followers_url": "https://api.github.com/users/rahul-ar/followers", "following_url": "https://api.github.com/users/rahul-ar/following{/other_user}", "gists_url": "https://api.github.com/users/rahul-ar/gists{/gist_id}", "starred_url": "https://api.github.com/users/rahul-ar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rahul-ar/subscriptions", "organizations_url": "https://api.github.com/users/rahul-ar/orgs", "repos_url": "https://api.github.com/users/rahul-ar/repos", "events_url": "https://api.github.com/users/rahul-ar/events{/privacy}", "received_events_url": "https://api.github.com/users/rahul-ar/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "rahul-ar", "id": 35124987, "node_id": "MDQ6VXNlcjM1MTI0OTg3", "avatar_url": "https://avatars.githubusercontent.com/u/35124987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rahul-ar", "html_url": "https://github.com/rahul-ar", "followers_url": "https://api.github.com/users/rahul-ar/followers", "following_url": "https://api.github.com/users/rahul-ar/following{/other_user}", "gists_url": "https://api.github.com/users/rahul-ar/gists{/gist_id}", "starred_url": "https://api.github.com/users/rahul-ar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rahul-ar/subscriptions", "organizations_url": "https://api.github.com/users/rahul-ar/orgs", "repos_url": "https://api.github.com/users/rahul-ar/repos", "events_url": "https://api.github.com/users/rahul-ar/events{/privacy}", "received_events_url": "https://api.github.com/users/rahul-ar/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2021-07-17T10:13:20Z", "updated_at": "2021-09-16T16:34:44Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Given the following code:\r\n\r\n```rust\r\nasync fn my_async_fn() {}\r\n\r\nasync fn foo() {\r\n    tokio::select! {\r\n        _ = &my_async_fn() => {},\r\n    }\r\n}\r\n```\r\n[playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=b7adade3c7dd34b220454c8c4a3b5fc8)\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0599]: no method named `poll` found for struct `Pin<&mut &impl Future>` in the current scope\r\n --> src/lib.rs:5:5\r\n  |\r\n5 | /     tokio::select! {\r\n6 | |         _ = &my_async_fn() => {}\r\n7 | |     }\r\n  | |_____^ method not found in `Pin<&mut &impl Future>`\r\n  |\r\n  = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\n---\r\n\r\nGiven the following code:\r\n```rust\r\nasync fn my_async_fn() {}\r\n\r\nasync fn foo() {\r\n    let fut = &my_async_fn();\r\n    tokio::pin!(fut);\r\n    \r\n    fut.await;\r\n}\r\n```\r\n[playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=78cfe7a15e3cbd16ae65d7918743050c)\r\n\r\nThe current output is:\r\n```\r\nerror[E0277]: `&impl Future` is not a future\r\n --> src/lib.rs:8:5\r\n  |\r\n8 |     fut.await;\r\n  |     ^^^^^^^^^ `&impl Future` is not a future\r\n  |\r\n  = help: the trait `Future` is not implemented for `&impl Future`\r\n  = note: required because of the requirements on the impl of `Future` for `Pin<&mut &impl Future>`\r\n  = note: required by `poll`\r\n```\r\n\r\n---\r\n\r\nGiven the following code:\r\n```rust\r\nasync fn my_async_fn() {}\r\n\r\nasync fn foo() {\r\n    let fut = &my_async_fn();\r\n    \r\n    fut.await;\r\n}\r\n```\r\n[playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=e388bf1a28851e5f3ef57dbaef113ff0)\r\n\r\nThe current output is:\r\n```\r\nerror[E0277]: `&impl Future` is not a future\r\n --> src/lib.rs:7:5\r\n  |\r\n7 |     fut.await;\r\n  |     ^^^^^^^^^ `&impl Future` is not a future\r\n  |\r\n  = help: the trait `Future` is not implemented for `&impl Future`\r\n  = note: required by `poll`\r\n```\r\n\r\nIn all three cases, it would be very helpful if the compiler could explicitly call out that an immutable reference to a future is not a future. I see this relatively often in the Tokio discord where people put some extra ampersands in random places and get really confused when the error says \"impl future is not future\". The ampersand in the error is not enough to clue them in to what the issue is. Especially for the first case.\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"rahul-ar\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/87211/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/87211/timeline", "performed_via_github_app": null, "state_reason": null}