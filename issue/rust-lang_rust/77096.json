{"url": "https://api.github.com/repos/rust-lang/rust/issues/77096", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77096/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77096/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77096/events", "html_url": "https://github.com/rust-lang/rust/issues/77096", "id": 707152873, "node_id": "MDU6SXNzdWU3MDcxNTI4NzM=", "number": 77096, "title": "Refactor handling of statics", "user": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-09-23T08:20:11Z", "updated_at": "2020-09-28T11:56:25Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Our current handling of statics is suboptimal: a use of a static `STATIC` is desugared to `*{const-ptr-to-static}`, which is nice because it means we do not need any special case in the MIR for statics, but causes problems when statics *need* to be treated differently. One example of such special treatment is [const checking and promotion](https://github.com/rust-lang/rust/issues/74840#issuecomment-676155841), because consts are not allowed to access statics.\r\n\r\nAnother issue is that to ensure correct safety checking of static accesses, the `static_ptr_ty` function needs to carefully use raw pointers or references, and the unsafety checker needs to backtranslate that information into proper error messages. A different way to say this is that unsafety checking is another case where statics need special treatment.\r\n\r\nAnd possibly there are more cases where statics need special treatment? it would be great to get an exhaustive list of that, or at least as exhaustive as we can make it, to take that all into account for our design decisions.\r\n\r\nAll that said, places used to have special treatment in the MIR and @oli-obk worked hard to move away from that to the current situation. Before considering how to resolve the above problems, I'd like to better understand the issues with the old approach that were solved by moving to the current approach.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77096/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77096/timeline", "performed_via_github_app": null, "state_reason": null}