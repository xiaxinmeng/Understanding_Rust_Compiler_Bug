{"url": "https://api.github.com/repos/rust-lang/rust/issues/75860", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/75860/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/75860/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/75860/events", "html_url": "https://github.com/rust-lang/rust/issues/75860", "id": 684281397, "node_id": "MDU6SXNzdWU2ODQyODEzOTc=", "number": 75860, "title": "Compiler hang on function return type", "user": {"login": "Pluriscient", "id": 22261839, "node_id": "MDQ6VXNlcjIyMjYxODM5", "avatar_url": "https://avatars.githubusercontent.com/u/22261839?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Pluriscient", "html_url": "https://github.com/Pluriscient", "followers_url": "https://api.github.com/users/Pluriscient/followers", "following_url": "https://api.github.com/users/Pluriscient/following{/other_user}", "gists_url": "https://api.github.com/users/Pluriscient/gists{/gist_id}", "starred_url": "https://api.github.com/users/Pluriscient/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Pluriscient/subscriptions", "organizations_url": "https://api.github.com/users/Pluriscient/orgs", "repos_url": "https://api.github.com/users/Pluriscient/repos", "events_url": "https://api.github.com/users/Pluriscient/events{/privacy}", "received_events_url": "https://api.github.com/users/Pluriscient/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1050784470, "node_id": "MDU6TGFiZWwxMDUwNzg0NDcw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-bisection", "name": "E-needs-bisection", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs bisection: https://github.com/rust-lang/cargo-bisect-rustc"}, {"id": 1168029555, "node_id": "MDU6TGFiZWwxMTY4MDI5NTU1", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-hang", "name": "I-hang", "color": "e10c02", "default": false, "description": "Issue: The compiler never terminates, due to infinite loops, deadlock, livelock, etc."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-08-24T00:00:36Z", "updated_at": "2022-01-28T04:04:06Z", "closed_at": "2022-01-28T04:04:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\nWhile coding for a kata challenge ([this one to be exact](https://www.codewars.com/kata/5922543bf9c15705d0000020/train/rust)), the compiler hung when I tried to compile the code below, probably getting stuck trying to determine the return type.\r\nIt's late so I'll look into making the code more concrete tomorrow (if this doesn't turn out to be known)\r\n### Code\r\n<details>\r\n<summary> Original code </summary>\r\n\r\n```Rust\r\npub type ISO<A: 'static, B: 'static> = (Box<dyn Fn(A) -> B>, Box<dyn Fn(B) -> A>);\r\n\r\npub fn iso<A: 'static, B: 'static, F1, F2>(a: F1, b: F2) -> ISO<A, B>\r\n    where\r\n        F1: 'static + Fn(A) -> B,\r\n        F2: 'static + Fn(B) -> A,\r\n{\r\n    (Box::new(a), Box::new(b))\r\n}\r\npub fn iso_un_option<A: 'static, B: 'static>(i: ISO<Option<A>, Option<B>>) -> ISO<A, B> {\r\n    let (ab, ba) = (i.0, i.1);\r\n\r\n    let left = move |o_a| match o_a {\r\n        None => panic!(\"absured\"),\r\n        Some(a) => a,\r\n    };\r\n    let right = move |o_b| match o_b {\r\n        None => panic!(\"absurd\"),\r\n        Some(b) => b,\r\n    };\r\n    // todo!() if the below is replaced with this there is no problem\r\n    iso(left, right)\r\n}\r\n\r\n\r\nfn main() {\r\n    println!(\"I'm working!\");\r\n}\r\n```\r\n\r\n</details>\r\n\r\nEDIT: The smallest I could get it. The compiler won't hang if I \r\n- Inline the iso function\r\n- Call unwrap instead of matching in left or right\r\n- Remove either of the two arguments left/right\r\n\r\nMCVE:\r\n\r\n```rust\r\npub fn iso<A, B, F1, F2>(a: F1, b: F2) -> (Box<dyn Fn(A) -> B>, Box<dyn Fn(B) -> A>)\r\n    where\r\n        F1: 'static + Fn(A) -> B,\r\n        F2: 'static + Fn(B) -> A,\r\n{\r\n    (Box::new(a), Box::new(b))\r\n}\r\npub fn iso_un_option<A, B>() -> (Box<dyn Fn(A) -> B>, Box<dyn Fn(B) -> A>) {\r\n   let left: fn(Option<_>) -> _ = move |o_a| match o_a {\r\n        None => panic!(\"absurd\"),\r\n        Some(a) => a,\r\n    };\r\n    let right : fn(Option<_>) -> _= move |o_b| match o_b {\r\n        None => panic!(\"absurd\"),\r\n        Some(b) => b,\r\n    };\r\n    iso(left, right)\r\n}\r\n\r\nfn main() {\r\n    println!(\"I'm working!\");\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.45.2 (d3fb005a3 2020-07-31)\r\nbinary: rustc\r\ncommit-hash: d3fb005a39e62501b8b0b356166e515ae24e2e54\r\ncommit-date: 2020-07-31\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.45.2\r\nLLVM version: 10.0\r\n\r\n```\r\nSame for nightly:\r\n```\r\nrustc 1.47.0-nightly (663d2f5cd 2020-08-22)\r\nbinary: rustc\r\ncommit-hash: 663d2f5cd3163f17eddb74ee1e028d542255f21a\r\ncommit-date: 2020-08-22\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.47.0-nightly\r\nLLVM version: 10.0\r\n```\r\n\r\n\r\n### Error output\r\nHung compiler, so no output or backtrace\r\n\r\n\r\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/75860/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/75860/timeline", "performed_via_github_app": null, "state_reason": "completed"}