{"url": "https://api.github.com/repos/rust-lang/rust/issues/63349", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63349/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63349/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63349/events", "html_url": "https://github.com/rust-lang/rust/issues/63349", "id": 477882722, "node_id": "MDU6SXNzdWU0Nzc4ODI3MjI=", "number": 63349, "title": "Recompiling causes panic", "user": {"login": "mattrutherford", "id": 44339188, "node_id": "MDQ6VXNlcjQ0MzM5MTg4", "avatar_url": "https://avatars.githubusercontent.com/u/44339188?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattrutherford", "html_url": "https://github.com/mattrutherford", "followers_url": "https://api.github.com/users/mattrutherford/followers", "following_url": "https://api.github.com/users/mattrutherford/following{/other_user}", "gists_url": "https://api.github.com/users/mattrutherford/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattrutherford/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattrutherford/subscriptions", "organizations_url": "https://api.github.com/users/mattrutherford/orgs", "repos_url": "https://api.github.com/users/mattrutherford/repos", "events_url": "https://api.github.com/users/mattrutherford/events{/privacy}", "received_events_url": "https://api.github.com/users/mattrutherford/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2019-08-07T11:55:21Z", "updated_at": "2019-08-29T18:51:30Z", "closed_at": "2019-08-29T18:51:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "Making changes to code in modules that compile to WASM and running `cargo build --release` results in a panic.  \r\n\r\nThis is the project: https://github.com/paritytech/substrate\r\n\r\nImmediately running `cargo clean && cargo build --release` will allow successful compilation. Also upgrading to a new version of nightly will allow recompilation without `cargo clean`, but only the first recompile.\r\n\r\n## Meta\r\n\r\n`rustc --version --verbose`: \r\n\r\nrustc 1.38.0-nightly (6a91782b7 2019-08-06) running on x86_64-apple-darwin\r\n\r\nBacktrace:\r\n\r\n```\r\nFresh transaction-factory v0.0.1 (/Users/matt/projects/substrate/test-utils/transaction-factory)\r\nerror: failed to run custom build command for `node-runtime v2.0.0 (/Users/matt/projects/substrate/node/runtime)`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/Users/matt/projects/substrate/target/release/build/node-runtime-777af245baf20274/build-script-build` (exit code: 1)\r\n--- stdout\r\nExecuting build command: \"rustup\" \"run\" \"nightly\" \"cargo\" \"build\" \"--target=wasm32-unknown-unknown\" \"--manifest-path=/Users/matt/projects/substrate/target/release/wbuild/node-runtime/Cargo.toml\" \"--release\"\r\n\r\n--- stderr\r\n   Compiling wasm-build-runner-impl v1.0.0 (/Users/matt/projects/substrate/target/release/build/node-runtime-3547c858aedc1441/out/wasm_build_runner)\r\n    Finished release [optimized] target(s) in 0.25s\r\n     Running `/Users/matt/projects/substrate/target/release/build/node-runtime-3547c858aedc1441/out/wasm_build_runner/target/release/wasm-build-runner-impl`\r\n   Compiling node-runtime-wasm v1.0.0 (/Users/matt/projects/substrate/target/release/wbuild/node-runtime)\r\nthread '<unnamed>' panicked at 'must have at least one serialized module', src/libcore/option.rs:1166:5\r\nstack backtrace:\r\n   0:        0x109957f12 - std::panicking::default_hook::{{closure}}::hbefba8356e31122b\r\n   1:        0x109957bdd - std::panicking::default_hook::hb85a284cef21dddc\r\n   2:        0x1085b55a3 - rustc::util::common::panic_hook::h8e13af8cece077e3\r\n   3:        0x1099587d1 - std::panicking::rust_panic_with_hook::h8868b29516eb168e\r\n   4:        0x10995822d - std::panicking::continue_panic_fmt::h8f85da70e3d42ed7\r\n   5:        0x109958119 - rust_begin_unwind\r\n   6:        0x109983e82 - core::panicking::panic_fmt::ha880b2fe6921e68e\r\n   7:        0x109983f9e - core::option::expect_failed::hfea1a2f203365264\r\n   8:        0x10bb851f8 - rustc_codegen_llvm::back::lto::run_fat::h0e6fc34b8aa41a0c\r\n   9:        0x10bc04aa8 - rustc_codegen_ssa::back::write::start_executing_work::{{closure}}::h1c543b9ea0992759\r\n  10:        0x10bc0b7d0 - std::sys_common::backtrace::__rust_begin_short_backtrace::h6b423e28f14e4e74\r\n  11:        0x10bb5279c - std::panicking::try::do_call::h6fca1ea505f089a9\r\n  12:        0x109967b4f - __rust_maybe_catch_panic\r\n  13:        0x10bb52ba6 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h6eb73fcc38df565a\r\n  14:        0x10993bb1e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h2a90a69cfe4e95fa\r\n  15:        0x10996695e - std::sys::unix::thread::Thread::new::thread_start::h99953f013e830b09\r\n  16:     0x7fff7c8392eb - _pthread_body\r\n  17:     0x7fff7c83c249 - _pthread_start\r\nquery stack during panic:\r\nend of query stack\r\nthread 'rustc' panicked at 'src/librustc_codegen_ssa/back/write.rs:1826: panic during codegen/LLVM phase', src/librustc/util/bug.rs:37:26\r\nstack backtrace:\r\n   0:        0x109957f12 - std::panicking::default_hook::{{closure}}::hbefba8356e31122b\r\n   1:        0x109957bdd - std::panicking::default_hook::hb85a284cef21dddc\r\n   2:        0x1085b55a3 - rustc::util::common::panic_hook::h8e13af8cece077e3\r\n   3:        0x1099587d1 - std::panicking::rust_panic_with_hook::h8868b29516eb168e\r\n   4:        0x1085f9b25 - std::panicking::begin_panic::he8bde94d32f67181\r\n   5:        0x10828fbb4 - rustc::util::bug::opt_span_bug_fmt::{{closure}}::h79b523f376a07816\r\n   6:        0x10828f9ea - rustc::ty::context::tls::with_opt::{{closure}}::heef7fe9845124b11\r\n   7:        0x10828f777 - rustc::ty::context::tls::with_context_opt::h61634ca6ab55ac5a\r\n   8:        0x10828f7c2 - rustc::ty::context::tls::with_opt::h5ca54a02c4c0bb9b\r\n   9:        0x10828faf8 - rustc::util::bug::opt_span_bug_fmt::h8f8a983ed3203bff\r\n  10:        0x10828fa4b - rustc::util::bug::bug_fmt::h7fff681b74edf248\r\n  11:        0x10bc09e05 - rustc_codegen_ssa::back::write::OngoingCodegen<B>::join::hd601e779fa22708f\r\n  12:        0x10bc43d98 - <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_utils::codegen_backend::CodegenBackend>::join_codegen_and_link::hb5084914450219e0\r\n  13:        0x1070296d2 - rustc_interface::queries::Query<T>::compute::h79dc64dd1d20cdc1\r\n  14:        0x1070ede3c - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::link::hc53a9984fbe3c770\r\n  15:        0x106f5d224 - rustc_interface::interface::run_compiler_in_existing_thread_pool::hbcb4433730475c4a\r\n  16:        0x106f90744 - std::thread::local::LocalKey<T>::with::hfc60cc57f753f9b0\r\n  17:        0x106fa6228 - syntax::with_globals::h974a79eedc8d66fd\r\n  18:        0x106f381a7 - std::sys_common::backtrace::__rust_begin_short_backtrace::ha8d874bf2a6ac95b\r\n  19:        0x109967b4f - __rust_maybe_catch_panic\r\n  20:        0x106f5eeb7 - core::ops::function::FnOnce::call_once{{vtable.shim}}::hf166e26f2620097b\r\n  21:        0x10993bb1e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h2a90a69cfe4e95fa\r\n  22:        0x10996695e - std::sys::unix::thread::Thread::new::thread_start::h99953f013e830b09\r\n  23:     0x7fff7c8392eb - _pthread_body\r\n  24:     0x7fff7c83c249 - _pthread_start\r\nquery stack during panic:\r\nend of query stack\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.38.0-nightly (6a91782b7 2019-08-06) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C opt-level=3 -C panic=abort -C lto -C incremental -C link-arg=--export-table -C link-arg=--export=__heap_base --crate-type cdylib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nerror: Could not compile `node-runtime-wasm`.\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63349/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63349/timeline", "performed_via_github_app": null, "state_reason": "completed"}