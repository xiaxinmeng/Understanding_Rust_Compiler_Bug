{"url": "https://api.github.com/repos/rust-lang/rust/issues/83994", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83994/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83994/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83994/events", "html_url": "https://github.com/rust-lang/rust/issues/83994", "id": 853389540, "node_id": "MDU6SXNzdWU4NTMzODk1NDA=", "number": 83994, "title": "Exiting a process calls exit() which isn\u2019t thread-safe", "user": {"login": "DemiMarie", "id": 6395399, "node_id": "MDQ6VXNlcjYzOTUzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6395399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DemiMarie", "html_url": "https://github.com/DemiMarie", "followers_url": "https://api.github.com/users/DemiMarie/followers", "following_url": "https://api.github.com/users/DemiMarie/following{/other_user}", "gists_url": "https://api.github.com/users/DemiMarie/gists{/gist_id}", "starred_url": "https://api.github.com/users/DemiMarie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DemiMarie/subscriptions", "organizations_url": "https://api.github.com/users/DemiMarie/orgs", "repos_url": "https://api.github.com/users/DemiMarie/repos", "events_url": "https://api.github.com/users/DemiMarie/events{/privacy}", "received_events_url": "https://api.github.com/users/DemiMarie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 923282386, "node_id": "MDU6TGFiZWw5MjMyODIzODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/finished-final-comment-period", "name": "finished-final-comment-period", "color": "f9e189", "default": false, "description": "The final comment period is finished for this PR / Issue."}, {"id": 943968375, "node_id": "MDU6TGFiZWw5NDM5NjgzNzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/disposition-close", "name": "disposition-close", "color": "dd0000", "default": false, "description": "This PR / issue is in PFCP or FCP with a disposition to close it."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 62, "created_at": "2021-04-08T11:48:58Z", "updated_at": "2023-02-19T04:33:20Z", "closed_at": "2023-02-14T03:17:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On Unix-like platforms, `std::process::exit` [calls `libc::exit()`](https://github.com/rust-lang/rust/blob/db492ecd5ba6bd82205612cebb9034710653f0c2/library/std/src/sys/unix/os.rs#L634).  However, this can lead to undefined behavior in a multithreaded process.\r\n\r\nIn my case, this showed up as use-after-free crashes when running the testsuite for [RPM Oxide](/QubesOS/RPM-Oxide).  `librpm` registers an `atexit()` handler to clean up global resources, but this causes some of the resources to be freed while other threads are still using them.  Other projects have had similar issues, such as the Rust bindings for RocksDB.\r\n\r\nThe best answer I know of is to call `quick_exit` instead, which only calls functions registered with `at_quick_exit`.  Such functions should be safe to be called while other threads are running.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83994/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83994/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}