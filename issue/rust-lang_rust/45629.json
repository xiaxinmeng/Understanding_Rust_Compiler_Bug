{"url": "https://api.github.com/repos/rust-lang/rust/issues/45629", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45629/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45629/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45629/events", "html_url": "https://github.com/rust-lang/rust/issues/45629", "id": 269497493, "node_id": "MDU6SXNzdWUyNjk0OTc0OTM=", "number": 45629, "title": "link_dead_code flag breaks sodiumoxide build", "user": {"login": "andoriyu", "id": 148123, "node_id": "MDQ6VXNlcjE0ODEyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/148123?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andoriyu", "html_url": "https://github.com/andoriyu", "followers_url": "https://api.github.com/users/andoriyu/followers", "following_url": "https://api.github.com/users/andoriyu/following{/other_user}", "gists_url": "https://api.github.com/users/andoriyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/andoriyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andoriyu/subscriptions", "organizations_url": "https://api.github.com/users/andoriyu/orgs", "repos_url": "https://api.github.com/users/andoriyu/repos", "events_url": "https://api.github.com/users/andoriyu/events{/privacy}", "received_events_url": "https://api.github.com/users/andoriyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3422528123, "node_id": "LA_kwDOAAsO6M7L_6J7", "url": "https://api.github.com/repos/rust-lang/rust/labels/link-dead-code", "name": "link-dead-code", "color": "D4C5F9", "default": false, "description": "Linkage: using -Clink-dead-code"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2017-10-30T06:52:08Z", "updated_at": "2021-10-06T03:45:54Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When trying to disable dead code elimination project fails to build.\r\n\r\nTo be clear, this works:\r\n`cargo test --no-run`\r\nthis doesn't: \r\n`RUSTFLAGS=-Clink_dead_code cargo test --no-run`\r\n\r\n```\r\nBuild log:\r\n\r\nerror: linking with `cc` failed: exit code: 1\r\n  |\r\n  = note: \"cc\" \"-m64\" \"-L\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper0.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper1.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper10.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper11.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper12.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper13.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper14.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper15.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper2.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper3.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper4.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper5.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper6.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper7.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper8.rust-cgu.o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.libwhisper9.rust-cgu.o\" \"-o\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libwhisper-3838df784f3557e7.crate.allocator.rust-cgu.o\" \"-nodefaultlibs\" \"-L\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps\" \"-L\" \"/usr/local/Cellar/libsodium/1.0.15/lib\" \"-L\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libchrono-a2ac93e1e7f3829f.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libnum-c49ae6ecf79aff3b.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libnum_iter-529703f02f959052.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libnum_integer-ef7f59b4e3fd69a0.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libnom-d63d0bb4b90726c4.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libmemchr-90d85a68cc7f0681.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libtime-9ed328ba0dc074f6.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libnum_traits-5f9924077010f966.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libsodiumoxide-18211dc8e7914ec4.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libserde-9cbcd9e9b1f85d31.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/liblibsodium_sys-0b032eb7c19f6f3e.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libbytes-d7c1bd52839d451a.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libiovec-c288cddee47c6551.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/liblibc-1d475d610e8905d5.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libbyteorder-330a9355803e29d8.rlib\" \"/Users/andoriyu/Dev/Heaven/libwhisper-rs/target/debug/deps/libquick_error-8a3cabb77e931a5b.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libtest-191b92e1a25a742e.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libterm-16adb5ef965afad6.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libgetopts-f78c669374ceb40f.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libstd-a812896ed8dd253f.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libpanic_unwind-f80668a71535d14a.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liballoc_jemalloc-e7385b9dc1f6352a.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libunwind-fa5ca42c4beb9fd9.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liballoc_system-39205359e68fcafd.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liblibc-6d1727ccc0bf3375.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/liballoc-59037b68a5b9d10d.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libstd_unicode-db482e95dfaeb4c7.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/librand-6dde5ed2dcdc460f.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcore-ef96fd3d49f3c876.rlib\" \"/Users/andoriyu/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/x86_64-apple-darwin/lib/libcompiler_builtins-213aeb9cef9ff383.rlib\" \"-l\" \"sodium\" \"-l\" \"System\" \"-l\" \"resolv\" \"-l\" \"pthread\" \"-l\" \"c\" \"-l\" \"m\"\r\n  = note: Undefined symbols for architecture x86_64:\r\n            \"_crypto_stream_aes128ctr\", referenced from:\r\n                sodiumoxide::crypto::stream::aes128ctr::stream::h096683557c24d55a in libsodiumoxide-18211dc8e7914ec4.rlib(sodiumoxide-18211dc8e7914ec4.sodiumoxide1.rust-cgu.o)\r\n            \"_crypto_stream_aes128ctr_xor\", referenced from:\r\n                sodiumoxide::crypto::stream::aes128ctr::stream_xor::h446c7cf4f1728666 in libsodiumoxide-18211dc8e7914ec4.rlib(sodiumoxide-18211dc8e7914ec4.sodiumoxide1.rust-cgu.o)\r\n                sodiumoxide::crypto::stream::aes128ctr::stream_xor_inplace::h15e74395e3a300a9 in libsodiumoxide-18211dc8e7914ec4.rlib(sodiumoxide-18211dc8e7914ec4.sodiumoxide1.rust-cgu.o)\r\n          ld: symbol(s) not found for architecture x86_64\r\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n\r\nPretty odd...\r\n## Meta\r\n\r\n`rustc --version --verbose`:\r\n ```\r\nrustc 1.23.0-nightly (269cf5026 2017-10-28)\r\nbinary: rustc\r\ncommit-hash: 269cf5026cdac6ff47f886a948e99101316d7091\r\ncommit-date: 2017-10-28\r\nhost: x86_64-apple-darwin\r\nrelease: 1.23.0-nightly\r\nLLVM version: 4.0\r\n```\r\n`cargo --version --verbose`:\r\n```\r\ncargo 0.24.0-nightly (e5562ddb0 2017-10-26)\r\nrelease: 0.24.0\r\ncommit-hash: e5562ddb061b8eb5a0e754d702f164a1d42d0a21\r\ncommit-date: 2017-10-26\r\n```\r\n\r\nBacktrace:\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45629/timeline", "performed_via_github_app": null, "state_reason": null}