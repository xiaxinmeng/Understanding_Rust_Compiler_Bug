{"url": "https://api.github.com/repos/rust-lang/rust/issues/58958", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58958/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58958/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58958/events", "html_url": "https://github.com/rust-lang/rust/issues/58958", "id": 417566726, "node_id": "MDU6SXNzdWU0MTc1NjY3MjY=", "number": 58958, "title": "Incorrect span columns for `<` open angle bracket symbol", "user": {"login": "chinedufn", "id": 2099811, "node_id": "MDQ6VXNlcjIwOTk4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2099811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chinedufn", "html_url": "https://github.com/chinedufn", "followers_url": "https://api.github.com/users/chinedufn/followers", "following_url": "https://api.github.com/users/chinedufn/following{/other_user}", "gists_url": "https://api.github.com/users/chinedufn/gists{/gist_id}", "starred_url": "https://api.github.com/users/chinedufn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chinedufn/subscriptions", "organizations_url": "https://api.github.com/users/chinedufn/orgs", "repos_url": "https://api.github.com/users/chinedufn/repos", "events_url": "https://api.github.com/users/chinedufn/events{/privacy}", "received_events_url": "https://api.github.com/users/chinedufn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-06T00:32:59Z", "updated_at": "2019-03-06T02:32:30Z", "closed_at": "2019-03-06T02:32:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "This might be an issue for other tokens as well, I just ran into it for `<` open angle bracket.\r\n\r\nThe spans for the `<` token have incorrect columns. They appear to be one less than what the real value should be.\r\n\r\nI've reproduced the issue [in a minimal repository on GitHub](https://github.com/chinedufn/rustc-span-error).\r\n\r\n```sh\r\ngit clone https://github.com/chinedufn/rustc-span-error\r\ncd rustc-span-error\r\ncargo test # You'll see a failing test with the incorrect span column\r\n```\r\n\r\nI'll paste the code below since it's short:\r\n\r\nsrc/lib.rs\r\n\r\n```rust\r\n#![feature(proc_macro_hygiene)]\r\n\r\nuse proc_macro_example::example;\r\n\r\nfn foo () {\r\n    example! {\r\nABC<\r\n    }\r\n}\r\n\r\n#[cfg(test)]\r\nmod tests {\r\n    use super::*;\r\n    \r\n    #[test]\r\n    fn foo () {\r\n        \r\n    }\r\n}\r\n\r\n```\r\n\r\nproc macro\r\n\r\n```rust\r\n#![feature(proc_macro_span)]\r\n\r\nextern crate proc_macro;\r\n\r\nuse proc_macro::TokenStream;\r\nuse quote::quote;\r\n\r\n#[proc_macro]\r\npub fn example (input: TokenStream) -> TokenStream {\r\n    let mut tokens = input.into_iter();\r\n\r\n    // Assert ABC span start and end columns\r\n\r\n    let abc = tokens.next().unwrap();\r\n    assert_eq!(&abc.to_string(), \"ABC\");\r\n\r\n    assert_eq!(abc.span().start().column, 0);\r\n    assert_eq!(abc.span().end().column, 2);\r\n\r\n    // Assert `<` span start and end columns.\r\n    // This will fail\r\n    let bracket = tokens.next().unwrap();\r\n    assert_eq!(&bracket.to_string(), \"<\");\r\n\r\n    assert_eq!(bracket.span().end().column, 3);\r\n\r\n    let empty = quote! {\r\n    };\r\n\r\n    empty.into()\r\n}\r\n```", "closed_by": {"login": "chinedufn", "id": 2099811, "node_id": "MDQ6VXNlcjIwOTk4MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2099811?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chinedufn", "html_url": "https://github.com/chinedufn", "followers_url": "https://api.github.com/users/chinedufn/followers", "following_url": "https://api.github.com/users/chinedufn/following{/other_user}", "gists_url": "https://api.github.com/users/chinedufn/gists{/gist_id}", "starred_url": "https://api.github.com/users/chinedufn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chinedufn/subscriptions", "organizations_url": "https://api.github.com/users/chinedufn/orgs", "repos_url": "https://api.github.com/users/chinedufn/repos", "events_url": "https://api.github.com/users/chinedufn/events{/privacy}", "received_events_url": "https://api.github.com/users/chinedufn/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58958/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58958/timeline", "performed_via_github_app": null, "state_reason": "completed"}