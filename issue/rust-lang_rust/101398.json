{"url": "https://api.github.com/repos/rust-lang/rust/issues/101398", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/101398/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/101398/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/101398/events", "html_url": "https://github.com/rust-lang/rust/issues/101398", "id": 1360974862, "node_id": "I_kwDOAAsO6M5RHtQO", "number": 101398, "title": "Lack of warning for getting pointer on a temporary CString declared in array", "user": {"login": "PeakKS", "id": 48360696, "node_id": "MDQ6VXNlcjQ4MzYwNjk2", "avatar_url": "https://avatars.githubusercontent.com/u/48360696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PeakKS", "html_url": "https://github.com/PeakKS", "followers_url": "https://api.github.com/users/PeakKS/followers", "following_url": "https://api.github.com/users/PeakKS/following{/other_user}", "gists_url": "https://api.github.com/users/PeakKS/gists{/gist_id}", "starred_url": "https://api.github.com/users/PeakKS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PeakKS/subscriptions", "organizations_url": "https://api.github.com/users/PeakKS/orgs", "repos_url": "https://api.github.com/users/PeakKS/repos", "events_url": "https://api.github.com/users/PeakKS/events{/privacy}", "received_events_url": "https://api.github.com/users/PeakKS/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-09-03T22:33:53Z", "updated_at": "2022-09-03T22:33:53Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur.\r\n-->\r\n\r\nGiven the following code: <!-- Please provide a link to play.rust-lang.org -->\r\n\r\n```rust\r\nlet instance_layer_names: Vec<_> = [\r\n\tCString::new(\"VK_LAYER_KHRONOS_validation\").unwrap()\r\n].iter().map(|l| l.as_ptr()).collect();\r\n```\r\n\r\nThere is no error / warning reported, but the string is invalid. If I was to try to pass this variable to the InstanceCreateInfoBuilder in ash for example I would get an `ERROR_LAYER_NOT_PRESENT`.\r\n\r\nI was able to fix my code by splitting that expression as shown:\r\n```rust\r\nlet instance_layers = [\r\n    CString::new(\"VK_LAYER_KHRONOS_validation\").unwrap()\r\n];\r\n\r\nlet instance_layer_names: Vec<_> = instance_layers.iter().map(|l| l.as_ptr()).collect(); \r\n```\r\nWhile testing before writing this error report I noticed that if I have that new code alongside my original code the original code will actually work given that they both have the same string value.\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the assignment I was trying to do originally should give a warning/error, I assume the warning would be\r\n\r\n```\r\nwarning: getting the inner pointer of a temporary `CString`\r\n```\r\n\r\nsince that seems to be the cause of the issue.\r\n<!--\r\nIf the problem is not self-explanatory, please provide a rationale for the\r\nchange.\r\n-->\r\n\r\n<!--\r\nIf dramatically different output is caused by small changes, consider also\r\nadding them here.\r\n\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions. The output might also be\r\ndifferent depending on the Edition.\r\n-->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/101398/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/101398/timeline", "performed_via_github_app": null, "state_reason": null}