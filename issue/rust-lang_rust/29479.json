{"url": "https://api.github.com/repos/rust-lang/rust/issues/29479", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/29479/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/29479/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/29479/events", "html_url": "https://github.com/rust-lang/rust/issues/29479", "id": 114336534, "node_id": "MDU6SXNzdWUxMTQzMzY1MzQ=", "number": 29479, "title": "Linking error with MSVC build", "user": {"login": "eminence", "id": 402454, "node_id": "MDQ6VXNlcjQwMjQ1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/402454?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eminence", "html_url": "https://github.com/eminence", "followers_url": "https://api.github.com/users/eminence/followers", "following_url": "https://api.github.com/users/eminence/following{/other_user}", "gists_url": "https://api.github.com/users/eminence/gists{/gist_id}", "starred_url": "https://api.github.com/users/eminence/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eminence/subscriptions", "organizations_url": "https://api.github.com/users/eminence/orgs", "repos_url": "https://api.github.com/users/eminence/repos", "events_url": "https://api.github.com/users/eminence/events{/privacy}", "received_events_url": "https://api.github.com/users/eminence/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-10-30T19:13:06Z", "updated_at": "2015-12-01T17:41:48Z", "closed_at": "2015-11-04T17:20:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I think this is a duplicate #29126.   But given that the 1.4 release notes says the MSVC ABI build is \"supported and recommended for use\", I expected this to work out-of-the-box, so I'm opening a new issue to raise visibility:\n\nThe Rust 1.4 stable MSVC builds (and the 1.5 beta MSVC builds) fail to link a trivial hello world.  #29126 suggests a workaround (use `-O -C lto`), but I feel this shouldn't be needed.  \n\n```\nd:\\temp> which link\nC:/Program Files (x86)/Microsoft Visual Studio 11.0/VC/BIN/amd64/link.exe\n```\n\n```\nd:\\temp>link /v\nMicrosoft (R) Incremental Linker Version 11.00.61030.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n```\n\n```\nd:\\temp>\"c:\\Program Files\\Rust stable 1.4\\bin\\rustc.exe\" --verbose --version\nrustc 1.4.0 (8ab8581f6 2015-10-27)\nbinary: rustc\ncommit-hash: 8ab8581f6921bc7a8e3fa4defffd2814372dcb15\ncommit-date: 2015-10-27\nhost: x86_64-pc-windows-msvc\nrelease: 1.4.0\n```\n\n```\nd:\\temp\\lxd\\07>\"c:\\Program Files\\Rust stable 1.4\\bin\\rustc.exe\" a.rs\nerror: linking with `link.exe` failed: exit code: 1120\nnote: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio 11.0\\\\VC\\\\bin\\\\amd64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-\nwindows-msvc\\\\lib\" \"a.0.o\" \"/OUT:a.exe\" \"/OPT:REF,ICF\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rus\nt stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcollections-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_unic\node-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librand-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-\npc-windows-msvc\\\\lib\\\\liballoc-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc_system-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rus\nt stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-1bf6e69c.rlib\" \"C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-1bf6e69c.rli\nb\" \"/LIBPATH:C:\\\\Program Files\\\\Rust stable 1.4\\\\bin\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"/LIBPATH:d:\\\\temp\\\\lxd\\\\07\\\\.rust\\\\bin\\\\x86_64-pc-windows-msvc\" \"/LIBPATH:d:\\\\temp\\\\lxd\n\\\\07\\\\bin\\\\x86_64-pc-windows-msvc\" \"ws2_32.lib\" \"userenv.lib\" \"advapi32.lib\" \"kernel32.lib\" \"shell32.lib\" \"msvcrt.lib\" \"compiler-rt.lib\"\nnote: libstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol roundf referenced in function _ZN3f323f325round20h8f2525d3eaa87862SuaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol truncf referenced in function _ZN3f323f325trunc20he71016f6e44e57224uaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fmaf referenced in function _ZN3f323f327mul_add20hef17c31d888d4c9f5vaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol exp2f referenced in function _ZN3f323f324exp220hd5ee6b6a6fc0ee8a9xaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol log2f referenced in function _ZN3f323f324log220h020f4d063c57f47a1yaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol nextafterf referenced in function _ZN3f323f3210next_after20h2438fb468b5751e1IAaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fmaxf referenced in function _ZN3f323f323max20h90ff195b4fe3c593YAaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fminf referenced in function _ZN3f323f323min20hfe343509f74c9e57eBaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fdimf referenced in function _ZN3f323f327abs_sub20hb79223d09f0823d4uBaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol cbrtf referenced in function _ZN3f323f324cbrt20h3171361ebb799750KBaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol expm1f referenced in function _ZN3f323f326exp_m120he6dbf034b47f16e9kEaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol log1pf referenced in function _ZN3f323f325ln_1p20h701548988972eea4wEaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol round referenced in function _ZN3f643f645round20h7bb75ef14fe93cd8tMaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol trunc referenced in function _ZN3f643f645trunc20h07d947abf6906940FMaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fma referenced in function _ZN3f643f647mul_add20hf37ac3ca20f21cfa0NaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol exp2 referenced in function _ZN3f643f644exp220h073b1c4944189dbauPaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol log2 referenced in function _ZN3f643f644log220h72c1ea29e5809cc07PaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol nextafter referenced in function _ZN3f643f6410next_after20h8463c6f368b480f6zRaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fmax referenced in function _ZN3f643f643max20hed4839452134d534PRaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fmin referenced in function _ZN3f643f643min20h4def0ee29aefc2485RaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol fdim referenced in function _ZN3f643f647abs_sub20hc7ea4637b880bbeblSaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol cbrt referenced in function _ZN3f643f644cbrt20h2dff7e6a75df2df9BSaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol expm1 referenced in function _ZN3f643f646exp_m120hdc6db078df5aa789HUaE\nlibstd-1bf6e69c.rlib(std-1bf6e69c.0.o) : error LNK2019: unresolved external symbol log1p referenced in function _ZN3f643f645ln_1p20h237a6107417db16aTUaE\na.exe : fatal error LNK1120: 24 unresolved externals\n\nerror: aborting due to previous error\n```\n\nI can reproduce this issue with Visual Studio 2012, Visual Studio 2010, and Visual Studio 2008.\n\nThanks!\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/29479/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/29479/timeline", "performed_via_github_app": null, "state_reason": "completed"}