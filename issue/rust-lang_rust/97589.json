{"url": "https://api.github.com/repos/rust-lang/rust/issues/97589", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97589/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97589/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97589/events", "html_url": "https://github.com/rust-lang/rust/issues/97589", "id": 1254131192, "node_id": "I_kwDOAAsO6M5KwIX4", "number": 97589, "title": "rustc segmentation fault with circular module", "user": {"login": "xhalo32", "id": 15152190, "node_id": "MDQ6VXNlcjE1MTUyMTkw", "avatar_url": "https://avatars.githubusercontent.com/u/15152190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xhalo32", "html_url": "https://github.com/xhalo32", "followers_url": "https://api.github.com/users/xhalo32/followers", "following_url": "https://api.github.com/users/xhalo32/following{/other_user}", "gists_url": "https://api.github.com/users/xhalo32/gists{/gist_id}", "starred_url": "https://api.github.com/users/xhalo32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xhalo32/subscriptions", "organizations_url": "https://api.github.com/users/xhalo32/orgs", "repos_url": "https://api.github.com/users/xhalo32/repos", "events_url": "https://api.github.com/users/xhalo32/events{/privacy}", "received_events_url": "https://api.github.com/users/xhalo32/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-05-31T16:42:35Z", "updated_at": "2022-05-31T23:53:08Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "The rust compiler segfaults when using the [path attribute](https://doc.rust-lang.org/reference/items/modules.html#the-path-attribute) `#[path = \"this_file.rs\"]` pointing to itself with an inner line documentation comment in the file.\r\n\r\n## Steps to reproduce\r\n\r\nInstall this version of rust on linux:\r\n\r\n```\r\nrustc 1.60.0 (7737e0b5c 2022-04-04)\r\nbinary: rustc\r\ncommit-hash: 7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c\r\ncommit-date: 2022-04-04\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.60.0\r\nLLVM version: 14.0.0\r\n```\r\n\r\nCreate the following file structure:\r\n\r\n`lib.rs`:\r\n```rust\r\npub mod recursive;\r\n```\r\n\r\n`recursive.rs`:\r\n```rust\r\n//! this comment causes the circular dependency checker to break\r\n\r\n#[path = \"recursive.rs\"]\r\nmod recursive;\r\n```\r\n\r\nAnd compiling `lib.rs` will cause the segfault:\r\n\r\n```console\r\nrustc lib.rs\r\n```\r\n```\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x4b3d23)[0x7fbfcf6b3d23]\r\n/usr/lib/libc.so.6(+0x3e8e0)[0x7fbfcec318e0]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1fa8e30)[0x7fbfd11a8e30]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f95ba6)[0x7fbfd1195ba6]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvMs0_NtNtCsjVjzjquPLq5_11rustc_parse6parser4exprNtB7_6Parser21parse_assoc_expr_with+0x11b)[0x7fbfd11938fb]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x2005145)[0x7fbfd1205145]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f8ff53)[0x7fbfd118ff53]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvMNtNtCsjVjzjquPLq5_11rustc_parse6parser4attrNtB4_6Parser15parse_attribute+0x645)[0x7fbfd118eab5]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f8e021)[0x7fbfd118e021]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvMNtNtCsjVjzjquPLq5_11rustc_parse6parser4itemNtB4_6Parser9parse_mod+0x84)[0x7fbfd11baa44]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvNtCseWJ2MiKGUQh_12rustc_expand6module18parse_external_mod+0x46e)[0x7fbfd1c0060e]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f20ee2)[0x7fbfd1120ee2]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvXsk_NtCseWJ2MiKGUQh_12rustc_expand6expandNtB5_19InvocationCollectorNtNtCsnWACUGdVye_9rustc_ast9mut_visit10MutVisitor13flat_map_item+0x167)[0x7fbfd115a547]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x29ebad1)[0x7fbfd1bebad1]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f50ea8)[0x7fbfd1150ea8]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f212ce)[0x7fbfd11212ce]\r\n...\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(_RNvXsk_NtCseWJ2MiKGUQh_12rustc_expand6expandNtB5_19InvocationCollectorNtNtCsnWACUGdVye_9rustc_ast9mut_visit10MutVisitor13flat_map_item+0x167)[0x7fbfd115a547]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x29ebad1)[0x7fbfd1bebad1]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f50ea8)[0x7fbfd1150ea8]\r\n/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/bin/../lib/librustc_driver-75e5f32fc3580f6c.so(+0x1f212ce)[0x7fbfd11212ce]\r\nfish: Job 1, 'rustc lib.rs' terminated by signal SIGSEGV (Address boundary error)\r\n```\r\n\r\n## Notes\r\n\r\n- Segfault does not occur without the inner line documentation comment\r\n- Segfault does not occur with an outer line documentation comment on `pub mod recursive` in `lib.rs`\r\n- Segfault does not occur with `lib.rs` containing a circular module declaration to itself, rather requires another file", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97589/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97589/timeline", "performed_via_github_app": null, "state_reason": null}