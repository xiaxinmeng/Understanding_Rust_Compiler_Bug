{"url": "https://api.github.com/repos/rust-lang/rust/issues/103470", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103470/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103470/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103470/events", "html_url": "https://github.com/rust-lang/rust/issues/103470", "id": 1420535029, "node_id": "I_kwDOAAsO6M5Uq6T1", "number": 103470, "title": "Async fn implicit capture requirement is confusing", "user": {"login": "jkelleyrtp", "id": 10237910, "node_id": "MDQ6VXNlcjEwMjM3OTEw", "avatar_url": "https://avatars.githubusercontent.com/u/10237910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jkelleyrtp", "html_url": "https://github.com/jkelleyrtp", "followers_url": "https://api.github.com/users/jkelleyrtp/followers", "following_url": "https://api.github.com/users/jkelleyrtp/following{/other_user}", "gists_url": "https://api.github.com/users/jkelleyrtp/gists{/gist_id}", "starred_url": "https://api.github.com/users/jkelleyrtp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jkelleyrtp/subscriptions", "organizations_url": "https://api.github.com/users/jkelleyrtp/orgs", "repos_url": "https://api.github.com/users/jkelleyrtp/repos", "events_url": "https://api.github.com/users/jkelleyrtp/events{/privacy}", "received_events_url": "https://api.github.com/users/jkelleyrtp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2022-10-24T09:36:15Z", "updated_at": "2022-12-10T10:00:11Z", "closed_at": "2022-12-10T08:57:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've never really seen this documented anywhere, but as a result of \r\n\r\nhttps://github.com/rust-lang/rust/pull/60388 which solved https://github.com/rust-lang/rust/issues/60203,\r\n\r\nthere is now a weird discrepancy between regular fns and async fns when that makes it confusing to \"upgrade\" an fn to an async fn.\r\n\r\nIn particular, with implicit lifetimes, many users would not need to know about the `'_` lifetime being necessary. \r\n\r\nIn the simplest case, take this struct\r\n\r\n```rust\r\nstruct Context<'a> { inner: &'a Inner }\r\n```\r\n\r\nwith a regular fn, we can pass it into the arguments with complete elision\r\n```rust\r\nfn run(cx: Context) {}\r\n```\r\nHowever, if we want to upgrade the the function to be async:\r\n```rust\r\nasync fn run(cx: Context) {}\r\n```\r\nwe are greeted with an error:\r\n```\r\nerror[E0726]: implicit elided lifetime not allowed here\r\n  --> example.rs:71:20\r\n   |\r\n71 | async fn run(cx: Context) {}\r\n   |                    ^^^ expected lifetime parameter\r\n   |\r\n   = note: assuming a `'static` lifetime...\r\nhelp: indicate the anonymous lifetime\r\n   |\r\n71 | async fn run(cx: Context <'_>) {}\r\n   |                     ++++\r\n```\r\n\r\nThis is not an obvious error, especially given that for all other functions, NLL kicks in and this is never a requirement.\r\n\r\nI'd personally prefer to not require the elided lifetime on async fns when the regular fn does not need it either.\r\n\r\nIn 2019, this decision was made as a way of \"future proofing\" async and to fix a specific bug. However, I think for the sake of consistency, we should loosen the restrictions and allow NLL to work the same in async fns as it does in regular fns.", "closed_by": {"login": "jkelleyrtp", "id": 10237910, "node_id": "MDQ6VXNlcjEwMjM3OTEw", "avatar_url": "https://avatars.githubusercontent.com/u/10237910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jkelleyrtp", "html_url": "https://github.com/jkelleyrtp", "followers_url": "https://api.github.com/users/jkelleyrtp/followers", "following_url": "https://api.github.com/users/jkelleyrtp/following{/other_user}", "gists_url": "https://api.github.com/users/jkelleyrtp/gists{/gist_id}", "starred_url": "https://api.github.com/users/jkelleyrtp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jkelleyrtp/subscriptions", "organizations_url": "https://api.github.com/users/jkelleyrtp/orgs", "repos_url": "https://api.github.com/users/jkelleyrtp/repos", "events_url": "https://api.github.com/users/jkelleyrtp/events{/privacy}", "received_events_url": "https://api.github.com/users/jkelleyrtp/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103470/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103470/timeline", "performed_via_github_app": null, "state_reason": "completed"}