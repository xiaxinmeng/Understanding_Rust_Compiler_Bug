{"url": "https://api.github.com/repos/rust-lang/rust/issues/7152", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7152/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7152/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7152/events", "html_url": "https://github.com/rust-lang/rust/issues/7152", "id": 15591589, "node_id": "MDU6SXNzdWUxNTU5MTU4OQ==", "number": 7152, "title": "Server segfault when passing channels from inner tasks", "user": {"login": "jfager", "id": 23755, "node_id": "MDQ6VXNlcjIzNzU1", "avatar_url": "https://avatars.githubusercontent.com/u/23755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jfager", "html_url": "https://github.com/jfager", "followers_url": "https://api.github.com/users/jfager/followers", "following_url": "https://api.github.com/users/jfager/following{/other_user}", "gists_url": "https://api.github.com/users/jfager/gists{/gist_id}", "starred_url": "https://api.github.com/users/jfager/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jfager/subscriptions", "organizations_url": "https://api.github.com/users/jfager/orgs", "repos_url": "https://api.github.com/users/jfager/repos", "events_url": "https://api.github.com/users/jfager/events{/privacy}", "received_events_url": "https://api.github.com/users/jfager/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-06-15T13:28:29Z", "updated_at": "2013-07-23T03:24:17Z", "closed_at": "2013-07-23T03:23:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I'm running into an issue with a basic server where when I pass a channel out of a task spawned for each connection, the server will segfault on subsequent requests.  I'm probably doing The Wrong Thing here, but segfaulting from code that's not marked unsafe seems like a bug.   \n\nWould also appreciate feedback on the right way to have a task per connection with some way to pump data into it. \n\nCode recreating the issue is at https://gist.github.com/jfager/5788001, gdb backtrace below.\n\n```\nrust: task failed at 'option::unwrap none', /Users/jason/src/rust/src/libstd/option.rs:268\nrust: domain main @0x108800010 root task failed\nrust: task failed at 'killed', /Users/jason/src/rust/src/libstd/pipes.rs:286  \nrust: task failed at 'killed', /Users/jason/src/rust/src/libstd/pipes.rs:286\nrust: task failed at 'killed', /Users/jason/src/rust/src/libstd/pipes.rs:286\nrust: task failed at 'killed', /Users/jason/src/rust/src/libstd/pipes.rs:286\nrust: task failed at 'killed', /Users/jason/src/rust/src/libstd/pipes.rs:286\n\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x0000000000000000\n[Switching to process 4603 thread 0x1703]\n0x0000000000000000 in ?? ()\n(gdb) bt\n#0  0x0000000000000000 in ?? ()\n#1  0x000000010098bcf2 in uv__io_poll () at rust_task.cpp:1327\n#2  0x000000010097dac8 in uv_run () at rust_task.cpp:1327\n#3  0x00000001005a0ba1 in rust_uv_run__c_stack_shim ()\n#4  0x000000010097cd51 in __morestack () at rust_task.cpp:1327\n#5  0x000000010096d5de in rust_task::call_on_c_stack (this=0x100a0ca20, args=0x1, fn_ptr=0x1) at rust_task.h:484\n#6  0x000000010096de0f in upcall_call_shim_on_c_stack (args=0x1055ff0c8, fn_ptr=0x1055fde30) at rust_upcall.cpp:70\n#7  0x000000010064d7ee in uv_iotask::spawn_iotask::anon::expr_fn_21659 ()\n#8  0x0000000100660722 in uv_global_loop::spawn_loop::anon::anon::anon::expr_fn_23194 ()\n#9  0x00000001001c2590 in unstable::weak_task::weaken_task::_633e817ba3eab3b9::_07pre ()\n#10 0x0000000100215c2b in __morestack ()\n```\n", "closed_by": {"login": "jfager", "id": 23755, "node_id": "MDQ6VXNlcjIzNzU1", "avatar_url": "https://avatars.githubusercontent.com/u/23755?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jfager", "html_url": "https://github.com/jfager", "followers_url": "https://api.github.com/users/jfager/followers", "following_url": "https://api.github.com/users/jfager/following{/other_user}", "gists_url": "https://api.github.com/users/jfager/gists{/gist_id}", "starred_url": "https://api.github.com/users/jfager/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jfager/subscriptions", "organizations_url": "https://api.github.com/users/jfager/orgs", "repos_url": "https://api.github.com/users/jfager/repos", "events_url": "https://api.github.com/users/jfager/events{/privacy}", "received_events_url": "https://api.github.com/users/jfager/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7152/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7152/timeline", "performed_via_github_app": null, "state_reason": "completed"}