{"url": "https://api.github.com/repos/rust-lang/rust/issues/85194", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85194/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85194/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85194/events", "html_url": "https://github.com/rust-lang/rust/issues/85194", "id": 888360952, "node_id": "MDU6SXNzdWU4ODgzNjA5NTI=", "number": 85194, "title": "Stabilize RFC 2345: Allow panicking in constants", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 46, "created_at": "2021-05-11T19:37:53Z", "updated_at": "2021-09-08T01:15:54Z", "closed_at": "2021-06-22T16:37:36Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# Stabilization report\r\n\r\n## \ud83d\uded1  Issue with Rust 2021 \ud83d\uded1 \r\n\r\n[Stabilization is currently **blocked** on resolving how this works with Rust 2021](https://github.com/rust-lang/rust/issues/85194#issuecomment-852345377)\r\n\r\n## Summary\r\n\r\nThis feature allows panicking within constants and reporting a custom message as a compile-time error.\r\n\r\nThe following code will become valid on stable:\r\n\r\n```rust\r\nconst fn foo(val: u8) {\r\n    assert!(val == 1, \"val is not 1\");\r\n}\r\n\r\nconst MSG: &str = \"custom message\";\r\n\r\nconst _: () = std::panic!(MSG);\r\nconst _: () = panic!(\"custom message\");\r\n```\r\n\r\nThe message looks like:\r\n\r\n```\r\nerror: any use of this value will cause an error\r\n --> src/main.rs:4:15\r\n  |\r\n4 | const _: () = std::panic!(MSG);\r\n  | --------------^^^^^^^^^^^^^^^^-\r\n  |               |\r\n  |               the evaluated program panicked at 'custom message', src/main.rs:4:15\r\n  |\r\n  = note: `#[deny(const_err)]` on by default\r\n  = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\r\n  = note: for more information, see issue #71800 <https://github.com/rust-lang/rust/issues/71800>\r\n  = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n```\r\n\r\nMotivation for this RFC can be found here: https://rust-lang.github.io/rfcs/2345-const-panic.html#motivation\r\n\r\nMore examples can be found here: https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/const_panic.rs\r\n\r\n## Edge cases & tests\r\n\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/panic-never-type.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/const-eval/panic-assoc-never-type.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/issue-66693.rs\r\n- https://github.com/rust-lang/rust/blob/673d0db5e393e9c64897005b470bfeb6d5aec61b/src/test/ui/consts/control-flow/short-circuit-let.rs\r\n\r\n## Some questions which should be resolved in the future\r\n\r\nWe have some \"unresolved questions\" but they aren't an actual blocker.\r\n\r\n\r\n- Should there be some additional message in the error about this being a panic turned error?\r\n   Or do we just produce the exact message the panic would produce?\r\n- This change becomes really useful if `Result::unwrap` and `Option::unwrap` become `const fn`, doing both in one go might be a good idea.\r\n\r\nSee the brief summary comment here: https://github.com/rust-lang/rust/issues/51999#issuecomment-790543959\r\n\r\n_Originally posted by @JohnTitor in https://github.com/rust-lang/rust/issues/51999#issuecomment-826346762_", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85194/reactions", "total_count": 22, "+1": 11, "-1": 0, "laugh": 0, "hooray": 6, "confused": 0, "heart": 5, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85194/timeline", "performed_via_github_app": null, "state_reason": "completed"}