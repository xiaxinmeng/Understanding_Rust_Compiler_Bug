{"url": "https://api.github.com/repos/rust-lang/rust/issues/108109", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/108109/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/108109/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/108109/events", "html_url": "https://github.com/rust-lang/rust/issues/108109", "id": 1586895933, "node_id": "I_kwDOAAsO6M5elhw9", "number": 108109, "title": "Diagnostic when Fn*-family trait bounds is missing parens could be improved", "user": {"login": "Fishrock123", "id": 1093990, "node_id": "MDQ6VXNlcjEwOTM5OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1093990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Fishrock123", "html_url": "https://github.com/Fishrock123", "followers_url": "https://api.github.com/users/Fishrock123/followers", "following_url": "https://api.github.com/users/Fishrock123/following{/other_user}", "gists_url": "https://api.github.com/users/Fishrock123/gists{/gist_id}", "starred_url": "https://api.github.com/users/Fishrock123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Fishrock123/subscriptions", "organizations_url": "https://api.github.com/users/Fishrock123/orgs", "repos_url": "https://api.github.com/users/Fishrock123/repos", "events_url": "https://api.github.com/users/Fishrock123/events{/privacy}", "received_events_url": "https://api.github.com/users/Fishrock123/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 27424086, "node_id": "MDU6TGFiZWwyNzQyNDA4Ng==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-parser", "name": "A-parser", "color": "f7e101", "default": false, "description": "Area: The parsing of Rust source code to an AST."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-02-16T02:29:37Z", "updated_at": "2023-02-18T02:21:07Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Code\r\n\r\n```Rust\r\nfn handle<F>() where F: FnOnce -> () {}\r\n```\r\n\r\n\r\n### Current output\r\n\r\n```Shell\r\nerror: expected one of `(`, `+`, `,`, `::`, `<`, or `{`, found `->`\r\n --> src/main.rs:1:32\r\n  |\r\n1 | fn handle<F>() where F: FnOnce -> () {}\r\n  |                                ^^ expected one of `(`, `+`, `,`, `::`, `<`, or `{`\r\n```\r\n\r\n\r\n### Desired output\r\n\r\n```Shell\r\nerror: expected `(`, found `->`\r\n --> src/main.rs:1:32\r\n  |\r\n1 | fn handle<F>() where F: FnOnce -> () {}\r\n  |                               ^ `Fn*`-family trait bounds must be followed by parentheses\r\nhelp: try using parenthesis here:\r\n  |\r\n1 | fn handle<F>() where F: FnOnce() -> () {}\r\n  |                               ^^\r\n```\r\n\r\n\r\n### Rationale and extra context\r\n\r\nIt feels like rustc should be able to determine that a trait followed by a `->` is a `Fn*`-family trait bound and be able to suggest this behavior. If that is too general it could just check for `Fn`, `FnOnce`, `FnMut`.\r\n\r\n### Other cases\r\n\r\n~~Not that i know of...~~\r\n\r\nVery similar is if parenthesis are missing from regular `fn` declarations:\r\n```Shell\r\nerror: expected one of `(` or `<`, found `->`\r\n --> src/lib.rs:3:9\r\n  |\r\n3 | fn main -> () {}\r\n  |         ^^ expected one of `(` or `<`\r\n```\r\n\r\n\r\n### Anything else?\r\n\r\nAlso happens on nightly according to Rust Playground.\r\n\r\nI'd like to try my hand at implementing this diagnostic, but I'll likely need a little bit of locational guidance. A naive code search show that the message is emitted by this code is the parser diagnostics, but I'm not sure if the adjustment would need to be made within that or from where it is invoked in this case.\r\nhttps://github.com/rust-lang/rust/blob/c5283576ec18937d98889679a54aa8f2dee2b875/compiler/rustc_parse/src/parser/diagnostics.rs#L384-L388\r\n\r\n----\r\n\r\n_Edit: Updated to use the wording \"`Fn*`-family trait bounds\" rather than \"HRTBs\"._", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/108109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/108109/timeline", "performed_via_github_app": null, "state_reason": null}