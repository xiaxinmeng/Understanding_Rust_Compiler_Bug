{"url": "https://api.github.com/repos/rust-lang/rust/issues/65051", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65051/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65051/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65051/events", "html_url": "https://github.com/rust-lang/rust/issues/65051", "id": 501927220, "node_id": "MDU6SXNzdWU1MDE5MjcyMjA=", "number": 65051, "title": "Build with pure LLVM toolchain on Linux", "user": {"login": "markand", "id": 11919008, "node_id": "MDQ6VXNlcjExOTE5MDA4", "avatar_url": "https://avatars.githubusercontent.com/u/11919008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markand", "html_url": "https://github.com/markand", "followers_url": "https://api.github.com/users/markand/followers", "following_url": "https://api.github.com/users/markand/following{/other_user}", "gists_url": "https://api.github.com/users/markand/gists{/gist_id}", "starred_url": "https://api.github.com/users/markand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markand/subscriptions", "organizations_url": "https://api.github.com/users/markand/orgs", "repos_url": "https://api.github.com/users/markand/repos", "events_url": "https://api.github.com/users/markand/events{/privacy}", "received_events_url": "https://api.github.com/users/markand/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2019-10-03T08:35:16Z", "updated_at": "2020-01-28T00:28:44Z", "closed_at": "2019-10-28T08:19:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nI'm creating a Linux distribution that does not use GCC and use LLVM/Clang and their libraries by default (libc++, libc++abi, compiler-rt and libunwind). No libstdc++ or gcc installed. The distribution is based on musl as well.\r\n\r\nI'd like to build rust with that pure LLVM toolchain and since nobody did that before I'm having few issues and unable to find many resource on this topic. Alpine Linux also build with musl but they still use GCC instead.\r\n\r\nWhat I've tried:\r\n\r\n1. I've downloaded the prebuilt musl image from the official binaries and installed in a temporary location.\r\n\r\n```\r\nwget https://static.rust-lang.org/dist/rust-1.37.0-x86_64-unknown-linux-musl.tar.gz\r\ntar xf rust-1.37.0-x86_64-unknown-linux-musl.tar.gz\r\ncd rust-1.37.0-x86_64-unknown-linux-musl && ./install --prefix= --destdir=/tmp/bootstrap-rust\r\n```\r\n\r\n2. I've downloaded rust sources and configured the config.toml before build:\r\n\r\n```\r\nwget http://static.rust-lang.org/dist/rustc-1.37.0-src.tar.gz\r\ntar xf rustc-1.37.0-src.tar.gz\r\n```\r\n\r\nThe config.toml:\r\n\r\n```\r\ncat > rustc-1.37.0-src/config.toml <<EOF\r\n[build]\r\nrustc = \"/tmp/bootstrap-rust/bin/rustc\"\r\ncargo = \"/tmp/bootstrap-rust/bin/cargo\"\r\npython = \"/bin/python\"\r\nbuild = 'x86_64-unknown-linux-musl'\r\nhost = ['x86_64-unknown-linux-musl']\r\ntarget = ['x86_64-unknown-linux-musl']\r\nvendor = true\r\n\r\n[install]\r\nprefix = \"\"\r\n\r\n[rust]\r\nchannel = \"stable\"\r\nrpath = false\r\ncodegen-tests = false\r\nverbose-tests = false\r\ndefault-linker = \"clang\"\r\nllvm-libunwind = true\r\n\r\n[dist]\r\nsrc-tarball = false\r\n\r\n[llvm]\r\nstatic-libstdcpp = false\r\nninja = true\r\nuse-libcxx = true\r\nlink-shared = true\r\n\r\n[target.x86_64-unknown-linux-musl]\r\ncc = clang\r\ncxx = clang++\r\nlinker = clang\r\nllvm-config = \"/bin/llvm-config\"\r\ncrt-static = false\r\nEOF\r\n```\r\n\r\n3. Then trying to build using `./x.py build` will abort not finding -lgcc_s (which unsurprisingly, does not exist).\r\n\r\n```\r\nerror: linking with `clang` failed: exit code: 1\r\n  |\r\n  = note: \"clang\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-Wl,--eh-frame-hdr\" \"-m64\" \"-L\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.0.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.1.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.10.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.11.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.12.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.13.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.14.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.15.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.2.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.3.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.4.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.5.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.6.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.7.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.8.rcgu.o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.build_script_build.qjbobtg7-cgu.9.rcgu.o\" \"-o\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/build/proc-macro2-b821ea8110df742f/build_script_build-b821ea8110df742f.813shqno7rs2e7d.rcgu.o\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-nodefaultlibs\" \"-L\" \"/src/vanilla/lang/rust/rustc-1.37.0-src/build/bootstrap/debug/deps\" \"-L\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libstd-9a431e54f29d011f.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libpanic_unwind-541cee8c5b6f056a.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libbacktrace-9b9843a21c950d24.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libbacktrace_sys-f4f15dbb47e9d653.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/librustc_demangle-53359f68302a289b.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libhashbrown-dfa7f1d62fd88f75.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/librustc_std_workspace_alloc-c6c7bf94cfe1287c.rlib\" \"/tmp/rustcihQO53/libunwind-c02db0b699a2e957.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libcfg_if-ffad3faca04b6ecf.rlib\" \"/tmp/rustcihQO53/liblibc-63baa27af2c30c40.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/liballoc-c55e6587bce48104.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/librustc_std_workspace_core-e2f6ada331b532fd.rlib\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libcore-06ad1fc9bd858d00.rlib\" \"-Wl,--end-group\" \"/src/vanilla/lang/rust/bootstrap/lib/rustlib/x86_64-unknown-linux-musl/lib/libcompiler_builtins-2ec319ee584bfdc0.rlib\" \"-Wl,-Bdynamic\" \"-lgcc_s\" \"-lc\"\r\n  = note: ld.lld: error: unable to find library -lgcc\r\n          clang-8: error: linker command failed with exit code 1 (use -v to see invocation)\r\n\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `syn`.\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `proc-macro2`.\r\n```\r\n\r\nWhat should I do to force linking against libunwind, libc++abi rather than GCC equivalents?", "closed_by": {"login": "markand", "id": 11919008, "node_id": "MDQ6VXNlcjExOTE5MDA4", "avatar_url": "https://avatars.githubusercontent.com/u/11919008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/markand", "html_url": "https://github.com/markand", "followers_url": "https://api.github.com/users/markand/followers", "following_url": "https://api.github.com/users/markand/following{/other_user}", "gists_url": "https://api.github.com/users/markand/gists{/gist_id}", "starred_url": "https://api.github.com/users/markand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/markand/subscriptions", "organizations_url": "https://api.github.com/users/markand/orgs", "repos_url": "https://api.github.com/users/markand/repos", "events_url": "https://api.github.com/users/markand/events{/privacy}", "received_events_url": "https://api.github.com/users/markand/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65051/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65051/timeline", "performed_via_github_app": null, "state_reason": "completed"}