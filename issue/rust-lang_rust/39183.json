{"url": "https://api.github.com/repos/rust-lang/rust/issues/39183", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/39183/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/39183/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/39183/events", "html_url": "https://github.com/rust-lang/rust/issues/39183", "id": 201893666, "node_id": "MDU6SXNzdWUyMDE4OTM2NjY=", "number": 39183, "title": "#![cfg] to disable a crate disables #![no_std]", "user": {"login": "retep998", "id": 666308, "node_id": "MDQ6VXNlcjY2NjMwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/666308?v=4", "gravatar_id": "", "url": "https://api.github.com/users/retep998", "html_url": "https://github.com/retep998", "followers_url": "https://api.github.com/users/retep998/followers", "following_url": "https://api.github.com/users/retep998/following{/other_user}", "gists_url": "https://api.github.com/users/retep998/gists{/gist_id}", "starred_url": "https://api.github.com/users/retep998/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/retep998/subscriptions", "organizations_url": "https://api.github.com/users/retep998/orgs", "repos_url": "https://api.github.com/users/retep998/repos", "events_url": "https://api.github.com/users/retep998/events{/privacy}", "received_events_url": "https://api.github.com/users/retep998/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234948, "node_id": "MDU6TGFiZWwyMzQ5NDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-attributes", "name": "A-attributes", "color": "f7e101", "default": false, "description": "Area: #[attributes(..)]"}, {"id": 178802147, "node_id": "MDU6TGFiZWwxNzg4MDIxNDc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-needs-decision", "name": "I-needs-decision", "color": "e11d21", "default": false, "description": "Issues in need of decision."}, {"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-01-19T15:37:31Z", "updated_at": "2021-07-14T04:00:25Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Using `#![cfg]` to disable a crate on platforms where it makes no sense is usually a great idea. That way people can unconditionally depend on your crate and use it only on the targets where it is needed. However it disables the entire crate, including all global attributes, which means normally a crate that has `#![no_std]` wouldn't depend on std, but if you use `#![cfg]` to disable that crate, suddenly it does depend on std! The only workaround is to not use `#![cfg]` and instead manually disable each item in the `lib.rs`, except for specific attributes like `#![no_std]`.\r\n\r\nFor example:\r\n```Rust\r\n// rustc foo.rs --crate-type=rlib\r\n#![no_std]\r\n#![cfg(any())]\r\n```\r\n```Rust\r\n// rustc bar.rs -Zprint-link-args -Lcrate=current_directory\r\n#![no_std]\r\nextern crate foo;\r\nfn main() {}\r\n```\r\nObserve as libstd is passed to the linker despite both crates using `#![no_std]`.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/39183/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/39183/timeline", "performed_via_github_app": null, "state_reason": null}