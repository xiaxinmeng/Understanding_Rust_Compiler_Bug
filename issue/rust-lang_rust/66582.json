{"url": "https://api.github.com/repos/rust-lang/rust/issues/66582", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/66582/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/66582/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/66582/events", "html_url": "https://github.com/rust-lang/rust/issues/66582", "id": 526084558, "node_id": "MDU6SXNzdWU1MjYwODQ1NTg=", "number": 66582, "title": "`Copy` as a parent trait has weird simplification rules", "user": {"login": "reinerp", "id": 777239, "node_id": "MDQ6VXNlcjc3NzIzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/777239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reinerp", "html_url": "https://github.com/reinerp", "followers_url": "https://api.github.com/users/reinerp/followers", "following_url": "https://api.github.com/users/reinerp/following{/other_user}", "gists_url": "https://api.github.com/users/reinerp/gists{/gist_id}", "starred_url": "https://api.github.com/users/reinerp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reinerp/subscriptions", "organizations_url": "https://api.github.com/users/reinerp/orgs", "repos_url": "https://api.github.com/users/reinerp/repos", "events_url": "https://api.github.com/users/reinerp/events{/privacy}", "received_events_url": "https://api.github.com/users/reinerp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-11-20T19:28:08Z", "updated_at": "2019-11-20T19:33:21Z", "closed_at": "2019-11-20T19:33:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "This compiles, which it should:\r\n\r\n```rust\r\ntrait Tr1 {}\r\ntrait Tr2: Tr1 {}\r\n\r\nstruct A<T>(T);\r\n\r\nimpl<T> Tr1 for A<T> where T: Tr1 {}\r\nimpl<T> Tr2 for A<T> where T: Tr2 {}\r\n\r\nstruct B<T>(A<T>);\r\n\r\nimpl<T> Tr1 for B<T> where A<T>: Tr1 {}\r\nimpl<T> Tr2 for B<T> where A<T>: Tr2 {}\r\n\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=f835c3c0b83ba608cca84f9bcf42a650))\r\n\r\nNow replace Tr1 with Copy, and #[derive] it instead of implementing it manually. You get this, which fails to compile:\r\n\r\n```rust\r\ntrait Tr2: Copy {}\r\n\r\n#[derive(Clone, Copy)]\r\nstruct A<T>(T);\r\n\r\nimpl<T> Tr2 for A<T> where T: Tr2 {}\r\n\r\n#[derive(Clone, Copy)]\r\nstruct B<T>(A<T>);\r\n\r\nimpl<T> Tr2 for B<T> where A<T>: Tr2 {}\r\n\r\n```\r\n\r\n([Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=98a37830457736ebbb7dfd6bfc19855d))\r\n\r\nErrors:\r\n\r\n```\r\n   Compiling playground v0.0.1 (/playground)\r\nerror[E0277]: the trait bound `T: std::marker::Copy` is not satisfied\r\n  --> src/lib.rs:11:9\r\n   |\r\n11 | impl<T> Tr2 for B<T> where A<T>: Tr2 {}\r\n   |         ^^^ the trait `std::marker::Copy` is not implemented for `T`\r\n   |\r\n   = help: consider adding a `where T: std::marker::Copy` bound\r\n   = note: required because of the requirements on the impl of `std::marker::Copy` for `B<T>`\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0277`.\r\nerror: could not compile `playground`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\n```\r\n\r\nThe latter should compile as well. \r\n\r\nInstances like this come up naturally when writing deriving macros: it's natural to write the constraint of the form `A<T>: Tr2` because that's the constraint on the underlying field. However, that fails to compile, and so it has to be rewritten to the form `T: Tr` which is not possible to produce by a proc-macro deriving.", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/66582/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/66582/timeline", "performed_via_github_app": null, "state_reason": "completed"}