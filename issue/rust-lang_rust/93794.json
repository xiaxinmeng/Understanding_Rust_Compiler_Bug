{"url": "https://api.github.com/repos/rust-lang/rust/issues/93794", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93794/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93794/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93794/events", "html_url": "https://github.com/rust-lang/rust/issues/93794", "id": 1128054427, "node_id": "I_kwDOAAsO6M5DPL6b", "number": 93794, "title": "Nightly fails to infer the type of iterator collect & impl IntoIterator, and gives confusing error message", "user": {"login": "wwylele", "id": 4592895, "node_id": "MDQ6VXNlcjQ1OTI4OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/4592895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wwylele", "html_url": "https://github.com/wwylele", "followers_url": "https://api.github.com/users/wwylele/followers", "following_url": "https://api.github.com/users/wwylele/following{/other_user}", "gists_url": "https://api.github.com/users/wwylele/gists{/gist_id}", "starred_url": "https://api.github.com/users/wwylele/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wwylele/subscriptions", "organizations_url": "https://api.github.com/users/wwylele/orgs", "repos_url": "https://api.github.com/users/wwylele/repos", "events_url": "https://api.github.com/users/wwylele/events{/privacy}", "received_events_url": "https://api.github.com/users/wwylele/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}, {"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 631673608, "node_id": "MDU6TGFiZWw2MzE2NzM2MDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-impl-trait", "name": "A-impl-trait", "color": "f7e101", "default": false, "description": "Area: impl Trait. Universally / existentially quantified anonymous types with static dispatch."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2022-02-09T04:58:10Z", "updated_at": "2022-02-11T20:01:39Z", "closed_at": "2022-02-11T20:01:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\n\r\n### Code\r\n\r\nI tried this code:\r\n\r\n```rust\r\nfn foo(b: bool) -> impl IntoIterator<Item = ()> {\r\n    if b {\r\n        return vec![()];\r\n    }\r\n    [()].into_iter().collect()\r\n}\r\n```\r\n\r\nI expected to see this happen: The code compiles (as it does on stable and beta). The compiler could infer the return type from the first return statement (`Vec<()>`), and successfully collect the iterator into it in the second return.\r\n\r\nInstead, this happened: \r\nThe compiler seems to have trouble to infer the type of the second return, and gives confusing messages. Instead of explaining that it cannot infer the type (which can be understandable given some update in the library), it gives some serious complaint that the given type doesn't support this kind of operation.\r\n```\r\nerror[[E0277]](https://doc.rust-lang.org/nightly/error-index.html#E0277): a value of type `impl IntoIterator<Item = ()>` cannot be built from an iterator over elements of type `()`\r\n    --> src/lib.rs:5:22\r\n     |\r\n5    |     [()].into_iter().collect()\r\n     |                      ^^^^^^^ value of type `impl IntoIterator<Item = ()>` cannot be built from `std::iter::Iterator<Item=()>`\r\n     |\r\n     = help: the trait `FromIterator<()>` is not implemented for `impl IntoIterator<Item = ()>`\r\nnote: required by a bound in `collect`\r\n\r\nFor more information about this error, try `rustc --explain E0277`.\r\nerror: could not compile `playground` due to previous error\r\n```\r\n\r\n### Version it worked on\r\n\r\nIt most recently worked on: Stable version: 1.58.1, 1.59.0-beta.6(2022-02-02 0426998f5fc4b95dfec5)\r\n\r\n### Version with regression\r\n\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.60.0-nightly (0c292c966 2022-02-08)\r\nbinary: rustc\r\ncommit-hash: 0c292c9667f1b202a9150d58bdd2e89e3e803996\r\ncommit-date: 2022-02-08\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.60.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\n\r\n\r\n@rustbot modify labels: +regression-from-stable-to-nightly -regression-untriaged", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93794/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 3, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93794/timeline", "performed_via_github_app": null, "state_reason": "completed"}