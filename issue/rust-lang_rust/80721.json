{"url": "https://api.github.com/repos/rust-lang/rust/issues/80721", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80721/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80721/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80721/events", "html_url": "https://github.com/rust-lang/rust/issues/80721", "id": 779159343, "node_id": "MDU6SXNzdWU3NzkxNTkzNDM=", "number": 80721, "title": "linker `rust-lld` not found", "user": {"login": "greyltc", "id": 16778174, "node_id": "MDQ6VXNlcjE2Nzc4MTc0", "avatar_url": "https://avatars.githubusercontent.com/u/16778174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greyltc", "html_url": "https://github.com/greyltc", "followers_url": "https://api.github.com/users/greyltc/followers", "following_url": "https://api.github.com/users/greyltc/following{/other_user}", "gists_url": "https://api.github.com/users/greyltc/gists{/gist_id}", "starred_url": "https://api.github.com/users/greyltc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greyltc/subscriptions", "organizations_url": "https://api.github.com/users/greyltc/orgs", "repos_url": "https://api.github.com/users/greyltc/repos", "events_url": "https://api.github.com/users/greyltc/events{/privacy}", "received_events_url": "https://api.github.com/users/greyltc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2021-01-05T15:13:49Z", "updated_at": "2021-01-05T18:00:28Z", "closed_at": "2021-01-05T18:00:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm building on Arch Linux (x86_64) and I've built rust 1.49.0 with the following config.toml:\r\n```\r\n[build]\r\ntarget = [\"x86_64-unknown-linux-gnu\", \"wasm32-unknown-unknown\"]\r\nextended = true\r\ndocs = false\r\nsanitizers = false\r\nprofiler = true\r\nvendor = true\r\n\r\n[rust]\r\nchannel = \"stable\"\r\nrpath = false\r\n\r\n[install]\r\nprefix = \"/usr\"\r\n\r\n[target.x86_64-unknown-linux-gnu]\r\nllvm-config = \"/usr/bin/llvm-config\"\r\n\r\n[target.wasm32-unknown-unknown]\r\nllvm-config = \"/usr/bin/llvm-config\"\r\nwasi-root = \"/usr/lib/wasi\"\r\nprofiler = false\r\n```\r\nI've actually tried building it twice. Once with the above and once without the `llvm-config` lines, both give me the same problem.\r\n\r\nI'm using the latest wasm-pack, 0.9.1.\r\n\r\nWhen I cd into https://github.com/rustwasm/wasm-bindgen/tree/master/examples/without-a-bundler\r\nand run `wasm-pack build --target web`:\r\n```\r\n$ wasm-pack build --target web\r\n[INFO]: Checking for the Wasm target...\r\n[INFO]: Compiling to Wasm...\r\n   Compiling proc-macro2 v1.0.24\r\n   Compiling unicode-xid v0.2.1\r\n   Compiling wasm-bindgen-shared v0.2.69 (wasm-bindgen-0.2.69/crates/shared)\r\n   Compiling log v0.4.11\r\n   Compiling syn v1.0.57\r\n   Compiling cfg-if v0.1.10\r\n   Compiling lazy_static v1.4.0\r\n   Compiling bumpalo v3.4.0\r\n   Compiling wasm-bindgen v0.2.69 (wasm-bindgen-0.2.69)\r\n   Compiling cfg-if v1.0.0\r\n   Compiling quote v1.0.8\r\n   Compiling wasm-bindgen-backend v0.2.69 (wasm-bindgen-0.2.69/crates/backend)\r\n   Compiling wasm-bindgen-macro-support v0.2.69 (wasm-bindgen-0.2.69/crates/macro-support)\r\n   Compiling wasm-bindgen-macro v0.2.69 (wasm-bindgen-0.2.69/crates/macro)\r\n   Compiling js-sys v0.3.46 (wasm-bindgen-0.2.69/crates/js-sys)\r\n   Compiling web-sys v0.3.46 (wasm-bindgen-0.2.69/crates/web-sys)\r\n   Compiling without-a-bundler v0.1.0 (wasm-bindgen-0.2.69/examples/without-a-bundler)\r\nerror: linker `rust-lld` not found\r\n  |\r\n  = note: No such file or directory (os error 2)\r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `without-a-bundler`\r\n\r\nTo learn more, run the command again with --verbose.\r\nError: Compiling your crate to WebAssembly failed\r\nCaused by: failed to execute `cargo build`: exited with exit code: 101\r\n  full command: \"cargo\" \"build\" \"--lib\" \"--release\" \"--target\" \"wasm32-unknown-unknown\"\r\n\r\n```\r\n\r\nSome person here thinks this is a problem with the rust compiler: https://github.com/rustwasm/wasm-pack/issues/754#issuecomment-565806364\r\n\r\nIt seems like that's true, because this thread explains what the gentoo packagers did to their rust package work around this problem: \r\nhttps://bugs.gentoo.org/715348\r\n(tldr: `sed -i '/linker:/ s/rust-lld/wasm-ld/' src/librustc_target/spec/wasm32_base.rs`)\r\n\r\nThe only place I can find a file called rust-lld is `rustc-1.49.0-src/build/x86_64-unknown-linux-gnu/stage0/lib/rustlib/x86_64-unknown-linux-gnu/bin/rust-lld` after I build, but that just seems like a build artifact that never gets installed anywhere. Am I missing something special that I have to do to get rust-lld deployed/installed properly? Have I done something wrong in my config.toml file or otherwise?\r\n\r\nNote that\r\n`RUSTFLAGS=\"-C linker=lld\" wasm-pack build --target web`\r\nworks for me but\r\n`RUSTFLAGS=\"-C linker=wasm-ld\" wasm-pack build --target web`\r\nfails with some error about something needing to be build with `-fPIC` and a warning that \"creating shared libraries, with -shared, is not yet stable\"\r\nNeeding to override RUSTFLAGS to fix a (broken?) default linker doesn't feel like an actual solution.", "closed_by": {"login": "greyltc", "id": 16778174, "node_id": "MDQ6VXNlcjE2Nzc4MTc0", "avatar_url": "https://avatars.githubusercontent.com/u/16778174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/greyltc", "html_url": "https://github.com/greyltc", "followers_url": "https://api.github.com/users/greyltc/followers", "following_url": "https://api.github.com/users/greyltc/following{/other_user}", "gists_url": "https://api.github.com/users/greyltc/gists{/gist_id}", "starred_url": "https://api.github.com/users/greyltc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/greyltc/subscriptions", "organizations_url": "https://api.github.com/users/greyltc/orgs", "repos_url": "https://api.github.com/users/greyltc/repos", "events_url": "https://api.github.com/users/greyltc/events{/privacy}", "received_events_url": "https://api.github.com/users/greyltc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80721/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80721/timeline", "performed_via_github_app": null, "state_reason": "completed"}