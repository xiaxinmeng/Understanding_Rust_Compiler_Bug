{"url": "https://api.github.com/repos/rust-lang/rust/issues/78808", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78808/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78808/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78808/events", "html_url": "https://github.com/rust-lang/rust/issues/78808", "id": 737770190, "node_id": "MDU6SXNzdWU3Mzc3NzAxOTA=", "number": 78808, "title": "Error on deriving PartialEq on Foo and then implementing it for dyn Foo", "user": {"login": "frostblooded", "id": 8089067, "node_id": "MDQ6VXNlcjgwODkwNjc=", "avatar_url": "https://avatars.githubusercontent.com/u/8089067?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frostblooded", "html_url": "https://github.com/frostblooded", "followers_url": "https://api.github.com/users/frostblooded/followers", "following_url": "https://api.github.com/users/frostblooded/following{/other_user}", "gists_url": "https://api.github.com/users/frostblooded/gists{/gist_id}", "starred_url": "https://api.github.com/users/frostblooded/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frostblooded/subscriptions", "organizations_url": "https://api.github.com/users/frostblooded/orgs", "repos_url": "https://api.github.com/users/frostblooded/repos", "events_url": "https://api.github.com/users/frostblooded/events{/privacy}", "received_events_url": "https://api.github.com/users/frostblooded/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-11-06T13:48:11Z", "updated_at": "2023-04-08T07:18:04Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\ntrait Foo {}\r\n\r\nimpl PartialEq for dyn Foo {\r\n    fn eq (self: &'_ Self, _: &'_ Self) -> bool { false }\r\n}\r\n\r\n#[derive(PartialEq)]\r\nstruct Bar {\r\n    __: ::std::rc::Rc<dyn Foo>,\r\n}\r\nfn main () {}\r\n```\r\n\r\nI expected to see this happen:\r\n\r\nA working `PartialEq` derived implementation for `Bar`.\r\n\r\nInstead, this happened:\r\nAn error was thrown:\r\n\r\n```rust\r\nerror[E0507]: cannot move out of `*__self_1_0` which is behind a shared reference\r\n --> src/main.rs:9:5\r\n  |\r\n9 |     __: ::std::rc::Rc<dyn Foo>,\r\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^ move occurs because `*__self_1_0` has type `Rc<dyn Foo>`, which does not implement the `Copy` trait\r\n  |\r\n  = note: this error originates in a derive macro (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0507`.\r\nerror: could not compile `playground`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n### Meta\r\nThe bug is present on nightly and stable in the two versions I tried:\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.49.0-nightly (ffa2e7ae8 2020-10-24)\r\nbinary: rustc\r\ncommit-hash: ffa2e7ae8fbf9badc035740db949b9dae271c29f\r\ncommit-date: 2020-10-24\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.49.0-nightly\r\nLLVM version: 11.0\r\n```\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.46.0 (04488afe3 2020-08-24)\r\nbinary: rustc\r\ncommit-hash: 04488afe34512aa4c33566eb16d8c912a3ae04f9\r\ncommit-date: 2020-08-24\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.46.0\r\nLLVM version: 10.0\r\n```\r\n\r\nBacktrace doesn't show anything different than the error.\r\nHere is the reproducable code: https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=a4d7bd689ed0687e24533f956f7a5971\r\n@danielhenrymantilla seemed interested in the issue.\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78808/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78808/timeline", "performed_via_github_app": null, "state_reason": null}