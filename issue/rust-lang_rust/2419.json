{"url": "https://api.github.com/repos/rust-lang/rust/issues/2419", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2419/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2419/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2419/events", "html_url": "https://github.com/rust-lang/rust/issues/2419", "id": 4695800, "node_id": "MDU6SXNzdWU0Njk1ODAw", "number": 2419, "title": "Don't use external node ids in crate metadata", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2012-05-22T17:44:19Z", "updated_at": "2015-06-12T23:55:00Z", "closed_at": "2015-06-12T23:55:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I believe one of the reasons linking is so flaky right now is because we encode data about external crates using their external node ids, which are not stable.\n\nFor example if crate A uses type foo from crate B, when we write A's metadata we will refer to foo as node 3048 (for example). When B is recompiled foo will probably get a different node ID, while A still refers to the old ID.\n\nWhen we later link a different crate to crate A the metadata reader runs off the rails chasing bogus node ID's in crate B.\n\nHere's what I think is the easiest way to fix this within the current design:\n\n1) define a new cryptographic hash, node_hash, that hashes the type signature and path of a node\n2) when we write a crate's metadata, we also write a table that maps from the node hash to the node id\n3) when we write a crate's metadata, we also write a table that maps all used external def ids to node hashes\n4) when looking up a node in crate B via crate A we first translate A's notion of B's node id to the node hash, then look up the node hash in crate B to find the actual, current node id.\n", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2419/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2419/timeline", "performed_via_github_app": null, "state_reason": "completed"}