{"url": "https://api.github.com/repos/rust-lang/rust/issues/93032", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93032/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93032/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93032/events", "html_url": "https://github.com/rust-lang/rust/issues/93032", "id": 1106883927, "node_id": "I_kwDOAAsO6M5B-bVX", "number": 93032, "title": "The size of `(T, Infallible)` is not zero", "user": {"login": "EFanZh", "id": 2160692, "node_id": "MDQ6VXNlcjIxNjA2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2160692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EFanZh", "html_url": "https://github.com/EFanZh", "followers_url": "https://api.github.com/users/EFanZh/followers", "following_url": "https://api.github.com/users/EFanZh/following{/other_user}", "gists_url": "https://api.github.com/users/EFanZh/gists{/gist_id}", "starred_url": "https://api.github.com/users/EFanZh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EFanZh/subscriptions", "organizations_url": "https://api.github.com/users/EFanZh/orgs", "repos_url": "https://api.github.com/users/EFanZh/repos", "events_url": "https://api.github.com/users/EFanZh/events{/privacy}", "received_events_url": "https://api.github.com/users/EFanZh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 32, "created_at": "2022-01-18T13:02:41Z", "updated_at": "2023-02-16T09:50:32Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Since `Infallible` is an [empty type](https://doc.rust-lang.org/nomicon/exotic-sizes.html#empty-types), I expect `(T, Infallible)` also be an empty type, thus they should have the same size. But I noticed that `(T, Infallible)` have the same size as `T`, so currently, we have\r\n\r\n- `mem::size_of::<Option<Infallible>>() == 0`\r\n- `mem::size_of::<Option<(u32, Infallible)>>() = 8`\r\n\r\nI guess this is because Rust treats empty type to have size 0, so the size of `(T, Infallible)` is size of `T` plus size of `Infallible` equals size of `T`. May be we can use something like `Option<usize>` to represent the size of a type internally, where `None` means the size of an empty type, in this way, we can distinguish empty types from zero sized types. For example, internally, we can have a function like:\r\n\r\n```rust\r\nfn internal_size_of<T>() -> Option<usize> { ... }\r\n```\r\n\r\nTo keep the current behavior of `mem::size_of`, it can be implemented as:\r\n\r\n```rust\r\nfn size_of<T>() {\r\n    internal_size_of::<T>().unwrap_or(0)\r\n}\r\n```", "closed_by": {"login": "EFanZh", "id": 2160692, "node_id": "MDQ6VXNlcjIxNjA2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/2160692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/EFanZh", "html_url": "https://github.com/EFanZh", "followers_url": "https://api.github.com/users/EFanZh/followers", "following_url": "https://api.github.com/users/EFanZh/following{/other_user}", "gists_url": "https://api.github.com/users/EFanZh/gists{/gist_id}", "starred_url": "https://api.github.com/users/EFanZh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/EFanZh/subscriptions", "organizations_url": "https://api.github.com/users/EFanZh/orgs", "repos_url": "https://api.github.com/users/EFanZh/repos", "events_url": "https://api.github.com/users/EFanZh/events{/privacy}", "received_events_url": "https://api.github.com/users/EFanZh/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93032/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93032/timeline", "performed_via_github_app": null, "state_reason": null}