{"url": "https://api.github.com/repos/rust-lang/rust/issues/50645", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/50645/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/50645/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/50645/events", "html_url": "https://github.com/rust-lang/rust/issues/50645", "id": 322195215, "node_id": "MDU6SXNzdWUzMjIxOTUyMTU=", "number": 50645, "title": "TERM=dumb is not respected for warnings in diagnostic annotations", "user": {"login": "andreastt", "id": 399120, "node_id": "MDQ6VXNlcjM5OTEyMA==", "avatar_url": "https://avatars.githubusercontent.com/u/399120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreastt", "html_url": "https://github.com/andreastt", "followers_url": "https://api.github.com/users/andreastt/followers", "following_url": "https://api.github.com/users/andreastt/following{/other_user}", "gists_url": "https://api.github.com/users/andreastt/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreastt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreastt/subscriptions", "organizations_url": "https://api.github.com/users/andreastt/orgs", "repos_url": "https://api.github.com/users/andreastt/repos", "events_url": "https://api.github.com/users/andreastt/events{/privacy}", "received_events_url": "https://api.github.com/users/andreastt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2018-05-11T07:23:41Z", "updated_at": "2018-05-11T12:25:23Z", "closed_at": "2018-05-11T12:17:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "It appears the `TERM=dumb` environment variable is not respected by librustc_errors\u2019 diagnostic annotations for warnings, hints, fatal errors, et al.\r\n\r\nThe below example of compiling a random program I\u2019ve authored shows that the string \u201cCompiling\u201d correctly does not get colourised. This is because it uses termcolor\u2019s [`ColorChoice::Auto`](https://docs.rs/termcolor/0.3.6/termcolor/enum.ColorChoice.html#Auto.v) which cancels colourisation because it checks if the terminal is dumb.\r\n\r\nFarther down in the example, the string starting with \u201cwarning\u201d emits a lot of escape sequences for colourisation.\r\n\r\nFor reference, so-called [\u201cdumb terminals\u201d](https://en.wikipedia.org/wiki/Computer_terminal#Dumb_terminals) are terminals that only recognise a limited subset of escape sequences. In my particular case it is the monochrome [rc](https://en.wikipedia.org/wiki/Rc) shell.\r\n\r\n```\r\n% TERM=dumb cargo build\r\n   Compiling build_const v0.2.0\r\n   Compiling cfg-if v0.1.2\r\n   Compiling matches v0.1.6\r\n   Compiling cc v1.0.9\r\n   Compiling num-traits v0.2.0\r\n   Compiling version_check v0.1.3\r\n   Compiling adler32 v1.0.2\r\n   Compiling void v1.0.2\r\n   Compiling unicode-normalization v0.1.5\r\n   Compiling libc v0.2.39\r\n   Compiling percent-encoding v1.0.0\r\n   Compiling lazy_static v1.0.0\r\n   Compiling safemem v0.2.0\r\n   Compiling byteorder v1.2.1\r\n   Compiling typeable v0.1.2\r\n   Compiling language-tags v0.2.2\r\n   Compiling traitobject v0.1.0\r\n   Compiling semver-parser v0.7.0\r\n   Compiling regex-syntax v0.4.1\r\n   Compiling unicode-width v0.1.4\r\n   Compiling httparse v1.2.3\r\n   Compiling utf8-ranges v1.0.0\r\n   Compiling strsim v0.6.0\r\n   Compiling unicode-segmentation v1.1.0\r\n   Compiling bitflags v1.0.1\r\n   Compiling geckodriver v0.20.1 (file:///home/ato/src/gecko/testing/geckodriver)\r\n   Compiling podio v0.1.5\r\n   Compiling rustc-serialize v0.3.24\r\n   Compiling log v0.4.1\r\n   Compiling unreachable v1.0.0\r\n   Compiling unicode-bidi v0.3.4\r\n   Compiling crc v1.7.0\r\n   Compiling base64 v0.6.0\r\n   Compiling unicase v1.4.2\r\n   Compiling num-traits v0.1.43\r\n   Compiling miniz_oxide v0.1.2\r\n   Compiling memchr v1.0.2\r\n   Compiling rand v0.3.18\r\n   Compiling num_cpus v1.7.0\r\n   Compiling time v0.1.38\r\n   Compiling term_size v0.3.0\r\n   Compiling semver v0.6.0\r\n   Compiling thread_local v0.3.5\r\n   Compiling num-integer v0.1.35\r\n   Compiling textwrap v0.9.0\r\n   Compiling aho-corasick v0.6.3\r\n   Compiling log v0.3.9\r\n   Compiling rust-ini v0.10.2\r\n   Compiling miniz_oxide_c_api v0.1.2\r\n   Compiling bzip2-sys v0.1.6\r\n   Compiling idna v0.1.4\r\n   Compiling tempdir v0.3.5\r\n   Compiling cookie v0.10.1\r\n   Compiling msdos_time v0.1.5\r\n   Compiling num-iter v0.1.34\r\n   Compiling num v0.1.40\r\n   Compiling mozprofile v0.3.0 (file:///home/ato/src/gecko/testing/mozbase/rust/mozprofile)\r\n   Compiling mime v0.2.6\r\n   Compiling regex v0.2.2\r\n   Compiling clap v2.29.0\r\n   Compiling chrono v0.2.25\r\n   Compiling flate2 v1.0.1\r\n   Compiling mozrunner v0.6.1 (file:///home/ato/src/gecko/testing/mozbase/rust/mozrunner)\r\n   Compiling bzip2 v0.3.2\r\n   Compiling url v1.7.0\r\n   Compiling uuid v0.1.18\r\n   Compiling zip v0.3.1\r\n   Compiling hyper v0.10.13\r\n   Compiling mozversion v0.1.3 (file:///home/ato/src/gecko/testing/mozbase/rust/mozversion)\r\n   Compiling webdriver v0.35.0 (file:///home/ato/src/gecko/testing/webdriver)\r\n\u001b[0m\u001b[1m\u001b[33mwarning\u001b[0m\u001b[0m\u001b[1m: variant is never constructed: `Quit`\u001b[0m\r\n\u001b[0m  \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m--> \u001b[0m\u001b[0mtesting/webdriver/src/server.rs:23:5\u001b[0m\r\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\r\n\u001b[0m\u001b[1m\u001b[38;5;12m23\u001b[0m\u001b[0m \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m| \u001b[0m\u001b[0m    Quit\u001b[0m\r\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m| \u001b[0m\u001b[0m    \u001b[0m\u001b[0m\u001b[1m\u001b[33m^^^^\u001b[0m\r\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m|\u001b[0m\r\n\u001b[0m   \u001b[0m\u001b[0m\u001b[1m\u001b[38;5;12m= \u001b[0m\u001b[0m\u001b[1mnote\u001b[0m\u001b[0m: #[warn(dead_code)] on by default\u001b[0m\r\n\r\n    Finished dev [optimized + debuginfo] target(s) in 58.60 secs\r\n```", "closed_by": {"login": "andreastt", "id": 399120, "node_id": "MDQ6VXNlcjM5OTEyMA==", "avatar_url": "https://avatars.githubusercontent.com/u/399120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andreastt", "html_url": "https://github.com/andreastt", "followers_url": "https://api.github.com/users/andreastt/followers", "following_url": "https://api.github.com/users/andreastt/following{/other_user}", "gists_url": "https://api.github.com/users/andreastt/gists{/gist_id}", "starred_url": "https://api.github.com/users/andreastt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andreastt/subscriptions", "organizations_url": "https://api.github.com/users/andreastt/orgs", "repos_url": "https://api.github.com/users/andreastt/repos", "events_url": "https://api.github.com/users/andreastt/events{/privacy}", "received_events_url": "https://api.github.com/users/andreastt/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/50645/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/50645/timeline", "performed_via_github_app": null, "state_reason": "completed"}