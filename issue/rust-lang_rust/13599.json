{"url": "https://api.github.com/repos/rust-lang/rust/issues/13599", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13599/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13599/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13599/events", "html_url": "https://github.com/rust-lang/rust/issues/13599", "id": 31812185, "node_id": "MDU6SXNzdWUzMTgxMjE4NQ==", "number": 13599, "title": "ICE for closure / proc confusion", "user": {"login": "wackywendell", "id": 245071, "node_id": "MDQ6VXNlcjI0NTA3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/245071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wackywendell", "html_url": "https://github.com/wackywendell", "followers_url": "https://api.github.com/users/wackywendell/followers", "following_url": "https://api.github.com/users/wackywendell/following{/other_user}", "gists_url": "https://api.github.com/users/wackywendell/gists{/gist_id}", "starred_url": "https://api.github.com/users/wackywendell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wackywendell/subscriptions", "organizations_url": "https://api.github.com/users/wackywendell/orgs", "repos_url": "https://api.github.com/users/wackywendell/repos", "events_url": "https://api.github.com/users/wackywendell/events{/privacy}", "received_events_url": "https://api.github.com/users/wackywendell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2014-04-18T17:31:01Z", "updated_at": "2014-04-22T15:36:32Z", "closed_at": "2014-04-22T15:36:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Here is a minimal program:\n\n``` rust\nfn main() {\n    let nums = range(0,20);\n    let tasks = nums.map(proc(n) {n * 2});\n}\n```\n\nThe map function takes a closure, not a proc, but attempting to compile this results in an internal compiler error instead of a nice error message:\n\n```\n% rustc fail-minimal.rs                                                                                   :(\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://static.rust-lang.org/doc/master/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'assertion failed: `(left == right) && (right == left)` (left: `many`, right: `once`)', /build/rust-git/src/rust/src/librustc/util/ppaux.rs:288\nstack backtrace:\n   1:     0x7f097a174840 - rt::backtrace::imp::write::h225c71396cf30389qRa::v0.11.pre\n   2:     0x7f097a0d6080 - rt::unwind::begin_unwind_inner::hf394975089b9a10eTra::v0.11.pre\n   3:     0x7f097a0d5d00 - rt::unwind::begin_unwind_fmt::h22fcbc95e0e545013qa::v0.11.pre\n   4:     0x7f097adbfdc0 - util::ppaux::ty_to_str::hb592748f8815eef7Kqh::v0.11.pre\n   5:     0x7f097b034bf0 - middle::typeck::infer::InferCtxt$LT$$x27a$GT$::type_error_message::hffb9b35c27d4e338a3o::v0.11.pre\n   6:     0x7f097b034dd0 - middle::typeck::infer::InferCtxt$LT$$x27a$GT$::report_mismatched_types::h45758484dd0f6fe8h4o::v0.11.pre\n   7:     0x7f097affc5f0 - middle::typeck::check::demand::coerce::hd054c5403efa6f47b64::v0.11.pre\n   8:     0x7f097b03ede0 - <unknown>\n   9:     0x7f097b035740 - <unknown>\n  10:     0x7f097b03f500 - <unknown>\n  11:     0x7f097b03f0d0 - <unknown>\n  12:     0x7f097b035740 - <unknown>\n  13:     0x7f097b051820 - middle::typeck::check::check_decl_local::h81452c953e041c17Zzb::v0.11.pre\n  14:     0x7f097b051aa0 - middle::typeck::check::check_stmt::h65a68c6329bac3deVBb::v0.11.pre\n  15:     0x7f097b018040 - middle::typeck::check::check_block_with_expected::hf05f59868eb31121SFb::v0.11.pre\n  16:     0x7f097b013730 - <unknown>\n  17:     0x7f097b0134d0 - <unknown>\n  18:     0x7f097b00e830 - middle::typeck::check::check_item::h7712d586a1e77a108w7::v0.11.pre\n  19:     0x7f097b0133b0 - middle::typeck::check::check_item_types::hb0c38d033c99a851Ae7::v0.11.pre\n  20:     0x7f097b153720 - <unknown>\n  21:     0x7f097b152100 - middle::typeck::check_crate::h518ccce325ef460746t::v0.11.pre\n  22:     0x7f097b591aa0 - driver::driver::phase_3_run_analysis_passes::h23bc51a4fd4272a46qe::v0.11.pre\n  23:     0x7f097b5984b0 - driver::driver::compile_input::heeaf2ac59f6fbbc71Pe::v0.11.pre\n  24:     0x7f097b5bc9a0 - run_compiler::h81631b1befd18d82lom::v0.11.pre\n  25:     0x7f097b5d40a0 - <unknown>\n  26:     0x7f097b5d29d0 - <unknown>\n  27:     0x7f097b5ce2b0 - <unknown>\n  28:     0x7f097a803b00 - <unknown>\n  29:     0x7f097a16f870 - <unknown>\n  30:     0x7f097a17b430 - rust_try\n  31:     0x7f097a16f6b0 - rt::task::Task::run::h19b19c7dd158dbfefi8::v0.11.pre\n  32:     0x7f097a8038d0 - <unknown>\n  33:     0x7f097a173380 - <unknown>\n  34:     0x7f09779abfe0 - start_thread\n  35:     0x7f0979daace9 - clone\n  36:                0x0 - <unknown>\n```\n\nThis looks superficially similar to #8516 and #9400, but AFAICT they aren't the same.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13599/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13599/timeline", "performed_via_github_app": null, "state_reason": "completed"}