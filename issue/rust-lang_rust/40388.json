{"url": "https://api.github.com/repos/rust-lang/rust/issues/40388", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40388/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40388/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40388/events", "html_url": "https://github.com/rust-lang/rust/issues/40388", "id": 213045360, "node_id": "MDU6SXNzdWUyMTMwNDUzNjA=", "number": 40388, "title": "not deterministic link", "user": {"login": "Dushistov", "id": 156697, "node_id": "MDQ6VXNlcjE1NjY5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/156697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dushistov", "html_url": "https://github.com/Dushistov", "followers_url": "https://api.github.com/users/Dushistov/followers", "following_url": "https://api.github.com/users/Dushistov/following{/other_user}", "gists_url": "https://api.github.com/users/Dushistov/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dushistov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dushistov/subscriptions", "organizations_url": "https://api.github.com/users/Dushistov/orgs", "repos_url": "https://api.github.com/users/Dushistov/repos", "events_url": "https://api.github.com/users/Dushistov/events{/privacy}", "received_events_url": "https://api.github.com/users/Dushistov/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-03-09T14:00:59Z", "updated_at": "2017-03-10T04:19:18Z", "closed_at": "2017-03-10T04:19:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I build my cdylib library for `--target=arm-linux-androideabi`, and use `C` function `__android_log_write` that defined in `liblog.so`, to link with this library I used such lines in `build.rs`:\r\n\r\n```rust\r\nfn main() {\r\n    println!(\"cargo:rustc-link-lib=log\");\r\n}\r\n```\r\n\r\nas result `cargo  build --target=arm-linux-androideabi --release -v -v`\r\n\r\n`\r\n Running `rustc --crate-name test1 src/lib.rs --crate-type cdylib --emit=dep-info,link -C opt-level=3 -C metadata=36666f232376dc62 -C extra-filename=-36666f232376dc62 --out-dir /tmp/test1/target/arm-linux-androideabi/release/deps --target arm-linux-androideabi -C linker=arm-linux-androideabi-gcc -L dependency=/tmp/test1/target/arm-linux-androideabi/release/deps -L dependency=/tmp/test1/target/release/deps --extern geographic=/tmp/test1/target/arm-linux-androideabi/release/deps/libgeographic-57909743d7165dde.rlib --extern rustc_serialize=/tmp/test1/target/arm-linux-androideabi/release/deps/librustc_serialize-bd7ffb5a7ba50190.rlib --extern test1=/tmp/test1/target/arm-linux-androideabi/release/deps/libtest1-5d587ead258f43a9.rlib --extern log=/tmp/test1/target/arm-linux-androideabi/release/deps/liblog-99976f5c52edad5f.rlib -L native=/tmp/test1/android/src/obj/local/armeabi -l static=cpp_wrapper_for_rust -l log -l jnigraphics -l skia_android -l gnustl_shared -l atomic -L native=/tmp/test1/target/arm-linux-androideabi/release/build/libsqlite3-sys-33444e481ea6b9bd/out``\r\n\r\nas you can see there `-l log`, but resulted `.so` library not contains reference to `liblog.so`:\r\n```sh\r\narm-linux-androideabi-readelf -d ../target/arm-linux-androideabi/release/libtest1.so  | grep NEEDED\r\n 0x00000001 (NEEDED)                     Shared library: [libskia_android.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libgnustl_shared.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libdl.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libc.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libm.so]\r\n```\r\nbut if remove all temporary files, and rebuild: `git clean -d -f -x && cargo  build --target=arm-linux-androideabi --release`, I got:\r\n```sh\r\nrustc --crate-name test1 src/lib.rs --crate-type cdylib --emit=dep-info,link -C opt-level=3 -C metadata=36666f232376dc62 -C extra-filename=-36666f232376dc62 --out-dir /tmp/test1/target/arm-linux-androideabi/release/deps --target arm-linux-androideabi -C linker=arm-linux-androideabi-gcc -L dependency=/tmp/test1/target/arm-linux-androideabi/release/deps -L dependency=/tmp/test1/target/release/deps --extern test1=/tmp/test1/target/arm-linux-androideabi/release/deps/libtest1-5d587ead258f43a9.rlib --extern log=/tmp/test1/target/arm-linux-androideabi/release/deps/liblog-99976f5c52edad5f.rlib --extern geographic=/tmp/test1/target/arm-linux-androideabi/release/deps/libgeographic-57909743d7165dde.rlib --extern rustc_serialize=/tmp/test1/target/arm-linux-androideabi/release/deps/librustc_serialize-bd7ffb5a7ba50190.rlib -L native=/tmp/test1/android/src/obj/local/armeabi -l static=cpp_wrapper_for_rust -l log -l jnigraphics -l skia_android -l gnustl_shared -l atomic -L native=/tmp/test1/target/arm-linux-androideabi/release/build/libsqlite3-sys-33444e481ea6b9bd/out\r\n\r\narm-linux-androideabi-readelf -d ../target/arm-linux-androideabi/release/libtest1.so  | grep NEEDED\r\n 0x00000001 (NEEDED)                     Shared library: [liblog.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libjnigraphics.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libskia_android.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libgnustl_shared.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libdl.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libc.so]\r\n 0x00000001 (NEEDED)                     Shared library: [libm.so]\r\n```\r\n\r\n```sh\r\n$ rustc --version --verbose\r\nrustc 1.16.0-beta.3 (ecbf0b59e 2017-03-02)\r\nbinary: rustc\r\ncommit-hash: ecbf0b59e409af1a09c1c7c3947858c5e78f416d\r\ncommit-date: 2017-03-02\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.16.0-beta.3\r\nLLVM version: 3.9\r\n```\r\n\r\nSo what is going on, why `liblog.so` appear or disappear depending on some cached files?\r\n\r\nAlso the same thing happend with jnigraphics library,\r\nI link with it in the same way: `    println!(\"cargo:rustc-link-lib=jnigraphics\");`", "closed_by": {"login": "Dushistov", "id": 156697, "node_id": "MDQ6VXNlcjE1NjY5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/156697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dushistov", "html_url": "https://github.com/Dushistov", "followers_url": "https://api.github.com/users/Dushistov/followers", "following_url": "https://api.github.com/users/Dushistov/following{/other_user}", "gists_url": "https://api.github.com/users/Dushistov/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dushistov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dushistov/subscriptions", "organizations_url": "https://api.github.com/users/Dushistov/orgs", "repos_url": "https://api.github.com/users/Dushistov/repos", "events_url": "https://api.github.com/users/Dushistov/events{/privacy}", "received_events_url": "https://api.github.com/users/Dushistov/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40388/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40388/timeline", "performed_via_github_app": null, "state_reason": "completed"}