{"url": "https://api.github.com/repos/rust-lang/rust/issues/84213", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84213/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84213/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84213/events", "html_url": "https://github.com/rust-lang/rust/issues/84213", "id": 858595258, "node_id": "MDU6SXNzdWU4NTg1OTUyNTg=", "number": 84213, "title": "Casting owned type to raw pointer has unclear error message", "user": {"login": "nschoellhorn", "id": 3925180, "node_id": "MDQ6VXNlcjM5MjUxODA=", "avatar_url": "https://avatars.githubusercontent.com/u/3925180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nschoellhorn", "html_url": "https://github.com/nschoellhorn", "followers_url": "https://api.github.com/users/nschoellhorn/followers", "following_url": "https://api.github.com/users/nschoellhorn/following{/other_user}", "gists_url": "https://api.github.com/users/nschoellhorn/gists{/gist_id}", "starred_url": "https://api.github.com/users/nschoellhorn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nschoellhorn/subscriptions", "organizations_url": "https://api.github.com/users/nschoellhorn/orgs", "repos_url": "https://api.github.com/users/nschoellhorn/repos", "events_url": "https://api.github.com/users/nschoellhorn/events{/privacy}", "received_events_url": "https://api.github.com/users/nschoellhorn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-04-15T07:44:02Z", "updated_at": "2021-04-16T08:01:52Z", "closed_at": "2021-04-16T08:01:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur. \r\n-->\r\n\r\nGiven the following code: <!-- Please provide a link to play.rust-lang.org -->\r\n\r\n```rust\r\nstruct Something {\r\n    pub field: u32,\r\n}\r\n\r\nfn main() {\r\n    let something = Something {\r\n        field: 1337,\r\n    };\r\n    \r\n    let pointer_to_something = something as *const Something;\r\n}\r\n```\r\nhttps://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=1a1c55703dee4ed2078b5c704bd1f379\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0605]: non-primitive cast: `Something` as `*const Something`\r\n  --> src/main.rs:10:41\r\n   |\r\n10 |     let pointer_to_something = something as *const Something;\r\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ an `as` expression can only be used to convert between primitive types or to coerce to a specific trait object\r\n```\r\n\r\nI think, that in the context of casting to a pointer, the output in this case should make it clear that the error could be fixed by taking a reference to the type and cast the reference to a raw pointer.  \r\nExample:\r\n\r\n```\r\nerror[E0605]: non-primitive cast: `Something` as `*const Something`\r\n  --> src/main.rs:10:41\r\n   |\r\n10 |     let pointer_to_something = something as *const Something;\r\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot cast an owned type to a raw pointer\r\n   |     consider borrowing here: &something as *const Something\r\n```\r\n\r\n<!--\r\nIf the problem is not self-explanatory, please provide a rationale for the\r\nchange.\r\n-->\r\n\r\n<!--\r\nIf dramatically different output is caused by small changes, consider also\r\nadding them here.\r\n\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions. The output might also be\r\ndifferent depending on the Edition.\r\n-->\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84213/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84213/timeline", "performed_via_github_app": null, "state_reason": "completed"}