{"url": "https://api.github.com/repos/rust-lang/rust/issues/9822", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/9822/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/9822/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/9822/events", "html_url": "https://github.com/rust-lang/rust/issues/9822", "id": 20906290, "node_id": "MDU6SXNzdWUyMDkwNjI5MA==", "number": 9822, "title": "libc ANSI functions must be avoided on Windows", "user": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-10-12T06:12:29Z", "updated_at": "2014-04-28T04:25:37Z", "closed_at": "2014-04-28T04:25:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Some libc functions e.g. `fopen` accept or return `char*`. However, on Windows, they don't understand utf-8, instead [they speak ANSI](http://msdn.microsoft.com/en-us/library/windows/desktop/dd374089%28v=vs.85%29.aspx).\nIf the function returns `char*` which contains non-ascii, utf-8 assertion error rises. See #9418 and #9618 for actual cases. (They may be fixed by #9812)\nIf the function accepts `char*` parameter but we put non-ascii utf8, then the api fails to understand it thus returns error.\n\nTo fix it, we must avoid them and use UTF-16 alternatives e.g. [`_wfopen`](http://msdn.microsoft.com/en-us/library/yeby3zcb%28v=vs.90%29.aspx) on Windows.\nThis requires converting utf8 into utf16 before calling libc apis.\nSimilarly, WinAPI with `A` postfix uses ANSI. We must use `W` functions instead.\n\nHere is list of problematic points I know (far from complete):\n- `std::io` uses `fopen`. (I don't think we should fix it now since it will be replaced by `std::rt::io`; libuv accepts utf8 and internally calls `W`-apis so it is safe)\n- `std::os::env` uses `GetEnvironmentStringsA` and `FreeEnvironmentStringsA`.\n- `std::os::rename_file` uses `libc::rename`. This will fail to rename `\u2606.txt` to `\u2605.txt` on Windows.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/9822/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/9822/timeline", "performed_via_github_app": null, "state_reason": "completed"}