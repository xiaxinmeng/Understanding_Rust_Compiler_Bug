{"url": "https://api.github.com/repos/rust-lang/rust/issues/6428", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/6428/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/6428/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/6428/events", "html_url": "https://github.com/rust-lang/rust/issues/6428", "id": 14229287, "node_id": "MDU6SXNzdWUxNDIyOTI4Nw==", "number": 6428, "title": "valgrind errors around stacks and context switches in newsched", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}], "state": "closed", "locked": false, "assignee": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/10", "html_url": "https://github.com/rust-lang/rust/milestone/10", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/10/labels", "id": 234060, "node_id": "MDk6TWlsZXN0b25lMjM0MDYw", "number": 10, "title": "0.7", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 110, "state": "closed", "created_at": "2012-12-22T22:31:59Z", "updated_at": "2013-07-04T01:21:16Z", "due_on": "2013-06-30T07:00:00Z", "closed_at": "2013-07-04T01:21:16Z"}, "comments": 1, "created_at": "2013-05-12T01:10:41Z", "updated_at": "2013-06-20T06:35:35Z", "closed_at": "2013-06-20T06:35:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I think these are probably because we're not calling VALGRIND_STACK_REGISTER, but sometimes I see many instances of this type of error:\n\n```\n==936== Invalid read of size 8\n==936==    at 0xAA8598: rt::uv::uvio::__extensions__::write::anon::expr_fn_40723 (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA72E1F: rt::sched::__extensions__::meth_39073::run_cleanup_job::_d89672ea64dda16::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA6F383: rt::sched::__extensions__::meth_38960::resume_task_immediately::_a2575627634c4428::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA9A0CB: rt::uv::uvio::__extensions__::tcp_connect::anon::anon::expr_fn_40192 (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xABC2AB: rt::uv::net::__extensions__::connect_cb::__rust_abi (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xABC49C: rt::uv::net::__extensions__::connect_cb::__rust_stack_shim (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0x5BFBAEB: upcall_call_shim_on_rust_stack (rust_upcall.cpp:103)\n==936==    by 0xABC0B7: rt::uv::net::__extensions__::connect_cb::_bca9d17c2f9fc276::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0x5C0FD95: uv__stream_io (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/stage1/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so)\n==936==    by 0x5C162BC: uv__io_poll (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/stage1/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so)\n==936==    by 0x5C0B40D: uv_run (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/stage1/lib/rustc/x86_64-unknown-linux-gnu/lib/librustrt.so)\n==936==    by 0xAB33D4: rust_uv_run__c_stack_shim (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==  Address 0x1abd4100 is 9,998,528 bytes inside a block of size 10,000,048 alloc'd\n==936==    at 0x4C2B4F0: realloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\n==936==    by 0x5BFF2EE: rust_exchange_alloc::realloc(void*, unsigned long) (rust_exchange_alloc.cpp:32)\n==936==    by 0x5BF37FF: vec_reserve_shared (rust_util.h:75)\n==936==    by 0x4248F9: vec::rustrt::vec_reserve_shared::_d93fcb2da81ef4d::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0x4246AA: vec::reserve_11902::_feb243f343efb87f::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0x749204: vec::with_capacity_20601::_d069f83199a42fd0::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xAC5255: rt::stack::__extensions__::meth_41483::new::_2f39639a42826edf::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA74579: rt::stack::__extensions__::meth_39135::take_segment::_2f39639a42826edf::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA73DE6: rt::sched::__extensions__::meth_39126::with_local::_03fe2be4efca6ed::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA84686: rt::test::spawntask_immediately::_866c76cd73dffbc7::_07pre (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA85A23: rt::io::net::tcp::test::multiple_connect_serial::anon::expr_fn_39598 (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n==936==    by 0xA74E95: rt::sched::__extensions__::build_start_wrapper::anon::anon::expr_fn_39150 (in /opt/dev/rust3/build/x86_64-unknown-linux-gnu/test/coretest.stage1-x86_64-unknown-linux-gnu)\n\n```\n", "closed_by": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/6428/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/6428/timeline", "performed_via_github_app": null, "state_reason": "completed"}