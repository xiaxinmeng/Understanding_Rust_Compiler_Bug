{"url": "https://api.github.com/repos/rust-lang/rust/issues/38365", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38365/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38365/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38365/events", "html_url": "https://github.com/rust-lang/rust/issues/38365", "id": 195593353, "node_id": "MDU6SXNzdWUxOTU1OTMzNTM=", "number": 38365, "title": "rustbuild: Dist on cross builds produce way too many tarballs", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-12-14T17:24:05Z", "updated_at": "2016-12-21T02:48:52Z", "closed_at": "2016-12-21T02:48:52Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The [dist step](https://buildbot.rust-lang.org/builders/nightly-dist-rustc-cross-host-linux/builds/281/steps/distcheck/logs/stdio) on cross builds takes over half an hour, and that's a crazy amount of time for something which should take at most 5 minutes. \r\n\r\nThe [list of tarballs created](https://gist.github.com/alexcrichton/0ef4bdfcb3514e1ff5362394056feb4d) is massively duplicated. Namely we create around 60 source tarballs (!!). Looks like we're also packaging up the standard library dozens of times for the same target.\r\n\r\nMy guess as to what's happening is that by default rustbuild is doing a cross product of (host x target) and doing all the builds. We should skip a massive number of them for distribution and ideally not even put them into the step list at all!\r\n\r\nNote that this isn't a fire at the moment as everything's just overwriting what was previously created, but this sounds like something that *could* become a fire!\r\n\r\nShould also be a relatively easy bug to knock out for anyone who wants to become familiar with rustbuild!", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38365/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38365/timeline", "performed_via_github_app": null, "state_reason": "completed"}