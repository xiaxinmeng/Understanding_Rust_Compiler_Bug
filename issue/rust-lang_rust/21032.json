{"url": "https://api.github.com/repos/rust-lang/rust/issues/21032", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21032/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21032/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21032/events", "html_url": "https://github.com/rust-lang/rust/issues/21032", "id": 54092154, "node_id": "MDU6SXNzdWU1NDA5MjE1NA==", "number": 21032, "title": "Instruction does not dominate all uses error when using File::open and compiling with link time optimization", "user": {"login": "Twinklebear", "id": 1522476, "node_id": "MDQ6VXNlcjE1MjI0NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1522476?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Twinklebear", "html_url": "https://github.com/Twinklebear", "followers_url": "https://api.github.com/users/Twinklebear/followers", "following_url": "https://api.github.com/users/Twinklebear/following{/other_user}", "gists_url": "https://api.github.com/users/Twinklebear/gists{/gist_id}", "starred_url": "https://api.github.com/users/Twinklebear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Twinklebear/subscriptions", "organizations_url": "https://api.github.com/users/Twinklebear/orgs", "repos_url": "https://api.github.com/users/Twinklebear/repos", "events_url": "https://api.github.com/users/Twinklebear/events{/privacy}", "received_events_url": "https://api.github.com/users/Twinklebear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-01-12T18:58:10Z", "updated_at": "2015-01-13T02:10:50Z", "closed_at": "2015-01-13T02:10:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've run into a compiler issue with the latest nightly `rustc 1.0.0-nightly (44a287e6e 2015-01-08 17:03:40 -0800)` when compiling with link time optimization enabled on Linux x86_64 (tested on Ubuntu 14.04, OpenSUSE 13.1 and CentOS 6.5). Interestingly this same issue doesn't seem to appear on my Windows 8.1 machine (same version of rustc).\n\nThe following short program:\n\n``` rust\nuse std::io::File;\n\nfn main() {\n    let f = File::open(&Path::new(\"out.ppm\"));\n}\n```\n\nwhen compiled with link time optimization fails to compile with:\n\n``` text\nInstruction does not dominate all uses!\n  %oldret4 = insertvalue %\"enum.core::result::Result<[\\22()\\22, \\22core::fmt::Error\\22]>[#2]\" %oldret2, [0 x i8] %newret3, 2\n  %.sink.i.i = phi %\"enum.core::result::Result<[\\22()\\22, \\22core::fmt::Error\\22]>[#2]\" [ %oldret10, %.noexc8.i ], [ %oldret4, %_ZN6string18String.fmt..String3fmt20h74aeaff0c04f8a35kCiE.exit ]\nInstruction does not dominate all uses!\n  %94 = invoke fastcc { i8, [0 x i8], [0 x i8] } @\"_ZN3fmt24Formatter$LT$$u{27}a$GT$3pad20h6fcd1b9b2d92a242qjwE\"(%\"struct.core::fmt::Formatter[#2]\"* noalias dereferenceable(96) %1, %str_slice* noalias nocapture dereferenceable(16) %arg.i.i)\n          to label %_ZN6string18String.fmt..String3fmt20h74aeaff0c04f8a35kCiE.exit unwind label %unwind_ast_45109_.i\n  %newret = extractvalue { i8, [0 x i8], [0 x i8] } %94, 0\nInstruction does not dominate all uses!\n  %94 = invoke fastcc { i8, [0 x i8], [0 x i8] } @\"_ZN3fmt24Formatter$LT$$u{27}a$GT$3pad20h6fcd1b9b2d92a242qjwE\"(%\"struct.core::fmt::Formatter[#2]\"* noalias dereferenceable(96) %1, %str_slice* noalias nocapture dereferenceable(16) %arg.i.i)\n          to label %_ZN6string18String.fmt..String3fmt20h74aeaff0c04f8a35kCiE.exit unwind label %unwind_ast_45109_.i\n  %newret1 = extractvalue { i8, [0 x i8], [0 x i8] } %94, 1\nInstruction does not dominate all uses!\n  %94 = invoke fastcc { i8, [0 x i8], [0 x i8] } @\"_ZN3fmt24Formatter$LT$$u{27}a$GT$3pad20h6fcd1b9b2d92a242qjwE\"(%\"struct.core::fmt::Formatter[#2]\"* noalias dereferenceable(96) %1, %str_slice* noalias nocapture dereferenceable(16) %arg.i.i)\n          to label %_ZN6string18String.fmt..String3fmt20h74aeaff0c04f8a35kCiE.exit unwind label %unwind_ast_45109_.i\n  %newret3 = extractvalue { i8, [0 x i8], [0 x i8] } %94, 2\nLLVM ERROR: Broken function found, compilation aborted!\nCould not compile `bug_repr`.\n```\n\nI put up a self contained example on [Gist](https://gist.github.com/Twinklebear/0b6efd45b420507901ac) so you can just grab it and build the release target. The release target there is on opt-level 0 but this happens at all optimization levels, so I think it's just related to lto.\n", "closed_by": {"login": "Twinklebear", "id": 1522476, "node_id": "MDQ6VXNlcjE1MjI0NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1522476?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Twinklebear", "html_url": "https://github.com/Twinklebear", "followers_url": "https://api.github.com/users/Twinklebear/followers", "following_url": "https://api.github.com/users/Twinklebear/following{/other_user}", "gists_url": "https://api.github.com/users/Twinklebear/gists{/gist_id}", "starred_url": "https://api.github.com/users/Twinklebear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Twinklebear/subscriptions", "organizations_url": "https://api.github.com/users/Twinklebear/orgs", "repos_url": "https://api.github.com/users/Twinklebear/repos", "events_url": "https://api.github.com/users/Twinklebear/events{/privacy}", "received_events_url": "https://api.github.com/users/Twinklebear/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21032/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21032/timeline", "performed_via_github_app": null, "state_reason": "completed"}