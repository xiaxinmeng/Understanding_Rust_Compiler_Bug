{"url": "https://api.github.com/repos/rust-lang/rust/issues/38246", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/38246/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/38246/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/38246/events", "html_url": "https://github.com/rust-lang/rust/issues/38246", "id": 194437081, "node_id": "MDU6SXNzdWUxOTQ0MzcwODE=", "number": 38246, "title": "Multiline highlights in diagnostic get noisy quickly", "user": {"login": "killercup", "id": 20063, "node_id": "MDQ6VXNlcjIwMDYz", "avatar_url": "https://avatars.githubusercontent.com/u/20063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/killercup", "html_url": "https://github.com/killercup", "followers_url": "https://api.github.com/users/killercup/followers", "following_url": "https://api.github.com/users/killercup/following{/other_user}", "gists_url": "https://api.github.com/users/killercup/gists{/gist_id}", "starred_url": "https://api.github.com/users/killercup/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/killercup/subscriptions", "organizations_url": "https://api.github.com/users/killercup/orgs", "repos_url": "https://api.github.com/users/killercup/repos", "events_url": "https://api.github.com/users/killercup/events{/privacy}", "received_events_url": "https://api.github.com/users/killercup/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2016-12-08T20:32:30Z", "updated_at": "2017-05-30T13:58:06Z", "closed_at": "2017-05-30T13:58:06Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This code ([playground](https://play.rust-lang.org/?gist=fdc9c0b98a213e43e848642b48a5d3b0&version=nightly&backtrace=0))\r\n\r\n```rust\r\ntrait Foo<'a, 'b> {\r\n    type Bar;\r\n}\r\n\r\nstruct Baz {}\r\n\r\nstruct Dolor<'c, 'd> {\r\n    sit: &'d &'c str,\r\n}\r\n\r\nimpl<'a, 'b> Foo<'a, 'b> for Baz where 'a: 'b {\r\n    type Bar = &'a Dolor<\r\n        'a,\r\n        'b\r\n    >;\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\ngenerates these diagnostic messages:\r\n\r\n```plain\r\nrustc 1.15.0-nightly (daf8c1dfc 2016-12-05)\r\nerror[E0491]: in type `&'d &'c str`, reference has a longer lifetime than the data it references\r\n --> <anon>:8:5\r\n  |\r\n8 |     sit: &'d &'c str,\r\n  |     ^^^^^^^^^^^^^^^^\r\n  |\r\nnote: the pointer is valid for the lifetime 'd as defined on the struct at 7:0\r\n --> <anon>:7:1\r\n  |\r\n7 |   struct Dolor<'c, 'd> {\r\n  |  _^ starting here...\r\n8 | |     sit: &'d &'c str,\r\n9 | | }\r\n  | |_^ ...ending here\r\nnote: but the referenced data is only valid for the lifetime 'c as defined on the struct at 7:0\r\n --> <anon>:7:1\r\n  |\r\n7 |   struct Dolor<'c, 'd> {\r\n  |  _^ starting here...\r\n8 | |     sit: &'d &'c str,\r\n9 | | }\r\n  | |_^ ...ending here\r\n\r\nerror[E0491]: in type `&'a Dolor<'a, 'b>`, reference has a longer lifetime than the data it references\r\n  --> <anon>:12:5\r\n   |\r\n12 |       type Bar = &'a Dolor<\r\n   |  _____^ starting here...\r\n13 | |         'a,\r\n14 | |         'b\r\n15 | |     >;\r\n   | |______^ ...ending here\r\n   |\r\n   = note: the pointer is valid for the lifetime 'a as defined on unknown free region bounded by scope CodeExtent(15/DestructionScope(NodeId(33)))\r\n   = note: but the referenced data is only valid for the lifetime 'b as defined on unknown free region bounded by scope CodeExtent(15/DestructionScope(NodeId(33)))\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\nEspecially the markers on the struct are making it pretty weird to read/recognize the code. (Colored output makes it a bit easier to differentiate the code symbols from the diagnostics ascii art though! \ud83d\ude04)\r\n\r\nThere probably are some opportunities to make concrete errors highlight more specific parts of the code. Sadly, this only gets worse for less straightforward code. Here's an example from an error I recently saw while fiddling with a macro in diesel:\r\n\r\n```plain\r\nerror[E0495]: cannot infer an appropriate lifetime for lifetime parameter `'a` due to conflicting requirements\r\n   --> src/macros/insertable.rs:473:13\r\n    |\r\n473 |               type Values = (\r\n    |  _____________^ starting here...\r\n474 | |                 ColumnInsertValue<\r\n475 | |                     posts::tags,\r\n476 | |                     AsExpr<&'insert &'a [&'a str], posts::tags>,\r\n477 | |                 >,\r\n478 | |             );\r\n    | |______________^ ...ending here\r\n    |\r\n    = note: first, the lifetime cannot outlive the lifetime 'insert as defined on unknown free region bounded by scope CodeExtent(19922/DestructionScope(NodeId(398)))...\r\nnote: ...so that types are compatible (expected expression::AsExpression<pg::types::sql_types::Array<types::Text>>, found expression::AsExpression<pg::types::sql_types::Array<types::Text>>)\r\n```\r\n\r\nThis would require highlighting both `'a`s, right?\r\n\r\ncc @estebank who worked on #37369", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/38246/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/38246/timeline", "performed_via_github_app": null, "state_reason": "completed"}