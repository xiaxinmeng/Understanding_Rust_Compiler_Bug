{"url": "https://api.github.com/repos/rust-lang/rust/issues/56807", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/56807/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/56807/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/56807/events", "html_url": "https://github.com/rust-lang/rust/issues/56807", "id": 391004241, "node_id": "MDU6SXNzdWUzOTEwMDQyNDE=", "number": 56807, "title": "libcompiler_builtins and libprofiler_builtins for aarch64-pc-windows-msvc contain x86 objects", "user": {"login": "glandium", "id": 1038527, "node_id": "MDQ6VXNlcjEwMzg1Mjc=", "avatar_url": "https://avatars.githubusercontent.com/u/1038527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glandium", "html_url": "https://github.com/glandium", "followers_url": "https://api.github.com/users/glandium/followers", "following_url": "https://api.github.com/users/glandium/following{/other_user}", "gists_url": "https://api.github.com/users/glandium/gists{/gist_id}", "starred_url": "https://api.github.com/users/glandium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glandium/subscriptions", "organizations_url": "https://api.github.com/users/glandium/orgs", "repos_url": "https://api.github.com/users/glandium/repos", "events_url": "https://api.github.com/users/glandium/events{/privacy}", "received_events_url": "https://api.github.com/users/glandium/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 3940166907, "node_id": "LA_kwDOAAsO6M7q2iz7", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AArch64", "name": "O-AArch64", "color": "6e6ec0", "default": false, "description": "Armv8-A or later processors in AArch64 mode"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-12-14T08:00:19Z", "updated_at": "2022-03-18T01:11:30Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was trying to look at the code generated by nightly rust for arm64 windows, which turned up to not be supported by my binutils, but in the middle of the otherwise empty `objdump -d` output, I got the surprise to see x86 assembly. As it turns out, several object files embedded in libcompiler_builtins and libprofiler_builtins (but not all of them) are pe-i386 objects.\r\n\r\n```\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ucmpti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ucmpdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/trunctfsf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/trunctfdf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/truncsfhf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/truncdfsf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/truncdfhf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/subvti3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/subvsi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/subvdi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/powixf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/popcountti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/popcountsi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/popcountdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/parityti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/paritysi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/paritydi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negvti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negvsi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negvdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negsf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/negdf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/mulxc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/mulvti3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/mulvsi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/mulvdi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/mulsc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/muldc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/int_util.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/floatunsitf.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/floatunditf.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/floatsitf.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/floatditf.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixunstfti.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixunstfsi.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixunstfdi.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixtfti.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixtfsi.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/fixtfdi.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ffsti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/extendsftf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/extendhfsf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/extenddftf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/divxc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/divsc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/divdc3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ctzti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ctzsi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/ctzdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/comparetf2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/cmpti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/cmpdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/clzti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/clzsi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/clzdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/apple_versioning.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/addvti3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/addvsi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/addvdi3.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/absvti2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/absvsi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/compiler_builtins-ab033e49e368917e/out/./compiler-rt/lib/builtins/absvdi2.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/WindowsMMap.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingWriter.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingValue.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingUtil.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingRuntime.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingPlatformOther.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingPlatformLinux.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingPlatformDarwin.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingNameVar.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingMergeFile.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingMerge.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingFile.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfilingBuffer.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/InstrProfiling.o:     file format pe-i386\r\nC:/projects/rust/build/x86_64-pc-windows-msvc/stage2-std/aarch64-pc-windows-msvc/release/build/profiler_builtins-d4c98d7f03f32e3d/out/GCDAProfiling.o:     file format pe-i386\r\n```\r\n\r\nCc: @froydnj, @alexcrichton", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/56807/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/56807/timeline", "performed_via_github_app": null, "state_reason": null}