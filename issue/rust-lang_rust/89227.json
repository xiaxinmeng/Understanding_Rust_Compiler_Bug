{"url": "https://api.github.com/repos/rust-lang/rust/issues/89227", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89227/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89227/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89227/events", "html_url": "https://github.com/rust-lang/rust/issues/89227", "id": 1006626594, "node_id": "I_kwDOAAsO6M47_-ci", "number": 89227, "title": "Putting #[derive] before a macro attribute results in a bad error", "user": {"login": "meithecatte", "id": 23580910, "node_id": "MDQ6VXNlcjIzNTgwOTEw", "avatar_url": "https://avatars.githubusercontent.com/u/23580910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meithecatte", "html_url": "https://github.com/meithecatte", "followers_url": "https://api.github.com/users/meithecatte/followers", "following_url": "https://api.github.com/users/meithecatte/following{/other_user}", "gists_url": "https://api.github.com/users/meithecatte/gists{/gist_id}", "starred_url": "https://api.github.com/users/meithecatte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meithecatte/subscriptions", "organizations_url": "https://api.github.com/users/meithecatte/orgs", "repos_url": "https://api.github.com/users/meithecatte/repos", "events_url": "https://api.github.com/users/meithecatte/events{/privacy}", "received_events_url": "https://api.github.com/users/meithecatte/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-09-24T16:19:29Z", "updated_at": "2021-09-24T16:25:02Z", "closed_at": "2021-09-24T16:25:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I don't know, off the top of my head, what attribute macros are available on the playground, so I'll use the crate I'm maintaining. The details of it are pretty much irrelevant anyway.\r\n\r\nGiven the following code:\r\n\r\n```rust\r\n#[derive(Copy, Clone)]\r\n#[enumflags2::bitflags]\r\n#[repr(u8)]\r\nenum Foo {\r\n    A = 1,\r\n}\r\n\r\nfn main() {}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0658]: macro attributes in `#[derive]` output are unstable\r\n --> src/main.rs:2:3\r\n  |\r\n2 | #[enumflags2::bitflags]\r\n  |   ^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = note: see issue #81119 <https://github.com/rust-lang/rust/issues/81119> for more information\r\n  = help: add `#![feature(macro_attributes_in_derive_output)]` to the crate attributes to enable\r\n```\r\n\r\nA few versions back (I've tested 1.41.1), we were outputting the following, much more legible error:\r\n\r\n```\r\nerror: macro attributes must be placed before `#[derive]`\r\n --> src/main.rs:2:1\r\n  |\r\n2 | #[enumflags2::bitflags]\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nThis is motivated by NieDzejkob/enumflags2#37 \u2014 it took me a moment to understand what was happening when a user reported that error.", "closed_by": {"login": "meithecatte", "id": 23580910, "node_id": "MDQ6VXNlcjIzNTgwOTEw", "avatar_url": "https://avatars.githubusercontent.com/u/23580910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meithecatte", "html_url": "https://github.com/meithecatte", "followers_url": "https://api.github.com/users/meithecatte/followers", "following_url": "https://api.github.com/users/meithecatte/following{/other_user}", "gists_url": "https://api.github.com/users/meithecatte/gists{/gist_id}", "starred_url": "https://api.github.com/users/meithecatte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meithecatte/subscriptions", "organizations_url": "https://api.github.com/users/meithecatte/orgs", "repos_url": "https://api.github.com/users/meithecatte/repos", "events_url": "https://api.github.com/users/meithecatte/events{/privacy}", "received_events_url": "https://api.github.com/users/meithecatte/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89227/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89227/timeline", "performed_via_github_app": null, "state_reason": "completed"}