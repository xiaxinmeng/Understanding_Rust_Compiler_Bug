{"url": "https://api.github.com/repos/rust-lang/rust/issues/3772", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/3772/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/3772/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/3772/events", "html_url": "https://github.com/rust-lang/rust/issues/3772", "id": 7581721, "node_id": "MDU6SXNzdWU3NTgxNzIx", "number": 3772, "title": "Restructure staged build / cross-compile architecture for speed", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/9", "html_url": "https://github.com/rust-lang/rust/milestone/9", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/9/labels", "id": 194126, "node_id": "MDk6TWlsZXN0b25lMTk0MTI2", "number": 9, "title": "0.6", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 203, "state": "closed", "created_at": "2012-10-11T18:15:24Z", "updated_at": "2015-01-21T01:43:22Z", "due_on": "2013-03-25T07:00:00Z", "closed_at": "2013-04-02T18:27:52Z"}, "comments": 2, "created_at": "2012-10-15T02:33:50Z", "updated_at": "2013-02-05T17:21:17Z", "closed_at": "2013-02-05T17:21:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Right now a complete stageN image is composed of artifacts from multiple stages' compilers. This intermixing of stages makes us do more work than we should. It also causes unusual bugs like #3660.\n\nAt it's most simple, we want the build to consist of downloading the snapshot compiler and building the binaries once. Right now the closest we can get to that is a stage0 build, but the result of a stage0 build is still using the snapshot compiler. To get a rebuilt compiler you have to build stage1, but building stage1 forces you to rebuild the host libraries.\n\nTo recap, we distinguish between the host and target binaries. They live on different places on disk, but they are always built as target binaries, then 'promoted' to the next stage as host binaries.\n\nIt looks like this:\n\n```\nbin/ - the 'host' bin directory, /usr/local/bin\n  rustc, etc.\nlib/ - the 'host' lib directory\n  libcore - used by the host toolchain only\n  libstd - etc.\n  rustc/\n    x86_64-unknown-linux-gnu/\n       ... target versions of bin/ and lib/\n```\n\nWhen we create stage0 on disk we drop the snapshot binaries into the stage0 host directories, then build the stage0 target directories. This is not right.\n\nstage0 should be only snapshot binaries, stage1 should be built entirely by stage0, etc. Then a basic build is just download the snapshot and build all the binaries (once) directly to their final on-disk stage1 location. That's it.\n\nRelated to #2237\n", "closed_by": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/3772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/3772/timeline", "performed_via_github_app": null, "state_reason": "completed"}