{"url": "https://api.github.com/repos/rust-lang/rust/issues/53392", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53392/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53392/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53392/events", "html_url": "https://github.com/rust-lang/rust/issues/53392", "id": 350860194, "node_id": "MDU6SXNzdWUzNTA4NjAxOTQ=", "number": 53392, "title": "Cargo does not pass CC environment variable", "user": {"login": "tomrittervg", "id": 163497, "node_id": "MDQ6VXNlcjE2MzQ5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/163497?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomrittervg", "html_url": "https://github.com/tomrittervg", "followers_url": "https://api.github.com/users/tomrittervg/followers", "following_url": "https://api.github.com/users/tomrittervg/following{/other_user}", "gists_url": "https://api.github.com/users/tomrittervg/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomrittervg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomrittervg/subscriptions", "organizations_url": "https://api.github.com/users/tomrittervg/orgs", "repos_url": "https://api.github.com/users/tomrittervg/repos", "events_url": "https://api.github.com/users/tomrittervg/events{/privacy}", "received_events_url": "https://api.github.com/users/tomrittervg/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-15T15:42:33Z", "updated_at": "2018-08-15T15:46:56Z", "closed_at": "2018-08-15T15:44:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am working on a mingw-clang build for Firefox, and hit this error: https://treeherder.mozilla.org/#/jobs?repo=try&revision=d317916a52e7b9493926d599d1f57fe11be1c91a\r\n\r\n```\r\n     Running `/builds/worker/workspace/build/src/sccache2/sccache /builds/worker/workspace/build/src/rustc/bin/rustc --crate-name uuid third_party/rust/uuid/src/lib.rs --crate-type lib --emit=dep-info,link -C opt-level=1 -C panic=abort -C debuginfo=2 -C debug-assertions=on --cfg 'feature=\"rand\"' --cfg 'feature=\"v4\"' -C metadata=680533a3129dedd4 -C extra-filename=-680533a3129dedd4 --out-dir /builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps --target x86_64-pc-windows-gnu -L dependency=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps -L dependency=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/debug/deps --extern rand=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps/librand-772ae5924c4e5406.rlib --cap-lints warn -C opt-level=2 -C debuginfo=2`\r\n   0:     0x563f9b6b0b1e - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h845003dfd4057b58\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x563f9b6a25e6 - std::sys_common::backtrace::print::he21204c91f031ba1\r\n                               at libstd/sys_common/backtrace.rs:71\r\n                               at libstd/sys_common/backtrace.rs:59\r\n   2:     0x563f9b6a056d - std::panicking::default_hook::{{closure}}::h67eac88e3f053d87\r\n                               at libstd/panicking.rs:211\r\n   3:     0x563f9b6a02e0 - std::panicking::default_hook::hb9cbad724f559203\r\n                               at libstd/panicking.rs:227\r\n   4:     0x563f9b6a0c0c - std::panicking::rust_panic_with_hook::he4c3a67f6258a8f9\r\n                               at libstd/panicking.rs:511\r\n   5:     0x563f9b6a09b9 - std::panicking::continue_panic_fmt::h156c04b2aea348c7\r\n                               at libstd/panicking.rs:426\r\n   6:     0x563f9b6a091d - std::panicking::begin_panic_fmt::h6c68b0cc82493124\r\n                               at libstd/panicking.rs:413\r\n   7:     0x563f9b67552b - cc::fail::h40dec426326dc15c\r\n                               at third_party/rust/cc/src/lib.rs:2181\r\n   8:     0x563f9b66d09b - cc::Build::compile::ha10b6deb1fb0ed53\r\n                               at third_party/rust/cc/src/lib.rs:914\r\n   9:     0x563f9b665566 - build_script_build::main::h6e86facdc937e870\r\n                               at third_party/rust/lmdb-sys/build.rs:14\r\n  10:     0x563f9b665612 - std::rt::lang_start::{{closure}}::h1952862317e56406\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  11:     0x563f9b6a0672 - std::panicking::try::do_call::hac56dcc01f36ef70\r\n                               at libstd/rt.rs:59\r\n                               at libstd/panicking.rs:310\r\n  12:     0x563f9b6c12a9 - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:105\r\n  13:     0x563f9b69b1e5 - std::rt::lang_start_internal::h249c3823b1cd2120\r\n     Running `/builds/worker/workspace/build/src/sccache2/sccache /builds/worker/workspace/build/src/rustc/bin/rustc --crate-name nsstring servo/support/gecko/nsstring/src/lib.rs --crate-type lib --emit=dep-info,link -C opt-level=1 -C panic=abort -C debuginfo=2 -C debug-assertions=on --cfg 'feature=\"gecko_debug\"' -C metadata=0de542a27f5f741d -C extra-filename=-0de542a27f5f741d --out-dir /builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps --target x86_64-pc-windows-gnu -L dependency=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps -L dependency=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/debug/deps --extern bitflags=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps/libbitflags-888d48167ec1bacf.rlib --extern encoding_rs=/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/deps/libencoding_rs-fe8e74f6d4864e7b.rlib -C opt-level=2 -C debuginfo=2`\r\n                               at libstd/panicking.rs:289\r\n                               at libstd/panic.rs:392\r\n                               at libstd/rt.rs:58\r\n  14:     0x563f9b6655ff - std::rt::lang_start::h2841bd5def32fef5\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  15:     0x7fa762fb42b0 - __libc_start_main\r\n  16:     0x563f9b664bc9 - _start\r\n  17:                0x0 - <unknown>\r\nerror: failed to run custom build command for `lmdb-sys v0.8.0`\r\nprocess didn't exit successfully: `/builds/worker/workspace/build/src/obj-firefox/toolkit/library/debug/build/lmdb-sys-f9bd5eade835f887/build-script-build` (exit code: 101)\r\n--- stdout\r\nTARGET = Some(\"x86_64-pc-windows-gnu\")\r\nTARGET = Some(\"x86_64-pc-windows-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nTARGET = Some(\"x86_64-pc-windows-gnu\")\r\nTARGET = Some(\"x86_64-pc-windows-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCC_x86_64-pc-windows-gnu = None\r\nCC_x86_64_pc_windows_gnu = None\r\nTARGET_CC = None\r\nCC = None\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCROSS_COMPILE = None\r\nTARGET = Some(\"x86_64-pc-windows-gnu\")\r\nHOST = Some(\"x86_64-unknown-linux-gnu\")\r\nCFLAGS_x86_64-pc-windows-gnu = None\r\nCFLAGS_x86_64_pc_windows_gnu = None\r\nTARGET_CFLAGS = None\r\nCFLAGS = None\r\nDEBUG = Some(\"true\")\r\nrunning: \"x86_64-w64-mingw32-gcc\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-g\" \"-m64\" \"-Wall\" \"-Wextra\" \"-o\" \"/builds/worker/workspace/build/src/obj-firefox/toolkit/library/x86_64-pc-windows-gnu/debug/build/lmdb-sys-a1f59ada2bcc3535/out/mdb.o\" \"-c\" \"/builds/worker/workspace/build/src/third_party/rust/lmdb-sys/lmdb/libraries/liblmdb/mdb.c\"\r\n--- stderr\r\nthread 'main' panicked at '\r\nInternal error occurred: Failed to find tool. Is `x86_64-w64-mingw32-gcc` installed?\r\n', third_party/rust/cc/src/lib.rs:2181:5\r\nstack backtrace:\r\n   0:     0x563f9b6b0b1e - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h845003dfd4057b58\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x563f9b6a25e6 - std::sys_common::backtrace::print::he21204c91f031ba1\r\n                               at libstd/sys_common/backtrace.rs:71\r\n                               at libstd/sys_common/backtrace.rs:59\r\n   2:     0x563f9b6a056d - std::panicking::default_hook::{{closure}}::h67eac88e3f053d87\r\n                               at libstd/panicking.rs:211\r\n   3:     0x563f9b6a02e0 - std::panicking::default_hook::hb9cbad724f559203\r\n                               at libstd/panicking.rs:227\r\n   4:     0x563f9b6a0c0c - std::panicking::rust_panic_with_hook::he4c3a67f6258a8f9\r\n                               at libstd/panicking.rs:511\r\n   5:     0x563f9b6a09b9 - std::panicking::continue_panic_fmt::h156c04b2aea348c7\r\n                               at libstd/panicking.rs:426\r\n   6:     0x563f9b6a091d - std::panicking::begin_panic_fmt::h6c68b0cc82493124\r\n                               at libstd/panicking.rs:413\r\n   7:     0x563f9b67552b - cc::fail::h40dec426326dc15c\r\n                               at third_party/rust/cc/src/lib.rs:2181\r\n   8:     0x563f9b66d09b - cc::Build::compile::ha10b6deb1fb0ed53\r\n                               at third_party/rust/cc/src/lib.rs:914\r\n   9:     0x563f9b665566 - build_script_build::main::h6e86facdc937e870\r\n                               at third_party/rust/lmdb-sys/build.rs:14\r\n  10:     0x563f9b665612 - std::rt::lang_start::{{closure}}::h1952862317e56406\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  11:     0x563f9b6a0672 - std::panicking::try::do_call::hac56dcc01f36ef70\r\n                               at libstd/rt.rs:59\r\n                               at libstd/panicking.rs:310\r\n  12:     0x563f9b6c12a9 - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:105\r\n  13:     0x563f9b69b1e5 - std::rt::lang_start_internal::h249c3823b1cd2120\r\n                               at libstd/panicking.rs:289\r\n                               at libstd/panic.rs:392\r\n                               at libstd/rt.rs:58\r\n  14:     0x563f9b6655ff - std::rt::lang_start::h2841bd5def32fef5\r\n                               at /checkout/src/libstd/rt.rs:74\r\n  15:     0x7fa762fb42b0 - __libc_start_main\r\n  16:     0x563f9b664bc9 - _start\r\n  17:                0x0 - <unknown> \r\n```\r\n\r\nIn particular note that CC = None and x86_64-w64-mingw32-gcc - which should be \"x86_64-w64-mingw32-clang\".\r\n\r\nI got pointed to this code: https://github.com/rust-lang/cargo/blob/master/src/cargo/core/compiler/custom_build.rs#L140-L173 which might be the relevant portion?", "closed_by": {"login": "tomrittervg", "id": 163497, "node_id": "MDQ6VXNlcjE2MzQ5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/163497?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomrittervg", "html_url": "https://github.com/tomrittervg", "followers_url": "https://api.github.com/users/tomrittervg/followers", "following_url": "https://api.github.com/users/tomrittervg/following{/other_user}", "gists_url": "https://api.github.com/users/tomrittervg/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomrittervg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomrittervg/subscriptions", "organizations_url": "https://api.github.com/users/tomrittervg/orgs", "repos_url": "https://api.github.com/users/tomrittervg/repos", "events_url": "https://api.github.com/users/tomrittervg/events{/privacy}", "received_events_url": "https://api.github.com/users/tomrittervg/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53392/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53392/timeline", "performed_via_github_app": null, "state_reason": "completed"}