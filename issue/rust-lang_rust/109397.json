{"url": "https://api.github.com/repos/rust-lang/rust/issues/109397", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109397/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109397/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109397/events", "html_url": "https://github.com/rust-lang/rust/issues/109397", "id": 1632322520, "node_id": "I_kwDOAAsO6M5hS0PY", "number": 109397, "title": "CI random failure on x86_64-apple-2 InvalidInput in create_dir_all while running test/rustdoc/primitive/no_std.rs", "user": {"login": "ehuss", "id": 43198, "node_id": "MDQ6VXNlcjQzMTk4", "avatar_url": "https://avatars.githubusercontent.com/u/43198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ehuss", "html_url": "https://github.com/ehuss", "followers_url": "https://api.github.com/users/ehuss/followers", "following_url": "https://api.github.com/users/ehuss/following{/other_user}", "gists_url": "https://api.github.com/users/ehuss/gists{/gist_id}", "starred_url": "https://api.github.com/users/ehuss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ehuss/subscriptions", "organizations_url": "https://api.github.com/users/ehuss/orgs", "repos_url": "https://api.github.com/users/ehuss/repos", "events_url": "https://api.github.com/users/ehuss/events{/privacy}", "received_events_url": "https://api.github.com/users/ehuss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 371266501, "node_id": "MDU6TGFiZWwzNzEyNjY1MDE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-spurious", "name": "A-spurious", "color": "f7e101", "default": false, "description": "Area: Spurious failures in builds (spuriously == for no apparent reason)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-03-20T15:15:21Z", "updated_at": "2023-03-30T15:21:20Z", "closed_at": "2023-03-30T15:21:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "CI has failed a few times with the following error on x86_64-apple-2:\r\n\r\n```\r\n---- [rustdoc] tests/rustdoc/primitive/no_std.rs stdout ----\r\nthread '[rustdoc] tests/rustdoc/primitive/no_std.rs' panicked at 'called `Result::unwrap()` on an `Err` value: Os { code: 22, kind: InvalidInput, message: \"Invalid argument\" }', src/tools/compiletest/src/runtest.rs:130:43\r\n```\r\n\r\nor:\r\n\r\n```\r\n---- [rustdoc] src/test/rustdoc/primitive/primitive-generic-impl.rs stdout ----\r\nthread '[rustdoc] src/test/rustdoc/primitive/primitive-generic-impl.rs' panicked at 'called `Result::unwrap()` on an `Err` value: Os { code: 22, kind: InvalidInput, message: \"Invalid argument\" }', src/tools/compiletest/src/runtest.rs:125:43\r\nSome tests failed in compiletest suite=rustdoc mode=rustdoc host=x86_64-apple-darwin target=x86_64-apple-darwin\r\n```\r\n\r\nI don't have any immediate theories as to the cause. It is conspicuous that it almost always happens on the same test.\r\n\r\nThe particular line in question is a call to the standard `create_dir_all`: https://github.com/rust-lang/rust/blob/13b7aa4d7faafbed78d195c27f6868f6bd90c2f8/src/tools/compiletest/src/runtest.rs#L130\r\n\r\nI don't see anything particularly unusual in the implementation: [`std::fs::create_dir_all`](https://github.com/rust-lang/rust/blob/13b7aa4d7faafbed78d195c27f6868f6bd90c2f8/library/std/src/fs.rs#L2475-L2500). The impl does a fairly standard libc call to [`mkdir`](https://github.com/rust-lang/rust/blob/13b7aa4d7faafbed78d195c27f6868f6bd90c2f8/library/std/src/sys/unix/fs.rs#L1246-L1248).  The macOS man page doesn't mention EINVAL, and I'm not sure under what circumstances that could happen with `mkdir`.\r\n\r\n* 2022-05-26: https://github.com/rust-lang/rust/pull/97327#issuecomment-1138700773\r\n* 2022-12-05: https://github.com/rust-lang/rust/pull/105308#issuecomment-1337806746\r\n* 2022-12-07: https://github.com/rust-lang/rust/pull/104449#issuecomment-1341544420\r\n* 2022-12-09: https://github.com/rust-lang/rust/pull/105448#issuecomment-1344512186\r\n* 2022-12-14: https://github.com/rust-lang/rust/pull/105649#issuecomment-1350754752\r\n* 2022-12-15: https://github.com/rust-lang/rust/pull/104334#issuecomment-1354101832\r\n* 2022-12-16: https://github.com/rust-lang/rust/pull/105717#issuecomment-1355373404\r\n* 2022-12-26: https://github.com/rust-lang/rust/pull/105817#issuecomment-1365266508\r\n* 2022-12-26: https://github.com/rust-lang/rust/pull/106095#issuecomment-1365618661\r\n* 2023-01-18: https://github.com/rust-lang/rust/pull/106503#issuecomment-1387371859\r\n* 2023-01-23: https://github.com/rust-lang/rust/pull/101692#issuecomment-1401092406\r\n* 2023-02-01: https://github.com/rust-lang/rust/pull/107504#issuecomment-1412278383\r\n* 2023-03-13: https://github.com/rust-lang/rust/pull/107376#issuecomment-1465713994\r\n* 2023-03-20: https://github.com/rust-lang/rust/pull/109326#issuecomment-1475120601\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109397/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109397/timeline", "performed_via_github_app": null, "state_reason": "completed"}