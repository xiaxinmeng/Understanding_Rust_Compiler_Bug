{"url": "https://api.github.com/repos/rust-lang/rust/issues/6504", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/6504/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/6504/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/6504/events", "html_url": "https://github.com/rust-lang/rust/issues/6504", "id": 14366980, "node_id": "MDU6SXNzdWUxNDM2Njk4MA==", "number": 6504, "title": "LLVM assert failure with struct pointers and foreign functions", "user": {"login": "brandonson", "id": 1870695, "node_id": "MDQ6VXNlcjE4NzA2OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1870695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brandonson", "html_url": "https://github.com/brandonson", "followers_url": "https://api.github.com/users/brandonson/followers", "following_url": "https://api.github.com/users/brandonson/following{/other_user}", "gists_url": "https://api.github.com/users/brandonson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brandonson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brandonson/subscriptions", "organizations_url": "https://api.github.com/users/brandonson/orgs", "repos_url": "https://api.github.com/users/brandonson/repos", "events_url": "https://api.github.com/users/brandonson/events{/privacy}", "received_events_url": "https://api.github.com/users/brandonson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2013-05-15T16:24:00Z", "updated_at": "2013-10-11T18:55:58Z", "closed_at": "2013-10-11T18:55:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Say we have a crate file A.rc which includes mod A and mod B, file B is a module that defines an extern function that takes a pointer to a struct, and file C is a module that uses file B using mod B.\n\nI get the following error:\n\n```\nrust/src/llvm/include/llvm/Support/Casting.h:231: typename llvm::enable_if<llvm::is_same<Y, typename llvm::simplify_type<From>::SimpleType>, typename llvm::cast_retty<X, Y*>::ret_type>::type llvm::cast(Y*) [with X = llvm::Function; Y = llvm::Value; typename llvm::enable_if<llvm::is_same<Y, typename llvm::simplify_type<From>::SimpleType>, typename llvm::cast_retty<X, Y*>::ret_type>::type = llvm::Function*]: Assertion `isa<X>(Val) && \"cast<Ty>() argument of incompatible type!\"' failed.\n```\n\nI managed to bring it down to a simple example that reproduces the problem:\n\ncrate.rc\n\n```\n#[crate_type = \"lib\"];\nmod other;\nmod other2;\n```\n\nother.rs\n\n```\nstruct Foo{\n  bar: libc::c_int\n}\n\n#[link_args = \"-lSDL2\"]\nextern{\n  fn externFunc(param:&Foo) -> libc::c_int;\n}\n```\n\nother2.rs\n\n```\nmod other;\n```\n\nNote that this does not happen when the parameters to the extern fn are not pointers to a struct.  It also does not happen when compiling just other.rs, or without crate.rc depending on other2.rs.\n\nI'm running ubuntu 13.04 with gcc 4.7.3, and I've had this occur with rust builds from both the master and auto branches, and also with rust 0.6.\n", "closed_by": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/6504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/6504/timeline", "performed_via_github_app": null, "state_reason": "completed"}