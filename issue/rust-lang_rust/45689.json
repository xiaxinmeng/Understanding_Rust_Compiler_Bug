{"url": "https://api.github.com/repos/rust-lang/rust/issues/45689", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45689/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45689/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45689/events", "html_url": "https://github.com/rust-lang/rust/issues/45689", "id": 270362664, "node_id": "MDU6SXNzdWUyNzAzNjI2NjQ=", "number": 45689, "title": "assertion failed: !are_upstream_rust_objects_already_included(sess) when building rustc_private with monolithic lto", "user": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2017-11-01T16:14:49Z", "updated_at": "2022-12-12T17:04:14Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "EDIT: repo for reproducing: https://github.com/matthiaskrgr/rustc_crashtest_lto , run cargo build --release\r\n\r\n````\r\nrustc --version #rustc 1.23.0-nightly (8b22e70b2 2017-10-31)\r\n\r\ngit clone https://github.com/rust-lang-nursery/rustfmt\r\ncd rustfmt\r\ngit checkout 0af8825eb104e6c7b9444693d583b5fa0bd55ceb\r\n\r\necho \"\r\n[profile.release]\r\nopt-level = 3\r\nlto = true\r\n\" >> Cargo.toml\r\n\r\nRUST_BACKTRACE=full cargo build --release --verbose\r\n````\r\ncrashes rustc:\r\n\r\n````\r\n       Fresh quote v0.3.15\r\n       Fresh utf8-ranges v1.0.0\r\n       Fresh num-traits v0.1.40\r\n       Fresh unicode-xid v0.0.4\r\n       Fresh getopts v0.2.15\r\n       Fresh serde v1.0.16\r\n       Fresh itoa v0.3.4\r\n       Fresh void v1.0.2\r\n       Fresh dtoa v0.4.2\r\n       Fresh diff v0.1.10\r\n       Fresh term v0.4.6\r\n       Fresh regex-syntax v0.4.1\r\n       Fresh unicode-segmentation v1.2.0\r\n       Fresh log v0.3.8\r\n       Fresh lazy_static v0.2.9\r\n       Fresh libc v0.2.32\r\n       Fresh synom v0.11.3\r\n       Fresh toml v0.4.5\r\n       Fresh unreachable v1.0.0\r\n       Fresh serde_json v1.0.4\r\n       Fresh strings v0.1.0\r\n       Fresh memchr v1.0.2\r\n       Fresh syn v0.11.11\r\n       Fresh thread_local v0.3.4\r\n       Fresh aho-corasick v0.6.3\r\n       Fresh serde_derive_internals v0.16.0\r\n       Fresh regex v0.2.2\r\n       Fresh serde_derive v1.0.16\r\n       Fresh env_logger v0.4.3\r\n   Compiling rustfmt-nightly v0.2.13 (file:///home/matthias/vcs/github/rustfmt)\r\n     Running `rustc --crate-name rustfmt src/bin/rustfmt.rs --crate-type bin --emit=dep-info,link -C opt-level=3 -C lto --cfg 'feature=\"cargo-fmt\"' --cfg 'feature=\"default\"' --cfg 'feature=\"rustfmt-format-diff\"' -C metadata=8286bf522b4875a9 -C extra-filename=-8286bf522b4875a9 --out-dir /home/matthias/vcs/github/rustfmt/target/release/deps -L dependency=/home/matthias/vcs/github/rustfmt/target/release/deps --extern serde_derive=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde_derive-2b4ee28cf16ac2a4.so --extern term=/home/matthias/vcs/github/rustfmt/target/release/deps/libterm-752362bbc8237001.rlib --extern serde=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde-45127027bf81d438.rlib --extern log=/home/matthias/vcs/github/rustfmt/target/release/deps/liblog-d09fa7f67c1f577c.rlib --extern diff=/home/matthias/vcs/github/rustfmt/target/release/deps/libdiff-6cc97c0e6df9495d.rlib --extern getopts=/home/matthias/vcs/github/rustfmt/target/release/deps/libgetopts-8ff6434fa2a5d019.rlib --extern unicode_segmentation=/home/matthias/vcs/github/rustfmt/target/release/deps/libunicode_segmentation-6bb2cdd83d97a0ec.rlib --extern serde_json=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde_json-53e4f5d05eed2957.rlib --extern strings=/home/matthias/vcs/github/rustfmt/target/release/deps/libstrings-04c4ec84130f6565.rlib --extern regex=/home/matthias/vcs/github/rustfmt/target/release/deps/libregex-48d942f70d747749.rlib --extern toml=/home/matthias/vcs/github/rustfmt/target/release/deps/libtoml-65d6559cb921e7a7.rlib --extern env_logger=/home/matthias/vcs/github/rustfmt/target/release/deps/libenv_logger-10d3b6fcb2fa4ecb.rlib --extern libc=/home/matthias/vcs/github/rustfmt/target/release/deps/liblibc-2029413d0fb43b31.rlib --extern rustfmt_nightly=/home/matthias/vcs/github/rustfmt/target/release/deps/librustfmt_nightly-13335655e8960ac0.rlib -C target-cpu=native`\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.23.0-nightly (8b22e70b2 2017-10-31) running on x86_64-unknown-linux-gnu\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'assertion failed: !sess.lto()', /checkout/src/librustc_trans/back/link.rs:1287:8\r\nstack backtrace:\r\n   0:     0x7fc18198a153 - std::sys::imp::backtrace::tracing::imp::unwind_backtrace::hf409d569470ae30b\r\n                               at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7fc1819847f0 - std::sys_common::backtrace::_print::h9f8ff77762968e1c\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:69\r\n   2:     0x7fc181997473 - std::panicking::default_hook::{{closure}}::h233cc40af697cbfb\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:58\r\n                               at /checkout/src/libstd/panicking.rs:381\r\n   3:     0x7fc18199717d - std::panicking::default_hook::hefff18022ca24d92\r\n                               at /checkout/src/libstd/panicking.rs:391\r\n   4:     0x7fc181997907 - std::panicking::rust_panic_with_hook::hd94a4492e4561dca\r\n                               at /checkout/src/libstd/panicking.rs:577\r\n   5:     0x7fc17f79a6c1 - std::panicking::begin_panic::h1d4a7052e8a95c5a\r\n   6:     0x7fc17f75d24d - _ZN11rustc_trans4back4link13link_natively17hfbc8890611f67b24E.llvm.C0978D50\r\n   7:     0x7fc17f75879d - rustc_trans::back::link::link_binary::ha0632ae2f8eab4a2\r\n   8:     0x7fc17f770135 - <rustc_trans::LlvmTransCrate as rustc_trans_utils::trans_crate::TransCrate>::link_binary::hef3d77a5e1caaee2\r\n   9:     0x7fc181d5d03b - rustc_driver::driver::compile_input::h6d65afe4a82d280a\r\n  10:     0x7fc181da41a0 - rustc_driver::run_compiler::h6a01af2106f7c680\r\n  11:     0x7fc181d330f2 - _ZN3std10sys_common9backtrace28__rust_begin_short_backtrace17h5665586c1dd72980E.llvm.B78FDE68\r\n  12:     0x7fc1819e0a0e - __rust_maybe_catch_panic\r\n                               at /checkout/src/libpanic_unwind/lib.rs:99\r\n  13:     0x7fc181d4e7a2 - _ZN50_$LT$F$u20$as$u20$alloc..boxed..FnBox$LT$A$GT$$GT$8call_box17hda2c4e140d408872E.llvm.B78FDE68\r\n  14:     0x7fc18199634b - std::sys::imp::thread::Thread::new::thread_start::h024eb26cf106639b\r\n                               at /checkout/src/liballoc/boxed.rs:772\r\n                               at /checkout/src/libstd/sys_common/thread.rs:24\r\n                               at /checkout/src/libstd/sys/unix/thread.rs:90\r\n  15:     0x7fc17bd51739 - start_thread\r\n  16:     0x7fc18165ce7e - clone\r\n  17:                0x0 - <unknown>\r\n\r\nerror: Could not compile `rustfmt-nightly`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name rustfmt src/bin/rustfmt.rs --crate-type bin --emit=dep-info,link -C opt-level=3 -C lto --cfg feature=\"cargo-fmt\" --cfg feature=\"default\" --cfg feature=\"rustfmt-format-diff\" -C metadata=8286bf522b4875a9 -C extra-filename=-8286bf522b4875a9 --out-dir /home/matthias/vcs/github/rustfmt/target/release/deps -L dependency=/home/matthias/vcs/github/rustfmt/target/release/deps --extern serde_derive=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde_derive-2b4ee28cf16ac2a4.so --extern term=/home/matthias/vcs/github/rustfmt/target/release/deps/libterm-752362bbc8237001.rlib --extern serde=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde-45127027bf81d438.rlib --extern log=/home/matthias/vcs/github/rustfmt/target/release/deps/liblog-d09fa7f67c1f577c.rlib --extern diff=/home/matthias/vcs/github/rustfmt/target/release/deps/libdiff-6cc97c0e6df9495d.rlib --extern getopts=/home/matthias/vcs/github/rustfmt/target/release/deps/libgetopts-8ff6434fa2a5d019.rlib --extern unicode_segmentation=/home/matthias/vcs/github/rustfmt/target/release/deps/libunicode_segmentation-6bb2cdd83d97a0ec.rlib --extern serde_json=/home/matthias/vcs/github/rustfmt/target/release/deps/libserde_json-53e4f5d05eed2957.rlib --extern strings=/home/matthias/vcs/github/rustfmt/target/release/deps/libstrings-04c4ec84130f6565.rlib --extern regex=/home/matthias/vcs/github/rustfmt/target/release/deps/libregex-48d942f70d747749.rlib --extern toml=/home/matthias/vcs/github/rustfmt/target/release/deps/libtoml-65d6559cb921e7a7.rlib --extern env_logger=/home/matthias/vcs/github/rustfmt/target/release/deps/libenv_logger-10d3b6fcb2fa4ecb.rlib --extern libc=/home/matthias/vcs/github/rustfmt/target/release/deps/liblibc-2029413d0fb43b31.rlib --extern rustfmt_nightly=/home/matthias/vcs/github/rustfmt/target/release/deps/librustfmt_nightly-13335655e8960ac0.rlib -C target-cpu=native` (exit code: 101)\r\n````\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45689/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45689/timeline", "performed_via_github_app": null, "state_reason": null}