{"url": "https://api.github.com/repos/rust-lang/rust/issues/80289", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80289/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80289/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80289/events", "html_url": "https://github.com/rust-lang/rust/issues/80289", "id": 772896824, "node_id": "MDU6SXNzdWU3NzI4OTY4MjQ=", "number": 80289, "title": "Optimizations cause release version to stack overflow", "user": {"login": "xNxExOx", "id": 1893229, "node_id": "MDQ6VXNlcjE4OTMyMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/1893229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xNxExOx", "html_url": "https://github.com/xNxExOx", "followers_url": "https://api.github.com/users/xNxExOx/followers", "following_url": "https://api.github.com/users/xNxExOx/following{/other_user}", "gists_url": "https://api.github.com/users/xNxExOx/gists{/gist_id}", "starred_url": "https://api.github.com/users/xNxExOx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xNxExOx/subscriptions", "organizations_url": "https://api.github.com/users/xNxExOx/orgs", "repos_url": "https://api.github.com/users/xNxExOx/repos", "events_url": "https://api.github.com/users/xNxExOx/events{/privacy}", "received_events_url": "https://api.github.com/users/xNxExOx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 55301991, "node_id": "MDU6TGFiZWw1NTMwMTk5MQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86", "name": "O-x86", "color": "6e6ec0", "default": false, "description": "Target: x86 processors"}, {"id": 55302148, "node_id": "MDU6TGFiZWw1NTMwMjE0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86_64", "name": "O-x86_64", "color": "6e6ec0", "default": false, "description": "Target: x64 processors"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 38, "created_at": "2020-12-22T12:07:12Z", "updated_at": "2021-01-15T04:51:23Z", "closed_at": "2021-01-15T00:10:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "I write and Advent Of Code solutions and I was using debug builds, but it was too slow for some days, so I tried to get difference for all other days, and found out day 7 of year 2015 does not finish in release build.\r\n\r\nAfter quite a lot of investigation I found out that day 7 is affected by other days.\r\nCommenting out some of the days will make it work.\r\nI am not sure if it is regression, or just no one else encountered it yet, but optimizations like in-lining should not break working code.\r\n\r\n\r\nI tried this code:\r\nhttps://github.com/xNxExOx/rust_inline_bug \r\n\r\nI expected to see this happen: \r\n```\r\nyear 2015\r\nday 7\r\n[PART 1] Value on 'a' 16076\r\n[PART 2] Value on 'a' 2797\r\n[day 7] solved in: 680.8406ms\r\n[year 2015] solved in: 680.873ms\r\n```\r\nbecause `main.rs` is set to execute day 7 of year 2015\r\n```rs\r\nfn main() {\r\n    solve(Some(2015), Some(7));\r\n}\r\n```\r\n\r\nInstead, this happened:\r\nit crashed with `thread 'main' has overflowed its stack`\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.50.0-nightly (803c60218 2020-12-13)\r\nrustc 1.50.0-nightly (11c94a197 2020-12-21)\r\n```\r\n\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nC:/Users/xxxku/.cargo/bin/cargo.exe run --color=always --package advent_of_code --bin advent_of_code --release\r\n    Updating crates.io index\r\n    Blocking waiting for file lock on package cache\r\n    Blocking waiting for file lock on package cache\r\n   Compiling memchr v2.3.4\r\n   Compiling autocfg v1.0.1\r\n   Compiling serde v1.0.118\r\n   Compiling ryu v1.0.5\r\n   Compiling serde_json v1.0.60\r\n   Compiling lazy_static v1.4.0\r\n   Compiling regex-syntax v0.6.21\r\n   Compiling itoa v0.4.6\r\n   Compiling md5 v0.7.0\r\n   Compiling thread_local v1.0.1\r\n   Compiling substring v1.4.0\r\n   Compiling aho-corasick v0.7.15\r\n   Compiling regex v1.4.2\r\n   Compiling advent_of_code v0.1.0 (D:\\rs\\advent_of_code)\r\n    Finished release [optimized] target(s) in 21.75s\r\n     Running `target\\release\\advent_of_code.exe`\r\nyear 2015\r\nday 7\r\n\r\nthread 'main' has overflowed its stack\r\nerror: process didn't exit successfully: `target\\release\\advent_of_code.exe` (exit code: 0xc00000fd, STATUS_STACK_OVERFLOW)\r\n\r\nProcess finished with exit code -1073741571 (0xC00000FD)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n\r\n### Workaround\r\nAdd `#[inline(never)]` to every `solve` function.\r\n", "closed_by": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80289/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80289/timeline", "performed_via_github_app": null, "state_reason": "completed"}