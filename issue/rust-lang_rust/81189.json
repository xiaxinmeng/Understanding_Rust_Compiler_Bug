{"url": "https://api.github.com/repos/rust-lang/rust/issues/81189", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81189/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81189/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81189/events", "html_url": "https://github.com/rust-lang/rust/issues/81189", "id": 789216857, "node_id": "MDU6SXNzdWU3ODkyMTY4NTc=", "number": 81189, "title": "Test for repr-transparent-aggregates-1.rs fails cross-compiling wasm32-unknown-unknown with LLVM 11.0", "user": {"login": "sundbry", "id": 549273, "node_id": "MDQ6VXNlcjU0OTI3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/549273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sundbry", "html_url": "https://github.com/sundbry", "followers_url": "https://api.github.com/users/sundbry/followers", "following_url": "https://api.github.com/users/sundbry/following{/other_user}", "gists_url": "https://api.github.com/users/sundbry/gists{/gist_id}", "starred_url": "https://api.github.com/users/sundbry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sundbry/subscriptions", "organizations_url": "https://api.github.com/users/sundbry/orgs", "repos_url": "https://api.github.com/users/sundbry/repos", "events_url": "https://api.github.com/users/sundbry/events{/privacy}", "received_events_url": "https://api.github.com/users/sundbry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-01-19T17:30:40Z", "updated_at": "2021-01-19T17:44:52Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "[This test](https://github.com/rust-lang/rust/blob/582071c1ebd5ec19ded8648223e9108b5ce65d85/src/test/codegen/repr-transparent-aggregates-1.rs) fails on rust-1.49 cross compiling wasm32-unknown-unknown with LLVM 11.0. It looks like the intermediate representation for a void function has significantly changed from what is expected (see attached .ll file).\r\n\r\n[repr-transparent-aggregates-1.ll](https://github.com/rust-lang/rust/files/5837518/repr-transparent-aggregates-1.ll.txt)\r\n[Guix Build log rust-1.49.0.drv.txt.gz](https://github.com/rust-lang/rust/files/5837519/rust-1.49.0.drv.txt.gz)\r\n\r\n\r\n\r\nActual code generated for test_BigS:\r\n```\r\n; Function Attrs: nounwind\r\ndefine %BigS @test_BigS(%BigS %0) unnamed_addr #0 {\r\nstart:\r\n  %1 = alloca %BigS, align 4\r\n  %_1 = alloca %BigS, align 4\r\n  store %BigS %0, %BigS* %_1, align 4\r\n  br label %bb1\r\n\r\nbb1:                                              ; preds = %bb1, %start\r\n  call void @llvm.sideeffect()\r\n  br label %bb1\r\n}\r\n```\r\n\r\nError (expected function signature):\r\n\r\n```\r\n/tmp/guix-build-rust-1.49.0.drv-0/rustc-1.49.0-src/src/test/codegen/repr-transparent-aggregates-1.rs:37:11: error: CHECK: expected string not found in input\r\n// CHECK: define void @test_BigS(%BigS* [[BIGS_RET_ATTRS:.*]], %BigS* [[BIGS_ARG_ATTRS1:.*]] byval(%BigS) [[BIGS_ARG_ATTRS2:.*]])\r\n          ^\r\n/tmp/guix-build-rust-1.49.0.drv-0/rustc-1.49.0-src/build/x86_64-unknown-linux-gnu/test/codegen/repr-transparent-aggregates-1/repr-transparent-aggregates-1.ll:1:1\r\n: note: scanning from here\r\n; ModuleID = 'repr_transparent_aggregates_1.3a1fbbbh-cgu.0'\r\n^\r\n/tmp/guix-build-rust-1.49.0.drv-0/rustc-1.49.0-src/build/x86_64-unknown-linux-gnu/test/codegen/repr-transparent-aggregates-1/repr-transparent-aggregates-1.ll:16:\r\n1: note: possible intended match here\r\ndefine %BigS @test_BigS(%BigS %0) unnamed_addr #0 {\r\n```\r\n\r\n\r\nRelated discussion regarding unstable IR code gen: https://github.com/rust-lang/rust/issues/74396#issuecomment-659465905\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81189/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81189/timeline", "performed_via_github_app": null, "state_reason": null}