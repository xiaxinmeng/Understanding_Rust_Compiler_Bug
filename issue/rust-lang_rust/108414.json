{"url": "https://api.github.com/repos/rust-lang/rust/issues/108414", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/108414/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/108414/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/108414/events", "html_url": "https://github.com/rust-lang/rust/issues/108414", "id": 1597679474, "node_id": "I_kwDOAAsO6M5fOqdy", "number": 108414, "title": "Consider disabling LVI mitigations in the x86_64-fortanix-unknown-sgx target", "user": {"login": "clauverjat", "id": 29842852, "node_id": "MDQ6VXNlcjI5ODQyODUy", "avatar_url": "https://avatars.githubusercontent.com/u/29842852?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clauverjat", "html_url": "https://github.com/clauverjat", "followers_url": "https://api.github.com/users/clauverjat/followers", "following_url": "https://api.github.com/users/clauverjat/following{/other_user}", "gists_url": "https://api.github.com/users/clauverjat/gists{/gist_id}", "starred_url": "https://api.github.com/users/clauverjat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clauverjat/subscriptions", "organizations_url": "https://api.github.com/users/clauverjat/orgs", "repos_url": "https://api.github.com/users/clauverjat/repos", "events_url": "https://api.github.com/users/clauverjat/events{/privacy}", "received_events_url": "https://api.github.com/users/clauverjat/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55302148, "node_id": "MDU6TGFiZWw1NTMwMjE0OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-x86_64", "name": "O-x86_64", "color": "6e6ec0", "default": false, "description": "Target: x64 processors"}, {"id": 122062043, "node_id": "MDU6TGFiZWwxMjIwNjIwNDM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-security", "name": "A-security", "color": "f7e101", "default": false, "description": "Area: Security related issues (example: address space layout randomization)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 632453790, "node_id": "MDU6TGFiZWw2MzI0NTM3OTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-target-specs", "name": "A-target-specs", "color": "f7e101", "default": false, "description": "Area: compile-target specifications"}, {"id": 2227894826, "node_id": "MDU6TGFiZWwyMjI3ODk0ODI2", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-SGX", "name": "O-SGX", "color": "6e6ec0", "default": false, "description": "Target: SGX"}, {"id": 5223550385, "node_id": "LA_kwDOAAsO6M8AAAABN1kNsQ", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-target-feature", "name": "A-target-feature", "color": "f7e101", "default": false, "description": "Area: Enabling/disabling target features like AVX, Neon, etc."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2023-02-23T23:51:17Z", "updated_at": "2023-03-11T03:18:42Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "The x86_64-fortanix-unknown-sgx target currently has Load Value Injection (LVI) mitigations enabled by default. These mitigations were introduced by #72655.  At the time, these software mitigations were necessary on all Intel hardware to protect against the LVI vulnerability (CVE-2020-0551). Recent CPUs (such as Icelake and newer) now have hardware-level protections against LVI [^1], which makes the software-based mitigations unnecessary. \r\n\r\nSince LVI software mitigations can result in significant performance overheads (2x to 19x slowdown factor)[^2], it would be preferable to make these mitigations opt-in rather than enabled by default.\r\n\r\nThat being said the situation regarding speculative execution vulnerabilities is not simple. The LVI mitigations that we have enabled today might give us protection against other speculative attacks. So before removing the LVI mitigations, it's important to investigate whether we need software-based mitigations against other speculative execution attacks. For example, I saw that recent CPUs are vulnerable to Branch History Injection (BHI) and Intra-Mode BTI vulnerabilities[^3]. Those vulnerabilities are of the Spectre variant 2 kind. Those are usually mitigated with retpolines on x86 platforms, so we should consider using `target-feature=+retpoline`. Intel's technical documentation provides some recommendations[^4]. It's worth noting that retpolines are much lighter than LVI mitigations, typically resulting only in a 5-10% overhead[^5].\r\n\r\nThus, if we just need this mitigation on modern CPUs, this will already be a big performance win.\r\n\r\n@jethrogb @raoulstrackx : what do you think ? \r\n\r\n[^1]: https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/resources/processors-affected-load-value-injection.html\r\n[^2]: https://www.phoronix.com/review/lvi-attack-perf\r\n[^3]: https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00598.html\r\n[^4]: https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html\r\n[^5]: https://www.phoronix.com/news/LLVM-Retpoline-Added", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/108414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/108414/timeline", "performed_via_github_app": null, "state_reason": null}