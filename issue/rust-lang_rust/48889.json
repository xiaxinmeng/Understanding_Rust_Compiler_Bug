{"url": "https://api.github.com/repos/rust-lang/rust/issues/48889", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48889/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48889/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48889/events", "html_url": "https://github.com/rust-lang/rust/issues/48889", "id": 303969845, "node_id": "MDU6SXNzdWUzMDM5Njk4NDU=", "number": 48889, "title": "Macros 2.0: Negative numbers as a single token", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 632573348, "node_id": "MDU6TGFiZWw2MzI1NzMzNDg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros-2.0", "name": "A-macros-2.0", "color": "f7e101", "default": false, "description": "Area: declarative macros 2.0, https://github.com/rust-lang/rust/issues/39412"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-03-09T20:26:52Z", "updated_at": "2018-04-01T10:10:15Z", "closed_at": "2018-04-01T10:10:15Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "@ngg ran into some [weird bugs](https://github.com/alexcrichton/proc-macro2/issues/67#issuecomment-371311421) and made an [awesome reduction](https://github.com/ngg/proc_macro_nightly_bug) which boils down to:\r\n\r\n```rust\r\n#[proc_macro]\r\npub fn buggy_macro(_: TokenStream) -> TokenStream {\r\n    TokenNode::Literal(Literal::i32(-1)).into()\r\n}\r\n```\r\n\r\nIt turns out that when expanding this rustc will print out:\r\n\r\n```\r\nerror: int literal is too large\r\n```\r\n\r\nOriginating from [here](https://github.com/rust-lang/rust/blob/fedce67cd21dc08ece5a484fe1a060346acac98a/src/libsyntax/parse/mod.rs#L648-L664) I think that this is actually a misdiagnosed error in the sense that the parse is failing because the string is `\"-1\"` which isn't parseable as a `u128`, but the current code assumes that it can only fail due to overflow. Generally this is correct because the parser never feeds minus signs to this function!\r\n\r\nSo the broader issue here I believe is that `Literal::i32` can't actually exist. Our parser, as-is today, (and tokenizer?) dictates that the source string `-1` is lexed as two tokens, the minus and then the `1`. This means that `Literal::i32` pretending it can only be one token isn't actually right!\r\n\r\nShould we remove `Literal::i32` and all other signed functions? If so should we also panic on negative floats? If not, should we refactor the AST to support literal tokens with negative integers?\r\n\r\ncc @jseyfried, @dtolnay, @nrc ", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48889/reactions", "total_count": 3, "+1": 0, "-1": 0, "laugh": 3, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48889/timeline", "performed_via_github_app": null, "state_reason": "completed"}