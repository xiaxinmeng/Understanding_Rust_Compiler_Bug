{"url": "https://api.github.com/repos/rust-lang/rust/issues/69948", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/69948/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/69948/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/69948/events", "html_url": "https://github.com/rust-lang/rust/issues/69948", "id": 579909616, "node_id": "MDU6SXNzdWU1Nzk5MDk2MTY=", "number": 69948, "title": "ICE on calling a macro with structs with type params.", "user": {"login": "kepexx", "id": 39168965, "node_id": "MDQ6VXNlcjM5MTY4OTY1", "avatar_url": "https://avatars.githubusercontent.com/u/39168965?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kepexx", "html_url": "https://github.com/kepexx", "followers_url": "https://api.github.com/users/kepexx/followers", "following_url": "https://api.github.com/users/kepexx/following{/other_user}", "gists_url": "https://api.github.com/users/kepexx/gists{/gist_id}", "starred_url": "https://api.github.com/users/kepexx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kepexx/subscriptions", "organizations_url": "https://api.github.com/users/kepexx/orgs", "repos_url": "https://api.github.com/users/kepexx/repos", "events_url": "https://api.github.com/users/kepexx/events{/privacy}", "received_events_url": "https://api.github.com/users/kepexx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}, {"id": 1791937891, "node_id": "MDU6TGFiZWwxNzkxOTM3ODkx", "url": "https://api.github.com/repos/rust-lang/rust/labels/ICEBreaker-Cleanup-Crew", "name": "ICEBreaker-Cleanup-Crew", "color": "74cc28", "default": false, "description": "Helping to \"clean up\" bugs with minimal examples and bisections"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-03-12T12:37:28Z", "updated_at": "2020-03-12T13:54:56Z", "closed_at": "2020-03-12T13:54:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\n\r\nI don't know which part causes the error, but here's the [zipfile](https://cdn.discordapp.com/attachments/255409416772386817/687640266491953199/ffi-std.zip). It's very small, just 3 source files.\r\n\r\n\r\n### Meta\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.42.0-nightly (1ce08f9d6 2020-01-18)\r\nbinary: rustc\r\ncommit-hash: 1ce08f9d631ef767c915270bc63283c6af40dc3f\r\ncommit-date: 2020-01-18\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.42.0-nightly\r\nLLVM version: 9.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: DistinctSources(DistinctSources { begin: (Real(\"src\\\\lib.rs\"), BytePos(0)), end: (Real(\"src\\\\slice.rs\"), BytePos(900)) })', src\\librustc_errors\\lib.rs:197:29\r\n```\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n\u03bb set RUST_BACKTRACE=1 && cargo build\r\n   Compiling ffi-std v0.1.0 (D:\\projects\\active\\ffi-std)\r\nwarning: unused import: `DerefMut`\r\n --> src\\slice.rs:3:23\r\n  |\r\n3 | use std::ops::{Deref, DerefMut};\r\n  |                       ^^^^^^^^\r\n  |\r\n  = note: `#[warn(unused_imports)]` on by default\r\n\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: DistinctSources(DistinctSources { begin: (Real(\"src\\\\lib.rs\"), BytePos(0)), end: (Real(\"src\\\\slice.rs\"), BytePos(900)) })', src\\librustc_errors\\lib.rs:197:29\r\nstack backtrace:\r\n   0: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n   1: core::fmt::write\r\n   2: <std::io::IoSliceMut as core::fmt::Debug>::fmt\r\n   3: std::panicking::take_hook\r\n   4: std::panicking::take_hook\r\n   5: rustc_driver::report_ice\r\n   6: std::panicking::rust_panic_with_hook\r\n   7: rust_begin_unwind\r\n   8: core::panicking::panic_fmt\r\n   9: core::result::unwrap_failed\r\n  10: rustc_feature::active::ACTIVE_FEATURES::f\r\n  11: rustc_errors::annotate_snippet_emitter_writer::AnnotateSnippetEmitterWriter::ui_testing\r\n  12: <rustc_errors::emitter::EmitterWriter as rustc_errors::emitter::Emitter>::emit_diagnostic\r\n  13: <rustc_errors::json::JsonEmitter as rustc_errors::emitter::Emitter>::emit_diagnostic\r\n  14: rustc_errors::HandlerInner::emit_diagnostic\r\n  15: rustc_errors::diagnostic_builder::DiagnosticBuilder::emit\r\n  16: <rustc_typeck::collect::PlaceholderHirTyCollector as rustc_hir::intravisit::Visitor>::visit_ty\r\n  17: <rustc_typeck::collect::CollectItemTypesVisitor as rustc_hir::intravisit::Visitor>::visit_item\r\n  18: <rustc_typeck::variance::terms::InferredIndex as core::fmt::Debug>::fmt\r\n  19: rustc_typeck::expr_use_visitor::ExprUseVisitor::walk_expr\r\n  20: <rustc_typeck::check::check_opaque_for_inheriting_lifetimes::ProhibitOpaqueVisitor as core::fmt::Debug>::fmt\r\n  21: <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt\r\n  22: <rustc_typeck::check::method::probe::ProbeScope as core::fmt::Debug>::fmt\r\n  23: <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt\r\n  24: <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt\r\n  25: rustc_typeck::check_crate\r\n  26: rustc_interface::passes::QueryContext::print_stats\r\n  27: rustc_driver::pretty::print_after_hir_lowering\r\n  28: rustc_driver::pretty::print_after_hir_lowering\r\n  29: rustc_driver::pretty::print_after_hir_lowering\r\n  30: rustc_driver::pretty::print_after_hir_lowering\r\n  31: rustc_driver::pretty::print_after_hir_lowering\r\n  32: <rustc_driver::Compilation as core::fmt::Debug>::fmt\r\n  33: <rustc_driver::Compilation as core::fmt::Debug>::fmt\r\n  34: rustc_driver::pretty::print_after_hir_lowering\r\n  35: _rust_maybe_catch_panic\r\n  36: rustc_driver::pretty::print_after_hir_lowering\r\n  37: ZN244_$LT$std..error..$LT$impl$u20$core..convert..From$LT$alloc..string..String$GT$$u20$for$u20$alloc..boxed..Box$LT$dyn$u20$std..error..Error$u2b$core..marker..Sync$u2b$core..marker..Send$GT$$GT$..from..StringError$u20$as$u20$core..fmt..Display$GT$3fmt17\r\n  38: std::sys::windows::thread::Thread::new\r\n  39: BaseThreadInitThunk\r\n  40: RtlUserThreadStart\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.42.0-nightly (1ce08f9d6 2020-01-18) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [collect_mod_item_types] collecting item types in module `slice`\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: internal compiler error: bad placeholder type\r\n  --> src\\slice.rs:13:73\r\n   |\r\n13 | constructor!(FFISlice<T>; ptr: *const T, len: usize); display!(FFISlice<_>); debug!(FFISlice<_>);\r\n   |                                                                         ^\r\n\r\nthread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src\\librustc_errors\\lib.rs:356:17\r\nstack backtrace:\r\n   0:     0x7ffa63257689 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h6dc2c5916632db49\r\n   1:     0x7ffa632822db - core::fmt::write::h52a946af4bd6ee1f\r\n   2:     0x7ffa632492c4 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::hf5e8a05ca8e7e878\r\n   3:     0x7ffa6325bd2c - std::panicking::take_hook::ha0832abcc0af4162\r\n   4:     0x7ffa6325b97c - std::panicking::take_hook::ha0832abcc0af4162\r\n   5:     0x7ffa635270e4 - rustc_driver::report_ice::ha323ff4045a1702c\r\n   6:     0x7ffa6325c534 - std::panicking::rust_panic_with_hook::he93c4e55052d410d\r\n   7:     0x7ffa66f35ced - <rustc_errors::emitter::FileWithAnnotatedLines as core::fmt::Debug>::fmt::h4bdf93aa60e2a43c\r\n   8:     0x7ffa66f2038d - <rustc_errors::HandlerInner as core::ops::drop::Drop>::drop::h5328b60c8ac4780c\r\n   9:     0x7ffa63580c17 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  10:     0x7ffa635954e6 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  11:     0x7ffa6357924c - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  12:     0x7ffa63570ec1 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  13:     0x7ffa67086b60 - _rust_realloc\r\n  14:     0x7ffa670863bb - _rust_realloc\r\n  15:     0x7ffa670840e4 - _rust_realloc\r\n  16:     0x7ffa67085efe - _rust_realloc\r\n  17:     0x7ffa67084595 - _rust_realloc\r\n  18:     0x7ffa99c463bd - _chkstk\r\n  19:     0x7ffa99bc458c - RtlUnwindEx\r\n  20:     0x7ffa632a2255 - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  21:     0x7ffa632a307c - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  22:     0x7ffa632a3373 - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  23:     0x7ffa632a3a90 - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  24:     0x7ffa632a23c5 - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  25:     0x7ffa99c4633d - _chkstk\r\n  26:     0x7ffa99bc3c00 - RtlWalkFrameChain\r\n  27:     0x7ffa99bc21c4 - RtlRaiseException\r\n  28:     0x7ffa970ca1c8 - RaiseException\r\n  29:     0x7ffa632a272d - <libc::windows::timeval as core::clone::Clone>::clone::h4a298064cb9316a7\r\n  30:     0x7ffa6326de81 - _rust_start_panic\r\n  31:     0x7ffa6326de09 - _rust_start_panic\r\n  32:     0x7ffa6325c6d8 - rust_panic\r\n  33:     0x7ffa6325c5bd - std::panicking::rust_panic_with_hook::he93c4e55052d410d\r\n  34:     0x7ffa6325c095 - rust_begin_unwind\r\n  35:     0x7ffa6327ecd0 - core::panicking::panic_fmt::h65b0fe35a1f41d02\r\n  36:     0x7ffa6327e963 - core::result::unwrap_failed::hf29e45b6f7069c9d\r\n  37:     0x7ffa66f1f0f1 - rustc_feature::active::ACTIVE_FEATURES::f::hcf227fe31d9cbd69\r\n  38:     0x7ffa66f4eebf - rustc_errors::annotate_snippet_emitter_writer::AnnotateSnippetEmitterWriter::ui_testing::hedf6d55315776364\r\n  39:     0x7ffa66f29d23 - <rustc_errors::emitter::EmitterWriter as rustc_errors::emitter::Emitter>::emit_diagnostic::h05308105d22319cf\r\n  40:     0x7ffa66f3e800 - <rustc_errors::json::JsonEmitter as rustc_errors::emitter::Emitter>::emit_diagnostic::h407d98d7f1a5e258\r\n  41:     0x7ffa66f23936 - rustc_errors::HandlerInner::emit_diagnostic::h2a744e9c4d7f783d\r\n  42:     0x7ffa66f24d65 - rustc_errors::diagnostic_builder::DiagnosticBuilder::emit::h299227436f9a5eda\r\n  43:     0x7ffa6577933c - <rustc_typeck::collect::PlaceholderHirTyCollector as rustc_hir::intravisit::Visitor>::visit_ty::h484dd1d5e6027811\r\n  44:     0x7ffa65779aea - <rustc_typeck::collect::CollectItemTypesVisitor as rustc_hir::intravisit::Visitor>::visit_item::h8f7eb766d7b2c612\r\n  45:     0x7ffa657003d9 - <rustc_typeck::variance::terms::InferredIndex as core::fmt::Debug>::fmt::h2d0be5118c71aab8\r\n  46:     0x7ffa65778c04 - rustc_typeck::expr_use_visitor::ExprUseVisitor::walk_expr::hc453a8bdc53ae1da\r\n  47:     0x7ffa658026ad - <rustc_typeck::check::check_opaque_for_inheriting_lifetimes::ProhibitOpaqueVisitor as core::fmt::Debug>::fmt::hae839609ab16b0ac\r\n  48:     0x7ffa65898d9c - <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt::h7a81059ba570a56d\r\n  49:     0x7ffa65764190 - <rustc_typeck::check::method::probe::ProbeScope as core::fmt::Debug>::fmt::h176c8a617c18d3c5\r\n  50:     0x7ffa658df7f7 - <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt::h7a81059ba570a56d\r\n  51:     0x7ffa658992c4 - <rustc_typeck::check::method::CandidateSource as core::fmt::Debug>::fmt::h7a81059ba570a56d\r\n  52:     0x7ffa656ed6fb - rustc_typeck::check_crate::h4d24d689e19f64ea\r\n  53:     0x7ffa636c5981 - rustc_interface::passes::QueryContext::print_stats::hfb3b5278a85cb9df\r\n  54:     0x7ffa63569c03 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  55:     0x7ffa6356ba95 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  56:     0x7ffa6359755c - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  57:     0x7ffa6359ec1d - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  58:     0x7ffa6356f9a0 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  59:     0x7ffa635418ce - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h6dea0f0ce90733ef\r\n  60:     0x7ffa6353f649 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h6dea0f0ce90733ef\r\n  61:     0x7ffa63564c3c - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  62:     0x7ffa6326dd82 - _rust_maybe_catch_panic\r\n  63:     0x7ffa63572b22 - rustc_driver::pretty::print_after_hir_lowering::he79a023e751fcba8\r\n  64:     0x7ffa632379c7 - ZN244_$LT$std..error..$LT$impl$u20$core..convert..From$LT$alloc..string..String$GT$$u20$for$u20$alloc..boxed..Box$LT$dyn$u20$std..error..Error$u2b$core..marker..Sync$u2b$core..marker..Send$GT$$GT$..from..StringError$u20$as$u20$core..fmt..Display$GT$3fmt17\r\n  65:     0x7ffa6326b637 - std::sys::windows::thread::Thread::new::h4c2df6fe9da6590b\r\n  66:     0x7ffa99a62d92 - BaseThreadInitThunk\r\n  67:     0x7ffa99bb9f64 - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.42.0-nightly (1ce08f9d6 2020-01-18) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\nend of query stack\r\nthread panicked while panicking. aborting.\r\nerror: could not compile `ffi-std`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name ffi_std --edition=2018 src\\lib.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 -C metadata=00922e51e6a8b3d5 -C extra-filename=-00922e51e6a8b3d5 --out-dir D:\\projects\\active\\ffi-std\\target\\debug\\deps -C incremental=D:\\projects\\active\\ffi-std\\target\\debug\\incremental -L dependency=D:\\projects\\active\\ffi-std\\target\\debug\\deps` (exit code: 0xc000001d, STATUS_ILLEGAL_INSTRUCTION)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/69948/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/69948/timeline", "performed_via_github_app": null, "state_reason": "completed"}