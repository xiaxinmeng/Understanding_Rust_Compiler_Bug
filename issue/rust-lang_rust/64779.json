{"url": "https://api.github.com/repos/rust-lang/rust/issues/64779", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/64779/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/64779/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/64779/events", "html_url": "https://github.com/rust-lang/rust/issues/64779", "id": 498470315, "node_id": "MDU6SXNzdWU0OTg0NzAzMTU=", "number": 64779, "title": "build.rs:  `rerun-if-env-changed` should mean \"changed compared to last execution of the same kind\" (check vs build/run)", "user": {"login": "Boscop", "id": 535593, "node_id": "MDQ6VXNlcjUzNTU5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/535593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Boscop", "html_url": "https://github.com/Boscop", "followers_url": "https://api.github.com/users/Boscop/followers", "following_url": "https://api.github.com/users/Boscop/following{/other_user}", "gists_url": "https://api.github.com/users/Boscop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Boscop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Boscop/subscriptions", "organizations_url": "https://api.github.com/users/Boscop/orgs", "repos_url": "https://api.github.com/users/Boscop/repos", "events_url": "https://api.github.com/users/Boscop/events{/privacy}", "received_events_url": "https://api.github.com/users/Boscop/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-25T19:09:52Z", "updated_at": "2019-09-25T19:17:00Z", "closed_at": "2019-09-25T19:16:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Currently, it seems that build.rs scripts share the same environment when run by `cargo build`/`cargo run` and `cargo check`.\r\nThis is a problem which leads to unnecessary rebuilds of `libsqlite3-sys` whenever I have `cargo watch -x run` running in cmd.exe, when I then do `cargo check` in my editor (so that I can jump to errors/warnings easily).\r\nThis causes a [rebuild of `libsqlite3-sys`](https://github.com/jgallagher/rusqlite/issues/435) and all its dependent crates in my workspace for every switch between `cargo check` and the `cargo run` started by `cargo watch`. \r\nBecause: [`libsqlite3-sys` uses `rerun-if-env-changed=PATH`](https://github.com/jgallagher/rusqlite/issues/329) AND apparently `cargo watch` gives a different `PATH` to `cargo run` than cmd.exe has. Because if I run `cargo run` normally (not through `cargo watch`) this doesn't happen.\r\nThe same happens when I run `cargo run` normally (not through `cargo watch`) but in [Cmder](https://cmder.net/) instead of in cmd.exe, and here I know that it has a different PATH than my editor. In Sublime Text and in Cmder I ran the python command `import os; os.environ['PATH']` to check, and indeed, Cmder adds some of his own folders to `PATH`, which is why I switched to using the bare cmd.exe (to avoid the recompilations of `libsqlite3-sys` and its dependent crates in my workspace, which takes several minutes every time). But in bare cmd.exe, the same unnecessary recompilations happen when using `cargo watch -x run` and doing `cargo check` in Sublime Text.\r\n\r\nSo currently, it seems that `rerun-if-env-changed` means, \"changed, regardless of whether we also switched between check and build/run\".\r\nI suggest that `rerun-if-env-changed` should mean \"changed compared to last execution of the same kind\": If the build.rs script is currently being executed because of `cargo check`, compare the env var to the last time it was also executed by `cargo check`, NOT by `cargo build`. \r\nAnd similarly for `cargo build/run`. `build` and `run` are treated the same, because `run` implies `build`. But `check` doesn't imply `build`, they also produce separate artifacts in the target dir. **So in a similar vein, their env's should be kept separate with respect to `rerun-if-env-changed`!**\r\n", "closed_by": {"login": "csmoe", "id": 35686186, "node_id": "MDQ6VXNlcjM1Njg2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/35686186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csmoe", "html_url": "https://github.com/csmoe", "followers_url": "https://api.github.com/users/csmoe/followers", "following_url": "https://api.github.com/users/csmoe/following{/other_user}", "gists_url": "https://api.github.com/users/csmoe/gists{/gist_id}", "starred_url": "https://api.github.com/users/csmoe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csmoe/subscriptions", "organizations_url": "https://api.github.com/users/csmoe/orgs", "repos_url": "https://api.github.com/users/csmoe/repos", "events_url": "https://api.github.com/users/csmoe/events{/privacy}", "received_events_url": "https://api.github.com/users/csmoe/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/64779/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/64779/timeline", "performed_via_github_app": null, "state_reason": "completed"}