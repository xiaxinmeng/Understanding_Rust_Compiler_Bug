{"url": "https://api.github.com/repos/rust-lang/rust/issues/58792", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58792/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58792/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58792/events", "html_url": "https://github.com/rust-lang/rust/issues/58792", "id": 415378531, "node_id": "MDU6SXNzdWU0MTUzNzg1MzE=", "number": 58792, "title": "Suggest `split_at_mut` when trying to use multiple non-overlapping mutable slices to the same array", "user": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1183099971, "node_id": "MDU6TGFiZWwxMTgzMDk5OTcx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-suggestion-diagnostics", "name": "A-suggestion-diagnostics", "color": "f7e101", "default": false, "description": "Area: suggestions generated by the compiler applied by cargo fix"}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}, {"id": 3425147156, "node_id": "LA_kwDOAAsO6M7MJ5kU", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-array", "name": "A-array", "color": "f7e101", "default": false, "description": "Area: [T; N]"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-02-27T23:41:55Z", "updated_at": "2023-03-07T05:45:15Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "[The following code](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=1947bc965868f90b695a62803f999657) is invalid due to lifetime rules:\r\n\r\n```\r\nfn main() {\r\n    let mut foo = [1,2,3,4];\r\n    let mut a = &mut foo[..2];\r\n    let mut b = &mut foo[2..];\r\n    a[0] = 5;\r\n    b[0] = 6;\r\n    println!(\"{:?} {:?}\", a, b);\r\n}\r\n```\r\n\r\n```\r\nerror[E0499]: cannot borrow `foo` as mutable more than once at a time\r\n --> src/main.rs:4:22\r\n  |\r\n3 |     let mut a = &mut foo[..2];\r\n  |                      --- first mutable borrow occurs here\r\n4 |     let mut b = &mut foo[2..];\r\n  |                      ^^^ second mutable borrow occurs here\r\n5 |     a[0] = 5;\r\n  |     ---- first borrow later used here\r\n```\r\n\r\nThe solution is to either use `unsafe` or (more appropriately) use [`split_at_mut`](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=b789f2e5abc3895158f80a9602e59b6b):\r\n\r\n```\r\nfn main() {\r\n    let mut foo = [1,2,3,4];\r\n    let (mut a, mut b) = foo.split_at_mut(2);\r\n    a[0] = 5;\r\n    b[0] = 6;\r\n    println!(\"{:?} {:?}\", a, b);\r\n}\r\n```\r\n\r\nThe compiler should detect the case of multiple mutable borrows to the same array/slice and hint at the existence of `split_at_mut`. Ideally, we would also verify wether there's a range overlap in order to explain to the user why what they want to do is problematic and disallowed in Rust.\r\n\r\nThe output should ideally be along the lines of the following (the structured suggestion is not _needed_ to fix this issue, the text would be enough of an improvement):\r\n\r\n```\r\nerror[E0499]: cannot borrow `foo` as mutable more than once at a time\r\n --> src/main.rs:4:22\r\n  |\r\n3 |     let mut a = &mut foo[..2];\r\n  |                      --- first mutable borrow occurs here\r\n4 |     let mut b = &mut foo[2..];\r\n  |                      ^^^ second mutable borrow occurs here\r\n5 |     a[0] = 5;\r\n  |     ---- first borrow later used here\r\n  = note: you cannot have multiple mutable borrows to the same piece of memory, as the compiler cannot assure that the different slices you're trying to use are non-overlapping\r\nhelp: you can instead use `split_at_mut` to get two non-overlapping mutable slices from a single array/slice\r\n  |\r\n3 |     let (mut a, mut b) = foo.split_at_mut(2);\r\n  |         ^^^^^^^^^^^^^^   ^^^^^^^^^^^^^^^^^^^\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58792/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58792/timeline", "performed_via_github_app": null, "state_reason": null}