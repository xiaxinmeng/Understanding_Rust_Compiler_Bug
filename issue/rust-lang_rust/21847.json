{"url": "https://api.github.com/repos/rust-lang/rust/issues/21847", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21847/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21847/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21847/events", "html_url": "https://github.com/rust-lang/rust/issues/21847", "id": 56180566, "node_id": "MDU6SXNzdWU1NjE4MDU2Ng==", "number": 21847, "title": "thread 'rustc' panicked at 'Trying to convert unsized value to lval'", "user": {"login": "jarrett", "id": 16208, "node_id": "MDQ6VXNlcjE2MjA4", "avatar_url": "https://avatars.githubusercontent.com/u/16208?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jarrett", "html_url": "https://github.com/jarrett", "followers_url": "https://api.github.com/users/jarrett/followers", "following_url": "https://api.github.com/users/jarrett/following{/other_user}", "gists_url": "https://api.github.com/users/jarrett/gists{/gist_id}", "starred_url": "https://api.github.com/users/jarrett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jarrett/subscriptions", "organizations_url": "https://api.github.com/users/jarrett/orgs", "repos_url": "https://api.github.com/users/jarrett/repos", "events_url": "https://api.github.com/users/jarrett/events{/privacy}", "received_events_url": "https://api.github.com/users/jarrett/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2015-02-01T22:10:34Z", "updated_at": "2015-03-28T19:58:20Z", "closed_at": "2015-03-28T19:58:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "I got this compiling a fairly large app:\n\n```\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Trying to convert unsized value to lval', /Users/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-mac/build/src/librustc_trans/trans/datum.rs:402\n\nstack backtrace:\n   1:        0x10c85ecd7 - sys::backtrace::write::h4ee5c5ad264b65f5mbu\n   2:        0x10c884e9c - failure::on_fail::h55e5ff39107f11fcHbB\n   3:        0x10c7e6618 - rt::unwind::begin_unwind_inner::habba3c5d37f59591DTA\n   4:        0x10904eca5 - rt::unwind::begin_unwind::h5615917778268573803\n   5:        0x1090d753e - trans::datum::Datum<'tcx, Expr>::to_lvalue_datum::h9595aad7c2992d4cZSf\n   6:        0x1090feaac - trans::expr::trans_index::h33588fb9dd7ce121yzi\n   7:        0x1090e75a3 - trans::expr::trans_unadjusted::h4bfe4622405612c0Vki\n   8:        0x10909f7d4 - trans::expr::trans::h87900629b98dec94YCh\n   9:        0x109101448 - trans::expr::trans_addr_of::he4d93cb9897bf566uHj\n  10:        0x1090e779e - trans::expr::trans_unadjusted::h4bfe4622405612c0Vki\n  11:        0x10909f7d4 - trans::expr::trans::h87900629b98dec94YCh\n  12:        0x10909e521 - trans::expr::trans_into::h8d099f5179d39277uzh\n  13:        0x10911d773 - trans::expr::trans_adt::h04652ea6bac31317Drj\n  14:        0x1090b0cdf - trans::base::trans_named_tuple_constructor::h27bf054814ac4386Dcu\n  15:        0x1090e25a6 - trans::callee::trans_call_inner::h12337891083913942824\n  16:        0x1090e9b77 - trans::expr::trans_rvalue_dps_unadjusted::h76d104b0c393ded0ITi\n  17:        0x10909e762 - trans::expr::trans_into::h8d099f5179d39277uzh\n  18:        0x10909f339 - trans::controlflow::trans_block::ha4c3bc4d960bd55aT3d\n  19:        0x1090e8c91 - trans::expr::trans_rvalue_dps_unadjusted::h76d104b0c393ded0ITi\n  20:        0x10909e762 - trans::expr::trans_into::h8d099f5179d39277uzh\n  21:        0x10909f339 - trans::controlflow::trans_block::ha4c3bc4d960bd55aT3d\n  22:        0x10916c644 - trans::base::trans_closure::hc2f7f2fc0f6c7df0WXt\n  23:        0x10908b1c9 - trans::base::trans_fn::he8bb083f0eb63cd3Q8t\n  24:        0x109086f0b - trans::base::trans_item::h6e886ccbd5f66d227vu\n  25:        0x10916de29 - trans::base::trans_mod::hacffe7d798632c0cIBu\n  26:        0x10908664e - trans::base::trans_item::h6e886ccbd5f66d227vu\n  27:        0x109172a8c - trans::base::trans_crate::h03f93f510f95d199hrv\n  28:        0x108f29f6e - driver::phase_4_translate_to_llvm::hf01e1f3e6069eac9mOa\n  29:        0x108f05f3c - driver::compile_input::h8e0204b8bb9ea44bBba\n  30:        0x108fced3e - run_compiler::h322f9334a9a1d7e6l9b\n  31:        0x108fcbd7f - thunk::F.Invoke<A, R>::invoke::h14356237310415989951\n  32:        0x108fcaa10 - rt::unwind::try::try_fn::h798029436104877783\n  33:        0x10c8fb329 - rust_try_inner\n  34:        0x10c8fb316 - rust_try\n  35:        0x108fcb0d4 - thunk::F.Invoke<A, R>::invoke::h15628186897385384602\n  36:        0x10c86f553 - sys::thread::thread_start::h3f48e8c893476626A3w\n  37:     0x7fff854c5899 - _pthread_body\n  38:     0x7fff854c572a - _pthread_struct_init\n```\n\nThe problem appears to be in this function:\n\n```\npub fn chunk_containing(&self, abs_x: u32, abs_y: u32) -> Option<&Chunk> {\n    // x_idx and y_idx are indices int the chunks array.\n    let x_idx: usize = abs_x.div_floor(&self.chunk_x_size) as usize;\n    let y_idx: usize = abs_y.div_floor(&self.chunk_y_size) as usize;\n\n    if ((x_idx as u32) < self.x_chunks && (y_idx as u32) < self.y_chunks) {\n        Some(&self.chunks[y_idx][x_idx])\n    } else {\n        None\n    }\n}\n```\n\nAnd specifically, the problem appears to be this line:\n\n```\nSome(&self.chunks[y_idx][x_idx])\n```\n\nI reached that conclusion because replacing the above line with `None` clears the error. The type of `self.chunks` is `[[Chunk]]`. Changing its type to `Vec<Vec<Chunk>>` also clears the error.\n\nOSX 10.9.5\nrustc 1.0.0-nightly (1d00c545e 2015-01-30 19:56:34 +0000)\nbinary: rustc\ncommit-hash: 1d00c545ede609b9d43fdf9f252c15da5a66dac7\ncommit-date: 2015-01-30 19:56:34 +0000\nhost: x86_64-apple-darwin\nrelease: 1.0.0-nightly\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21847/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21847/timeline", "performed_via_github_app": null, "state_reason": "completed"}