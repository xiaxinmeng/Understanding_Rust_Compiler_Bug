{"url": "https://api.github.com/repos/rust-lang/rust/issues/5874", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/5874/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/5874/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/5874/events", "html_url": "https://github.com/rust-lang/rust/issues/5874", "id": 13164898, "node_id": "MDU6SXNzdWUxMzE2NDg5OA==", "number": 5874, "title": "ICE with extern C functions receiving/returning structs by value with f32/f64 members on x86_64", "user": {"login": "SiegeLord", "id": 480550, "node_id": "MDQ6VXNlcjQ4MDU1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/480550?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SiegeLord", "html_url": "https://github.com/SiegeLord", "followers_url": "https://api.github.com/users/SiegeLord/followers", "following_url": "https://api.github.com/users/SiegeLord/following{/other_user}", "gists_url": "https://api.github.com/users/SiegeLord/gists{/gist_id}", "starred_url": "https://api.github.com/users/SiegeLord/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SiegeLord/subscriptions", "organizations_url": "https://api.github.com/users/SiegeLord/orgs", "repos_url": "https://api.github.com/users/SiegeLord/repos", "events_url": "https://api.github.com/users/SiegeLord/events{/privacy}", "received_events_url": "https://api.github.com/users/SiegeLord/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2013-04-13T23:49:35Z", "updated_at": "2013-06-26T22:05:09Z", "closed_at": "2013-06-26T09:32:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Structs that contain f32/f64 and have a total size of <= 128 bytes produce an out of bounds error at src/librustc/middle/trans/cabi_x86_64.rs:259 . Tested with incoming at a9247e07acc5829473239393b8a9cd367b710585.\n\nHere is a collection of structs that produce an ICE and some that don't. I haven't tested whether the ones that do compile produce correct code.\n\n``` rust\n// rust: task failed at 'index out of bounds: the len is 1 but the index is 1', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f64_1\n{\n    a : f64,\n}\n\n// rust: task failed at 'index out of bounds: the len is 2 but the index is 2', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f64_2\n{\n    a : f64,\n    b : f64\n}\n\n// No ICE\nstruct f64_3\n{\n    a : f64,\n    b : f64,\n    c : f64\n}\n\n// No ICE\nstruct f64_4\n{\n    a : f64,\n    b : f64,\n    c : f64,\n    d : f64\n}\n\n// No ICE\nstruct f64_5\n{\n    a : f64,\n    b : f64,\n    c : f64,\n    d : f64,\n    e : f64\n}\n\n// rust: task failed at 'index out of bounds: the len is 1 but the index is 1', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f32_1\n{\n    a : f32\n}\n\n// rust: task failed at 'index out of bounds: the len is 1 but the index is 1', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f32_2\n{\n    a : f32,\n    b : f32\n}\n\n// rust: task failed at 'index out of bounds: the len is 2 but the index is 2', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f32_3\n{\n    a : f32,\n    b : f32,\n    c : f32\n}\n\n// rust: task failed at 'index out of bounds: the len is 2 but the index is 2', /home/siege/src/rust2/src/librustc/middle/trans/cabi_x86_64.rs:259\nstruct f32_4\n{\n    a : f32,\n    b : f32,\n    c : f32,\n    d : f32,\n}\n\n// No ICE\nstruct f32_5\n{\n    a : f32,\n    b : f32,\n    c : f32,\n    d : f32,\n    e : f32,\n}\n\ntype T = f32_1;\n\nextern \"C\"\n{\n    fn test1(a : T);\n    fn test2() -> T;\n}\n\nfn main()\n{\n}\n```\n\nHere's a representative backtrace, if it's useful:\n\n```\n/usr/local/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7fcb85a20c8b]\n/usr/local/bin/../lib/librustrt.so(+0x2aa79)[0x7fcb85a31a79]\n/usr/local/bin/../lib/librustrt.so(upcall_fail+0x1a8)[0x7fcb85a22a78]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x10911b)[0x7fcb875f611b]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x4f15e)[0x7fcb8753c15e]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(_ZN8unstable4lang17fail_bounds_check16_6fb13a2fe60974b6_07preE+0x23a)[0x7fcb875454da]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x305e2d)[0x7fcb85f68e2d]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x3066f4)[0x7fcb85f696f4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle5trans11cabi_x86_6414__extensions__10meth_3501512compute_info17_63f5244ae590c1b66_07preE+0x11e)[0x7fcb85f698fe]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x309fea)[0x7fcb85f6cfea]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x30b52d)[0x7fcb85f6e52d]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x30b210)[0x7fcb85f6e210]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle5trans7foreign17trans_foreign_mod17_f7e97aff939386996_07preE+0x11e)[0x7fcb85ee75ee]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle5trans4base10trans_item17_e83b64764568c7be6_07preE+0x499)[0x7fcb85d7b909]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle5trans4base9trans_mod17_d740d055c716f9476_07preE+0xa3)[0x7fcb85ee73d3]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6middle5trans4base11trans_crate15_4f38ab124cab2e6_07preE+0x13c4)[0x7fcb85f073e4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x8ddce4)[0x7fcb86540ce4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x89b8b0)[0x7fcb864fe8b0]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver12compile_rest15_58068714615f2b6_07preE+0x336a)[0x7fcb864fb90a]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x8ddce4)[0x7fcb86540ce4]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver12compile_upto17_3ccd839185751c4f6_07preE+0x108)[0x7fcb864feac8]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN6driver6driver13compile_input17_7bc345e59d22cba06_07preE+0xca)[0x7fcb864fef0a]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(_ZN12run_compiler16_aa88c3dc13843746_07preE+0x20a0)[0x7fcb86531720]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x8db691)[0x7fcb8653e691]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x8d7bba)[0x7fcb8653abba]\n/usr/local/bin/../lib/librustc-c84825241471686d-0.7-pre.so(+0x8ddce4)[0x7fcb86540ce4]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0xd0fbf)[0x7fcb875bdfbf]\n/usr/local/bin/../lib/libcore-c3ca5d77d81b46c1-0.7-pre.so(+0x152264)[0x7fcb8763f264]\n/usr/local/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7fcb85a214d4]\n```\n", "closed_by": {"login": "jdm", "id": 27658, "node_id": "MDQ6VXNlcjI3NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/27658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdm", "html_url": "https://github.com/jdm", "followers_url": "https://api.github.com/users/jdm/followers", "following_url": "https://api.github.com/users/jdm/following{/other_user}", "gists_url": "https://api.github.com/users/jdm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdm/subscriptions", "organizations_url": "https://api.github.com/users/jdm/orgs", "repos_url": "https://api.github.com/users/jdm/repos", "events_url": "https://api.github.com/users/jdm/events{/privacy}", "received_events_url": "https://api.github.com/users/jdm/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/5874/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/5874/timeline", "performed_via_github_app": null, "state_reason": "completed"}