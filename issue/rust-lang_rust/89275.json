{"url": "https://api.github.com/repos/rust-lang/rust/issues/89275", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89275/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89275/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89275/events", "html_url": "https://github.com/rust-lang/rust/issues/89275", "id": 1007428926, "node_id": "I_kwDOAAsO6M48DCU-", "number": 89275, "title": "Overflow evaluating the requirement [stable/nightly]", "user": {"login": "ZippyMagician", "id": 23122747, "node_id": "MDQ6VXNlcjIzMTIyNzQ3", "avatar_url": "https://avatars.githubusercontent.com/u/23122747?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZippyMagician", "html_url": "https://github.com/ZippyMagician", "followers_url": "https://api.github.com/users/ZippyMagician/followers", "following_url": "https://api.github.com/users/ZippyMagician/following{/other_user}", "gists_url": "https://api.github.com/users/ZippyMagician/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZippyMagician/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZippyMagician/subscriptions", "organizations_url": "https://api.github.com/users/ZippyMagician/orgs", "repos_url": "https://api.github.com/users/ZippyMagician/repos", "events_url": "https://api.github.com/users/ZippyMagician/events{/privacy}", "received_events_url": "https://api.github.com/users/ZippyMagician/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 13836860, "node_id": "MDU6TGFiZWwxMzgzNjg2MA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-traits", "name": "A-traits", "color": "f7e101", "default": false, "description": "Area: Trait system"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604454086, "node_id": "MDU6TGFiZWw2MDQ0NTQwODY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inference", "name": "A-inference", "color": "f7e101", "default": false, "description": "Area: Type inference"}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2021-09-26T15:52:16Z", "updated_at": "2021-10-08T14:35:00Z", "closed_at": "2021-10-08T14:35:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nGiven the following code snippet:\r\n\r\n```rust\r\nuse num_rational as _;\r\n\r\nstruct Foo;\r\n\r\nimpl Foo {\r\n    fn downcast<W>(&self) -> &W {\r\n        todo!()\r\n    }\r\n}\r\n\r\nstruct Other;\r\n\r\nfn main() {\r\n    let other: &mut Other = Foo.downcast();\r\n}\r\n```\r\n\r\nOne would expect the code to error, explaining that the types differ in mutability (*we will come back to this in a moment*).\r\n\r\nHowever, it instead leaves a long and confusing error:\r\n```\r\nerror[E0275]: overflow evaluating the requirement `&Ratio<_>: num_traits::pow::Pow<u32>`\r\n  --> src/main.rs:14:29\r\n   |\r\n14 |     let other: &mut Other = Foo.downcast();\r\n   |                             ^^^^^^^^^^^^^^\r\n   |\r\n   = help: consider adding a `#![recursion_limit=\"256\"]` attribute to your crate (`bug`)\r\n   = note: required because of the requirements on the impl of `num_traits::pow::Pow<u32>` for `&Ratio<Ratio<_>>`\r\n   = note: 127 redundant requirements hidden\r\n   = note: required because of the requirements on the impl of `num_traits::pow::Pow<&i32>` for `&Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<Ratio<_>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>`\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0275`.\r\nerror: could not compile `bug`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nIf you follow the suggestion of increasing the recursion limit each time, it will eventually segfault once you have `#![recursion_limit=\"2048\"]`\r\n```\r\nerror: could not compile `bug`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name bug --edition=2018 src/main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 -C metadata=f6406766fb3e32c0 -C extra-filename=-f6406766fb3e32c0 --out-dir /home/zippy/bug/target/debug/deps -C incremental=/home/zippy/bug/target/debug/incremental -L dependency=/home/zippy/bug/target/debug/deps --extern num_rational=/home/zippy/bug/target/debug/deps/libnum_rational-13f69084195ac9b5.rlib` (signal: 11, SIGSEGV: invalid memory reference)\r\n```\r\n\r\nFurthermore, removing the import of `num-rational` leads to the program erroring *as expected*\r\n```\r\nerror[E0308]: mismatched types\r\n  --> src/main.rs:12:29\r\n   |\r\n12 |     let other: &mut Other = Foo.downcast();\r\n   |                ----------   ^^^^^^^^^^^^^^ types differ in mutability\r\n   |                |\r\n   |                expected due to this\r\n   |\r\n   = note: expected mutable reference `&mut Other`\r\n                      found reference `&_`\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\nerror: could not compile `bug` due to previous error\r\n```\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.57.0-nightly (addb4da68 2021-09-25)\r\nbinary: rustc\r\ncommit-hash: addb4da686a97da46159f0123cb6cdc2ce3d7fdb\r\ncommit-date: 2021-09-25\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.57.0-nightly\r\nLLVM version: 13.0.0\r\n```\r\nThis error exists on stable, too.\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nThe code doesn't compile, and as such there's no backtrace\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89275/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89275/timeline", "performed_via_github_app": null, "state_reason": "completed"}