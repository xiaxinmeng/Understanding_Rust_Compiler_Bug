{"url": "https://api.github.com/repos/rust-lang/rust/issues/60019", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60019/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60019/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60019/events", "html_url": "https://github.com/rust-lang/rust/issues/60019", "id": 433965436, "node_id": "MDU6SXNzdWU0MzM5NjU0MzY=", "number": 60019, "title": "Apparent miscompilation when building typenum on raspbian buster.", "user": {"login": "plugwash", "id": 3199425, "node_id": "MDQ6VXNlcjMxOTk0MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/3199425?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plugwash", "html_url": "https://github.com/plugwash", "followers_url": "https://api.github.com/users/plugwash/followers", "following_url": "https://api.github.com/users/plugwash/following{/other_user}", "gists_url": "https://api.github.com/users/plugwash/gists{/gist_id}", "starred_url": "https://api.github.com/users/plugwash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plugwash/subscriptions", "organizations_url": "https://api.github.com/users/plugwash/orgs", "repos_url": "https://api.github.com/users/plugwash/repos", "events_url": "https://api.github.com/users/plugwash/events{/privacy}", "received_events_url": "https://api.github.com/users/plugwash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-04-16T20:15:50Z", "updated_at": "2019-07-17T02:17:48Z", "closed_at": "2019-04-18T12:20:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "While building typenum on raspbian buster (rust target arm-linux-gnueabihf) in relase mode I get a failure. This happens when building typenum seperately and also happened as part of the raspbian package builds for cargo and librsvg (I have now worked around it in those two packages).\r\n\r\nRustc in raspbian buster is currently at version 1.32.0\r\n\r\nTo reproduce, do the following in a raspbian buster environment\r\n\r\n    apt-get install rustc cargo\r\n    git clone https://github.com/paholg/typenum\r\n    cargo build --release\r\n\r\nThe failure is a bunch of errors like.\r\n\r\nerror[E0428]: the name `N1000` is defined multiple times\r\n    --> /typenum/target/release/build/typenum-da1991768bfa4481/out/consts.rs:2119:35\r\n\r\nThe problem appears to be caused by incorrect behaviour of the following code in build/main.rs\r\n\r\n    let highest: u64 = 1024;\r\n    \r\n    let first2: u32 = (highest as f64).log(2.0).round() as u32 + 1;                                                   \r\n    let first10: u32 = (highest as f64).log(10.0) as u32 + 1;                                                         \r\n    let uints = (0..(highest + 1))                                                                                    \r\n        .chain((first2..64).map(|i| 2u64.pow(i)))                                                                     \r\n        .chain((first10..20).map(|i| 10u64.pow(i)));\r\n\r\nFrom investigating the output file it seems that \"first2\" and \"first10\" are being miscalculated. First10 appears to be coming out as zero resulting in duplicates while first2 eppears to be coming out as a sufficiently large number to prevent generation of power of two types at all.\r\n\r\nWhen I replace the calculation of first2 and first10 with hardcoded values I can build the crate successfully in release mode. I used this workaround in the raspbian cargo and librsvg packages.", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60019/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60019/timeline", "performed_via_github_app": null, "state_reason": "completed"}