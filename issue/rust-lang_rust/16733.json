{"url": "https://api.github.com/repos/rust-lang/rust/issues/16733", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/16733/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/16733/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/16733/events", "html_url": "https://github.com/rust-lang/rust/issues/16733", "id": 41016974, "node_id": "MDU6SXNzdWU0MTAxNjk3NA==", "number": 16733, "title": "Broken install when configured with a custom --prefix", "user": {"login": "jasonroelofs", "id": 3223, "node_id": "MDQ6VXNlcjMyMjM=", "avatar_url": "https://avatars.githubusercontent.com/u/3223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonroelofs", "html_url": "https://github.com/jasonroelofs", "followers_url": "https://api.github.com/users/jasonroelofs/followers", "following_url": "https://api.github.com/users/jasonroelofs/following{/other_user}", "gists_url": "https://api.github.com/users/jasonroelofs/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonroelofs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonroelofs/subscriptions", "organizations_url": "https://api.github.com/users/jasonroelofs/orgs", "repos_url": "https://api.github.com/users/jasonroelofs/repos", "events_url": "https://api.github.com/users/jasonroelofs/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonroelofs/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2014-08-24T19:26:21Z", "updated_at": "2014-12-06T15:18:12Z", "closed_at": "2014-08-30T01:03:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to build Rust from source on Mac OS X 10.9 installing it to a custom prefix (`/opt/rust` because `/usr/local/` is managed by homebrew). I have successfully done `brew install rust --HEAD`, which works with the defaults and gives me a valid Rust install. However, my install to `/opt/rust` leads to an inability to find library files (and oddly is looking for stage1 library builds).\n\nSteps to get to where I am\n\n```\ngit clone ...\n./configure --prefix=/opt/rust --enable-clang --disable-rpath\nmake\nsudo make install\n```\n\nInstallation succeeds but running the installed `rustc` fails.\n\nFollowing other tickets found here, I made sure to set my `DYLD_LIBRARY_PATH` and my `LD_LIBRARY_PATH` for safe measure to the custom install directory.\n\n```\n] which rustc\n/opt/rust/bin/rustc\n\n] rustc -v\ndyld: Library not loaded: x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libnative-4e7c5e5c.dylib\n  Referenced from: /opt/rust/bin/rustc\n  Reason: image not found\nTrace/BPT trap: 5\n\n] echo $DYLD_LIBRARY_PATH\n/opt/rust/lib\n\n] echo $LD_LIBRARY_PATH\n/opt/rust/lib\n\n] ls /opt/rust/lib/\nlibarena-4e7c5e5c.dylib      liblog-4e7c5e5c.dylib        librustc_llvm-4e7c5e5c.dylib libsyntax-4e7c5e5c.dylib\nlibdebug-4e7c5e5c.dylib      libnative-4e7c5e5c.dylib     librustdoc-4e7c5e5c.dylib    libterm-4e7c5e5c.dylib\nlibflate-4e7c5e5c.dylib      librbml-4e7c5e5c.dylib       librustrt-4e7c5e5c.dylib     libtest-4e7c5e5c.dylib\nlibfmt_macros-4e7c5e5c.dylib libregex-4e7c5e5c.dylib      libserialize-4e7c5e5c.dylib  libtime-4e7c5e5c.dylib\nlibgetopts-4e7c5e5c.dylib    librustc-4e7c5e5c.dylib      libstd-4e7c5e5c.dylib        rustlib\nlibgraphviz-4e7c5e5c.dylib   librustc_back-4e7c5e5c.dylib libsync-4e7c5e5c.dylib\n\n] otool -L /opt/rust/bin/rustc\n/opt/rust/bin/rustc:\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libnative-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libarena-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc_llvm-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librbml-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libtime-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libgraphviz-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc_back-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libflate-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libsyntax-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libdebug-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libterm-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libserialize-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/liblog-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libfmt_macros-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libgetopts-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libstd-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libsync-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustrt-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)\n    /usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)\n    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.0.0)\n```\n\nIt seems that there's something wrong with the build process when using a custom prefix, such that the system doesn't take the final step of ensuring the binary will look for the various libraries in their installed locations.\n\nIn what may be a further help, the build system seems to be installing the binary from `stage2` which itself is linked back to the `stage1` libraries.\n\n```\n] otool -L /Users/roelofs/Source/rust/x86_64-apple-darwin/stage2/bin/rustc\n/Users/roelofs/Source/rust/x86_64-apple-darwin/stage2/bin/rustc:\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libnative-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libarena-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc_llvm-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librbml-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libtime-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libgraphviz-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustc_back-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libflate-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libsyntax-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libdebug-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libterm-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libserialize-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/liblog-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libfmt_macros-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libgetopts-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libstd-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/libsync-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    x86_64-apple-darwin/stage1/lib/rustlib/x86_64-apple-darwin/lib/librustrt-4e7c5e5c.dylib (compatibility version 0.0.0, current version 0.0.0)\n    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1197.1.1)\n    /usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)\n    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.0.0)\n```\n\nMy build's `stage3` directory is nothing but empty folders.\n\nThanks!\n", "closed_by": {"login": "jasonroelofs", "id": 3223, "node_id": "MDQ6VXNlcjMyMjM=", "avatar_url": "https://avatars.githubusercontent.com/u/3223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jasonroelofs", "html_url": "https://github.com/jasonroelofs", "followers_url": "https://api.github.com/users/jasonroelofs/followers", "following_url": "https://api.github.com/users/jasonroelofs/following{/other_user}", "gists_url": "https://api.github.com/users/jasonroelofs/gists{/gist_id}", "starred_url": "https://api.github.com/users/jasonroelofs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jasonroelofs/subscriptions", "organizations_url": "https://api.github.com/users/jasonroelofs/orgs", "repos_url": "https://api.github.com/users/jasonroelofs/repos", "events_url": "https://api.github.com/users/jasonroelofs/events{/privacy}", "received_events_url": "https://api.github.com/users/jasonroelofs/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/16733/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/16733/timeline", "performed_via_github_app": null, "state_reason": "completed"}