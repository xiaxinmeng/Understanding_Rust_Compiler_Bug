{"url": "https://api.github.com/repos/rust-lang/rust/issues/51175", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/51175/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/51175/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/51175/events", "html_url": "https://github.com/rust-lang/rust/issues/51175", "id": 327368387, "node_id": "MDU6SXNzdWUzMjczNjgzODc=", "number": 51175, "title": "NLL: \"explicit lifetime required\" error fails to highlight usage that introduces constraint ", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867465998, "node_id": "MDU6TGFiZWw4Njc0NjU5OTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-diagnostics", "name": "NLL-diagnostics", "color": "f799ea", "default": false, "description": "Working torwads the \"diagnostic parity\" goal"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/54", "html_url": "https://github.com/rust-lang/rust/milestone/54", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/54/labels", "id": 3463305, "node_id": "MDk6TWlsZXN0b25lMzQ2MzMwNQ==", "number": 54, "title": "Rust 2018 RC", "description": "See https://internals.rust-lang.org/t/rust-2018-the-home-stretch/7810", "creator": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 64, "state": "closed", "created_at": "2018-06-29T18:51:29Z", "updated_at": "2020-06-16T05:11:03Z", "due_on": "2018-09-13T07:00:00Z", "closed_at": "2018-11-16T11:06:58Z"}, "comments": 2, "created_at": "2018-05-29T15:18:15Z", "updated_at": "2018-08-18T14:35:49Z", "closed_at": "2018-08-18T14:35:49Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "There are a collection of tests where NLL is failing to highlight the expression relevant to debugging some lifetime error.\r\n\r\nHere is the list of tests that pnkfelix believes falls into that category:\r\n\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-early-bound-in-struct.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-early-bound-in-struct.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else-2.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-2.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else-3.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-3.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl-2.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl-2.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl-3.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl-3.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-using-impl.nll.stderr)\r\n * [ ] [ui/lifetime-errors/ex1-return-one-existing-name-if-else.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else.nll.stderr)\r\n\r\nHere's an explanation of the kind of (mis)behavior being described here:\r\n\r\nIn the following test ( [ex1-return-one-existing-name-if-else-3.rs](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-3.rs) ):\r\n\r\n```rust\r\nfn foo<'a>((x, y): (&'a i32, &i32)) -> &'a i32 {\r\n    if x > y { x } else { y } //~ ERROR explicit lifetime\r\n}\r\n```\r\n\r\nhere is the error output from AST borrowck ( [ex1-return-one-existing-name-if-else-3.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-3.stderr)  ) \r\n\r\n```\r\nerror[E0621]: explicit lifetime required in parameter type\r\n  --> $DIR/ex1-return-one-existing-name-if-else-3.rs:12:27\r\n   |\r\nLL | fn foo<'a>((x, y): (&'a i32, &i32)) -> &'a i32 {\r\n   |            ------ consider changing type to `(&'a i32, &'a i32)`\r\nLL |     if x > y { x } else { y } //~ ERROR explicit lifetime\r\n   |                           ^ lifetime `'a` required\r\n```\r\n\r\nwhile this is the error output from NLL: ( [ex1-return-one-existing-name-if-else-3.nll.stderr](https://github.com/rust-lang/rust/blob/master/src/test/ui/lifetime-errors/ex1-return-one-existing-name-if-else-3.nll.stderr) ):\r\n\r\n```\r\nwarning: not reporting region error due to nll\r\n  --> $DIR/ex1-return-one-existing-name-if-else-3.rs:12:27\r\n   |\r\nLL |     if x > y { x } else { y } //~ ERROR explicit lifetime\r\n   |                           ^\r\n\r\nerror[E0621]: explicit lifetime required in parameter type\r\n  --> $DIR/ex1-return-one-existing-name-if-else-3.rs:11:13\r\n   |\r\nLL | fn foo<'a>((x, y): (&'a i32, &i32)) -> &'a i32 {\r\n   |            -^----\r\n   |            ||\r\n   |            |lifetime `'a` required\r\n   |            consider changing type to `(&'a i32, &'a i32)`\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\nNote in particular that the *error* is failing to report the expression (namely the occurrence of `y` in an expression context that is expecting a `&'a i32`) that is injecting the lifetime constraint that lead it to suggest the change to the parameter type.\r\n\r\n(It seems likely that the span of interest is probably immediately  available, given that the warning we emit about not reporting a region error *does* highlight the span in which we are interested.)", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/51175/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/51175/timeline", "performed_via_github_app": null, "state_reason": "completed"}