{"url": "https://api.github.com/repos/rust-lang/rust/issues/82788", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/82788/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/82788/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/82788/events", "html_url": "https://github.com/rust-lang/rust/issues/82788", "id": 822694503, "node_id": "MDU6SXNzdWU4MjI2OTQ1MDM=", "number": 82788, "title": "E0603 is misleading on non-exhaustive enums", "user": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}, {"id": 1624891239, "node_id": "MDU6TGFiZWwxNjI0ODkxMjM5", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-incorrect", "name": "D-incorrect", "color": "c9f7a3", "default": false, "description": "A diagnostic that is giving misleading or incorrect information"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2021-03-05T02:58:34Z", "updated_at": "2021-10-24T11:08:08Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n\r\nIf you cannot produce a minimal reproduction case (something that would work in\r\nisolation), please provide the steps or even link to a repository that causes\r\nthe problematic output to occur. \r\n-->\r\n\r\nGiven the following code: (no link, as not reproducible in a single file)\r\n\r\nLibrary:\r\n```rust\r\npub enum Foo {\r\n    Alpha,\r\n    #[non_exhaustive]\r\n    Beta,\r\n}\r\n\r\nimpl Foo {\r\n    pub fn beta() -> Self {\r\n        Self::Beta\r\n    }\r\n}\r\n```\r\n\r\nExternal user (in this case a test):\r\n```rust\r\nuse example::Foo;\r\n\r\n#[test]\r\nfn demo() {\r\n    assert!(matches!(\r\n        Foo::beta(),\r\n        Foo::Beta\r\n    ));\r\n}\r\n```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0603]: unit variant `Beta` is private\r\n --> tests/demo.rs:7:14\r\n  |\r\n7 |         Foo::Beta\r\n  |              ^^^^ private unit variant\r\n  |\r\nnote: the unit variant `Beta` is defined here\r\n --> /home/jhpratt/example/src/lib.rs:4:5\r\n  |\r\n4 |     Beta,\r\n  |     ^^^^\r\n```\r\n\r\n<!-- The following is not always necessary. -->\r\nIdeally the output should look like:\r\n\r\n```\r\nerror[E0638]: `..` required with variant marked as non-exhaustive\r\n --> tests/demo.rs:7:9\r\n  |\r\n7 |         Foo::Beta\r\n  |         ^^^^^^^^^\r\n  |\r\nhelp: add `..` at the end of the field list to ignore all other fields\r\n  |\r\n7 |         Foo::Beta { .. }\r\n```\r\n\r\nRight now, the cause of the error is misleading, as it seems to imply that an enum variant is private (which is impossible). The error message should be updated to match the error provided when there are some fields present, but not the `..` as required. The exact wording might vary a bit, but I copied it verbatim here. Given the explanation of E0603, I believe that this is the wrong error code altogether.\r\n\r\n@rustbot modify labels to +A-diagnostics +T-compiler +D-confusing +D-incorrect", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/82788/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/82788/timeline", "performed_via_github_app": null, "state_reason": null}