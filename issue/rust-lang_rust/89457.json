{"url": "https://api.github.com/repos/rust-lang/rust/issues/89457", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89457/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89457/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89457/events", "html_url": "https://github.com/rust-lang/rust/issues/89457", "id": 1013922094, "node_id": "I_kwDOAAsO6M48bzku", "number": 89457, "title": "Rust crashes due to unknown cache changes", "user": {"login": "kayabaNerve", "id": 25259837, "node_id": "MDQ6VXNlcjI1MjU5ODM3", "avatar_url": "https://avatars.githubusercontent.com/u/25259837?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kayabaNerve", "html_url": "https://github.com/kayabaNerve", "followers_url": "https://api.github.com/users/kayabaNerve/followers", "following_url": "https://api.github.com/users/kayabaNerve/following{/other_user}", "gists_url": "https://api.github.com/users/kayabaNerve/gists{/gist_id}", "starred_url": "https://api.github.com/users/kayabaNerve/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kayabaNerve/subscriptions", "organizations_url": "https://api.github.com/users/kayabaNerve/orgs", "repos_url": "https://api.github.com/users/kayabaNerve/repos", "events_url": "https://api.github.com/users/kayabaNerve/events{/privacy}", "received_events_url": "https://api.github.com/users/kayabaNerve/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2021-10-02T04:53:57Z", "updated_at": "2023-02-26T11:38:22Z", "closed_at": "2023-02-26T11:38:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nVersion:\r\n```\r\nrustc 1.57.0-nightly (5ecc8ad84 2021-09-19)\r\n```\r\n\r\n### Error output\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nuser@computer:~/dleq-rs$ RUST_BACKTRACE=1 cargo test\r\n   Compiling dleq v0.0.0 (/home/user/dleq-rs)\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/compiler/rustc_hir/src/definitions.rs:452:14\r\nstack backtrace:\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/compiler/rustc_hir/src/definitions.rs:452:14\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n   0: rust_begin_unwind\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/std/src/panicking.rs:517:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/core/src/panicking.rs:103:14\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/std/src/panicking.rs:517:5\r\n   2: core::panicking::panic\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/core/src/panicking.rs:103:14\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/core/src/panicking.rs:50:5\r\n   2: core::panicking::panic\r\n             at /rustc/5ecc8ad8462574354a55162a0c16b10eb95e3e70/library/core/src/panicking.rs:50:5\r\n   3: <rustc_query_impl::on_disk_cache::OnDiskCache as rustc_middle::ty::context::OnDiskCache>::def_path_hash_to_def_id\r\n   3: <rustc_query_impl::on_disk_cache::OnDiskCache as rustc_middle::ty::context::OnDiskCache>::def_path_hash_to_def_id\r\n   4: rustc_middle::dep_graph::dep_node::<impl rustc_query_system::dep_graph::dep_node::DepNodeParams<rustc_middle::ty::context::TyCtxt> for rustc_span::def_id::LocalDefId>::recover\r\n   4: rustc_middle::dep_graph::dep_node::<impl rustc_query_system::dep_graph::dep_node::DepNodeParams<rustc_middle::ty::context::TyCtxt> for rustc_span::def_id::LocalDefId>::recover\r\n   5: rustc_query_impl::query_callbacks::hir_owner::force_from_dep_node\r\n   5: rustc_query_impl::query_callbacks::hir_owner::force_from_dep_node\r\n   6: rustc_query_system::dep_graph::graph::DepGraph<K>::try_mark_previous_green\r\n   7: rustc_query_system::dep_graph::graph::DepGraph<K>::try_mark_previous_green\r\n   6: rustc_query_system::dep_graph::graph::DepGraph<K>::try_mark_previous_green\r\n   7: rustc_query_system::dep_graph::graph::DepGraph<K>::try_mark_previous_green\r\n   8: rustc_query_system::query::plumbing::ensure_must_run\r\n   8: rustc_query_system::query::plumbing::ensure_must_run\r\n   9: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::fn_sig\r\n   9: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::fn_sig\r\n  10: <rustc_typeck::collect::CollectItemTypesVisitor as rustc_hir::intravisit::Visitor>::visit_impl_item\r\n  10: <rustc_typeck::collect::CollectItemTypesVisitor as rustc_hir::intravisit::Visitor>::visit_impl_item\r\n  11: rustc_middle::hir::map::Map::visit_item_likes_in_module\r\n  11: rustc_middle::hir::map::Map::visit_item_likes_in_module\r\n  12: rustc_typeck::collect::collect_mod_item_types\r\n  12: rustc_typeck::collect::collect_mod_item_types\r\n  13: rustc_query_system::dep_graph::graph::DepGraph<K>::with_task\r\n  13: rustc_query_system::dep_graph::graph::DepGraph<K>::with_task\r\n  14: rustc_data_structures::stack::ensure_sufficient_stack\r\n  14: rustc_data_structures::stack::ensure_sufficient_stack\r\n  15: rustc_query_system::query::plumbing::try_execute_query\r\n  16: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::collect_mod_item_types\r\n  15: rustc_query_system::query::plumbing::try_execute_query\r\n  16: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::collect_mod_item_types\r\n  17: rustc_middle::hir::map::Map::for_each_module\r\n  17: rustc_middle::hir::map::Map::for_each_module\r\n  18: rustc_session::session::Session::track_errors\r\n  18: rustc_session::session::Session::track_errors\r\n  19: rustc_typeck::check_crate\r\n  20: rustc_interface::passes::analysis\r\n  19: rustc_typeck::check_crate\r\n  20: rustc_interface::passes::analysis\r\n  21: rustc_query_system::dep_graph::graph::DepGraph<K>::with_task\r\n  21: rustc_query_system::dep_graph::graph::DepGraph<K>::with_task\r\n  22: rustc_data_structures::stack::ensure_sufficient_stack\r\n  22: rustc_data_structures::stack::ensure_sufficient_stack\r\n  23: rustc_query_system::query::plumbing::try_execute_query\r\n  24: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::analysis\r\n  25: rustc_interface::passes::QueryContext::enter\r\n  23: rustc_query_system::query::plumbing::try_execute_query\r\n  24: <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::analysis\r\n  25: rustc_interface::passes::QueryContext::enter\r\n  26: rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter\r\n  26: rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter\r\n  27: rustc_span::with_source_map\r\n  27: rustc_span::with_source_map\r\n  28: scoped_tls::ScopedKey<T>::set\r\n  28: scoped_tls::ScopedKey<T>::set\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.57.0-nightly (5ecc8ad84 2021-09-19) running on x86_64-unknown-linux-gnu\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental\r\nnote: rustc 1.57.0-nightly (5ecc8ad84 2021-09-19) running on x86_64-unknown-linux-gnu\r\n\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type lib\r\n\r\n\r\nquery stack during panic:\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [collect_mod_item_types] collecting item types in top-level module\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\n#0 [collect_mod_item_types] collecting item types in top-level module\r\n#1 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `dleq`\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\nuser@computer:~/dleq-rs$\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nEncountered while working on a project of mine. I copied the directory to another location to back it up, and went there to confirm the same command exhibited the same behavior. The changed path triggered a rebuild and this caused rustc to work without issue, leading me to believe there's a malformed cache. I have been updating my Cargo.toml, from additions to removals to even a version upgrade. That said, my only change before my last successful compile and this one was introducing a few errors while I expanded functionality. I was hoping my malformed code would offer a MRE, yet unfortunately (or fortunately) Rust can handle it.\r\n\r\nI am on nightly and went to the latest nightly to check this was still an issue. Doing so rebuilt my cache yet again, hence why my version info is what it is (it's rustup's logs on what it upgraded from). I do have a copy of the cache directory, as it caused errors, I'd be willing to send privately if it'd be beneficial. I never directly edited it. As for the code edits, those would be harder to track down due to the fact I'm in the middle of a commit, and can't confirm what my code was on the last successful compile in order to provide such a diff.", "closed_by": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89457/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89457/timeline", "performed_via_github_app": null, "state_reason": "completed"}