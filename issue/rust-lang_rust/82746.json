{"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840", "repository_url": "https://api.github.com/repos/rust-lang/rust-clippy", "labels_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840/comments", "events_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840/events", "html_url": "https://github.com/rust-lang/rust-clippy/issues/6840", "id": 822168827, "node_id": "MDU6SXNzdWU4MjIxNjg4Mjc=", "number": 6840, "title": "ICE in v1.50.0 that does not occur in v1.49.0", "user": {"login": "tdyas", "id": 901363, "node_id": "MDQ6VXNlcjkwMTM2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/901363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tdyas", "html_url": "https://github.com/tdyas", "followers_url": "https://api.github.com/users/tdyas/followers", "following_url": "https://api.github.com/users/tdyas/following{/other_user}", "gists_url": "https://api.github.com/users/tdyas/gists{/gist_id}", "starred_url": "https://api.github.com/users/tdyas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tdyas/subscriptions", "organizations_url": "https://api.github.com/users/tdyas/orgs", "repos_url": "https://api.github.com/users/tdyas/repos", "events_url": "https://api.github.com/users/tdyas/events{/privacy}", "received_events_url": "https://api.github.com/users/tdyas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 149309557, "node_id": "MDU6TGFiZWwxNDkzMDk1NTc=", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/C-bug", "name": "C-bug", "color": "F5F1FD", "default": false, "description": "Category: Clippy is not doing the correct thing"}, {"id": 884791444, "node_id": "MDU6TGFiZWw4ODQ3OTE0NDQ=", "url": "https://api.github.com/repos/rust-lang/rust-clippy/labels/I-ICE", "name": "I-ICE", "color": "E10C02", "default": false, "description": "Issue: Clippy panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2021-03-04T04:43:01Z", "updated_at": "2021-03-16T17:02:50Z", "closed_at": "2021-03-09T15:12:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Code\r\n\r\nThe following crate in the Pants project triggers an ICE on v1.50.0 but not on v1.49.0 when running `cargo clippy`: https://github.com/pantsbuild/pants/tree/master/src/rust/engine/rule_graph\r\n\r\n### Meta\r\n\r\nThe ICE occurs in v1.50.0 and in a recent nightly. It does not occur v1.49.0.\r\n\r\n`rustc --version --verbose`:\r\n\r\n```\r\nrustc 1.50.0 (cb75ad5db 2021-02-10)\r\nbinary: rustc\r\ncommit-hash: cb75ad5db02783e8b0222fee363c5f63f7e2cf5b\r\ncommit-date: 2021-02-10\r\nhost: x86_64-apple-darwin\r\nrelease: 1.50.0\r\n```\r\n\r\nOccurs for this version of nightly as well: \r\n\r\n```\r\nrustc 1.52.0-nightly (98f8cce6d 2021-02-25)\r\nbinary: rustc\r\ncommit-hash: 98f8cce6db6c6c6660eeffee2b3903104e547ecf\r\ncommit-date: 2021-02-25\r\nhost: x86_64-apple-darwin\r\nrelease: 1.52.0-nightly\r\nLLVM version: 11.0.1\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n    Checking rule_graph v0.0.1 (/Users/tdyas/TC/pants/src/rust/engine/rule_graph)\r\nerror: internal compiler error: compiler/rustc_traits/src/normalize_erasing_regions.rs:43:32: could not fully normalize `std::collections::HashMap<<R as rules::Rule>::DependencyKey, std::vec::Vec<Entry<R>>>`\r\n\r\nthread 'rustc' panicked at 'Box<Any>', compiler/rustc_errors/src/lib.rs:958:9\r\nstack backtrace:\r\n   0:        0x10a7dd0d4 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h34f76b2ca42fab41\r\n   1:        0x10a841ecd - core::fmt::write::h8f13d857463c51c1\r\n   2:        0x10a7ce7c6 - std::io::Write::write_fmt::h0a6214ccb1a8468b\r\n   3:        0x10a7e0d39 - std::panicking::default_hook::{{closure}}::hb14d90e928578cc7\r\n   4:        0x10a7e08c0 - std::panicking::default_hook::h460969f1dc8f738d\r\n   5:        0x10252a586 - clippy_driver::ICE_HOOK::{{closure}}::{{closure}}::he499fdb1f86260cf\r\n   6:        0x10a7e151e - std::panicking::rust_panic_with_hook::h28bf9d6c3916221e\r\n   7:        0x107402321 - std::panicking::begin_panic::{{closure}}::h0e87840b5c6a9c59\r\n   8:        0x107402289 - std::sys_common::backtrace::__rust_end_short_backtrace::h8659a1b4220fd63a\r\n   9:        0x10783f2f1 - std::panicking::begin_panic::hc47dd84e1beec546\r\n  10:        0x107433d13 - rustc_errors::HandlerInner::bug::h6bbed7e088c34809\r\n  11:        0x107432327 - rustc_errors::Handler::bug::h69a183c778d5ab5c\r\n  12:        0x106e58f04 - rustc_middle::util::bug::opt_span_bug_fmt::{{closure}}::h65cee2a5516e95bd\r\n  13:        0x106e54a36 - rustc_middle::ty::context::tls::with_opt::{{closure}}::h3109336967579a63\r\n  14:        0x106e549f3 - rustc_middle::ty::context::tls::with_opt::h747ffbbb3f367dd7\r\n  15:        0x106e58e2b - rustc_middle::util::bug::opt_span_bug_fmt::h33901786874da521\r\n  16:        0x10781edbf - rustc_middle::util::bug::bug_fmt::hb55b8e744ef28c0f\r\n  17:        0x10513d21e - rustc_infer::infer::InferCtxtBuilder::enter::h2cfdf37c61932980\r\n  18:        0x10519eed7 - rustc_traits::normalize_erasing_regions::normalize_generic_arg_after_erasing_regions::h34a19adfa4ea8ccb\r\n  19:        0x10716276d - rustc_middle::dep_graph::<impl rustc_query_system::dep_graph::DepKind for rustc_middle::dep_graph::dep_node::DepKind>::with_deps::h668ad73b318e5986\r\n  20:        0x107057fb1 - rustc_query_system::dep_graph::graph::DepGraph<K>::with_task_impl::h8ae3bb2e2c13f68f\r\n  21:        0x106fad16e - rustc_data_structures::stack::ensure_sufficient_stack::hb580b2c1701cc3fe\r\n  22:        0x1071fe046 - rustc_query_system::query::plumbing::get_query_impl::h2c2ee510ebdf4d2d\r\n  23:        0x106eef03f - rustc_middle::ty::normalize_erasing_regions::<impl rustc_middle::ty::context::TyCtxt>::normalize_erasing_regions::hf7aca71b8acc2e7d\r\n  24:        0x1071c3211 - <rustc_middle::ty::layout::LayoutCx<rustc_middle::ty::context::TyCtxt> as rustc_target::abi::LayoutOf>::layout_of::h659901a2d3cebc10\r\n  25:        0x106e6911b - <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::try_fold::h22e1bedf3e5ce9c0\r\n  26:        0x106d26828 - <alloc::vec::Vec<T> as alloc::vec::SpecFromIter<T,I>>::from_iter::he4a23b1bf00774a8\r\n  27:        0x106e6a385 - <core::iter::adapters::map::Map<I,F> as core::iter::traits::iterator::Iterator>::try_fold::hab160f2b4ae62ed5\r\n  28:        0x106d100ad - <alloc::vec::Vec<T> as alloc::vec::SpecFromIter<T,I>>::from_iter::h0153584db5033da9\r\n  29:        0x1071b80b8 - rustc_middle::ty::layout::LayoutCx<rustc_middle::ty::context::TyCtxt>::layout_raw_uncached::h03749ef38956bfe4\r\n  30:        0x1071b4eea - rustc_middle::ty::layout::layout_raw::h3a998d81f76ca997\r\n  31:        0x1071d6abf - rustc_middle::ty::query::<impl rustc_query_system::query::config::QueryAccessors<rustc_middle::ty::context::TyCtxt> for rustc_middle::ty::query::queries::layout_raw>::compute::h0a7ff71a7a87282f\r\n  32:        0x10715deb8 - rustc_middle::dep_graph::<impl rustc_query_system::dep_graph::DepKind for rustc_middle::dep_graph::dep_node::DepKind>::with_deps::h2341d60a3c8b007c\r\n  33:        0x107041c9d - rustc_query_system::dep_graph::graph::DepGraph<K>::with_task_impl::h2aa608c9e9b260d6\r\n  34:        0x106fb2afb - rustc_data_structures::stack::ensure_sufficient_stack::he90b48f172d17b6b\r\n  35:        0x1072398e0 - rustc_query_system::query::plumbing::get_query_impl::h71e6b1cd20fc6dbe\r\n  36:        0x1071c32a7 - <rustc_middle::ty::layout::LayoutCx<rustc_middle::ty::context::TyCtxt> as rustc_target::abi::LayoutOf>::layout_of::h659901a2d3cebc10\r\n  37:        0x1069126a5 - <rustc_lint::context::LateContext as rustc_target::abi::LayoutOf>::layout_of::h7b61f1a020637c14\r\n  38:        0x10274a11a - <clippy_lints::zero_sized_map_values::ZeroSizedMapValues as rustc_lint::passes::LateLintPass>::check_ty::hdc4a67722d494acb\r\n  39:        0x10692c963 - <rustc_lint::late::LateLintPassObjects as rustc_lint::passes::LateLintPass>::check\r\n_ty::h21ed627ebdadbe89\r\n  40:        0x102f1cbdf - rustc_hir::intravisit::walk_item::h2ae69716c8c2069e\r\n  41:        0x102f6810e - rustc_hir::intravisit::Visitor::visit_nested_item::h84d22f6cf02015e5\r\n  42:        0x102f1775d - rustc_hir::intravisit::walk_crate::h17661615033e32b9\r\n  43:        0x102f54001 - rustc_lint::late::late_lint_pass_crate::h2dafafeb69042f14\r\n  44:        0x102f5755d - rustc_session::utils::<impl rustc_session::session::Session>::time::h305d03b2a994fc40\r\n  45:        0x102fae795 - <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once::h792b8ac53a32a736\r\n  46:        0x102f59ecb - rustc_session::utils::<impl rustc_session::session::Session>::time::hf3082bae09b596ae\r\n  47:        0x102f8e9fb - rustc_interface::passes::analysis::h4f77077d0d32c92e\r\n  48:        0x102df830a - rustc_middle::ty::query::<impl rustc_query_system::query::config::QueryAccessors<rustc_middle::ty::context::TyCtxt> for rustc_middle::ty::query::queries::analysis>::compute::h751d24ab2e450beb\r\n  49:        0x102dfa1c4 - rustc_middle::dep_graph::<impl rustc_query_system::dep_graph::DepKind for rustc_middle::dep_graph::dep_node::DepKind>::with_deps::he6976e5544ffecfa\r\n  50:        0x102d7c0ee - rustc_query_system::dep_graph::graph::DepGraph<K>::with_task_impl::h88d3b296bfb5ed36\r\n  51:        0x102dc096e - rustc_data_structures::stack::ensure_sufficient_stack::hd0a9f62ff4f35515\r\n  52:        0x102d6a570 - rustc_query_system::query::plumbing::get_query_impl::h1fa86c7589ee7005\r\n  53:        0x102dfa5aa - rustc_interface::passes::QueryContext::enter::hdda9d64e1568ae83\r\n  54:        0x102dd65a1 - rustc_interface::queries::<impl rustc_interface::interface::Compiler>::enter::h23c3663acd2f252b\r\n  55:        0x102db58be - rustc_span::with_source_map::had6878a53046d568\r\n  56:        0x102dd7584 - rustc_interface::interface::create_compiler_and_run::he48253d83781cb39\r\n  57:        0x102dc1a84 - std::sys_common::backtrace::__rust_begin_short_backtrace::hfb8be6fd991a375d\r\n  58:        0x102d57c19 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h898af6dc0dda933c\r\n  59:        0x10a7ee5cd - std::sys::unix::thread::Thread::new::thread_start::he19012de44640be6\r\n  60:     0x7fff20533950 - __pthread_start\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust-clippy/issues/new\r\n\r\nnote: Clippy version: clippy 0.0.212 (cb75ad5d 2021-02-10)\r\n\r\nquery stack during panic:\r\n#0 [normalize_generic_arg_after_erasing_regions] normalizing `std::collections::HashMap<<R as rules::Rule>::DependencyKey, std::vec::Vec<Entry<R>>>`\r\nrust-lang/rust#1 [layout_raw] computing layout of `RuleEdges<R>`\r\nrust-lang/rust#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to previous error\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust-clippy/issues/6840/timeline", "performed_via_github_app": null, "state_reason": "completed"}