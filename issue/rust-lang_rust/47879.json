{"url": "https://api.github.com/repos/rust-lang/rust/issues/47879", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47879/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47879/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47879/events", "html_url": "https://github.com/rust-lang/rust/issues/47879", "id": 292804131, "node_id": "MDU6SXNzdWUyOTI4MDQxMzE=", "number": 47879, "title": "NLL performance tracking issue", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 867466241, "node_id": "MDU6TGFiZWw4Njc0NjYyNDE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-performant", "name": "NLL-performant", "color": "f799ea", "default": false, "description": "Working towards the \"performance is good\" goal"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/47", "html_url": "https://github.com/rust-lang/rust/milestone/47", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/47/labels", "id": 3049418, "node_id": "MDk6TWlsZXN0b25lMzA0OTQxOA==", "number": 47, "title": "NLL: Performance is good", "description": "We want the performance of NLL borrowck to be fast, of course.", "creator": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 7, "state": "closed", "created_at": "2018-01-19T20:00:41Z", "updated_at": "2018-07-04T09:34:15Z", "due_on": null, "closed_at": "2018-03-14T20:41:36Z"}, "comments": 7, "created_at": "2018-01-30T14:33:49Z", "updated_at": "2018-06-06T19:10:02Z", "closed_at": "2018-06-06T19:10:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is a tracking issue dedicated to discussing ideas and techniques for improving compile-time with the NLL feature. It's meant to house as a repository of measurements, benchmarks, etc for the time being to help coordinate efforts.\r\n\r\n## Benchmarks and timing runs\r\n\r\nWe can view performance results on perf.rust-lang.org now. Just look for the \"NLL\" runs. They can be compared against \"clean\" runs -- the delta is the 'extra work' we are doing when NLL is enabled (note that NLL still runs the old region analysis and borrow check, so it does strictly more work).\r\n\r\n## Ideas for improvement or measurement\r\n\r\n- [x] Introduce a dirty list (https://github.com/rust-lang/rust/pull/47766)\r\n- [ ] More detailed profiling and analysis of the results above\r\n- [ ] Measure: what percentage of the time do calls to `dfs` calls wind up actually adding new info?\r\n- [ ] Idea: modify `dfs` code [not to invoke `successors()`](https://github.com/rust-lang/rust/blob/fe7e1a45f37f4265434cead827f587e75412f85c/src/librustc_mir/borrow_check/nll/region_infer/dfs.rs#L73-L80), which can allocate, but instead add some kind of non-allocating form (perhaps with a callback?)\r\n- [x] Experiment with sparse representation of values (https://github.com/rust-lang/rust/issues/48170)\r\n- [ ] ... others? Discuss below, that's what this issue is for =)\r\n\r\n## Quick pointers into the source\r\n\r\nThe main source of time for NLL is **probably** going to be the code that propagates constraints:\r\n\r\nhttps://github.com/rust-lang/rust/blob/fe7e1a45f37f4265434cead827f587e75412f85c/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L453-L457\r\n\r\nAnd in particular the calls to `dfs`:\r\n\r\nhttps://github.com/rust-lang/rust/blob/fe7e1a45f37f4265434cead827f587e75412f85c/src/librustc_mir/borrow_check/nll/region_infer/mod.rs#L486-L495\r\n\r\nThe `dfs` code must walk the graph to find which points should be added and where:\r\n\r\nhttps://github.com/rust-lang/rust/blob/fe7e1a45f37f4265434cead827f587e75412f85c/src/librustc_mir/borrow_check/nll/region_infer/dfs.rs#L37-L40\r\n\r\n\r\ncc @rust-lang/wg-compiler-nll ", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47879/timeline", "performed_via_github_app": null, "state_reason": "completed"}