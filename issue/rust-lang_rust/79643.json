{"url": "https://api.github.com/repos/rust-lang/rust/issues/79643", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79643/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79643/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79643/events", "html_url": "https://github.com/rust-lang/rust/issues/79643", "id": 755541273, "node_id": "MDU6SXNzdWU3NTU1NDEyNzM=", "number": 79643, "title": "\"expected X found X\" diagnostic for lifetime mismatch in method signature of trait impl", "user": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 1775993, "node_id": "MDU6TGFiZWwxNzc1OTkz", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-lifetimes", "name": "A-lifetimes", "color": "f7e101", "default": false, "description": "Area: lifetime related"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-12-02T19:13:32Z", "updated_at": "2023-01-08T01:25:56Z", "closed_at": "2023-01-08T01:25:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nWith this code:\r\n\r\n```rust\r\nstruct Foo(u32);\r\n\r\nimpl From<&Foo> for &u32 {\r\n    fn from(foo: &Foo) -> &u32 {\r\n        &foo.0\r\n    }\r\n}\r\n```\r\n\r\nThe error message is:\r\n\r\n```rust\r\nerror: `impl` item signature doesn't match `trait` item signature\r\n   --> src/lib.rs:4:5\r\n    |\r\n4   |     fn from(foo: &Foo) -> &u32 {\r\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&Foo) -> &u32`\r\n    |\r\n    = note: expected `fn(&Foo) -> &u32`\r\n               found `fn(&Foo) -> &u32`\r\n    = help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\r\n    = help: verify the lifetime relationships in the `trait` and `impl` between the `self` argument, the other inputs and its output\r\n```\r\n\r\nNow, the two `help` lines do give relevant information on how to fix this, which is to have a single named lifetime and use it everywhere:\r\n\r\n```rust\r\nstruct Foo(u32);\r\n\r\nimpl<'a> From<&'a Foo> for &'a u32 {\r\n    fn from(foo: &'a Foo) -> &'a u32 {\r\n        &foo.0\r\n    }\r\n}\r\n```\r\n\r\nHowever the part of the error that is more visible at first glance (at least to me) is:\r\n\r\n```rust\r\n    = note: expected `fn(&Foo) -> &u32`\r\n               found `fn(&Foo) -> &u32`\r\n```\r\n\r\nMy internal reaction was: if what was expected and found is the same thing, what\u2019s the problem?\r\n\r\nThe two signature are in fact not the same because they each have their own implicit lifetime parameter which don\u2019t necessarily match each other. Would it make sense to make those parameters explicit? Signatures in diagnostics don\u2019t need to be entirely valid Rust syntax. Something like:\r\n\r\n```rust\r\n    = note: expected `fn(&'_1 Foo) -> &'_1 u32`\r\n               found `fn(&'_2 Foo) -> &'_2 u32`\r\n```\r\n\r\n### Meta\r\n\r\nThe output is the same in 1.48.0 and nightly-2020-11-30.", "closed_by": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79643/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79643/timeline", "performed_via_github_app": null, "state_reason": "completed"}