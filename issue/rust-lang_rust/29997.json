{"url": "https://api.github.com/repos/rust-lang/rust/issues/29997", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/29997/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/29997/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/29997/events", "html_url": "https://github.com/rust-lang/rust/issues/29997", "id": 118332506, "node_id": "MDU6SXNzdWUxMTgzMzI1MDY=", "number": 29997, "title": "ICE `OutputTypeParameterMismatch`", "user": {"login": "frankmcsherry", "id": 5741500, "node_id": "MDQ6VXNlcjU3NDE1MDA=", "avatar_url": "https://avatars.githubusercontent.com/u/5741500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frankmcsherry", "html_url": "https://github.com/frankmcsherry", "followers_url": "https://api.github.com/users/frankmcsherry/followers", "following_url": "https://api.github.com/users/frankmcsherry/following{/other_user}", "gists_url": "https://api.github.com/users/frankmcsherry/gists{/gist_id}", "starred_url": "https://api.github.com/users/frankmcsherry/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frankmcsherry/subscriptions", "organizations_url": "https://api.github.com/users/frankmcsherry/orgs", "repos_url": "https://api.github.com/users/frankmcsherry/repos", "events_url": "https://api.github.com/users/frankmcsherry/events{/privacy}", "received_events_url": "https://api.github.com/users/frankmcsherry/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2015-11-23T07:35:13Z", "updated_at": "2019-07-10T10:24:40Z", "closed_at": "2019-07-10T10:24:39Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The error is very long, and the example is not reduced (I tried, but the simple reduction worked ok, so no dice there). To reproduce, one can pull \n\nhttps://github.com/frankmcsherry/differential-dataflow/commit/2fa719e78b6634159ed79bb5e0453e1230c5fae2\n\nand then `cargo build --example cc`. I'm on \n\n```\nEchidnatron% rustc --version\nrustc 1.6.0-nightly (9303055f3 2015-11-19)\n```\n\nThe same project ICEs on stable as well, but for a different reason (issue #29991; EDIT: Sorry, not actually this issue; rather, a different ICE that seems fixed in nightly).\n\nI think the salient points are in the complaint\n\n```\nSorts(ExpectedFound { \n    expected: differential_dataflow::collection::trace::DifferenceIterator<u32>, \n    found: <&differential_dataflow::collection::trace::Trace<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32, (collections::vec::Vec<core::option::Option<differential_dataflow::collection::trace::Offset>>, u64)> as differential_dataflow::collection::trace::TraceRef<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32>>::VIterator \n})\n```\n\nwhere it seems to be unhappy that it found a weird associated type rather than a `DifferenceIterator<u32>`. Of course, the associated type _is_ that `DifferenceIterator<u32>`, which Rust knew at one point but seems to have lost track of, maybe? There is admittedly a bunch of horribleness going on with associated types, specifically faking out HKT for lifetimes through associated types of traits containing a lifetime implemented for references with that lifetime to the type in question. I can explain what it is doing if that helps, but given that it just ICEs differently in each release mode, maybe it's just time to delete it and try another way.\n\nFull backtrace:\n\n```\nEchidnatron% cargo build --example cc\n   Compiling differential-dataflow v0.0.1 (file:///Users/mcsherry/Projects/differential-dataflow)\nsrc/operators/group.rs:276:29: 276:60 error: internal compiler error: Encountered error `OutputTypeParameterMismatch(Binder(<[closure@examples/cc.rs:71:27: 71:79] as core::ops::Fn<(&u32, core::iter::Peekable<differential_dataflow::iterators::coalesce::CoalesceIterator<differential_dataflow::iterators::merge::MergeIterator<<&differential_dataflow::collection::trace::Trace<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32, (collections::vec::Vec<core::option::Option<differential_dataflow::collection::trace::Offset>>, u64)> as differential_dataflow::collection::trace::TraceRef<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32>>::VIterator>>>, &mut collections::vec::Vec<(u32, i32)>)>>), Binder(<[closure@examples/cc.rs:71:27: 71:79] as core::ops::Fn<(&'static u32, core::iter::Peekable<differential_dataflow::iterators::coalesce::CoalesceIterator<differential_dataflow::iterators::merge::MergeIterator<differential_dataflow::collection::trace::DifferenceIterator<u32>>>>, &'static mut collections::vec::Vec<(u32, i32)>)>>), Sorts(ExpectedFound { expected: differential_dataflow::collection::trace::DifferenceIterator<u32>, found: <&differential_dataflow::collection::trace::Trace<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32, (collections::vec::Vec<core::option::Option<differential_dataflow::collection::trace::Offset>>, u64)> as differential_dataflow::collection::trace::TraceRef<u32, timely::progress::nested::product::Product<timely::progress::nested::product::Product<timely::progress::timestamp::RootTimestamp, u64>, u64>, u32>>::VIterator }))` selecting `Binder(<[closure@examples/cc.rs:71:27: 71:79] as core::ops::Fn<(&'static u32, core::iter::Peekable<differential_dataflow::iterators::coalesce::CoalesceIterator<differential_dataflow::iterators::merge::MergeIterator<differential_dataflow::collection::trace::DifferenceIterator<u32>>>>, &'static mut collections::vec::Vec<(u32, i32)>)>>)` during trans\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Box<Any>', ../src/libsyntax/diagnostic.rs:175\nstack backtrace:\n   1:        0x10c6ff2d8 - sys::backtrace::tracing::imp::write::hed3a593bad2e5fa3Hqt\n   2:        0x10c7053bf - panicking::log_panic::_<closure>::closure.39899\n   3:        0x10c704e85 - panicking::log_panic::hb58e0c0eab041fc722w\n   4:        0x10c6cdcb6 - sys_common::unwind::begin_unwind_inner::h04a0f5a988ff29c8fus\n   5:        0x109ff092a - sys_common::unwind::begin_unwind::begin_unwind::h5224819670744734501\n   6:        0x109ff08f2 - diagnostic::_<impl>::span_bug::hd2f1816c64c905211GB\n   7:        0x109404a04 - session::_<impl>::span_bug::h20c03d11f84bf00aa5w\n   8:        0x108d4ba6b - trans::common::fulfill_obligation::h47639f98fb7a544b3As\n   9:        0x108d3c632 - trans::meth::trans_method_callee::hb7535cb5bac1bdebqGL\n  10:        0x108dbcf43 - trans::callee::trans_call_inner::h15376225423506524332\n  11:        0x108da643b - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  12:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  13:        0x108d7b231 - trans::controlflow::trans_stmt_semi::h99e627f0ee69235bpmw\n  14:        0x108cf85ad - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  15:        0x108da6cf4 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  16:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  17:        0x108d7b231 - trans::controlflow::trans_stmt_semi::h99e627f0ee69235bpmw\n  18:        0x108cf85ad - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  19:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  20:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  21:        0x108de2d50 - trans::_match::trans_match_inner::h1cc439eb09421ca59cL\n  22:        0x108da5751 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  23:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  24:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  25:        0x108da9603 - trans::expr::trans_rvalue_stmt_unadjusted::hb6e5ec9373e54768mDC\n  26:        0x108cfc4d4 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  27:        0x108de2d50 - trans::_match::trans_match_inner::h1cc439eb09421ca59cL\n  28:        0x108da5751 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  29:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  30:        0x108de5dca - trans::_match::mk_binding_alloca::h6244938181906574675\n  31:        0x108cde11c - trans::base::init_local::h3234403b2a5b16368Th\n  32:        0x108cf85d2 - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  33:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  34:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  35:        0x108d7b231 - trans::controlflow::trans_stmt_semi::h99e627f0ee69235bpmw\n  36:        0x108cf85ad - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  37:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  38:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  39:        0x108de2d50 - trans::_match::trans_match_inner::h1cc439eb09421ca59cL\n  40:        0x108da5751 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  41:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  42:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  43:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  44:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  45:        0x108de2d50 - trans::_match::trans_match_inner::h1cc439eb09421ca59cL\n  46:        0x108da5751 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  47:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  48:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  49:        0x108da9603 - trans::expr::trans_rvalue_stmt_unadjusted::hb6e5ec9373e54768mDC\n  50:        0x108cfc4d4 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  51:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  52:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  53:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  54:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  55:        0x108cf4b49 - trans::base::trans_closure::he7bc15b87b73571czHi\n  56:        0x108d44f34 - trans::closure::trans_closure_expr::hd80f3be42fb666449nr\n  57:        0x108da78ef - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  58:        0x108da3ecd - trans::expr::trans_unadjusted::hd9a0a0a32fb6750c6dC\n  59:        0x108cc7759 - trans::expr::trans::h08ef89894788bc6axJB\n  60:        0x108d36027 - trans::callee::trans_args::h2fba99c86f0aa735Bdp\n  61:        0x108d3ba4c - trans::callee::trans_call_inner::h1502485283949612030\n  62:        0x108da4f16 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  63:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  64:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  65:        0x108cf4b49 - trans::base::trans_closure::he7bc15b87b73571czHi\n  66:        0x108cf8f35 - trans::base::trans_fn::h2b637b637f2d5b99lRi\n  67:        0x108d28065 - trans::callee::trans_fn_ref_with_substs::h33984ac7df52baf3kCo\n  68:        0x108d3cca2 - trans::meth::trans_method_callee::hb7535cb5bac1bdebqGL\n  69:        0x108d3a8eb - trans::callee::trans_call_inner::h1502485283949612030\n  70:        0x108da4f16 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  71:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  72:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  73:        0x108cf4b49 - trans::base::trans_closure::he7bc15b87b73571czHi\n  74:        0x108cf8f35 - trans::base::trans_fn::h2b637b637f2d5b99lRi\n  75:        0x108d28065 - trans::callee::trans_fn_ref_with_substs::h33984ac7df52baf3kCo\n  76:        0x108d3cca2 - trans::meth::trans_method_callee::hb7535cb5bac1bdebqGL\n  77:        0x108d3a8eb - trans::callee::trans_call_inner::h1502485283949612030\n  78:        0x108da4f16 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  79:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  80:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  81:        0x108da57c9 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  82:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  83:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  84:        0x108cf4b49 - trans::base::trans_closure::he7bc15b87b73571czHi\n  85:        0x108d44f34 - trans::closure::trans_closure_expr::hd80f3be42fb666449nr\n  86:        0x108da78ef - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  87:        0x108da3ecd - trans::expr::trans_unadjusted::hd9a0a0a32fb6750c6dC\n  88:        0x108cc7759 - trans::expr::trans::h08ef89894788bc6axJB\n  89:        0x108d36027 - trans::callee::trans_args::h2fba99c86f0aa735Bdp\n  90:        0x108d3ba4c - trans::callee::trans_call_inner::h1502485283949612030\n  91:        0x108da4f16 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n  92:        0x108cfc363 - trans::expr::trans_into::hd912cb89d59a5a9a9CB\n  93:        0x108cf88fb - trans::controlflow::trans_block::h5ae6763586afd39alnw\n  94:        0x108cf4b49 - trans::base::trans_closure::he7bc15b87b73571czHi\n  95:        0x108cf8f35 - trans::base::trans_fn::h2b637b637f2d5b99lRi\n  96:        0x108d27e4d - trans::callee::trans_fn_ref_with_substs::h33984ac7df52baf3kCo\n  97:        0x108d25e5f - trans::callee::trans_fn_ref::h74554fe71b470393yro\n  98:        0x108d209fa - trans::callee::trans::h9f2d9e9e69d424344fo\n  99:        0x108d38e60 - trans::callee::trans_call_inner::h2899170165357686685\n  100:        0x108da6381 - trans::expr::trans_rvalue_dps_unadjusted::hc66680a0fe7728dfdLC\n ... <frames omitted>\n\nCould not compile `differential-dataflow`.\n```\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/29997/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/29997/timeline", "performed_via_github_app": null, "state_reason": "completed"}