{"url": "https://api.github.com/repos/rust-lang/rust/issues/62874", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/62874/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/62874/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/62874/events", "html_url": "https://github.com/rust-lang/rust/issues/62874", "id": 471100330, "node_id": "MDU6SXNzdWU0NzExMDAzMzA=", "number": 62874, "title": "Building shared libraries on Mac requires '-undefined dynamic_lookup'", "user": {"login": "jeff-davis", "id": 214386, "node_id": "MDQ6VXNlcjIxNDM4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/214386?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeff-davis", "html_url": "https://github.com/jeff-davis", "followers_url": "https://api.github.com/users/jeff-davis/followers", "following_url": "https://api.github.com/users/jeff-davis/following{/other_user}", "gists_url": "https://api.github.com/users/jeff-davis/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeff-davis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeff-davis/subscriptions", "organizations_url": "https://api.github.com/users/jeff-davis/orgs", "repos_url": "https://api.github.com/users/jeff-davis/repos", "events_url": "https://api.github.com/users/jeff-davis/events{/privacy}", "received_events_url": "https://api.github.com/users/jeff-davis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-07-19T22:14:28Z", "updated_at": "2021-11-09T21:37:43Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thanks for filing a \ud83d\udc1b bug report \ud83d\ude04! -->\r\n\r\n**Problem**\r\n<!-- A clear and concise description of what the bug is. -->\r\n\r\nA shared library used as a plugin will often reference symbols in the host program. These symbols will remain unresolved at build time, but will be resolved at the time the shared library is loaded into the host program.\r\n\r\nCargo on Mac fails to build any shared library that can't resolve the symbols at build time.\r\n\r\n<!-- including what currently happens and what you expected to happen. -->\r\n\r\nI expect cargo to build a crate containing unresolved symbols successfully; which works fine on ubuntu.\r\n\r\n**Steps**\r\n\r\nA crate with the following ``Cargo.toml``:\r\n\r\n```\r\n[package]\r\nname = \"fail\"\r\nversion = \"0.1.0\"\r\nauthors = [\"jefdavi\"]\r\nedition = \"2018\"\r\n\r\n[lib]\r\ncrate-type = [\"cdylib\"]\r\n```\r\n\r\nand ``src/lib.rs``:\r\n\r\n```\r\nextern \"C\" {\r\n  static unresolved: i32;\r\n}\r\n\r\n#[no_mangle]\r\nextern fn myfunc() {\r\n  unsafe {\r\n    println!(\"{}\", unresolved);\r\n  }\r\n}\r\n```\r\n\r\n\r\n**Possible Solution(s)**\r\n<!-- Not obligatory, but suggest a fix/reason for the bug, -->\r\n<!-- or ideas how to implement the addition or change -->\r\n\r\nA workaround is to specify:\r\n\r\n``\r\n[build]                                                                        \r\nrustflags = [\"-Clink-args=-undefined dynamic_lookup\"]\r\n``\r\nin ``.cargo/config``, but that's not acceptable for a crate author (https://github.com/jeff-davis/postgres-extension.rs), who doesn't have control over the crate users' config files.\r\n\r\n**Notes**\r\n\r\nOutput of `cargo version`:\r\n\r\n``cargo 1.36.0 (c4fcfb725 2019-05-15)``\r\n\r\n``18.6.0 Darwin Kernel Version 18.6.0``\r\n\r\n<!-- Also, any additional context or information you feel may be relevant to the issue. -->\r\n<!-- (e.g rust version, OS platform/distribution/version, target toolchain(s), release channel.. -->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/62874/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/62874/timeline", "performed_via_github_app": null, "state_reason": null}