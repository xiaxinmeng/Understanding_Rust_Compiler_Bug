{"url": "https://api.github.com/repos/rust-lang/rust/issues/34458", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34458/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34458/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34458/events", "html_url": "https://github.com/rust-lang/rust/issues/34458", "id": 162219537, "node_id": "MDU6SXNzdWUxNjIyMTk1Mzc=", "number": 34458, "title": "Inline assembly clobber formatting mismatch", "user": {"login": "CensoredUsername", "id": 3411575, "node_id": "MDQ6VXNlcjM0MTE1NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/3411575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CensoredUsername", "html_url": "https://github.com/CensoredUsername", "followers_url": "https://api.github.com/users/CensoredUsername/followers", "following_url": "https://api.github.com/users/CensoredUsername/following{/other_user}", "gists_url": "https://api.github.com/users/CensoredUsername/gists{/gist_id}", "starred_url": "https://api.github.com/users/CensoredUsername/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CensoredUsername/subscriptions", "organizations_url": "https://api.github.com/users/CensoredUsername/orgs", "repos_url": "https://api.github.com/users/CensoredUsername/repos", "events_url": "https://api.github.com/users/CensoredUsername/events{/privacy}", "received_events_url": "https://api.github.com/users/CensoredUsername/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 91598611, "node_id": "MDU6TGFiZWw5MTU5ODYxMQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-inline-assembly", "name": "A-inline-assembly", "color": "f7e101", "default": false, "description": "Area: inline asm!(..)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-06-24T19:56:05Z", "updated_at": "2016-07-08T07:41:44Z", "closed_at": "2016-07-08T07:41:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The rust book states that asm! clobbers should be written as \"{rdx}\" but when you use them as such the clobbers will be silently ignored making for some nasty bugs.\n\n[Relevant part of the book](https://doc.rust-lang.org/book/inline-assembly.html#clobbers)\n\n[testcase](http://pastebin.com/QkQtVkEz)\n\n`rustc --version:`\n\n```\nrustc 1.11.0-nightly (6dcc2c1de 2016-06-22)\n```\n\n`rustc` output\n\n```\n$ rustc -g main.rs -C opt-level=2\n$\n```\n\nRelevant part of objdump: \n\n```\n   140001070:   48 c7 c2 01 00 00 00    mov    $0x1,%rdx\n   140001077:   48 89 f0                mov    %rsi,%rax\n   14000107a:   ff d0                   callq  *%rax\n   14000107c:   48 89 c1                mov    %rax,%rcx\n   14000107f:   48 89 d0                mov    %rdx,%rax\n```\n\nRelevant LLVM IR:\n\n```\n  %13 = tail call i64 asm sideeffect inteldialect \"mov rdx, 1\", \"={rdx},~{dirflag},~{fpsr},~{flags}\"() #8, !dbg !718, !srcloc !720\n  %14 = tail call i64 asm sideeffect inteldialect \"call rax\", \"={rax},{rax},{rcx},~{{rdx}},~{{memory}},~{{cc}},~{dirflag},~{fpsr},~{flags}\"(i8* %2, i8 %12) #8, !dbg !739, !srcloc \n  %15 = tail call i64 asm sideeffect inteldialect \"mov rax, rdx\", \"={rax},{rdx},~{dirflag},~{fpsr},~{flags}\"(i64 %13) #8, !dbg !742, !srcloc !744\n```\n\nAs we can seen in the emitted LLVM IR, the given clobbers are surrounded by {{}}. I'm not sure what effect this has, but it seems like LLVM just silently ignores them. A fix would either be to not send the extra {}'s to LLVM or to edit the documentation to reflect that clobbers should be given without surrounding {}'s. Either way, this should probably not generate invalid code silently.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34458/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34458/timeline", "performed_via_github_app": null, "state_reason": "completed"}