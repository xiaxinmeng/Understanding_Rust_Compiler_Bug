{"url": "https://api.github.com/repos/rust-lang/rust/issues/4040", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/4040/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/4040/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/4040/events", "html_url": "https://github.com/rust-lang/rust/issues/4040", "id": 8661925, "node_id": "MDU6SXNzdWU4NjYxOTI1", "number": 4040, "title": "macro referencing unbound syntax variable causes ICE", "user": {"login": "rntz", "id": 16143, "node_id": "MDQ6VXNlcjE2MTQz", "avatar_url": "https://avatars.githubusercontent.com/u/16143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rntz", "html_url": "https://github.com/rntz", "followers_url": "https://api.github.com/users/rntz/followers", "following_url": "https://api.github.com/users/rntz/following{/other_user}", "gists_url": "https://api.github.com/users/rntz/gists{/gist_id}", "starred_url": "https://api.github.com/users/rntz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rntz/subscriptions", "organizations_url": "https://api.github.com/users/rntz/orgs", "repos_url": "https://api.github.com/users/rntz/repos", "events_url": "https://api.github.com/users/rntz/events{/privacy}", "received_events_url": "https://api.github.com/users/rntz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2012-11-26T02:51:13Z", "updated_at": "2013-05-23T02:02:35Z", "closed_at": "2013-05-23T02:02:35Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\nmacro_rules! foo( () => ($s) )\n\nfn main() { foo!(); }\n```\n\nThe above program is of course invalid, but instead of giving an error message it produces an ICE:\n\n```\nRUST_LOG=rustc=1,::rt::backtrace make bugs/macro_ice\nrustc -g -L . bugs/macro_ice.rs\nrust: task failed at 'Key not found in table: { repr: 36 }', /home/rntz/s/rust/src/libsyntax/syntax.rc:1\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f784e543deb]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e559)[0x7f784e557559]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7f784e5465a0]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1ac6df)[0x7f784f4126df]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1ef365)[0x7f784f455365]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN3ext2tt10transcribe13tt_next_token16_ab8a1099a48b1893_05E+0xc7f)[0x7f784f34db6f]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN5parse6parser6Parser16_e77dbaaf1ebfd603_05E+0x6c)[0x7f784f3529fc]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1f80ab)[0x7f784f45e0ab]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1f8df1)[0x7f784f45edf1]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN3ext6expand11expand_expr17_ede5d8d64ebfc12b3_05E+0xbb1)[0x7f784f414e01]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1b3695)[0x7f784f419695]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_144359fold_expr17_cbc07ddfc4e937bf3_05E+0xd1)[0x7f784f33f261]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0xc2de8)[0x7f784f328de8]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0xd3aaf)[0x7f784f339aaf]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_144239fold_stmt17_3dea617f49874e6b3_05E+0xab)[0x7f784f33ec1b]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0xb8aaf)[0x7f784f31eaaf]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold15noop_fold_block16_e6850c3fde8da7b3_05E+0xe0)[0x7f784f328a30]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0xd36df)[0x7f784f3396df]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_1442010fold_block17_c5bffc3c53d7f2f43_05E+0xae)[0x7f784f33ea8e]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold25noop_fold_item_underscore17_1dbd3245579f405a3_05E+0x17d)[0x7f784f32387d]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_1441420fold_item_underscore17_efac33445786909b3_05E+0x9a)[0x7f784f33e8ba]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14noop_fold_item15_123c3f99bc33673_05E+0x16b)[0x7f784f322c2b]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN3ext6expand11expand_item16_618e6d7fe75df9a3_05E+0xde)[0x7f784f4179be]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1b398f)[0x7f784f41998f]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_144089fold_item17_37728de3d8ef43bc3_05E+0x94)[0x7f784f33e664]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x5803f)[0x7f784f2be03f]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold13noop_fold_mod17_4fdd1bdeda5154ab3_05E+0xd7)[0x7f784f331e17]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN3ext6expand16expand_mod_items16_cf47d56026d55923_05E+0x57)[0x7f784f416d67]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x1b3930)[0x7f784f419930]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_144418fold_mod17_c5c72698951df1563_05E+0x9a)[0x7f784f33f66a]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold15noop_fold_crate17_d2d7c269352de7123_05E+0x14d)[0x7f784f32084d]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0x256c48)[0x7f784f4bcc48]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(+0xd2f3f)[0x7f784f338f3f]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN4fold14__extensions__10meth_1424010fold_crate17_a54e731d82d8d3f73_05E+0xa2)[0x7f784f33b5c2]\n/home/rntz/p/bin/../lib/libsyntax-84efebcb12c867a2-0.5.so(_ZN3ext6expand12expand_crate16_eade0bc79a3dca03_05E+0x7fa)[0x7f784f41913a]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6b41d6)[0x7f784ee3a1d6]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6driver6driver12compile_upto17_13cb5b26b5401eda3_05E+0x50b)[0x7f784ee371cb]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6eba9c)[0x7f784ee71a9c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN6driver6driver13compile_input17_7a36ff8da44c8e283_05E+0xbb)[0x7f784ee3b55b]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN12run_compiler16_b79619bee9344a03_05E+0x268a)[0x7f784ee6b6ea]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6eba9c)[0x7f784ee71a9c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6ea7c3)[0x7f784ee707c3]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6e981c)[0x7f784ee6f81c]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x7a31f)[0x7f784fc0831f]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb7240)[0x7f784fc45240]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f784e544654]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /home/rntz/s/rust/src/librustc/rustc.rs:233\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f784e543deb]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e559)[0x7f784e557559]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7f784e5465a0]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb7240)[0x7f784fc45240]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN7monitor16_827d3dbfcc5295a3_05E+0x2a9c)[0x7f784ee6e85c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(+0x6eba9c)[0x7f784ee71a9c]\n/home/rntz/p/bin/../lib/librustc-c84825241471686d-0.5.so(_ZN4main16_2fb85b4a659c4103_05E+0x86)[0x7f784ee716a6]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f784e544654]\nrust: domain main @0x11ad200 root task failed\nrust: task failed at 'killed', /home/rntz/s/rust/src/libcore/task.rs:615\n/home/rntz/p/bin/../lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f784e543deb]\n/home/rntz/p/bin/../lib/librustrt.so(+0x2e559)[0x7f784e557559]\n/home/rntz/p/bin/../lib/librustrt.so(upcall_fail+0x1b0)[0x7f784e5465a0]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(_ZN4task5yield17_56812fae66173efd3_05E+0xbd)[0x7f784fbf120d]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x91f36)[0x7f784fc1ff36]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(_ZN7private11weaken_task17_8d55bbcf2be9175d3_05E+0xd9)[0x7f784fc1fd79]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x91c6b)[0x7f784fc1fc6b]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb7240)[0x7f784fc45240]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x90f72)[0x7f784fc1ef72]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x908c2)[0x7f784fc1e8c2]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x8fed6)[0x7f784fc1ded6]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0x7a31f)[0x7f784fc0831f]\n/home/rntz/p/bin/../lib/libcore-c3ca5d77d81b46c1-0.5.so(+0xb7240)[0x7f784fc45240]\n/home/rntz/p/bin/../lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f784e544654]\n```\n", "closed_by": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/4040/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/4040/timeline", "performed_via_github_app": null, "state_reason": "completed"}