{"url": "https://api.github.com/repos/rust-lang/rust/issues/31233", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/31233/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/31233/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/31233/events", "html_url": "https://github.com/rust-lang/rust/issues/31233", "id": 129036449, "node_id": "MDU6SXNzdWUxMjkwMzY0NDk=", "number": 31233, "title": "Can't reference lib from msvc C++: unresolved external symbol", "user": {"login": "andruhon", "id": 1694497, "node_id": "MDQ6VXNlcjE2OTQ0OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1694497?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andruhon", "html_url": "https://github.com/andruhon", "followers_url": "https://api.github.com/users/andruhon/followers", "following_url": "https://api.github.com/users/andruhon/following{/other_user}", "gists_url": "https://api.github.com/users/andruhon/gists{/gist_id}", "starred_url": "https://api.github.com/users/andruhon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andruhon/subscriptions", "organizations_url": "https://api.github.com/users/andruhon/orgs", "repos_url": "https://api.github.com/users/andruhon/repos", "events_url": "https://api.github.com/users/andruhon/events{/privacy}", "received_events_url": "https://api.github.com/users/andruhon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2016-01-27T05:31:59Z", "updated_at": "2016-01-27T21:30:06Z", "closed_at": "2016-01-27T19:25:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Trying to build https://github.com/wtfil/rust-in-node on windows. (it works perfectly fine on linux/ubuntu)\n\nIt seems like .lib produced rustc is for some reason not compatible with MS C++.\n\n```\nC:\\local_projects\\rust\\rust-in-node>npm run build-cpp-ffi --verbose\nnpm info it worked if it ends with ok\nnpm verb cli [ 'C:\\\\Program Files (x86)\\\\nodejs\\\\node.exe',\nnpm verb cli   'C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js',\nnpm verb cli   'run',\nnpm verb cli   'build-cpp-ffi',\nnpm verb cli   '--verbose' ]\nnpm info using npm@3.3.12\nnpm info using node@v5.5.0\nnpm verb run-script [ 'prebuild-cpp-ffi', 'build-cpp-ffi', 'postbuild-cpp-ffi' ]\nnpm info lifecycle embed@1.0.0~prebuild-cpp-ffi: embed@1.0.0\nnpm info lifecycle embed@1.0.0~build-cpp-ffi: embed@1.0.0\n\n> embed@1.0.0 build-cpp-ffi C:\\local_projects\\rust\\rust-in-node\n> (cd src/native-cpp-ffi && node-gyp configure build)\n\n\nC:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi>if not defined npm_config_node_gyp (node \"C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\bin\\node-gyp-bin\\\\..\\..\\node_modules\\node-gyp\\bin\\node-gyp.js\" configure build )  else (node  configure build )\ngyp info it worked if it ends with ok\ngyp verb cli [ 'C:\\\\Program Files (x86)\\\\nodejs\\\\node.exe',\ngyp verb cli   'C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\node_modules\\\\node-gyp\\\\bin\\\\node-gyp.js',\ngyp verb cli   'configure',\ngyp verb cli   'build' ]\ngyp info using node-gyp@3.0.3\ngyp info using node@5.5.0 | win32 | ia32\ngyp verb command configure []\ngyp verb check python checking for Python executable \"python2\" in the PATH\ngyp verb `which` failed Error: not found: python2\ngyp verb `which` failed     at F (C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\node_modules\\which\\which.js:78:19)\ngyp verb `which` failed     at E (C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\node_modules\\which\\which.js:82:29)\ngyp verb `which` failed     at C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\node_modules\\which\\which.js:93:16\ngyp verb `which` failed     at FSReqWrap.oncomplete (fs.js:82:15)\ngyp verb `which` failed  python2 [Error: not found: python2]\ngyp verb check python checking for Python executable \"python\" in the PATH\ngyp verb `which` succeeded python C:\\Python27\\python.EXE\ngyp verb check python version `python -c \"import platform; print(platform.python_version());\"` returned: \"2.7.2\\r\\n\"\ngyp verb get node dir no --target version specified, falling back to host node version: 5.5.0\ngyp verb command install [ '5.5.0' ]\ngyp verb install input version string \"5.5.0\"\ngyp verb install installing version: 5.5.0\ngyp verb install --ensure was passed, so won't reinstall if already installed\ngyp verb install version is already installed, need to check \"installVersion\"\ngyp verb got \"installVersion\" 9\ngyp verb needs \"installVersion\" 9\ngyp verb install version is good\ngyp verb get node dir target node version installed: 5.5.0\ngyp verb build dir attempting to create \"build\" dir: C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\ngyp verb build dir \"build\" dir needed to be created? null\ngyp verb build/config.gypi creating config file\ngyp verb build/config.gypi writing out config file: C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\config.gypi\ngyp verb config.gypi checking for gypi file: C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\config.gypi\ngyp verb common.gypi checking for gypi file: C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\common.gypi\ngyp verb gyp gyp format was not specified; forcing \"msvs\"\ngyp info spawn python\ngyp info spawn args [ 'C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\node_modules\\\\node-gyp\\\\gyp\\\\gyp_main.py',\ngyp info spawn args   'binding.gyp',\ngyp info spawn args   '-f',\ngyp info spawn args   'msvs',\ngyp info spawn args   '-G',\ngyp info spawn args   'msvs_version=auto',\ngyp info spawn args   '-I',\ngyp info spawn args   'C:\\\\local_projects\\\\rust\\\\rust-in-node\\\\src\\\\native-cpp-ffi\\\\build\\\\config.gypi',\ngyp info spawn args   '-I',\ngyp info spawn args   'C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\node_modules\\\\node-gyp\\\\addon.gypi',\ngyp info spawn args   '-I',\ngyp info spawn args   'C:\\\\Users\\\\andruhon\\\\.node-gyp\\\\5.5.0\\\\include\\\\node\\\\common.gypi',\ngyp info spawn args   '-Dlibrary=shared_library',\ngyp info spawn args   '-Dvisibility=default',\ngyp info spawn args   '-Dnode_root_dir=C:\\\\Users\\\\andruhon\\\\.node-gyp\\\\5.5.0',\ngyp info spawn args   '-Dnode_gyp_dir=C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\node_modules\\\\node-gyp',\ngyp info spawn args   '-Dnode_lib_file=node.lib',\ngyp info spawn args   '-Dmodule_root_dir=C:\\\\local_projects\\\\rust\\\\rust-in-node\\\\src\\\\native-cpp-ffi',\ngyp info spawn args   '--depth=.',\ngyp info spawn args   '--no-parallel',\ngyp info spawn args   '--generator-output',\ngyp info spawn args   'C:\\\\local_projects\\\\rust\\\\rust-in-node\\\\src\\\\native-cpp-ffi\\\\build',\ngyp info spawn args   '-Goutput_dir=.' ]\ngyp verb command build []\ngyp verb build type Release\ngyp verb architecture ia32\ngyp verb node dev dir C:\\Users\\andruhon\\.node-gyp\\5.5.0\ngyp verb found first Solution file build/binding.sln\ngyp verb could not find \"msbuild.exe\" in PATH - finding location in registry\ngyp verb \"Release\" dir needed to be created? null\ngyp verb copying \"node.lib\" for ia32 C:\\Users\\andruhon\\.node-gyp\\5.5.0\\Release\\node.lib\ngyp info spawn C:\\Program Files (x86)\\MSBuild\\14.0\\bin\\msbuild.exe\ngyp info spawn args [ 'build/binding.sln',\ngyp info spawn args   '/nologo',\ngyp info spawn args   '/p:Configuration=Release;Platform=Win32' ]\nBuilding the projects in this solution one at a time. To enable parallel build, please add the \"/m\" switch.\nBuild started 27/01/2016 18:29:53.\nProject \"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\binding.sln\" on node 1 (default targets).\nValidateSolutionConfiguration:\n  Building solution configuration \"Release|Win32\".\nThe target \"BeforeGenerateProjectPriFile\" listed in a BeforeTargets attribute at \"C:\\Program Files (x86)\\MSBuild\\Microsoft\\NuGet\\Microsoft.NuG\net.targets (186,61)\" does not exist in the project, and will be ignored.\nProject \"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\binding.sln\" (1) is building \"C:\\local_projects\\rust\\rust-in-node\\src\\na\ntive-cpp-ffi\\build\\addon.vcxproj\" (2) on node 1 (default targets).\nInitializeBuildStatus:\n  Touching \"Release\\obj\\addon\\addon.tlog\\unsuccessfulbuild\".\nClCompile:\n  All outputs are up-to-date.\n  All outputs are up-to-date.\nLink:\n  C:\\Program Files (x86)\\Microsoft Visual Studio 14.0\\VC\\bin\\amd64_x86\\link.exe /ERRORREPORT:QUEUE /OUT:\"C:\\local_projects\\rust\\rust-in-node\\s\n  rc\\native-cpp-ffi\\build\\Release\\addon.node\" /INCREMENTAL:NO /NOLOGO kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib\n   shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib DelayImp.lib \"C:\\Users\\andruhon\\.node-gyp\\5.5.0\\Release\\node.lib\" ..\\..\\..\\rust\\targ\n  et\\release\\embed.lib Delayimp.lib /DELAYLOAD:iojs.exe /DELAYLOAD:node.exe /MANIFEST /MANIFESTUAC:\"level='asInvoker' uiAccess='false'\" /manif\n  est:embed /Debug /PDB:\"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\Release\\addon.pdb\" /MAP /MAPINFO:EXPORTS /OPT:REF /OPT:I\n  CF /LTCG /TLBID:1 /DYNAMICBASE /NXCOMPAT /MACHINE:X86 /SAFESEH /ignore:4199 /DLL Release\\obj\\addon\\addon.obj\n  Release\\obj\\addon\\win_delay_load_hook.obj\n     Creating library C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\Release\\addon.lib and object C:\\local_projects\\rust\\rust-in\n  -node\\src\\native-cpp-ffi\\build\\Release\\addon.exp\naddon.obj : error LNK2001: unresolved external symbol \"int __cdecl fibonacci(int)\" (?fibonacci@@YAHH@Z) [C:\\local_projects\\rust\\rust-in-node\\s\nrc\\native-cpp-ffi\\build\\addon.vcxproj]\nC:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\Release\\addon.node : fatal error LNK1120: 1 unresolved externals [C:\\local_projec\nts\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\addon.vcxproj]\nDone Building Project \"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\addon.vcxproj\" (default targets) -- FAILED.\n\nDone Building Project \"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\binding.sln\" (default targets) -- FAILED.\n\n\nBuild FAILED.\n\n\"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\binding.sln\" (default target) (1) ->\n\"C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\addon.vcxproj\" (default target) (2) ->\n(Link target) ->\n  addon.obj : error LNK2001: unresolved external symbol \"int __cdecl fibonacci(int)\" (?fibonacci@@YAHH@Z) [C:\\local_projects\\rust\\rust-in-node\n\\src\\native-cpp-ffi\\build\\addon.vcxproj]\n  C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\Release\\addon.node : fatal error LNK1120: 1 unresolved externals [C:\\local_proj\nects\\rust\\rust-in-node\\src\\native-cpp-ffi\\build\\addon.vcxproj]\n\n    0 Warning(s)\n    2 Error(s)\n\nTime Elapsed 00:00:00.84\ngyp ERR! build error\ngyp ERR! stack Error: `C:\\Program Files (x86)\\MSBuild\\14.0\\bin\\msbuild.exe` failed with exit code: 1\ngyp ERR! stack     at ChildProcess.onExit (C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\lib\\build.js:270:23)\ngyp ERR! stack     at emitTwo (events.js:100:13)\ngyp ERR! stack     at ChildProcess.emit (events.js:185:7)\ngyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)\ngyp ERR! System Windows_NT 10.0.10586\ngyp ERR! command \"C:\\\\Program Files (x86)\\\\nodejs\\\\node.exe\" \"C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\node_modules\\\\node-gyp\\\\bin\\\\node-gyp.js\" \"configure\" \"build\"\ngyp ERR! cwd C:\\local_projects\\rust\\rust-in-node\\src\\native-cpp-ffi\ngyp ERR! node -v v5.5.0\ngyp ERR! node-gyp -v v3.0.3\ngyp ERR! not ok\n\nnpm verb lifecycle embed@1.0.0~build-cpp-ffi: unsafe-perm in lifecycle true\nnpm verb lifecycle embed@1.0.0~build-cpp-ffi: PATH: C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\bin\\node-gyp-bin;C:\\local_projects\\rust\\rust-in-node\\node_modules\\.bin;C:\\ProgramData\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Intel\\iCLS Client\\;C:\\Program Files\\Intel\\iCLS Client\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files (x86)\\Intel\\OpenCL SDK\\3.0\\bin\\x86;C:\\Program Files (x86)\\Intel\\OpenCL SDK\\3.0\\bin\\x64;C:\\Program Files\\Intel\\Intel(R) Management Engine Components\\DAL;C:\\Program Files\\Intel\\Intel(R) Management Engine Components\\IPT;C:\\Program Files (x86)\\Intel\\Intel(R) Management Engine Components\\DAL;C:\\Program Files (x86)\\Intel\\Intel(R) Management Engine Components\\IPT;C:\\Python27;C:\\Python27\\Scripts;C:\\xampp\\php;C:\\Program Files (x86)\\Windows Live\\Shared;C:\\Program Files\\Java\\jdk1.7.0_67\\bin;C:\\Program Files\\TortoiseSVN\\bin;C:\\adt-bundle-windows-x86_64-20140702\\apache-ant-1.9.4\\bin;C:\\Program Files (x86)\\nano-2.4.1-win32;C:\\Go\\bin;C:\\Program Files (x86)\\sbt\\\\bin;C:\\Program Files (x86)\\Skype\\Phone\\;C:\\Program Files\\Microsoft SQL Server\\120\\Tools\\Binn\\;C:\\Program Files (x86)\\Windows Kits\\10\\Windows Performance Toolkit\\;C:\\Users\\andruhon\\AppData\\Local\\Android\\sdk\\tools;C:\\Users\\andruhon\\AppData\\Local\\Android\\sdk\\platform-tools;C:\\Program Files (x86)\\nodejs\\;C:\\Program Files\\Microsoft SQL Server\\110\\Tools\\Binn\\;C:\\Program Files (x86)\\Git\\cmd;C:\\Program Files (x86)\\Git\\mingw32\\bin;C:\\Program Files (x86)\\Git\\usr\\bin;C:\\multirust\\bin;C:\\multirust\\bin;C:\\ProgramData\\chocolatey\\bin;c:\\Users\\andruhon\\AppData\\Local\\atom\\bin;C:\\Users\\andruhon\\AppData\\Local\\atom\\bin;C:\\Go\\bin;C:\\Users\\andruhon\\AppData\\Roaming\\npm\nnpm verb lifecycle embed@1.0.0~build-cpp-ffi: CWD: C:\\local_projects\\rust\\rust-in-node\nnpm info lifecycle embed@1.0.0~build-cpp-ffi: Failed to exec build-cpp-ffi script\nnpm verb stack Error: embed@1.0.0 build-cpp-ffi: `(cd src/native-cpp-ffi && node-gyp configure build)`\nnpm verb stack Exit status 1\nnpm verb stack     at EventEmitter.<anonymous> (C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\lib\\utils\\lifecycle.js:232:16)\nnpm verb stack     at emitTwo (events.js:100:13)\nnpm verb stack     at EventEmitter.emit (events.js:185:7)\nnpm verb stack     at ChildProcess.<anonymous> (C:\\Program Files (x86)\\nodejs\\node_modules\\npm\\lib\\utils\\spawn.js:24:14)\nnpm verb stack     at emitTwo (events.js:100:13)\nnpm verb stack     at ChildProcess.emit (events.js:185:7)\nnpm verb stack     at maybeClose (internal/child_process.js:821:16)\nnpm verb stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:211:5)\nnpm verb pkgid embed@1.0.0\nnpm verb cwd C:\\local_projects\\rust\\rust-in-node\nnpm ERR! Windows_NT 10.0.10586\nnpm ERR! argv \"C:\\\\Program Files (x86)\\\\nodejs\\\\node.exe\" \"C:\\\\Program Files (x86)\\\\nodejs\\\\node_modules\\\\npm\\\\bin\\\\npm-cli.js\" \"run\" \"build-cpp-ffi\" \"--verbose\"\nnpm ERR! node v5.5.0\nnpm ERR! npm  v3.3.12\nnpm ERR! code ELIFECYCLE\nnpm ERR! embed@1.0.0 build-cpp-ffi: `(cd src/native-cpp-ffi && node-gyp configure build)`\nnpm ERR! Exit status 1\nnpm ERR!\nnpm ERR! Failed at the embed@1.0.0 build-cpp-ffi script '(cd src/native-cpp-ffi && node-gyp configure build)'.\nnpm ERR! Make sure you have the latest version of node.js and npm installed.\nnpm ERR! If you do, this is most likely a problem with the embed package,\nnpm ERR! not with npm itself.\nnpm ERR! Tell the author that this fails on your system:\nnpm ERR!     (cd src/native-cpp-ffi && node-gyp configure build)\nnpm ERR! You can get their info via:\nnpm ERR!     npm owner ls embed\nnpm ERR! There is likely additional logging output above.\nnpm verb exit [ 1, true ]\n\nnpm ERR! Please include the following file with any support request:\nnpm ERR!     C:\\local_projects\\rust\\rust-in-node\\npm-debug.log\n```\n", "closed_by": {"login": "andruhon", "id": 1694497, "node_id": "MDQ6VXNlcjE2OTQ0OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1694497?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andruhon", "html_url": "https://github.com/andruhon", "followers_url": "https://api.github.com/users/andruhon/followers", "following_url": "https://api.github.com/users/andruhon/following{/other_user}", "gists_url": "https://api.github.com/users/andruhon/gists{/gist_id}", "starred_url": "https://api.github.com/users/andruhon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andruhon/subscriptions", "organizations_url": "https://api.github.com/users/andruhon/orgs", "repos_url": "https://api.github.com/users/andruhon/repos", "events_url": "https://api.github.com/users/andruhon/events{/privacy}", "received_events_url": "https://api.github.com/users/andruhon/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/31233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/31233/timeline", "performed_via_github_app": null, "state_reason": "completed"}