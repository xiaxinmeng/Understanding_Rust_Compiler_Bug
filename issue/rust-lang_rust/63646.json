{"url": "https://api.github.com/repos/rust-lang/rust/issues/63646", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63646/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63646/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63646/events", "html_url": "https://github.com/rust-lang/rust/issues/63646", "id": 481816300, "node_id": "MDU6SXNzdWU0ODE4MTYzMDA=", "number": 63646, "title": "`RangeToInclusive` code-generation much worse than equivilent `RangeTo`", "user": {"login": "gamozolabs", "id": 13505090, "node_id": "MDQ6VXNlcjEzNTA1MDkw", "avatar_url": "https://avatars.githubusercontent.com/u/13505090?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gamozolabs", "html_url": "https://github.com/gamozolabs", "followers_url": "https://api.github.com/users/gamozolabs/followers", "following_url": "https://api.github.com/users/gamozolabs/following{/other_user}", "gists_url": "https://api.github.com/users/gamozolabs/gists{/gist_id}", "starred_url": "https://api.github.com/users/gamozolabs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gamozolabs/subscriptions", "organizations_url": "https://api.github.com/users/gamozolabs/orgs", "repos_url": "https://api.github.com/users/gamozolabs/repos", "events_url": "https://api.github.com/users/gamozolabs/events{/privacy}", "received_events_url": "https://api.github.com/users/gamozolabs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-16T23:12:24Z", "updated_at": "2020-03-18T23:53:37Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "I have two copies of the exact same code, one using `for _ in 0..65` and the other using `for _ in 0..=64`. The `0..65` one optimizes down to very simple code, however the `0..=64` version ends up emitting a large amount of unnecessary code.\r\n\r\n---\r\n\r\n# RangeTo example\r\n\r\n```rust\r\npub fn and_stuff(a: i32, mut b: i32) -> i32 {\r\n    for _ in 0..65 {\r\n        b &= a;\r\n    }\r\n\r\n    b\r\n}\r\n```\r\n\r\nEmits (https://rust.godbolt.org/z/pcscMB):\r\n\r\n```nasm\r\nexample::and_stuff:\r\n        mov     eax, edi\r\n        and     eax, esi\r\n        ret\r\n```\r\n\r\n---\r\n\r\n# RangeToInclusive example\r\n\r\n```rust\r\npub fn and_stuff(a: i32, mut b: i32) -> i32 {\r\n    for _ in 0..=64 {\r\n        b &= a;\r\n    }\r\n\r\n    b\r\n}\r\n```\r\n\r\nEmits (https://rust.godbolt.org/z/22JaO2):\r\n\r\n```nasm\r\n.LCPI0_0:\r\n        .zero   4\r\n        .long   4294967295\r\n        .long   4294967295\r\n        .long   4294967295\r\nexample::and_stuff:\r\n        movd    xmm0, esi\r\n        movaps  xmm1, xmmword ptr [rip + .LCPI0_0]\r\n        movss   xmm1, xmm0\r\n        movd    xmm0, edi\r\n        pshufd  xmm0, xmm0, 0\r\n        pand    xmm0, xmm1\r\n        pshufd  xmm1, xmm0, 78\r\n        pand    xmm1, xmm0\r\n        pshufd  xmm0, xmm1, 229\r\n        pand    xmm0, xmm1\r\n        movd    eax, xmm0\r\n        and     eax, edi\r\n        ret\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63646/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63646/timeline", "performed_via_github_app": null, "state_reason": null}