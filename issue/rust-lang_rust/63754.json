{"url": "https://api.github.com/repos/rust-lang/rust/issues/63754", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/63754/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/63754/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/63754/events", "html_url": "https://github.com/rust-lang/rust/issues/63754", "id": 483008387, "node_id": "MDU6SXNzdWU0ODMwMDgzODc=", "number": 63754, "title": "Cargo can't find std crates using local-rust-root on macOS.", "user": {"login": "Lord-Kamina", "id": 6446892, "node_id": "MDQ6VXNlcjY0NDY4OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/6446892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lord-Kamina", "html_url": "https://github.com/Lord-Kamina", "followers_url": "https://api.github.com/users/Lord-Kamina/followers", "following_url": "https://api.github.com/users/Lord-Kamina/following{/other_user}", "gists_url": "https://api.github.com/users/Lord-Kamina/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lord-Kamina/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lord-Kamina/subscriptions", "organizations_url": "https://api.github.com/users/Lord-Kamina/orgs", "repos_url": "https://api.github.com/users/Lord-Kamina/repos", "events_url": "https://api.github.com/users/Lord-Kamina/events{/privacy}", "received_events_url": "https://api.github.com/users/Lord-Kamina/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 5001006048, "node_id": "LA_kwDOAAsO6M8AAAABKhVL4A", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-custom-config", "name": "requires-custom-config", "color": "76dcde", "default": false, "description": "This issue requires custom config/build for rustc in some way"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-17T17:21:58Z", "updated_at": "2023-05-20T22:24:35Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thanks for filing a \ud83d\udc1b bug report \ud83d\ude04! -->\r\n\r\n**Problem**\r\n<!-- A clear and concise description of what the bug is. -->\r\n<!-- including what currently happens and what you expected to happen. -->\r\n\r\nCargo won't find std or core crates if I try to bootstrap using the following command:\r\n\r\n```\r\ncd /opt/mxe/tmp-rustc-x86_64-apple-darwin18.7.0//rustc-1.36.0-src && ./configure --prefix=/opt/mxe/usr --enable-vendor --default-linker=gcc --disable-codegen-tests --disable-docs --release-channel=stable --llvm-root=/opt/mxe/usr/libexec/llvm-8.0.0 --build=x86_64-apple-darwin --local-rust-root=/opt/mxe/tmp-rust-stage0-x86_64-apple-darwin --set=target.x86_64-apple-darwin.cc=gcc --set=target.x86_64-apple-darwin.cxx=g++ --set=target.x86_64-apple-darwin.linker=gcc --set=build.python=python2.7\r\n\r\nconfigure: processing command line\r\nconfigure: \r\nconfigure: rust.default-linker  := gcc\r\nconfigure: build.vendor         := True\r\nconfigure: rust.channel         := stable\r\nconfigure: build.docs           := False\r\nconfigure: rust.codegen-tests   := False\r\nconfigure: install.prefix       := /opt/mxe/usr\r\nconfigure: target.x86_64-apple-darwin.cc := gcc\r\nconfigure: target.x86_64-apple-darwin.cxx := g++\r\nconfigure: target.x86_64-apple-darwin.linker := gcc\r\nconfigure: build.python         := python2.7\r\nconfigure: build.build          := x86_64-apple-darwin\r\nconfigure: build.rustc          := /opt/mxe/tmp-rust-stage0-x86_64-apple-darwin/b ...\r\nconfigure: build.cargo          := /opt/mxe/tmp-rust-stage0-x86_64-apple-darwin/b ...\r\nconfigure: target.x86_64-apple-darwin.llvm-config := /opt/mxe/usr/libexec/llvm-8. ...\r\nconfigure: build.configure-args := ['--prefix=/opt/mxe/usr', '--enable-vendor', ' ...\r\nconfigure: \r\nconfigure: writing `config.toml` in current directory\r\nconfigure: \r\nconfigure: run `python /opt/mxe/tmp-rustc-x86_64-apple-darwin18.7.0/rustc-1.36.0-src/x.py --help`\r\nconfigure: \r\n\r\ncd /opt/mxe/tmp-rustc-x86_64-apple-darwin18.7.0//rustc-1.36.0-src && /opt/Xcode.app/Contents/Developer/usr/bin/make -j6 -w rustc-stage1 VERBOSE=1 BOOTSTRAP_ARGS=\"-v -j6\" \r\n```\r\n\r\nI don't run into this issue if I add `--enable-local-rust`, but then something else happens: configure.py overrides `build.rustc` like so:\r\n\r\n```\r\ncd /opt/mxe/tmp-rustc-x86_64-apple-darwin18.7.0//rustc-1.36.0-src && ./configure --prefix=/opt/mxe/usr --enable-vendor --default-linker=gcc --disable-codegen-tests --disable-docs --release-channel=stable --llvm-root=/opt/mxe/usr/libexec/llvm-8.0.0 --build=x86_64-apple-darwin --enable-local-rust --set=target.x86_64-apple-darwin.cc=gcc --set=target.x86_64-apple-darwin.cxx=g++ --set=target.x86_64-apple-darwin.linker=gcc --set=build.python=python2.7 --local-rust-root=/opt/mxe/tmp-rust-stage0-x86_64-apple-darwin\r\nconfigure: processing command line\r\nconfigure: \r\nconfigure: rust.default-linker  := gcc\r\nconfigure: build.vendor         := True\r\nconfigure: rust.channel         := stable\r\nconfigure: build.docs           := False\r\nconfigure: rust.codegen-tests   := False\r\nconfigure: install.prefix       := /opt/mxe/usr\r\nconfigure: target.x86_64-apple-darwin.cc := gcc\r\nconfigure: target.x86_64-apple-darwin.cxx := g++\r\nconfigure: target.x86_64-apple-darwin.linker := gcc\r\nconfigure: build.python         := python2.7\r\nconfigure: build.build          := x86_64-apple-darwin\r\nconfigure: build.rustc          := /opt/mxe/tmp-rust-stage0-x86_64-apple-darwin/b ...\r\nconfigure: build.cargo          := /opt/mxe/tmp-rust-stage0-x86_64-apple-darwin/b ...\r\nconfigure: target.x86_64-apple-darwin.llvm-config := /opt/mxe/usr/libexec/llvm-8. ...\r\nconfigure: build.rustc          := /opt/local/bin/rustc\r\nconfigure: build.configure-args := ['--prefix=/opt/mxe/usr', '--enable-vendor', ' ...\r\nconfigure: \r\nconfigure: writing `config.toml` in current directory\r\nconfigure: \r\nconfigure: run `python /opt/mxe/tmp-rustc-x86_64-apple-darwin18.7.0/rustc-1.36.0-src/x.py --help`\r\nconfigure: \r\n```\r\nThe second bit is evidently not related to cargo itself I guess but it's a bit puzzling. Anyway, why won't cargo find the crates in the local-rust-root unless I specifically omit `--enable-local-rust`?\r\n\r\n\r\n**Notes**\r\n\r\nOutput of `cargo version`: 0.37.0\r\n\r\n<!-- Also, any additional context or information you feel may be relevant to the issue. -->\r\n<!-- (e.g rust version, OS platform/distribution/version, target toolchain(s), release channel.. -->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/63754/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/63754/timeline", "performed_via_github_app": null, "state_reason": null}