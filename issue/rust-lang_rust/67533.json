{"url": "https://api.github.com/repos/rust-lang/rust/issues/67533", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/67533/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/67533/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/67533/events", "html_url": "https://github.com/rust-lang/rust/issues/67533", "id": 541488884, "node_id": "MDU6SXNzdWU1NDE0ODg4ODQ=", "number": 67533, "title": "--cap-lints=warn are \"ignored\" in RUSTDOCFLAGS", "user": {"login": "ignatenkobrain", "id": 2866862, "node_id": "MDQ6VXNlcjI4NjY4NjI=", "avatar_url": "https://avatars.githubusercontent.com/u/2866862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ignatenkobrain", "html_url": "https://github.com/ignatenkobrain", "followers_url": "https://api.github.com/users/ignatenkobrain/followers", "following_url": "https://api.github.com/users/ignatenkobrain/following{/other_user}", "gists_url": "https://api.github.com/users/ignatenkobrain/gists{/gist_id}", "starred_url": "https://api.github.com/users/ignatenkobrain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ignatenkobrain/subscriptions", "organizations_url": "https://api.github.com/users/ignatenkobrain/orgs", "repos_url": "https://api.github.com/users/ignatenkobrain/repos", "events_url": "https://api.github.com/users/ignatenkobrain/events{/privacy}", "received_events_url": "https://api.github.com/users/ignatenkobrain/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203738, "node_id": "MDU6TGFiZWwyMDM3Mzg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-rustdoc", "name": "T-rustdoc", "color": "bfd4f2", "default": false, "description": "Relevant to the rustdoc team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1118559391, "node_id": "MDU6TGFiZWwxMTE4NTU5Mzkx", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-doctests", "name": "A-doctests", "color": "f7e101", "default": false, "description": "Area: Documentation tests, run by rustdoc"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-20T15:33:24Z", "updated_at": "2020-01-15T19:14:03Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!-- Thanks for filing a \ud83d\udc1b bug report \ud83d\ude04! -->\r\n\r\n**Problem**\r\n\r\nI am trying to package async-std crates for Fedora and that includes running tests for them. I learned that they fail because `#![feature(async_await)]` is used. We are passing `--cap-lints=warn` in RUSTFLAGS, but that seems to be not enough. I have tried setting RUSTDOCFLAGS to pass this argument, but that does not seem to be respected.\r\n\r\n```rust\r\n   Doc-tests async-task\r\n     Running `/usr/bin/rustdoc --edition=2018 --crate-type lib --test /home/brain/rpmbuild/BUILD/async-task-1.0.0/src/lib.rs --crate-name async_task -L dependency=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps -L dependency=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps --extern async_task=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps/libasync_task-02b10d3ab134b052.rlib --extern crossbeam=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps/libcrossbeam-94d09b2f1a7d16d7.rlib --extern crossbeam_utils=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps/libcrossbeam_utils-07a37c9338813562.rlib --extern futures=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps/libfutures-d20f84983f6edcd1.rlib --extern lazy_static=/home/brain/rpmbuild/BUILD/async-task-1.0.0/target/release/deps/liblazy_static-0209edcb3ceb1faa.rlib -Copt-level=3 -Cdebuginfo=2 -Clink-arg=-Wl,-z,relro,-z,now -Ccodegen-units=1 --cap-lints=warn`\r\n\r\nrunning 4 tests\r\ntest src/task.rs - task::spawn (line 24) ... FAILED\r\ntest src/lib.rs -  (line 13) ... FAILED\r\ntest src/lib.rs -  (line 58) ... FAILED\r\ntest src/lib.rs -  (line 30) ... FAILED\r\n\r\nfailures:\r\n\r\n---- src/task.rs - task::spawn (line 24) stdout ----\r\nerror: the feature `async_await` has been stable since 1.39.0 and no longer requires an attribute to enable\r\n --> src/task.rs:23:12\r\n  |\r\n3 | #![feature(async_await)]\r\n  |            ^^^^^^^^^^^\r\n  |\r\nnote: lint level defined here\r\n --> src/task.rs:21:27\r\n  |\r\n1 | #![deny(rust_2018_idioms, warnings)]\r\n  |                           ^^^^^^^^\r\n  = note: `#[deny(stable_features)]` implied by `#[deny(warnings)]`\r\n\r\nerror: aborting due to previous error\r\n```\r\n\r\n**Steps**\r\n<!-- The steps to reproduce the bug. -->\r\n1. Grab async-std tarball from crates.io\r\n2. Run doc-tests on it with rustc 1.39+\r\n3. Try to pass `--cap-lints=warn` in RUSTFLAGS and RUSTDOCFLAGS\r\n\r\n**Possible Solution(s)**\r\n\r\nI did not look into the code, but I believe it just does not get propagated somewhere.\r\n\r\n**Notes**\r\n\r\nOutput of `cargo version`: `cargo 1.39.0`\r\n\r\nThis is happening on x86_64 on Fedora with its compiler, but I am pretty sure this will happen with rustup compiler too.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/67533/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/67533/timeline", "performed_via_github_app": null, "state_reason": null}