{"url": "https://api.github.com/repos/rust-lang/rust/issues/13703", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13703/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13703/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13703/events", "html_url": "https://github.com/rust-lang/rust/issues/13703", "id": 32054166, "node_id": "MDU6SXNzdWUzMjA1NDE2Ng==", "number": 13703, "title": "If `Foo<'a,'b>` requires 'a <= 'b, need to infer (or provide easy way to express) constraint", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2014-04-23T11:57:43Z", "updated_at": "2014-10-03T07:27:53Z", "closed_at": "2014-10-03T07:27:53Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Forked off from [#10396 comment](https://github.com/mozilla/rust/issues/10396#issuecomment-41133028)\n\nConsider this code:\n\n``` rust\npub struct Foo<'a, 'b> { foo: &'a &'b int }\n\n#[cfg(works)]\npub fn foo<'a, 'b>(x: Foo<'a, 'b>, _o: Option<&'a &'b ()>) { let _y = x.foo; }\n#[cfg(not(works))]\npub fn foo<'a, 'b>(x: Foo<'a, 'b>, _o: Option<&   &   ()>) { let _y = x.foo; }\n\nfn main() {}\n```\n\nI spoke with @eddyb and pointed him at [regions-variance-covariant-use-contravariant.rs](../blob/master/src/test/compile-fail/regions-variance-covariant-use-contravariant.rs) to illustrate that we _do_ infer `'a <= 'b` from the existence of `&'a &'b T`.\n\nThe fact that the code above does not compile as-is is interesting.  I cannot tell if that is actually related to #10396 or not.  (That's why I am filing this separate ticket.)\n\nIn particular, the constraints are generated by immediate occurrences of `&'a &'b T`, but not by occurrences of `Foo<'a,'b>` (despite `Foo` having a field of type `&'a &'b T` within it).\n\nThere are a couple different approaches to resolving this.  The one with least user impact is probably to make occurrences of `Foo<'a,'b>` (when defined as above) also generate the constraint  'a <= 'b.\n\n---\n\nFor completeness (and to save others the trouble of running rustc themselves on the above test case) here is the compile failure you get today if you attempt to compile the code above without `--cfg works`:\n\n```\n/tmp/lifetime.rs:6:66: 6:68 error: in type `&'a &'b int`, pointer has a longer lifetime than the data it references\n/tmp/lifetime.rs:6 pub fn foo<'a, 'b>(x: Foo<'a, 'b>, _o: Option<&   &   ()>) { let _y = x.foo; }\n                                                                                    ^~\n/tmp/lifetime.rs:6:60: 6:79 note: the pointer is valid for the lifetime &'a  as defined on the block at 6:59\n/tmp/lifetime.rs:6 pub fn foo<'a, 'b>(x: Foo<'a, 'b>, _o: Option<&   &   ()>) { let _y = x.foo; }\n                                                                              ^~~~~~~~~~~~~~~~~~~\n/tmp/lifetime.rs:6:60: 6:79 note: but the referenced data is only valid for the lifetime &'b  as defined on the block at 6:59\n/tmp/lifetime.rs:6 pub fn foo<'a, 'b>(x: Foo<'a, 'b>, _o: Option<&   &   ()>) { let _y = x.foo; }\n                                                                              ^~~~~~~~~~~~~~~~~~~\nerror: aborting due to previous error\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13703/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13703/timeline", "performed_via_github_app": null, "state_reason": "completed"}