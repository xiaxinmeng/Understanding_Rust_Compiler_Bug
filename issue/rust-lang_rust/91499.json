{"url": "https://api.github.com/repos/rust-lang/rust/issues/91499", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/91499/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/91499/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/91499/events", "html_url": "https://github.com/rust-lang/rust/issues/91499", "id": 1070895153, "node_id": "I_kwDOAAsO6M4_1JAx", "number": 91499, "title": " Error building for arm64 on a am64 with docker", "user": {"login": "jdrouet", "id": 6329508, "node_id": "MDQ6VXNlcjYzMjk1MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/6329508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jdrouet", "html_url": "https://github.com/jdrouet", "followers_url": "https://api.github.com/users/jdrouet/followers", "following_url": "https://api.github.com/users/jdrouet/following{/other_user}", "gists_url": "https://api.github.com/users/jdrouet/gists{/gist_id}", "starred_url": "https://api.github.com/users/jdrouet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jdrouet/subscriptions", "organizations_url": "https://api.github.com/users/jdrouet/orgs", "repos_url": "https://api.github.com/users/jdrouet/repos", "events_url": "https://api.github.com/users/jdrouet/events{/privacy}", "received_events_url": "https://api.github.com/users/jdrouet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 3940166907, "node_id": "LA_kwDOAAsO6M7q2iz7", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AArch64", "name": "O-AArch64", "color": "6e6ec0", "default": false, "description": "Armv8-A or later processors in AArch64 mode"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-12-03T19:38:19Z", "updated_at": "2022-06-24T20:15:57Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "\ud83d\udc4b Hi!\r\n\r\nI'm working on [docker-activity](https://github.com/jdrouet/docker-activity) and `memchr` is one of my dependencies.\r\nI'm building `docker-activity` with [docker buildx](https://github.com/docker/buildx) in order to have a single image for both platform and I end up having a weird behavior.\r\n\r\nI'm not sure if I open this issue in this repo, or in `buildx` or even in `qemu`, but I'll try my luck here.\r\n\r\nWhen I build on a real `arm64` machine (RPi4), the image builds perfectly but when I use `docker buildx build --platform linux/arm64` on a amd64, I end up having this issue due to `memchr` apparently.\r\n\r\n```\r\n#18 33.61    Compiling futures-core v0.3.18\r\n#18 35.36 error: could not compile `memchr` due to previous error\r\n#18 35.37 warning: build failed, waiting for other jobs to finish...\r\n#18 43.90 error: linking with `cc` failed: exit status: 1\r\n#18 43.90   |\r\n#18 43.90   = note: \"cc\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained/crt1.o\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained/crti.o\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained/crtbegin.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.0.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.1.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.10.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.11.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.12.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.13.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.14.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.15.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.2.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.3.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.4.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.5.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.6.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.7.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.8.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.build_script_build.9009e48d-cgu.9.rcgu.o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d.25mgmn3yz3lxkcgb.rcgu.o\" \"-Wl,--as-needed\" \"-L\" \"/code/target/release/deps\" \"-L\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-bb69598673ac6378.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libpanic_unwind-347c34ae82bb4da0.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libminiz_oxide-86fc36b502bfb8aa.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libadler-cb14375f652e6e86.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libobject-9e87208331b99476.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libmemchr-ebe0ff89d9e37134.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libaddr2line-b0f16d22595fdd3b.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libgimli-57bd3e568b1b69be.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd_detect-d2296608bd767c8a.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/librustc_demangle-e4d26fe9e39d3be6.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libhashbrown-8322f07825c42064.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/librustc_std_workspace_alloc-403fa8d4a1124a0d.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libunwind-29e90d90171d4117.rlib\" \"-lunwind\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libcfg_if-ed66653f82293f20.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/liblibc-ad350ff50825d4f2.rlib\" \"-lc\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/liballoc-98d6df8d800ab2ff.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/librustc_std_workspace_core-e0db88e40d9c7e0b.rlib\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libcore-fcedc0d4b8cb02ca.rlib\" \"-Wl,--end-group\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/libcompiler_builtins-0c2242734ae54219.rlib\" \"-Wl,-Bdynamic\" \"-Wl,--eh-frame-hdr\" \"-Wl,-znoexecstack\" \"-nostartfiles\" \"-L\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"-L\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained\" \"-o\" \"/code/target/release/build/futures-core-34f97c22b245c83d/build_script_build-34f97c22b245c83d\" \"-Wl,--gc-sections\" \"-static\" \"-no-pie\" \"-Wl,-zrelro,-znow\" \"-nodefaultlibs\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained/crtend.o\" \"/usr/local/rustup/toolchains/nightly-aarch64-unknown-linux-musl/lib/rustlib/aarch64-unknown-linux-musl/lib/self-contained/crtn.o\"\r\n#18 43.90   = note:\r\n#18 43.90\r\n#18 46.48 error: build failed\r\n------\r\nDockerfile:16\r\n--------------------\r\n  14 |     COPY src/exporter /code/src/exporter\r\n  15 |     COPY src/format /code/src/format\r\n  16 | >>> RUN cargo build --release --offline\r\n  17 |\r\n  18 |     FROM alpine\r\n--------------------\r\nerror: failed to solve: process \"/dev/.buildkit_qemu_emulator /bin/sh -c cargo build --release --offline\" did not complete successfully: exit code: 101\r\n```\r\n\r\nDo you have any idea where that could come from? If you want, [here is the Dockerfile](https://github.com/jdrouet/docker-activity/blob/main/Dockerfile) I use.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\nI'm using the following base image `ghcr.io/rust-lang/rust:nightly-alpine`\r\n\r\nInitially cross posted this issue on [memchr](https://github.com/BurntSushi/memchr/issues/101)", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/91499/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/91499/timeline", "performed_via_github_app": null, "state_reason": null}