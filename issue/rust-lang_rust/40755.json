{"url": "https://api.github.com/repos/rust-lang/rust/issues/40755", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40755/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40755/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40755/events", "html_url": "https://github.com/rust-lang/rust/issues/40755", "id": 216388099, "node_id": "MDU6SXNzdWUyMTYzODgwOTk=", "number": 40755, "title": "cargo build && cargo check cause \"the compiler unexpectedly panicked\"", "user": {"login": "seb-odessa", "id": 1684316, "node_id": "MDQ6VXNlcjE2ODQzMTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1684316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seb-odessa", "html_url": "https://github.com/seb-odessa", "followers_url": "https://api.github.com/users/seb-odessa/followers", "following_url": "https://api.github.com/users/seb-odessa/following{/other_user}", "gists_url": "https://api.github.com/users/seb-odessa/gists{/gist_id}", "starred_url": "https://api.github.com/users/seb-odessa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seb-odessa/subscriptions", "organizations_url": "https://api.github.com/users/seb-odessa/orgs", "repos_url": "https://api.github.com/users/seb-odessa/repos", "events_url": "https://api.github.com/users/seb-odessa/events{/privacy}", "received_events_url": "https://api.github.com/users/seb-odessa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-03-23T10:54:05Z", "updated_at": "2017-04-21T22:12:37Z", "closed_at": "2017-04-21T22:12:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "How I faced it:\r\n`$ rustup update`\r\n`$ cargo new sqlite_demo --bin`\r\n     Created binary (application) `sqlite_demo` project\r\n`rust$ rustc --version`\r\nrustc 1.16.0 (30cf806ef 2017-03-10)\r\n`$ cd sqlite_demo/`\r\n\r\nAdd **rusqlite** dependency into Cargo.toml:\r\n\r\n```\r\n[package]\r\nname = \"sqlite_demo\"\r\nversion = \"0.1.0\"\r\nauthors = [\"...\"]\r\n\r\n[dependencies]\r\n    rusqlite = \"*\"  <-- this one was added\r\n\r\n```\r\n`$ cargo build`\r\n\r\n    Blocking waiting for file lock on the registry index\r\n    Updating registry `https://github.com/rust-lang/crates.io-index`\r\n    Blocking waiting for file lock on rusqlite-0.10.1.crate\r\n Downloading libsqlite3-sys v0.7.1\r\n Downloading lru-cache v0.1.0\r\n Downloading time v0.1.36\r\n Downloading pkg-config v0.3.9\r\n Downloading linked-hash-map v0.2.1\r\n    Blocking waiting for file lock on libc-0.2.21.crate\r\n   Compiling libc v0.2.21\r\n   Compiling time v0.1.36\r\n   Compiling bitflags v0.7.0\r\n   Compiling linked-hash-map v0.2.1\r\n   Compiling lru-cache v0.1.0\r\n   Compiling pkg-config v0.3.9\r\n   Compiling libsqlite3-sys v0.7.1\r\n   Compiling rusqlite v0.10.1\r\n   Compiling sqlite_demo v0.1.0 (file:///home/seb/workspace/rust/sqlite_demo)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 47.84 secs\r\n\r\ncopy/paste content of main.rs from the demo (http://jgallagher.github.io/rusqlite/rusqlite/index.html):\r\n\r\n```\r\nextern crate rusqlite;\r\nextern crate time;\r\n\r\nuse time::Timespec;\r\nuse rusqlite::Connection;\r\n\r\n#[derive(Debug)]\r\nstruct Person {\r\n    id: i32,\r\n    name: String,\r\n    time_created: Timespec,\r\n    data: Option<Vec<u8>>\r\n}\r\n\r\nfn main() {\r\n    let conn = Connection::open_in_memory().unwrap();\r\n\r\n    conn.execute(\"CREATE TABLE person (\r\n                  id              INTEGER PRIMARY KEY,\r\n                  name            TEXT NOT NULL,\r\n                  time_created    TEXT NOT NULL,\r\n                  data            BLOB\r\n                  )\", &[]).unwrap();\r\n    let me = Person {\r\n        id: 0,\r\n        name: \"Steven\".to_string(),\r\n        time_created: time::get_time(),\r\n        data: None\r\n    };\r\n    conn.execute(\"INSERT INTO person (name, time_created, data)\r\n                  VALUES (?1, ?2, ?3)\",\r\n                 &[&me.name, &me.time_created, &me.data]).unwrap();\r\n\r\n    let mut stmt = conn.prepare(\"SELECT id, name, time_created, data FROM person\").unwrap();\r\n    let person_iter = stmt.query_map(&[], |row| {\r\n        Person {\r\n            id: row.get(0),\r\n            name: row.get(1),\r\n            time_created: row.get(2),\r\n            data: row.get(3)\r\n        }\r\n    }).unwrap();\r\n\r\n    for person in person_iter {\r\n        println!(\"Found person {:?}\", person.unwrap());\r\n    }\r\n}\r\n```\r\n`$ cargo check`\r\n   Compiling bitflags v0.7.0\r\n   Compiling linked-hash-map v0.2.1\r\n   Compiling lru-cache v0.1.0\r\n   Compiling libc v0.2.21\r\n   Compiling time v0.1.36\r\n   Compiling libsqlite3-sys v0.7.1\r\n   Compiling rusqlite v0.10.1\r\n   Compiling sqlite_demo v0.1.0 (file:///home/seb/workspace/rust/sqlite_demo)\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nthread 'rustc' panicked at 'called `Option::unwrap()` on a `None` value', /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/option.rs:323\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n\r\nerror: Could not compile `sqlite_demo`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\n`$ rustc --version --verbose`\r\nrustc 1.16.0 (30cf806ef 2017-03-10)\r\nbinary: rustc\r\ncommit-hash: 30cf806ef8881c41821fbd43e5cf3699c5290c16\r\ncommit-date: 2017-03-10\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.16.0\r\nLLVM version: 3.9\r\n\r\n\r\n\r\n\r\n", "closed_by": {"login": "mbrubeck", "id": 5920, "node_id": "MDQ6VXNlcjU5MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/5920?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbrubeck", "html_url": "https://github.com/mbrubeck", "followers_url": "https://api.github.com/users/mbrubeck/followers", "following_url": "https://api.github.com/users/mbrubeck/following{/other_user}", "gists_url": "https://api.github.com/users/mbrubeck/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbrubeck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbrubeck/subscriptions", "organizations_url": "https://api.github.com/users/mbrubeck/orgs", "repos_url": "https://api.github.com/users/mbrubeck/repos", "events_url": "https://api.github.com/users/mbrubeck/events{/privacy}", "received_events_url": "https://api.github.com/users/mbrubeck/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40755/timeline", "performed_via_github_app": null, "state_reason": "completed"}