{"url": "https://api.github.com/repos/rust-lang/rust/issues/84398", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84398/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84398/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84398/events", "html_url": "https://github.com/rust-lang/rust/issues/84398", "id": 863972927, "node_id": "MDU6SXNzdWU4NjM5NzI5Mjc=", "number": 84398, "title": "Type annotations needed error on definition site", "user": {"login": "vorner", "id": 11783500, "node_id": "MDQ6VXNlcjExNzgzNTAw", "avatar_url": "https://avatars.githubusercontent.com/u/11783500?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorner", "html_url": "https://github.com/vorner", "followers_url": "https://api.github.com/users/vorner/followers", "following_url": "https://api.github.com/users/vorner/following{/other_user}", "gists_url": "https://api.github.com/users/vorner/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorner/subscriptions", "organizations_url": "https://api.github.com/users/vorner/orgs", "repos_url": "https://api.github.com/users/vorner/repos", "events_url": "https://api.github.com/users/vorner/events{/privacy}", "received_events_url": "https://api.github.com/users/vorner/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252628, "node_id": "MDU6TGFiZWwyNjIyNTI2Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-beta", "name": "regression-from-stable-to-beta", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to beta."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/81", "html_url": "https://github.com/rust-lang/rust/milestone/81", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/81/labels", "id": 6573982, "node_id": "MDk6TWlsZXN0b25lNjU3Mzk4Mg==", "number": 81, "title": "1.53.0", "description": "", "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 645, "state": "closed", "created_at": "2021-03-21T03:36:23Z", "updated_at": "2022-03-22T12:24:38Z", "due_on": null, "closed_at": "2021-06-17T19:18:31Z"}, "comments": 9, "created_at": "2021-04-21T14:48:07Z", "updated_at": "2021-05-06T20:04:30Z", "closed_at": "2021-05-06T20:04:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello\r\n\r\nAfter upgrading nightly rustc, I'm getting a lot of type inference errors on code that was compiling fine previously. Moreover, these are not at the call site, but at the definition site, so there doesn't seem to be any place to put any type annotations, like this:\r\n\r\n```\r\n    --> src/spirit.rs:996:1\r\n     |\r\n996  | / impl<O, C> SpiritBuilder for Builder<O, C>\r\n997  | | where\r\n998  | |     Self::Config: DeserializeOwned + Send + Sync + 'static,\r\n999  | |     Self::Opts: StructOpt + Sync + Send + 'static,\r\n...    |\r\n1108 | |     }\r\n1109 | | }\r\n     | |_^ cannot infer type for type parameter `C`\r\n```\r\n\r\nIt spills more kinds of errors that make little sense, but I have the impression these will have a common cause:\r\n\r\n```\r\nerror[E0277]: `C` cannot be shared between threads safely\r\n   --> src/spirit.rs:998:45\r\n    |\r\n998 |     Self::Config: DeserializeOwned + Send + Sync + 'static,\r\n    |                                             ^^^^ `C` cannot be shared between threads safely\r\n```\r\n\r\nThe problematic code is both released on crates.io (crate spirit, version 0.4.16, but I expect that to be happening through most of the history of the crate), and in master (https://github.com/vorner/spirit/commit/1495c1cdef17663e8f847f037abeceb37f310fad).\r\n\r\nI think this is a regression, as it was compiling previously.\r\n\r\nIt compiles fine with older nightly (and stable is fine way back, this particular code is looking mostly the same for some 2 years or more):\r\n\r\n```\r\nrustc 1.53.0-nightly (07e0e2ec2 2021-03-24)\r\n```\r\n\r\nBreaks with\r\n\r\n```\r\nrustc 1.53.0-nightly (6df26f897 2021-04-20)\r\nbinary: rustc\r\ncommit-hash: 6df26f897cffb2d86880544bb451c6b5f8509b2d\r\ncommit-date: 2021-04-20\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.53.0-nightly\r\nLLVM version: 12.0.0\r\n```\r\n\r\n(Unfortunately, I haven't been keeping fully up to date recently, so I don't have a smaller range).", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84398/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84398/timeline", "performed_via_github_app": null, "state_reason": "completed"}