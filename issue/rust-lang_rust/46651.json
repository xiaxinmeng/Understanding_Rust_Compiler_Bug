{"url": "https://api.github.com/repos/rust-lang/rust/issues/46651", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46651/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46651/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46651/events", "html_url": "https://github.com/rust-lang/rust/issues/46651", "id": 280892451, "node_id": "MDU6SXNzdWUyODA4OTI0NTE=", "number": 46651, "title": "Cannot cross-compile aarch64-musl on x86_64 linux", "user": {"login": "asonix", "id": 5304643, "node_id": "MDQ6VXNlcjUzMDQ2NDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5304643?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asonix", "html_url": "https://github.com/asonix", "followers_url": "https://api.github.com/users/asonix/followers", "following_url": "https://api.github.com/users/asonix/following{/other_user}", "gists_url": "https://api.github.com/users/asonix/gists{/gist_id}", "starred_url": "https://api.github.com/users/asonix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asonix/subscriptions", "organizations_url": "https://api.github.com/users/asonix/orgs", "repos_url": "https://api.github.com/users/asonix/repos", "events_url": "https://api.github.com/users/asonix/events{/privacy}", "received_events_url": "https://api.github.com/users/asonix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 55301954, "node_id": "MDU6TGFiZWw1NTMwMTk1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-Arm", "name": "O-Arm", "color": "6e6ec0", "default": false, "description": "Target: 32-bit Arm processors (armv6, armv7, thumb...), including 64-bit Arm in AArch32 state"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2017-12-11T04:41:39Z", "updated_at": "2020-08-24T11:45:06Z", "closed_at": "2020-08-24T11:45:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "Cross compiling fails with the linker being unable to find `__addtf3`, `__multf3` and `__subtf3`\r\n\r\ncode:\r\n```\r\nasonix@asonix-boxes-16-04:~/hello-world-rust$ cat src/main.rs \r\nfn main() {\r\n    println!(\"Hello, world!\");\r\n}\r\n```\r\n\r\nI'm compiling the default hello-world application, and it works fine for `aarch64-unknown-linux-gnu` in addition to working fine for `arm-unknown-linux-musleabihf`. I installed musl the same way for both aarch64 and for armhf, so I'm not sure what the issue would be.\r\n\r\nFurthermore, I can compile a simple hello-world application written in C with the musl standard library just fine.\r\n\r\nNote: I have encountered this issue both in Arch Linux with the 4.14.4 kernel and Ubuntu 16.04 with the 4.4.0 kernel.\r\n\r\nversion info for the output below, although this happens with nightly and stable:\r\n```\r\nasonix@asonix-boxes-16-04:~/hello-world-rust$ rustc --version --verbose\r\nrustc 1.22.1 (05e2e1c41 2017-11-22)\r\nbinary: rustc\r\ncommit-hash: 05e2e1c41414e8fc73d0f267ea8dab1a3eeeaa99\r\ncommit-date: 2017-11-22\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.22.1\r\nLLVM version: 4.0\r\n```\r\n\r\noutput:\r\n```\r\nasonix@asonix-boxes-16-04:~/hello-world-rust$ cargo build --target=aarch64-unknown-linux-musl --verbose\r\n   Compiling hello-world v0.1.0 (file:///home/asonix/hello-world-rust)\r\n     Running `rustc --crate-name hello_world src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=df195ab9189e537e -C extra-filename=-df195ab9189e537e --out-dir /home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps --target aarch64-unknown-linux-musl -C ar=aarch64-linux-gnu-ar -C linker=aarch64-linux-gnu-musl-gcc -L dependency=/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps -L dependency=/home/asonix/hello-world-rust/target/debug/deps`\r\nerror: linking with `aarch64-linux-gnu-musl-gcc` failed: exit code: 1\r\n  |\r\n  = note: \"aarch64-linux-gnu-musl-gcc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-nostdlib\" \"-Wl,--eh-frame-hdr\" \"-Wl,-(\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crt1.o\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crti.o\" \"-L\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps/hello_world-df195ab9189e537e.hello_world0.rust-cgu.o\" \"/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps/hello_world-df195ab9189e537e.hello_world1.rust-cgu.o\" \"-o\" \"/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps/hello_world-df195ab9189e537e\" \"/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps/hello_world-df195ab9189e537e.crate.allocator.rust-cgu.o\" \"-Wl,--gc-sections\" \"-Wl,-z,relro,-z,now\" \"-nodefaultlibs\" \"-L\" \"/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps\" \"-L\" \"/home/asonix/hello-world-rust/target/debug/deps\" \"-L\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib\" \"-Wl,-Bstatic\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-827ddea93328ae2d.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/liballoc_system-751808ba756769d5.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/librand-3d7b10e850a67e89.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libpanic_unwind-8cb97051d8238386.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/liballoc-78c21267a2dc15c1.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd_unicode-0e1b544c94586415.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libunwind-25cc9b024a02d330.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/liblibc-d42e80cee81b06ce.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libcore-0c5e3d6c117f8c44.rlib\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libcompiler_builtins-bd7cc5ada1e908e0.rlib\" \"-static\" \"-Wl,-Bdynamic\" \"/home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/crtn.o\" \"-Wl,-)\"\r\n  = note: /usr/lib/gcc-cross/aarch64-linux-gnu/5/../../../../aarch64-linux-gnu/bin/ld: /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-827ddea93328ae2d.rlib(std-827ddea93328ae2d.std0.rust-cgu.o)(.debug_info+0x71d3): R_AARCH64_ABS64 used with TLS symbol _ZN3std10sys_common11thread_info11THREAD_INFO7__getit5__KEY17hffb73c8d664d75eeE\r\n          /usr/lib/gcc-cross/aarch64-linux-gnu/5/../../../../aarch64-linux-gnu/bin/ld: /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-827ddea93328ae2d.rlib(std-827ddea93328ae2d.std0.rust-cgu.o)(.debug_info+0x185a7): R_AARCH64_ABS64 used with TLS symbol _ZN3std2io5stdio12LOCAL_STDOUT7__getit5__KEY17hc4c662569625ecfaE\r\n          /usr/lib/gcc-cross/aarch64-linux-gnu/5/../../../../aarch64-linux-gnu/bin/ld: /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-827ddea93328ae2d.rlib(std-827ddea93328ae2d.std0.rust-cgu.o)(.debug_info+0x24159): R_AARCH64_ABS64 used with TLS symbol _ZN3std9panicking12LOCAL_STDERR7__getit5__KEY17h933b3f2f97fe548cE\r\n          /usr/lib/gcc-cross/aarch64-linux-gnu/5/../../../../aarch64-linux-gnu/bin/ld: /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/libstd-827ddea93328ae2d.rlib(std-827ddea93328ae2d.std0.rust-cgu.o)(.debug_info+0x24191): R_AARCH64_ABS64 used with TLS symbol _ZN3std9panicking18update_panic_count11PANIC_COUNT7__getit5__KEY17h5de4a458c39aaf87E\r\n          /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/liblibc-d42e80cee81b06ce.rlib(vfprintf.o): In function `fmt_fp':\r\n          vfprintf.c:(.text.fmt_fp+0x178): undefined reference to `__addtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x20c): undefined reference to `__multf3'\r\n          vfprintf.c:(.text.fmt_fp+0x240): undefined reference to `__subtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x250): undefined reference to `__addtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x278): undefined reference to `__addtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x284): undefined reference to `__subtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x33c): undefined reference to `__subtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x344): undefined reference to `__multf3'\r\n          vfprintf.c:(.text.fmt_fp+0x4e8): undefined reference to `__multf3'\r\n          vfprintf.c:(.text.fmt_fp+0x548): undefined reference to `__subtf3'\r\n          vfprintf.c:(.text.fmt_fp+0x550): undefined reference to `__multf3'\r\n          vfprintf.c:(.text.fmt_fp+0x828): undefined reference to `__addtf3'\r\n          /home/asonix/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/aarch64-unknown-linux-musl/lib/liblibc-d42e80cee81b06ce.rlib(frexpl.o): In function `frexpl':\r\n          frexpl.c:(.text.frexpl+0x38): undefined reference to `__multf3'\r\n          collect2: error: ld returned 1 exit status\r\n          \r\n\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `hello-world`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name hello_world src/main.rs --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=df195ab9189e537e -C extra-filename=-df195ab9189e537e --out-dir /home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps --target aarch64-unknown-linux-musl -C ar=aarch64-linux-gnu-ar -C linker=aarch64-linux-gnu-musl-gcc -L dependency=/home/asonix/hello-world-rust/target/aarch64-unknown-linux-musl/debug/deps -L dependency=/home/asonix/hello-world-rust/target/debug/deps` (exit code: 101)\r\n```", "closed_by": {"login": "Amanieu", "id": 278509, "node_id": "MDQ6VXNlcjI3ODUwOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/278509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Amanieu", "html_url": "https://github.com/Amanieu", "followers_url": "https://api.github.com/users/Amanieu/followers", "following_url": "https://api.github.com/users/Amanieu/following{/other_user}", "gists_url": "https://api.github.com/users/Amanieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Amanieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Amanieu/subscriptions", "organizations_url": "https://api.github.com/users/Amanieu/orgs", "repos_url": "https://api.github.com/users/Amanieu/repos", "events_url": "https://api.github.com/users/Amanieu/events{/privacy}", "received_events_url": "https://api.github.com/users/Amanieu/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46651/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46651/timeline", "performed_via_github_app": null, "state_reason": "completed"}