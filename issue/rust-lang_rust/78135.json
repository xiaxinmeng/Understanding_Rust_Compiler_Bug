{"url": "https://api.github.com/repos/rust-lang/rust/issues/78135", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78135/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78135/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78135/events", "html_url": "https://github.com/rust-lang/rust/issues/78135", "id": 725435336, "node_id": "MDU6SXNzdWU3MjU0MzUzMzY=", "number": 78135, "title": "ICE in boolean expression", "user": {"login": "mbartlett21", "id": 29034492, "node_id": "MDQ6VXNlcjI5MDM0NDky", "avatar_url": "https://avatars.githubusercontent.com/u/29034492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbartlett21", "html_url": "https://github.com/mbartlett21", "followers_url": "https://api.github.com/users/mbartlett21/followers", "following_url": "https://api.github.com/users/mbartlett21/following{/other_user}", "gists_url": "https://api.github.com/users/mbartlett21/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbartlett21/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbartlett21/subscriptions", "organizations_url": "https://api.github.com/users/mbartlett21/orgs", "repos_url": "https://api.github.com/users/mbartlett21/repos", "events_url": "https://api.github.com/users/mbartlett21/events{/privacy}", "received_events_url": "https://api.github.com/users/mbartlett21/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-10-20T10:21:04Z", "updated_at": "2020-10-20T11:51:50Z", "closed_at": "2020-10-20T11:51:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\nA typed expression with a comparison on the first branch and an assignment on the second causes an ICE.\r\n\r\nE.g: `let b: bool = 1 == 1 && a = 3;` (see code below)\r\n\r\n### Code\r\n\r\n```rust\r\nfn main() {\r\n    let a = 7;\r\n    let b: bool = 1 == 1 && a = 3;\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc --version --verbose\r\nrustc 1.49.0-nightly (91a79fb29 2020-10-07)\r\nbinary: rustc\r\ncommit-hash: 91a79fb29ac78d057d04dbe86be13d5dcc64309a\r\ncommit-date: 2020-10-07\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.49.0-nightly\r\nLLVM version: 11.0\r\n```\r\n\r\n### Error output\r\n\r\n```text\r\nrustc --crate-type bin test.rs\r\nerror[E0308]: mismatched types\r\n --> test.rs:3:28\r\n  |\r\n3 |     let b: bool = 1 < 2 && a = 3;\r\n  |                            ^ expected `bool`, found integer\r\n\r\nerror: internal compiler error: compiler\\rustc_typeck\\src\\check\\fn_ctxt.rs:459:25: while adjusting\r\nExpr {\r\n    hir_id: HirId {\r\n        owner: DefId(0:3 ~ test[317d]::main),\r\n        local_id: 8\r\n    },\r\n    kind: Lit(Spanned {\r\n        node: Int(1, Unsuffixed),\r\n        span: test.rs:3:19:3:20 (#0)\r\n    }),\r\n    attrs: ThinVec(None),\r\n    span: test.rs:3:19:3:20 (#0)\r\n}, can't compose [Borrow(Ref('_#0r, Not)) -> &{integer}]\r\n             and [Borrow(Ref('_#2r, Not)) -> &{integer}]\r\n\r\nthread 'rustc' panicked at 'Box<Any>', compiler\\rustc_errors\\src\\lib.rs:945:9\r\nstack backtrace:\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compile\r\nr&template=ice.md\r\n\r\nnote: rustc 1.49.0-nightly (91a79fb29 2020-10-07) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type bin\r\n\r\nquery stack during panic:\r\n#0 [typeck] type-checking `main`\r\n#1 [typeck_item_bodies] type-checking all item bodies\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to 2 previous errors\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\n\r\n```\r\n(above is edited to format the `Expr` nicely.)\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nthread 'rustc' panicked at 'Box<Any>', compiler\\rustc_errors\\src\\lib.rs:945:9\r\nstack backtrace:\r\n   0:     0x7ff8c3229989 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hc20a26e0\r\nf7659afd\r\n   1:     0x7ff8c32570bb - core::fmt::write::h435be716304d26a1\r\n   2:     0x7ff8c321b1d8 - <std::io::IoSlice as core::fmt::Debug>::fmt::h997d94c78f1ba97b\r\n   3:     0x7ff8c322ed74 - std::panicking::take_hook::hbf7e33d26fc3ca30\r\n   4:     0x7ff8c322e958 - std::panicking::take_hook::hbf7e33d26fc3ca30\r\n   5:     0x7ff8713df5a7 - rustc_driver::report_ice::h901ed469a4afd632\r\n   6:     0x7ff8c322f7d0 - std::panicking::rust_panic_with_hook::h19068ccbe4b337a1\r\n   7:     0x7ff875b47870 - <rustc_errors::snippet::Style as core::fmt::Debug>::fmt::h154d3f8b7cc27034\r\n   8:     0x7ff875b47799 - <rustc_errors::snippet::Style as core::fmt::Debug>::fmt::h154d3f8b7cc27034\r\n   9:     0x7ff875b477e1 - <rustc_errors::snippet::Style as core::fmt::Debug>::fmt::h154d3f8b7cc27034\r\n  10:     0x7ff875b7a80f - rustc_errors::HandlerInner::err_count::hc7ff30e58befa0c0\r\n  11:     0x7ff875b78ec2 - rustc_errors::Handler::bug::h9f679e586b05b709\r\n  12:     0x7ff875653d4f - rustc_middle::util::bug::bug_fmt::h333e4a32fa9b0768\r\n  13:     0x7ff87564fe70 - <rustc_middle::ty::consts::int::ConstInt as core::fmt::Debug>::fmt::he16df1c1cd9a0739\r\n  14:     0x7ff87564fe13 - <rustc_middle::ty::consts::int::ConstInt as core::fmt::Debug>::fmt::he16df1c1cd9a0739\r\n  15:     0x7ff875653c7c - rustc_middle::util::bug::bug_fmt::h333e4a32fa9b0768\r\n  16:     0x7ff875653be0 - rustc_middle::util::bug::bug_fmt::h333e4a32fa9b0768\r\n  17:     0x7ff873a7b276 - rustc_typeck::check::fn_ctxt::FnCtxt::apply_adjustments::hd48689c045bb2779\r\n  18:     0x7ff873a9ccb6 - rustc_typeck::check::op::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_binop::h67eed476\r\n27a4f5c1\r\n  19:     0x7ff873a9c4f0 - rustc_typeck::check::op::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_binop::h67eed476\r\n27a4f5c1\r\n  20:     0x7ff873a6a470 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  21:     0x7ff873a69666 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  22:     0x7ff873a69491 - rustc_typeck::check::demand::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_for_cast::hb\r\naee3244de8f690d\r\n  23:     0x7ff873a9c476 - rustc_typeck::check::op::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_binop::h67eed476\r\n27a4f5c1\r\n  24:     0x7ff873a6a470 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  25:     0x7ff873a69666 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  26:     0x7ff873a6c4b3 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  27:     0x7ff873a69666 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  28:     0x7ff873a69491 - rustc_typeck::check::demand::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_for_cast::hb\r\naee3244de8f690d\r\n  29:     0x7ff873a844ef - rustc_typeck::check::fn_ctxt::FnCtxt::check_decl_local::h5c1c57395ff4dad3\r\n  30:     0x7ff873a8499a - rustc_typeck::check::fn_ctxt::FnCtxt::check_stmt::h3ac9184b280389fd\r\n  31:     0x7ff873a85456 - rustc_typeck::check::fn_ctxt::FnCtxt::check_block_no_value::h5fff96e685a19bb6\r\n  32:     0x7ff873a69c2c - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  33:     0x7ff873a69666 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  34:     0x7ff873a740b8 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expe\r\nctation::h6fa46624a8ef21fd\r\n  35:     0x7ff873b82bb0 - rustc_typeck::check::check::check_wf_new::h44ae7595528a6fe9\r\n  36:     0x7ff873cc8d09 - <rustc_typeck::variance::terms::InferredIndex as core::fmt::Debug>::fmt::h716ba16bc4b92d58\r\n  37:     0x7ff873d21d5f - <rustc_typeck::check::fixup_opaque_types::FixupFolder as rustc_middle::ty::fold::TypeFolder>\r\n::fold_ty::h873bd66c196887b9\r\n  38:     0x7ff873c8f21e - <rustc_typeck::constrained_generic_params::Parameter as core::fmt::Debug>::fmt::h697f47275b1\r\nd4ea6\r\n  39:     0x7ff873c48e58 - <<rustc_typeck::collect::const_evaluatable_predicates_of::ConstCollector as rustc_hir::intra\r\nvisit::Visitor>::visit_ty::TyAliasVisitor as rustc_middle::ty::fold::TypeVisitor>::visit_const::h7488589258723033\r\n  40:     0x7ff873bde23d - rustc_typeck::check::cast::CastCheck::do_check::h2e0c6c80235d0092\r\n  41:     0x7ff873b5722b - rustc_typeck::check::writeback::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::resolve_type_va\r\nrs_in_body::h32b348bc85041929\r\n  42:     0x7ff873b6b0c2 - rustc_typeck::check::writeback::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::resolve_type_va\r\nrs_in_body::h32b348bc85041929\r\n  43:     0x7ff873d275e4 - <rustc_typeck::check::CheckItemTypesVisitor as rustc_hir::itemlikevisit::ItemLikeVisitor>::v\r\nisit_item::hae0d161a33710820\r\n  44:     0x7ff873c341ed - <<rustc_typeck::collect::const_evaluatable_predicates_of::ConstCollector as rustc_hir::intra\r\nvisit::Visitor>::visit_ty::TyAliasVisitor as rustc_middle::ty::fold::TypeVisitor>::visit_const::h7488589258723033\r\n  45:     0x7ff873c4e9c7 - <<rustc_typeck::collect::const_evaluatable_predicates_of::ConstCollector as rustc_hir::intra\r\nvisit::Visitor>::visit_ty::TyAliasVisitor as rustc_middle::ty::fold::TypeVisitor>::visit_const::h7488589258723033\r\n  46:     0x7ff873be0ab9 - rustc_typeck::check::cast::CastCheck::do_check::h2e0c6c80235d0092\r\n  47:     0x7ff873af02cd - rustc_typeck::check::writeback::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::resolve_type_va\r\nrs_in_body::h32b348bc85041929\r\n  48:     0x7ff873c872de - rustc_typeck::check_crate::had5f65b17757aa4d\r\n  49:     0x7ff871605cfa - rustc_interface::passes::QueryContext::print_stats::hd29879a8b3af7832\r\n  50:     0x7ff87142957b - tracing_core::event::Event::metadata::h86572d73d587b6bd\r\n  51:     0x7ff8713ede67 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  52:     0x7ff871408ba6 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  53:     0x7ff871391614 - rustc_errors::snippet::MultilineAnnotation::increase_depth::h93baa802966d31ca\r\n  54:     0x7ff87142e53b - tracing_core::event::Event::metadata::h86572d73d587b6bd\r\n  55:     0x7ff871404a34 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  56:     0x7ff8713a074c - <rustc_driver::args::Error as core::fmt::Debug>::fmt::h500583d00d12c2d9\r\n  57:     0x7ff871406b28 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  58:     0x7ff8713e3a30 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  59:     0x7ff87140a123 - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h234a3cece69c9eed\r\n  60:     0x7ff871387523 - rustc_errors::snippet::MultilineAnnotation::increase_depth::h93baa802966d31ca\r\n  61:     0x7ff8c323f6a7 - std::sys::windows::thread::Thread::new::h04914a10b014a9d7\r\n  62:     0x7ff8dd03f5c4 - BaseThreadInitThunk\r\n  63:     0x7ff8df06a67b - RtlUserThreadStart\r\n```\r\n\r\n</p>\r\n</details>", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78135/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78135/timeline", "performed_via_github_app": null, "state_reason": "completed"}