{"url": "https://api.github.com/repos/rust-lang/rust/issues/65567", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65567/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65567/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65567/events", "html_url": "https://github.com/rust-lang/rust/issues/65567", "id": 509224134, "node_id": "MDU6SXNzdWU1MDkyMjQxMzQ=", "number": 65567, "title": "Unexpected FFI/C pointer behavior when MaybeUninit.assume_init() is stored in struct", "user": {"login": "parisholley", "id": 399289, "node_id": "MDQ6VXNlcjM5OTI4OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/399289?v=4", "gravatar_id": "", "url": "https://api.github.com/users/parisholley", "html_url": "https://github.com/parisholley", "followers_url": "https://api.github.com/users/parisholley/followers", "following_url": "https://api.github.com/users/parisholley/following{/other_user}", "gists_url": "https://api.github.com/users/parisholley/gists{/gist_id}", "starred_url": "https://api.github.com/users/parisholley/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/parisholley/subscriptions", "organizations_url": "https://api.github.com/users/parisholley/orgs", "repos_url": "https://api.github.com/users/parisholley/repos", "events_url": "https://api.github.com/users/parisholley/events{/privacy}", "received_events_url": "https://api.github.com/users/parisholley/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-10-18T17:42:55Z", "updated_at": "2019-10-18T19:47:01Z", "closed_at": "2019-10-18T18:08:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "While trying to determine the root cause of #65546 within my code, I am hitting what seems to be unexpected behavior of pointers being shared between Rust and C. I have taken some of the code from #65546 and simplified to the most simplest version possible (creating a replica of the C library behavior without all the extra stuff).\r\n\r\nAll of the code C + Rust can be found in this repo: https://github.com/parisholley/rust-ptrbug and is easy to reproduce running the two different cargo tests.\r\n\r\nAs someone who does not come from a C background and just starting to get into Rust, my understanding is that the C code should be free to mutate the object beneath the pointer at any time, and pointer that Rust holds on to should be valid throughout the lifetime of this example application.\r\n\r\nLooking at the test cases I put together to reproduce here:\r\n\r\nhttps://github.com/parisholley/rust-ptrbug/blob/af800045e84d84152b7e3808eb3483d5dd7caff0/src/lib.rs#L62-L84\r\n\r\nI can see no reasonable explanation as to why that macro would cause the pointer assertions `assert_engine` to fail after a single invocation of `do_get_release_worker`.\r\n\r\nTo be clear, I have zero use-case for actually having a println!() in my final code (I only discovered this via debugging), but if you follow the conversation in #65546, this same behavior is happening with CString (and possibly other code as well).", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65567/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65567/timeline", "performed_via_github_app": null, "state_reason": "completed"}