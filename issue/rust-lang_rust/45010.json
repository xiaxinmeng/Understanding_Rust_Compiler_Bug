{"url": "https://api.github.com/repos/rust-lang/rust/issues/45010", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/45010/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/45010/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/45010/events", "html_url": "https://github.com/rust-lang/rust/issues/45010", "id": 262592096, "node_id": "MDU6SXNzdWUyNjI1OTIwOTY=", "number": 45010, "title": "DW_TAG_formal_parameter always has DW_AT_decl_line == 1", "user": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-10-03T21:23:59Z", "updated_at": "2022-07-18T14:24:20Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "It seems that Rust debuginfo always writes `decl_line` of 1 for formal parameters.\r\n\r\nWith this `line.rs`:\r\n\r\n```rust\r\n#![crate_type = \"dylib\"] // line 1\r\npub fn foo( // 2\r\n    x: i32, // 3\r\n    y: i32) // 4\r\n    -> i32  // 5\r\n{ x + y }   // 6\r\n```\r\n\r\nWith:\r\n\r\n```\r\n$ rustc +nightly -Vv\r\nrustc 1.22.0-nightly (185cc5f26 2017-10-02)\r\nbinary: rustc\r\ncommit-hash: 185cc5f26d2c8a794189b028b43f6a3b8fc586db\r\ncommit-date: 2017-10-02\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.22.0-nightly\r\nLLVM version: 4.0\r\n```\r\n\r\nI get this output:\r\n\r\n```\r\n$ rustc +nightly -g line.rs\r\n$ dwgrep 'entry ?(@AT_name == \"foo\") child*' libline.so\r\n[2f]    subprogram\r\n        low_pc  0x42100\r\n        high_pc 66\r\n        frame_base      0..0xffffffffffffffff:0 reg6\r\n        linkage_name    \"_ZN4line3fooE\"\r\n        name    \"foo\"\r\n        decl_file       \"/tmp/line.rs\"\r\n        decl_line       2\r\n        type    [8c] base_type\r\n        external        true\r\n[4c]    formal_parameter\r\n        location        0..0xffffffffffffffff:0 fbreg <-16>\r\n        name    \"x\"\r\n        decl_file       \"/tmp/line.rs\"\r\n        decl_line       1\r\n        type    [8c] base_type\r\n[5a]    formal_parameter\r\n        location        0..0xffffffffffffffff:0 fbreg <-12>\r\n        name    \"y\"\r\n        decl_file       \"/tmp/line.rs\"\r\n        decl_line       1\r\n        type    [8c] base_type\r\n[68]    lexical_block\r\n        ranges  0x4210e..0x4212a, 0x4213a..0x42142\r\n[6d]    variable\r\n        location        0..0xffffffffffffffff:0 fbreg <-8>\r\n        name    \"x\"\r\n        decl_file       \"/tmp/line.rs\"\r\n        decl_line       3\r\n        type    [8c] base_type\r\n[7b]    variable\r\n        location        0..0xffffffffffffffff:0 fbreg <-4>\r\n        name    \"y\"\r\n        decl_file       \"/tmp/line.rs\"\r\n        decl_line       4\r\n        type    [8c] base_type\r\n```\r\n\r\nSo it describes the formal parameters of `x` and `y` both with line 1, but also describes local variables with the correct lines 3 and 4.\r\n\r\nIn LLVM IR it looks like this, with the wrong lines in `!10` and `!13`:\r\n\r\n```llvm\r\n$ rustc +nightly -g line.rs --emit=llvm-ir\r\n$ sed -n '/DIComp/,$p' line.ll\r\n!0 = distinct !DICompileUnit(language: DW_LANG_Rust, file: !1, producer: \"clang LLVM (rustc version 1.22.0-nightly (185cc5f26 2017-10-02))\", isOptimized: false, runtimeVersion: 0, emissionKind: FullDebug, enums: !2)\r\n!1 = !DIFile(filename: \"line.rs\", directory: \"/tmp\")\r\n!2 = !{}\r\n!3 = !{i32 2, !\"Debug Info Version\", i32 3}\r\n!4 = distinct !DISubprogram(name: \"foo\", linkageName: \"_ZN4line3fooE\", scope: !5, file: !1, line: 2, type: !7, isLocal: false, isDefinition: true, scopeLine: 2, flags: DIFlagPrototyped, isOptimized: false, unit: !0, templateParams: !2, variables: !2)\r\n!5 = !DINamespace(name: \"line\", scope: null, file: !6)\r\n!6 = !DIFile(filename: \"<unknown>\", directory: \"\")\r\n!7 = !DISubroutineType(types: !8)\r\n!8 = !{!9, !9, !9}\r\n!9 = !DIBasicType(name: \"i32\", size: 32, encoding: DW_ATE_signed)\r\n!10 = !DILocalVariable(name: \"x\", arg: 1, scope: !4, file: !1, line: 1, type: !9)\r\n!11 = !DIExpression()\r\n!12 = !DILocation(line: 1, scope: !4)\r\n!13 = !DILocalVariable(name: \"y\", arg: 2, scope: !4, file: !1, line: 1, type: !9)\r\n!14 = !DILocalVariable(name: \"x\", scope: !15, file: !1, line: 3, type: !9, align: 4)\r\n!15 = distinct !DILexicalBlock(scope: !4, file: !1, line: 6)\r\n!16 = !DILocation(line: 3, scope: !15)\r\n!17 = !DILocalVariable(name: \"y\", scope: !15, file: !1, line: 4, type: !9, align: 4)\r\n!18 = !DILocation(line: 4, scope: !15)\r\n!19 = !DILocation(line: 6, scope: !15)\r\n!20 = !DILocation(line: 6, scope: !4)\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/45010/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/45010/timeline", "performed_via_github_app": null, "state_reason": null}