{"url": "https://api.github.com/repos/rust-lang/rust/issues/77541", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77541/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77541/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77541/events", "html_url": "https://github.com/rust-lang/rust/issues/77541", "id": 714381593, "node_id": "MDU6SXNzdWU3MTQzODE1OTM=", "number": 77541, "title": "AVR: interrupt code broken by optimization flags", "user": {"login": "no111u3", "id": 1287609, "node_id": "MDQ6VXNlcjEyODc2MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1287609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/no111u3", "html_url": "https://github.com/no111u3", "followers_url": "https://api.github.com/users/no111u3/followers", "following_url": "https://api.github.com/users/no111u3/following{/other_user}", "gists_url": "https://api.github.com/users/no111u3/gists{/gist_id}", "starred_url": "https://api.github.com/users/no111u3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/no111u3/subscriptions", "organizations_url": "https://api.github.com/users/no111u3/orgs", "repos_url": "https://api.github.com/users/no111u3/repos", "events_url": "https://api.github.com/users/no111u3/events{/privacy}", "received_events_url": "https://api.github.com/users/no111u3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 267612997, "node_id": "MDU6TGFiZWwyNjc2MTI5OTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-unsound", "name": "I-unsound", "color": "e11d21", "default": false, "description": "Issue: A soundness hole (worst kind of bug), see: https://en.wikipedia.org/wiki/Soundness"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1884641928, "node_id": "MDU6TGFiZWwxODg0NjQxOTI4", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-AVR", "name": "O-AVR", "color": "6e6ec0", "default": false, "description": "Target: AVR processors (ATtiny, ATmega, etc.)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-04T19:12:07Z", "updated_at": "2023-02-19T06:41:43Z", "closed_at": "2023-02-19T06:41:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've run into an issue with code that uses interrupts on AVR. I'm not sure if this applies to any other platform.\r\nThis issue has same behavior as #75504 but It can't resolved after update compiler to current nightly version.\r\nThis issue reproduce on everything nightly rust compiler with AVR target support (I trying to compile it every nightly compiler updates).\r\n\r\nI create minimal reproduce project for this issue - https://github.com/no111u3/m328p_robo_rust. Than I change optimization flags to size optimization level `opt-level=\"z\"` or `opt-level=\"s\"` upper code doesn't work correctly, there has two options:\r\n - for release build there is broken in interrupt handler code\r\n - for debug build there is broken fully, code run stopped and mcu looks halted.\r\n\r\nI run upper code on two different mcu's that I have: on Atmega48 and Atmega328p, if we use same flags we have same behavior for run. For optimization level 2 I can use huge code in interrupt such as - https://github.com/no111u3/m48_robo_rust/blob/master/examples/dynamic_indication.rs#L119 but If I use `z` or `s` optimization interrupt works only for short code such as - https://github.com/no111u3/m48_robo_rust/blob/master/examples/pwm_int.rs#L39", "closed_by": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77541/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77541/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}