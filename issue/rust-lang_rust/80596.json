{"url": "https://api.github.com/repos/rust-lang/rust/issues/80596", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80596/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80596/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80596/events", "html_url": "https://github.com/rust-lang/rust/issues/80596", "id": 777341685, "node_id": "MDU6SXNzdWU3NzczNDE2ODU=", "number": 80596, "title": "Add different entry points for x.py", "user": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 630652267, "node_id": "MDU6TGFiZWw2MzA2NTIyNjc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-feature-request", "name": "C-feature-request", "color": "f5f1fd", "default": false, "description": "Category: A feature request, i.e: not implemented / a PR."}, {"id": 2345380158, "node_id": "MDU6TGFiZWwyMzQ1MzgwMTU4", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-contributor-roadblock", "name": "A-contributor-roadblock", "color": "f7e101", "default": false, "description": "Area: Makes things more difficult for new contributors to rust itself"}], "state": "closed", "locked": false, "assignee": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-01-01T19:48:25Z", "updated_at": "2021-01-01T20:10:39Z", "closed_at": "2021-01-01T20:10:39Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "## Summary\r\n\r\nAs shown by https://github.com/rust-lang/rust/issues/78466, https://internals.rust-lang.org/t/experience-report-contributing-to-rust-lang-rust/12012, and https://github.com/rust-lang/rust/issues/59864#issuecomment-753288723 have shown, people are still having trouble with bootstrapping even after the changes to defaults and the new explanations in the bootstrapping chapter of the dev-guide. Part of the issue is that x.py's job is inherently complicated, and that most of the commands are ambiguous once you take stages into account. It would be great to have smaller commands that are focused on specific groups of contributors, so you can choose the build steps unambiguously and give helpful errors when they don't make sense.\r\n\r\n## Proposed Solution\r\n\r\nHave an `x.py` in many *different* directories that has settings for that directory. For example, `library/x.py build` would be the same as `x.py build library/test --stage 0` today, and `library/x.py doc` would be the same as `x.py doc --stage 0 library/std` today. For other more complicated tools, the defaults would be different: `src/tools/rustdoc/x.py doc` would be the same as `x.py doc --stage 1`, `compiler/x.py build` would be the same as `x.py build --stage 1 library/std`.\r\n\r\nThese are the entrypoints I propose:\r\n\r\n```\r\n.\r\n\u251c\u2500\u2500 compiler\r\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rustc\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 x.py\r\n\u251c\u2500\u2500 library\r\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 std\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 x.py\r\n\u251c\u2500\u2500 Makefile\r\n\u251c\u2500\u2500 src\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 tools\r\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 rustdoc\r\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 x.py\r\n\u2514\u2500\u2500 x.py\r\n```\r\n\r\nThe top-level x.py would still be the same as it is today.\r\n\r\nFor library/ especially, I think this would be a low-maintenance, high-impact way to greatly simplify the build process.", "closed_by": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80596/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80596/timeline", "performed_via_github_app": null, "state_reason": "completed"}