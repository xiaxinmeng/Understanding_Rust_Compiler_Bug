{"url": "https://api.github.com/repos/rust-lang/rust/issues/33287", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/33287/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/33287/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/33287/events", "html_url": "https://github.com/rust-lang/rust/issues/33287", "id": 152012539, "node_id": "MDU6SXNzdWUxNTIwMTI1Mzk=", "number": 33287, "title": "Panic on constant index out of bounds in range expression", "user": {"login": "nskinkel", "id": 5032791, "node_id": "MDQ6VXNlcjUwMzI3OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5032791?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nskinkel", "html_url": "https://github.com/nskinkel", "followers_url": "https://api.github.com/users/nskinkel/followers", "following_url": "https://api.github.com/users/nskinkel/following{/other_user}", "gists_url": "https://api.github.com/users/nskinkel/gists{/gist_id}", "starred_url": "https://api.github.com/users/nskinkel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nskinkel/subscriptions", "organizations_url": "https://api.github.com/users/nskinkel/orgs", "repos_url": "https://api.github.com/users/nskinkel/repos", "events_url": "https://api.github.com/users/nskinkel/events{/privacy}", "received_events_url": "https://api.github.com/users/nskinkel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-04-30T05:59:20Z", "updated_at": "2017-04-27T02:48:26Z", "closed_at": "2017-04-27T02:48:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Summary\n\n`rustc` 1.9.0-beta.1 panics when a constant index expression is out of bounds in a range expression.\n#### Minimal Code to Reproduce\n\n``` rust\nconst A: [u32; 1] = [0];\n\nfn test() {\n    let range = A[1]..; // <- note range\n}\n```\n#### Expected Behavior\n\nCompilation failure and exit (without a panic). `rustc` 1.8.0 catches this properly without panicking:\n\n```\nsrc/lib.rs:4:14: 4:18 error: const index-expr is out of bounds [E0515]\nsrc/lib.rs:4    let range = A[1]..;\n                            ^~~~\nsrc/lib.rs:4:14: 4:18 help: run `rustc --explain E0515` to see a detailed explanation\nerror: aborting due to previous error\nCould not compile `rustc-bug`.\n```\n#### Actual Behavior\n\n`rustc` 1.9.0-beta.1 also catches the error but then immediately panics:\n\n```\nsrc/lib.rs:4:14: 4:18 error: const index-expr is out of bounds [E0515]\nsrc/lib.rs:4    let range = A[1]..;\n                            ^~~~\nsrc/lib.rs:4:14: 4:18 help: run `rustc --explain E0515` to see a detailed explanation\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'assertion failed: !is_undef(val)', ../src/librustc_trans/adt.rs:1442\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n\nerror: Could not compile `rustc-bug`.\n\nTo learn more, run the command again with --verbose.\n```\n## Meta\n#### rustc version\n\n```\nrustc 1.9.0-beta.1 (37a2869af 2016-04-12)\nbinary: rustc\ncommit-hash: 37a2869afa7eb0813becaf0070874806030052df\ncommit-date: 2016-04-12\nhost: x86_64-unknown-linux-gnu\nrelease: 1.9.0-beta.1\n```\n#### Backtrace\n\n```\nthread 'rustc' panicked at 'assertion failed: !is_undef(val)', ../src/librustc_trans/adt.rs:1442\nstack backtrace:\n   1:     0x7fd7dbc0b8f0 - std::sys::backtrace::tracing::imp::write::h25f26530b3b48a54\n   2:     0x7fd7dbc18feb - std::panicking::default_hook::_$u7b$$u7b$closure$u7d$$u7d$::hb497e646e4148afc\n   3:     0x7fd7dbc18b8c - std::panicking::default_hook::hd57825f8b5247927\n   4:     0x7fd7dbbdd94f - std::sys_common::unwind::begin_unwind_inner::hf40013815c474ad4\n   5:     0x7fd7dab6462f - std::sys_common::unwind::begin_unwind::h92dcc321186dc34c\n   6:     0x7fd7daba4364 - rustc_trans::adt::build_const_struct::h7c2193a6829ece18\n   7:     0x7fd7daba324b - rustc_trans::adt::trans_const::hef58b8dec6cea773\n   8:     0x7fd7dac277e2 - rustc_trans::consts::const_expr_unadjusted::h2a808f520395dbc1\n   9:     0x7fd7dac236f5 - rustc_trans::consts::const_expr::hd1077cfffb24f3fd\n  10:     0x7fd7dac25d9a - rustc_trans::consts::const_expr_unadjusted::h2a808f520395dbc1\n  11:     0x7fd7dac236f5 - rustc_trans::consts::const_expr::hd1077cfffb24f3fd\n  12:     0x7fd7dac24bed - rustc_trans::consts::get_const_expr_as_global::h461bf6e23752d380\n  13:     0x7fd7dabd2491 - rustc_trans::expr::trans_into::hec8593fa54ef6bb1\n  14:     0x7fd7dac9541d - rustc_trans::_match::mk_binding_alloca::h371f10e5648554d4\n  15:     0x7fd7dabb466d - rustc_trans::base::init_local::hfca9341188244db9\n  16:     0x7fd7dabca274 - rustc_trans::controlflow::trans_block::h1af7b1b31248e1b6\n  17:     0x7fd7dabc8ac5 - rustc_trans::base::trans_closure::h5d45bbd73c3a7a78\n  18:     0x7fd7dabcaca5 - rustc_trans::base::trans_fn::h402b71919a8efd00\n  19:     0x7fd7dabd52a1 - rustc_trans::base::trans_item::ha1b4ec4be38cfb98\n  20:     0x7fd7dabedc9b - _<base..TransItemsWithinModVisitor<'a, 'tcx> as rustc..hir..intravisit..Visitor<'v>>::visit_item::h28deed87cec6b591\n  21:     0x7fd7dabdc12b - rustc_trans::base::trans_crate::hb76ff2cab32def4b\n  22:     0x7fd7dc16607f - rustc_driver::driver::phase_4_translate_to_llvm::h4ddb9e99a379fd22\n  23:     0x7fd7dc16477b - rustc_driver::driver::compile_input::_$u7b$$u7b$closure$u7d$$u7d$::h055be3d7512cb25b\n  24:     0x7fd7dc1610f0 - rustc_driver::driver::phase_3_run_analysis_passes::_$u7b$$u7b$closure$u7d$$u7d$::h8b22036e53339e21\n  25:     0x7fd7dc15abcb - rustc::ty::context::TyCtxt::create_and_enter::h46f82c7d33538844\n  26:     0x7fd7dc15767e - rustc_driver::driver::phase_3_run_analysis_passes::ha8983b62bc1b2b22\n  27:     0x7fd7dc129ecf - rustc_driver::driver::compile_input::h03d180f0197cc850\n  28:     0x7fd7dc110414 - rustc_driver::run_compiler::he6931cc1e4c34ecf\n  29:     0x7fd7dc10d871 - std::sys_common::unwind::try::try_fn::h4268a1ea4d20bd31\n  30:     0x7fd7dbc0908b - __rust_try\n  31:     0x7fd7dbc0901d - std::sys_common::unwind::inner_try::h03f2e7dcfdd826c0\n  32:     0x7fd7dc10e0ba - _<F as std..boxed..FnBox<A>>::call_box::h570318fe7233955a\n  33:     0x7fd7dbc17184 - std::sys::thread::Thread::new::thread_start::h42a605e44c815beb\n  34:     0x7fd7d462a453 - start_thread\n  35:     0x7fd7db873edc - clone\n  36:                0x0 - <unknown>\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/33287/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/33287/timeline", "performed_via_github_app": null, "state_reason": "completed"}