{"url": "https://api.github.com/repos/rust-lang/rust/issues/86738", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/86738/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/86738/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/86738/events", "html_url": "https://github.com/rust-lang/rust/issues/86738", "id": 933306481, "node_id": "MDU6SXNzdWU5MzMzMDY0ODE=", "number": 86738, "title": "Adding `From` instances can make previously valid programs fail type inference", "user": {"login": "jay-invariant", "id": 75544809, "node_id": "MDQ6VXNlcjc1NTQ0ODA5", "avatar_url": "https://avatars.githubusercontent.com/u/75544809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jay-invariant", "html_url": "https://github.com/jay-invariant", "followers_url": "https://api.github.com/users/jay-invariant/followers", "following_url": "https://api.github.com/users/jay-invariant/following{/other_user}", "gists_url": "https://api.github.com/users/jay-invariant/gists{/gist_id}", "starred_url": "https://api.github.com/users/jay-invariant/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jay-invariant/subscriptions", "organizations_url": "https://api.github.com/users/jay-invariant/orgs", "repos_url": "https://api.github.com/users/jay-invariant/repos", "events_url": "https://api.github.com/users/jay-invariant/events{/privacy}", "received_events_url": "https://api.github.com/users/jay-invariant/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2352122097, "node_id": "MDU6TGFiZWwyMzUyMTIyMDk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-discussion", "name": "C-discussion", "color": "f5f1fd", "default": false, "description": "Category: Discussion or questions that doesn't represent real issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-06-30T04:58:48Z", "updated_at": "2021-06-30T16:40:05Z", "closed_at": "2021-06-30T11:35:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Minimal example\r\n\r\nThis works:\r\n```rust\r\nstruct Foo;\r\n\r\nfn foo() -> Result<(), Foo> {\r\n    let inner = || {\r\n        Err(Foo)?;\r\n        Ok(())\r\n    };\r\n    inner()?;\r\n    Ok(())\r\n}\r\n```\r\n\r\nNow add the following:\r\n```rust\r\nstruct Bar;\r\n\r\nimpl From<Foo> for Bar {\r\n    fn from(_: Foo) -> Bar {\r\n        Bar\r\n    }\r\n}\r\n\r\nimpl From<Bar> for Foo {\r\n    fn from(_: Bar) -> Foo {\r\n        Foo\r\n    }\r\n}\r\n```\r\n\r\nThis causes compilation to fail with:\r\n```\r\nerror[E0282]: type annotations needed for the closure `fn() -> std::result::Result<(), _>`\r\n  --> test.rs:19:17\r\n   |\r\n19 |         Err(Foo)?;\r\n   |                 ^ cannot infer type\r\n   |\r\nhelp: give this closure an explicit return type without `_` placeholders\r\n   |\r\n18 |     let inner = || -> std::result::Result<(), _> {\r\n   |  \r\n```\r\n\r\nThe problem is that these pieces of code can be in completely different crates.  In my opinion, the first snippet should also fail, since it can be broken by seemingly innocent changes in dependencies.  More generally, the compiler should not assume that \"there's only one type I know of that would work here\" means we can actually infer that type, since changes in dependencies might add more candidates.", "closed_by": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/86738/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/86738/timeline", "performed_via_github_app": null, "state_reason": "completed"}