{"url": "https://api.github.com/repos/rust-lang/rust/issues/18107", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18107/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18107/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18107/events", "html_url": "https://github.com/rust-lang/rust/issues/18107", "id": 46048262, "node_id": "MDU6SXNzdWU0NjA0ODI2Mg==", "number": 18107, "title": "ICE when returning trait by-value", "user": {"login": "yuriks", "id": 341401, "node_id": "MDQ6VXNlcjM0MTQwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/341401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuriks", "html_url": "https://github.com/yuriks", "followers_url": "https://api.github.com/users/yuriks/followers", "following_url": "https://api.github.com/users/yuriks/following{/other_user}", "gists_url": "https://api.github.com/users/yuriks/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuriks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuriks/subscriptions", "organizations_url": "https://api.github.com/users/yuriks/orgs", "repos_url": "https://api.github.com/users/yuriks/repos", "events_url": "https://api.github.com/users/yuriks/events{/privacy}", "received_events_url": "https://api.github.com/users/yuriks/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-10-16T23:37:56Z", "updated_at": "2014-10-19T23:27:15Z", "closed_at": "2014-10-19T23:27:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code causes an ICE:\n\n``` rust\npub trait AbstractRenderer {}\n\nfn _create_render(_: &()) -> AbstractRenderer {\n    match 0u {\n        _ => unimplemented!()\n    }\n}\n\nfn main() {\n}\n```\n\n```\nerror: internal compiler error: trying to take the sizing type of AbstractRenderer, an unsized type\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /home/rustbuild/src/rust-buildbot/slave/nightly-linux/build/src/libsyntax/diagnostic.rs:169\n\nstack backtrace:\n   1:     0x7ff0cb624510 - rt::backtrace::imp::write::hdbb48f4c53a7cc60gDq\n   2:     0x7ff0cb627640 - failure::on_fail::h664e14eeb2ff8c0bDYq\n   3:     0x7ff0cbdc68b0 - unwind::begin_unwind_inner::h56f904cfbaefac03Gxd\n   4:     0x7ff0c7d23d00 - unwind::begin_unwind::h3274104174448703340\n   5:     0x7ff0c7d243e0 - diagnostic::Handler::bug::h1e32cdde49e6b788hRF\n   6:     0x7ff0cc597a70 - middle::trans::type_of::sizing_type_of::h84c9c04a390ab352vra\n   7:     0x7ff0cc584830 - middle::trans::controlflow::trans_block::h82c14c3960cf3218lGZ\n   8:     0x7ff0cc634f60 - middle::trans::base::trans_closure::h1124c66088a31168XBf\n   9:     0x7ff0cc576340 - middle::trans::base::trans_fn::h857e35768e8962d1lNf\n  10:     0x7ff0cc5739a0 - middle::trans::base::trans_item::h0a9a277363bc9736E6f\n  11:     0x7ff0cc640520 - middle::trans::base::trans_crate::hd70672a3161c49aaa5g\n  12:     0x7ff0cca918b0 - driver::driver::phase_4_translate_to_llvm::hab1a6d4c1e3d8a4cvFx\n  13:     0x7ff0cca87bb0 - driver::driver::compile_input::h6e2a623e71c52de1qcx\n  14:     0x7ff0ccb12b00 - driver::run_compiler::h5364c643a9540453J0A\n  15:     0x7ff0ccb129b0 - driver::run::closure.147480\n  16:     0x7ff0cc1dad50 - task::TaskBuilder<S>::try_future::closure.101591\n  17:     0x7ff0cc1dab30 - task::TaskBuilder<S>::spawn_internal::closure.101562\n  18:     0x7ff0cd381a30 - task::spawn_opts::closure.8447\n  19:     0x7ff0cbe20820 - rust_try_inner\n  20:     0x7ff0cbe20810 - rust_try\n  21:     0x7ff0cbdc4170 - unwind::try::hc8fa40147cc0bedbomd\n  22:     0x7ff0cbdc3ff0 - task::Task::run::h67469f5b91c0b2922Bc\n  23:     0x7ff0cd381770 - task::spawn_opts::closure.8387\n  24:     0x7ff0cbdc58c0 - thread::thread_start::he00c50880746ce61dWc\n  25:     0x7ff0cb0ec250 - start_thread\n  26:     0x7ff0cba9e3b9 - clone\n  27:                0x0 - <unknown>\n```\n\nRemoving the parameter or changing it to be a value instead of a reference stops the crash with an error saying I need to specify a lifetime, which makes me think this is a problem related to inferred lifetimes.\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18107/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18107/timeline", "performed_via_github_app": null, "state_reason": "completed"}