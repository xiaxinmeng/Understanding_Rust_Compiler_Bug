{"url": "https://api.github.com/repos/rust-lang/rust/issues/34703", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/34703/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/34703/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/34703/events", "html_url": "https://github.com/rust-lang/rust/issues/34703", "id": 164328382, "node_id": "MDU6SXNzdWUxNjQzMjgzODI=", "number": 34703, "title": "A call to BufReader<File>::lines().count() on a non-read opened file in Linux never returns.", "user": {"login": "joelself", "id": 910662, "node_id": "MDQ6VXNlcjkxMDY2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/910662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joelself", "html_url": "https://github.com/joelself", "followers_url": "https://api.github.com/users/joelself/followers", "following_url": "https://api.github.com/users/joelself/following{/other_user}", "gists_url": "https://api.github.com/users/joelself/gists{/gist_id}", "starred_url": "https://api.github.com/users/joelself/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joelself/subscriptions", "organizations_url": "https://api.github.com/users/joelself/orgs", "repos_url": "https://api.github.com/users/joelself/repos", "events_url": "https://api.github.com/users/joelself/events{/privacy}", "received_events_url": "https://api.github.com/users/joelself/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-07-07T14:51:32Z", "updated_at": "2023-03-18T15:11:25Z", "closed_at": "2023-03-18T15:11:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "Not much to it. I have this bit of code:\n\n``` rust\nfn get_line_count(file_name: String) -> Result<usize, Error> {\n    let file = try!(OpenOptions::new().append(true).create(true).open(&file_name));\n    let f = BufReader::new(file);\n    Ok(f.lines().count())\n}\n```\n\nAnd I'm passing in a file that exists, but is empty (actually, by the timestamp, the file probably didn't exist until the first line in the function created it):\n\n``` bash\nls -la new_chunks.txt \n-rw-rw-r-- 1 joel joel 0 Jul  7 07:38 new_chunks.txt\n```\n\nMy program wasn't going anywhere, but it was using up 100% of one core. Some `println`s later and I found that it couldn't get past `Ok(f.lines().count())`. Specifically it was the call to `count()` that wasn't returning.\n\nThis is Ubuntu 14.04. `rustup show`:\n\n``` bash\nactive toolchain\n----------------\n\nstable-x86_64-unknown-linux-gnu (default)\nrustc 1.9.0 (e4e8b6668 2016-05-18)\n```\n\nEdit: This was running in release mode, but I confirmed it in debug mode too. I also tried the current beta and nightly channels in release and debug mode:\n\n``` bash\nbeta-x86_64-unknown-linux-gnu (directory override for '/home/joel/dirname/dirname/project')\nrustc 1.11.0-beta.1 (8dc253bcf 2016-07-05)\n\nnightly-x86_64-unknown-linux-gnu (directory override for '/home/joel/dirname/dirname/project')\nrustc 1.11.0-nightly (696b703b5 2016-07-03)\n```\n", "closed_by": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/34703/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/34703/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}