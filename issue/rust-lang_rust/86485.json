{"url": "https://api.github.com/repos/rust-lang/rust/issues/86485", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/86485/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/86485/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/86485/events", "html_url": "https://github.com/rust-lang/rust/issues/86485", "id": 925569570, "node_id": "MDU6SXNzdWU5MjU1Njk1NzA=", "number": 86485, "title": "Actual crate name of renamed crate is leaked through unexpected type error", "user": {"login": "r00ster91", "id": 35064754, "node_id": "MDQ6VXNlcjM1MDY0NzU0", "avatar_url": "https://avatars.githubusercontent.com/u/35064754?v=4", "gravatar_id": "", "url": "https://api.github.com/users/r00ster91", "html_url": "https://github.com/r00ster91", "followers_url": "https://api.github.com/users/r00ster91/followers", "following_url": "https://api.github.com/users/r00ster91/following{/other_user}", "gists_url": "https://api.github.com/users/r00ster91/gists{/gist_id}", "starred_url": "https://api.github.com/users/r00ster91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/r00ster91/subscriptions", "organizations_url": "https://api.github.com/users/r00ster91/orgs", "repos_url": "https://api.github.com/users/r00ster91/repos", "events_url": "https://api.github.com/users/r00ster91/events{/privacy}", "received_events_url": "https://api.github.com/users/r00ster91/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1624891239, "node_id": "MDU6TGFiZWwxNjI0ODkxMjM5", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-incorrect", "name": "D-incorrect", "color": "c9f7a3", "default": false, "description": "A diagnostic that is giving misleading or incorrect information"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-06-20T10:37:53Z", "updated_at": "2021-06-21T06:19:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "1. `cargo new issue_86485`\r\n2. Add this to the `Cargo.toml`'s `dependencies` section:\r\n\r\n    ```toml\r\n    json = { version = \"*\", package = \"serde_json\" }\r\n    ```\r\n    Note that [`serde_json`](https://crates.io/crates/serde_json) is here renamed to `json` for the project.\r\n3. Make this your `main.rs`:\r\n\r\n    ```rs\r\n    enum Value {}\r\n\r\n    fn main() {\r\n        let value: Value = json::Value::Null;\r\n    }\r\n    ```\r\n\r\nThe current output is:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n --> src/main.rs:4:24\r\n  |\r\n4 |     let value: Value = json::Value::Null;\r\n  |                -----   ^^^^^^^^^^^^^^^^^ expected enum `Value`, found enum `serde_json::Value`\r\n  |                |\r\n  |                expected due to this\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\nerror: could not compile `issue_86485`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nNote that it says this:\r\n\r\n> expected enum `Value`, found enum `serde_json::Value`\r\n\r\nInstead of this:\r\n\r\n> expected enum `Value`, found enum `json::Value`\r\n\r\nIt leaks the actual crate name (`serde_json`) instead of using the user's desired name (`json`) for the crate. \r\n\r\nIdeally the output should look like:\r\n\r\n```\r\nerror[E0308]: mismatched types\r\n --> src/main.rs:4:24\r\n  |\r\n4 |     let value: Value = json::Value::Null;\r\n  |                -----   ^^^^^^^^^^^^^^^^^ expected enum `Value`, found enum `json::Value`\r\n  |                |\r\n  |                expected due to this\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0308`.\r\nerror: could not compile `issue_86485`\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\nThanks to @ehuss for providing this reproduction. They also noted that:\r\n> I think in this particular case, E0308 tries to shorten the path if it is unambiguous, and I suspect it is that path shortening which uses the \"real\" crate name instead of the resolve-based name. I see other errors use the resolve path. Since this is done in typechecking, I'm not sure if the resolver information is readily available, though. \r\n<!--\r\nIf the problem is not self-explanatory, please provide a rationale for the\r\nchange.\r\n-->\r\n\r\n<!--\r\nIf dramatically different output is caused by small changes, consider also\r\nadding them here.\r\n\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions. The output might also be\r\ndifferent depending on the Edition.\r\n-->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/86485/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/86485/timeline", "performed_via_github_app": null, "state_reason": null}