{"url": "https://api.github.com/repos/rust-lang/rust/issues/89475", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89475/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89475/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89475/events", "html_url": "https://github.com/rust-lang/rust/issues/89475", "id": 1014172522, "node_id": "I_kwDOAAsO6M48cwtq", "number": 89475, "title": "Splitting up `compiletest::runtest`", "user": {"login": "Nicholas-Baron", "id": 35079404, "node_id": "MDQ6VXNlcjM1MDc5NDA0", "avatar_url": "https://avatars.githubusercontent.com/u/35079404?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nicholas-Baron", "html_url": "https://github.com/Nicholas-Baron", "followers_url": "https://api.github.com/users/Nicholas-Baron/followers", "following_url": "https://api.github.com/users/Nicholas-Baron/following{/other_user}", "gists_url": "https://api.github.com/users/Nicholas-Baron/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nicholas-Baron/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nicholas-Baron/subscriptions", "organizations_url": "https://api.github.com/users/Nicholas-Baron/orgs", "repos_url": "https://api.github.com/users/Nicholas-Baron/repos", "events_url": "https://api.github.com/users/Nicholas-Baron/events{/privacy}", "received_events_url": "https://api.github.com/users/Nicholas-Baron/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37234, "node_id": "MDU6TGFiZWwzNzIzNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-cleanup", "name": "C-cleanup", "color": "f5f1fd", "default": false, "description": "Category: PRs that clean code up or issues documenting cleanup."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-10-02T21:10:43Z", "updated_at": "2021-10-11T20:33:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Subtask to #60302.\r\n\r\n- [ ] RunPassValgrind is practically useless (valgrind is not installed on CI, and the tests are just run in run-pass mode). The right approach here is likely to refactor it as a modifier atop the regular run-pass tests -- it looks like the code generally just mirrors the RunPass mode, other than setting the runtool to valgrind. That mode can be enabled in the configuration of the test with `// use-valgrind` or something like that.\r\n- [x] Move diff computation out into a separate module (DiffLine, Mismatch, make_diff, ...)\r\n- [x] Move read2_abbreviated to the read2.rs module\r\n- [x] Move DebuggerCommands and their parsing out to a separate file, alongside check_debugger_output (which is similarly parsing code).\r\n\r\nI suspect this set of changes is likely harder, and might not get to <3000 lines; there's likely more cleanup work possible, though. This module has grown pretty organically over the last ~10 years -- there's a lot of small bits that can be adjusted to make things better. There's probably also subtle inconsistencies between various functions that would likely be nice to clean up and unify, and filing PRs for those would be helpful -- likely some care is needed, perhaps even some small test updates, but overall a good goal.\r\n\r\nYou might also be interested in https://github.com/rust-lang/rust/issues/40713, as a somewhat larger project.\r\n\r\n_Originally posted by @Mark-Simulacrum in https://github.com/rust-lang/rust/issues/89240#issuecomment-932658341_", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89475/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89475/timeline", "performed_via_github_app": null, "state_reason": null}