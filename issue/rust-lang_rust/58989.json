{"url": "https://api.github.com/repos/rust-lang/rust/issues/58989", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/58989/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/58989/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/58989/events", "html_url": "https://github.com/rust-lang/rust/issues/58989", "id": 418223606, "node_id": "MDU6SXNzdWU0MTgyMjM2MDY=", "number": 58989, "title": "PathBuf::exists() consider all paths existing on MacOS 10.14.3 w/ AFS", "user": {"login": "valeriansaliou", "id": 1451907, "node_id": "MDQ6VXNlcjE0NTE5MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1451907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/valeriansaliou", "html_url": "https://github.com/valeriansaliou", "followers_url": "https://api.github.com/users/valeriansaliou/followers", "following_url": "https://api.github.com/users/valeriansaliou/following{/other_user}", "gists_url": "https://api.github.com/users/valeriansaliou/gists{/gist_id}", "starred_url": "https://api.github.com/users/valeriansaliou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/valeriansaliou/subscriptions", "organizations_url": "https://api.github.com/users/valeriansaliou/orgs", "repos_url": "https://api.github.com/users/valeriansaliou/repos", "events_url": "https://api.github.com/users/valeriansaliou/events{/privacy}", "received_events_url": "https://api.github.com/users/valeriansaliou/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-03-07T10:03:02Z", "updated_at": "2019-03-07T10:31:40Z", "closed_at": "2019-03-07T10:31:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Calling PathBuf::exists() on a sub-folder of an existing path will always return `true`, even if the sub-folder does not exist (as seen by Finder and `ls`). This also applies to PathBuf::is_dir() and PathBuf::is_file(). Even weirder, PathBuf::metadata() returns actual meta-data for the non-existant path.\r\n\r\nIn my setup: target relative path is `./data/store/kv/collection/`; the collection folder does not exist, but `./data/store/kv/` does. Rust reports the `./data/store/kv/collection` path as existing. I even tried checking if a sub-file exists (which does not on my fs): `./data/store/kv/collection/FILE`, and Rust also reports the path as existing.\r\n\r\nI tried this code:\r\n\r\n```\r\nlet collection = \"collection\";\r\nlet collection_path = APP_CONF.store.kv.path.join(collection);\r\n\r\nif collection_path.exists() == true {\r\n  debug!(\"collection store exists, erasing collection: {} at path: {:?}\", collection, collection_path);\r\n\r\n  // <code>\r\n}\r\n```\r\n\r\nI expected to see this happen: `collection_path.exists()` should be `false` (path does not exist)\r\nInstead, this happened: `collection_path.exists()` was `true` (but the actual path does not exist)\r\n\r\nA log print of `collection_path` with the `debug!()` line shows log:\r\n\r\n```\r\n(DEBUG) - collection store exists, erasing collection: d at path: \"./data/store/kv/collection\"\r\n```\r\n\r\n## Meta\r\n\r\nrustc --version --verbose:\r\n\r\n```\r\nrustc 1.35.0-nightly (f22dca0a1 2019-03-05)\r\nbinary: rustc\r\ncommit-hash: f22dca0a1bef4141e75326caacc3cd59f3d5be8e\r\ncommit-date: 2019-03-05\r\nhost: x86_64-apple-darwin\r\nrelease: 1.35.0-nightly\r\nLLVM version: 8.0\r\n```\r\n\r\nMacOS:\r\n\r\n- Mojave 10.14.3 (18D109)\r\n- AFS file system", "closed_by": {"login": "valeriansaliou", "id": 1451907, "node_id": "MDQ6VXNlcjE0NTE5MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/1451907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/valeriansaliou", "html_url": "https://github.com/valeriansaliou", "followers_url": "https://api.github.com/users/valeriansaliou/followers", "following_url": "https://api.github.com/users/valeriansaliou/following{/other_user}", "gists_url": "https://api.github.com/users/valeriansaliou/gists{/gist_id}", "starred_url": "https://api.github.com/users/valeriansaliou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/valeriansaliou/subscriptions", "organizations_url": "https://api.github.com/users/valeriansaliou/orgs", "repos_url": "https://api.github.com/users/valeriansaliou/repos", "events_url": "https://api.github.com/users/valeriansaliou/events{/privacy}", "received_events_url": "https://api.github.com/users/valeriansaliou/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/58989/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/58989/timeline", "performed_via_github_app": null, "state_reason": "completed"}