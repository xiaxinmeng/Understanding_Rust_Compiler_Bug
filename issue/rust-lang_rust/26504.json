{"url": "https://api.github.com/repos/rust-lang/rust/issues/26504", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26504/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26504/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26504/events", "html_url": "https://github.com/rust-lang/rust/issues/26504", "id": 90151971, "node_id": "MDU6SXNzdWU5MDE1MTk3MQ==", "number": 26504, "title": "Panic on accessing codemap of size 0", "user": {"login": "cassiersg", "id": 9348542, "node_id": "MDQ6VXNlcjkzNDg1NDI=", "avatar_url": "https://avatars.githubusercontent.com/u/9348542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cassiersg", "html_url": "https://github.com/cassiersg", "followers_url": "https://api.github.com/users/cassiersg/followers", "following_url": "https://api.github.com/users/cassiersg/following{/other_user}", "gists_url": "https://api.github.com/users/cassiersg/gists{/gist_id}", "starred_url": "https://api.github.com/users/cassiersg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cassiersg/subscriptions", "organizations_url": "https://api.github.com/users/cassiersg/orgs", "repos_url": "https://api.github.com/users/cassiersg/repos", "events_url": "https://api.github.com/users/cassiersg/events{/privacy}", "received_events_url": "https://api.github.com/users/cassiersg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-06-22T16:51:22Z", "updated_at": "2015-09-21T23:26:42Z", "closed_at": "2015-09-21T23:26:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using `rustc_driver::run_compiler([\"empty_file.rs\"], ...)`, the compilation is stopped after parsing.\nThe codemap is retrieved, and the call to `lookup_char_pos` panics when we visit the AST:\n\n``` rust\nimpl visit::Visitor for FmtVisitor {\n    fn visit_mod(&mut self, m: &'v ast::Mod, s: Span, _: ast::NodeId) {\n        if self codemap.lookup_char_pos(s.lo).file.name\n[...]\n```\n\nI'm wondering if it's an unexpected behavior or if this situation violates an invariant of codemap.\n\nBacktrace:\n\n```\nthread '<main>' panicked at 'position 0 does not resolve to a source location', ../src/libsyntax/codemap.rs:908\nstack backtrace:\n   1:     0x7fb91319f92e - sys::backtrace::write::he24e072826f78dbbpqs\n   2:     0x7fb9131a79ec - panicking::on_panic::hfe8dee88ad5f1f8f69w\n   3:     0x7fb91316a53e - rt::unwind::begin_unwind_inner::h30a8282e6074626cKPw\n   4:     0x7fb91316b26c - rt::unwind::begin_unwind_fmt::h0d67ce05a74a7ba4QOw\n   5:     0x7fb913987313 - codemap::CodeMap::lookup_filemap_idx::hdb5a6d4b9a382f2by4z\n   6:     0x7fb913986e11 - codemap::CodeMap::lookup_char_pos::hcfccdd83504b914fJJz\n   7:     0x7fb9152b24c8 - visitor::FmtVisitor<'a>.visit..Visitor<'v>::visit_mod::hb8cb15535f0f5ffbZUa\n                        at /home/cassiersg/rustfmt/src/visitor.rs:249\n   8:     0x7fb9152f174b - visit::walk_crate::h11272277405317629321\n                        at ../src/libsyntax/visit.rs:152\n   9:     0x7fb9152f1489 - fmt_ast::h0042e145cf43e2281Jd\n                        at /home/cassiersg/rustfmt/src/lib.rs:165\n  10:     0x7fb9152fbc3d - RustFmtCalls.CompilerCalls<'a>::build_controller::closure.12943\n                        at /home/cassiersg/rustfmt/src/lib.rs:309\n  11:     0x7fb914ce8a88 - driver::compile_input::hc2338ec138000972Tba\n  12:     0x7fb914dc67d3 - run_compiler::h64b107044b742926x7b\n  13:     0x7fb9152fc5d2 - run::h1118ec9f2f6cbfc82Wd\n                        at /home/cassiersg/rustfmt/src/lib.rs:340\n  14:     0x7fb91525a5c3 - main::h78aa2f0fe725515fkaa\n                        at bin/rustfmt.rs:27\n  15:     0x7fb91321f758 - rust_try_inner\n  16:     0x7fb91321f745 - rust_try\n  17:     0x7fb9131a9527 - rt::lang_start::hdadb5fc58c5eeff334w\n  18:     0x7fb91526159b - main\n  19:     0x7fb91282078f - __libc_start_main\n  20:     0x7fb91525a2a8 - _start\n  21:                0x0 - <unknown>\n```\n\nrustc:\n\n```\n$ rustc --version --verbose\nrustc 1.2.0-nightly (9ad0063a1 2015-06-20)\nbinary: rustc\ncommit-hash: 9ad0063a1772edca3299e2dc76187bbfa74e8b16\ncommit-date: 2015-06-20\nhost: x86_64-unknown-linux-gnu\nrelease: 1.2.0-nightly\n```\n\ncc nrc/rustfmt#115\n", "closed_by": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26504/timeline", "performed_via_github_app": null, "state_reason": "completed"}