{"url": "https://api.github.com/repos/rust-lang/rust/issues/26591", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26591/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26591/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26591/events", "html_url": "https://github.com/rust-lang/rust/issues/26591", "id": 91209293, "node_id": "MDU6SXNzdWU5MTIwOTI5Mw==", "number": 26591, "title": "[MSVC] Referencing a static from another crate doesn't seem to work", "user": {"login": "tomaka", "id": 1412254, "node_id": "MDQ6VXNlcjE0MTIyNTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1412254?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tomaka", "html_url": "https://github.com/tomaka", "followers_url": "https://api.github.com/users/tomaka/followers", "following_url": "https://api.github.com/users/tomaka/following{/other_user}", "gists_url": "https://api.github.com/users/tomaka/gists{/gist_id}", "starred_url": "https://api.github.com/users/tomaka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tomaka/subscriptions", "organizations_url": "https://api.github.com/users/tomaka/orgs", "repos_url": "https://api.github.com/users/tomaka/repos", "events_url": "https://api.github.com/users/tomaka/events{/privacy}", "received_events_url": "https://api.github.com/users/tomaka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2015-06-26T09:54:03Z", "updated_at": "2015-07-22T00:27:37Z", "closed_at": "2015-07-22T00:08:15Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The `glutin` library has a build script and the `khronos_api` build-dependency.\nThe `khronos_api` crate does nothing except export 4 pub static items ([source code here](https://github.com/bjz/gl-rs/blob/master/khronos_api/src/lib.rs)).\n\nThis build script fails to compile with the MSVC++ nightlies with the following error:\n\n```\n     Running `rustc build.rs --crate-name build_script_build --crate-type bin -C prefer-dynamic -g --cfg feature=\"default\" --cfg feature=\"window\" --out-dir C:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f --emit=dep-info,link -L dependency=C:\\projects\\glutin\\target\\debug -L dependency=C:\\projects\\glutin\\target\\debug\\deps --extern gl_generator=C:\\projects\\glutin\\target\\debug\\deps\\libgl_generator-3f3da0d671af0734.rlib --extern khronos_api=C:\\projects\\glutin\\target\\debug\\deps\\libkhronos_api-af8e40aff286ad52.rlib`\nerror: linking with `link.exe` failed: exit code: 1120\nnote: \"link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\projects\\glutin\\rustc-nightly-x86_64-pc-windows-msvc\\rustc\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\" \"C:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f\\build_script_build.o\" \"/OUT:C:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f\\build_script_build.exe\" \"/OPT:REF,ICF\" \"C:\\projects\\glutin\\target\\debug\\deps\\libgl_generator-3f3da0d671af0734.rlib\" \"C:\\projects\\glutin\\target\\debug\\deps\\libxml-b8f632f5409f1c24.rlib\" \"C:\\projects\\glutin\\target\\debug\\deps\\libkhronos_api-af8e40aff286ad52.rlib\" \"C:\\projects\\glutin\\target\\debug\\deps\\liblog-8a6aba167994951e.rlib\" \"C:\\projects\\glutin\\target\\debug\\deps\\liblibc-ef5cbad4ef5c7a1e.rlib\" \"C:\\projects\\glutin\\target\\debug\\deps\\libbitflags-52cb4de1e3db33a5.rlib\" \"/LIBPATH:C:\\projects\\glutin\\rustc-nightly-x86_64-pc-windows-msvc\\rustc\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\" \"std-74fa456f.lib\" \"/LIBPATH:C:\\projects\\glutin\\target\\debug\" \"/LIBPATH:C:\\projects\\glutin\\target\\debug\\deps\" \"/LIBPATH:C:\\projects\\glutin\\rustc-nightly-x86_64-pc-windows-msvc\\rustc\\bin\\rustlib\\x86_64-pc-windows-msvc\\lib\" \"/LIBPATH:C:\\projects\\glutin\\.rust\\bin\\x86_64-pc-windows-msvc\" \"/LIBPATH:C:\\projects\\glutin\\bin\\x86_64-pc-windows-msvc\" \"ws2_32.lib\" \"userenv.lib\" \"advapi32.lib\" \"kernel32.lib\" \"shell32.lib\" \"msvcrt.lib\" \"compiler-rt.lib\"\nnote:    Creating library C:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f\\build_script_build.lib and object C:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f\\build_script_build.exp\n\n... (lots of warnings, see below) ...\n\nbuild_script_build.o : error LNK2019: unresolved external symbol __imp__ZN7WGL_XML20h414720ad029f8e51qaaE referenced in function _ZN4main20hdd85b714c95cf787jaaE\nbuild_script_build.o : error LNK2019: unresolved external symbol __imp__ZN7EGL_XML20h414720ad029f8e51kaaE referenced in function _ZN4main20hdd85b714c95cf787jaaE\nbuild_script_build.o : error LNK2019: unresolved external symbol __imp__ZN7GLX_XML20h414720ad029f8e51waaE referenced in function _ZN4main20hdd85b714c95cf787jaaE\nbuild_script_build.o : error LNK2019: unresolved external symbol __imp__ZN6GL_XML20h414720ad029f8e51eaaE referenced in function _ZN4main20hdd85b714c95cf787jaaE\nC:\\projects\\glutin\\target\\debug\\build\\glutin-40bab6d10148d98f\\build_script_build.exe : fatal error LNK1120: 4 unresolved externals\n```\n\nThe four unresolved symbols refer to the four static variables exported by `khronos_api`.\n~~This only happens with the 64bits version. The 32bits build works fine.~~ EDIT: oops, 32bits was in fact using MinGW, so nevermind.\n\nIn addition to this, there are also a lot of warnings generated:\n\n```\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry15__STATIC_FMTSTR20h5aefe2547183a934OQcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry15__STATIC_FMTSTR20h5aefe2547183a9349LcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry10_FILE_LINE20h61ca6051b049c413zMcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN20MAX_LOG_LEVEL_FILTER20h52e87f418f7a0ca4EaaE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry15__STATIC_FMTSTR20h5aefe2547183a934EOcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry3LOC20h7853c3b976861309ENcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry15__STATIC_FMTSTR20h5aefe2547183a934WPcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\nbuild_script_build.o : warning LNK4217: locally defined symbol _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry10_FILE_LINE20h61ca6051b049c413mQcE imported in function _ZN8registry24RegistryBuilder$LT$R$GT$16consume_registry20h7736587482988118975E\n\n... (around 150 lines of similar warnings)\n```\n\nThe symbols of these warnings refer to functions of the other build-dependency, which is `gl_generator`. I don't really know what they mean. Maybe they are shown only because of the linking errors and would be hidden otherwise?\n\n[Here is the complete log from appveyor](https://ci.appveyor.com/project/tomaka/glutin/build/1.0.1263) for reference.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26591/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26591/timeline", "performed_via_github_app": null, "state_reason": "completed"}