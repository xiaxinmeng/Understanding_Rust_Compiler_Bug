{"url": "https://api.github.com/repos/rust-lang/rust/issues/6128", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/6128/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/6128/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/6128/events", "html_url": "https://github.com/rust-lang/rust/issues/6128", "id": 13806813, "node_id": "MDU6SXNzdWUxMzgwNjgxMw==", "number": 6128, "title": "compiler bug for a simple test file", "user": {"login": "c-cube", "id": 1274291, "node_id": "MDQ6VXNlcjEyNzQyOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1274291?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c-cube", "html_url": "https://github.com/c-cube", "followers_url": "https://api.github.com/users/c-cube/followers", "following_url": "https://api.github.com/users/c-cube/following{/other_user}", "gists_url": "https://api.github.com/users/c-cube/gists{/gist_id}", "starred_url": "https://api.github.com/users/c-cube/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c-cube/subscriptions", "organizations_url": "https://api.github.com/users/c-cube/orgs", "repos_url": "https://api.github.com/users/c-cube/repos", "events_url": "https://api.github.com/users/c-cube/events{/privacy}", "received_events_url": "https://api.github.com/users/c-cube/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2013-04-30T13:41:51Z", "updated_at": "2013-10-11T01:35:30Z", "closed_at": "2013-10-11T01:35:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "I got this stacktrace while running \"rust test\" on a file.  The end of the trace contains a failure message.  I have an archlinux 64bits, with rust-0.6-3 (compiled on april 6th, 2013). The code is at the bottom of the page.\n\n```\nRUST_LOG=rustc=1,::rt::backtrace !!                                                                                                   rust-graph [v/]\nRUST_LOG=rustc=1,::rt::backtrace make\nrust test src/graph.rs\nsrc/graph.rs:24:8: 24:12 warning: unused variable: `g2`\nsrc/graph.rs:24     let g2 : ~Graph<int,int> = g as ~Graph<int,int>;\n                        ^~~~\nrust: task failed at 'index out of bounds: the len is 1 but the index is 1', /build/src/rust-0.6/src/librustc/middle/ty.rs:1369\n/usr/lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f381ec5b64b]\n/usr/lib/librustrt.so(+0x2a189)[0x7f381ec6c189]\n/usr/lib/librustrt.so(upcall_fail+0x198)[0x7f381ec5d3a8]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x1055db)[0x7f382078f5db]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x4d1be)[0x7f38206d71be]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN8unstable4lang17fail_bounds_check16_6fb13a2fe60974b3_06E+0x22f)[0x7f38206e051f]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty9subst_tps15_fee8f4df464e9d3_06E+0x208)[0x7f381efc0e28]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x37aa8d)[0x7f381f217a8d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x11a78f)[0x7f381efb778f]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x3776fa)[0x7f381f2146fa]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty14fold_sty_to_ty16_838dc9297a1a6e73_06E+0x58)[0x7f381f214028]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty9subst_tps15_fee8f4df464e9d3_06E+0x17d)[0x7f381efc0d9d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x37aa8d)[0x7f381f217a8d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x377aa6)[0x7f381f214aa6]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty14fold_sty_to_ty16_838dc9297a1a6e73_06E+0x58)[0x7f381f214028]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty9subst_tps15_fee8f4df464e9d3_06E+0x17d)[0x7f381efc0d9d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x37aa8d)[0x7f381f217a8d]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty8fold_sig16_c5fce010a53c19b3_06E+0xb3)[0x7f381f215383]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x37746a)[0x7f381f21446a]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty14fold_sty_to_ty16_838dc9297a1a6e73_06E+0x58)[0x7f381f214028]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty9subst_tps15_fee8f4df464e9d3_06E+0x17d)[0x7f381efc0d9d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x37aa8d)[0x7f381f217a8d]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty8fold_sig16_c5fce010a53c19b3_06E+0xb3)[0x7f381f215383]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x3773bc)[0x7f381f2143bc]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty14fold_sty_to_ty16_838dc9297a1a6e73_06E+0x58)[0x7f381f214028]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle2ty9subst_tps15_fee8f4df464e9d3_06E+0x17d)[0x7f381efc0d9d]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x2f148b)[0x7f381f18e48b]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x2f121f)[0x7f381f18e21f]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4meth16make_impl_vtable16_8f771b61f2df1a53_06E+0x2fa)[0x7f381f18d22a]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4meth10get_vtable17_dcd24c16d2c3ccf63_06E+0x304)[0x7f381f18cce4]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4meth16trans_trait_cast16_9c795ee9255f1203_06E+0x8b8)[0x7f381f0a8008]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x1fea62)[0x7f381f09ba62]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4expr10trans_into16_54d763e594233573_06E+0xe97)[0x7f381effc727]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10init_local15_3c07168daf987d3_06E+0x65f)[0x7f381f0ff3ef]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b8c14)[0x7f381f755c14]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x2646db)[0x7f381f1016db]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_stmt17_2c2aa18584fe5be63_06E+0x5ae)[0x7f381effb45e]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x15d49c)[0x7f381effa49c]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans11controlflow11trans_block16_a4e9a67bdd72ccb3_06E+0x19e)[0x7f381eff8c0e]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base13trans_closure17_85d646a672f846683_06E+0x50e)[0x7f381f10a7ae]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base8trans_fn17_fe1e7f81b93e452d3_06E+0x3b9)[0x7f381efb2489]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base10trans_item16_ed7df62f5f126563_06E+0xd52)[0x7f381efaa0e2]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base9trans_mod17_33f95ffa6ea6f19d3_06E+0xa3)[0x7f381f111323]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6middle5trans4base11trans_crate15_aa5d2b86af98143_06E+0x13c4)[0x7f381f130fd4]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x87a380)[0x7f381f717380]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver12compile_rest17_b2b258b84b35f3533_06E+0x331e)[0x7f381f71438e]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b8c14)[0x7f381f755c14]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver12compile_upto17_12335154b455986e3_06E+0x108)[0x7f381f717598]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b8c14)[0x7f381f755c14]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN6driver6driver13compile_input15_bb29edf7a232863_06E+0xca)[0x7f381f7179da]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN12run_compiler17_64d52739a36d169c3_06E+0x20aa)[0x7f381f7470aa]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b66e1)[0x7f381f7536e1]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b2f0c)[0x7f381f74ff0c]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b8c14)[0x7f381f755c14]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0xce08e)[0x7f382075808e]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x14dcb4)[0x7f38207d7cb4]\n/usr/lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f381ec5be64]\nerror: internal compiler error: unexpected failure\nnote: the compiler hit an unexpected failure path. this is a bug\nnote: try running with RUST_LOG=rustc=1,::rt::backtrace to get further details and report the results to github.com/mozilla/rust/issues\nrust: task failed at 'explicit failure', /build/src/rust-0.6/src/librustc/rustc.rc:357\n/usr/lib/librustrt.so(_ZN9rust_task13begin_failureEPKcS1_m+0x4b)[0x7f381ec5b64b]\n/usr/lib/librustrt.so(+0x2a189)[0x7f381ec6c189]\n/usr/lib/librustrt.so(upcall_fail+0x198)[0x7f381ec5d3a8]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x1055db)[0x7f382078f5db]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x105582)[0x7f382078f582]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(_ZN3sys12begin_unwind17_61fe198059b9e3fc3_06E+0x71)[0x7f38206d7651]\n/usr/lib/libcore-c3ca5d77d81b46c1-0.6.so(+0x14dcb4)[0x7f38207d7cb4]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN7monitor17_78935df9ff9e1afa3_06E+0x1577)[0x7f381f7496d7]\n/usr/lib/librustc-c84825241471686d-0.6.so(+0x8b8c14)[0x7f381f755c14]\n/usr/lib/librustc-c84825241471686d-0.6.so(_ZN4main15_c4de63b748e03d3_06E+0x7e)[0x7f381f75582e]\n/usr/lib/librustrt.so(_Z18task_start_wrapperP10spawn_args+0x24)[0x7f381ec5be64]\nrust: domain main @0x23b03c0 root task failed\n```\n\ncode:\n\n``` rust\nextern mod core;                                                                                    \n\nuse core::hashmap::linear::LinearMap;                                                               \nuse core::hashmap::linear::linear_map_with_capacity;                                                \n\n// #[crate_type = \"lib\"];                                                                           \n\ntrait Graph<Node, Edge> {                                                                           \n    fn children(&self, Node, &fn(&(Edge, Node)) \u27f6\u2000 bool);   // iterate on outgoing edges            \n}                                                                                                    \n\nimpl<E> Graph<int,E> for LinearMap<int, ~[(E,int)]> {                                               \n    fn children(&self, n:int, f : &fn(&(E,int)) \u27f6\u2000 bool) {                                          \n        match self.find(&n) {                                                                           \n            None \u27f9\u2000 (),                                                                              \n            Some(list) \u27f9\u2000 list.each(f)                                                               \n        };                                                                                              \n    }                                                                                               \n}                                                                                                    \n\n#[test]                                                                                             \nfn test_1() {                                                                                       \n    let g : ~LinearMap<int, ~[(int,int)]> = ~linear_map_with_capacity(15);                          \n    let g2 : ~Graph<int,int> = g as ~Graph<int,int>;                                                \n}                           \n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/6128/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/6128/timeline", "performed_via_github_app": null, "state_reason": "completed"}