{"url": "https://api.github.com/repos/rust-lang/rust/issues/36690", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36690/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36690/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36690/events", "html_url": "https://github.com/rust-lang/rust/issues/36690", "id": 179002389, "node_id": "MDU6SXNzdWUxNzkwMDIzODk=", "number": 36690, "title": "Channel should not default to `dev` when built from a tarball", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}, {"id": 602425123, "node_id": "MDU6TGFiZWw2MDI0MjUxMjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-dev-tools", "name": "T-dev-tools", "color": "bfd4f2", "default": false, "description": "Relevant to the dev-tools subteam, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-09-24T01:08:15Z", "updated_at": "2023-02-03T08:44:57Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Today whenever Rust is built without a .git directory (approximately meaning \"when it's built from a tarball\") the configure script overrides the release channel to \"stable\", per [this PR](https://github.com/rust-lang/rust/pull/33971) and [this issue](https://github.com/rust-lang/rust/issues/28322). Unfortunately, as I [realized after a recent bug in which nightly distcheck thought it was a stable compiler](https://github.com/rust-lang/rust/pull/36678#issuecomment-249334587) this is not correct. Today, if somebody downloads a _nightly_ tarball and builds it, they will receive a compiler that claims to be a stable release. This is just not true.\n\nI'm not sure how best to fix this. The configure script is the source of truth for the release channel, and the configure script is not telling the truth.\n\nHere's one thing we could do: the build process that produces the tarball also dumps a `version` file into the source tree, and the release channel can be derived from that file. So when the [configure script sees that it is not in a git repo](https://github.com/rust-lang/rust/blob/master/configure#L652) it opens that file and looks for \"-nightly\", \"-beta\", or \"-dev\" and sets the release channel as appropriate. If it sees none of those it sets the channel to \"stable\". If the version file does not exist it sets the channel to \"dev\".\n\ncc @alexcrichton \n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36690/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36690/timeline", "performed_via_github_app": null, "state_reason": null}