{"url": "https://api.github.com/repos/rust-lang/rust/issues/24365", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/24365/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/24365/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/24365/events", "html_url": "https://github.com/rust-lang/rust/issues/24365", "id": 68019717, "node_id": "MDU6SXNzdWU2ODAxOTcxNw==", "number": 24365, "title": "ICE: ID not mapped to struct fields", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-04-13T06:35:49Z", "updated_at": "2015-04-15T03:15:32Z", "closed_at": "2015-04-15T03:15:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "I received an internal compiler error \"ID not mapped to struct fields\" while attempting to compile the code below (relevant parts excerpted for brevity). The important part is marked \"BEGIN INTERNAL COMPILER ERROR CAUSING CODE;\" note that this code will refuse to compile for several reasons (for loop should be using .iter(), string concatenation needs &str rather than String), so I expected to see those issues but not the ICE. Replacing that section with the commented out section directly below it marked \"BEGIN CORRECT SUBSTITUTION FOR THE ABOVE CODE\" causes the code to compile successfully.\n\nEDIT: To make replication easier, you can check out the code (commit ID: 6f7f07488) from my public repo here and `cargo build` to reproduce the issue:\nhttps://github.com/mquinn/RustedJVM/tree/d6f7f07488c3a8239cbf2078aed23b5ebf1ad1dc\n\nmethods.rs\n\n``` rust\nuse attributes::*;\n\npub struct Method {\n    pub access_flags: u16,\n    pub name_idx: u16,\n    pub descriptor_idx: u16,\n    pub attrs_count: u16,\n    pub attributes: Vec<Attribute>,\n}\n\nimpl Method {\n    pub fn to_string(&self) -> String {\n        let mut string_rep = format!(\"Method:\\n\\\n                \\t- access_flags=0x{:x}\\n\\\n                \\t- name_idx={}\\n\\\n                \\t- descriptor_idx={}\\n\\\n                \\t- attrs_count={}\\n\",\n                self.access_flags, self.name_idx, self.descriptor_idx,\n                self.attrs_count);\n\n        /* BEGIN INTERNAL COMPILER ERROR CAUSING CODE */\n        for attr in self.attributes {\n            string_rep = string_rep + format!(\"\\tAttributes:\\n\\\n                \\t\\t- attr_name_idx={}\\n\\\n                \\t\\t- attr_length={}\\n\",\n                attr.attr_name_idx, attr.attr_length);\n        }\n        /* END INTERNAL COMPILER ERROR CAUSING CODE */\n\n        /* BEGIN CORRECT SUBSTITUTION FOR THE ABOVE CODE */\n       // for attr in self.attributes.iter() {\n       //     string_rep = string_rep + &format!(\"\\tAttribute:\\n\\\n       //         \\t\\t- {}\\n\", attr.to_string());\n       //}\n       /* END CORRECT SUBSTITUTION FOR THE ABOVE CODE */\n\n        string_rep\n    }\n}\n```\n\nattributes.rs\n\n``` rust\npub enum Attribute {\n    Code(ATTRIBUTE_Code),\n}\n\npub struct ATTRIBUTE_Code {\n    pub attr_name_idx: u16,\n    pub attr_length: u16,\n}\n\nimpl Attribute {\n    pub fn to_string(&self) -> String {\n        match *self {\n            Attribute::Code(ref s) => format!(\n                \"ATTRIBUTE_Code[attr_name_idx={}, attr_length={}]\",\n                        s.attr_name_idx, s.attr_length),\n        }\n    }\n}\n```\n\n`$rustc --version --verbose`:\nrustc 1.0.0-dev (93f7fe32d 2015-04-10) (built 2015-04-10)\nbinary: rustc\ncommit-hash: 93f7fe32d30b67baa6abf09c073c5862a978dc57\ncommit-date: 2015-04-10\nbuild-date: 2015-04-10\nhost: x86_64-unknown-linux-gnu\nrelease: 1.0.0-dev\n\nBacktrace:\n   Compiling rusted_jvm v0.0.1 (file:///home/mquinn/RustedJVM)\n     Running `rustc src/rustedjvm/lib.rs --crate-name rustedjvm --crate-type lib -g -C metadata=71ad650c91a5c7b5 -C extra-filename=-71ad650c91a5c7b5 --out-dir /home/mquinn/RustedJVM/target/debug --emit=dep-info,link -L dependency=/home/mquinn/RustedJVM/target/debug -L dependency=/home/mquinn/RustedJVM/target/debug/deps`\nsrc/rustedjvm/methods.rs:53:17: 53:35 error: attempted access of field `attr_name_idx` on type `attributes::Attribute`, but no field with that name was found\nsrc/rustedjvm/methods.rs:53                 attr.attr_name_idx, attr.attr_length);\n                                            ^~~~~~~~~~~~~~~~~~\nnote: in expansion of format_args!\n<std macros>:2:26: 2:59 note: expansion site\n<std macros>:1:1: 2:61 note: in expansion of format!\nsrc/rustedjvm/methods.rs:50:39: 53:55 note: expansion site\nerror: internal compiler error: ID not mapped to struct fields: enum attributes::Attribute::Attribute (id=1155)\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', /home/mquinn/rust/src/libsyntax/diagnostic.rs:191\n\nstack backtrace:\n   1:     0x7f56d1f7f619 - sys::backtrace::write::h18e58796ebd1d3c13JC\n   2:     0x7f56d1fa3ec7 - panicking::on_panic::hd41e16c2b3e4492d9aJ\n   3:     0x7f56d1eede52 - rt::unwind::begin_unwind_inner::h9765aad314ad1b4dhQI\n   4:     0x7f56cf4b150d - rt::unwind::begin_unwind::h5309693530743254994\n   5:     0x7f56cf4b1c7b - diagnostic::Handler::bug::hf75a5730928b8949LlB\n   6:     0x7f56cfef3016 - middle::ty::lookup_struct_fields::h8ae8673fe10e9771G77\n   7:     0x7f56d0dc79f3 - check::check_expr_with_unifier::suggest_field_names::h88608c9c654e2557PXq\n   8:     0x7f56d0d99532 - check::check_expr_with_unifier::check_field::h7ac13deb0b49aa68JRq\n   9:     0x7f56d0db5a76 - check::check_expr_with_unifier::h2183527311110853776\n  10:     0x7f56d0db20fa - check::check_expr_with_unifier::h2247865789248415537\n  11:     0x7f56d0d97c9f - check::check_expr_with_unifier::closure.33434\n  12:     0x7f56d0da0efe - vec::Vec<T>.FromIterator<T>::from_iter::h7936511826546032352\n  13:     0x7f56d0d9c4c6 - check::check_expr_with_unifier::h5081375255117599892\n  14:     0x7f56d0cc0a90 - check::_match::check_match::h8048da634ce4d38aZmb\n  15:     0x7f56d0db5641 - check::check_expr_with_unifier::h2183527311110853776\n  16:     0x7f56d0d808fc - check::check_expr_with_unifier::h5928011805846542261\n  17:     0x7f56d0d5ae08 - check::check_argument_types::hd0f650fe764473b6Xcq\n  18:     0x7f56d0d5802b - check::callee::confirm_builtin_call::hacd86568d5ed9eafPym\n  19:     0x7f56d0d56907 - check::callee::check_call::ha94772a466a1ab81kpm\n  20:     0x7f56d0d7d15a - check::check_expr_with_unifier::h5928011805846542261\n  21:     0x7f56d0d5ae08 - check::check_argument_types::hd0f650fe764473b6Xcq\n  22:     0x7f56d0d5802b - check::callee::confirm_builtin_call::hacd86568d5ed9eafPym\n  23:     0x7f56d0d56907 - check::callee::check_call::ha94772a466a1ab81kpm\n  24:     0x7f56d0da1b9d - check::check_expr_with_unifier::h11371956447038667724\n  25:     0x7f56d0d64363 - check::op::check_binop::h4c0bec0b4c03e67boin\n  26:     0x7f56d0da1d2f - check::check_expr_with_unifier::h11371956447038667724\n  27:     0x7f56d0dbbf21 - check::check_expr_with_unifier::h6210470634066893654\n  28:     0x7f56d0d705f4 - check::check_block_with_expected::h5733744b147f1afaNps\n  29:     0x7f56d0daefe6 - check::check_expr_with_unifier::h2247865789248415537\n  30:     0x7f56d0cc0e5e - check::_match::check_match::closure.28933\n  31:     0x7f56d0cc0c12 - check::_match::check_match::h8048da634ce4d38aZmb\n  32:     0x7f56d0da21a7 - check::check_expr_with_unifier::h11371956447038667724\n  33:     0x7f56d0d7090c - check::check_block_with_expected::h5733744b147f1afaNps\n  34:     0x7f56d0d87b04 - check::check_block_no_value::hfa79bd95eda5b773Oos\n  35:     0x7f56d0daeeed - check::check_expr_with_unifier::h2247865789248415537\n  36:     0x7f56d0cc0e5e - check::_match::check_match::closure.28933\n  37:     0x7f56d0cc0c12 - check::_match::check_match::h8048da634ce4d38aZmb\n  38:     0x7f56d0da21a7 - check::check_expr_with_unifier::h11371956447038667724\n  39:     0x7f56d0dca84b - check::check_decl_local::ha1d7685c67d10dabHjs\n  40:     0x7f56d0d705a1 - check::check_block_with_expected::h5733744b147f1afaNps\n  41:     0x7f56d0d9b798 - check::check_expr_with_unifier::h5081375255117599892\n  42:     0x7f56d0d7056f - check::check_block_with_expected::h5733744b147f1afaNps\n  43:     0x7f56d0d54186 - check::check_fn::h90484a4ffe1ca508Abo\n  44:     0x7f56d0d6bf87 - check::check_bare_fn::h1a3ab5c0cd11563590n\n  45:     0x7f56d0d710dc - check::check_method_body::hdbc9f81709163b85Zyo\n  46:     0x7f56d0d6901d - check::check_item::h77171b1af212ea76Ujo\n  47:     0x7f56d0d6a552 - visit::walk_item::h16852749654633779859\n  48:     0x7f56d0e2cf71 - check_crate::closure.36512\n  49:     0x7f56d0e283a0 - check_crate::h733d9630ef3865f2zxC\n  50:     0x7f56d25f5878 - driver::phase_3_run_analysis_passes::hfe88369659d0848dpGa\n  51:     0x7f56d25d6945 - driver::compile_input::hc670b94e199ddf6dQba\n  52:     0x7f56d2695661 - run_compiler::h4ffbc497265942ddL4b\n  53:     0x7f56d26932b2 - boxed::F.FnBox<A>::call_box::h17881275858697386353\n  54:     0x7f56d26927e9 - rt::unwind::try::try_fn::h13022630299838337922\n  55:     0x7f56d2022ab8 - rust_try_inner\n  56:     0x7f56d2022aa5 - rust_try\n  57:     0x7f56d2692a98 - boxed::F.FnBox<A>::call_box::h3800468468544546307\n  58:     0x7f56d1f91841 - sys::thread::create::thread_start::h4365e3ef51128cd6rLH\n  59:     0x7f56cc97d0a3 - start_thread\n  60:     0x7f56d1b5f04c - __clone\n  61:                0x0 - <unknown>\n\nCould not compile `rusted_jvm`.\n\nCaused by:\n  Process didn't exit successfully: `rustc src/rustedjvm/lib.rs --crate-name rustedjvm --crate-type lib -g -C metadata=71ad650c91a5c7b5 -C extra-filename=-71ad650c91a5c7b5 --out-dir /home/mquinn/RustedJVM/target/debug --emit=dep-info,link -L dependency=/home/mquinn/RustedJVM/target/debug -L dependency=/home/mquinn/RustedJVM/target/debug/deps` (exit code: 101)\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/24365/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/24365/timeline", "performed_via_github_app": null, "state_reason": "completed"}