{"url": "https://api.github.com/repos/rust-lang/rust/issues/74299", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/74299/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/74299/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/74299/events", "html_url": "https://github.com/rust-lang/rust/issues/74299", "id": 655980911, "node_id": "MDU6SXNzdWU2NTU5ODA5MTE=", "number": 74299, "title": "Incoherent impls are allowed on default associated types ", "user": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 347795552, "node_id": "MDU6TGFiZWwzNDc3OTU1NTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-specialization", "name": "A-specialization", "color": "f7e101", "default": false, "description": "Area: Trait impl specialization"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}, {"id": 1472579062, "node_id": "MDU6TGFiZWwxNDcyNTc5MDYy", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-specialization", "name": "F-specialization", "color": "f9c0cc", "default": false, "description": "`#![feature(specialization)]`"}, {"id": 1615551553, "node_id": "MDU6TGFiZWwxNjE1NTUxNTUz", "url": "https://api.github.com/repos/rust-lang/rust/labels/glacier", "name": "glacier", "color": "a5e2ff", "default": false, "description": "ICE tracked in rust-lang/glacier"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-13T16:25:31Z", "updated_at": "2020-07-14T13:59:31Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\n#![feature(specialization)]\r\n\r\ntrait X {\r\n    type U;\r\n    fn f(&self) -> Self::U { loop {} }\r\n}\r\n\r\nimpl<T> X for T {\r\n    default type U = ();\r\n}\r\n\r\ntrait Y {\r\n    fn g(&self) {}\r\n}\r\n\r\nimpl Y for <() as X>::U {}\r\nimpl Y for <i32 as X>::U {}\r\n\r\nfn main() {\r\n    ().f().g();\r\n}\r\n```\r\n\r\nI expected to see this happen: error for potentially overlapping impls\r\n\r\nInstead, this happened: ICEs in codegen\r\n\r\n### Meta\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.46.0-nightly (346aec9b0 2020-07-11)\r\nbinary: rustc\r\ncommit-hash: 346aec9b02f3c74f3fce97fd6bda24709d220e49\r\ncommit-date: 2020-07-11\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.46.0-nightly\r\nLLVM version: 10.0\r\n```\r\n\r\n<details><summary>Backtrace</summary>\r\n<p>\r\n\r\n```\r\nwarning: the feature `specialization` is incomplete and may not be safe to use and/or cause compiler crashes\r\n --> .\\tmp\\defaults-incoherent.rs:1:12\r\n  |\r\n1 | #![feature(specialization)]\r\n  |            ^^^^^^^^^^^^^^\r\n  |\r\n  = note: `#[warn(incomplete_features)]` on by default\r\n  = note: see issue #31844 <https://github.com/rust-lang/rust/issues/31844> for more information\r\n\r\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: ErrorReported', src\\librustc_mir\\monomorphize\\collector.rs:721:84\r\nstack backtrace:\r\n   0: <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt\r\n   1: core::fmt::write\r\n   2: <std::io::IoSliceMut as core::fmt::Debug>::fmt\r\n   3: std::panicking::take_hook\r\n   4: std::panicking::take_hook\r\n   5: rustc_driver::report_ice\r\n   6: std::panicking::rust_panic_with_hook\r\n   7: rust_begin_unwind\r\n   8: core::panicking::panic_fmt\r\n   9: core::result::unwrap_failed\r\n  10: <rustc_mir::monomorphize::collector::MirNeighborCollector as rustc_middle::mir::visit::Visitor>::visit_terminator\r\n  11: <rustc_mir::monomorphize::collector::RootCollector as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_impl_item\r\n  12: rustc_mir::monomorphize::collector::collect_crate_mono_items\r\n  13: <rustc_mir::dataflow::impls::borrows::BorrowIndex as core::fmt::Debug>::fmt\r\n  14: rustc_mir::monomorphize::collector::collect_crate_mono_items\r\n  15: rustc_mir::monomorphize::partitioning::compute_codegen_unit_name\r\n  16: <rustc_target::abi::TyAndLayout<&rustc_middle::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::pointee_info_at\r\n  17: <rustc_codegen_llvm::llvm_::ffi::debuginfo::DISPFlags as core::fmt::Debug>::fmt\r\n  18: rustc_codegen_llvm::type_::<impl rustc_codegen_ssa::traits::type_::LayoutTypeMethods for rustc_codegen_llvm::context::CodegenCx>::reg_backend_type\r\n  19: rustc_codegen_llvm::type_::<impl rustc_codegen_ssa::traits::type_::LayoutTypeMethods for rustc_codegen_llvm::context::CodegenCx>::reg_backend_type\r\n  20: <rustc_target::abi::TyAndLayout<&rustc_middle::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::pointee_info_at\r\n  21: <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_ssa::traits::backend::CodegenBackend>::codegen_crate\r\n  22: rustc_interface::passes::QueryContext::print_stats\r\n  23: rustc_interface::passes::BoxedResolver::complete\r\n  24: rustc_interface::queries::Queries::ongoing_codegen\r\n  25: <rustc_codegen_ssa::back::linker::MsvcLinker as rustc_codegen_ssa::back::linker::Linker>::partial_relro\r\n  26: <env_logger::filter::inner::Filter as core::fmt::Display>::fmt\r\n  27: <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref\r\n  28: <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref\r\n  29: <(&rustc_middle::ty::sty::Const,rustc_middle::mir::Field) as rustc_middle::ty::query::keys::Key>::default_span\r\n  30: std::sys::windows::thread::Thread::new\r\n  31: BaseThreadInitThunk\r\n  32: RtlUserThreadStart\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.46.0-nightly (346aec9b0 2020-07-11) running on x86_64-pc-windows-msvc\r\n\r\nquery stack during panic:\r\n#0 [collect_and_partition_mono_items] collect_and_partition_mono_items\r\nend of query stack\r\nwarning: 1 warning emitted\r\n\r\nerror: internal compiler error: encountered ambiguity selecting `Binder(<() as Y>)` during codegen, presuming due to overflow or prior type error\r\n  |\r\n  = note: delayed at /rustc/346aec9b02f3c74f3fce97fd6bda24709d220e49\\src\\librustc_session\\session.rs:436:27\r\n\r\nthread 'rustc' panicked at 'no errors encountered even though `delay_span_bug` issued', src\\librustc_errors\\lib.rs:367:17\r\nstack backtrace:\r\n   0:     0x7ffcfbfa9a2e - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h9fa330dd7e3de9bd\r\n   1:     0x7ffcfbfd740c - core::fmt::write::he569a1ab62a01108\r\n   2:     0x7ffcfbf9b1a3 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::h41603fb87d485071\r\n   3:     0x7ffcfbfaf18b - std::panicking::take_hook::h755d174ec3438590\r\n   4:     0x7ffcfbfaedd8 - std::panicking::take_hook::h755d174ec3438590\r\n   5:     0x7ffcfc41610a - rustc_driver::report_ice::h5bc4860b8312dea9\r\n   6:     0x7ffcfbfafb10 - std::panicking::rust_panic_with_hook::hbd7d7a2973bcd31a\r\n   7:     0x7ffd004d281d - <rustc_errors::styled_buffer::StyledBuffer as core::fmt::Debug>::fmt::h7062ab9734834e2d\r\n   8:     0x7ffd00500352 - <rustc_errors::HandlerInner as core::ops::drop::Drop>::drop::hde691b6f5e350660\r\n   9:     0x7ffcfc450057 - <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref::hca40fb8fa09ef5ca\r\n  10:     0x7ffcfc45c17a - <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref::hca40fb8fa09ef5ca\r\n  11:     0x7ffcfc3e3ffc - <(&rustc_middle::ty::sty::Const,rustc_middle::mir::Field) as rustc_middle::ty::query::keys::Key>::default_span::h4115a0798415ecc2\r\n  12:     0x7ffcfc3d7a21 - <rustc_codegen_ssa::back::linker::MsvcLinker as rustc_codegen_ssa::back::linker::Linker>::partial_relro::h84f5664230855038\r\n  13:     0x7ffd00722630 - _rust_alloc_zeroed\r\n  14:     0x7ffd00721e8b - _rust_alloc_zeroed\r\n  15:     0x7ffd0071fbb4 - _rust_alloc_zeroed\r\n  16:     0x7ffd007219ce - _rust_alloc_zeroed\r\n  17:     0x7ffd00720065 - _rust_alloc_zeroed\r\n  18:     0x7ffd656b016f - _chkstk\r\n  19:     0x7ffd65631c56 - RtlUnwindEx\r\n  20:     0x7ffd0071fef5 - _rust_alloc_zeroed\r\n  21:     0x7ffd007210c0 - _rust_alloc_zeroed\r\n  22:     0x7ffd007213b7 - _rust_alloc_zeroed\r\n  23:     0x7ffd00721ad4 - _rust_alloc_zeroed\r\n  24:     0x7ffd00720065 - _rust_alloc_zeroed\r\n  25:     0x7ffd656b00ef - _chkstk\r\n  26:     0x7ffd6565b474 - RtlRaiseException\r\n  27:     0x7ffd6565b1c5 - RtlRaiseException\r\n  28:     0x7ffd63073e49 - RaiseException\r\n  29:     0x7ffcfbffa5a5 - _umoddi3\r\n  30:     0x7ffcfbfc1d31 - _rust_start_panic\r\n  31:     0x7ffcfbfc1cb9 - _rust_start_panic\r\n  32:     0x7ffcfbfafcb8 - rust_panic\r\n  33:     0x7ffcfbfafb99 - std::panicking::rust_panic_with_hook::hbd7d7a2973bcd31a\r\n  34:     0x7ffcfbfaf65f - rust_begin_unwind\r\n  35:     0x7ffcfbfd3d50 - core::panicking::panic_fmt::h24891fb3d19f6dcf\r\n  36:     0x7ffcfbfd39e3 - core::result::unwrap_failed::h08663fa7314c6527\r\n  37:     0x7ffcff157bee - <rustc_mir::monomorphize::collector::MirNeighborCollector as rustc_middle::mir::visit::Visitor>::visit_terminator::he7c45c11d185f795\r\n  38:     0x7ffcff159eee - <rustc_mir::monomorphize::collector::RootCollector as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_impl_item::hd74b81843bceb49e\r\n  39:     0x7ffcff155017 - rustc_mir::monomorphize::collector::collect_crate_mono_items::h48c3630ce41bcfb2\r\n  40:     0x7ffcff17595c - <rustc_mir::dataflow::impls::borrows::BorrowIndex as core::fmt::Debug>::fmt::hcdfacfd9122b6ab6\r\n  41:     0x7ffcff1539ac - rustc_mir::monomorphize::collector::collect_crate_mono_items::h48c3630ce41bcfb2\r\n  42:     0x7ffcff375f69 - rustc_mir::monomorphize::partitioning::compute_codegen_unit_name::hb80b3e3600310ae3\r\n  43:     0x7ffcfc8809c7 - <rustc_target::abi::TyAndLayout<&rustc_middle::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::pointee_info_at::h88328364fbfe1b75\r\n  44:     0x7ffcfc789334 - <rustc_codegen_llvm::llvm_::ffi::debuginfo::DISPFlags as core::fmt::Debug>::fmt::h0d6f3453cdb67586\r\n  45:     0x7ffcfc7a7f90 - rustc_codegen_llvm::type_::<impl rustc_codegen_ssa::traits::type_::LayoutTypeMethods for rustc_codegen_llvm::context::CodegenCx>::reg_backend_type::h7f3163bb36afe4a6\r\n  46:     0x7ffcfc7f0a00 - rustc_codegen_llvm::type_::<impl rustc_codegen_ssa::traits::type_::LayoutTypeMethods for rustc_codegen_llvm::context::CodegenCx>::reg_backend_type::h7f3163bb36afe4a6\r\n  47:     0x7ffcfc882e7b - <rustc_target::abi::TyAndLayout<&rustc_middle::ty::TyS> as rustc_codegen_llvm::type_of::LayoutLlvmExt>::pointee_info_at::h88328364fbfe1b75\r\n  48:     0x7ffcfc82c8c9 - <rustc_codegen_llvm::LlvmCodegenBackend as rustc_codegen_ssa::traits::backend::CodegenBackend>::codegen_crate::h2f177f92f53316ae\r\n  49:     0x7ffcfc58b54f - rustc_interface::passes::QueryContext::print_stats::he6b0204640bb6041\r\n  50:     0x7ffcfc5a351c - rustc_interface::passes::BoxedResolver::complete::h363c34fdc5dbd1ef\r\n  51:     0x7ffcfc597da1 - rustc_interface::queries::Queries::ongoing_codegen::h085a7f7dbbab46a2\r\n  52:     0x7ffcfc3d6a0a - <rustc_codegen_ssa::back::linker::MsvcLinker as rustc_codegen_ssa::back::linker::Linker>::partial_relro::h84f5664230855038\r\n  53:     0x7ffcfc400ace - <env_logger::filter::inner::Filter as core::fmt::Display>::fmt::ha8cb8d62fcfb1df4\r\n  54:     0x7ffcfc4206e9 - <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref::hca40fb8fa09ef5ca\r\n  55:     0x7ffcfc422a15 - <rustc_driver::DEFAULT_HOOK as core::ops::deref::Deref>::deref::hca40fb8fa09ef5ca\r\n  56:     0x7ffcfc3df1f3 - <(&rustc_middle::ty::sty::Const,rustc_middle::mir::Field) as rustc_middle::ty::query::keys::Key>::default_span::h4115a0798415ecc2\r\n  57:     0x7ffcfbfbef7a - std::sys::windows::thread::Thread::new::h9c6ccf8206794202\r\n  58:     0x7ffd65156fd4 - BaseThreadInitThunk\r\n  59:     0x7ffd6565cec1 - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.46.0-nightly (346aec9b0 2020-07-11) running on x86_64-pc-windows-msvc\r\n\r\nquery stack during panic:\r\nend of query stack\r\nthread panicked while panicking. aborting.\r\n```\r\n\r\n</p>\r\n</details>\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/74299/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/74299/timeline", "performed_via_github_app": null, "state_reason": null}