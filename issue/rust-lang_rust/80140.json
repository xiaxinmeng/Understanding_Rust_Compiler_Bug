{"url": "https://api.github.com/repos/rust-lang/rust/issues/80140", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/80140/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/80140/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/80140/events", "html_url": "https://github.com/rust-lang/rust/issues/80140", "id": 770482118, "node_id": "MDU6SXNzdWU3NzA0ODIxMTg=", "number": 80140, "title": "impls on arrays seem slower than equivalent tuples", "user": {"login": "smmalis37", "id": 4054472, "node_id": "MDQ6VXNlcjQwNTQ0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4054472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smmalis37", "html_url": "https://github.com/smmalis37", "followers_url": "https://api.github.com/users/smmalis37/followers", "following_url": "https://api.github.com/users/smmalis37/following{/other_user}", "gists_url": "https://api.github.com/users/smmalis37/gists{/gist_id}", "starred_url": "https://api.github.com/users/smmalis37/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smmalis37/subscriptions", "organizations_url": "https://api.github.com/users/smmalis37/orgs", "repos_url": "https://api.github.com/users/smmalis37/repos", "events_url": "https://api.github.com/users/smmalis37/events{/privacy}", "received_events_url": "https://api.github.com/users/smmalis37/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 113376, "node_id": "MDU6TGFiZWwxMTMzNzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-slow", "name": "I-slow", "color": "e10c02", "default": false, "description": "Problems and improvements with respect to performance of generated code."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 17, "created_at": "2020-12-18T00:53:09Z", "updated_at": "2021-12-15T02:15:38Z", "closed_at": "2021-09-29T17:34:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When running the following program:\r\n\r\nCargo.toml:\r\n```\r\n[dependencies]\r\ncriterion = \"0.3\"\r\n```\r\n\r\nmain.rs:\r\n```\r\nuse criterion::{black_box, Criterion};\r\n\r\nfn main() {\r\n    let mut c = Criterion::default();\r\n    c.bench_function(\"partialeq-array\", |b| {\r\n        b.iter(|| {\r\n            let a = black_box([0; 3]);\r\n            let b = black_box([0; 3]);\r\n            for _ in 0..1_000_000 {\r\n                black_box(a.eq(&b));\r\n            }\r\n        })\r\n    });\r\n    c.bench_function(\"partialeq-tuple\", |b| {\r\n        b.iter(|| {\r\n            let a = black_box((0, 0, 0));\r\n            let b = black_box((0, 0, 0));\r\n            for _ in 0..1_000_000 {\r\n                black_box(a.eq(&b));\r\n            }\r\n        })\r\n    });\r\n}\r\n```\r\n\r\nI get these results in debug builds:\r\n```\r\npartialeq-array         time:   [46.308 ms 46.462 ms 46.618 ms]\r\npartialeq-tuple         time:   [31.133 ms 31.230 ms 31.339 ms]\r\n```\r\n\r\nAnd these results in release builds:\r\n```\r\npartialeq-array         time:   [628.51 us 633.17 us 638.23 us]\r\npartialeq-tuple         time:   [211.77 us 212.61 us 213.60 us]\r\n```\r\n\r\nI had expected these to be equivalent, but tuples are significantly faster than arrays. This seems to apply to any size of number (i8, u32, etc), and some other traits as well (notably Hash).", "closed_by": {"login": "smmalis37", "id": 4054472, "node_id": "MDQ6VXNlcjQwNTQ0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4054472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/smmalis37", "html_url": "https://github.com/smmalis37", "followers_url": "https://api.github.com/users/smmalis37/followers", "following_url": "https://api.github.com/users/smmalis37/following{/other_user}", "gists_url": "https://api.github.com/users/smmalis37/gists{/gist_id}", "starred_url": "https://api.github.com/users/smmalis37/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/smmalis37/subscriptions", "organizations_url": "https://api.github.com/users/smmalis37/orgs", "repos_url": "https://api.github.com/users/smmalis37/repos", "events_url": "https://api.github.com/users/smmalis37/events{/privacy}", "received_events_url": "https://api.github.com/users/smmalis37/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/80140/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/80140/timeline", "performed_via_github_app": null, "state_reason": "completed"}