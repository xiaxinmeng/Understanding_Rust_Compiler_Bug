{"url": "https://api.github.com/repos/rust-lang/rust/issues/107351", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107351/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107351/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107351/events", "html_url": "https://github.com/rust-lang/rust/issues/107351", "id": 1559459992, "node_id": "I_kwDOAAsO6M5c83iY", "number": 107351, "title": "debuginfo: Enums, generators, and async envs have generic arguments at the wrong level", "user": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 3812070271, "node_id": "LA_kwDOAAsO6M7jN5N_", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-technical-debt", "name": "A-technical-debt", "color": "f7e101", "default": false, "description": "Area: Internal cleanup work"}, {"id": 4825122068, "node_id": "LA_kwDOAAsO6M8AAAABH5mFFA", "url": "https://api.github.com/repos/rust-lang/rust/labels/wg-debugging", "name": "wg-debugging", "color": "c2e0c6", "default": false, "description": "Bad Rust debugging experiences"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-27T09:45:12Z", "updated_at": "2023-01-27T09:45:12Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Currently, the compiler emits debuginfo that attaches generic arguments to the type of each variant instead of at the top-level. For example, the enum\r\n\r\n```rust\r\nenum Foo<T> {\r\n   Bar(T),\r\n   Baz(u32),\r\n}\r\n```\r\n\r\ngets described as if it was\r\n\r\n```rust\r\nenum Foo {\r\n   Bar<T>(T),\r\n   Baz<T>(u32),\r\n}\r\n```\r\n\r\nIt would be more consistent and efficient if the generic arguments were pulled into the type describing `Foo`.\r\n\r\nThe main obstacle to doing so is making sure that this change does not break existing tooling.\r\n\r\nHere is some actual DWARF (for the `Poll` enum) to illustrate the issue:\r\n\r\n```txt\r\n< 4><0x000007b4>          DW_TAG_structure_type\r\n                            DW_AT_name                  Poll<u8>\r\n                            DW_AT_byte_size             0x00000002\r\n                            DW_AT_alignment             0x00000001\r\n< 5><0x000007bb>            DW_TAG_variant_part\r\n                              DW_AT_discr                 <0x000007c0>\r\n< 6><0x000007c0>              DW_TAG_member\r\n                                DW_AT_type                  <0x00001335>\r\n                                DW_AT_alignment             0x00000001\r\n                                DW_AT_data_member_location  0\r\n                                DW_AT_artificial            yes(1)\r\n< 6><0x000007c7>              DW_TAG_variant\r\n                                DW_AT_discr_value           0\r\n< 7><0x000007c9>                DW_TAG_member\r\n                                  DW_AT_name                  Ready\r\n                                  DW_AT_type                  <0x000007e4>\r\n                                  DW_AT_alignment             0x00000001\r\n                                  DW_AT_data_member_location  0\r\n< 6><0x000007d5>              DW_TAG_variant\r\n                                DW_AT_discr_value           1\r\n< 7><0x000007d7>                DW_TAG_member\r\n                                  DW_AT_name                  Pending\r\n                                  DW_AT_type                  <0x00000800>\r\n                                  DW_AT_alignment             0x00000001\r\n                                  DW_AT_data_member_location  0\r\n< 5><0x000007e4>            DW_TAG_structure_type\r\n                              DW_AT_name                  Ready\r\n                              DW_AT_byte_size             0x00000002\r\n                              DW_AT_alignment             0x00000001\r\n< 6><0x000007eb>              DW_TAG_template_type_parameter\r\n                                DW_AT_type                  <0x00001335>\r\n                                DW_AT_name                  T\r\n< 6><0x000007f4>              DW_TAG_member\r\n                                DW_AT_name                  __0\r\n                                DW_AT_type                  <0x00001335>\r\n                                DW_AT_alignment             0x00000001\r\n                                DW_AT_data_member_location  1\r\n< 5><0x00000800>            DW_TAG_structure_type\r\n                              DW_AT_name                  Pending\r\n                              DW_AT_byte_size             0x00000002\r\n                              DW_AT_alignment             0x00000001\r\n< 6><0x00000807>              DW_TAG_template_type_parameter\r\n                                DW_AT_type                  <0x00001335>\r\n                                DW_AT_name                  T\r\n```\r\nThere should be a single `DW_TAG_template_type_parameter` DIE attached to the top-level `DW_TAG_structure_type` instead of duplicated across the `DW_TAG_structure_type`s for `Ready` and `Pending`. ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107351/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107351/timeline", "performed_via_github_app": null, "state_reason": null}