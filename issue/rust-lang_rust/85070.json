{"url": "https://api.github.com/repos/rust-lang/rust/issues/85070", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85070/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85070/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85070/events", "html_url": "https://github.com/rust-lang/rust/issues/85070", "id": 880545561, "node_id": "MDU6SXNzdWU4ODA1NDU1NjE=", "number": 85070, "title": "Internal Compiler Error building sample code from https://doc.rust-lang.org/book/ch02-00-guessing-game-tutorial.html", "user": {"login": "rootingfortrees", "id": 83861694, "node_id": "MDQ6VXNlcjgzODYxNjk0", "avatar_url": "https://avatars.githubusercontent.com/u/83861694?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rootingfortrees", "html_url": "https://github.com/rootingfortrees", "followers_url": "https://api.github.com/users/rootingfortrees/followers", "following_url": "https://api.github.com/users/rootingfortrees/following{/other_user}", "gists_url": "https://api.github.com/users/rootingfortrees/gists{/gist_id}", "starred_url": "https://api.github.com/users/rootingfortrees/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rootingfortrees/subscriptions", "organizations_url": "https://api.github.com/users/rootingfortrees/orgs", "repos_url": "https://api.github.com/users/rootingfortrees/repos", "events_url": "https://api.github.com/users/rootingfortrees/events{/privacy}", "received_events_url": "https://api.github.com/users/rootingfortrees/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-08T09:09:40Z", "updated_at": "2021-05-10T14:21:30Z", "closed_at": "2021-05-10T14:21:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "Edit: this sounds like https://github.com/rust-lang/rust/issues/84341. Let me know if there's something useful I can provide from my local environment (I have the incremental compilation artifacts backed up).\r\n\r\n<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\nThe code on its own is probably not helpful (it's the final version of the guessing game from chapter 2 of the book). I wrote this in VS code with the `Rust` extension installed and built it successfully with cargo; then I installed the `rust-analyzer` extension, disabled `Rust`, restarted VS code, and hit this error when trying to run from within the editor (and then after that consistently saw the same error when trying to build from the command line). Happy to provide any build artifacts that are useful (this is on Windows 10 Pro 19042.928).\r\n\r\n```Rust\r\nuse rand::Rng;\r\nuse std::cmp::Ordering;\r\nuse std::io;\r\n\r\nfn main() {\r\n    println!(\"Guess the number!\");\r\n\r\n    let secret_number = rand::thread_rng().gen_range(1..101);\r\n\r\n    loop {\r\n        println!(\"Please input your guess.\");\r\n\r\n        let mut guess = String::new();\r\n\r\n        io::stdin()\r\n            .read_line(&mut guess)\r\n            .expect(\"Failed to read line\");\r\n\r\n        let guess: u32 = match guess.trim().parse() {\r\n            Ok(num) => num,\r\n            Err(_) => continue,\r\n        };\r\n\r\n        println!(\"You guessed: {}\", guess);\r\n\r\n        match guess.cmp(&secret_number) {\r\n            Ordering::Less => println!(\"Too small!\"),\r\n            Ordering::Greater => println!(\"Too big!\"),\r\n            Ordering::Equal => {\r\n                println!(\"You win!\");\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\n>rustc --version --verbose\r\nrustc 1.52.0 (88f19c6da 2021-05-03)\r\nbinary: rustc\r\ncommit-hash: 88f19c6dab716c6281af7602e30f413e809c5974\r\ncommit-date: 2021-05-03\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.52.0\r\nLLVM version: 12.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\n>cargo build --verbose\r\n       Fresh cfg-if v1.0.0\r\n       Fresh ppv-lite86 v0.2.10\r\n       Fresh getrandom v0.2.2\r\n       Fresh rand_core v0.6.2\r\n       Fresh rand_chacha v0.3.0\r\n       Fresh rand v0.8.3\r\n   Compiling guessing_game v0.1.0 (C:\\Users\\{username}\\code\\rust\\guessing_game)\r\n     Running `rustc --crate-name guessing_game --edition=2018 src\\main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 -C metadata=5c97f38c8efdf5da --out-dir C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps -C incremental=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\incremental -L dependency=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps --extern rand=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps\\librand-cf02a276127e463a.rlib`\r\nthread 'rustc' panicked at 'found unstable fingerprints for predicates_of(core[bd3a]::ops::deref::Deref): GenericPredicates { parent: None, predicates: [(Binder(TraitPredicate(<Self as std::ops::Deref>)), C:\\Users\\{username}\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib/rustlib/src/rust\\library\\core\\src\\ops\\deref.rs:64:1: 64:16 (#0))] }', /rustc/88f19c6dab716c6281af7602e30f413e809c5974\\compiler\\rustc_query_system\\src\\query\\plumbing.rs:593:5\r\n{backtrace moved to separate section}\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.52.0 (88f19c6da 2021-05-03) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C incremental --crate-type bin\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [predicates_of] computing predicates of `std::ops::Deref`\r\n#1 [typeck] type-checking `main`\r\n#2 [typeck_item_bodies] type-checking all item bodies\r\n#3 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: could not compile `guessing_game`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name guessing_game --edition=2018 src\\main.rs --error-format=json --json=diagnostic-rendered-ansi --crate-type bin --emit=dep-info,link -C embed-bitcode=no -C debuginfo=2 -C metadata=5c97f38c8efdf5da --out-dir C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps -C incremental=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\incremental -L dependency=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps --extern rand=C:\\Users\\{username}\\code\\rust\\guessing_game\\target\\debug\\deps\\librand-cf02a276127e463a.rlib` (exit code: 101)\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\nstack backtrace:\r\n   0:     0x7ffa6af581fe - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h3ee8647f7e1079db\r\n   1:     0x7ffa6af832fc - core::fmt::write::h37cf99794c5c88ee\r\n   2:     0x7ffa6af4bc58 - <std::io::IoSliceMut as core::fmt::Debug>::fmt::hbb31fdd82c487bf0\r\n   3:     0x7ffa6af5c39d - std::panicking::take_hook::he8d839f36ebc5025\r\n   4:     0x7ffa6af5be69 - std::panicking::take_hook::he8d839f36ebc5025\r\n   5:     0x7ffa4f11d9c7 - rustc_driver::report_ice::hc57d4e141f91d8a8\r\n   6:     0x7ffa6af5cbf5 - std::panicking::rust_panic_with_hook::h82b4e4f3be46852c\r\n   7:     0x7ffa6af5c761 - rust_begin_unwind\r\n   8:     0x7ffa6af58b4f - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h3ee8647f7e1079db\r\n   9:     0x7ffa6af5c6b9 - rust_begin_unwind\r\n  10:     0x7ffa6afb4dec - std::panicking::begin_panic_fmt::h3cee835f7be6e70f\r\n  11:     0x7ffa51cddffc - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  12:     0x7ffa51d05b44 - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  13:     0x7ffa51f3a91b - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  14:     0x7ffa51c1a290 - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  15:     0x7ffa51e5c18d - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  16:     0x7ffa53151c11 - rustc_middle::ty::generics::GenericPredicates::instantiate_own::h51d523cc130602b9\r\n  17:     0x7ffa53151617 - rustc_middle::ty::generics::GenericPredicates::instantiate::he2f245abffd92c7a\r\n  18:     0x7ffa517b3633 - rustc_typeck::check::method::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::lookup_method_in_trait::h262c595ae062c836\r\n  19:     0x7ffa517d0e74 - rustc_typeck::check::method::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::resolve_ufcs::hc84cae5416e458b0\r\n  20:     0x7ffa519584d6 - rustc_lint::context::LintStore::get_lints::h121906fa46b88a25\r\n  21:     0x7ffa51741978 - rustc_typeck::check::autoderef::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::adjust_steps::hfd03b1c5e67de876\r\n  22:     0x7ffa51820ba5 - rustc_typeck::check::inherited::Inherited::register_predicate::hb2a29cb9b7dd2d79\r\n  23:     0x7ffa517b1f84 - rustc_typeck::check::method::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::lookup_method::h9facae27a820694d\r\n  24:     0x7ffa51759916 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  25:     0x7ffa517592df - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  26:     0x7ffa517598d5 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  27:     0x7ffa517592df - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  28:     0x7ffa51740e65 - rustc_typeck::check::_match::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_match::h9f626a622567ce73\r\n  29:     0x7ffa5173e08e - rustc_typeck::check::_match::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_match::h9f626a622567ce73\r\n  30:     0x7ffa5175984d - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  31:     0x7ffa517592df - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  32:     0x7ffa51759141 - rustc_typeck::check::demand::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_for_cast::h547397e8d87f8fec\r\n  33:     0x7ffa5177c44f - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_decl_local::hf88eb3dd0a5e8b21\r\n  34:     0x7ffa5177c5c1 - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_stmt::h24e664f26b14ece2\r\n  35:     0x7ffa5177d041 - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_block_no_value::h04dadce00f98d3e8\r\n  36:     0x7ffa5177cbca - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_block_no_value::h04dadce00f98d3e8\r\n  37:     0x7ffa5175c8c1 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  38:     0x7ffa517592df - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  39:     0x7ffa5177d089 - rustc_typeck::check::fn_ctxt::checks::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_block_no_value::h04dadce00f98d3e8\r\n  40:     0x7ffa517592df - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  41:     0x7ffa51766534 - rustc_typeck::check::expr::<impl rustc_typeck::check::fn_ctxt::FnCtxt>::check_expr_with_expectation::ha3f484f82cb4a6ff\r\n  42:     0x7ffa51908cd1 - rustc_typeck::check::check::check_wf_new::h9c32b11c71de1be8\r\n  43:     0x7ffa51894488 - <rustc_typeck::astconv::ConvertedBindingKind as core::fmt::Debug>::fmt::h5519b26bf4527d33\r\n  44:     0x7ffa51925641 - <rustc_typeck::check::fixup_opaque_types::FixupFolder as rustc_middle::ty::fold::TypeFolder>::fold_ty::hd4ce30df61a3cf38\r\n  45:     0x7ffa51f22379 - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  46:     0x7ffa51e89989 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  47:     0x7ffa51f4bc88 - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  48:     0x7ffa51c8b3ea - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  49:     0x7ffa51bf1958 - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  50:     0x7ffa51e60082 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  51:     0x7ffa5181862b - <rustc_typeck::bounds::Bounds as core::fmt::Debug>::fmt::h5859ca23977fa056\r\n  52:     0x7ffa51926ff3 - <rustc_typeck::check::CheckItemTypesVisitor as rustc_hir::itemlikevisit::ItemLikeVisitor>::visit_item::h979a7c3a154b2bcd\r\n  53:     0x7ffa51f23ef9 - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  54:     0x7ffa51e8de3f - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  55:     0x7ffa51f5d56a - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  56:     0x7ffa51ca937b - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  57:     0x7ffa51be38db - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  58:     0x7ffa51e5ffc2 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  59:     0x7ffa51819389 - <rustc_typeck::bounds::Bounds as core::fmt::Debug>::fmt::h5859ca23977fa056\r\n  60:     0x7ffa51845ed7 - rustc_typeck::check_crate::ha5af7191d683cc6d\r\n  61:     0x7ffa4f270f2e - rustc_interface::passes::BoxedResolver::to_resolver_outputs::h7a1a389ffa8b4ef1\r\n  62:     0x7ffa51f23509 - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  63:     0x7ffa51e90b76 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  64:     0x7ffa51f527c7 - <rustc_query_impl::plumbing::QueryCtxt as rustc_query_system::query::QueryContext>::store_diagnostics_for_anon_node::h5397f0d33c4b219c\r\n  65:     0x7ffa51cb5cca - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  66:     0x7ffa51c1774e - <rustc_ast_lowering::item::ItemLowerer as rustc_ast::visit::Visitor>::visit_foreign_item::h8a641d9769f09835\r\n  67:     0x7ffa51e5bfd2 - <rustc_query_impl::Queries as rustc_middle::ty::query::QueryEngine>::try_print_query_stack::hcfeb9e88469194a3\r\n  68:     0x7ffa4f189809 - <rustc_driver::args::Error as core::fmt::Debug>::fmt::he9bb74d196e6a2c3\r\n  69:     0x7ffa4f136a2b - <rustc_middle::ty::SymbolName as core::fmt::Display>::fmt::hcb9f176ea80c3032\r\n  70:     0x7ffa4f1206cc - <rustc_driver::Compilation as core::fmt::Debug>::fmt::h5d81a6d2c7da3faa\r\n  71:     0x7ffa4f138637 - <rustc_middle::ty::SymbolName as core::fmt::Display>::fmt::hcb9f176ea80c3032\r\n  72:     0x7ffa4f127de4 - rustc_driver::pretty::print_after_hir_lowering::hfe86111045a339ee\r\n  73:     0x7ffa4f139bbf - <rustc_middle::ty::SymbolName as core::fmt::Display>::fmt::hcb9f176ea80c3032\r\n  74:     0x7ffa4f15929d - <rustc_middle::ty::SymbolName as core::fmt::Display>::fmt::hcb9f176ea80c3032\r\n  75:     0x7ffa6af6bc9a - std::sys::windows::thread::Thread::new::h171cad5aadd5b51e\r\n  76:     0x7ffabe467034 - BaseThreadInitThunk\r\n  77:     0x7ffabe702651 - RtlUserThreadStart\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n", "closed_by": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85070/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85070/timeline", "performed_via_github_app": null, "state_reason": "completed"}