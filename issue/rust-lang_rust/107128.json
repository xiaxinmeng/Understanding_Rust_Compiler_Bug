{"url": "https://api.github.com/repos/rust-lang/rust/issues/107128", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107128/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107128/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107128/events", "html_url": "https://github.com/rust-lang/rust/issues/107128", "id": 1551336972, "node_id": "I_kwDOAAsO6M5cd4YM", "number": 107128, "title": "unexpected panic with command line option `--extern`", "user": {"login": "michelou", "id": 1260870, "node_id": "MDQ6VXNlcjEyNjA4NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1260870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michelou", "html_url": "https://github.com/michelou", "followers_url": "https://api.github.com/users/michelou/followers", "following_url": "https://api.github.com/users/michelou/following{/other_user}", "gists_url": "https://api.github.com/users/michelou/gists{/gist_id}", "starred_url": "https://api.github.com/users/michelou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michelou/subscriptions", "organizations_url": "https://api.github.com/users/michelou/orgs", "repos_url": "https://api.github.com/users/michelou/repos", "events_url": "https://api.github.com/users/michelou/events{/privacy}", "received_events_url": "https://api.github.com/users/michelou/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2023-01-20T19:25:22Z", "updated_at": "2023-01-30T15:29:00Z", "closed_at": "2023-01-30T15:27:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Goal** : Build `imagetool` example using only `rustc.exe` without `Cargo.toml` (we specify the external dependency `image` as `rustc` option).\r\n\r\nHere is the compiler output : \r\n```\r\n> \"%USERPROFILE%\\.cargo\\bin\\rustc.exe\" --version\r\nrustc 1.66.1 (90743e729 2023-01-10)\r\n\r\n> \"%USERPROFILE%\\.cargo\\bin\\rustc.exe\" -g  --crate-name \"imagetool\" --crate-type bin --edition 2021 --out-dir \"R:\\mastering-rust\\Chapter02\\imgtool\\target\" --target \"x86_64-pc-windows-msvc\" -L crate --extern \"image=%USERPROFILE%\\.cargo\\registry\\cache\\github.com-1ecc6299db9ec823\\image-0.24.5.crate\"  \"R:\\mastering-rust\\Chapter02\\imgtool\\src\\main.rs\"\r\nthread 'rustc' panicked at 'identifier: \"metadata_crate_location_unknown_type\", attr: None, args: FluentArgs([(\"path\", String(\"%USERPROFILE%\\\\.cargo\\\\registry\\\\cache\\\\github.com-1ecc6299db9ec823\\\\image-0.24.5.crate\"))]), errors: [ResolverError(Reference(Variable { id: \"crate_name\" }))]', compiler\\rustc_errors\\src\\translation.rs:105:17\r\nstack backtrace:\r\n   0:     0x7ff935df9a62 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hc97dbc4fe64c9e1d\r\n   1:     0x7ff935e356db - core::fmt::write::ha369a394538739aa\r\n   2:     0x7ff935dec18a - <std::io::IoSlice as core::fmt::Debug>::fmt::h479b71bd3dadc1d1\r\n   3:     0x7ff935df97ab - std::sys::common::alloc::realloc_fallback::h233ebec439b629e2\r\n   4:     0x7ff935dfd109 - std::panicking::default_hook::h0ab9e14ad869b271\r\n   5:     0x7ff935dfcd8a - std::panicking::default_hook::h0ab9e14ad869b271\r\n   6:     0x7ff8cb0c1d6e - rustc_driver[e9de03b45d14c171]::describe_lints\r\n   7:     0x7ff935dfda60 - std::panicking::rust_panic_with_hook::he7a40468954ae645\r\n   8:     0x7ff935dfd7bd - <std::panicking::begin_panic_handler::StrPanicPayload as core::panic::BoxMeUp>::get::h44bc3105923add49\r\n   9:     0x7ff935dfa76f - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::hc97dbc4fe64c9e1d\r\n  10:     0x7ff935dfd480 - rust_begin_unwind\r\n  11:     0x7ff935e6b5f5 - core::panicking::panic_fmt::h1862038ee9bad685\r\n  12:     0x7ff8c97b9f06 - rustc_errors[20be445f3eba0fb3]::emitter::is_case_difference\r\n  13:     0x7ff8c97b1284 - <rustc_errors[20be445f3eba0fb3]::emitter::EmitterWriter>::ui_testing\r\n  14:     0x7ff8c97abbdc - <rustc_errors[20be445f3eba0fb3]::emitter::EmitterWriter as rustc_errors[20be445f3eba0fb3]::emitter::Emitter>::emit_diagnostic\r\n  15:     0x7ff8c97a4271 - <rustc_errors[20be445f3eba0fb3]::HandlerInner>::emit_diagnostic\r\n  16:     0x7ff8c97a36d2 - <rustc_errors[20be445f3eba0fb3]::Handler>::emit_diagnostic\r\n  17:     0x7ff8cd4935eb - <rustc_errors[20be445f3eba0fb3]::ErrorGuaranteed as rustc_errors[20be445f3eba0fb3]::diagnostic_builder::EmissionGuarantee>::diagnostic_builder_emit_producing_guarantee\r\n  18:     0x7ff8ccf9e10a - <rustc_metadata[dac8933e4ad73025]::errors::CannotFindCrate as rustc_errors[20be445f3eba0fb3]::diagnostic_builder::IntoDiagnostic>::into_diagnostic\r\n  19:     0x7ff8ccfb7e0b - <rustc_metadata[dac8933e4ad73025]::locator::MetadataError as core[a1be09f172195029]::fmt::Display>::fmt\r\n  20:     0x7ff8c954c1af - <rustc_metadata[dac8933e4ad73025]::creader::CrateLoader>::into_cstore\r\n  21:     0x7ff8c954e1c5 - <rustc_metadata[dac8933e4ad73025]::creader::CrateLoader>::process_path_extern\r\n  22:     0x7ff8ca5c669e - <rustc_resolve[7c01eaad461df3a4]::Resolver>::expect_module\r\n  23:     0x7ff8ca62397c - <<rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor>::find_lifetime_for_self::SelfVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  24:     0x7ff8ca62acae - <<rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor>::find_lifetime_for_self::SelfVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  25:     0x7ff8ca628a7e - <<rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor>::find_lifetime_for_self::SelfVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  26:     0x7ff8ca628b5d - <<rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor>::find_lifetime_for_self::SelfVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  27:     0x7ff8ca5f9264 - <rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_local\r\n  28:     0x7ff8ca5f8a1a - <rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_block\r\n  29:     0x7ff8ca601970 - <rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_fn\r\n  30:     0x7ff8ca651cf6 - <rustc_resolve[7c01eaad461df3a4]::build_reduced_graph::BuildReducedGraphVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  31:     0x7ff8ca611446 - <<rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor>::find_lifetime_for_self::SelfVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  32:     0x7ff8ca5f83dc - <rustc_resolve[7c01eaad461df3a4]::late::LateResolutionVisitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_item\r\n  33:     0x7ff8c919f092 - <rustc_builtin_macros[cca7005986e3d0e7]::deriving::generic::find_type_parameters::Visitor as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_ty\r\n  34:     0x7ff8c91b2447 - <rustc_resolve[7c01eaad461df3a4]::def_collector::DefCollector as rustc_ast[6de64748d468de7f]::visit::Visitor>::visit_param\r\n  35:     0x7ff8c91a81d1 - <rustc_resolve[7c01eaad461df3a4]::Resolver>::resolve_crate\r\n  36:     0x7ff8c8917b22 - <rustc_interface[10a7111f9310fd6d]::passes::LintStoreExpandImpl as rustc_expand[c56eb5aee4619b21]::base::LintStoreExpand>::pre_expansion_lint\r\n  37:     0x7ff8c890940e - <rustc_interface[10a7111f9310fd6d]::queries::Queries>::expansion\r\n  38:     0x7ff8c88dc477 - <rustc_middle[18c13081b174ae21]::ty::SymbolName as core[a1be09f172195029]::fmt::Display>::fmt\r\n  39:     0x7ff8c88db6dd - rustc_driver[e9de03b45d14c171]::args::arg_expand_all\r\n  40:     0x7ff8c88cc809 - <unknown>\r\n  41:     0x7ff8c88c3990 - <unknown>\r\n  42:     0x7ff935e0eabc - std::sys::windows::thread::Thread::new::haf1327b4da6a4ac1\r\n  43:     0x7ff9988026bd - BaseThreadInitThunk\r\n  44:     0x7ff9991adfb8 - RtlUserThreadStart\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\nnote: rustc 1.66.1 (90743e729 2023-01-10) running on x86_64-pc-windows-msvc\r\n\r\nnote: compiler flags: --crate-type bin\r\n\r\nquery stack during panic:\r\nend of query stack\r\n```\r\n\r\n**PS.** Rust source file `src\\main.rs` is : \r\n```rust\r\nuse std::env;\r\nuse std::path::Path;\r\nuse std::process;\r\n\r\nfn main() {\r\n    let arg = env::args().skip(1).next();\r\n    if arg.is_none() {\r\n        println!(\"Error: Missing argument specifying the image file\");\r\n        process::exit(1);\r\n    }\r\n    let image_path = arg.unwrap();\r\n    let path = Path::new(&image_path);\r\n    let img = image::open(path).unwrap();\r\n    let rotated = img.rotate90();\r\n    \r\n    // do not modify the input file\r\n    let out_path = Path::new(\"target\").join(path.file_name().unwrap());\r\n    rotated.save(out_path).unwrap();\r\n}\r\n```", "closed_by": {"login": "michelou", "id": 1260870, "node_id": "MDQ6VXNlcjEyNjA4NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1260870?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michelou", "html_url": "https://github.com/michelou", "followers_url": "https://api.github.com/users/michelou/followers", "following_url": "https://api.github.com/users/michelou/following{/other_user}", "gists_url": "https://api.github.com/users/michelou/gists{/gist_id}", "starred_url": "https://api.github.com/users/michelou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michelou/subscriptions", "organizations_url": "https://api.github.com/users/michelou/orgs", "repos_url": "https://api.github.com/users/michelou/repos", "events_url": "https://api.github.com/users/michelou/events{/privacy}", "received_events_url": "https://api.github.com/users/michelou/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107128/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107128/timeline", "performed_via_github_app": null, "state_reason": "completed"}