{"url": "https://api.github.com/repos/rust-lang/rust/issues/7972", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7972/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7972/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7972/events", "html_url": "https://github.com/rust-lang/rust/issues/7972", "id": 17061809, "node_id": "MDU6SXNzdWUxNzA2MTgwOQ==", "number": 7972, "title": "Double free with &mut pointers to temporaries", "user": {"login": "dotdash", "id": 230962, "node_id": "MDQ6VXNlcjIzMDk2Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/230962?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dotdash", "html_url": "https://github.com/dotdash", "followers_url": "https://api.github.com/users/dotdash/followers", "following_url": "https://api.github.com/users/dotdash/following{/other_user}", "gists_url": "https://api.github.com/users/dotdash/gists{/gist_id}", "starred_url": "https://api.github.com/users/dotdash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dotdash/subscriptions", "organizations_url": "https://api.github.com/users/dotdash/orgs", "repos_url": "https://api.github.com/users/dotdash/repos", "events_url": "https://api.github.com/users/dotdash/events{/privacy}", "received_events_url": "https://api.github.com/users/dotdash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 100522, "node_id": "MDU6TGFiZWwxMDA1MjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-crash", "name": "I-crash", "color": "e10c02", "default": false, "description": "Issue: The compiler crashes (SIGSEGV, SIGABRT, etc). Use I-ICE instead when the compiler panics."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/20", "html_url": "https://github.com/rust-lang/rust/milestone/20", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/20/labels", "id": 452034, "node_id": "MDk6TWlsZXN0b25lNDUyMDM0", "number": 20, "title": "1.0", "description": "This will be the first major release of Rust, where we offer some guaranteed level of support and backwards compatibility.\r\n\r\nThe significant criteria for this release are:\r\n\r\n* Language backwards compatibility - All major features are in, and in their final form. Generally, the only new language features added after this milestone must be backwards compatible, or to fix soundness holes, though we do expect to have some leeway to make small incompatible fixes that have low impact on existing code bases.\r\n\r\n* Library stability - We have a system of measuring and ensuring the stability of API's, and a significant portion of the standard library is declared stable. Stable API's will not change. Large portions of the standard library need to be stable for 1.0, including primitive types, vectors, strings, option, numerics, collections, some I/O and concurrency.\r\n\r\n* User experience - The system is polished and the presentation is complete and professional. New users have a clear path to using and learning the system. This encompasses the web site, documentation, installation, and tooling.\r\n", "creator": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 376, "state": "closed", "created_at": "2013-10-10T18:48:33Z", "updated_at": "2016-08-28T23:13:24Z", "due_on": "2015-05-15T07:00:00Z", "closed_at": "2015-05-21T20:59:13Z"}, "comments": 4, "created_at": "2013-07-22T18:11:35Z", "updated_at": "2013-10-17T22:01:27Z", "closed_at": "2013-10-17T22:01:27Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "``` rust\nfn foo(x: &mut ~u8) {\n    *x = ~5;\n}\n\nfn main() {\n    foo(&mut ~4);\n}\n```\n\ncrashes with a double free, because the glue call in `main` tries to free the originally allocated memory that was already freed by the assignment in `foo`.\n\n``` llvm\ndefine void @\"_ZN4main16_9c508369d68e95d7_0$x2e0E\"({ i64, %tydesc*, i8*, i8*, i8 }*) #4 {\n\"function top level\":\n  %1 = alloca i8*\n  %2 = alloca { i8*, i32 }\n  %3 = alloca i8*\n  %4 = alloca i8*\n  %5 = call i8* @\"_ZN2rt11global_heap15exchange_malloc16_a0e6b1fccad656a7_0$x2e0E\"({ i64, %tydesc*, i8*, i8*, i8 }* undef, i64 1)\n  store i8 4, i8* %5\n  store i8* %5, i8** %1\n  invoke void @\"_ZN3foo17_6b2c235046b35a5e7_0$x2e0E\"({ i64, %tydesc*, i8*, i8*, i8 }* undef, i8** %1)\n          to label %\"normal return\" unwind label %unwind\n\n\"normal return\":                                  ; preds = %\"function top level\"\n  store i8* %5, i8** %4\n  %6 = bitcast i8** %4 to i32**\n  call void @\"_ZN8_$UP$u3217_7656cd521ad1a3b614glue_free_3306E\"({}* null, i32** %6)\n  ret void\n\nunwind:                                           ; preds = %\"function top level\"\n  %7 = landingpad { i8*, i32 } personality i32 ()* @upcall_rust_personality\n          cleanup\n  call void @upcall_reset_stack_limit()\n  store { i8*, i32 } %7, { i8*, i32 }* %2\n  br label %cleanup\n\ncleanup:                                          ; preds = %unwind\n  store i8* %5, i8** %3     // BAD: %5 the original value, not the new one\n  %8 = bitcast i8** %3 to i32**\n  call void @\"_ZN8_$UP$u3217_7656cd521ad1a3b614glue_free_3306E\"({}* null, i32** %8)\n  %9 = load { i8*, i32 }* %2\n  resume { i8*, i32 } %9\n}\n```\n", "closed_by": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7972/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7972/timeline", "performed_via_github_app": null, "state_reason": "completed"}