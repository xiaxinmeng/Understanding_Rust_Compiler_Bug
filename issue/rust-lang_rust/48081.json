{"url": "https://api.github.com/repos/rust-lang/rust/issues/48081", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48081/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48081/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48081/events", "html_url": "https://github.com/rust-lang/rust/issues/48081", "id": 295695958, "node_id": "MDU6SXNzdWUyOTU2OTU5NTg=", "number": 48081, "title": "[rustc panic:ed] associated constant ", "user": {"login": "niklasad1", "id": 14157425, "node_id": "MDQ6VXNlcjE0MTU3NDI1", "avatar_url": "https://avatars.githubusercontent.com/u/14157425?v=4", "gravatar_id": "", "url": "https://api.github.com/users/niklasad1", "html_url": "https://github.com/niklasad1", "followers_url": "https://api.github.com/users/niklasad1/followers", "following_url": "https://api.github.com/users/niklasad1/following{/other_user}", "gists_url": "https://api.github.com/users/niklasad1/gists{/gist_id}", "starred_url": "https://api.github.com/users/niklasad1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/niklasad1/subscriptions", "organizations_url": "https://api.github.com/users/niklasad1/orgs", "repos_url": "https://api.github.com/users/niklasad1/repos", "events_url": "https://api.github.com/users/niklasad1/events{/privacy}", "received_events_url": "https://api.github.com/users/niklasad1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-02-08T22:58:35Z", "updated_at": "2018-03-08T11:33:51Z", "closed_at": "2018-03-08T11:33:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Summary\r\nI tried the following snippet:\r\n\r\n```rustc\r\n                self.dest.map_or_else(\r\n                    || {\r\n                        debug!(\"Called write_block() with no data\");\r\n                        false\r\n                    },\r\n                    |dest| {\r\n                        let index = self.write_index.get();\r\n                        let more = index + AES128::BLOCK_SIZE <= self.stop_index.get();\r\n                        if !more {\r\n                            return false;\r\n                        }\r\n                        let regs: &mut AesRegisters = unsafe { mem::transmute(self.registers) };\r\n                        for i in 0..4 {\r\n                            let mut v = dest[index + (i * 4) + 0] as usize;\r\n                            v |= (dest[index + (i * 4) + 1] as usize) << 8;\r\n                            v |= (dest[index + (i * 4) + 2] as usize) << 16;\r\n                            v |= (dest[index + (i * 4) + 3] as usize) << 24;\r\n                            regs.idata.set(v as u32);\r\n                        }\r\n                        self.write_index.set(index + AES128::BLOCK_SIZE);\r\n\r\n                        let more =\r\n                            self.write_index.get() + AES128::BLOCK_SIZE <= self.stop_index.get();\r\n                        more\r\n                    },\r\n                )\r\n```\r\n## Expected\r\n\r\nNot a compiler crash\r\n\r\n## Outcome\r\n\r\n```\r\nerror[E0283]: type annotations required: cannot resolve `_: kernel::hil::symmetric_encryption::AES128<'_>`\r\n   --> /home/niklasad1/tock/chips/sam4l/src/aes.rs:211:44\r\n    |\r\n211 |                         let more = index + AES128::BLOCK_SIZE <= self.stop_index.get();\r\n    |                                            ^^^^^^^^^^^^^^^^^^\r\n    |\r\n    = note: required by `kernel::hil::symmetric_encryption::AES128::BLOCK_SIZE`\r\n\r\nerror: internal compiler error: /checkout/src/librustc/traits/trans/mod.rs:62: Encountered ambiguity selecting `Binder(<[type error] as kernel::hil::symmetric_encryption::AES128>)` during trans, presuming due to overflow\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.24.0-nightly (8e7a609e6 2018-01-04) running on x86_64-unknown-linux-gnu\r\n\r\nthread 'rustc' panicked at 'Box<Any>', /checkout/src/librustc_errors/lib.rs:504:9\r\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\r\n```\r\n\r\n### Backtrace\r\n```\r\nstack backtrace:\r\n   0:     0x7fa41ef5bbfb - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h91d1666c6327d52b\r\n                               at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:     0x7fa41ef6a7be - std::sys_common::backtrace::print::h66e8f3310af6a54c\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:68\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:57\r\n   2:     0x7fa41ef47680 - std::panicking::default_hook::{{closure}}::h7a402dd600c5b3cc\r\n                               at /checkout/src/libstd/panicking.rs:381\r\n   3:     0x7fa41ef47143 - std::panicking::default_hook::hc7cfa94336f822ac\r\n                               at /checkout/src/libstd/panicking.rs:391\r\n   4:     0x7fa41ef47acb - std::panicking::rust_panic_with_hook::h7bb2af2582fdefca\r\n                               at /checkout/src/libstd/panicking.rs:577\r\n   5:     0x7fa4198f0d47 - std::panicking::begin_panic::h050149da9cc7f772\r\n   6:     0x7fa41990b681 - rustc_errors::Handler::bug::hfa625afa9f723db3\r\n   7:     0x7fa41acd9eff - <std::thread::local::LocalKey<T>>::with::h543ce26cfb6f50bf\r\n   8:     0x7fa41b0c864e - rustc::ty::context::tls::with_opt::h6878b003f8522a9e\r\n   9:     0x7fa41ac0abd7 - rustc::session::opt_span_bug_fmt::hc8994976b9fd9c44\r\n  10:     0x7fa41ac0aae6 - rustc::session::bug_fmt::ha9ee1b22a61f2e60\r\n  11:     0x7fa41ace3ff4 - <std::thread::local::LocalKey<T>>::with::hc56362f2e196171c\r\n  12:     0x7fa41aacf9f8 - rustc::ty::context::GlobalCtxt::enter_local::ha46ec5fc488a532a\r\n  13:     0x7fa41b0711d7 - rustc::traits::trans::trans_fulfill_obligation::h36d04a4b73b138da\r\n  14:     0x7fa41af73551 - rustc::ty::maps::<impl rustc::ty::maps::queries::trans_fulfill_obligation<'tcx>>::compute_result::h3a5709afd05411f6\r\n  15:     0x7fa41aeaa80b - rustc::dep_graph::graph::DepGraph::with_task_impl::h3594064c92f10ee3\r\n  16:     0x7fa41ab94e1f - rustc_errors::Handler::track_diagnostics::h212e44cb9f6613a7\r\n  17:     0x7fa41aab7a40 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::hdb86a4c730046d0c\r\n  18:     0x7fa41af735f4 - rustc::ty::maps::<impl rustc::ty::maps::queries::trans_fulfill_obligation<'tcx>>::force::h280621a9d1094134\r\n  19:     0x7fa41af74178 - rustc::ty::maps::<impl rustc::ty::maps::queries::trans_fulfill_obligation<'tcx>>::try_get::h36d73c6793bed8fd\r\n  20:     0x7fa41ad78d88 - rustc::ty::maps::TyCtxtAt::trans_fulfill_obligation::h3b01c51eba8ba696\r\n  21:     0x7fa41af1456f - rustc::ty::instance::Instance::resolve::ha42785737c9d07b1\r\n  22:     0x7fa41b8a0bf5 - rustc_const_eval::eval::lookup_const_by_id::h235481ee0dad229a\r\n  23:     0x7fa41be46fae - rustc_mir::interpret::const_eval::const_eval_provider::he61ff6eb78749b4c\r\n  24:     0x7fa41af52911 - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::compute_result::hd372dc799ddc81ba\r\n  25:     0x7fa41aebdedb - rustc::dep_graph::graph::DepGraph::with_task_impl::h7d18d69d2b29c6ea\r\n  26:     0x7fa41abaf2cf - rustc_errors::Handler::track_diagnostics::ha705e0db47c7e786\r\n  27:     0x7fa41aabe750 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::hf369de754f658497\r\n  28:     0x7fa41af529ab - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::force::hfe662e34cd1da2c1\r\n  29:     0x7fa41af534c5 - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::try_get::h6b701d0550a2baf8\r\n  30:     0x7fa41ad77858 - rustc::ty::maps::TyCtxtAt::const_eval::h55d029a49f1964dd\r\n  31:     0x7fa41b8a209b - rustc_const_eval::eval::eval_const_expr_partial::hba9bae625532d936\r\n  32:     0x7fa41b8a0c9b - rustc_const_eval::eval::ConstContext::eval::h88555953a4be0435\r\n  33:     0x7fa41be4725d - rustc_mir::interpret::const_eval::const_eval_provider::he61ff6eb78749b4c\r\n  34:     0x7fa41af52911 - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::compute_result::hd372dc799ddc81ba\r\n  35:     0x7fa41aebdedb - rustc::dep_graph::graph::DepGraph::with_task_impl::h7d18d69d2b29c6ea\r\n  36:     0x7fa41abaf2cf - rustc_errors::Handler::track_diagnostics::ha705e0db47c7e786\r\n  37:     0x7fa41aabe750 - rustc::ty::maps::plumbing::<impl rustc::ty::context::TyCtxt<'a, 'gcx, 'tcx>>::cycle_check::hf369de754f658497\r\n  38:     0x7fa41af529ab - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::force::hfe662e34cd1da2c1\r\n  39:     0x7fa41af534c5 - rustc::ty::maps::<impl rustc::ty::maps::queries::const_eval<'tcx>>::try_get::h6b701d0550a2baf8\r\n  40:     0x7fa41ad77858 - rustc::ty::maps::TyCtxtAt::const_eval::h55d029a49f1964dd\r\n  41:     0x7fa41af016f2 - <rustc::traits::project::AssociatedTypeNormalizer<'a, 'b, 'gcx, 'tcx> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_const::h367c7dcc2822faf4\r\n  42:     0x7fa41ac35469 - rustc::ty::structural_impls::<impl rustc::ty::fold::TypeFoldable<'tcx> for &'tcx rustc::ty::TyS<'tcx>>::super_fold_with::hbbcbd16bc6f9410d\r\n  43:     0x7fa41af00d79 - <rustc::traits::project::AssociatedTypeNormalizer<'a, 'b, 'gcx, 'tcx> as rustc::ty::fold::TypeFolder<'gcx, 'tcx>>::fold_ty::he448e45aef860a24\r\n  44:     0x7fa41d55af9f - rustc::traits::project::normalize::h1a189fdb64aef9cc\r\n  45:     0x7fa41d468e2c - rustc::infer::InferCtxt::partially_normalize_associated_types_in::h66d802a5e340389e\r\n  46:     0x7fa41d4b8f5a - <std::thread::local::LocalKey<T>>::with::h15b2117ec1c7d041\r\n  47:     0x7fa41d45df74 - rustc::infer::InferCtxtBuilder::enter::hd970daac5fcaeb5c\r\n  48:     0x7fa41d4d633c - rustc_typeck::check::wfcheck::CheckTypeWellFormedVisitor::check_item_type::h7c821f3c0df87f83\r\n  49:     0x7fa41d4d7fec - <rustc_typeck::check::wfcheck::CheckTypeWellFormedVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'v>>::visit_item::h9ec08c5b3cd06f28\r\n  50:     0x7fa41d5aa6bc - rustc::hir::Crate::visit_all_item_likes::h2ee6e7a157d04a3b\r\n  51:     0x7fa41d5327e7 - rustc::session::Session::track_errors::h1f6a33d2e50a3c3c\r\n  52:     0x7fa41d5803b5 - rustc_typeck::check_crate::hb09122b4ee79ea95\r\n  53:     0x7fa41f389717 - <std::thread::local::LocalKey<T>>::with::hc6fb6087df81e9d2\r\n  54:     0x7fa41f3871d6 - <std::thread::local::LocalKey<T>>::with::h836036c2a71f0071\r\n  55:     0x7fa41f3de607 - rustc::ty::context::TyCtxt::create_and_enter::hb73d12258cf88a3c\r\n  56:     0x7fa41f33ef3a - rustc_driver::driver::compile_input::h9deb377f84422e28\r\n  57:     0x7fa41f3b4500 - rustc_driver::run_compiler::h7957e266f41bd133\r\n  58:     0x7fa41f2f9af1 - std::sys_common::backtrace::__rust_begin_short_backtrace::hca871f110f764e5c\r\n  59:     0x7fa41ef933ae - __rust_maybe_catch_panic\r\n                               at /checkout/src/libpanic_unwind/lib.rs:101\r\n  60:     0x7fa41f2d8972 - <F as alloc::boxed::FnBox<A>>::call_box::h21ccf4de9d93f71f\r\n  61:     0x7fa41ef6d087 - std::sys_common::thread::start_thread::h95c8df0df264c758\r\n                               at /checkout/src/liballoc/boxed.rs:827\r\n                               at /checkout/src/libstd/sys_common/thread.rs:24\r\n  62:     0x7fa41ef71498 - std::sys::unix::thread::Thread::new::thread_start::hc1ac9245a2c79957\r\n                               at /checkout/src/libstd/sys/unix/thread.rs:90\r\n  63:     0x7fa418e357fb - start_thread\r\n  64:     0x7fa41ec31b5e - clone\r\n  65:                0x0 - <unknown>\r\n```\r\n\r\nThanks", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48081/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48081/timeline", "performed_via_github_app": null, "state_reason": "completed"}