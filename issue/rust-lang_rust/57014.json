{"url": "https://api.github.com/repos/rust-lang/rust/issues/57014", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57014/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57014/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57014/events", "html_url": "https://github.com/rust-lang/rust/issues/57014", "id": 393156744, "node_id": "MDU6SXNzdWUzOTMxNTY3NDQ=", "number": 57014, "title": "Rustc_driver cann't correctly find codegen dirs with multiple subfolders in libdir.", "user": {"login": "o01eg", "id": 397177, "node_id": "MDQ6VXNlcjM5NzE3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/397177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/o01eg", "html_url": "https://github.com/o01eg", "followers_url": "https://api.github.com/users/o01eg/followers", "following_url": "https://api.github.com/users/o01eg/following{/other_user}", "gists_url": "https://api.github.com/users/o01eg/gists{/gist_id}", "starred_url": "https://api.github.com/users/o01eg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/o01eg/subscriptions", "organizations_url": "https://api.github.com/users/o01eg/orgs", "repos_url": "https://api.github.com/users/o01eg/repos", "events_url": "https://api.github.com/users/o01eg/events{/privacy}", "received_events_url": "https://api.github.com/users/o01eg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 116993, "node_id": "MDU6TGFiZWwxMTY5OTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-driver", "name": "A-driver", "color": "f7e101", "default": false, "description": "Area: rustc_driver that ties everything together into the `rustc` compiler"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-12-20T18:11:40Z", "updated_at": "2019-08-08T06:39:56Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When rust compiled and installed with multiple subfolders in libdir it cann't correctly found directory with codegen-backends. See https://github.com/rust-lang/rust-clippy/issues/3565\r\n\r\n```rust\r\n        // use `parent` twice to chop off the file name and then also the\r\n        // directory containing the dll which should be either `lib` or `bin`.\r\n        if let Some(path) = dll.parent().and_then(|p| p.parent()) {\r\n```\r\nhttps://github.com/rust-lang/rust/blob/master/src/librustc_driver/lib.rs#L302\r\n\r\nIt would be work if `rustc_driver` was placed in `/usr/lib64/librustc_driver-62d9b292bf74f4a6.so` so it get `/usr` as sysroot but it placed in `/usr/lib64/rust-9999/librustc_driver-62d9b292bf74f4a6.so` so it get incorrect `/usr/lib64`.\r\n\r\nI suppose it could be two possible solutions: The first is about to iterate parents until root will be reached. The second is to calculate number of parents need to be removed with `find_libdir` from `filesearch.rs`. Which are better or there are some other ways to solve this?\r\n\r\nP.S. Looks like it doesn't fail for system-wide installed rustc and clippy because `filesearch::get_or_default_sysroot` got correct `/usr` sysroot from binaries in `/usr/bin`. If them will be moved same way as `gcc` in Gentoo it will break as well:\r\n```bash\r\n$ echo `which gcc`\r\n/usr/x86_64-pc-linux-gnu/gcc-bin/7.3.0/gcc\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57014/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57014/timeline", "performed_via_github_app": null, "state_reason": null}