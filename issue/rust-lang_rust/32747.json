{"url": "https://api.github.com/repos/rust-lang/rust/issues/32747", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/32747/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/32747/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/32747/events", "html_url": "https://github.com/rust-lang/rust/issues/32747", "id": 146028046, "node_id": "MDU6SXNzdWUxNDYwMjgwNDY=", "number": 32747, "title": "`unsafe{}` when used in macros can emit \"unnecessary `unsafe` block\" warning without macro invocation location", "user": {"login": "jmesmon", "id": 103437, "node_id": "MDQ6VXNlcjEwMzQzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/103437?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmesmon", "html_url": "https://github.com/jmesmon", "followers_url": "https://api.github.com/users/jmesmon/followers", "following_url": "https://api.github.com/users/jmesmon/following{/other_user}", "gists_url": "https://api.github.com/users/jmesmon/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmesmon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmesmon/subscriptions", "organizations_url": "https://api.github.com/users/jmesmon/orgs", "repos_url": "https://api.github.com/users/jmesmon/repos", "events_url": "https://api.github.com/users/jmesmon/events{/privacy}", "received_events_url": "https://api.github.com/users/jmesmon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-04-05T15:41:08Z", "updated_at": "2017-05-02T21:33:41Z", "closed_at": "2017-05-02T21:33:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The warning itself could be resolved by `stmt_expr_attributes` (once it is stable) by marking the inner `unsafe{}` as OK to be unneeded. (If we don't stabilize those, though, we may want to consider whether applying the `unused_unsafe` warning to `unsafe{}` generated by macros makes sense.\n\nIn any case, we should get an indication of where the macro expansion causing the error is occurring (right now only the macro location is printed, not the invocation location).\n\nTested with `rustc 1.9.0-nightly (600dc3552 2016-04-04)`\n\nExample:\n\n```\n\nmacro_rules! another_unsafe {\n    ($e:expr) => ({\n        unsafe { $e }\n    })\n}\n\nfn main() {\n    let x : usize = unsafe { another_unsafe!(std::mem::transmute(3usize)) };\n    println!(\"{:?}\", x);\n}\n```\n\nOutput:\n\n```\nsrc/main.rs:4:9: 4:22 warning: unnecessary `unsafe` block, #[warn(unused_unsafe)] on by default\nsrc/main.rs:4         unsafe { $e }\n                      ^~~~~~~~~~~~~\n```\n\nExpected: some complaint about line 9 (invocation of `another_unsafe!`)\n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/32747/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/32747/timeline", "performed_via_github_app": null, "state_reason": "completed"}