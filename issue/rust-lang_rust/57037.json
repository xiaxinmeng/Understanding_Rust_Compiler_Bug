{"url": "https://api.github.com/repos/rust-lang/rust/issues/57037", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57037/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57037/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57037/events", "html_url": "https://github.com/rust-lang/rust/issues/57037", "id": 393441920, "node_id": "MDU6SXNzdWUzOTM0NDE5MjA=", "number": 57037, "title": "Buld for target powerpc-unknown-netbsd fails in 1.31.1; other powerpc targets also fail in the same way in later versions", "user": {"login": "he32", "id": 1199501, "node_id": "MDQ6VXNlcjExOTk1MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1199501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/he32", "html_url": "https://github.com/he32", "followers_url": "https://api.github.com/users/he32/followers", "following_url": "https://api.github.com/users/he32/following{/other_user}", "gists_url": "https://api.github.com/users/he32/gists{/gist_id}", "starred_url": "https://api.github.com/users/he32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/he32/subscriptions", "organizations_url": "https://api.github.com/users/he32/orgs", "repos_url": "https://api.github.com/users/he32/repos", "events_url": "https://api.github.com/users/he32/events{/privacy}", "received_events_url": "https://api.github.com/users/he32/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 311417590, "node_id": "MDU6TGFiZWwzMTE0MTc1OTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-netbsd", "name": "O-netbsd", "color": "6e6ec0", "default": false, "description": "Operating system: NetBSD"}, {"id": 515028847, "node_id": "MDU6TGFiZWw1MTUwMjg4NDc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-PowerPC", "name": "O-PowerPC", "color": "6e6ec0", "default": false, "description": "Target: PowerPC processors"}, {"id": 602425123, "node_id": "MDU6TGFiZWw2MDI0MjUxMjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-dev-tools", "name": "T-dev-tools", "color": "bfd4f2", "default": false, "description": "Relevant to the dev-tools subteam, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-12-21T12:27:53Z", "updated_at": "2022-07-19T01:01:33Z", "closed_at": "2022-07-19T01:01:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "While release 1.31.1 of rust fixes the build issue reported in #55465, a new issue arises instead: the  `rls` part of the build now uses AtomicU64, which is not natively supported on 32-bit powerpc, so the build fails with\r\n\r\n`no 'AtomicU64' in 'sync::atomic'. Did you mean to use 'AtomicU8'?`\r\n\r\nThe following rather crude pair of patches makes the build complete for the target again, but obviously something is lost along the way -- whether that is crucial I am not able to tell myself.\r\n\r\n```\r\n--- src/tools/rls/src/cmd.rs.orig       2018-12-18 23:12:41.000000000 +0000\r\n+++ src/tools/rls/src/cmd.rs\r\n@@ -17,7 +17,7 @@ use crate::config::Config;\r\n use crate::server::{self, LsService, Notification, Request, RequestId};\r\n use rls_analysis::{AnalysisHost, Target};\r\n use rls_vfs::Vfs;\r\n-use std::sync::atomic::{AtomicU64, Ordering};\r\n+use std::sync::atomic::{AtomicU32, Ordering};\r\n \r\n use languageserver_types::{\r\n     ClientCapabilities, CodeActionContext, CodeActionParams, CompletionItem,\r\n@@ -424,8 +424,8 @@ fn url(file_name: &str) -> Url {\r\n }\r\n \r\n fn next_id() -> RequestId {\r\n-    static ID: AtomicU64 = AtomicU64::new(1);\r\n-    RequestId::Num(ID.fetch_add(1, Ordering::SeqCst))\r\n+    static ID: AtomicU32 = AtomicU32::new(1);\r\n+    RequestId::Num(ID.fetch_add(1, Ordering::SeqCst) as u64)\r\n }\r\n \r\n // Custom reader and output for the RLS server.\r\n--- src/tools/rls/src/server/io.rs.orig 2018-12-18 23:12:41.000000000 +0000\r\n+++ src/tools/rls/src/server/io.rs\r\n@@ -17,7 +17,7 @@ use crate::lsp_data::{LSPNotification, L\r\n \r\n use std::fmt;\r\n use std::io::{self, BufRead, Write};\r\n-use std::sync::atomic::{AtomicU64, Ordering};\r\n+use std::sync::atomic::{AtomicU32, Ordering};\r\n use std::sync::Arc;\r\n \r\n use jsonrpc_core::{self as jsonrpc, response, version, Id};\r\n@@ -190,14 +190,14 @@ pub trait Output: Sync + Send + Clone + \r\n /// An output that sends notifications and responses on `stdout`.\r\n #[derive(Clone)]\r\n pub(super) struct StdioOutput {\r\n-    next_id: Arc<AtomicU64>,\r\n+    next_id: Arc<AtomicU32>,\r\n }\r\n \r\n impl StdioOutput {\r\n     /// Construct a new `stdout` output.\r\n     crate fn new() -> StdioOutput {\r\n         StdioOutput {\r\n-            next_id: Arc::new(AtomicU64::new(1)),\r\n+            next_id: Arc::new(AtomicU32::new(1)),\r\n         }\r\n     }\r\n }\r\n@@ -215,7 +215,7 @@ impl Output for StdioOutput {\r\n     }\r\n \r\n     fn provide_id(&self) -> RequestId {\r\n-        RequestId::Num(self.next_id.fetch_add(1, Ordering::SeqCst))\r\n+        RequestId::Num(self.next_id.fetch_add(1, Ordering::SeqCst) as u64)\r\n     }\r\n }\r\n \r\n```\r\n\r\nThis is also probably related to issue #56753.\r\n", "closed_by": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57037/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57037/timeline", "performed_via_github_app": null, "state_reason": "not_planned"}