{"url": "https://api.github.com/repos/rust-lang/rust/issues/46361", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/46361/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/46361/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/46361/events", "html_url": "https://github.com/rust-lang/rust/issues/46361", "id": 277704468, "node_id": "MDU6SXNzdWUyNzc3MDQ0Njg=", "number": 46361, "title": "Error compiling problem case #4 from nll-rfc", "user": {"login": "fpoli", "id": 4523232, "node_id": "MDQ6VXNlcjQ1MjMyMzI=", "avatar_url": "https://avatars.githubusercontent.com/u/4523232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fpoli", "html_url": "https://github.com/fpoli", "followers_url": "https://api.github.com/users/fpoli/followers", "following_url": "https://api.github.com/users/fpoli/following{/other_user}", "gists_url": "https://api.github.com/users/fpoli/gists{/gist_id}", "starred_url": "https://api.github.com/users/fpoli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fpoli/subscriptions", "organizations_url": "https://api.github.com/users/fpoli/orgs", "repos_url": "https://api.github.com/users/fpoli/repos", "events_url": "https://api.github.com/users/fpoli/events{/privacy}", "received_events_url": "https://api.github.com/users/fpoli/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 67766349, "node_id": "MDU6TGFiZWw2Nzc2NjM0OQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-mentor", "name": "E-mentor", "color": "02E10C", "default": false, "description": "Call for participation: This issue has a mentor. Use RustcContributor::new on Zulip for discussion."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2017-11-29T10:37:08Z", "updated_at": "2019-02-06T16:18:03Z", "closed_at": "2018-02-02T19:55:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "UPDATE: This example works now, but needs someone to add a test. See [mentoring instructions](https://github.com/rust-lang/rust/issues/46361#issuecomment-357991656) below.\r\n\r\n---\r\n\r\nI'm trying to compile some examples using nonlexical lifetimes. To do so, I'm compiling rustc using the `master` branch, and the `-Z nll` compiler option.\r\n\r\n```\r\nrustc 1.24.0-dev\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.24.0-dev\r\nLLVM version: 4.0\r\n```\r\n\r\nBy compiling \"Problem case 4: mutating &mut references\" from [nll-rfc](https://github.com/nikomatsakis/nll-rfc/blob/master/0000-nonlexical-lifetimes.md), I get some errors.\r\n\r\n<details>\r\n<summary>Program</summary>\r\n\r\n```rust\r\nstruct List<T> {\r\n    value: T,\r\n    next: Option<Box<List<T>>>,\r\n}\r\n\r\nfn to_refs<T>(mut list: &mut List<T>) -> Vec<&mut T> {\r\n    let mut result = vec![];\r\n    loop {\r\n        result.push(&mut list.value);\r\n        if let Some(n) = list.next.as_mut() {\r\n            list = &mut n;\r\n        } else {\r\n            return result;\r\n        }\r\n    }\r\n}\r\n\r\nfn main() {\r\n    println!(\"Hello World!\");\r\n}\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Output of `rustc -g -Zverbose -Znll nll-problem-case-4.rs`:</summary>\r\n\r\n```\r\nerror[E0597]: `n` does not live long enough\r\n  --> nll-problem-case-4.rs:11:25\r\n   |\r\n11 |             list = &mut n;\r\n   |                         ^ does not live long enough\r\n...\r\n14 |         }\r\n   |         - borrowed value only lives until here\r\n   |\r\nnote: borrowed value must be valid for the anonymous lifetime #1 defined on the function body at 6:1...\r\n  --> nll-problem-case-4.rs:6:1\r\n   |\r\n6  | / fn to_refs<T>(mut list: &mut List<T>) -> Vec<&mut T> {\r\n7  | |     let mut result = vec![];\r\n8  | |     loop {\r\n9  | |         result.push(&mut list.value);\r\n...  |\r\n15 | |     }\r\n16 | | }\r\n   | |_^\r\n\r\nerror[E0499]: cannot borrow `list.value` as mutable more than once at a time\r\n  --> nll-problem-case-4.rs:9:26\r\n   |\r\n9  |         result.push(&mut list.value);\r\n   |                          ^^^^^^^^^^ mutable borrow starts here in previous iteration of loop\r\n...\r\n16 | }\r\n   | - mutable borrow ends here\r\n\r\nerror[E0499]: cannot borrow `list.next` as mutable more than once at a time\r\n  --> nll-problem-case-4.rs:10:26\r\n   |\r\n10 |         if let Some(n) = list.next.as_mut() {\r\n   |                          ^^^^^^^^^ mutable borrow starts here in previous iteration of loop\r\n...\r\n16 | }\r\n   | - mutable borrow ends here\r\n\r\nerror[E0506]: cannot assign to `list` because it is borrowed\r\n  --> nll-problem-case-4.rs:11:13\r\n   |\r\n9  |         result.push(&mut list.value);\r\n   |                          ---------- borrow of `list` occurs here\r\n10 |         if let Some(n) = list.next.as_mut() {\r\n11 |             list = &mut n;\r\n   |             ^^^^^^^^^^^^^ assignment to borrowed `list` occurs here\r\n\r\nerror: aborting due to 4 previous errors\r\n```\r\n\r\n</details>\r\n\r\n<br/>\r\n\r\nMy questions are:\r\n- Am I enabling correctly the experimental nll? What confuses me is that I compiled `rustc` with `./configure --enable-debug --enable-debuginfo`, but I still don't see the `debug!(\"mir_borrowck done\");` message from the compiler.\r\n- Is \"problem case 4\" supposed to compile without errors in the future, when nll will be stable?\r\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/46361/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/46361/timeline", "performed_via_github_app": null, "state_reason": "completed"}