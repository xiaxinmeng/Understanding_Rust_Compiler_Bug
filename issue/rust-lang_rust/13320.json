{"url": "https://api.github.com/repos/rust-lang/rust/issues/13320", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/13320/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/13320/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/13320/events", "html_url": "https://github.com/rust-lang/rust/issues/13320", "id": 30882169, "node_id": "MDU6SXNzdWUzMDg4MjE2OQ==", "number": 13320, "title": "Bootstrapping fails with --opt-level=1", "user": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-04-04T18:13:29Z", "updated_at": "2014-05-31T07:53:34Z", "closed_at": "2014-05-31T07:53:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Sadly, I'm unable to reduce this test case further, but bootstrapping rust with `--opt-level=1` causes an assertion failure:\n\n```\n$ ./configure --disable-optimize\n...\n$ make RUSTFLAGS=--opt-level=1\n...\noxidize: x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd\ntask '<main>' failed at 'assertion failed: !contains_nul(path.container_as_bytes())', /home/alex/code/rust2/src/libs\ntd/path/mod.rs:161\nmake: *** [x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib/stamp.std] Error 101\nstack backtrace:\n   1:     0x2afc8575d3d0 - rt::backtrace::imp::write::hf4a317cb26f6dbdcCYb::v0.11.pre\n   2:     0x2afc8568f320 - rt::unwind::begin_unwind_inner::hc4d1b90c74aff9505yb::v0.11.pre\n   3:     0x2afc8568ee80 - rt::unwind::begin_unwind_fmt::ha138a63726a8610ffyb::v0.11.pre\n   4:     0x2afc88ab51b0 - path::GenericPath::new::h9338406b1241c33bhtc::v0.11.pre\n   5:     0x2afc88ab5160 - path::posix::Path::new::hc0024b98d3428ebe3sc::v0.11.pre\n   6:     0x2afc88aaee90 - terminfo::searcher::get_dbpath_for_term::hb9860c7e7fc3fd526aa::v0.11.pre\n   7:     0x2afc88ab6650 - terminfo::searcher::open::hf62724575cfe88cbhfa::v0.11.pre\n   8:     0x2afc86659550 - Terminal$LT$T$GT$::new::hdabfc77b7ac55d88Qo5::v0.11.pre\n   9:     0x2afc86652420 - diagnostic::EmitterWriter::stderr::hfd23d008f940811626b::v0.11.pre\n  10:     0x2afc8351b620 - monitor::hba5a4a2b7e13d4ecikm::v0.11.pre\n  11:     0x2afc835370d0 - main_args::hbd9a5c72232d6063Qom::v0.11.pre\n  12:     0x2afc83537040 - main::h69153f0097da5909Gom::v0.11.pre\n  13:     0x2afc853dd240 - run::hf16768b59fb57517ixd::v0.11.pre\n  14:     0x2afc853dd180 - start::closure.7826\n  15:     0x2afc857564d0 - unstable::finally::try_finally::h8293b253ac1a0b2fP9U::v0.11.pre\n  16:     0x2afc85756440 - unstable::finally::_$x27a$x7c$x7c$x20.$GT$$x20T.Finally$LT$T$GT$::finally::ha3168e974cad9\ndd5v8U::v0.11.pre\n  17:     0x2afc857563e0 - rt::task::Task::run::closure.41772\n  18:     0x2afc857672b0 - rust_try\n  19:     0x2afc85756b70 - rt::unwind::Unwinder::try::h072d99d58e638ae0Wkb::v0.11.pre\n  20:     0x2afc85756300 - rt::task::Task::run::hdd5dcbf94d6bade1Br9::v0.11.pre\n  21:     0x2afc853dcc10 - start::h4100553b9a0fcee0Ktd::v0.11.pre\n  22:     0x2afc853dcb90 - lang_start::he63000f25bb5087f4sd::v0.11.pre\n  23:     0x2afc85e11cf0 - __libc_start_main\n  24:           0x400780 - <unknown>\n  25:                0x0 - <unknown>\n```\n\nThis is because `Path::new(\"/etc/terminfo\")` is failing, because it thinks there's a null byte in that slice. I added some debug printing and the slice did indeed _not_ have a null byte, but the `contains_nul` function returned `true` anyway. Additionally, if I inlined the contents of `contains_nul` it correctly reported that the slice did not have a nul byte.\n\nThis may be fixed with an LLVM upgrade, but I wanted to get an issue to help track this.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/13320/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/13320/timeline", "performed_via_github_app": null, "state_reason": "completed"}