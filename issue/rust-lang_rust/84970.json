{"url": "https://api.github.com/repos/rust-lang/rust/issues/84970", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84970/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84970/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84970/events", "html_url": "https://github.com/rust-lang/rust/issues/84970", "id": 877005793, "node_id": "MDU6SXNzdWU4NzcwMDU3OTM=", "number": 84970, "title": "Unstable fingerprints tracking issue", "user": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 203429200, "node_id": "MDU6TGFiZWwyMDM0MjkyMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-high", "name": "P-high", "color": "eb6420", "default": false, "description": "High priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 307747675, "node_id": "MDU6TGFiZWwzMDc3NDc2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-incr-comp", "name": "A-incr-comp", "color": "f7e101", "default": false, "description": "Area: Incremental compilation"}], "state": "open", "locked": false, "assignee": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/82", "html_url": "https://github.com/rust-lang/rust/milestone/82", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/82/labels", "id": 6717076, "node_id": "MDk6TWlsZXN0b25lNjcxNzA3Ng==", "number": 82, "title": "1.54.0", "description": null, "creator": {"login": "rustbot", "id": 47979223, "node_id": "MDQ6VXNlcjQ3OTc5MjIz", "avatar_url": "https://avatars.githubusercontent.com/u/47979223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rustbot", "html_url": "https://github.com/rustbot", "followers_url": "https://api.github.com/users/rustbot/followers", "following_url": "https://api.github.com/users/rustbot/following{/other_user}", "gists_url": "https://api.github.com/users/rustbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rustbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rustbot/subscriptions", "organizations_url": "https://api.github.com/users/rustbot/orgs", "repos_url": "https://api.github.com/users/rustbot/repos", "events_url": "https://api.github.com/users/rustbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rustbot/received_events", "type": "User", "site_admin": false}, "open_issues": 2, "closed_issues": 652, "state": "closed", "created_at": "2021-05-01T02:53:57Z", "updated_at": "2022-02-03T12:07:26Z", "due_on": null, "closed_at": "2021-08-17T19:06:49Z"}, "comments": 79, "created_at": "2021-05-06T02:09:31Z", "updated_at": "2023-05-31T15:13:36Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "For users hitting this bug: please read [this blog post](https://blog.rust-lang.org/2021/05/10/Rust-1.52.1.html) which discusses what you can do. An excerpt is below:\r\n\r\n\r\nThe Internal Compiler Error asks you to report a bug, and if you can do so, we still want that information. We *want* to know about the cases that are failing.\r\n\r\nBut regardless of whether or not you file a bug, the problem here can be resolved by either:\r\n\r\n 1. deleting your incremental compilation cache (e.g. by running `cargo clean` for the whole project or `cargo clean -p crate-causing-the-error`), or\r\n 2. force incremental compilation to be disabled, by setting `CARGO_INCREMENTAL=0` in your environment or setting `build.incremental` to `false` in your `$HOME/.cargo/config.toml` file (which might also be called `$HOME/.cargo/config`) by adding this:\r\n\r\n```\r\nbuild.incremental = 'false'\r\n```\r\n\r\nWe recommend that users of 1.52.0 disable incremental compilation, to avoid running into this problem.\r\n\r\nWe do *not* recommend that users of 1.52.0 downgrade to an earlier version of Rust in response to this problem. There is at least one instance of a silent [miscompilation][issue-82920] caused by incremental compilation that was not caught until we added the fingerprint checking.\r\n\r\n[issue-82920]: https://github.com/rust-lang/rust/issues/82920\r\n\r\n--------------\r\n\r\n\r\nI believe the (new) ICEs as a result of improved error detection in the incremental code will land in 1.53 onto stable, which is in 6 weeks. We are unlikely to fix all of the fallout (i.e. all bugs, at least 25 of which are [currently open](https://github.com/rust-lang/rust/issues?q=is%3Aissue+is%3Aopen+unstable+fingerprints), though some are duplicates) by that time and be willing to backport the fixes. I suspect we are also unlikely to want to disable the new assertions; they are catching known unsoundness. I am opening this issue to discuss possible alternatives, which are hopefully more user friendly than the current ICE.\r\n\r\nI think one direct improvement is to adjust the panic/assert on encountering this to be a proper compile error, which can tell the user that they should (for example) delete the incremental directory and invoke the compiler again. This is already a significant improvement over the current message, I suspect. We can still ask that they file a bug report.\r\n\r\nWe should also consider if it's worth considering applying performance-hurting mitigations; it seems definitely true we can drop incremental support on beta/stable until these bugs are fixed, but perhaps a smaller hammer is also viable.\r\n\r\nTable of ICEs:\r\n\r\n| Issue | Query name | Has MCVE | PR fixing issue | fixed in 1.5x? | PR adding regression test | Done |\r\n| ----- | ---------- | ----------------- | --------------- | -- | ------------------------- | ----- |\r\n| #83259 | `predicates_of` | \u2705 | #84233 | 1.53 | #84233 | \u2705  |\r\n| ~~#83311~~ | ~~`proc_macro_decls_static`~~ | |  |  |  | N/A |\r\n| #83126 | `extern_mod_stmt_cnum` | [mcve-83126][] | https://github.com/rust-lang/rust/pull/83153 | 1.52 | None yet | \u274c |\r\n| #85197 | `optimized_mir` | [mcve-85197][] | #85211 | 1.54 | #85211 | \u2705  |\r\n| #84225| `exported_symbols` | ? | #84226 | 1.53 | None yet | \u274c |\r\n| #85019 | `item_children` | ? | https://github.com/rust-lang/rust/pull/83901 | 1.54 | None yet | \u274c |\r\n| #83538 | `evaluate_obligation` (`EvaluatedToOk` and `EvaluatedToOkModuloRegions`) |  \u2705 | https://github.com/rust-lang/rust/pull/85186 | 1.54 | https://github.com/rust-lang/rust/pull/85186 | \u2705  |\r\n| #84963 | `evaluate_obligation` (`OverflowError`) |  \u2705 | None yet | ? | None yet | \u274c |\r\n|              |  `native_libraries`                         | ? |    #85702 | 1.54 | #85702 | \u2705  |\r\n| #85360 | evaluate_obligation | \u2705  | #85868 | 1.56 | #91065 | \u2705 |\r\n\r\n[mcve-83126]: https://github.com/rust-lang/rust/issues/83126#issuecomment-799046427\r\n[mcve-85197]: https://github.com/rust-lang/rust/issues/85197\r\n\r\ncc @Aaron1011 (driver of fixing the bugs, I believe)\r\ncc @pnkfelix @wesleywiser (T-compiler leads)\r\ncc @rust-lang/release for awareness", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84970/reactions", "total_count": 17, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 13, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84970/timeline", "performed_via_github_app": null, "state_reason": null}