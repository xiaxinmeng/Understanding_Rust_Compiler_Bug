{"url": "https://api.github.com/repos/rust-lang/rust/issues/2963", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2963/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2963/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2963/events", "html_url": "https://github.com/rust-lang/rust/issues/2963", "id": 5717537, "node_id": "MDU6SXNzdWU1NzE3NTM3", "number": 2963, "title": "ICE in Earley Parser", "user": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235146, "node_id": "MDU6TGFiZWwyMzUxNDY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-syntaxext", "name": "A-syntaxext", "color": "f7e101", "default": false, "description": "Area: Syntax extensions"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/rust-lang/rust/milestones/8", "html_url": "https://github.com/rust-lang/rust/milestone/8", "labels_url": "https://api.github.com/repos/rust-lang/rust/milestones/8/labels", "id": 144598, "node_id": "MDk6TWlsZXN0b25lMTQ0NTk4", "number": 8, "title": "0.5", "description": "", "creator": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 206, "state": "closed", "created_at": "2012-07-12T19:45:03Z", "updated_at": "2013-06-13T02:57:55Z", "due_on": "2012-12-22T08:00:00Z", "closed_at": "2013-06-13T02:57:55Z"}, "comments": 1, "created_at": "2012-07-19T17:16:06Z", "updated_at": "2014-06-16T21:56:25Z", "closed_at": "2012-07-24T18:50:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This program causes an ICE in the early_parser. It ends up failing an assert of `ln > 0u`.\n\n```\nmacro_rules! move {\n    { $x:expr } => { unsafe { let y <- *ptr::addr_of($x); y } }\n}\n\nfn switch<T: send, U>(+endp: pipes::recv_packet<T>,\n                      f: fn(+option<T>) -> U) -> U {\n    f(pipes::try_recv(endp))\n}\n\nfn move<T>(-x: T) -> T { x }\n\nmacro_rules! follow_alts {\n    {\n        $id:ident, $($message:ident, $next:ident, $body:expr,\n                     ($($pats: ident)+))|+\n    } => (\n        alt move($id) {\n            $(some($message($($pats),+)) {\n                let $next = move!{$next};\n                $e\n            })+\n        }\n    )\n}\n\nmacro_rules! follow {\n    { \n        $($message:ident$(($($x: ident),+))* => $next:ident $e:expr)+\n    } => (|m| follow_alts!{m, $($message, $next, $e, ($($x),+ $next))|+})\n}\n\nfn main() { }\n\nfn client_follow(+bank: bank::client::login) {\n    import bank::*;\n\n    let bank = client::login(bank, ~\"theincredibleholk\", ~\"1234\");\n    let bank = switch(bank, follow! {\n        ok => connected { connected }\n        invalid => _next { fail ~\"bank closed the connected\" }\n    });\n}\n```\n\nHere's a partialbacktrace.\n\n```\n(gdb) bt\n#0  upcall_fail (expr=0x1009cd200 \"Assertion ln > 0u failed\", file=0x1009cbff0 \"/Users/eholk/Documents/projects/mozilla/rust/src/libsyntax/syntax.rc\", line=1) at rust_upcall.cpp:95\n#1  0x000000010093c786 in dvec::extensions::pop6678::_38beb4996b23a026::_03 ()\n#2  0x000000010093c629 in vec::map6677::_ebfda22dd86673cd::_03 ()\n#3  0x000000010093a64c in ext::tt::earley_parser::parse::_b64518845d3ed1cf::_03 ()\n#4  0x000000010093db73 in ext::tt::macro_rules::add_new_extension::generic_extension::anon ()\n#5  0x000000010093e98d in ext::tt::macro_rules::add_new_extension::anon ()\n#6  0x0000000100902ce5 in ext::expand::expand_expr::_bc91e71a52102478::_03 ()\n#7  0x00000001009067a5 in ext::expand::expand_crate::anon ()\n#8  0x000000010079acfd in fold::ast_fold::meth3905::fold_expr::_446ea95290ef8f5d::_03 ()\n#9  0x0000000100777329 in vec::map3204::_eee8c82645f9cfec::_03 ()\n#10 0x000000010078d49c in fold::noop_map_exprs::_782b697b7da44a5f::_03 ()\n#11 0x0000000100785328 in fold::noop_fold_expr::_53c6ded5b97655ba::_03 ()\n#12 0x000000010079477f in fold::wrap3718::anon ()\n#13 0x0000000100903405 in ext::expand::expand_expr::_bc91e71a52102478::_03 ()\n#14 0x00000001009067a5 in ext::expand::expand_crate::anon ()\n#15 0x000000010079acfd in fold::ast_fold::meth3905::fold_expr::_446ea95290ef8f5d::_03 ()\n#16 0x000000010078d32a in fold::noop_fold_local::_834569e36112dd45::_03 ()\n#17 0x000000010079537f in fold::wrap3751::anon ()\n#18 0x000000010079bb4c in fold::ast_fold::meth3912::fold_local::_bbe472b17aef7c3a::_03 ()\n#19 0x0000000100777329 in vec::map3204::_eee8c82645f9cfec::_03 ()\n#20 0x00000001007840b7 in fold::noop_fold_decl::_1d7d107dc27b92d6::_03 ()\n#21 0x000000010079437f in fold::wrap3707::anon ()\n#22 0x000000010079ab53 in fold::ast_fold::meth3904::fold_decl::_93bd4fa850b1a954::_03 ()\n#23 0x0000000100782af9 in fold::noop_fold_stmt::_f2da7627856ac392::_03 ()\n#24 0x0000000100793b7f in fold::wrap3685::anon ()\n#25 0x000000010079a6c3 in fold::ast_fold::meth3901::fold_stmt::_c89fca1658b205c4::_03 ()\n#26 0x0000000100777329 in vec::map3204::_eee8c82645f9cfec::_03 ()\n#27 0x0000000100782790 in fold::noop_fold_block::_b57952945ce2273b::_03 ()\n#28 0x000000010079377f in fold::wrap3674::anon ()\n#29 0x000000010079a515 in fold::ast_fold::meth3900::fold_block::_8bb4f7de413447a2::_03 ()\n#30 0x000000010077e61f in fold::noop_fold_item_underscore::_b85de6394615a81d::_03 ()\n#31 0x00000001009b16d9 in __morestack ()\n```\n\nIt seems like the problem has something to do with the `$(($($x: ident),+))*` segment of the `follow!` macro.\n", "closed_by": {"login": "paulstansifer", "id": 1431, "node_id": "MDQ6VXNlcjE0MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1431?v=4", "gravatar_id": "", "url": "https://api.github.com/users/paulstansifer", "html_url": "https://github.com/paulstansifer", "followers_url": "https://api.github.com/users/paulstansifer/followers", "following_url": "https://api.github.com/users/paulstansifer/following{/other_user}", "gists_url": "https://api.github.com/users/paulstansifer/gists{/gist_id}", "starred_url": "https://api.github.com/users/paulstansifer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/paulstansifer/subscriptions", "organizations_url": "https://api.github.com/users/paulstansifer/orgs", "repos_url": "https://api.github.com/users/paulstansifer/repos", "events_url": "https://api.github.com/users/paulstansifer/events{/privacy}", "received_events_url": "https://api.github.com/users/paulstansifer/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2963/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2963/timeline", "performed_via_github_app": null, "state_reason": "completed"}