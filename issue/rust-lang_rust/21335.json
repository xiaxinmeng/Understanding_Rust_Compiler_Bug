{"url": "https://api.github.com/repos/rust-lang/rust/issues/21335", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/21335/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/21335/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/21335/events", "html_url": "https://github.com/rust-lang/rust/issues/21335", "id": 54680009, "node_id": "MDU6SXNzdWU1NDY4MDAwOQ==", "number": 21335, "title": "ICE when target directory doesn\u2019t exist for LLVM outputs", "user": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 116993, "node_id": "MDU6TGFiZWwxMTY5OTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-driver", "name": "A-driver", "color": "f7e101", "default": false, "description": "Area: rustc_driver that ties everything together into the `rustc` compiler"}, {"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2015-01-17T23:41:07Z", "updated_at": "2018-11-30T22:01:22Z", "closed_at": "2018-11-30T22:01:22Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "**MAKE SURE TO NOT RUN THE COMMANDS IN DIRECTORY WITH ANYTHING NAMED `target` OR `test.rs` OTHERWISE YOU\u2019LL LOSE DATA** \n# llvm-bc (does not ICE anymore as reported below):\n\n```\n$ bash -c \"rm -rf target/ && echo 'fn main(){}' > test.rs && RUST_BACKTRACE=1 rustc test.rs --out-dir=target/ --emit=llvm-bc\"\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'called `Result::unwrap()` on an `Err` value: IoError { kind: MismatchedFileTypeForOperation, desc: \"couldn\\'t copy path\", detail: Some(\"the source path is not an existing file; from=target/test.0.bc; to=target/test.bc\") }', /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/libcore/result.rs:746\n\nstack backtrace:\n   1:     0x7f311266b000 - sys::backtrace::write::h7e8ba1fc274cc36epRt\n   2:     0x7f311268c9e0 - failure::on_fail::h823798930ebe140a64z\n   3:     0x7f31125fb7b0 - rt::unwind::begin_unwind_inner::ha4a8df6010104da6ZJz\n   4:     0x7f31125fc2e0 - rt::unwind::begin_unwind_fmt::hb2e27604ce994736wIz\n   5:     0x7f311268c840 - rust_begin_unwind\n   6:     0x7f31126d5390 - panicking::panic_fmt::h534fa48d94caaacevym\n   7:     0x7f3111605f40 - back::write::run_passes::unboxed_closure.37089\n   8:     0x7f31115fe350 - back::write::run_passes::h8ff6c36249e9879aIFc\n   9:     0x7f3112bcba20 - driver::phase_5_run_llvm_passes::h30b9e967ab9e3034PNa\n  10:     0x7f3112baad70 - driver::compile_input::h8ec974b2bd4afe59Aba\n  11:     0x7f3112c6c4d0 - run_compiler::h0e495a7c10e57aaae5b\n  12:     0x7f3112c6ac40 - thunk::F.Invoke<A, R>::invoke::h12226774702741163622\n  13:     0x7f3112c69ba0 - rt::unwind::try::try_fn::h67848939709837360\n  14:     0x7f31126f3b90 - rust_try_inner\n  15:     0x7f31126f3b80 - rust_try\n  16:     0x7f3112c69e50 - thunk::F.Invoke<A, R>::invoke::h15720675569063176780\n  17:     0x7f311267a680 - sys::thread::thread_start::h2ac456e96ea03cedcJw\n  18:     0x7f310caa3250 - start_thread\n  19:     0x7f31122ac219 - clone\n  20:                0x0 - <unknown>\n```\n# llvm-ir:\n\n```\n$ bash -c \"rm -rf target/ && echo 'fn main(){}' > test.rs && rustc test.rs --out-dir=target/ --emit=llvm-ir\"\nrustc: /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/lib/Support/raw_ostream.cpp:637: virtual size_t llvm::raw_fd_ostream::preferred_buffer_size() const: Assertion `FD >= 0 && \"File not yet open!\"' failed.\nbash: line 1: 30752 Aborted                 (core dumped) rustc test.rs --out-dir=target/ --emit=llvm-ir\n```\n\ngdb backtrace (for the relevant thread): \n\n```\n#0  0x00007ffff7123a97 in raise () from /usr/lib/libc.so.6\n#1  0x00007ffff7124e6a in abort () from /usr/lib/libc.so.6\n#2  0x00007ffff711c8bd in __assert_fail_base () from /usr/lib/libc.so.6\n#3  0x00007ffff711c972 in __assert_fail () from /usr/lib/libc.so.6\n#4  0x00007ffff41d7d62 in llvm::raw_fd_ostream::preferred_buffer_size() const () from /usr/lib/librustc_llvm-4e7c5e5c.so\n#5  0x00007ffff30593ec in GetBufferSize (this=0x7fffef7f1300) at /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/include/llvm/Support/raw_ostream.h:114\n#6  GetBufferSize (this=0x7fffef7f1300) at /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/rustllvm/PassWrapper.cpp:216\n#7  setStream (Delete=false, Stream=..., this=0x7fffef7f1340) at /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/include/llvm/Support/FormattedStream.h:111\n#8  formatted_raw_ostream (Delete=false, Stream=..., this=0x7fffef7f1340) at /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/llvm/include/llvm/Support/FormattedStream.h:89\n#9  LLVMRustPrintModule (PMR=0x7fffe800cf30, M=0x7fffe80038b0, path=0x7fffee823740 \"target/test.0.ll\") at /home/rustbuild/src/rust-buildbot/slave/nightly-dist-rustc-linux/build/src/rustllvm/PassWrapper.cpp:233\n#10 0x00007ffff6529fa5 in back::write::optimize_and_codegen::unboxed_closure.37047 () from /usr/lib/librustc_trans-4e7c5e5c.so\n#11 0x00007ffff653458c in back::write::execute_work_item::h0a51d25fc78535a1HXc () from /usr/lib/librustc_trans-4e7c5e5c.so\n#12 0x00007ffff652b893 in back::write::run_passes::h8ff6c36249e9879aIFc () from /usr/lib/librustc_trans-4e7c5e5c.so\n#13 0x00007ffff7af7b74 in driver::phase_5_run_llvm_passes::h30b9e967ab9e3034PNa () from /usr/lib/librustc_driver-4e7c5e5c.so\n#14 0x00007ffff7ad8590 in driver::compile_input::h8ec974b2bd4afe59Aba () from /usr/lib/librustc_driver-4e7c5e5c.so\n#15 0x00007ffff7b99abf in run_compiler::h0e495a7c10e57aaae5b () from /usr/lib/librustc_driver-4e7c5e5c.so\n#16 0x00007ffff7b96e89 in thunk::F.Invoke$LT$A$C$$u{20}R$GT$::invoke::h12226774702741163622 () from /usr/lib/librustc_driver-4e7c5e5c.so\n#17 0x00007ffff7b95c2f in rt::unwind::try::try_fn::h67848939709837360 () from /usr/lib/librustc_driver-4e7c5e5c.so\n#18 0x00007ffff761fb99 in rust_try_inner () from /usr/lib/libstd-4e7c5e5c.so\n#19 0x00007ffff761fb86 in rust_try () from /usr/lib/libstd-4e7c5e5c.so\n#20 0x00007ffff7b96280 in thunk::F.Invoke$LT$A$C$$u{20}R$GT$::invoke::h15720675569063176780 () from /usr/lib/librustc_driver-4e7c5e5c.so\n#21 0x00007ffff75a670f in sys::thread::thread_start::h2ac456e96ea03cedcJw () from /usr/lib/libstd-4e7c5e5c.so\n#22 0x00007ffff19cf314 in start_thread () from /usr/lib/libpthread.so.0\n#23 0x00007ffff71d824d in clone () from /usr/lib/libc.so.6\n```\n\nAll other outputs fail predictably with an error from rustc:\n\n```\nerror: could not write output: No such file or directory\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/21335/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/21335/timeline", "performed_via_github_app": null, "state_reason": "completed"}