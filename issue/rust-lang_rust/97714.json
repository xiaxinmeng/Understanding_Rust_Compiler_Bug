{"url": "https://api.github.com/repos/rust-lang/rust/issues/97714", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97714/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97714/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97714/events", "html_url": "https://github.com/rust-lang/rust/issues/97714", "id": 1260423216, "node_id": "I_kwDOAAsO6M5LIIgw", "number": 97714, "title": "`pub use` in a cdylib crate does not re-export unused `pub extern \"C\"` functions", "user": {"login": "edgimar", "id": 393850, "node_id": "MDQ6VXNlcjM5Mzg1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/393850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edgimar", "html_url": "https://github.com/edgimar", "followers_url": "https://api.github.com/users/edgimar/followers", "following_url": "https://api.github.com/users/edgimar/following{/other_user}", "gists_url": "https://api.github.com/users/edgimar/gists{/gist_id}", "starred_url": "https://api.github.com/users/edgimar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edgimar/subscriptions", "organizations_url": "https://api.github.com/users/edgimar/orgs", "repos_url": "https://api.github.com/users/edgimar/repos", "events_url": "https://api.github.com/users/edgimar/events{/privacy}", "received_events_url": "https://api.github.com/users/edgimar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2022-06-03T21:56:02Z", "updated_at": "2022-06-05T03:42:46Z", "closed_at": "2022-06-05T03:42:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "Perhaps the issue description isn't exactly correct, but here's the gist:\r\n\r\n**Expected behavior**:  when a cdylib crate contains `pub use foo;` then any `pub extern \"C\"` functions within `foo` should be present in the generated dynamic library.  This appears currently to not be the case.\r\n\r\n**To reproduce**:\r\n\r\n(using cargo 1.61.0 (a028ae4 2022-04-29) and rustc 1.61.0 (fe5b13d68 2022-05-18) on Linux, using stable-x86_64-unknown-linux-gnu toolchain)\r\n\r\nSet up a folder-structure (with the shown file content) as follows:\r\n```\r\nmydylib\r\n\u251c\u2500\u2500 Cargo.lock\r\n\u251c\u2500\u2500 Cargo.toml\r\n\u251c\u2500\u2500 foo\r\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Cargo.toml\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\r\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 lib.rs\r\n\u2514\u2500\u2500 src\r\n    \u2514\u2500\u2500 lib.rs\r\n\r\n------------------mydylib/Cargo.toml:\r\n[package]\r\nname = \"mydylib\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\r\n\r\n[dependencies]\r\nfoo = { path = \"foo\" }\r\n\r\n[lib]\r\ncrate-type = [\"cdylib\"]\r\n\r\n------------------mydylib/foo/Cargo.toml:\r\n[package]\r\nname = \"foo\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\r\n\r\n[dependencies]\r\n\r\n[lib]\r\ncrate-type = [\"rlib\"]\r\n\r\n------------------mydylib/src/lib.rs:\r\npub use foo;\r\n\r\n#[no_mangle]\r\npub extern \"C\" fn hello() {\r\n    println!(\"Hello World!\");\r\n}\r\n\r\n------------------mydylib/foo/src/lib.rs:\r\n#[no_mangle]\r\npub extern \"C\" fn wrapped_hello() {\r\n    println!(\"Hello Wrapped World!\");\r\n}\r\n```\r\n\r\n**Results**:\r\n```\r\n$ cd mydylib\r\n$ RUSTC_LOG=rustc_codegen_ssa::back::link=info cargo build\r\n   Compiling foo v0.1.0 (/home/user/tmp/mydylib/foo)\r\nINFO rustc_codegen_ssa::back::link preparing rlib to \"/home/user/tmp/mydylib/target/debug/deps/libfoo-f3e99f1b7ea9e90d.rlib\"\r\n   Compiling mydylib v0.1.0 (/home/user/tmp/mydylib)\r\nINFO rustc_codegen_ssa::back::link preparing Cdylib to \"/home/user/tmp/mydylib/target/debug/deps/libmydylib.so\"\r\nINFO rustc_codegen_ssa::back::link \"cc\" \"-Wl,--version-script=/tmp/rustcO88MJl/list\" \"-m64\" \"/home/user/tmp/mydylib/target/debug/deps/mydylib.2hfarbmypcuef87x.rcgu.o\" \"/home/user/tmp/mydylib/target/debug/deps/mydylib.jvr9udtwgdjffuy.rcgu.o\" \"/home/user/tmp/mydylib/target/debug/deps/mydylib.2po762jn48xj89vh.rcgu.o\" \"-Wl,--as-needed\" \"-L\" \"/home/user/tmp/mydylib/target/debug/deps\" \"-L\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"/home/user/tmp/mydylib/target/debug/deps/libfoo-f3e99f1b7ea9e90d.rlib\" \"-Wl,--start-group\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-05b39ac0cb4c5688.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-ccaa149b737d6503.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libobject-a94a6388c153126b.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libmemchr-1ecfa264246b85c6.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libaddr2line-ee710154a50440b8.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libgimli-f09986d873ea8592.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-f3521e20c99619ab.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_detect-df6036c77d75ce21.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-24f91c1a1dfc7e13.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libminiz_oxide-bffcc61991adb202.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libadler-cf22313353d8663e.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-c45fb100f99430e9.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-0cdc47a8a81950ea.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcfg_if-f1e158606c4c82f6.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-0b608b5ef4df0ec4.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-b8438dc0bcbbcc08.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-70e2ae036775ff2f.rlib\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-815d281f7068a893.rlib\" \"-Wl,--end-group\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-377835cfab8dae0d.rlib\" \"-Wl,-Bdynamic\" \"-lgcc_s\" \"-lutil\" \"-lrt\" \"-lpthread\" \"-lm\" \"-ldl\" \"-lc\" \"-Wl,--eh-frame-hdr\" \"-Wl,-znoexecstack\" \"-L\" \"/home/user/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-o\" \"/home/user/tmp/mydylib/target/debug/deps/libmydylib.so\" \"-Wl,--gc-sections\" \"-shared\" \"-Wl,-zrelro,-znow\" \"-nodefaultlibs\"\r\nINFO rustc_codegen_ssa::back::link linker stderr:\r\n\r\nINFO rustc_codegen_ssa::back::link linker stdout:\r\n\r\n    Finished dev [unoptimized + debuginfo] target(s) in 2.73s\r\n\r\n\r\n$ nm target/debug/libmydylib.so | grep wrapped   # NO OUTPUT, BUT WE WANT TO SEE \"... T wrapped_hello\"\r\n```", "closed_by": {"login": "edgimar", "id": 393850, "node_id": "MDQ6VXNlcjM5Mzg1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/393850?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edgimar", "html_url": "https://github.com/edgimar", "followers_url": "https://api.github.com/users/edgimar/followers", "following_url": "https://api.github.com/users/edgimar/following{/other_user}", "gists_url": "https://api.github.com/users/edgimar/gists{/gist_id}", "starred_url": "https://api.github.com/users/edgimar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edgimar/subscriptions", "organizations_url": "https://api.github.com/users/edgimar/orgs", "repos_url": "https://api.github.com/users/edgimar/repos", "events_url": "https://api.github.com/users/edgimar/events{/privacy}", "received_events_url": "https://api.github.com/users/edgimar/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97714/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97714/timeline", "performed_via_github_app": null, "state_reason": "completed"}