{"url": "https://api.github.com/repos/rust-lang/rust/issues/65862", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/65862/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/65862/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/65862/events", "html_url": "https://github.com/rust-lang/rust/issues/65862", "id": 512941558, "node_id": "MDU6SXNzdWU1MTI5NDE1NTg=", "number": 65862, "title": "rust 1.38.0 build fails on NetBSD/powerpc with internal LLVM", "user": {"login": "he32", "id": 1199501, "node_id": "MDQ6VXNlcjExOTk1MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1199501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/he32", "html_url": "https://github.com/he32", "followers_url": "https://api.github.com/users/he32/followers", "following_url": "https://api.github.com/users/he32/following{/other_user}", "gists_url": "https://api.github.com/users/he32/gists{/gist_id}", "starred_url": "https://api.github.com/users/he32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/he32/subscriptions", "organizations_url": "https://api.github.com/users/he32/orgs", "repos_url": "https://api.github.com/users/he32/repos", "events_url": "https://api.github.com/users/he32/events{/privacy}", "received_events_url": "https://api.github.com/users/he32/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 311417590, "node_id": "MDU6TGFiZWwzMTE0MTc1OTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-netbsd", "name": "O-netbsd", "color": "6e6ec0", "default": false, "description": "Operating system: NetBSD"}, {"id": 515028847, "node_id": "MDU6TGFiZWw1MTUwMjg4NDc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-PowerPC", "name": "O-PowerPC", "color": "6e6ec0", "default": false, "description": "Target: PowerPC processors"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-10-27T09:22:44Z", "updated_at": "2020-03-13T15:18:23Z", "closed_at": "2020-03-13T15:18:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The build of rust 1.38.0 natively on NetBSD/powerpc 8.0 fails if the build is instructed to use the internal LLVM.  The corresponding build with an external LLVM (version 8.0.1) succeeds.\r\n\r\nThe failure is fairly similar to what is seen in issue #64903 -- in this case the build stops with and not during the build of `ryu`:\r\n\r\n```\r\n   Compiling quick-error v1.2.2\r\n   Compiling rustc_driver v0.0.0 (/usr/pkgsrc/lang/rust/work/rustc-1.38.0-src/src/librustc_driver)\r\n   Compiling semver v0.9.0\r\n   Compiling arrayvec v0.4.7\r\nerror: failed to run custom build command for `libc v0.2.60`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/usr/pkgsrc/lang/rust/work/rustc-1.38.0-src/build/powerpc-unknown-netbsd/stage1-rustc/release/build/libc-37e397b190d97e24/build-script-build` (signal: 11, SIGSEGV: invalid memory reference)\r\ncommand did not execute successfully: \"/usr/pkgsrc/lang/rust/work/rust-bootstrap/bin/cargo\" \"build\" \"--target\" \"powerpc-unknown-netbsd\" \"-j\" \"1\" \"--release\" \"--frozen\" \"--features\" \"\" \"--manifest-path\" \"/usr/pkgsrc/lang/rust/work/rustc-1.38.0-src/src/rustc/Cargo.toml\" \"--message-format\" \"json\"\r\nexpected success, got: exit code: 101\r\nTraceback (most recent call last):\r\n  File \"./x.py\", line 11, in <module>\r\n    bootstrap.main()\r\n```\r\n\r\nThe stack backtrace from GDB is however nearly impossible to make any sense of:\r\n\r\n```\r\ngolden-delicious: {4} gdb /usr/pkgsrc/lang/rust/work/rustc-1.38.0-src/build/powerpc-unknown-netbsd/stage1-rustc/release/build/libc-37e397b190d97e24/build-script-build work/rustc-1.38.0-src/vendor/libc/build-script-bui.core\r\nGNU gdb (GDB) 7.12\r\nCopyright (C) 2016 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"powerpc--netbsd\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /usr/pkgsrc/lang/rust/work/rustc-1.38.0-src/build/powerpc-unknown-netbsd/stage1-rustc/release/build/libc-37e397b190d97e24/build-script-build...(no debugging symbols found)...done.\r\n[New process 1]\r\nCore was generated by `build-script-bui'.\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  0x000625f0 in ?? ()\r\n(gdb) where\r\n#0  0x000625f0 in ?? ()\r\n#1  0x00030ea0 in __rdos_backtrace_dwarf_add ()\r\n#2  0xffffd83f in ?? ()\r\n#3  0x4f5f4346 in ?? ()\r\nBacktrace stopped: previous frame inner to this frame (corrupt stack?)\r\n(gdb) \r\n(gdb) i reg\r\nr0             0x1c844  116804\r\nr1             0xffffca30       4294953520\r\nr2             0xfdeffa08       4260362760\r\nr3             0xd      13\r\nr4             0x1      1\r\nr5             0x1      1\r\nr6             0xffffcb04       4294953732\r\nr7             0xfde8ad04       4259884292\r\nr8             0x0      0\r\nr9             0xfdef8a00       4260334080\r\nr10            0xfdead958       4260026712\r\nr11            0xfdd63f7c       4258676604\r\nr12            0x24000402       603980802\r\nr13            0x9fe60  654944\r\nr14            0x0      0\r\nr15            0x0      0\r\nr16            0x0      0\r\nr17            0x0      0\r\nr18            0x0      0\r\nr19            0x0      0\r\nr20            0x0      0\r\nr21            0x0      0\r\nr22            0x0      0\r\nr23            0x0      0\r\nr24            0x0      0\r\nr25            0x0      0\r\nr26            0x0      0\r\nr27            0x0      0\r\nr28            0x1      1\r\nr29            0xffffcb04       4294953732\r\nr30            0xa67c8  681928\r\nr31            0xffffeff0       4294963184\r\npc             0x625f0  0x625f0\r\nmsr            <unavailable>\r\ncr             0x24000402       603980802\r\nlr             0x30ea0  0x30ea0 <__rdos_backtrace_dwarf_add+320>\r\nctr            0xfdd63f7c       4258676604\r\nxer            0x0      0\r\n(gdb) x/i 0x625f0\r\n=> 0x625f0:     .long 0x0\r\n(gdb) x/i __rdos_backtrace_dwarf_add+320\r\n   0x30ea0 <__rdos_backtrace_dwarf_add+320>:    lwz     r10,136(r1)\r\n(gdb) \r\n...\r\n(gdb) \r\n   0x30e54 <__rdos_backtrace_dwarf_add+244>:    addi    r3,r1,128\r\n   0x30e58 <__rdos_backtrace_dwarf_add+248>:    stw     r8,64(r1)\r\n   0x30e5c <__rdos_backtrace_dwarf_add+252>:    li      r27,0\r\n   0x30e60 <__rdos_backtrace_dwarf_add+256>:    stw     r5,60(r1)\r\n   0x30e64 <__rdos_backtrace_dwarf_add+260>:    bl      0x2da98 <read_uint32>\r\n   0x30e68 <__rdos_backtrace_dwarf_add+264>:    cmpwi   cr7,r3,-1\r\n   0x30e6c <__rdos_backtrace_dwarf_add+268>:    addi    r22,r1,160\r\n   0x30e70 <__rdos_backtrace_dwarf_add+272>:    addi    r31,r1,224\r\n   0x30e74 <__rdos_backtrace_dwarf_add+276>:    addi    r28,r1,192\r\n   0x30e78 <__rdos_backtrace_dwarf_add+280>:    mr      r9,r3\r\n   0x30e7c <__rdos_backtrace_dwarf_add+284>:    li      r19,0\r\n   0x30e80 <__rdos_backtrace_dwarf_add+288>:\r\n    beq     cr7,0x31114 <__rdos_backtrace_dwarf_add+948>\r\n   0x30e84 <__rdos_backtrace_dwarf_add+292>:    lwz     r10,128(r1)\r\n   0x30e88 <__rdos_backtrace_dwarf_add+296>:    mr      r4,r9\r\n   0x30e8c <__rdos_backtrace_dwarf_add+300>:    addi    r3,r1,128\r\n   0x30e90 <__rdos_backtrace_dwarf_add+304>:    stw     r9,172(r1)\r\n   0x30e94 <__rdos_backtrace_dwarf_add+308>:    stw     r10,160(r1)\r\n   0x30e98 <__rdos_backtrace_dwarf_add+312>:    lwz     r10,132(r1)\r\n   0x30e9c <__rdos_backtrace_dwarf_add+316>:    stw     r10,164(r1)\r\n   0x30ea0 <__rdos_backtrace_dwarf_add+320>:    lwz     r10,136(r1)\r\n(gdb) \r\n```\r\n\r\nWhen the rust build is instructed to use an external LLVM (version 8.0.1) via\r\n`--enable-llvm-link-shared` and `--llvm-root=${LLVM_ROOT}` on this platform,\r\nthe build succeeds.\r\n\r\nAs an additional data point, a native build of rust 1.38.0 on NetBSD/aarch64 using\r\nthe internal LLVM succeeds, as does a build on NetBSD/amd64, also using the internal LLVM.\r\n", "closed_by": {"login": "he32", "id": 1199501, "node_id": "MDQ6VXNlcjExOTk1MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1199501?v=4", "gravatar_id": "", "url": "https://api.github.com/users/he32", "html_url": "https://github.com/he32", "followers_url": "https://api.github.com/users/he32/followers", "following_url": "https://api.github.com/users/he32/following{/other_user}", "gists_url": "https://api.github.com/users/he32/gists{/gist_id}", "starred_url": "https://api.github.com/users/he32/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/he32/subscriptions", "organizations_url": "https://api.github.com/users/he32/orgs", "repos_url": "https://api.github.com/users/he32/repos", "events_url": "https://api.github.com/users/he32/events{/privacy}", "received_events_url": "https://api.github.com/users/he32/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/65862/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/65862/timeline", "performed_via_github_app": null, "state_reason": "completed"}