{"url": "https://api.github.com/repos/rust-lang/rust/issues/60447", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60447/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60447/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60447/events", "html_url": "https://github.com/rust-lang/rust/issues/60447", "id": 439292179, "node_id": "MDU6SXNzdWU0MzkyOTIxNzk=", "number": 60447, "title": "Cargo build ICE when run with closed STDIN", "user": {"login": "ooprala", "id": 1514310, "node_id": "MDQ6VXNlcjE1MTQzMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1514310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ooprala", "html_url": "https://github.com/ooprala", "followers_url": "https://api.github.com/users/ooprala/followers", "following_url": "https://api.github.com/users/ooprala/following{/other_user}", "gists_url": "https://api.github.com/users/ooprala/gists{/gist_id}", "starred_url": "https://api.github.com/users/ooprala/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ooprala/subscriptions", "organizations_url": "https://api.github.com/users/ooprala/orgs", "repos_url": "https://api.github.com/users/ooprala/repos", "events_url": "https://api.github.com/users/ooprala/events{/privacy}", "received_events_url": "https://api.github.com/users/ooprala/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-05-01T19:34:02Z", "updated_at": "2020-09-28T03:28:03Z", "closed_at": "2020-09-28T03:28:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "**How to reproduce**\r\n```bash\r\ncargo new any_project\r\ncd any_project\r\ncargo build <&-\r\n# the &- syntax (valid in bash and zsh AFAIK)\r\n# tells your shell to fork cargo with STDIN *closed*\r\n```\r\n**Actual Result**\r\n```\r\nthread '<unnamed>' panicked at 'failed to acquire jobserver token: early EOF on jobserver pipe', error: failed to acquire jobserver token: early EOF on jobserver pipe\r\nsrc/librustc_codegen_ssa/back/write.rs:1406:29\r\n\r\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `any_project`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\n**Actual Result with full backtrace**\r\n```\r\nthread '<unnamed>' panicked at 'failed to acquire jobserver token: early EOF on jobserver pipe', src/librustc_codegen_ssa/back/write.rs:1406:29\r\nerror: failed to acquire jobserver token: early EOF on jobserver pipe\r\n\r\nstack backtrace:\r\n   0:     0x7fa5eca1ce63 - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::hc7b76c57e25c7d91\r\n                               at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\r\n   1:     0x7fa5eca1556b - std::sys_common::backtrace::_print::h203699a8f1b8b948\r\n                               at src/libstd/sys_common/backtrace.rs:70\r\n   2:     0x7fa5eca190c6 - std::panicking::default_hook::{{closure}}::h74fcb67c61dc8b92\r\n                               at src/libstd/sys_common/backtrace.rs:58\r\n                               at src/libstd/panicking.rs:200\r\n   3:     0x7fa5eca18e44 - std::panicking::default_hook::hb2e06978a2102930\r\n                               at src/libstd/panicking.rs:215\r\n   4:     0x7fa5e8bb03df - rustc::util::common::panic_hook::h9fd4a470400ba35c\r\n   5:     0x7fa5eca198b8 - std::panicking::rust_panic_with_hook::h4ac0b487eb7e54da\r\n                               at src/libstd/panicking.rs:482\r\n   6:     0x7fa5eca19351 - std::panicking::continue_panic_fmt::h23ca3ed77b25f368\r\n                               at src/libstd/panicking.rs:385\r\n   7:     0x7fa5eca1929e - std::panicking::begin_panic_fmt::he14137966dec33cc\r\n                               at src/libstd/panicking.rs:340\r\n   8:     0x7fa5e310477b - std::sys_common::backtrace::__rust_begin_short_backtrace::h6be5ab22ff539cca\r\n   9:     0x7fa5e3146cad - std::panicking::try::do_call::hb93197db26b32ea9\r\n  10:     0x7fa5eca2ab29 - __rust_maybe_catch_panic\r\n                               at src/libpanic_unwind/lib.rs:87\r\n  11:     0x7fa5e31105f8 - <F as alloc::boxed::FnBox<A>>::call_box::haaff0e1f36b63d07\r\n  12:     0x7fa5eca2986d - std::sys::unix::thread::Thread::new::thread_start::h7fc2d82a3b91bc88\r\n                               at /rustc/fc50f328b0353b285421b8ff5d4100966387a997/src/liballoc/boxed.rs:759\r\n                               at src/libstd/sys_common/thread.rs:14\r\n                               at src/libstd/sys/unix/thread.rs:81\r\n  13:     0x7fa5ec960a91 - start_thread\r\n  14:     0x7fa5ec87fcd2 - __clone\r\n  15:                0x0 - <unknown>\r\nquery stack during panic:\r\nend of query stack\r\nerror: aborting due to previous error\r\n\r\nerror: Could not compile `any_project`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n\r\n```\r\n**rustc --version --verbose**\r\n```\r\nrustc 1.34.1 (fc50f328b 2019-04-24)\r\nbinary: rustc\r\ncommit-hash: fc50f328b0353b285421b8ff5d4100966387a997\r\ncommit-date: 2019-04-24\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.34.1\r\nLLVM version: 8.0\r\n```\r\n\r\n**Expected result**\r\n```\r\n   Compiling any_project v0.1.0 (/tmp/any_project)\r\n   Finished dev [unoptimized + debuginfo] target(s) in 0.33s\r\n```\r\n\r\n**Additional details**\r\nPlease note that the issue will go away once you succeed in building the project (probably thanks due to some compiler caching, sorry, not sure here).\r\nA `touch` is enough to get the error back :)\r\n```bash\r\ntouch src/main.rs\r\n```\r\nThank you.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60447/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60447/timeline", "performed_via_github_app": null, "state_reason": "completed"}