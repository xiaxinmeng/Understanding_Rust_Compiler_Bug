{"url": "https://api.github.com/repos/rust-lang/rust/issues/11688", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/11688/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/11688/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/11688/events", "html_url": "https://github.com/rust-lang/rust/issues/11688", "id": 25934207, "node_id": "MDU6SXNzdWUyNTkzNDIwNw==", "number": 11688, "title": "fatal runtime error when using UnixListener with a BufferedStream", "user": {"login": "mvdnes", "id": 1009841, "node_id": "MDQ6VXNlcjEwMDk4NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1009841?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvdnes", "html_url": "https://github.com/mvdnes", "followers_url": "https://api.github.com/users/mvdnes/followers", "following_url": "https://api.github.com/users/mvdnes/following{/other_user}", "gists_url": "https://api.github.com/users/mvdnes/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvdnes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvdnes/subscriptions", "organizations_url": "https://api.github.com/users/mvdnes/orgs", "repos_url": "https://api.github.com/users/mvdnes/repos", "events_url": "https://api.github.com/users/mvdnes/events{/privacy}", "received_events_url": "https://api.github.com/users/mvdnes/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-01-20T17:33:24Z", "updated_at": "2014-02-12T08:52:57Z", "closed_at": "2014-02-12T08:52:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## System\n\n```\n[user@vm-arch rust]$ uname -a\nLinux vm-arch 3.12.7-2-ARCH #1 SMP PREEMPT Sun Jan 12 13:09:09 CET 2014 x86_64 GNU/Linux\n[user@vm-arch rust]$ rustc -v\nrustc 0.9\nhost: x86_64-unknown-linux-gnu\n```\n## Description\n\nThe following code spawns a Unix Socket on `/tmp/main.sock`. Using `nc -U /tmp/main.rs`, the program responds with _Incomming_ as expected. Pressing Ctrl-D, to issue an EOF, directly after connecting crashes the program. The issue does not occur when calling `read_byte` on the stream directly, or by using an TcpListener.\n## Code\n\n``` rust\nuse std::io::{Listener, Acceptor};\nfn main() {\n    let mut acceptor =  std::io::net::unix::UnixListener::bind(&Path::new(\"/tmp/main.sock\")).listen().unwrap();\n    println(\"Listening\");\n    for stream in acceptor.incoming() {\n        do spawn {\n            println(\"Incoming\");\n            std::io::buffered::BufferedStream::new(stream.unwrap()).read_byte();\n        }\n    }\n}\n```\n## Expected behaviour\n\nNo crash, maybe possibly an error message, but the application keeps on running.\n## Observed behaviour\n\n```\nnetcat -U /tmp/main.sock\n^D\n```\n\n```\nListening\nIncoming\n\n\nThere are not many persons who know what wonders are opened to them in the\nstories and visions of their youth; for when as children we listen and dream,\nwe think but half-formed thoughts, and when as men we try to remember, we are\ndulled and prosaic with the poison of life. But some of us awake in the night\nwith strange phantasms of enchanted hills and gardens, of fountains that sing\nin the sun, of golden cliffs overhanging murmuring seas, of plains that stretch\ndown to sleeping cities of bronze and stone, and of shadowy companies of heroes\nthat ride caparisoned white horses along the edges of thick forests; and then\nwe know that we have looked back through the ivory gates into that world of\nwonder which was ours before we were wise and unhappy.\n\nfatal runtime error:  assertion failed: !ptr.is_null()\nAborted (core dumped)\n```\n", "closed_by": {"login": "mvdnes", "id": 1009841, "node_id": "MDQ6VXNlcjEwMDk4NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1009841?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mvdnes", "html_url": "https://github.com/mvdnes", "followers_url": "https://api.github.com/users/mvdnes/followers", "following_url": "https://api.github.com/users/mvdnes/following{/other_user}", "gists_url": "https://api.github.com/users/mvdnes/gists{/gist_id}", "starred_url": "https://api.github.com/users/mvdnes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mvdnes/subscriptions", "organizations_url": "https://api.github.com/users/mvdnes/orgs", "repos_url": "https://api.github.com/users/mvdnes/repos", "events_url": "https://api.github.com/users/mvdnes/events{/privacy}", "received_events_url": "https://api.github.com/users/mvdnes/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/11688/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/11688/timeline", "performed_via_github_app": null, "state_reason": "completed"}