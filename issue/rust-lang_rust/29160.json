{"url": "https://api.github.com/repos/rust-lang/rust/issues/29160", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/29160/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/29160/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/29160/events", "html_url": "https://github.com/rust-lang/rust/issues/29160", "id": 112072916, "node_id": "MDU6SXNzdWUxMTIwNzI5MTY=", "number": 29160, "title": "the compiler unexpectedly panicked when unboxed trait is used in Enum", "user": {"login": "hyunsik", "id": 225941, "node_id": "MDQ6VXNlcjIyNTk0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/225941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hyunsik", "html_url": "https://github.com/hyunsik", "followers_url": "https://api.github.com/users/hyunsik/followers", "following_url": "https://api.github.com/users/hyunsik/following{/other_user}", "gists_url": "https://api.github.com/users/hyunsik/gists{/gist_id}", "starred_url": "https://api.github.com/users/hyunsik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hyunsik/subscriptions", "organizations_url": "https://api.github.com/users/hyunsik/orgs", "repos_url": "https://api.github.com/users/hyunsik/repos", "events_url": "https://api.github.com/users/hyunsik/events{/privacy}", "received_events_url": "https://api.github.com/users/hyunsik/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-10-19T05:12:12Z", "updated_at": "2015-10-19T16:38:21Z", "closed_at": "2015-10-19T16:38:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "<short summary of the bug>\n\nThe reproduction code is as the following. DataSet in Plan enum should be enclosed by Box, but I missed it. In this case, rustc should have caused the compilation error as far as I know. But, it causes compiler panic.\n\n```\npub trait DataSet: Display {\n  fn bind(&mut self) -> Void;  \n  fn name(&self) -> &str;\n...\n\npub enum Plan {\n  From (DataSet),\n  Select(Box<Plan>, Vec<Expr>), // params: child, filter in a CNF form\n...\n\npub struct DataFrame<'a> {\n  pub ctx : &'a TokamakContext,\n  pub plan: Plan\n}\n\npub fn from<'a, T: DataSet + 'a>(&'a self, ds: T) -> DataFrame<'a> {\n    DataFrame {ctx: self, plan: Plan::From(ds)}\n}\n```\n## Meta\n\n`rustc --version --verbose`:\n\n```\nrustc 1.5.0-nightly (206af38e7 2015-10-17)\nbinary: rustc\ncommit-hash: 206af38e74ce7fa4b0e781ece7f1067c018c580e\ncommit-date: 2015-10-17\nhost: x86_64-unknown-linux-gnu\nrelease: 1.5.0-nightly\n```\n\nBacktrace:\n\n```\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nthread 'rustc' panicked at 'Unexpected type returned from struct_tail: common::plan::Plan for ty=common::plan::Plan', ../src/librustc_trans/trans/type_of.rs:385\nstack backtrace:\n   1:     0x7f0ec0b7ab80 - sys::backtrace::tracing::imp::write::hc9cd4475e839602bcet\n   2:     0x7f0ec0b81455 - panicking::log_panic::_<closure>::closure.39375\n   3:     0x7f0ec0b80ec5 - panicking::log_panic::h590c92fc0a4ce7d8kex\n   4:     0x7f0ec0b45a93 - sys_common::unwind::begin_unwind_inner::h613f56b60805f050g7r\n   5:     0x7f0ec0b463f8 - sys_common::unwind::begin_unwind_fmt::h1bc638525cf6f9f1m6r\n   6:     0x7f0ec0048f32 - trans::type_of::in_memory_type_of::h861e6ec0299bb850QyN\n   7:     0x7f0ec005b667 - trans::type_of::arg_type_of::he94d012163516b74exN\n   8:     0x7f0ec0121c4e - trans::type_of::type_of_rust_fn::h58bc5d6bbfb81b978iN\n   9:     0x7f0ec0055ace - trans::declare::declare_rust_fn::hca2ab4ed8541921dKrA\n  10:     0x7f0ec0083855 - trans::base::register_fn::h4ea61b21d03fafc9KZi\n  11:     0x7f0ec007df09 - trans::base::get_item_val::h1e00603cd1bd358ebcj\n  12:     0x7f0ec0079f89 - trans::base::trans_item::hf20ffb9e34f45149EQi\n  13:     0x7f0ec007ab18 - trans::base::trans_item::hf20ffb9e34f45149EQi\n  14:     0x7f0ec0087f94 - trans::base::trans_crate::h7f9be4f55fb77deexCj\n  15:     0x7f0ec10568e9 - driver::phase_4_translate_to_llvm::ha38fc904a5b65c96rPa\n  16:     0x7f0ec10509f6 - driver::phase_3_run_analysis_passes::_<closure>::closure.21866\n  17:     0x7f0ec103251c - middle::ty::context::_<impl>::create_and_enter::create_and_enter::h1581818717133174881\n  18:     0x7f0ec102df5d - driver::phase_3_run_analysis_passes::h14363318041318723032\n  19:     0x7f0ec100ec4c - driver::compile_input::h7429410b945488fe7ba\n  20:     0x7f0ec115d3eb - run_compiler::h9bfa87b2a333b60e0pc\n  21:     0x7f0ec115ac76 - boxed::_<impl>::call_box::call_box::h14045816518007926184\n  22:     0x7f0ec115a584 - sys_common::unwind::try::try_fn::try_fn::h13580444196100517801\n  23:     0x7f0ec0b788a8 - __rust_try\n  24:     0x7f0ec0b6d02b - sys_common::unwind::try::inner_try::hbe40bc0f15f0f398O3r\n  25:     0x7f0ec115a71e - boxed::_<impl>::call_box::call_box::h3999059919301623319\n  26:     0x7f0ec0b7ff23 - sys::thread::_<impl>::new::thread_start::h6db8a86c0e97df0byww\n  27:     0x7f0eba2276a9 - start_thread\n  28:     0x7f0ec0804eec - clone\n  29:                0x0 - <unknown>\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/29160/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/29160/timeline", "performed_via_github_app": null, "state_reason": "completed"}