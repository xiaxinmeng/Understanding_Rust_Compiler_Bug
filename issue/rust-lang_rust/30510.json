{"url": "https://api.github.com/repos/rust-lang/rust/issues/30510", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/30510/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/30510/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/30510/events", "html_url": "https://github.com/rust-lang/rust/issues/30510", "id": 123270301, "node_id": "MDU6SXNzdWUxMjMyNzAzMDE=", "number": 30510, "title": "`NoUnsafeCell` errors proliferate even when using `AssertRecoverSafe` or manually implementing `RecoverSafe`", "user": {"login": "abonander", "id": 3198595, "node_id": "MDQ6VXNlcjMxOTg1OTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3198595?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonander", "html_url": "https://github.com/abonander", "followers_url": "https://api.github.com/users/abonander/followers", "following_url": "https://api.github.com/users/abonander/following{/other_user}", "gists_url": "https://api.github.com/users/abonander/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonander/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonander/subscriptions", "organizations_url": "https://api.github.com/users/abonander/orgs", "repos_url": "https://api.github.com/users/abonander/repos", "events_url": "https://api.github.com/users/abonander/events{/privacy}", "received_events_url": "https://api.github.com/users/abonander/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2015-12-21T12:27:10Z", "updated_at": "2017-05-04T20:58:40Z", "closed_at": "2017-05-04T20:58:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Test Case 1: [Playground](http://is.gd/n0hxCF)\n\n``` rust\nuse std::cell::Cell;\n\nuse std::panic::{self, AssertRecoverSafe};\n\nfn main() {\n    let should_work = AssertRecoverSafe(Cell::new(0));\n\n    panic::recover(|| should_work.set(0));\n}\n```\n\nTest Case 2: [Playground](http://is.gd/McmuLm)\n\n``` rust\nuse std::cell::Cell;\n\nuse std::panic::{self, RecoverSafe};\n\nstruct MyWrapper(Cell<u32>);\n\nimpl RecoverSafe for MyWrapper {}\n\nfn main() {\n    let should_work = MyWrapper(Cell::new(0));\n\n    panic::recover(|| should_work.0.set(0));\n}\n```\n\nBoth produce errors like this:\n\n```\n<anon>:8:5: 8:19 error: the trait `std::panic::NoUnsafeCell` is not implemented for the type `core::cell::UnsafeCell<i32>` [E0277]\n<anon>:8     panic::recover(|| should_work.set(0));\n             ^~~~~~~~~~~~~~\n<anon>:8:5: 8:19 help: see the detailed explanation for E0277\n<anon>:8:5: 8:19 note: the type core::cell::UnsafeCell<i32> contains interior mutability and a reference may not be safely transferrable across a recover boundary\n<anon>:8:5: 8:19 note: required because of the requirements on the impl of `std::panic::NoUnsafeCell` for `core::cell::Cell<i32>`\n<anon>:8:5: 8:19 note: required because of the requirements on the impl of `std::panic::NoUnsafeCell` for `std::panic::AssertRecoverSafe<core::cell::Cell<i32>>`\n<anon>:8:5: 8:19 note: required because of the requirements on the impl of `std::panic::RecoverSafe` for `[closure@<anon>:8:20: 8:41 should_work:&std::panic::AssertRecoverSafe<core::cell::Cell<i32>>]`\n<anon>:8:5: 8:19 note: required by `std::panic::recover`\nerror: aborting due to previous error\nplaypen: application terminated with error code 101\n```\n\nCC @alexcrichton \n", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/30510/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/30510/timeline", "performed_via_github_app": null, "state_reason": "completed"}