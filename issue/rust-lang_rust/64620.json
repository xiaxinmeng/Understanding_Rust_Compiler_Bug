{"url": "https://api.github.com/repos/rust-lang/rust/issues/64620", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/64620/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/64620/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/64620/events", "html_url": "https://github.com/rust-lang/rust/issues/64620", "id": 495969829, "node_id": "MDU6SXNzdWU0OTU5Njk4Mjk=", "number": 64620, "title": "Compiler panic when yielding array element from non-generator", "user": {"login": "arxanas", "id": 454057, "node_id": "MDQ6VXNlcjQ1NDA1Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/454057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arxanas", "html_url": "https://github.com/arxanas", "followers_url": "https://api.github.com/users/arxanas/followers", "following_url": "https://api.github.com/users/arxanas/following{/other_user}", "gists_url": "https://api.github.com/users/arxanas/gists{/gist_id}", "starred_url": "https://api.github.com/users/arxanas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arxanas/subscriptions", "organizations_url": "https://api.github.com/users/arxanas/orgs", "repos_url": "https://api.github.com/users/arxanas/repos", "events_url": "https://api.github.com/users/arxanas/events{/privacy}", "received_events_url": "https://api.github.com/users/arxanas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 46741598, "node_id": "MDU6TGFiZWw0Njc0MTU5OA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-test", "name": "E-needs-test", "color": "02e10c", "default": false, "description": "Call for participation: writing correctness tests"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 679846574, "node_id": "MDU6TGFiZWw2Nzk4NDY1NzQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-generators", "name": "A-generators", "color": "f7e101", "default": false, "description": "Area: Generators"}, {"id": 1472513502, "node_id": "MDU6TGFiZWwxNDcyNTEzNTAy", "url": "https://api.github.com/repos/rust-lang/rust/labels/F-generators", "name": "F-generators", "color": "f9c0cc", "default": false, "description": "`#![feature(generators)]`"}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-19T18:52:16Z", "updated_at": "2020-03-09T15:16:46Z", "closed_at": "2020-03-09T15:16:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "Steps to reproduce:\r\n\r\n1. Run `cargo new --lib crash`.\r\n2. Replace `src/lib.rs` with this content:\r\n\r\n```\r\n#![feature(generators)]\r\n\r\npub fn crash(arr: [usize; 1]) {\r\n    yield arr[0];\r\n}\r\n```\r\n\r\n3. Run `RUST_BACKTRACE=full cargo +nightly build --verbose` to get this output:\r\n\r\n```\r\n   Compiling crash v0.1.0 (/Users/waleedk/Workspace/rust/crash)\r\n     Running `rustc --edition=2018 --crate-name crash src/lib.rs --color never --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 -C metadata=23cf916e5f69a1d5 -C extra-filename=-23cf916e5f69a1d5 --out-dir /Users/waleedk/Workspace/rust/crash/target/debug/deps -C incremental=/Users/waleedk/Workspace/rust/crash/target/debug/incremental -L dependency=/Users/waleedk/Workspace/rust/crash/target/debug/deps`\r\nerror[E0627]: yield statement outside of generator literal\r\n --> src/lib.rs:4:5\r\n  |\r\n4 |     yield arr[0];\r\n  |     ^^^^^^^^^^^^\r\n\r\nerror: internal compiler error: src/librustc/ty/context.rs:513: node_type: no type for node `expr arr (hir_id=HirId { owner: DefIndex(12), local_id: 4 })`\r\n\r\nthread 'rustc' panicked at 'Box<Any>', src/librustc_errors/lib.rs:643:9\r\nstack backtrace:\r\n   0:        0x106073185 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h407a883469cc9aea\r\n   1:        0x1060a9e40 - core::fmt::write::h0fac5bdf1ffbd343\r\n   2:        0x1060667db - std::io::Write::write_fmt::h29f6e9a4453f8e64\r\n   3:        0x1060774ca - std::panicking::default_hook::{{closure}}::h514976ca44017853\r\n   4:        0x1060771d5 - std::panicking::default_hook::h0cf5e5649c498611\r\n   5:        0x106e23a72 - rustc_driver::report_ice::h6ba72ba240c53ce3\r\n   6:        0x106077d02 - std::panicking::rust_panic_with_hook::hb89fa56b0e453398\r\n   7:        0x10894e321 - std::panicking::begin_panic::hce94a994785bd80a\r\n   8:        0x108962a11 - rustc_errors::Handler::bug::h265e236e59364186\r\n   9:        0x10827b7eb - rustc::util::bug::opt_span_bug_fmt::{{closure}}::h1866a473633f70cb\r\n  10:        0x108275f86 - rustc::ty::context::tls::with_opt::{{closure}}::h8e08a01f090121d8\r\n  11:        0x108275c84 - rustc::ty::context::tls::with_context_opt::hdad39dbafc5ec58d\r\n  12:        0x108275cb2 - rustc::ty::context::tls::with_opt::h32448c650a990704\r\n  13:        0x10827b708 - rustc::util::bug::opt_span_bug_fmt::h7d1e0412534498f1\r\n  14:        0x10827b65b - rustc::util::bug::bug_fmt::h15b5afa17bb8a885\r\n  15:        0x10846a6af - rustc::ty::context::TypeckTables::node_type::{{closure}}::h5cee46e2a7fddad1\r\n  16:        0x10846af7f - rustc::ty::context::TypeckTables::expr_ty_adjusted::h9a1a0498668f933a\r\n  17:        0x107349b61 - <rustc_typeck::check::writeback::WritebackCx as rustc::hir::intravisit::Visitor>::visit_expr::hfabfed1d580fd434\r\n  18:        0x107349d37 - <rustc_typeck::check::writeback::WritebackCx as rustc::hir::intravisit::Visitor>::visit_expr::hfabfed1d580fd434\r\n  19:        0x10749985f - rustc::hir::intravisit::walk_expr::hce3981a7cb93dce2\r\n  20:        0x107349d37 - <rustc_typeck::check::writeback::WritebackCx as rustc::hir::intravisit::Visitor>::visit_expr::hfabfed1d580fd434\r\n  21:        0x1072ef7d7 - rustc_typeck::check::writeback::<impl rustc_typeck::check::FnCtxt>::resolve_type_vars_in_body::hc3f47a3d49d6def3\r\n  22:        0x1074787a2 - rustc::ty::context::GlobalCtxt::enter_local::h699d9d6b520150c4\r\n  23:        0x10731d5ac - rustc_typeck::check::typeck_tables_of::h0349fdf1b9f7c1ea\r\n  24:        0x10736878a - rustc::ty::query::__query_compute::typeck_tables_of::he96adad9f8508347\r\n  25:        0x1073f245b - rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::typeck_tables_of>::compute::hc066a0e8be7ccc2d\r\n  26:        0x10739e9e9 - rustc::dep_graph::graph::DepGraph::with_task_impl::hbd4ef70d845d9338\r\n  27:        0x107415aa0 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h2ce71490153de00b\r\n  28:        0x1073ef260 - rustc::ty::<impl rustc::ty::context::TyCtxt>::par_body_owners::hc4ce32a0430f92a7\r\n  29:        0x10731d0a5 - rustc_typeck::check::typeck_item_bodies::h2b11ae34f5facd7b\r\n  30:        0x107368b92 - rustc::ty::query::__query_compute::typeck_item_bodies::h18343492cac5f4ec\r\n  31:        0x10739689b - rustc::dep_graph::graph::DepGraph::with_task_impl::h550c64cb66ef5c2a\r\n  32:        0x107470ca8 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::hffc3b386c637fd84\r\n  33:        0x10736bd65 - rustc::util::common::time::h7c6cc64b93fbb8e0\r\n  34:        0x1075166dc - rustc_typeck::check_crate::h1976021c3c35cace\r\n  35:        0x106ebc862 - rustc_interface::passes::analysis::h58e38d87b942506f\r\n  36:        0x106dd024e - rustc::ty::query::__query_compute::analysis::hddfd24a5907dd9e0\r\n  37:        0x106dd12d9 - rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query::h190aae50181d7543\r\n  38:        0x106df116c - rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}}::h5a27bf8f9540381c\r\n  39:        0x106f2ec9b - rustc_interface::passes::create_global_ctxt::{{closure}}::h9c5444345f4c2293\r\n  40:        0x106df3622 - rustc_interface::interface::run_compiler_in_existing_thread_pool::hfc3311be21f2f27a\r\n  41:        0x106e255e4 - std::thread::local::LocalKey<T>::with::h188788fcd090e799\r\n  42:        0x106e2a0e2 - scoped_tls::ScopedKey<T>::set::h999b3fc3ad485797\r\n  43:        0x106e43235 - syntax::with_globals::h3db29ff7d66827a3\r\n  44:        0x106dcb1fd - std::sys_common::backtrace::__rust_begin_short_backtrace::h1f76ce0ab4ce564e\r\n  45:        0x106086faf - __rust_maybe_catch_panic\r\n  46:        0x106de7407 - core::ops::function::FnOnce::call_once{{vtable.shim}}::h45a83671da86e5b7\r\n  47:        0x10605902e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h9c2e02a877751d79\r\n  48:        0x106085dbe - std::sys::unix::thread::Thread::new::thread_start::h48a214a3a7467592\r\n  49:     0x7fff5d2ee2eb - _pthread_body\r\n  50:     0x7fff5d2f1249 - _pthread_start\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: rustc 1.39.0-nightly (eceec57f7 2019-09-18) running on x86_64-apple-darwin\r\n\r\nnote: compiler flags: -C debuginfo=2 -C incremental --crate-type lib\r\n\r\nnote: some of the compiler flags provided by cargo are hidden\r\n\r\nquery stack during panic:\r\n#0 [typeck_tables_of] processing `crash`\r\n#1 [typeck_item_bodies] type-checking all item bodies\r\n#2 [analysis] running analysis passes on this crate\r\nend of query stack\r\nerror: aborting due to 2 previous errors\r\n\r\nerror: Could not compile `crash`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --edition=2018 --crate-name crash src/lib.rs --color never --crate-type lib --emit=dep-info,metadata,link -C debuginfo=2 -C metadata=23cf916e5f69a1d5 -C extra-filename=-23cf916e5f69a1d5 --out-dir /Users/waleedk/Workspace/rust/crash/target/debug/deps -C incremental=/Users/waleedk/Workspace/rust/crash/target/debug/incremental -L dependency=/Users/waleedk/Workspace/rust/crash/target/debug/deps` (exit code: 101)\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/64620/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/64620/timeline", "performed_via_github_app": null, "state_reason": "completed"}