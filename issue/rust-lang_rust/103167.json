{"url": "https://api.github.com/repos/rust-lang/rust/issues/103167", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103167/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103167/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103167/events", "html_url": "https://github.com/rust-lang/rust/issues/103167", "id": 1412247291, "node_id": "I_kwDOAAsO6M5ULS77", "number": 103167, "title": "Miri run fails with ICE since nightly-2022-10-07-x86_64-unknown-linux-gnu", "user": {"login": "pdegler", "id": 101572011, "node_id": "U_kgDOBg3dqw", "avatar_url": "https://avatars.githubusercontent.com/u/101572011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pdegler", "html_url": "https://github.com/pdegler", "followers_url": "https://api.github.com/users/pdegler/followers", "following_url": "https://api.github.com/users/pdegler/following{/other_user}", "gists_url": "https://api.github.com/users/pdegler/gists{/gist_id}", "starred_url": "https://api.github.com/users/pdegler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pdegler/subscriptions", "organizations_url": "https://api.github.com/users/pdegler/orgs", "repos_url": "https://api.github.com/users/pdegler/repos", "events_url": "https://api.github.com/users/pdegler/events{/privacy}", "received_events_url": "https://api.github.com/users/pdegler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": {"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "saethlin", "id": 12105168, "node_id": "MDQ6VXNlcjEyMTA1MTY4", "avatar_url": "https://avatars.githubusercontent.com/u/12105168?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saethlin", "html_url": "https://github.com/saethlin", "followers_url": "https://api.github.com/users/saethlin/followers", "following_url": "https://api.github.com/users/saethlin/following{/other_user}", "gists_url": "https://api.github.com/users/saethlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/saethlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saethlin/subscriptions", "organizations_url": "https://api.github.com/users/saethlin/orgs", "repos_url": "https://api.github.com/users/saethlin/repos", "events_url": "https://api.github.com/users/saethlin/events{/privacy}", "received_events_url": "https://api.github.com/users/saethlin/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2022-10-17T21:25:20Z", "updated_at": "2022-10-21T11:04:01Z", "closed_at": "2022-10-19T15:28:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "The ICE started to occur with bors merges from 6.10.2022. Or in other words the ICEs started to occur with nightly-2022-10-07-x86_64-unknown-linux-gnu. Might be related to [this](https://github.com/rust-lang/miri/commit/f6016e21e3a11305c8ebb7e082271dec3303f772) ?\n\n### Code\n\nUnfortunately there is no simple example to reproduce the problem. Also the bug does not occur if I only execute the one failing test. I need to execute the whole suite to reproduce the issue. Miri runs fine though if I run it with `-Zmiri-disable-stacked-borrows`. I will update the ticket in case I find a way to reproduce it with a minimal example.\n\n### Meta\n\n```\nnote: rustc 1.66.0-nightly (b8b5caee0 2022-10-16) running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C linker=/usr/local/bin/clang -C incremental=[REDACTED] -C link-arg=--ld-path=/usr/local/bin/mold -C target-cpu=haswell```\n```\n\n### Error output\n\nThe `len` is not always 101.  It seems to vary.\n\n```\nthread 'rustc' panicked at 'index out of bounds: the len is 101 but the index is 18446744073709551615', src/tools/miri/src/stacked_borrows/stack.rs:52:24\nstack backtrace:\n   0:     0x7f76f2f456e0 - std::backtrace_rs::backtrace::libunwind::trace::h420b76cfb3ed276a\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\n   1:     0x7f76f2f456e0 - std::backtrace_rs::backtrace::trace_unsynchronized::hacbdb913ccea9101\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\n   2:     0x7f76f2f456e0 - std::sys_common::backtrace::_print_fmt::h953538eb8ba96ed5\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys_common/backtrace.rs:65:5\n   3:     0x7f76f2f456e0 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h93076eeb0a1bbed5\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys_common/backtrace.rs:44:22\n   4:     0x7f76f2fa15fe - core::fmt::write::h56b300bf57434f0c\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/core/src/fmt/mod.rs:1209:17\n   5:     0x7f76f2f35855 - std::io::Write::write_fmt::h17ff8142c543b395\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/io/mod.rs:1682:15\n   6:     0x7f76f2f454a5 - std::sys_common::backtrace::_print::h3d4b2f01b3435b19\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys_common/backtrace.rs:47:5\n   7:     0x7f76f2f454a5 - std::sys_common::backtrace::print::hf0ed5585934d912e\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys_common/backtrace.rs:34:9\n   8:     0x7f76f2f482af - std::panicking::default_hook::{{closure}}::h042859901da68b6e\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/panicking.rs:267:22\n   9:     0x7f76f2f47fea - std::panicking::default_hook::h37c1e6eb5579d239\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/panicking.rs:286:9\n  10:     0x7f76f58808a4 - <rustc_driver[1e91e83c40bca741]::DEFAULT_HOOK::{closure#0}::{closure#0} as core[d82daa41da2dcefe]::ops::function::FnOnce<(&core[d82daa41da2dcefe]::panic::panic_info::PanicInfo,)>>::call_once::{shim:vtable#0}\n  11:     0x7f76f2f48ad9 - <alloc::boxed::Box<F,A> as core::ops::function::Fn<Args>>::call::h6a10e1e797bea4c6\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/alloc/src/boxed.rs:1952:9\n  12:     0x7f76f2f48ad9 - std::panicking::rust_panic_with_hook::ha30c889a2575a2e7\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/panicking.rs:692:13\n  13:     0x7f76f2f48857 - std::panicking::begin_panic_handler::{{closure}}::h05a6c6601af742f3\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/panicking.rs:579:13\n  14:     0x7f76f2f45b8c - std::sys_common::backtrace::__rust_end_short_backtrace::h1f8e6345c4ccc6b4\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys_common/backtrace.rs:137:18\n  15:     0x7f76f2f48572 - rust_begin_unwind\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/panicking.rs:575:5\n  16:     0x7f76f2f9dfe3 - core::panicking::panic_fmt::h4e865b31b9e1bf2f\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/core/src/panicking.rs:65:14\n  17:     0x7f76f2f9e1b2 - core::panicking::panic_bounds_check::h969e95bf83fee39f\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/core/src/panicking.rs:151:5\n  18:     0x55eaede085dd - <miri[153892d8abf64b8a]::stacked_borrows::stack::Stack>::retain\n  19:     0x55eaeddd1185 - <miri[153892d8abf64b8a]::mono_hash_map::MonoHashMap<rustc_middle[964f6684a34862c]::mir::interpret::AllocId, (rustc_const_eval[50e6fab6802f709a]::interpret::memory::MemoryKind<miri[153892d8abf64b8a]::machine::MiriMemoryKind>, rustc_middle[964f6684a34862c]::mir::interpret::allocation::Allocation<miri[153892d8abf64b8a]::machine::Provenance, miri[153892d8abf64b8a]::machine::AllocExtra>)>>::iter::<(), <rustc_const_eval[50e6fab6802f709a]::interpret::eval_context::InterpCx<miri[153892d8abf64b8a]::machine::MiriMachine> as miri[153892d8abf64b8a]::tag_gc::EvalContextExt>::remove_unreachable_tags::{closure#0}>\n  20:     0x55eaeddad8fc - <rustc_const_eval[50e6fab6802f709a]::interpret::eval_context::InterpCx<miri[153892d8abf64b8a]::machine::MiriMachine> as miri[153892d8abf64b8a]::tag_gc::EvalContextExt>::garbage_collect_tags\n  21:     0x55eaedcf3c26 - <miri[153892d8abf64b8a]::machine::MiriMachine as rustc_const_eval[50e6fab6802f709a]::interpret::machine::Machine>::before_terminator\n  22:     0x55eaede18357 - <core[d82daa41da2dcefe]::panic::unwind_safe::AssertUnwindSafe<miri[153892d8abf64b8a]::eval::eval_entry::{closure#0}> as core[d82daa41da2dcefe]::ops::function::FnOnce<()>>::call_once\n  23:     0x55eaeddf0a0d - miri[153892d8abf64b8a]::eval::eval_entry\n  24:     0x55eaedc5eba5 - <rustc_interface[b8f074db5ccc3360]::passes::QueryContext>::enter::<<miri[462ec713bdb5374c]::MiriCompilerCalls as rustc_driver[1e91e83c40bca741]::Callbacks>::after_analysis::{closure#0}, ()>\n  25:     0x55eaedc63443 - <miri[462ec713bdb5374c]::MiriCompilerCalls as rustc_driver[1e91e83c40bca741]::Callbacks>::after_analysis\n  26:     0x7f76f45cf640 - rustc_interface[b8f074db5ccc3360]::interface::create_compiler_and_run::<core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>, rustc_driver[1e91e83c40bca741]::run_compiler::{closure#1}>\n  27:     0x7f76f45ce442 - <scoped_tls[e8b2fb1c76acaf86]::ScopedKey<rustc_span[b9d6d35501d56459]::SessionGlobals>>::set::<rustc_interface[b8f074db5ccc3360]::interface::run_compiler<core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>, rustc_driver[1e91e83c40bca741]::run_compiler::{closure#1}>::{closure#0}, core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>>\n  28:     0x7f76f45cd91f - std[c2cba6617b893ef2]::sys_common::backtrace::__rust_begin_short_backtrace::<rustc_interface[b8f074db5ccc3360]::util::run_in_thread_pool_with_globals<rustc_interface[b8f074db5ccc3360]::interface::run_compiler<core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>, rustc_driver[1e91e83c40bca741]::run_compiler::{closure#1}>::{closure#0}, core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>>::{closure#0}, core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>>\n  29:     0x7f76f569816f - <<std[c2cba6617b893ef2]::thread::Builder>::spawn_unchecked_<rustc_interface[b8f074db5ccc3360]::util::run_in_thread_pool_with_globals<rustc_interface[b8f074db5ccc3360]::interface::run_compiler<core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>, rustc_driver[1e91e83c40bca741]::run_compiler::{closure#1}>::{closure#0}, core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>>::{closure#0}, core[d82daa41da2dcefe]::result::Result<(), rustc_errors[ecc419c4e7845dee]::ErrorGuaranteed>>::{closure#1} as core[d82daa41da2dcefe]::ops::function::FnOnce<()>>::call_once::{shim:vtable#0}\n  30:     0x7f76f2f525f3 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h989602533cadda4e\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/alloc/src/boxed.rs:1938:9\n  31:     0x7f76f2f525f3 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h1a2c4b6f03540d6c\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/alloc/src/boxed.rs:1938:9\n  32:     0x7f76f2f525f3 - std::sys::unix::thread::Thread::new::thread_start::h0a8188ba46c415bc\n                               at /rustc/b8b5caee04116c7383eb1c6470fcf15c437a60d4/library/std/src/sys/unix/thread.rs:108:17\n  33:     0x7f76f2e0d609 - start_thread\n  34:     0x7f76f2be1133 - clone\n  35:                0x0 - <unknown>\n\nerror: internal compiler error: unexpected panic\n\nnote: rustc 1.66.0-nightly (b8b5caee0 2022-10-16) running on x86_64-unknown-linux-gnu\n\nnote: compiler flags: -C embed-bitcode=no -C debuginfo=2 -C linker=/usr/local/bin/clang -C incremental=[REDACTED] -C link-arg=--ld-path=/usr/local/bin/mold -C target-cpu=haswell\n\nnote: some of the compiler flags provided by cargo are hidden\n\nquery stack during panic:\nend of query stack\n\nMiri caused an ICE during evaluation. Here's the interpreter backtrace at the time of the panic:\nnote: the place in the program where the ICE was triggered\n    --> /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mut_ptr.rs:40:28\n     |\n40   |             Some(res) => res,\n     |                            ^\n     |\n     = note: inside `std::ptr::mut_ptr::<impl *mut u8>::is_null` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/mut_ptr.rs:40:28\n     = note: inside `std::ptr::NonNull::<u8>::new` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ptr/non_null.rs:219:13\n     = note: inside `std::alloc::Global::alloc_impl` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/alloc.rs:182:27\n     = note: inside `<std::alloc::Global as std::alloc::Allocator>::allocate` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/alloc.rs:241:9\n     = note: inside `alloc::alloc::exchange_malloc` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/alloc.rs:330:11\n     = note: inside `arrow::array::data::layout` at /home/foolius/.rustup/toolchains/nightly-2022-10-17-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/macros.rs:52:13\n     = note: inside `arrow::array::ArrayData::validate` at /home/foolius/.cargo/registry/src/github.com-1ecc6299db9ec823/arrow-22.0.0/src/array/data.rs:662:22\n     = note: inside `arrow::array::ArrayData::validate_full` at /home/foolius/.cargo/registry/src/github.com-1ecc6299db9ec823/arrow-22.0.0/src/array/data.rs:1004:9\n```\n\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"saethlin\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103167/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103167/timeline", "performed_via_github_app": null, "state_reason": "completed"}