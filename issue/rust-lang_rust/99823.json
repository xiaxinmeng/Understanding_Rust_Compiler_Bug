{"url": "https://api.github.com/repos/rust-lang/rust/issues/99823", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/99823/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/99823/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/99823/events", "html_url": "https://github.com/rust-lang/rust/issues/99823", "id": 1320122931, "node_id": "I_kwDOAAsO6M5Or3oz", "number": 99823, "title": "Compiler panics with \"features\": \"16bit-mode\" on JSON target file", "user": {"login": "thomasarmel", "id": 24313857, "node_id": "MDQ6VXNlcjI0MzEzODU3", "avatar_url": "https://avatars.githubusercontent.com/u/24313857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomasarmel", "html_url": "https://github.com/thomasarmel", "followers_url": "https://api.github.com/users/thomasarmel/followers", "following_url": "https://api.github.com/users/thomasarmel/following{/other_user}", "gists_url": "https://api.github.com/users/thomasarmel/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomasarmel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomasarmel/subscriptions", "organizations_url": "https://api.github.com/users/thomasarmel/orgs", "repos_url": "https://api.github.com/users/thomasarmel/repos", "events_url": "https://api.github.com/users/thomasarmel/events{/privacy}", "received_events_url": "https://api.github.com/users/thomasarmel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1472563007, "node_id": "MDU6TGFiZWwxNDcyNTYzMDA3", "url": "https://api.github.com/repos/rust-lang/rust/labels/requires-nightly", "name": "requires-nightly", "color": "76dcde", "default": false, "description": "This issue requires a nightly compiler in some way."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-07-27T21:07:37Z", "updated_at": "2022-07-28T16:12:23Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\nThe issue comes from **\"features\": \"16bit-mode\"**\r\n\r\n### Code\r\n\r\n**.cargo/config.toml**\r\n```\r\n[unstable]\r\nbuild-std = [\"core\", \"compiler_builtins\", \"alloc\"]\r\n\r\n[build]\r\ntarget = \"i586-rust_dos.json\"\r\nrustflags = [\"-C\", \"link-arg=-Tlink.x\"]\r\n```\r\n\r\n**i586-rust_dos.json**\r\n```\r\n{\r\n    \"arch\": \"x86\",\r\n    \"cpu\": \"pentium\",\r\n    \"data-layout\": \"e-m:e-p:32:32-f64:32:64-f80:32-n8:16:32-S128\",\r\n    \"dynamic-linking\": false,\r\n    \"executables\": true,\r\n    \"has-rpath\": true,\r\n    \"is-builtin\": false,\r\n    \"linker-flavor\": \"ld.lld\",\r\n    \"linker\": \"rust-lld\",\r\n    \"llvm-target\": \"i586-unknown-none-code16\",\r\n    \"max-atomic-width\": 64,\r\n    \"os\": \"none\",\r\n    \"relocation-model\": \"static\",\r\n    \"position-independent-executables\": false,\r\n    \"relro-level\": \"off\",\r\n    \"target-c-int-width\": \"32\",\r\n    \"target-endian\": \"little\",\r\n    \"target-pointer-width\": \"32\",\r\n    \"vendor\": \"unknown\",\r\n    \"panic-strategy\": \"abort\",\r\n    \"disable-redzone\": true,\r\n    \"features\": \"16bit-mode\"\r\n}\r\n```\r\n\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.62.0-nightly (306ba8357 2022-04-05)\r\nbinary: rustc\r\ncommit-hash: 306ba8357fb36212b7d30efb9eb9e41659ac1445\r\ncommit-date: 2022-04-05\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.62.0-nightly\r\nLLVM version: 14.0.0\r\n```\r\n\r\n### Error output\r\n\r\n```\r\nerror: failed to run `rustc` to learn about target-specific information\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc - --crate-name ___ --print=file-names -C link-arg=-Tlink.x --target \\\\?\\C:\\Users\\Thomas\\Documents\\programmation\\rust\\rust_dos\\i586-rust_dos.json --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro --print=sysroot --print=cfg` (exit code: 101)\r\n  --- stderr\r\n  thread 'rustc' panicked at 'compiler\\rustc_codegen_llvm\\src\\llvm_util.rs:526:9: target feature `16bit-mode` must begin with a `+` or `-`', compiler\\rustc_middle\\src\\util\\bug.rs:36:26\r\n  stack backtrace:\r\n  note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n  error: internal compiler error: unexpected panic\r\n\r\n  note: the compiler unexpectedly panicked. this is a bug.\r\n\r\n  note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\n  note: rustc 1.62.0-nightly (306ba8357 2022-04-05) running on x86_64-pc-windows-msvc\r\n\r\n  note: compiler flags: -C link-arg=-Tlink.x --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro\r\n\r\n  query stack during panic:\r\n  end of query stack\r\nerror: `cargo metadata` exited with an error: error: failed to run `rustc` to learn about target-specific information\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc - --crate-name ___ --print=file-names -C link-arg=-Tlink.x --target \\\\?\\C:\\Users\\Thomas\\Documents\\programmation\\rust\\rust_dos\\i586-rust_dos.json --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro --print=sysroot --print=cfg` (exit code: 101)\r\n  --- stderr\r\n  thread 'rustc' panicked at 'compiler\\rustc_codegen_llvm\\src\\llvm_util.rs:526:9: target feature `16bit-mode` must begin with a `+` or `-`', compiler\\rustc_middle\\src\\util\\bug.rs:36:26\r\n  stack backtrace:\r\n  note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n  error: internal compiler error: unexpected panic\r\n\r\n  note: the compiler unexpectedly panicked. this is a bug.\r\n\r\n  note: we would appreciate a bug report: https://github.com/rust-lang/rust/issues/new?labels=C-bug%2C+I-ICE%2C+T-compiler&template=ice.md\r\n\r\n  note: rustc 1.62.0-nightly (306ba8357 2022-04-05) running on x86_64-pc-windows-msvc\r\n\r\n  note: compiler flags: -C link-arg=-Tlink.x --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro\r\n\r\n  query stack during panic:\r\n  end of query stack\r\n\r\nProcess finished with exit code 101\r\n\r\n```\r\n\r\n<!--\r\nInclude a backtrace in the code block by setting `RUST_BACKTRACE=1` in your\r\nenvironment. E.g. `RUST_BACKTRACE=1 cargo build`.\r\n-->\r\n<details><summary><strong>Backtrace</strong></summary>\r\n<p>\r\n\r\n```\r\n<backtrace>\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nI'm not able to share the backtrace because **cargo build --release** omits the _RUST_BACKTRACE_ env variable.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/99823/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/99823/timeline", "performed_via_github_app": null, "state_reason": null}