{"url": "https://api.github.com/repos/rust-lang/rust/issues/97673", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/97673/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/97673/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/97673/events", "html_url": "https://github.com/rust-lang/rust/issues/97673", "id": 1259435502, "node_id": "I_kwDOAAsO6M5LEXXu", "number": 97673, "title": "When requesting a different default linker (clang) build does not use it.", "user": {"login": "Firstyear", "id": 271005, "node_id": "MDQ6VXNlcjI3MTAwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/271005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Firstyear", "html_url": "https://github.com/Firstyear", "followers_url": "https://api.github.com/users/Firstyear/followers", "following_url": "https://api.github.com/users/Firstyear/following{/other_user}", "gists_url": "https://api.github.com/users/Firstyear/gists{/gist_id}", "starred_url": "https://api.github.com/users/Firstyear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Firstyear/subscriptions", "organizations_url": "https://api.github.com/users/Firstyear/orgs", "repos_url": "https://api.github.com/users/Firstyear/repos", "events_url": "https://api.github.com/users/Firstyear/events{/privacy}", "received_events_url": "https://api.github.com/users/Firstyear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-06-03T05:21:23Z", "updated_at": "2022-06-03T05:21:23Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When building rust from source, if you have defined the default-linker to be clang, and to use lld as the linker, the build can fail during `Building rustbuild` as the linker argument is NOT changed to the linker requested.\r\n\r\nSpecifically in this case because cc is gcc-12 which adds a flag for `--fix-cortex-a53-835769`, but the system lld14 does not recognise this flag. Had the linker used clang instead of cc in this case as requested it would have succeeded due to clang not emitting this flag. \r\n\r\nThe expected behaviour is that when a linker is requested in config.toml, it's used during the rustbuild stage. \r\n\r\n```\r\n[   31s] + ./configure --build=aarch64-unknown-linux-gnu --host=aarch64-unknown-linux-gnu --target=aarch64-unknown-linux-gnu,wasm32-unknown-unknown --prefix=/usr --bindir=/usr/bin --sysconfdir=/etc --datadir=/usr/share --localstatedir=/var --mandir=/usr/share/man --infodir=/usr/share/info --libdir=/usr/lib --docdir=/usr/share/doc/packages/rust --enable-local-rust --local-rust-root=/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr --disable-rpath --llvm-root=/usr --enable-llvm-link-shared --set rust.use-lld=true --set llvm.use-linker=lld --default-linker=clang --enable-optimize --enable-ccache --disable-docs --disable-compiler-docs --enable-verbose-tests --enable-vendor --enable-extended --tools=cargo --release-channel=stable\r\n[   31s] configure: processing command line\r\n[   31s] configure:\r\n[   31s] configure: build.build          := aarch64-unknown-linux-gnu\r\n[   31s] configure: build.host           := ['aarch64-unknown-linux-gnu']\r\n[   31s] configure: build.target         := ['aarch64-unknown-linux-gnu', 'wasm32-unknown- ...\r\n[   31s] configure: install.prefix       := /usr\r\n[   31s] configure: install.bindir       := /usr/bin\r\n[   31s] configure: install.sysconfdir   := /etc\r\n[   31s] configure: install.datadir      := /usr/share\r\n[   31s] configure: install.localstatedir := /var\r\n[   31s] configure: install.mandir       := /usr/share/man\r\n[   31s] configure: install.infodir      := /usr/share/info\r\n[   31s] configure: install.libdir       := /usr/lib\r\n[   31s] configure: install.docdir       := /usr/share/doc/packages/rust\r\n[   31s] configure: build.rustc          := /home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch6 ...\r\n[   31s] configure: build.cargo          := /home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch6 ...\r\n[   31s] configure: rust.rpath           := False\r\n[   31s] configure: target.aarch64-unknown-linux-gnu.llvm-config := /usr/bin/llvm-config\r\n[   31s] configure: llvm.link-shared     := True\r\n[   31s] configure: rust.use-lld         := True\r\n[   31s] configure: llvm.use-linker      := lld\r\n[   31s] configure: rust.default-linker  := clang\r\n[   31s] configure: rust.optimize        := True\r\n[   31s] configure: llvm.ccache          := True\r\n[   31s] configure: build.docs           := False\r\n[   31s] configure: build.compiler-docs  := False\r\n[   31s] configure: rust.verbose-tests   := True\r\n[   31s] configure: build.vendor         := True\r\n[   31s] configure: build.extended       := True\r\n[   31s] configure: build.tools          := ['cargo']\r\n[   31s] configure: rust.channel         := stable\r\n[   31s] configure: build.configure-args := ['--build=aarch64-unknown-linux-gnu', '--host= ...\r\n[   31s] warning: localstatedir will be ignored\r\n[   31s] warning: infodir will be ignored\r\n[   31s] configure:\r\n[   31s] configure: writing `config.toml` in current directory\r\n[   31s] configure:\r\n[   31s] configure: run `python /home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/x.py --help`\r\n[   31s] configure:\r\n[   31s] + python3 ./x.py build\r\n[   31s] info: using vendored source, but .cargo/config is already present.\r\n[   31s]       Reusing the current configuration file. But you may want to configure vendoring like this:\r\n[   31s] [source.crates-io]\r\n[   31s] replace-with = 'vendored-sources'\r\n[   31s] registry = 'https://example.com'\r\n[   31s]\r\n[   31s] [source.vendored-sources]\r\n[   31s] directory = '/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/vendor'\r\n[   31s]\r\n[   31s] warning: sqlite3 not available in python, skipping build directory lock\r\n[   31s] please file an issue on rust-lang/rust\r\n[   31s] this is not a problem for non-concurrent x.py invocations\r\n[   31s] Building rustbuild\r\n[   31s]    Compiling memchr v2.4.1\r\n[   31s]    Compiling proc-macro2 v1.0.30\r\n[   31s]    Compiling unicode-xid v0.2.2\r\n[   31s]    Compiling syn v1.0.80\r\n[   31s]    Compiling serde_derive v1.0.125\r\n[   31s]    Compiling cfg-if v1.0.0\r\n[   31s]    Compiling lazy_static v1.4.0\r\n[   31s]    Compiling serde v1.0.125\r\n[   31s]    Compiling log v0.4.14\r\n[   31s]    Compiling regex-automata v0.1.10\r\n[   32s]    Compiling crossbeam-utils v0.8.6\r\n[   32s]    Compiling regex-syntax v0.6.25\r\n[   32s]    Compiling libc v0.2.116\r\n[   32s]    Compiling ryu v1.0.5\r\n[   32s]    Compiling fnv v1.0.7\r\n[   32s]    Compiling serde_json v1.0.59\r\n[   32s]    Compiling same-file v1.0.6\r\n[   32s]    Compiling once_cell v1.7.2\r\n[   32s]    Compiling itoa v0.4.6\r\n[   32s]    Compiling unicode-width v0.1.8\r\n[   32s]    Compiling cc v1.0.69\r\n[   32s]    Compiling bootstrap v0.0.0 (/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/src/bootstrap)\r\n[   32s]    Compiling walkdir v2.3.1\r\n[   32s]    Compiling getopts v0.2.21\r\n[   32s]    Compiling thread_local v1.1.4\r\n[   32s]    Compiling cmake v0.1.44\r\n[   32s]    Compiling aho-corasick v0.7.18\r\n[   32s]    Compiling bstr v0.2.13\r\n[   32s]    Compiling quote v1.0.7\r\n[   33s]    Compiling opener v0.5.0\r\n[   33s]    Compiling filetime v0.2.14\r\n[   33s]    Compiling regex v1.5.4\r\n[   33s]    Compiling globset v0.4.5\r\n[   34s]    Compiling ignore v0.4.17\r\n[   38s]    Compiling toml v0.5.7\r\n[   44s]     Finished dev [unoptimized] target(s) in 13.28s\r\n[   45s] Building stage0 std artifacts (aarch64-unknown-linux-gnu -> aarch64-unknown-linux-gnu)\r\n[   45s]    Compiling cc v1.0.69\r\n[   45s]    Compiling core v0.0.0 (/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/library/core)\r\n[   45s]    Compiling libc v0.2.116\r\n[   45s]    Compiling memchr v2.4.1\r\n[   45s]    Compiling std v0.0.0 (/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/library/std)\r\n[   45s] error: linking with `cc` failed: exit status: 1\r\n[   45s]   |\r\n[   45s]   = note: \"cc\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.0.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.1.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.10.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.11.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.12.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.13.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.14.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.15.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.2.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.3.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.4.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.5.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.6.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.7.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.8.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.build_script_build.4e78f585-cgu.9.rcgu.o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae.182b0246r97ohym3.rcgu.o\" \"-Wl,--as-needed\" \"-L\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/deps\" \"-L\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libstd-7d5a620ab77655ab.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libpanic_unwind-2de0d40477269ad1.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libobject-59ae13aa5b85e878.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libmemchr-25c2a8eab25c758c.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libaddr2line-484db03cffcca5b6.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libgimli-77337fc21bd1cca4.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/librustc_demangle-8399fd816afb0bb6.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libstd_detect-dbd9d453a2c2347c.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libhashbrown-f5e9f9d7692ae465.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libminiz_oxide-0ae529ce319bd2e0.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libadler-91ebd391b9f3e29e.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-79cdd974e440af93.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libunwind-fb4f5845224d8c3b.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libcfg_if-12a6b9815d90b1e4.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/liblibc-b0a59add1f3108e8.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/liballoc-cc0694ace9be0e66.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/librustc_std_workspace_core-5a84de01a2ad7b8c.rlib\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libcore-d1ce211496f525c3.rlib\" \"-Wl,--end-group\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib/libcompiler_builtins-9453083e1ae0beda.rlib\" \"-Wl,-Bdynamic\" \"-lgcc_s\" \"-lutil\" \"-lrt\" \"-lpthread\" \"-lm\" \"-ldl\" \"-lc\" \"-Wl,--eh-frame-hdr\" \"-Wl,-znoexecstack\" \"-L\" \"/home/abuild/rpmbuild/BUILD/rust-1.61.0-aarch64-unknown-linux-gnu/usr/lib/rustlib/aarch64-unknown-linux-gnu/lib\" \"-o\" \"/home/abuild/rpmbuild/BUILD/rustc-1.61.0-src/build/aarch64-unknown-linux-gnu/stage0-std/release/build/std-1bb9ed7376897eae/build_script_build-1bb9ed7376897eae\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro,-znow\" \"-nodefaultlibs\" \"-fuse-ld=lld\"\r\n[   45s]   = note: ld.lld: error: unknown argument '--fix-cortex-a53-835769'\r\n[   45s]           collect2: error: ld returned 1 exit status\r\n```", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/97673/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/97673/timeline", "performed_via_github_app": null, "state_reason": null}