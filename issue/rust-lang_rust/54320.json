{"url": "https://api.github.com/repos/rust-lang/rust/issues/54320", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54320/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54320/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54320/events", "html_url": "https://github.com/rust-lang/rust/issues/54320", "id": 361243409, "node_id": "MDU6SXNzdWUzNjEyNDM0MDk=", "number": 54320, "title": "error: internal compiler error: librustc/hir/def.rs:289: attempted .def_id() on invalid def: Err", "user": {"login": "upsuper", "id": 333750, "node_id": "MDQ6VXNlcjMzMzc1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/333750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/upsuper", "html_url": "https://github.com/upsuper", "followers_url": "https://api.github.com/users/upsuper/followers", "following_url": "https://api.github.com/users/upsuper/following{/other_user}", "gists_url": "https://api.github.com/users/upsuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/upsuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/upsuper/subscriptions", "organizations_url": "https://api.github.com/users/upsuper/orgs", "repos_url": "https://api.github.com/users/upsuper/repos", "events_url": "https://api.github.com/users/upsuper/events{/privacy}", "received_events_url": "https://api.github.com/users/upsuper/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-09-18T10:43:15Z", "updated_at": "2018-09-18T10:59:26Z", "closed_at": "2018-09-18T10:59:26Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Having the following Cargo.toml:\r\n```toml\r\n[package]\r\nname = \"ice-test\"\r\nversion = \"0.1.0\"\r\nauthors = [\"Xidorn Quan <me@upsuper.org>\"]\r\nedition = \"2018\"\r\n\r\n[lib]\r\ncrate-type = [\"cdylib\"]\r\n\r\n[dependencies]\r\nwasm-bindgen = { git = \"https://github.com/rustwasm/wasm-bindgen\" }\r\n\r\n[dependencies.web-sys]\r\ngit = \"https://github.com/rustwasm/wasm-bindgen\"\r\nfeatures = [\r\n    \"Event\",\r\n    \"UiEvent\",\r\n]\r\n```\r\n\r\nand the following `lib.rs`:\r\n```rust\r\nuse wasm_bindgen::prelude::*;\r\nuse web_sys::KeyboardEvent;\r\n\r\npub fn foo() {\r\n    let a: KeyboardEvent;\r\n}\r\n```\r\n\r\nwith the following command:\r\n```\r\ncargo +nightly build --target wasm32-unknown-unknown\r\n```\r\n\r\nThe compiler panics as follow:\r\n```\r\nerror: internal compiler error: librustc/hir/def.rs:289: attempted .def_id() on invalid def: Err\r\n                                                                                \r\nthread 'main' panicked at 'Box<Any>', librustc_errors/lib.rs:586:9              \r\nstack backtrace:                                                                \r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace                 \r\n   1: std::sys_common::backtrace::print                                         \r\n   2: std::panicking::default_hook::{{closure}}                                 \r\n   3: std::panicking::default_hook                                              \r\n   4: rustc::util::common::panic_hook                                           \r\n   5: std::panicking::rust_panic_with_hook                                      \r\n   6: std::panicking::begin_panic                                               \r\n   7: rustc_errors::Handler::bug                                                \r\n   8: rustc::util::bug::opt_span_bug_fmt::{{closure}}                           \r\n   9: rustc::ty::context::tls::with_opt::{{closure}}                            \r\n  10: rustc::ty::context::tls::with_context_opt                                 \r\n  11: rustc::ty::context::tls::with_opt                                         \r\n  12: rustc::util::bug::opt_span_bug_fmt                                        \r\n  13: rustc::util::bug::bug_fmt                                                 \r\n  14: rustc::middle::dead::MarkSymbolVisitor::handle_definition                 \r\n  15: rustc::hir::intravisit::walk_ty                                           \r\n  16: rustc::hir::intravisit::walk_block                                        \r\n  17: <rustc::middle::dead::MarkSymbolVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_expr\r\n  18: <rustc::middle::dead::MarkSymbolVisitor<'a, 'tcx> as rustc::hir::intravisit::Visitor<'tcx>>::visit_nested_body\r\n  19: rustc::hir::intravisit::walk_item                                         \r\n  20: rustc::middle::dead::check_crate                                          \r\n  21: rustc::util::common::time                                                 \r\n  22: rustc::ty::context::tls::enter_context                                    \r\n  23: <std::thread::local::LocalKey<T>>::with                                   \r\n  24: rustc::ty::context::TyCtxt::create_and_enter                              \r\n  25: rustc_driver::driver::compile_input                                       \r\n  26: rustc_driver::run_compiler_with_pool                                      \r\n  27: rustc_driver::driver::spawn_thread_pool                                   \r\n  28: rustc_driver::run_compiler                                                \r\n  29: <scoped_tls::ScopedKey<T>>::set                                           \r\n  30: syntax::with_globals                                                      \r\n  31: __rust_maybe_catch_panic                                                  \r\n  32: rustc_driver::run                                                         \r\n  33: rustc_driver::main                                                        \r\n  34: std::rt::lang_start::{{closure}}                                          \r\n  35: std::panicking::try::do_call                                              \r\n  36: __rust_maybe_catch_panic                                                  \r\n  37: std::rt::lang_start_internal                                              \r\n  38: main                                                                      \r\nquery stack during panic:                                                       \r\nend of query stack                                                              \r\nerror: aborting due to previous error                   \r\n```\r\n\r\nMeta:\r\n```\r\nrustc 1.30.0-nightly (2ab3eba30 2018-09-14)\r\nbinary: rustc\r\ncommit-hash: 2ab3eba30741652ba538bc2fc2bba9d81a5c84c6\r\ncommit-date: 2018-09-14\r\nhost: x86_64-apple-darwin\r\nrelease: 1.30.0-nightly\r\nLLVM version: 8.0\r\n```", "closed_by": {"login": "upsuper", "id": 333750, "node_id": "MDQ6VXNlcjMzMzc1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/333750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/upsuper", "html_url": "https://github.com/upsuper", "followers_url": "https://api.github.com/users/upsuper/followers", "following_url": "https://api.github.com/users/upsuper/following{/other_user}", "gists_url": "https://api.github.com/users/upsuper/gists{/gist_id}", "starred_url": "https://api.github.com/users/upsuper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/upsuper/subscriptions", "organizations_url": "https://api.github.com/users/upsuper/orgs", "repos_url": "https://api.github.com/users/upsuper/repos", "events_url": "https://api.github.com/users/upsuper/events{/privacy}", "received_events_url": "https://api.github.com/users/upsuper/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54320/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54320/timeline", "performed_via_github_app": null, "state_reason": "completed"}