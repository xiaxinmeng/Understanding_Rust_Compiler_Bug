{"url": "https://api.github.com/repos/rust-lang/rust/issues/22187", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/22187/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/22187/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/22187/events", "html_url": "https://github.com/rust-lang/rust/issues/22187", "id": 57358468, "node_id": "MDU6SXNzdWU1NzM1ODQ2OA==", "number": 22187, "title": "ICE compiling libcore with RUST_LOG=debug", "user": {"login": "aidancully", "id": 503301, "node_id": "MDQ6VXNlcjUwMzMwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/503301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aidancully", "html_url": "https://github.com/aidancully", "followers_url": "https://api.github.com/users/aidancully/followers", "following_url": "https://api.github.com/users/aidancully/following{/other_user}", "gists_url": "https://api.github.com/users/aidancully/gists{/gist_id}", "starred_url": "https://api.github.com/users/aidancully/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aidancully/subscriptions", "organizations_url": "https://api.github.com/users/aidancully/orgs", "repos_url": "https://api.github.com/users/aidancully/repos", "events_url": "https://api.github.com/users/aidancully/events{/privacy}", "received_events_url": "https://api.github.com/users/aidancully/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-02-11T18:46:51Z", "updated_at": "2015-04-07T14:17:55Z", "closed_at": "2015-04-07T14:17:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "build command:\n\n```\nRUST_BACKTRACE=1 RUST_LOG=debug CFG_LLVM_LINKAGE_FILE=/usr/home/aidan/rust/aidancully/rust/x86_64-unknown-freebsd/rt/llvmdeps.rs LD_LIBRARY_PATH=/usr/home/aidan/rust/aidancully/rust/x86_64-unknown-freebsd/stage0/lib:/pkg/rust/lib: x86_64-unknown-freebsd/stage0/bin/rustc --cfg stage0 -O --cfg rtopt --cfg debug -C prefer-dynamic --target=x86_64-unknown-freebsd -D warnings -L x86_64-unknown-freebsd/rt -L /usr/home/aidan/rust/aidancully/rust/x86_64-unknown-freebsd/llvm/Release+Asserts/lib -L \"\" --out-dir x86_64-unknown-freebsd/stage0/lib/rustlib/x86_64-unknown-freebsd/lib -C extra-filename=-4e7c5e5c /usr/home/aidan/rust/aidancully/rust/src/libcore/lib.rs\n```\n\noutput tail:\n\n```\nDEBUG:rustc_typeck::astconv: ast_ty_to_ty(ast_ty=type(Self))\nDEBUG:rustc::middle::ty_walk: next(): stack=[TyS { sty: ty_param(ParamTy { space: SelfSpace, idx: 0, name: \"Self\"(10) \n}), flags: 2, region_depth: 0 }]\nDEBUG:rustc::middle::ty_walk: next: stack=[]\nDEBUG:rustc::middle::ty_walk: next(): stack=[]\nDEBUG:rustc_typeck::collect: ty_generics: def for type param: TypeParameterDef(DefId { krate: 0, node: 28888 }, Sized,\n TypeSpace/0), TypeSpace\nDEBUG:rustc::middle::ty: Interned type: TyS { sty: ty_projection(ProjectionTy { trait_ref: TraitRef { def_id: DefId { \nkrate: 0, node: 28875 }, substs: Substs { types: VecPerParamSpace {TypeSpace: [TyS { sty: ty_param(ParamTy { space: Ty\npeSpace, idx: 0, name: \"RHS\"(2016) }), flags: 1, region_depth: 0 }], SelfSpace: [TyS { sty: ty_param(ParamTy { space: \nSelfSpace, idx: 0, name: \"Self\"(10) }), flags: 2, region_depth: 0 }], FnSpace: [], }, regions: NonerasedRegions(VecPer\nParamSpace {TypeSpace: [], SelfSpace: [], FnSpace: [], }) } }, item_name: \"Output\"(662) }), flags: 131, region_depth: \n0 } Pointer: 0x80515f3c8\nerror: internal compiler error: unexpected panic\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'assertion failed: did.krate != ast::LOCAL_CRATE', /usr/home/rustbuild/src/rust-buildbot/sl\nave/snap3-bsd/build/src/librustc/middle/ty.rs:5342\n\nstack backtrace:\n   1:          0x1fcd2d0 - sys::backtrace::write::ha1d57a9df5a2f693fqy\n   2:          0x1fdb2e0 - failure::on_fail::hfce282f973673675zJF\n   3:          0x1f954f0 - rt::unwind::begin_unwind_inner::ha66af0dd4f8827bcxnF\n   4:           0x947460 - rt::unwind::begin_unwind::h1827019987828831768\n   5:           0xc6e4e0 - middle::ty::lookup_trait_def::ha7feab3e197f1950VQ7\n   6:           0xbaba60 - util::ppaux::ty..TraitRef<'tcx>.Repr<'tcx>::repr::h33b020d33af3b28apsw\n   7:           0xc668c0 - util::ppaux::ty..TraitPredicate<'tcx>.Repr<'tcx>::repr::hbf74eab3dd3fbda5iIx\n   8:           0xc667f0 - util::ppaux::ty..Binder<T>.Repr<'tcx>::repr::h18078159607407995581\n   9:           0xc71ff0 - middle::ty::ty..Predicate<'tcx>.Repr<'tcx>::repr::h8ba7c61308cdb541KE9\n  10:           0x7731d0 - util::ppaux::repr_vec::h15939608278100118170\n  11:           0x843680 - collect::trait_def_of_item::h00641e27aab43d5eLPw\n  12:           0x8538f0 - collect::CollectCtxt<'a, 'tcx>.AstConv<'tcx>::get_trait_def::hdda578395178a444g5v\n  13:           0x82d220 - astconv::ast_path_to_trait_ref::h5a8e2311a51c406bNqu\n  14:           0x7dd290 - astconv::instantiate_trait_ref::hac5260b61ea589f2unu\n  15:           0x82cc60 - astconv::instantiate_poly_trait_ref::h794f45e24e531b40Zlu\n  16:           0x85d970 - collect::compute_bounds::h7618fc0c60b4ede29ux\n  17:           0x843680 - collect::trait_def_of_item::h00641e27aab43d5eLPw\n  18:           0x842c50 - collect::CollectTraitDefVisitor<'a, 'tcx>.visit..Visitor<'v>::visit_item::h99bfd5c22238fb9eC0v\n  19:           0x842c50 - collect::CollectTraitDefVisitor<'a, 'tcx>.visit..Visitor<'v>::visit_item::h99bfd5c22238fb9eC0v\n  20:           0x883f30 - check_crate::closure.34427\n  21:           0x881a00 - check_crate::h86a876ef1ca89126ZKA\n  22:           0x4646c0 - driver::phase_3_run_analysis_passes::h57367842623679e7pGa\n  23:           0x44a2e0 - driver::compile_input::hc2766520ac97d2dfCba\n  24:           0x51e220 - run_compiler::h7c28b9751d19b5c87ac\n  25:           0x51c8b0 - thunk::F.Invoke<A, R>::invoke::h14453603883644514953\n  26:           0x51b600 - rt::unwind::try::try_fn::h11398371315295182304\n  27:          0x1fe07d0 - rust_try_inner\n  28:          0x1fe07c0 - rust_try\n  29:           0x51b8b0 - thunk::F.Invoke<A, R>::invoke::h14165555330071885221\n  30:          0x1fd99b0 - sys::thread::thread_start::hc2c3539848b3238eUvB\n  31:        0x802a7bc30 - <unknown>\n  32:                0x0 - <unknown>\n```\n\nI isolated the problem to this line in librustc_typeck/collect.rs:\n\n``` rust\n    debug!(\"ty_generics_for_trait: assoc_predicates={}\", assoc_predicates.repr(ccx.tcx));\n```\n\nIn this case, the assoc_predicates for a type are defined in the local crate (it's libcore, and the associated predicate is `?Sized`), so the `lookup_trait_def` assertion trips.\n", "closed_by": {"login": "aidancully", "id": 503301, "node_id": "MDQ6VXNlcjUwMzMwMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/503301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aidancully", "html_url": "https://github.com/aidancully", "followers_url": "https://api.github.com/users/aidancully/followers", "following_url": "https://api.github.com/users/aidancully/following{/other_user}", "gists_url": "https://api.github.com/users/aidancully/gists{/gist_id}", "starred_url": "https://api.github.com/users/aidancully/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aidancully/subscriptions", "organizations_url": "https://api.github.com/users/aidancully/orgs", "repos_url": "https://api.github.com/users/aidancully/repos", "events_url": "https://api.github.com/users/aidancully/events{/privacy}", "received_events_url": "https://api.github.com/users/aidancully/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/22187/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/22187/timeline", "performed_via_github_app": null, "state_reason": "completed"}