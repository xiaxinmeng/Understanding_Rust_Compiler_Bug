{"url": "https://api.github.com/repos/rust-lang/rust/issues/107033", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/107033/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/107033/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/107033/events", "html_url": "https://github.com/rust-lang/rust/issues/107033", "id": 1538045749, "node_id": "I_kwDOAAsO6M5brLc1", "number": 107033, "title": "Unable to instrument rust debug software", "user": {"login": "Yuri6037", "id": 6407288, "node_id": "MDQ6VXNlcjY0MDcyODg=", "avatar_url": "https://avatars.githubusercontent.com/u/6407288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yuri6037", "html_url": "https://github.com/Yuri6037", "followers_url": "https://api.github.com/users/Yuri6037/followers", "following_url": "https://api.github.com/users/Yuri6037/following{/other_user}", "gists_url": "https://api.github.com/users/Yuri6037/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yuri6037/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yuri6037/subscriptions", "organizations_url": "https://api.github.com/users/Yuri6037/orgs", "repos_url": "https://api.github.com/users/Yuri6037/repos", "events_url": "https://api.github.com/users/Yuri6037/events{/privacy}", "received_events_url": "https://api.github.com/users/Yuri6037/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123111, "node_id": "MDU6TGFiZWwxMjMxMTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-macos", "name": "O-macos", "color": "6e6ec0", "default": false, "description": "Operating system: macOS"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-18T13:56:47Z", "updated_at": "2023-01-19T08:47:30Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nWhen trying to instrument rust software built in debug mode under macOS, the instrument tool will throw `Required kernel recording resources are in use by another document`. Essentially you can't do any advanced instrumentation with debug executables built by rustc because rustc is not adding the proper entitlements to the built binary. It actually needs to add the get-task-allow entitlement when building in debug.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.66.1 (90743e729 2023-01-10)\r\nbinary: rustc\r\ncommit-hash: 90743e7298aca107ddaa0c202a4d3604e29bfeb6\r\ncommit-date: 2023-01-10\r\nhost: aarch64-apple-darwin\r\nrelease: 1.66.1\r\nLLVM version: 15.0.2\r\n```\r\n\r\n### Workaround\r\n\r\nCurrently it is possible to workaround the issue but it's a pain. it's not possible to integrate this in Cargo as it requires accessing zsh.\r\n\r\nPaste the following code in a zsh terminal opened at the target directory:\r\n\r\n```\r\ncodesign -s - -v -f --entitlements =(echo -n '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"https://www.apple.com/DTDs/PropertyList-1.0.dtd\"\\>\r\n<plist version=\"1.0\">\r\n    <dict>\r\n        <key>com.apple.security.get-task-allow</key>\r\n        <true/>\r\n    </dict>\r\n</plist>') testbin\r\n```\r\n\r\nUnfortunately you must run the same pain every time you build the software.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/107033/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/107033/timeline", "performed_via_github_app": null, "state_reason": null}