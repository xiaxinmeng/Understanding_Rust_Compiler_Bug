{"url": "https://api.github.com/repos/rust-lang/rust/issues/93059", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/93059/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/93059/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/93059/events", "html_url": "https://github.com/rust-lang/rust/issues/93059", "id": 1107532241, "node_id": "I_kwDOAAsO6M5CA5nR", "number": 93059, "title": "i586-unknown-linux-gnu target generates binaries containing Intel CET opcodes which are illegal on i586 processors", "user": {"login": "teknoman117", "id": 326028, "node_id": "MDQ6VXNlcjMyNjAyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/326028?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teknoman117", "html_url": "https://github.com/teknoman117", "followers_url": "https://api.github.com/users/teknoman117/followers", "following_url": "https://api.github.com/users/teknoman117/following{/other_user}", "gists_url": "https://api.github.com/users/teknoman117/gists{/gist_id}", "starred_url": "https://api.github.com/users/teknoman117/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teknoman117/subscriptions", "organizations_url": "https://api.github.com/users/teknoman117/orgs", "repos_url": "https://api.github.com/users/teknoman117/repos", "events_url": "https://api.github.com/users/teknoman117/events{/privacy}", "received_events_url": "https://api.github.com/users/teknoman117/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2022-01-19T01:21:45Z", "updated_at": "2022-01-20T04:21:46Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nAs the title says, I generated an i586 rust toolchain by doing the following:\r\n\r\n```\r\ngit clone https://github.com/rust-lang/rust\r\ncd rust\r\ngit checkout 1.58.0\r\ngit submodule update --init --recursive\r\n./x.py setup --build i686-unknown-linux-gnu --host i586-unknown-linux-gnu --target i586-unknown-linux-gnu -j 32\r\n./x.py dist --build i686-unknown-linux-gnu --host i586-unknown-linux-gnu --target i586-unknown-linux-gnu -j 32\r\n# transfer build/dist/rust-1.58.0-dev-i586-unknown-linux-gnu.tar.xz to an i586 target\r\n```\r\n\r\nHowever, after installing the toolchain, attempting to run any of the rust tooling throws an illegal instruction exception.\r\n\r\n```\r\n$ uname -a\r\nLinux remembrance 5.16.0-gentoo #8 SMP PREEMPT Thu Jan 13 18:49:55 PST 2022 i586 AMD-K6(tm) 3D processor AuthenticAMD GNU/Linux\r\n$ cargo new hello\r\nIllegal instruction\r\n$ rustc -vV\r\nIllegal instruction\r\n```\r\n\r\nRunning rustc under gdb and looking at the failing instruction shows that the binary contains the \"endbr32\" instruction, which is part of the Intel CET instruction set on Tiger Lake CPUs. These decode as \"NOP\" on i686 processors and x86_64 CPUs, but they are illegal opcodes for i586 processors. While I recognize that this processor is ancient, there is still one i586 processor series in production - the Vortex86. For any current Linux distros which still support i586, polkit depends on spidermonkey, which is partially written in rust.\r\n\r\n```\r\n$ gdb rustc\r\nGNU gdb (Gentoo 11.1 vanilla) 11.1\r\nCopyright (C) 2021 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.\r\nType \"show copying\" and \"show warranty\" for details.\r\nThis GDB was configured as \"i586-pc-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<https://bugs.gentoo.org/>.\r\nFind the GDB manual and other documentation resources online at:\r\n    <http://www.gnu.org/software/gdb/documentation/>.\r\n\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from rustc...\r\n(No debugging symbols found in rustc)\r\n(gdb) r\r\nStarting program: /usr/bin/rustc\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/libthread_db.so.1\".\r\n\r\nProgram received signal SIGILL, Illegal instruction.\r\n0xadc94000 in ?? () from /opt/rust-bin-1.58.0/bin/../lib/libstd-89b7c7054cbe007e.so\r\n(gdb) x/i $pc\r\n=> 0xadc94000:\tendbr32\r\n(gdb)\r\n```\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`: (from a chroot on an x86_64 desktop)\r\n```\r\nrustc 1.58.0-dev\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: i586-unknown-linux-gnu\r\nrelease: 1.58.0-dev\r\nLLVM version: 13.0.0\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/93059/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/93059/timeline", "performed_via_github_app": null, "state_reason": null}