{"url": "https://api.github.com/repos/rust-lang/rust/issues/81221", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81221/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81221/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81221/events", "html_url": "https://github.com/rust-lang/rust/issues/81221", "id": 790259841, "node_id": "MDU6SXNzdWU3OTAyNTk4NDE=", "number": 81221, "title": "Segfault while compiling bootstrap on a fresh git clone", "user": {"login": "Michael-F-Bryan", "id": 17380079, "node_id": "MDQ6VXNlcjE3MzgwMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/17380079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Michael-F-Bryan", "html_url": "https://github.com/Michael-F-Bryan", "followers_url": "https://api.github.com/users/Michael-F-Bryan/followers", "following_url": "https://api.github.com/users/Michael-F-Bryan/following{/other_user}", "gists_url": "https://api.github.com/users/Michael-F-Bryan/gists{/gist_id}", "starred_url": "https://api.github.com/users/Michael-F-Bryan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Michael-F-Bryan/subscriptions", "organizations_url": "https://api.github.com/users/Michael-F-Bryan/orgs", "repos_url": "https://api.github.com/users/Michael-F-Bryan/repos", "events_url": "https://api.github.com/users/Michael-F-Bryan/events{/privacy}", "received_events_url": "https://api.github.com/users/Michael-F-Bryan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 1359848690, "node_id": "MDU6TGFiZWwxMzU5ODQ4Njkw", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-needs-mcve", "name": "E-needs-mcve", "color": "02e10c", "default": false, "description": "Call for participation: This issue needs a Minimal Complete and Verifiable Example"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-01-20T19:39:29Z", "updated_at": "2021-01-21T08:30:56Z", "closed_at": "2021-01-21T08:30:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "While trying to reproduce #78778 with a brand new `git clone` (a4cbb44ae2c80545db957763b502dc7f6ea22085) I ran into a segfault while trying to build the bootstrapper. \r\n\r\nMore precisely, it seems to be the first build script that is run while compiling bootstrap's dependencies. I don't think it's related to the build scripts themselves because I tried running multiple times and different build scripts crashed each time.\r\n\r\nI tried this code:\r\n\r\n```console\r\n$ git clone git@github.com:Michael-F-Bryan/rust.git\r\n$ cd rust\r\n$ cp config.toml.example config.toml\r\n$ git diff config.toml\r\n  [llvm]\r\n- #download-ci-llvm = false\r\n+ download-ci-llvm = true\r\n\r\n- #assertions = false\r\n+ assertions = true\r\n$ ./x.py help\r\n(downloading of git submodules elided)\r\n\r\n./x.py\r\ninfo: Downloading and building bootstrap before processing --help\r\n      command. See src/bootstrap/README.md for help with common\r\n      commands.\r\nUpdating only changed submodules\r\nSubmodules updated in 0.02 seconds\r\n   Compiling proc-macro2 v1.0.19\r\n   Compiling syn v1.0.38\r\n   Compiling memchr v2.3.3\r\n   Compiling serde_derive v1.0.118\r\n   Compiling libc v0.2.79\r\n   Compiling serde v1.0.118\r\n   Compiling log v0.4.11\r\n   Compiling ryu v1.0.5\r\nerror: failed to run custom build command for `syn v1.0.38`\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/home/michael/Documents/forks/rust/build/bootstrap/debug/build/syn-b7583bbd78159d8e/build-script-build` (signal: 11, SIGSEGV: invalid memory reference)\r\nwarning: build failed, waiting for other jobs to finish...\r\nerror: build failed\r\nfailed to run: /home/michael/Documents/forks/rust/build/x86_64-unknown-linux-gnu/stage0/bin/cargo build --manifest-path /home/michael/Documents/forks/rust/src/bootstrap/Cargo.toml\r\n```\r\n\r\nStepping through the build script with a debugger wasn't overly helpful because it doesn't look like it was compiled with debug symbols. I *did* notice that we try to invoke a null function pointer though:\r\n\r\n```console\r\n$ gdb /home/michael/Documents/forks/rust/target/debug/build/proc-macro2-24f77336c7065965/build-script-build\r\n...\r\n(gdb) run\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x0000000000000001 in ?? ()\r\n(gdb) backtrace\r\n#0  0x0000000000000001 in ?? ()\r\n#1  0x00007fffffffde96 in ?? ()\r\n#2  0x0000000000000000 in ?? ()\r\n```\r\n\r\nIt may be because I've just read through @jyn514's [*\"What does this compile error mean?\"* Zulip thread](https://zulip-archive.rust-lang.org/182449tcompilerhelp/32107Whatdoesthiscompileerrormean.html), but feels like there may be something wrong with which `libstd` build scripts are linked to.\r\n\r\n~~Something else that may have contributed is me using `download-ci-llvm = true` in `config.toml` to try and avoid downloading LLVM over slow Australian internet.~~\r\n\r\n**Edit: Turns out `download-ci-llvm = true` had nothing to do with it. I removed that line and let `x.py` download LLVM and still got the segfault.**", "closed_by": {"login": "Michael-F-Bryan", "id": 17380079, "node_id": "MDQ6VXNlcjE3MzgwMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/17380079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Michael-F-Bryan", "html_url": "https://github.com/Michael-F-Bryan", "followers_url": "https://api.github.com/users/Michael-F-Bryan/followers", "following_url": "https://api.github.com/users/Michael-F-Bryan/following{/other_user}", "gists_url": "https://api.github.com/users/Michael-F-Bryan/gists{/gist_id}", "starred_url": "https://api.github.com/users/Michael-F-Bryan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Michael-F-Bryan/subscriptions", "organizations_url": "https://api.github.com/users/Michael-F-Bryan/orgs", "repos_url": "https://api.github.com/users/Michael-F-Bryan/repos", "events_url": "https://api.github.com/users/Michael-F-Bryan/events{/privacy}", "received_events_url": "https://api.github.com/users/Michael-F-Bryan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81221/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81221/timeline", "performed_via_github_app": null, "state_reason": "completed"}