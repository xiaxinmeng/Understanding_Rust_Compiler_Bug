{"url": "https://api.github.com/repos/rust-lang/rust/issues/109535", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/109535/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/109535/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/109535/events", "html_url": "https://github.com/rust-lang/rust/issues/109535", "id": 1637780737, "node_id": "I_kwDOAAsO6M5hno0B", "number": 109535, "title": "Run tests for dist builds", "user": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 593503757, "node_id": "MDU6TGFiZWw1OTM1MDM3NTc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-infra", "name": "T-infra", "color": "bfd4f2", "default": false, "description": "Relevant to the infrastructure team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2023-03-23T15:36:14Z", "updated_at": "2023-03-23T15:57:20Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "We currently run tests for stage 1 and stage 2 builds (I think). So these are guaranteed to pass on tier 1 targets.\r\n\r\nBut on some targets like x86_64-unknown-linux-gnu we don't ship stage 2 builds, we ship special PGO/BOLT builds that have more optimizations. As we have recently found out in #109067 and #108978, these extra optimizations can lead to miscompilations. We currently have no way to detect this except for users on nightly (or stable as in this case) to see weird behavior. That's very bad.\r\n\r\nTo do our best to prevent dist miscompilations from shipping, we should find a way to run tests for dist toolchains on targets where extra optimizations are applied.\r\n\r\nThe dist-x86_64-linux builder is currently one of the slowest builders and running tests in there takes extra time, which would slow down our CI. Ideally we'd find a way to run these tests without impacting CI performance.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/109535/reactions", "total_count": 6, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 6, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/109535/timeline", "performed_via_github_app": null, "state_reason": null}