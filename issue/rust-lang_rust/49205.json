{"url": "https://api.github.com/repos/rust-lang/rust/issues/49205", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/49205/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/49205/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/49205/events", "html_url": "https://github.com/rust-lang/rust/issues/49205", "id": 306820150, "node_id": "MDU6SXNzdWUzMDY4MjAxNTA=", "number": 49205, "title": "Tracking issue for missing Iterator::size_hint implementations", "user": {"login": "Phlosioneer", "id": 4657718, "node_id": "MDQ6VXNlcjQ2NTc3MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/4657718?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Phlosioneer", "html_url": "https://github.com/Phlosioneer", "followers_url": "https://api.github.com/users/Phlosioneer/followers", "following_url": "https://api.github.com/users/Phlosioneer/following{/other_user}", "gists_url": "https://api.github.com/users/Phlosioneer/gists{/gist_id}", "starred_url": "https://api.github.com/users/Phlosioneer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Phlosioneer/subscriptions", "organizations_url": "https://api.github.com/users/Phlosioneer/orgs", "repos_url": "https://api.github.com/users/Phlosioneer/repos", "events_url": "https://api.github.com/users/Phlosioneer/events{/privacy}", "received_events_url": "https://api.github.com/users/Phlosioneer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668062, "node_id": "MDU6TGFiZWwyMTE2NjgwNjI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs-api", "name": "T-libs-api", "color": "bfd4f2", "default": false, "description": "Relevant to the library API team, which will review and decide on the PR/issue."}, {"id": 650846969, "node_id": "MDU6TGFiZWw2NTA4NDY5Njk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-tracking-issue", "name": "C-tracking-issue", "color": "f5f1fd", "default": false, "description": "Category: A tracking issue for an RFC or an unstable feature."}, {"id": 889209675, "node_id": "MDU6TGFiZWw4ODkyMDk2NzU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-iterators", "name": "A-iterators", "color": "f7e101", "default": false, "description": "Area: Iterators"}, {"id": 2240305001, "node_id": "MDU6TGFiZWwyMjQwMzA1MDAx", "url": "https://api.github.com/repos/rust-lang/rust/labels/Libs-Tracked", "name": "Libs-Tracked", "color": "d4c5f9", "default": false, "description": "Libs issues that are tracked on the team's project board."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-20T11:08:19Z", "updated_at": "2020-08-22T23:39:35Z", "closed_at": "2020-08-22T09:24:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`size_hint()` can sometimes allow for more efficient memory allocations, and other good performance things.\r\n\r\nI intend to make a PR to implement the trivial / easy ones, at least. I've already made a PR for the first batch, #49201. The ones in that PR are omitted from this list.\r\n\r\nThis list will be updated as I sort through for false-positives.\r\n\r\nLiballoc:\r\n- [ ] [`Range<'a, K, V>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/liballoc/btree/map.rs#L1446) ~~(#49550)~~ This is hard, but doable, and useful.\r\n- [ ] [`RangeMut<'a, K, V>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/liballoc/btree/map.rs#L1578) ~~(#49550)~~ This is hard, but doable, and useful.\r\n- [ ] [`MergeIter<K, V, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/liballoc/btree/map.rs#L2503) ~~(#49550)~~ This is hard, but doable, and useful.\r\n- [ ] [`Range<'a, T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/liballoc/btree/set.rs#L2503) ~~(#49550)~~ This is hard, but doable, and useful.\r\n\r\nLibcore:\r\n- [x] ~~[`Pattern: $forward_iterator<'a, P>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libcore/str/mod.rs#L926)~~ Impossible to provide upper or lower bounds.\r\n- [x] ~~[`Pattern: $reverse_iterator<'a, P>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libcore/str/mod.rs#L960)~~ Impossible to provide upper or lower bounds.\r\n\r\nLibfmt_macros:\r\n- [x] ~~[`Parser<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libfmt_macros/lib.rs#L146)~~ Both impossible and irrelevant.\r\n\r\nLibproc_macro:\r\n- [x] ~~[`TokenTreeIter`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libproc_macro/lib.rs#L561)~~ Implementation is not trivial. It would be nice to do it eventually, though.\r\n\r\nLibrustc:\r\n- [ ] [`NodesMatchingSuffix<'o, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/hir/map/mod.rs#L1102)\r\n- [x] [`EnumerateAndAdjust<I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/hir/pat_util.rs#L26) (#49201)\r\n- [ ] [`TraitObligationStackList<'o, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/traits/select.rs#3352)\r\n- [x] ~~[`Ancestors`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/traits/specialize/specialization_graph.rs#L334)~~ Not trivial, and probably going to change.\r\n- [x] ~~[`Elaborator<'cx, 'gcx, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/traits/util.rs#L239)~~ No way to define an upper bound.\r\n- [x] ~~[`SupertraitDefIds<'cx, 'gcx, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/traits/util.rs#L296)~~  No way to define an upper bound.\r\n- [x] ~~[`TypeWalker<'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc/ty/walk.rs#L51)~~ No way to define an upper bound.\r\n- [ ] [`Iter<'dom, Node>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_data_structures/control_flow_graph/dominators/mod.rs#L148)\r\n- [ ] [`Iter<'a, T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_data_structures/indexed_set.rs#L235)\r\n- [ ] [`Iter<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_llvm/archive_ro.rs#L90)\r\n- [ ] [`Prefixes<'cx, 'gcx, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_mir/borrow_check/prefixes.rs#L86)\r\n- [ ] [`ValueIter`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_trans/base.rs#L674)\r\n- [ ] [`Autoderef<'a, 'gcx, 'tcx>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustc_typecheck/check/autoderef.rs#L44)\r\n\r\nLibrustdoc:\r\n- [ ] [`CodeBlocks<'a, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustdoc/html/markdown.rs#L139)\r\n- [ ] [`LinkReplacer<'a, 'b, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustdoc/html/markdown.rs#L247)\r\n- [ ] [`HeadingLinks<'a, 'b, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustdoc/html/markdown.rs#L282)\r\n- [ ] [`SummaryLine<'a, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustdoc/html/markdown.rs#L339)\r\n- [ ] [`Footnotes<'a, I>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/librustdoc/html/markdown.rs#L702)\r\n- [ ] [`Parser<T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libserialize/json.rs#L1424)\r\n\r\nLibstd:\r\n- fs\r\n   - [ ] [`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/fs.rs#L1232) ~~(#49552)~~(#71308)\r\n- io\r\n   - [x] ~~[`Bytes<R>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/io/mod.rs#L1989)~~ There's no way to do this.\r\n   - [x] ~~[`Chars<R>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/io/mod.rs#L2026)~~ There's no way to do this.\r\n   - [x] ~~[`Split<B>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/io/mod.rs#L2101)~~ There's no way to do this.\r\n- net\r\n    - [x] ~~[`Lines<B>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/net/mod.rs#L146)~~ Depreciated.\r\n    - [x] ~~[`Incoming<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/net/tcp.rs#L891)~~ There's no way to provide anything better than `(1, None)`\r\n- path\r\n    - [ ] [`Iter<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/path.rs#L894) (#49552)\r\n    - [x] ~~[`Components<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/path.rs#L913)~~ Writing a `size_hint` for this is hard. But it would be useful; this is often `collect()`-ed.\r\n    - [x] ~~[`Ancestors<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/path.rs#L1067)~~ Writing a `size_hint` for this is hard, and not very useful.\r\n- sync\r\n    - [x] ~~[`Iter<'a, T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sync/mpsc/mod.rs#L1565)~~ Inherently unbounded iterator.\r\n    - [x] ~~[`TryIter<'a, T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sync/mpsc/mod.rs#L1572)~~ Inherently unbounded iterator.\r\n    - [x] ~~[`IntoIter<T>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sync/mpsc/mod.rs#L1587)~~ Inherently unbounded iterator.\r\n    - [x] ~~[`Packets`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sync/mpsc/select.rs#L341)~~ Impossible to write an upper bound.\r\n- sys\r\n    - cloudabi\r\n        - [ ] [`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/cloudabi/shims/fs.rs#L147) ~~(#49552)~~ (#71308)\r\n        - [ ] [`LookupHost`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/cloudabi/shims/net.rs#L287) ~~(#49552)~~ (#71308)\r\n        - [ ] [`SplitPaths<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/cloudabi/shims/os.rs#L51) ~~(#49552)~~(#71308)\r\n    - redox\r\n        - [ ] [`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/redox/fs.rs#L143) (#49552)\r\n        - [ ] [`LookupHost`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/redox/net/mod.rs#L34) (#49552)\r\n    - unix\r\n        - [x] ~~[`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/unix/fs.rs#L214)~~ No cheap way to do this.\r\n        - [ ] [`LookupHost`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/unix/l4re.rs#L427) (#49552)\r\n    - wasm\r\n        - [ ] [`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/wasm/fs.rs#L149) ~~(#49552)~~ (#71308) \r\n        - [ ] [`LookupHost`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/wasm/net.rs#L289) ~~(#49552)~~ (#71308) \r\n        - [ ] [`SplitPaths<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/wasm/os.rs#L41) ~~(#49552)~~ (#71308) \r\n        - [ ] [`Env`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/wasm/os.rs#L75) ~~(#49552)~~ (#71308)\r\n    - windows\r\n        - [x] ~~[`ReadDir`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/windows/fs.rs#L94)~~ There's no cheap way to do this.\r\n        - [x] ~~[`Env`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/windows/os.rs#L94)~~ There's no _safe_ way to do this.\r\n        - [ ] [`SplitPaths<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys/windows/os.rs#L156) ~~(#49552)~~ (#71308)\r\n- sys_common\r\n   - [x] ~~[`LookupHost`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd/sys_common/net.rs#L134)~~ There's no _safe_ way to do this.\r\n- unicode\r\n   - [ ] [`ToLowercase`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd_unicode/char.rs#L66) (#50208)\r\n   - [ ] [`ToUppercase`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd_unicode/char.rs#L88) (#50208)\r\n   - [ ] [`CaseMappingIter`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd_unicode/char.rs#L120) (#50208)\r\n   - [ ] [`Utf8LossyChunksIter<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd_unicode/lossy.rs#L57) (#50208)\r\n   - [ ] [`SplitWhitespace<'a>`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libstd_unicode/u_str.rs#L173) (#50208)\r\n\r\nLibsyntax:\r\n- [ ] [`Frame`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libsyntax/ext/tt/transcribe.rs#L49)\r\n- [ ] [`Cursor`](https://github.com/rust-lang/rust/blob/6bfa7d02d6713acd15ead20c199b808e85031f9e/src/libsyntax/tokenstream.rs#L420)\r\n\r\nCargo:\r\nrust-lang/cargo#5211\r\n\r\nI found them by running `grep -r -n \"impl.*\\bIterator for \\|fn size_hint\" src > size_hint_todo.txt`. Then, delete any pairs of an `Iterator` line followed by a `size_hint` line, and manually check the remaining `Iterator` lines for false positives.\r\n\r\nIt may be a good idea to make a lint for implementing size_hint. It would be opt-in, of course. It's really easy to forget, even if you're trying to optimize performance.", "closed_by": {"login": "KodrAus", "id": 6721458, "node_id": "MDQ6VXNlcjY3MjE0NTg=", "avatar_url": "https://avatars.githubusercontent.com/u/6721458?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KodrAus", "html_url": "https://github.com/KodrAus", "followers_url": "https://api.github.com/users/KodrAus/followers", "following_url": "https://api.github.com/users/KodrAus/following{/other_user}", "gists_url": "https://api.github.com/users/KodrAus/gists{/gist_id}", "starred_url": "https://api.github.com/users/KodrAus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KodrAus/subscriptions", "organizations_url": "https://api.github.com/users/KodrAus/orgs", "repos_url": "https://api.github.com/users/KodrAus/repos", "events_url": "https://api.github.com/users/KodrAus/events{/privacy}", "received_events_url": "https://api.github.com/users/KodrAus/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/49205/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 2, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/49205/timeline", "performed_via_github_app": null, "state_reason": "completed"}