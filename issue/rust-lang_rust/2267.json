{"url": "https://api.github.com/repos/rust-lang/rust/issues/2267", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/2267/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/2267/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/2267/events", "html_url": "https://github.com/rust-lang/rust/issues/2267", "id": 4226875, "node_id": "MDU6SXNzdWU0MjI2ODc1", "number": 2267, "title": "avoiding races with native module initializers", "user": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37544, "node_id": "MDU6TGFiZWwzNzU0NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-typesystem", "name": "A-typesystem", "color": "f7e101", "default": false, "description": "Area: The type system"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2012-04-22T01:04:23Z", "updated_at": "2013-04-24T00:05:14Z", "closed_at": "2013-04-24T00:05:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The three SSL libraries I've looked at so far, OpenSSL, GnuTLS, and NSS, each require a function to be called (and in some cases, mutexes to be passed in) to initialize their global data structures (ugh). Even better, these functions aren't thread safe, so initialization needs to be pushed up to the executable in order for libraries to not stomp on each other's toes. Now, if a user happens to forget to initialize the library, then they are exposed to race conditions and segfaults.\n\nI'd like to avoid that. Here's what I came up with to avoid these races:\n- We allow native modules to declare a static initializer that runs before main, and a destructor that runs after.\n- Add global (#553), statically initialized mutexes. These then can be used by the library to protect the library initializer functions. To protect against the user not actually initializing the functions, our wrapper could return an abstract handle that's required by the bindings.\n- Do nothing! These other options are worse than just assuming that people will read and follow the documentation.\n", "closed_by": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/2267/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/2267/timeline", "performed_via_github_app": null, "state_reason": "completed"}