{"url": "https://api.github.com/repos/rust-lang/rust/issues/79577", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/79577/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/79577/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/79577/events", "html_url": "https://github.com/rust-lang/rust/issues/79577", "id": 753776518, "node_id": "MDU6SXNzdWU3NTM3NzY1MTg=", "number": 79577, "title": "What's the current state of cross-compilation from Linux -> Windows with (i686|x86_64)-pc-windows-gnu?", "user": {"login": "LunarLambda", "id": 38919842, "node_id": "MDQ6VXNlcjM4OTE5ODQy", "avatar_url": "https://avatars.githubusercontent.com/u/38919842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LunarLambda", "html_url": "https://github.com/LunarLambda", "followers_url": "https://api.github.com/users/LunarLambda/followers", "following_url": "https://api.github.com/users/LunarLambda/following{/other_user}", "gists_url": "https://api.github.com/users/LunarLambda/gists{/gist_id}", "starred_url": "https://api.github.com/users/LunarLambda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LunarLambda/subscriptions", "organizations_url": "https://api.github.com/users/LunarLambda/orgs", "repos_url": "https://api.github.com/users/LunarLambda/repos", "events_url": "https://api.github.com/users/LunarLambda/events{/privacy}", "received_events_url": "https://api.github.com/users/LunarLambda/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 123110, "node_id": "MDU6TGFiZWwxMjMxMTA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-linux", "name": "O-linux", "color": "6e6ec0", "default": false, "description": "Operating system: Linux"}, {"id": 167285428, "node_id": "MDU6TGFiZWwxNjcyODU0Mjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-cross", "name": "A-cross", "color": "f7e101", "default": false, "description": "Area: Cross compilation"}, {"id": 266005714, "node_id": "MDU6TGFiZWwyNjYwMDU3MTQ=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-gnu", "name": "O-windows-gnu", "color": "6e6ec0", "default": false, "description": "Toolchain: GNU, Operating system: Windows"}, {"id": 2352122097, "node_id": "MDU6TGFiZWwyMzUyMTIyMDk3", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-discussion", "name": "C-discussion", "color": "f5f1fd", "default": false, "description": "Category: Discussion or questions that doesn't represent real issues."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-11-30T20:24:43Z", "updated_at": "2020-12-02T17:04:25Z", "closed_at": "2020-12-02T16:58:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm currently trying to somehow build a 32-bit Windows cdylib on Linux (although this should apply to *any* crate type, not just cdylibs), and after hours of intense rabbitholing through multiple years-old GitHub issues, I wanna compile what I've gathered.\r\n\r\ni686-pc-windows-gnu:\r\n\r\n1) requires an externally-installed mingw compiler toolchain.\r\n2) will only work if said toolchain uses dw2 exception handling, since that's what Rust expects\r\n3) with few exceptions, most distributions only provide mingw packages which use sjlj exceptions.\r\n4) there were multiple attempts to resolve this, all of them more or less fruitless\r\n5) if you can't easily obtain a dw2 toolchain, you have the following options:\r\n5.1 use xargo (and thus nightly) to compile `std` and your code with `panic=abort`\r\n5.2 use cross, which has a docker image that will build a dw2 toolchain for you, incurring *significant* build time overhead.\r\n\r\nx86_64-pc-windows-gnu:\r\n\r\n1) still requires an externally-installed mingw toolchain.\r\n2) sort of just works? most distros provide packages that use SEH, rust expects SEH, all is well in the world<sup>[citation extremely needed]</sup>\r\n(unfortunately, this does not help me, as I don't think 32-bit programs can load 64-bit libraries.)\r\n\r\nquestions I couldn't answer:\r\n1) is there any (current) work happening to improve the situation around `i686-pc-windows-gnu`, or is it officially 'abandon all hope, ye who enter here' territory?\r\n2) what is the situation regarding threads? mingw comes in posix and win32-threads flavours, and this has in the past been an additional source of problems, I'm not sure if this has been fixed? (https://github.com/rust-lang/rust/pull/71023)\r\n\r\nupdate 21:43 2020-11-30: The docker image cross provides seems to have worked. I could build the cdylib, load it, and call a function in it. this is still far from ideal, as the docker image took significant amounts of time to prepare, and consumes significant amounts of disk space..\r\n", "closed_by": {"login": "LunarLambda", "id": 38919842, "node_id": "MDQ6VXNlcjM4OTE5ODQy", "avatar_url": "https://avatars.githubusercontent.com/u/38919842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LunarLambda", "html_url": "https://github.com/LunarLambda", "followers_url": "https://api.github.com/users/LunarLambda/followers", "following_url": "https://api.github.com/users/LunarLambda/following{/other_user}", "gists_url": "https://api.github.com/users/LunarLambda/gists{/gist_id}", "starred_url": "https://api.github.com/users/LunarLambda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LunarLambda/subscriptions", "organizations_url": "https://api.github.com/users/LunarLambda/orgs", "repos_url": "https://api.github.com/users/LunarLambda/repos", "events_url": "https://api.github.com/users/LunarLambda/events{/privacy}", "received_events_url": "https://api.github.com/users/LunarLambda/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/79577/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/79577/timeline", "performed_via_github_app": null, "state_reason": "completed"}