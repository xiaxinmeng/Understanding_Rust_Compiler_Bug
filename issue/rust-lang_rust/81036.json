{"url": "https://api.github.com/repos/rust-lang/rust/issues/81036", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/81036/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/81036/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/81036/events", "html_url": "https://github.com/rust-lang/rust/issues/81036", "id": 786755901, "node_id": "MDU6SXNzdWU3ODY3NTU5MDE=", "number": 81036, "title": "Incorrect inference in closure leading to confusing error message", "user": {"login": "hniksic", "id": 1078190, "node_id": "MDQ6VXNlcjEwNzgxOTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1078190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hniksic", "html_url": "https://github.com/hniksic", "followers_url": "https://api.github.com/users/hniksic/followers", "following_url": "https://api.github.com/users/hniksic/following{/other_user}", "gists_url": "https://api.github.com/users/hniksic/gists{/gist_id}", "starred_url": "https://api.github.com/users/hniksic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hniksic/subscriptions", "organizations_url": "https://api.github.com/users/hniksic/orgs", "repos_url": "https://api.github.com/users/hniksic/repos", "events_url": "https://api.github.com/users/hniksic/events{/privacy}", "received_events_url": "https://api.github.com/users/hniksic/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 122406831, "node_id": "MDU6TGFiZWwxMjI0MDY4MzE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-closures", "name": "A-closures", "color": "f7e101", "default": false, "description": "Area: closures (`|args| { .. }`)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2021-01-15T09:46:11Z", "updated_at": "2021-01-16T05:47:38Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The following code compiles:\r\n\r\n```rust\r\nfn main() {\r\n    let a_closure = |num| {\r\n        num+1.0\r\n    };\r\n    println!(\"{}\", a_closure(1.0));\r\n}\r\n```\r\n\r\nBut the following doesn't:\r\n\r\n```rust\r\nfn main() {\r\n    let a_closure = |num| {\r\n        return num+1.0\r\n    };\r\n    println!(\"{}\", a_closure(1.0));\r\n}\r\n```\r\n\r\nThe compiler reports:\r\n\r\n```none\r\nerror[E0308]: mismatched types\r\n --> src/main.rs:3:9\r\n  |\r\n3 |         return num+1.0\r\n  |         ^^^^^^^^^^^^^^ expected `()`, found `f64`\r\n```\r\n\r\nExpected behavior would be that either:\r\n\r\n* The compiler correctly infers the return type of the closure, like it does in the previous example, and accepts the code - or,\r\n* The compiler fails to infer the type and reports an error along the lines of `error[E0282]: type annotations needed`.\r\n\r\nThe current message makes it look like the return type of the closure is incorrect, and it's not clear that specifying an explicit argument type for the closure will fix it (which it does, as does specifying an explicit return type).\r\n\r\nCompiler version: 1.49.0 Stable\r\nThe same error occurs with 1.51.0 nightly.\r\n\r\nReport based on a [StackOverflow question](https://stackoverflow.com/q/65726999/1600898).", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/81036/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/81036/timeline", "performed_via_github_app": null, "state_reason": null}