{"url": "https://api.github.com/repos/rust-lang/rust/issues/26447", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/26447/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/26447/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/26447/events", "html_url": "https://github.com/rust-lang/rust/issues/26447", "id": 89716546, "node_id": "MDU6SXNzdWU4OTcxNjU0Ng==", "number": 26447, "title": "`sepcomp-lib-lto` test fails on master with --enable-debug", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 120005, "node_id": "MDU6TGFiZWwxMjAwMDU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-testsuite", "name": "A-testsuite", "color": "f7e101", "default": false, "description": "Area: The testsuite used to check the correctness of rustc"}, {"id": 203130, "node_id": "MDU6TGFiZWwyMDMxMzA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-debuginfo", "name": "A-debuginfo", "color": "f7e101", "default": false, "description": "Area: Debugging information in compiled programs (DWARF, PDB, etc.)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-06-20T04:38:25Z", "updated_at": "2015-08-16T16:26:32Z", "closed_at": "2015-08-16T16:26:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "When compiling with --enable-debug, the `sepcomp-lib-lto` test fails. It passes if I build without --enable-debug. Relevant build output:\n\n```\n$ git rev-parse HEAD\na9515698fa456390386087ccb6123ce741f18527\n$ uname -a\nLinux dev 3.19.0-18-generic #18-Ubuntu SMP Tue May 19 18:31:35 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n$ ./configure --enable-debug\n$ make -j12 check-stage1-rpass TESTNAME=sepcomp-lib-lto\n\n...\n\nrunning 1 test\ntest [run-pass] run-pass/sepcomp-lib-lto.rs ... FAILED\n\nfailures:\n\n---- [run-pass] run-pass/sepcomp-lib-lto.rs stdout ----\n\nerror: compilation failed!\nstatus: signal: 6\ncommand: x86_64-unknown-linux-gnu/stage1/bin/rustc /home/ubuntu/rust/src/test/run-pass/sepcomp-lib-lto.rs -L x86_64-unknown-linux-gnu/test/run-pass/ --target=x86_64-unknown-linux-gnu -L x86_64-unknown-linux-gnu/test/run-pass/sepcomp-lib-lto.stage1-x86_64-unknown-linux-gnu.run-pass.libaux -o x86_64-unknown-linux-gnu/test/run-pass/sepcomp-lib-lto.stage1-x86_64-unknown-linux-gnu -O -L x86_64-unknown-linux-gnu/rt -C lto\nstdout:\n------------------------------------------\n\n------------------------------------------\nstderr:\n------------------------------------------\nrustc: /home/ubuntu/rust/src/llvm/lib/CodeGen/AsmPrinter/DwarfUnit.cpp:708: llvm::DIE* llvm::DwarfUnit::getOrCreateTypeDIE(const llvm::MDNode*): Assertion `Ty == resolve(Ty->getRef()) && \"type was not uniqued, possible ODR violation.\"' failed.\n\n------------------------------------------\n\nthread '[run-pass] run-pass/sepcomp-lib-lto.rs' panicked at 'explicit panic', /home/ubuntu/rust/src/compiletest/runtest.rs:1497\n\n\n\nfailures:\n    [run-pass] run-pass/sepcomp-lib-lto.rs\n\n    test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured\n\n    thread '<main>' panicked at 'Some tests failed', /home/ubuntu/rust/src/compiletest/compiletest.rs:252\n    /home/ubuntu/rust/mk/tests.mk:756: recipe for target 'tmp/check-stage1-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-rpass.ok' failed\n    make: *** [tmp/check-stage1-T-x86_64-unknown-linux-gnu-H-x86_64-unknown-linux-gnu-rpass.ok] Error 101\n```\n\nBacktrace:\n\n```\n#0  0x00007ffff6cb0267 in __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:55  \n#1  0x00007ffff6cb1eca in __GI_abort () at abort.c:89  \n#2  0x00007ffff6ca903d in __assert_fail_base (fmt=0x7ffff6e0b028 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\",   \n    assertion=assertion@entry=0x7ffff1e75ca8 \"Ty == resolve(Ty->getRef()) && \\\"type was not uniqued, possible ODR violation.\\\"\", file=file@entry=0x7ffff1e75878 \"/home/ubuntu/rust/src/llvm/lib/CodeGen/AsmPrinter/DwarfUnit.cpp\",   \n    line=line@entry=708,   \n    function=function@entry=0x7ffff1e78300 <llvm::DwarfUnit::getOrCreateTypeDIE(llvm::MDNode const*)::__PRETTY_FUNCTION__> \"llvm::DIE* llvm::DwarfUnit::getOrCreateTypeDIE(const llvm::MDNode*)\") at assert.c:92  \n#3  0x00007ffff6ca90f2 in __GI___assert_fail (  \n    assertion=0x7ffff1e75ca8 \"Ty == resolve(Ty->getRef()) && \\\"type was not uniqued, possible ODR violation.\\\"\",   \n    file=0x7ffff1e75878 \"/home/ubuntu/rust/src/llvm/lib/CodeGen/AsmPrinter/DwarfUnit.cpp\", line=708,   \n    function=0x7ffff1e78300 <llvm::DwarfUnit::getOrCreateTypeDIE(llvm::MDNode const*)::__PRETTY_FUNCTION__> \"llvm::DIE* llvm::DwarfUnit::getOrCreateTypeDIE(const llvm::MDNode*)\") at assert.c:101  \n#4  0x00007ffff0dcdd6e in llvm::DwarfUnit::getOrCreateTypeDIE(llvm::MDNode const*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#5  0x00007ffff0dcddb9 in llvm::DwarfUnit::addType(llvm::DIE&, llvm::DIType const*, llvm::dwarf::Attribute) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#6  0x00007ffff0dce59a in llvm::DwarfUnit::constructTypeDIE(llvm::DIE&, llvm::DISubroutineType const*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#7  0x00007ffff0dcdc7a in llvm::DwarfUnit::getOrCreateTypeDIE(llvm::MDNode const*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#8  0x00007ffff0dcddb9 in llvm::DwarfUnit::addType(llvm::DIE&, llvm::DIType const*, llvm::dwarf::Attribute) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#9  0x00007ffff0dcd3af in llvm::DwarfUnit::applySubprogramAttributes(llvm::DISubprogram const*, llvm::DIE&, bool) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#10 0x00007ffff0da7962 in llvm::DwarfCompileUnit::applySubprogramAttributesToDefinition(llvm::DISubprogram const*, llvm::DIE&) () from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#11 0x00007ffff0daebd2 in llvm::DwarfCompileUnit::constructAbstractSubprogramScopeDIE(llvm::LexicalScope*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#12 0x00007ffff0dbc4f5 in llvm::DwarfDebug::constructAbstractSubprogramScopeDIE(llvm::LexicalScope*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#13 0x00007ffff0dc210b in llvm::DwarfDebug::endFunction(llvm::MachineFunction const*) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#14 0x00007ffff0d8dbe5 in llvm::AsmPrinter::EmitFunctionBody() ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#15 0x00007ffff0a925c6 in llvm::X86AsmPrinter::runOnMachineFunction(llvm::MachineFunction&) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#16 0x00007ffff16b71a8 in llvm::FPPassManager::runOnFunction(llvm::Function&) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#17 0x00007ffff16b7893 in llvm::legacy::PassManagerImpl::run(llvm::Module&) ()  \n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_llvm-d8ace771.so  \n#18 0x00007ffff047d095 in LLVMRustWriteOutputFile (Target=0x7fffe8085580, PMR=0x7fffe80211f0, M=0x7fffe8006220,   \n    path=0x7fffed3f4b20 \"x\\326\\034\\356\\377\\177\", FileType=llvm::TargetMachine::CGFT_ObjectFile)  \n    at /home/ubuntu/rust/src/rustllvm/PassWrapper.cpp:249  \n#19 0x00007ffff55de42a in rustc_trans::back::write::write_output_file (handler=0x7fffed3f84c8, target=0x7fffe8085580,   \n    pm=0x7fffe80211f0, m=0x7fffe8006220, output=0x7fffec4e2d80, file_type=ObjectFileType)  \n    at src/librustc_trans/back/write.rs:72  \n#20 0x00007ffff55eb33f in fnfn (cpm=0x7fffe80211f0) at src/librustc_trans/back/write.rs:565  \n#21 0x00007ffff55eb26e in rustc_trans::back::write::optimize_and_codegen::with_codegen<closure> (tm=0x7fffe8085580,   \n    llmod=0x7fffe8006220, no_builtins=false, f={void (struct (*mut rustc_llvm::PassManager_opaque))} 0x7fffed3f4e68)  \n    at src/librustc_trans/back/write.rs:533  \n#22 0x00007ffff55ea9cb in fnfn () at src/librustc_trans/back/write.rs:564  \n#23 0x00007ffff55ea0ed in rustc_trans::util::common::time<(),(),closure> (do_it=false, what=..., u=0,   \n    f={void (struct (()))} 0x7fffed3f5460) at src/librustc/util/common.rs:39  \n#24 0x00007ffff55e80ea in rustc_trans::back::write::optimize_and_codegen (cgcx=0x7fffed3f63c0, mtrans=..., config=...,   \n    name_extra=..., output_names=...) at src/librustc_trans/back/write.rs:543  \n#25 0x00007ffff55f2864 in rustc_trans::back::write::execute_work_item (cgcx=0x7fffed3f63c0, work_item=...)  \n    at src/librustc_trans/back/write.rs:906  \n#26 0x00007ffff55ef155 in rustc_trans::back::write::run_work_singlethreaded (sess=0x7fffed3f7c88, reachable=...,   \n    work_items=...) at src/librustc_trans/back/write.rs:919  \n#27 0x00007ffff55ebe6f in rustc_trans::back::write::run_passes (sess=0x7fffed3f7c88, trans=0x7fffed3f7968,   \n    output_types=..., crate_output=0x7fffed3f7a10) at src/librustc_trans/back/write.rs:677\n#28 0x00007ffff7a6c7fe in fnfn () at src/librustc_driver/driver.rs:767\n#29 0x00007ffff7a6c432 in rustc_driver::util::common::time<(),(),closure> (do_it=false, what=..., u=0, \n    f={void (struct (()))} 0x7fffed3f74e8) at src/librustc/util/common.rs:39\n#30 0x00007ffff78ed1fd in rustc_driver::driver::phase_5_run_llvm_passes (sess=0x7fffed3f7c88, trans=0x7fffed3f7968, \n    outputs=0x7fffed3f7a10) at src/librustc_driver/driver.rs:766\n#31 0x00007ffff7844144 in rustc_driver::driver::compile_input (sess=..., cfg=..., input=0x7fffed3fdf98, \n    outdir=0x7fffed3fe110, output=0x7fffed3fe0f0, addl_plugins=..., control=...) at src/librustc_driver/driver.rs:168\n#32 0x00007ffff7b096df in rustc_driver::run_compiler (args=..., callbacks=...) at src/librustc_driver/lib.rs:156\n#33 0x00007ffff7b060fc in fnfn () at src/librustc_driver/lib.rs:99\n#34 0x00007ffff7b052c9 in fnfn () at src/librustc_driver/lib.rs:806\n#35 0x00007ffff7b051a6 in rustc_driver::boxed::F.FnBox<A>::call_box (self=0x7fffed43a060, args=0)\n    at src/liballoc/boxed.rs:398\n#36 0x00007ffff7b04a6f in rustc_driver::boxed::Box<FnBox<A, Output = R>+ Send + 'a>.FnOnce<A>::call_once (self=..., \n    args=0) at src/liballoc/boxed.rs:414\n#37 0x00007ffff7b044cc in fnfn () at src/libstd/thread/mod.rs:349\n#38 0x00007ffff7b0444f in rustc_driver::rt::unwind::try::try_fn<closure> (opt_closure=0x7fffed3fe8e8)\n    at src/libstd/rt/unwind/mod.rs:158\n#39 0x00007ffff7b043ea in rt::unwind::try::try_fn::h17428172142314623289 ()\n   from x86_64-unknown-linux-gnu/stage1/lib/librustc_driver-d8ace771.so\n#40 0x00007ffff7332de9 in rust_try_inner () from x86_64-unknown-linux-gnu/stage1/lib/libstd-d8ace771.so\n#41 0x00007ffff7332dd6 in rust_try () from x86_64-unknown-linux-gnu/stage1/lib/libstd-d8ace771.so\n#42 0x00007ffff718fa30 in std::rt::unwind::try::inner_try (f={void (enum class c_void *)} 0x7fffed3fe8a8, \n    data=0x7fffed3fe8e8) at src/libstd/rt/unwind/mod.rs:147\n#43 0x00007ffff7b04385 in rustc_driver::rt::unwind::try<closure> (f={void (())} 0x7fffed3fe900)\n    at src/libstd/rt/unwind/mod.rs:130\n#44 0x00007ffff7b0419d in fnfn () at src/libstd/thread/mod.rs:349\n#45 0x00007ffff7b04ca1 in rustc_driver::boxed::F.FnBox<A>::call_box (self=0x7fffed424180, args=0)\n    at src/liballoc/boxed.rs:398\n#46 0x00007ffff71b0eaf in std::boxed::Box<FnBox<A, Output = R>+ 'a>.FnOnce<A>::call_once (self=..., args=0)\n    at src/liballoc/boxed.rs:406\n#47 0x00007ffff71b0de7 in std::sys_common::thread::start_thread (main=0x7fffed43b000)\n    at src/libstd/sys/common/thread.rs:30\n#48 0x00007ffff71e2d05 in std::sys::thread::Thread::new::thread_start (main=0x7fffed43b000)\n    at src/libstd/sys/unix/thread.rs:77\n#49 0x00007ffff71e2c85 in sys::thread::Thread::new::thread_start::hfcb7277d7665b775tKv ()\n   from x86_64-unknown-linux-gnu/stage1/lib/libstd-d8ace771.so\n#50 0x00007fffef6db6aa in start_thread (arg=0x7fffed3ff700) at pthread_create.c:333\n#51 0x00007ffff6d81eed in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:109\n```\n", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/26447/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/26447/timeline", "performed_via_github_app": null, "state_reason": "completed"}