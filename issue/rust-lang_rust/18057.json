{"url": "https://api.github.com/repos/rust-lang/rust/issues/18057", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18057/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18057/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18057/events", "html_url": "https://github.com/rust-lang/rust/issues/18057", "id": 45840890, "node_id": "MDU6SXNzdWU0NTg0MDg5MA==", "number": 18057, "title": "internal compiler error", "user": {"login": "potan", "id": 402241, "node_id": "MDQ6VXNlcjQwMjI0MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/402241?v=4", "gravatar_id": "", "url": "https://api.github.com/users/potan", "html_url": "https://github.com/potan", "followers_url": "https://api.github.com/users/potan/followers", "following_url": "https://api.github.com/users/potan/following{/other_user}", "gists_url": "https://api.github.com/users/potan/gists{/gist_id}", "starred_url": "https://api.github.com/users/potan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/potan/subscriptions", "organizations_url": "https://api.github.com/users/potan/orgs", "repos_url": "https://api.github.com/users/potan/repos", "events_url": "https://api.github.com/users/potan/events{/privacy}", "received_events_url": "https://api.github.com/users/potan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2014-10-15T08:22:51Z", "updated_at": "2015-01-08T19:32:32Z", "closed_at": "2015-01-08T19:32:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\nerror: internal compiler error: type_of with ty_param\nnote: the compiler hit an unexpected failure path. this is a bug.\nnote: we would appreciate a bug report: http://doc.rust-lang.org/complement-bugreport.html\nnote: run with `RUST_BACKTRACE=1` for a backtrace\ntask 'rustc' failed at 'Box<Any>', /home/pm/lang/rust/rust/src/libsyntax/diagnostic.rs:169\n\nstack backtrace:\n   1:     0x7fdc7b12c500 - rt::backtrace::imp::write::h1477ac29053ece3cgDq\n   2:     0x7fdc7b12f630 - failure::on_fail::h090bf222fe08db7cDYq\n   3:     0x7fdc7b8f6430 - unwind::begin_unwind_inner::h51916ee1d5d0deddGxd\n   4:     0x7fdc77529790 - unwind::begin_unwind::h15240260624484748152\n   5:     0x7fdc77529e70 - diagnostic::Handler::bug::had6fd9d040101c34hRF\n   6:     0x7fdc7bcda490 - driver::session::Session::bug::h85ae544149280a1fTey\n   7:     0x7fdc7c0b80e0 - middle::trans::type_of::type_of::h3c358519e57ad9e6Zxa\n   8:     0x7fdc7c0b80e0 - middle::trans::type_of::type_of::h3c358519e57ad9e6Zxa\n   9:     0x7fdc7c0b80e0 - middle::trans::type_of::type_of::h3c358519e57ad9e6Zxa\n  10:     0x7fdc7c1d9270 - middle::trans::adt::struct_llfields::h6d3c4aa8a91bfda3sIu\n  11:     0x7fdc7c13ec20 - middle::trans::adt::finish_type_of::h54eeac837f85766amwu\n  12:     0x7fdc7c0b80e0 - middle::trans::type_of::type_of::h3c358519e57ad9e6Zxa\n  13:     0x7fdc7c0b80e0 - middle::trans::type_of::type_of::h3c358519e57ad9e6Zxa\n  14:     0x7fdc7c0fa410 - middle::trans::expr::trans_uniq_expr::h5a4901312595da40iC5\n  15:     0x7fdc7c0face0 - middle::trans::expr::trans_unary::h7f46b3d2ee23e0f1oy5\n  16:     0x7fdc7c0f0000 - middle::trans::expr::trans_unadjusted::he0f7295d106fefd2Zd4\n  17:     0x7fdc7c0b3810 - middle::trans::expr::trans::haaafc6b790c7b639Vw3\n  18:     0x7fdc7c0b22c0 - middle::trans::expr::trans_into::h3d5706a30846aafa1s3\n  19:     0x7fdc7c0b26e0 - middle::trans::controlflow::trans_block::hd5280d031efda9d6lGZ\n  20:     0x7fdc7c162fe0 - middle::trans::base::trans_closure::h0a7f4de06bee1c8cXBf\n  21:     0x7fdc7c0a41f0 - middle::trans::base::trans_fn::h8f8a2c035208e8d7lNf\n  22:     0x7fdc7c0a48e0 - middle::trans::monomorphize::monomorphic_fn::h2dc0c402c9883ce927Y\n  23:     0x7fdc7c0dc660 - middle::trans::callee::trans_fn_ref_with_substs::hdd194b502b4a58441m2\n  24:     0x7fdc7c0d9c80 - middle::trans::callee::trans_fn_ref::h4330edb19ab1b6e6zb2\n  25:     0x7fdc7c0e2570 - middle::trans::callee::trans_call::closure.124125\n  26:     0x7fdc7c0ba020 - middle::trans::callee::trans_call_inner::hcbca3b6787659c03JI2\n  27:     0x7fdc7c0e22c0 - middle::trans::callee::trans_call::h9fcac721e6cb55314C2\n  28:     0x7fdc7c0f13c0 - middle::trans::expr::trans_rvalue_dps_unadjusted::hd9a2a83d30d7aaeftR4\n  29:     0x7fdc7c0b22c0 - middle::trans::expr::trans_into::h3d5706a30846aafa1s3\n  30:     0x7fdc7c191c90 - middle::trans::_match::store_local::closure.128240\n  31:     0x7fdc7c191a80 - middle::trans::_match::mk_binding_alloca::h482564913738985314\n  32:     0x7fdc7c1597e0 - middle::trans::_match::store_local::h3d0fc4ae7771500aNZi\n  33:     0x7fdc7c0b18a0 - middle::trans::base::init_local::h2cb16046bc383b89xKe\n  34:     0x7fdc7c0b0c60 - middle::trans::controlflow::trans_stmt::h4f1b84665f48152afBZ\n  35:     0x7fdc7c0b26e0 - middle::trans::controlflow::trans_block::hd5280d031efda9d6lGZ\n  36:     0x7fdc7c162fe0 - middle::trans::base::trans_closure::h0a7f4de06bee1c8cXBf\n  37:     0x7fdc7c0a41f0 - middle::trans::base::trans_fn::h8f8a2c035208e8d7lNf\n  38:     0x7fdc7c0a1850 - middle::trans::base::trans_item::h5de357321a9ed4f6E6f\n  39:     0x7fdc7c16e5a0 - middle::trans::base::trans_crate::hc46c87ff47e81464a5g\n  40:     0x7fdc7c5bfb70 - driver::driver::phase_4_translate_to_llvm::h045fe4f7e55962abvFx\n  41:     0x7fdc7c5b5e70 - driver::driver::compile_input::hf1074c4e89201e93qcx\n  42:     0x7fdc7c6412a0 - driver::run_compiler::h0ecb6658398d53f6J0A\n  43:     0x7fdc7c641150 - driver::run::closure.147558\n  44:     0x7fdc7bd09cd0 - task::TaskBuilder<S>::try_future::closure.101668\n  45:     0x7fdc7bd09ab0 - task::TaskBuilder<S>::spawn_internal::closure.101639\n  46:     0x7fdc7ceb1120 - task::spawn_opts::closure.8447\n  47:     0x7fdc7b9503e0 - rust_try_inner\n  48:     0x7fdc7b9503d0 - rust_try\n  49:     0x7fdc7b8f3cf0 - unwind::try::h15600d03dfaaa405omd\n  50:     0x7fdc7b8f3b70 - task::Task::run::h2760aad0762be53e2Bc\n  51:     0x7fdc7ceb0e60 - task::spawn_opts::closure.8387\n  52:     0x7fdc7b8f5440 - thread::thread_start::h7a688dc7bb49fbdedWc\n  53:     0x7fdc7abf3ec0 - start_thread\n  54:     0x7fdc7b5b99d9 - __clone\n  55:                0x0 - <unknown>\n```\n\nwhile compile code:\n\n``` rust\n#![feature(unboxed_closures, overloaded_calls, unboxed_closure_sugar)]\n\npub trait Seq<T> {\n    fn pop(self) -> Result<(T, Self, Self), Self>;\n}\n\nimpl<'a> Seq<char> for &'a str {\n    fn pop(self) -> Result<(char, &'a str, &'a str), &'a str> {\n        if self.is_empty() {\n            Err(self)\n        } else {\n            Ok((self.char_at(0), self, self.slice_from(1)))\n        }\n    }\n}\n\ntype ParseResult<S /*:Seq<C>*/,T> = Result<(T, S, S),S>;\ntype Parser<S /*:Seq<C>*/,T> = Box<|&: S| -> ParseResult<S /*:Seq<C>*/,T>>;\n\nfn elem<T, S:Seq<T>, Res>(e:Box<|&: T| -> Option<Res>>) -> Parser<S, Res> {\n  box |&: s:S| {\n    match s.pop() {\n      Err(b) => Err(b),\n      Ok((c, b, n)) => match e.call((c,)) {\n                         Some(r) => Ok((r, b, n)),\n                         None => Err(b)\n                       }\n    }\n  }\n}\n\nfn concat<C,S:Seq<C>,T1,T2>(p1: Parser<S, T1>, p2: Parser<S, T2>) -> Parser<S,(T1,T2)> {\n  box |&: s:S| {\n    match p1.call((s,)) {\n       Err(b) => Err(b),\n       Ok((r1, b, n1)) => {\n         match p2.call((n1,)) {\n            Err(_) => Err(b),\n            Ok((r2, _, n2)) => Ok(((r1,r2), b, n2))\n         }\n       }\n    }\n  }\n}\n\nfn alter<C,S:Seq<C>,T>(p1: Parser<S, T>, p2: Parser<S, T>) -> Parser<S, T> {\n  box |&: s:S| {\n    match p1.call((s,)) {\n       Err(b) => p2.call((b,)),\n       r => r\n    }\n  }\n}\n\nfn digit(r:&int) -> Box<|&: char| -> Option<int>> {\n  box |&: c:char| {\n   let i = match c {\n             '0'...'9' => { c as int - '0' as int },\n             'a'...'z' => { 10 + c as int - 'a' as int },\n             'A'...'Z' => { 10 + c as int - 'A' as int },\n             _ => *r\n           };\n   if i < *r {\n    Some(i)\n   } else {\n    None\n   }\n  }\n}\n\nfn do_fold<S,T,R>(p:&Parser<S,T>, l:&Box<|&: T,R| -> R>, b:S, i:R, s:S) -> ParseResult<S,R> {\n  match p.call((s,)) {\n    Err(n) => Ok((i,b,n)),\n    Ok((r,_,n)) => {\n      let v = l.call((r,i));\n      do_fold(p,l,b,v,n)\n    }\n  }\n}\n\nfn fold1<S,T,R:Clone>(p:Parser<S,T>, l: Box<|&: T,R| -> R>, i:R) -> Parser<S,R> {\n  box |&: s:S| {\n    match p.call((s,)) {\n      Err(e) => Err(e),\n      Ok((r,b,n)) => {\n        let v = l.call((r,i.clone()));\n        do_fold(&p,&l,b,v,n)\n      }\n    }\n  }\n}\n\nfn main() {\n    static RADIX:int = 13;\n    let p1 = fold1(elem(digit(&RADIX)), box |&: c:int, v:int| -> int {v*RADIX+c}, 0i) ;\n    let p2 = alter(elem(box |&: c:char| { if c == 'z' { Some('Z') } else { None } }),\n                   elem(box |&: c:char| { if c == 'w' { Some('W') } else { None } })) ;\n    println!(\"{}\", concat(p1, p2).call((\"1awert\",)));\n}\n```\n", "closed_by": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18057/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18057/timeline", "performed_via_github_app": null, "state_reason": "completed"}