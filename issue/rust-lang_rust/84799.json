{"url": "https://api.github.com/repos/rust-lang/rust/issues/84799", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/84799/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/84799/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/84799/events", "html_url": "https://github.com/rust-lang/rust/issues/84799", "id": 873782889, "node_id": "MDU6SXNzdWU4NzM3ODI4ODk=", "number": 84799, "title": "`rust-lld` error: unrecognized relocation R_ARM_THM_JUMP8 when cross compiling to `armv7-unknown-linux-musleabihf`", "user": {"login": "FenrirWolf", "id": 8870156, "node_id": "MDQ6VXNlcjg4NzAxNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8870156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FenrirWolf", "html_url": "https://github.com/FenrirWolf", "followers_url": "https://api.github.com/users/FenrirWolf/followers", "following_url": "https://api.github.com/users/FenrirWolf/following{/other_user}", "gists_url": "https://api.github.com/users/FenrirWolf/gists{/gist_id}", "starred_url": "https://api.github.com/users/FenrirWolf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FenrirWolf/subscriptions", "organizations_url": "https://api.github.com/users/FenrirWolf/orgs", "repos_url": "https://api.github.com/users/FenrirWolf/repos", "events_url": "https://api.github.com/users/FenrirWolf/events{/privacy}", "received_events_url": "https://api.github.com/users/FenrirWolf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-01T22:27:58Z", "updated_at": "2021-05-08T09:35:16Z", "closed_at": "2021-05-08T02:31:43Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I came across the following linker error when attempting to cross compile a project I've written to `armv7-unknown-linux-musleabihf` using `rust-lld` as the linker: \r\n\r\n```code\r\nerror: linking with `rust-lld` failed: exit code: 1\r\n  |\r\n  = note: \"rust-lld\" \"-flavor\" \"gnu\" \"--eh-frame-hdr\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/self-contained/crt1.o\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/self-contained/crti.o\" \"-L\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib\" \"-L\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/self-contained\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.1aqk0zk7x33wg3te.rcgu.o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.21iev9tbyywa4wdq.rcgu.o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.3j026mmca56a4hdl.rcgu.o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.479ltfvo145wrboq.rcgu.o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.5cans4hl8f1ktblj.rcgu.o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.76vinithocvtutj.rcgu.o\" \"-o\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/bug_test-a8397c6bc9f42382.e4lwf0akt83fdpd.rcgu.o\" \"--gc-sections\" \"-static\" \"-zrelro\" \"-znow\" \"-L\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps\" \"-L\" \"/home/fenrir/projects/bug_test/target/debug/deps\" \"-L\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib\" \"-Bstatic\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/libnix-8c0b088db1d85e73.rlib\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/libbitflags-ab6b21585a7c4aae.rlib\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/libcfg_if-b8c1108adbcf097f.rlib\" \"/home/fenrir/projects/bug_test/target/armv7-unknown-linux-musleabihf/debug/deps/liblibc-b41903f03e2a28a3.rlib\" \"--start-group\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libstd-ca73fe18d2e5aa4e.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libpanic_unwind-5559d5e37af2cd9e.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libminiz_oxide-6565f5b3cbffaca3.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libadler-a1e57572255a8b43.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libobject-d0a7aeda2267c9b2.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libaddr2line-5b5edad74d06775d.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libgimli-da8179eaa82e04bf.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/librustc_demangle-f28ed599e945faf8.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libhashbrown-a1fd3f19fa46c07c.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/librustc_std_workspace_alloc-36b8c4988c19e85c.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libunwind-ee4e6bfe66d0ffbd.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libcfg_if-ef23edc6f6664625.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/liblibc-58a489ee8bf2231c.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/liballoc-32f395de90ebc9a4.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/librustc_std_workspace_core-aa6fbc6ca630c9a3.rlib\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libcore-d7963342be911627.rlib\" \"--end-group\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/libcompiler_builtins-9a86cd3022469a1c.rlib\" \"-Bdynamic\" \"/home/fenrir/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/armv7-unknown-linux-musleabihf/lib/self-contained/crtn.o\"\r\n  = note: rust-lld: error: src/thread/arm/syscall_cp.s:18:(.text+0xA): unrecognized relocation R_ARM_THM_JUMP8\r\n```\r\n\r\nIt seems to have something to do with `ioctl` calls generated by the `nix` crate, as I was able to reproduce the issue with just the following code:\r\n\r\nmain.rs:\r\n```rust\r\nuse nix::ioctl_read_buf;\r\n\r\n// values from `/usr/include/linux/joystick.h`\r\nconst JSIOCG_MAGIC: u8 = b'j';\r\nconst JSIOCGNAME: u8 = 0x13;\r\n\r\nioctl_read_buf!(get_controller_name, JSIOCG_MAGIC, JSIOCGNAME, u8);\r\n\r\nfn main() { }\r\n```\r\n\r\n.cargo/config:\r\n```toml\r\n[target.armv7-unknown-linux-musleabihf]\r\nlinker = \"rust-lld\"\r\n```\r\n\r\nbuild steps:\r\n```\r\ncargo build --target armv7-unknown-linux-musleabihf\r\n```\r\n\r\nMeanwhile using `armv7-unknown-linux-gnueabihf` as the target and linking with an installed `arm-linux-gnueabihf-gcc` toolchain results in a successful build.", "closed_by": {"login": "FenrirWolf", "id": 8870156, "node_id": "MDQ6VXNlcjg4NzAxNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8870156?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FenrirWolf", "html_url": "https://github.com/FenrirWolf", "followers_url": "https://api.github.com/users/FenrirWolf/followers", "following_url": "https://api.github.com/users/FenrirWolf/following{/other_user}", "gists_url": "https://api.github.com/users/FenrirWolf/gists{/gist_id}", "starred_url": "https://api.github.com/users/FenrirWolf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FenrirWolf/subscriptions", "organizations_url": "https://api.github.com/users/FenrirWolf/orgs", "repos_url": "https://api.github.com/users/FenrirWolf/repos", "events_url": "https://api.github.com/users/FenrirWolf/events{/privacy}", "received_events_url": "https://api.github.com/users/FenrirWolf/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/84799/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/84799/timeline", "performed_via_github_app": null, "state_reason": "completed"}