{"url": "https://api.github.com/repos/rust-lang/rust/issues/37417", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/37417/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/37417/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/37417/events", "html_url": "https://github.com/rust-lang/rust/issues/37417", "id": 185392719, "node_id": "MDU6SXNzdWUxODUzOTI3MTk=", "number": 37417, "title": "alloc::heap doc comments strange re old_size in [requested_size, usable_size]", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 129836139, "node_id": "MDU6TGFiZWwxMjk4MzYxMzk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-allocators", "name": "A-allocators", "color": "f7e101", "default": false, "description": "Area: Custom and system allocators"}, {"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-10-26T13:26:05Z", "updated_at": "2017-08-30T19:24:02Z", "closed_at": "2017-08-30T19:24:02Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "The `reallocate`, `reallocate_inplace`, and `deallocate` all have doc comments that end with the sentence: \n\n> The `old_size` parameter may be any value in range_inclusive(requested_size, usable_size).\n\nWhen reading the doc for `reallocate` and `reallocate_inplace`, I found this note confusing, because I interpreted the identifier `requested_size` as if it were referring to new size being requested by _this call_ to `reallocate* or`reallocate_inplace`.\n- The reason that this interpretation leads to confusion is that it means we are requiring `old_size` to be in the range `[size, usable_size]`, and then in practice that means one cannot feed in a value for `old_size` where `size > old_size`; but the case where `size > old_size` is _precisely_ the use case for calling `reallocate` or `reallocate_inplace` in the first place. \n\nAfter subsequently searching the file for other occurrences of \"requested_size\" (and later, \"requested size\"), I discovered the same text in the `fn deallocate` doc comment. In that context, it cannot possibly mean a size requested for the current call.\n\nThat is when I realized that the notion of \"requested_size\" must be referring to a value from the _history_ of the memory allocations.\n\nIn particular, it probably means either:\n1.  \"what was the size that was used for the _original_ allocation request that returned this block's address?\" (\"original\" meaning \"first with no intervening transfer of the block back to the allocation pool via `realloc` or `dealloc`), or\n2. \"what was the _minimum_ size that was used, over the original allocation request and all successful reallocation requests that have maintained this block's address?\"\n\nThe phrase \"requested size\" to me strongly implies the first of the two interpretations above, but I suspect the second interpretation is a strictly more useful one to adopt, (though it may be a bit niddly to get right...)\n", "closed_by": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/37417/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/37417/timeline", "performed_via_github_app": null, "state_reason": "completed"}