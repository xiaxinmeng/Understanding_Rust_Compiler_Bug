{"url": "https://api.github.com/repos/rust-lang/rust/issues/40125", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/40125/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/40125/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/40125/events", "html_url": "https://github.com/rust-lang/rust/issues/40125", "id": 210558584, "node_id": "MDU6SXNzdWUyMTA1NTg1ODQ=", "number": 40125, "title": "Illegal Instruction on Intel i5-3570S", "user": {"login": "chongyangshi", "id": 8771937, "node_id": "MDQ6VXNlcjg3NzE5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/8771937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chongyangshi", "html_url": "https://github.com/chongyangshi", "followers_url": "https://api.github.com/users/chongyangshi/followers", "following_url": "https://api.github.com/users/chongyangshi/following{/other_user}", "gists_url": "https://api.github.com/users/chongyangshi/gists{/gist_id}", "starred_url": "https://api.github.com/users/chongyangshi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chongyangshi/subscriptions", "organizations_url": "https://api.github.com/users/chongyangshi/orgs", "repos_url": "https://api.github.com/users/chongyangshi/repos", "events_url": "https://api.github.com/users/chongyangshi/events{/privacy}", "received_events_url": "https://api.github.com/users/chongyangshi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2017-02-27T17:54:33Z", "updated_at": "2017-02-27T21:12:04Z", "closed_at": "2017-02-27T21:12:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi all,\r\n\r\nI discovered this issue while working with a Python library that uses a rust binary, and I don't really speak rust at all. The original issue filed with the Python library can be found [here](https://github.com/urschrei/convertbng/issues/2). \r\n\r\nThe Python library in question takes in an [OSGB36](https://en.wikipedia.org/wiki/Ordnance_Survey_National_Grid) coordinate pair, calls a rust binary to performs conversion to a [WGS84](https://en.wikipedia.org/wiki/World_Geodetic_System) coordinate pair, and returns the result via the Python interface. The problem seems to have happened at the rust binary used by the library, whose source code can be found at [here](https://github.com/urschrei/lonlat_bng). \r\n\r\nThe Python code reproducing the issue is as followed:\r\n\r\n    from convertbng.util import convert_lonlat, convert_bng\r\n    from numpy import isnan\r\n\r\n    def bng_to_longlat(bng):\r\n        \"\"\" Given a pair of BNG coordinates return its long and lat coordinates. \"\"\"\r\n        \r\n        try:\r\n            easting = [int(bng[0])]\r\n            northing = [int(bng[1])]\r\n            coordinates = convert_lonlat(easting, northing)\r\n            coordinate_long = coordinates[0][0]\r\n            coordinate_lat = coordinates[1][0]\r\n\r\n            if isnan(coordinate_long) or isnan(coordinate_lat):\r\n                return False\r\n    \r\n            return (coordinate_long, coordinate_lat)\r\n            \r\n        except ValueError:\r\n            return False\r\n\r\n    print bng_to_longlat((315877,781709))\r\n    print convert_bng([-7.30034511], [49.95888852]) \r\n\r\nWhen executed on my Intel i5-3570S system, the Python interpreter will return the followed message:\r\n    \r\n    Illegal instruction (core dumped)\r\n\r\nWhich is also logged by the kernel in `/var/log/syslog`:\r\n\r\n    Feb 27 18:28:37 {hostname} kernel: [252228.554877] traps: python[25185] trap invalid opcode ip:7f5dfad3b8f2 sp:7ffd3af2d588 error:0 in liblonlat_bng-783571af.so[7f5dfacd2000+1d2a000]\r\n\r\nThis issue happened on a very specific CPU:\r\nOS: Ubuntu 16.04.2 LTS 64bit\r\nCPU: Intel i5-3570S\r\nKernel: Linux 4.4.0-64-generic #85-Ubuntu\r\n\r\nWith both Ubuntu 16.04 LTS and 14.04 LTS, on a range of CPUs including i7-6600, E3-1225v2, a QEMU virtual CPU on a KVM VPS (underlying hardware unknown) and i5-4210U, this error cannot be reproduced. Therefore it seems to be limited to Intel i5-3570S and maybe a few other processors.\r\n\r\nWe also tried to build `lonlat_bng` on various platforms. The tests did fail on i7-6600 Ubuntu 16.04 and i5-4210U Arch, but the Python script could execute the rust binary provided by `convertbng` correctly on these two platforms:\r\n\r\n\r\n    ---- conversions::tests::test_convert_osgb36_to_ll stdout ----\r\n\t    thread 'conversions::tests::test_convert_osgb36_to_ll' panicked at 'called `Result::unwrap()` on an `Err` value: ()', /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/src/libcore/result.rs:837\r\n\r\nMany thanks.\r\n    ", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/40125/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/40125/timeline", "performed_via_github_app": null, "state_reason": "completed"}