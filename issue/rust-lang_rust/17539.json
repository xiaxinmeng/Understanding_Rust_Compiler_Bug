{"url": "https://api.github.com/repos/rust-lang/rust/issues/17539", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/17539/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/17539/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/17539/events", "html_url": "https://github.com/rust-lang/rust/issues/17539", "id": 43970420, "node_id": "MDU6SXNzdWU0Mzk3MDQyMA==", "number": 17539, "title": "\"error: illegal recursive type; insert an enum or struct in the cycle, if this is desired\" not very helpful", "user": {"login": "imbaczek", "id": 1359, "node_id": "MDQ6VXNlcjEzNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/imbaczek", "html_url": "https://github.com/imbaczek", "followers_url": "https://api.github.com/users/imbaczek/followers", "following_url": "https://api.github.com/users/imbaczek/following{/other_user}", "gists_url": "https://api.github.com/users/imbaczek/gists{/gist_id}", "starred_url": "https://api.github.com/users/imbaczek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/imbaczek/subscriptions", "organizations_url": "https://api.github.com/users/imbaczek/orgs", "repos_url": "https://api.github.com/users/imbaczek/repos", "events_url": "https://api.github.com/users/imbaczek/events{/privacy}", "received_events_url": "https://api.github.com/users/imbaczek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2014-09-25T21:30:39Z", "updated_at": "2021-09-01T06:13:12Z", "closed_at": "2021-09-01T06:13:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've tried to write code that would work like this:\n\n``` rust\nlet mut f = some_fn;  // many other some_fns also exist\n\nloop {\n    f = f()\n}\n```\n\nTo make coding some_fn and its friends easier, I wanted to create a type:\n\n``` rust\ntype SomeFn = fn() -> SomeFn;\n```\n\nUnfortunately, this results in some type-theoretic error message that isn't really understandable by mere mortals:\n\n```\n<anon>:1:15: 1:29 error: illegal recursive type; insert an enum or struct in the cycle, if this is desired\n<anon>:1 type SomeFn = fn() -> SomeFn;\n                       ^~~~~~~~~~~~~~\n```\n\nIt's not at all clear what 'the cycle' is and where to insert an enum or struct. Turns out that if you know what the compiler is talking about, the fix is simple:\n\n``` rust\nstruct SomeFn(fn() -> SomeFn);\n\n// ergonomy suffers\nfn fn1() -> SomeFn { println!(\"1\"); SomeFn(fn2) }\nfn fn2() -> SomeFn { println!(\"2\"); SomeFn(fn1) }\n\nfn main() {\n    let mut f = SomeFn(fn1);\n    f = { let SomeFn(ff) = f; ff() };\n    f = { let SomeFn(ff) = f; ff() };\n}\n```\n\nOutput:\n\n```\n1\n2\n```\n\nBut I was very confused by the message and tried a contraption like this instead:\n\n``` rust\ntype SomeFn = fn() -> Option<SomeFn>;\n```\n\nA hint in the error message that points the programmer to the right direction would be very helpful. Ergonomy of the solution is also questionable, but at least it compiles.\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"camelid\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/17539/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/17539/timeline", "performed_via_github_app": null, "state_reason": "completed"}