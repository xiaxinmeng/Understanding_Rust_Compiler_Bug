{"url": "https://api.github.com/repos/rust-lang/rust/issues/27463", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/27463/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/27463/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/27463/events", "html_url": "https://github.com/rust-lang/rust/issues/27463", "id": 98581532, "node_id": "MDU6SXNzdWU5ODU4MTUzMg==", "number": 27463, "title": "io::Take's BufRead::fill_buf always attempts to fill the inner buffer", "user": {"login": "talchas", "id": 3578697, "node_id": "MDQ6VXNlcjM1Nzg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/3578697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/talchas", "html_url": "https://github.com/talchas", "followers_url": "https://api.github.com/users/talchas/followers", "following_url": "https://api.github.com/users/talchas/following{/other_user}", "gists_url": "https://api.github.com/users/talchas/gists{/gist_id}", "starred_url": "https://api.github.com/users/talchas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/talchas/subscriptions", "organizations_url": "https://api.github.com/users/talchas/orgs", "repos_url": "https://api.github.com/users/talchas/repos", "events_url": "https://api.github.com/users/talchas/events{/privacy}", "received_events_url": "https://api.github.com/users/talchas/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-08-02T03:35:12Z", "updated_at": "2015-08-04T00:16:02Z", "closed_at": "2015-08-03T17:13:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Even if self.limit is 0, fill_buf will attempt to read from the underlying BufRead, possibly causing additional blocking read(2) calls from split/read_until/etc:\n\n```\nuse std::os::unix::io::FromRawFd;\nuse std::fs::File;\nuse std::io::BufReader;\nuse std::io::BufRead;\nuse std::io::Write;\nuse std::io::Read;\n\nextern \"C\" {\n    pub fn pipe(fds: *mut i32) -> i32;\n}\n\nfn main() {\n    let (reader, mut writer) = unsafe { \n        let mut pipes = [0, 0];\n        assert_eq!(pipe(pipes.as_mut_ptr()), 0); \n        (File::from_raw_fd(pipes[0]), File::from_raw_fd(pipes[1]))\n    };\n    writer.write(&[1, 0]);\n    writer.flush();\n    let reader = BufReader::new(reader);\n    println!(\"{:?}\", reader.take(2).split(0).collect::<Result<Vec<_>, _>>());\n}\n```\n\nWill block forever, while writing an additional byte that should never need to be read will succeed. (Similarly no writing and take(0) also fails when it should not).\n\nAn early check for self.limit == 0 in Take's fill_buf, like its read() implementation, should fix this.\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/27463/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/27463/timeline", "performed_via_github_app": null, "state_reason": "completed"}