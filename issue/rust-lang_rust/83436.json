{"url": "https://api.github.com/repos/rust-lang/rust/issues/83436", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83436/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83436/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83436/events", "html_url": "https://github.com/rust-lang/rust/issues/83436", "id": 839354812, "node_id": "MDU6SXNzdWU4MzkzNTQ4MTI=", "number": 83436, "title": "rustc hides linker warnings", "user": {"login": "ahl", "id": 677483, "node_id": "MDQ6VXNlcjY3NzQ4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/677483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ahl", "html_url": "https://github.com/ahl", "followers_url": "https://api.github.com/users/ahl/followers", "following_url": "https://api.github.com/users/ahl/following{/other_user}", "gists_url": "https://api.github.com/users/ahl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ahl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ahl/subscriptions", "organizations_url": "https://api.github.com/users/ahl/orgs", "repos_url": "https://api.github.com/users/ahl/repos", "events_url": "https://api.github.com/users/ahl/events{/privacy}", "received_events_url": "https://api.github.com/users/ahl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 37547, "node_id": "MDU6TGFiZWwzNzU0Nw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-linkage", "name": "A-linkage", "color": "f7e101", "default": false, "description": "Area: linking into static, shared libraries and binaries"}, {"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2021-03-24T04:58:21Z", "updated_at": "2021-03-24T13:54:03Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I encountered an issue with the [linkme](https://github.com/dtolnay/linkme) crate on illumos (OpenSolaris/OmniOS/Helios) demonstrated with [this repo](https://github.com/ahl/linkme-test). Of note, the build executes without error or warning, but in fact the linker is emitting an error:\r\n\r\n```\r\n$ cargo run\r\n   Compiling cmd v0.1.0 (/home/ahl/linkme-test/cmd)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.28s\r\n     Running `target/debug/cmd`\r\n$ cargo rustc\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.01s\r\n```\r\n\r\nI can make the linker fail on warnings:\r\n\r\n```\r\n$ cargo rustc -- -C link-arg=-Wl,-zfatal-warnings\r\n   Compiling cmd v0.1.0 (/home/ahl/linkme-test/cmd)\r\nerror: linking with `gcc` failed: exit code: 1\r\n  |\r\n  = note: \"gcc\" \"-m64\" \"-std=c99\" \"-L\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.1m65hci6o5zni2mr.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.1r2sofzghiioxykg.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.2i3xjlynwxgqlmzu.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.3hvsf4zj59kihrhf.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.3lsh1pzemq0xblzm.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.3zpatajw7m7uqqns.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.4yxic0y84aboqmeb.rcgu.o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.a1lfmxsp6lqzsbn.rcgu.o\" \"-o\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69\" \"/home/ahl/linkme-test/cmd/target/debug/deps/cmd-26e8351dc3f3fb69.3n70o9wfzqm9tbsh.rcgu.o\" \"-Wl,-zignore\" \"-nodefaultlibs\" \"-L\" \"/home/ahl/linkme-test/cmd/target/debug/deps\" \"-L\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib\" \"-Wl,-Bstatic\" \"/home/ahl/linkme-test/cmd/target/debug/deps/liblib-3d689bd64c3873d5.rlib\" \"/home/ahl/linkme-test/cmd/target/debug/deps/liblinkme-21c998585e123796.rlib\" \"-Wl,--start-group\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libstd-cd23cc7e75a2851c.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libpanic_unwind-566bad254d0594e5.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libminiz_oxide-96e54319d1590148.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libadler-4dbe2335326bb316.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libobject-b0fd875741b20fc0.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libaddr2line-089ce7b4c263282a.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libgimli-ca92a564b7883a12.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/librustc_demangle-ce8ee413f3ea18b6.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libhashbrown-17e15682bef35ec2.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/librustc_std_workspace_alloc-2dc950a425ee77d8.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libunwind-50867a64287c1bd2.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libcfg_if-129bada4e936c5a0.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/liblibc-a98e4fa0f203a39a.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/liballoc-35c480f88f8f320a.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/librustc_std_workspace_core-86dc76527c7e216a.rlib\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libcore-093275d7382c1a2f.rlib\" \"-Wl,--end-group\" \"/opt/ooce/rust/lib/rustlib/x86_64-unknown-illumos/lib/libcompiler_builtins-358913705748e96c.rlib\" \"-Wl,-Bdynamic\" \"-lsocket\" \"-lposix4\" \"-lpthread\" \"-lresolv\" \"-lnsl\" \"-lumem\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-Wl,-zfatal-warnings\" \"-lssp\"\r\n  = note: ld: warning: reserved symbol '__start_set_linkme_DOERS' already defined in file /home/ahl/linkme-test/cmd/target/debug/deps/liblib-3d689bd64c3873d5.rlib(lib-3d689bd64c3873d5.2vwi8dtk7ky9hvmq.rcgu.o)\r\n          ld: warning: reserved symbol '__stop_set_linkme_DOERS' already defined in file /home/ahl/linkme-test/cmd/target/debug/deps/liblib-3d689bd64c3873d5.rlib(lib-3d689bd64c3873d5.2vwi8dtk7ky9hvmq.rcgu.o)\r\n          collect2: error: ld returned 1 exit status\r\n          \r\n\r\nerror: aborting due to previous error\r\n\r\nerror: could not compile `cmd`.\r\n\r\nTo learn more, run the command again with --verbose.\r\n```\r\n\r\nThese linker warnings need not have been fatal, but I think it would be reasonable for `cargo build` / `cargo run` / `cargo rustc` to display these warnings. In this case those warnings would have helped determine the underlying issues much earlier. Indeed, it seems rare that linker warnings would truly be specious.\r\n\r\n### Meta\r\n<!--\r\nIf you're using the stable version of the compiler, you should also check if the\r\nbug also exists in the beta or nightly versions.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\n$ rustc --version --verbose\r\nrustc 1.47.0\r\nbinary: rustc\r\ncommit-hash: unknown\r\ncommit-date: unknown\r\nhost: x86_64-unknown-illumos\r\nrelease: 1.47.0\r\nLLVM version: 11.0\r\n```\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83436/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83436/timeline", "performed_via_github_app": null, "state_reason": null}