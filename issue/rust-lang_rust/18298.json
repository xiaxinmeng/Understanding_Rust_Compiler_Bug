{"url": "https://api.github.com/repos/rust-lang/rust/issues/18298", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/18298/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/18298/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/18298/events", "html_url": "https://github.com/rust-lang/rust/issues/18298", "id": 46793846, "node_id": "MDU6SXNzdWU0Njc5Mzg0Ng==", "number": 18298, "title": "ICE: OutputTypeParameterMismatch with unboxed closures", "user": {"login": "veddan", "id": 307180, "node_id": "MDQ6VXNlcjMwNzE4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/307180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/veddan", "html_url": "https://github.com/veddan", "followers_url": "https://api.github.com/users/veddan/followers", "following_url": "https://api.github.com/users/veddan/following{/other_user}", "gists_url": "https://api.github.com/users/veddan/gists{/gist_id}", "starred_url": "https://api.github.com/users/veddan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/veddan/subscriptions", "organizations_url": "https://api.github.com/users/veddan/orgs", "repos_url": "https://api.github.com/users/veddan/repos", "events_url": "https://api.github.com/users/veddan/events{/privacy}", "received_events_url": "https://api.github.com/users/veddan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2014-10-24T23:29:39Z", "updated_at": "2014-10-28T22:25:57Z", "closed_at": "2014-10-28T22:25:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Compiling\n\n```\n#![feature(overloaded_calls)]\n#![feature(unboxed_closures)]\n\nfn main() {\n    foo(1i);\n}\n\nfn foo<T>(a: T) {\n    baz(a, &|&: _a: &T| { });\n}\n\nfn baz<'a, T: 'a, F: Fn<(&'a T,), ()>>(a: T, f: &F) {\n    unsafe { f(::std::mem::transmute(&a)) }\n}\n```\n\nwith `RUST_BACKTRACE=1 rustc bug.rs -Z verbose` gives\n\n```\nbug.rs:13:14: 13:42 error: internal compiler error: Encountered error `OutputTypeParameterMismatch(<closure as core::ops::Fn<(&ReInfer(0) T),(),self closure>>, expected int, found type parameter)` selecting `<closure as core::ops::Fn<(&ReStatic int),(),self closure>>` during trans\nbug.rs:13        unsafe { f(::std::mem::transmute(&a)) }\n                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\ntask 'rustc' failed at 'Box<Any>', /.../rust/src/libsyntax/diagnostic.rs:116\n\n    stack backtrace:\n1:     0x7fdee60a9500 - rt::backtrace::imp::write::hf55f54de54e145feOcq\n2:     0x7fdee60ac690 - failure::on_fail::h6f167845e58b4b31byq\n3:     0x7fdeea3a24c0 - unwind::begin_unwind_inner::ha847232dcda349e1MQd\n4:     0x7fdee7464570 - unwind::begin_unwind::h17474698627741534983\n5:     0x7fdee74644f0 - diagnostic::SpanHandler::span_bug::h1beed783f0a3d283OOF\n6:     0x7fdeeae03d70 - middle::trans::common::fulfill_obligation::h276f3c9978aa90bdsG8\n7:     0x7fdeeadb0080 - middle::trans::meth::trans_method_callee::h0d34e3dc7265a24bcom\n8:     0x7fdeeadb0000 - middle::trans::controlflow::trans_for::closure.121899\n9:     0x7fdeeb38a4d0 - middle::trans::expr::trans_overloaded_call::closure.122745\n10:     0x7fdeeadae4b0 - middle::trans::callee::trans_call_inner::h70a281432d522e0fXT3\n11:     0x7fdeeade3010 - middle::trans::expr::trans_rvalue_dps_unadjusted::h59c778149c635662A25\n12:     0x7fdeeada6690 - middle::trans::expr::trans_into::hda9c6f85ba21846a8D4\n13:     0x7fdeeada6ab0 - middle::trans::controlflow::trans_block::h4dba6b12c8bf9ae0oU0\n14:     0x7fdeeae4dca0 - middle::trans::base::trans_closure::h735659f6c6f975ccp0g\n15:     0x7fdeead99000 - middle::trans::base::trans_fn::hf443f010df6ff76fNbh\n16:     0x7fdeead996f0 - middle::trans::monomorphize::monomorphic_fn::h2f32af73a63c19f7Ok0\n17:     0x7fdeeadcdca0 - middle::trans::callee::trans_fn_ref_with_substs::h89c4b3518b4bcfd7dy3\n18:     0x7fdeeadcbe40 - middle::trans::callee::trans_fn_ref::h9bc019d9fbcc1ca43l3\n19:     0x7fdeeadd4130 - middle::trans::callee::trans_call::closure.122326\n20:     0x7fdeeadae4b0 - middle::trans::callee::trans_call_inner::h70a281432d522e0fXT3\n21:     0x7fdeeadd3e80 - middle::trans::callee::trans_call::ha8e12ba9337696e7hO3\n22:     0x7fdeeade3010 - middle::trans::expr::trans_rvalue_dps_unadjusted::h59c778149c635662A25\n23:     0x7fdeeada6690 - middle::trans::expr::trans_into::hda9c6f85ba21846a8D4\n24:     0x7fdeeada5a80 - middle::trans::controlflow::trans_stmt_semi::h8c4df4e6755d6084vT0\n25:     0x7fdeeada5030 - middle::trans::controlflow::trans_stmt::h21d1608d40f72cd9iP0\n26:     0x7fdeeada6ab0 - middle::trans::controlflow::trans_block::h4dba6b12c8bf9ae0oU0\n27:     0x7fdeeae4dca0 - middle::trans::base::trans_closure::h735659f6c6f975ccp0g\n28:     0x7fdeead99000 - middle::trans::base::trans_fn::hf443f010df6ff76fNbh\n29:     0x7fdeead996f0 - middle::trans::monomorphize::monomorphic_fn::h2f32af73a63c19f7Ok0\n30:     0x7fdeeadcdca0 - middle::trans::callee::trans_fn_ref_with_substs::h89c4b3518b4bcfd7dy3\n31:     0x7fdeeadcbe40 - middle::trans::callee::trans_fn_ref::h9bc019d9fbcc1ca43l3\n32:     0x7fdeeadd4130 - middle::trans::callee::trans_call::closure.122326\n33:     0x7fdeeadae4b0 - middle::trans::callee::trans_call_inner::h70a281432d522e0fXT3\n34:     0x7fdeeadd3e80 - middle::trans::callee::trans_call::ha8e12ba9337696e7hO3\n35:     0x7fdeeade3010 - middle::trans::expr::trans_rvalue_dps_unadjusted::h59c778149c635662A25\n36:     0x7fdeeada6690 - middle::trans::expr::trans_into::hda9c6f85ba21846a8D4\n37:     0x7fdeeada5a80 - middle::trans::controlflow::trans_stmt_semi::h8c4df4e6755d6084vT0\n38:     0x7fdeeada5030 - middle::trans::controlflow::trans_stmt::h21d1608d40f72cd9iP0\n39:     0x7fdeeada6ab0 - middle::trans::controlflow::trans_block::h4dba6b12c8bf9ae0oU0\n40:     0x7fdeeade3010 - middle::trans::expr::trans_rvalue_dps_unadjusted::h59c778149c635662A25\n41:     0x7fdeeada6690 - middle::trans::expr::trans_into::hda9c6f85ba21846a8D4\n42:     0x7fdeeada6ab0 - middle::trans::controlflow::trans_block::h4dba6b12c8bf9ae0oU0\n43:     0x7fdeeae4dca0 - middle::trans::base::trans_closure::h735659f6c6f975ccp0g\n44:     0x7fdeead99000 - middle::trans::base::trans_fn::hf443f010df6ff76fNbh\n45:     0x7fdeead96650 - middle::trans::base::trans_item::he22491066ac9a2096uh\n46:     0x7fdeeae58a10 - middle::trans::base::trans_crate::h98401cdcfefa4f8bXsi\n47:     0x7fdeeb2a85b0 - driver::driver::phase_4_translate_to_llvm::h1747de07c7c65440yuA\n48:     0x7fdeeb29f990 - driver::driver::compile_input::hd1134e5c5c5b138es1z\n49:     0x7fdeeb329170 - driver::run_compiler::hc6267138c7b52e1cDOD\n50:     0x7fdeeb329020 - driver::run::closure.144862\n51:     0x7fdeeaa2bd30 - task::TaskBuilder<S>::try_future::closure.103257\n52:     0x7fdeeaa2bb10 - task::TaskBuilder<S>::spawn_internal::closure.103228\n53:     0x7fdeea6f1990 - task::NativeSpawner.Spawner::spawn::closure.8447\n54:     0x7fdeea3fc770 - rust_try_inner\n55:     0x7fdeea3fc760 - rust_try\n56:     0x7fdeea39fa40 - unwind::try::h994238c297aa05e0uFd\n57:     0x7fdeea39f8c0 - task::Task::run::hde6c0e3dcf5eb653kLc\n58:     0x7fdeea6f1690 - task::NativeSpawner.Spawner::spawn::closure.8385\n59:     0x7fdeea3a1320 - thread::thread_start::h693f7af46f13be17z6c\n60:     0x7fdee5452010 - start_thread\n61:     0x7fdeea06a559 - __clone\n62:                0x0 - <unknown>\n```\n", "closed_by": {"login": "veddan", "id": 307180, "node_id": "MDQ6VXNlcjMwNzE4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/307180?v=4", "gravatar_id": "", "url": "https://api.github.com/users/veddan", "html_url": "https://github.com/veddan", "followers_url": "https://api.github.com/users/veddan/followers", "following_url": "https://api.github.com/users/veddan/following{/other_user}", "gists_url": "https://api.github.com/users/veddan/gists{/gist_id}", "starred_url": "https://api.github.com/users/veddan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/veddan/subscriptions", "organizations_url": "https://api.github.com/users/veddan/orgs", "repos_url": "https://api.github.com/users/veddan/repos", "events_url": "https://api.github.com/users/veddan/events{/privacy}", "received_events_url": "https://api.github.com/users/veddan/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/18298/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/18298/timeline", "performed_via_github_app": null, "state_reason": "completed"}