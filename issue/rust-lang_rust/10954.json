{"url": "https://api.github.com/repos/rust-lang/rust/issues/10954", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/10954/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/10954/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/10954/events", "html_url": "https://github.com/rust-lang/rust/issues/10954", "id": 24268057, "node_id": "MDU6SXNzdWUyNDI2ODA1Nw==", "number": 10954, "title": "internal compiler error: type_of with ty_param", "user": {"login": "bstrie", "id": 865233, "node_id": "MDQ6VXNlcjg2NTIzMw==", "avatar_url": "https://avatars.githubusercontent.com/u/865233?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bstrie", "html_url": "https://github.com/bstrie", "followers_url": "https://api.github.com/users/bstrie/followers", "following_url": "https://api.github.com/users/bstrie/following{/other_user}", "gists_url": "https://api.github.com/users/bstrie/gists{/gist_id}", "starred_url": "https://api.github.com/users/bstrie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bstrie/subscriptions", "organizations_url": "https://api.github.com/users/bstrie/orgs", "repos_url": "https://api.github.com/users/bstrie/repos", "events_url": "https://api.github.com/users/bstrie/events{/privacy}", "received_events_url": "https://api.github.com/users/bstrie/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-12-13T19:45:07Z", "updated_at": "2014-03-03T00:06:23Z", "closed_at": "2014-03-03T00:06:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "There was an old closed bug with this title, I've opened a new issue rather than reopening that one.\n\nCompiling this file exhibits the bug (received from IRC, not minimized yet):\n\n``` rust\n#[allow(dead_code, unused_variable)];\n\nuse std::libc::{c_void, c_char};\nuse std::c_str::{CString};\nuse std::cast::{transmute};\nuse std::ptr::{null};\n\nstruct _DBusCon;\nstruct _DBusMsg;\n\n#[repr(C)]\nenum DBusHandlerResult {\n    DBusHandlerResultHandled,\n    DBusHandlerResultNotYetHandled,\n    DBusHandlerResultNeedMemory,\n}\n\nstruct _DBusObjectPathVTable<T> {\n    unreg_func: extern \"C\" fn(con: *_DBusCon, data: *_data<T>),\n    msg_func: extern \"C\" fn(con: *_DBusCon, mes: *_DBusMsg, data: *_data<T>) -> DBusHandlerResult,\n    dbus_internal_pad1: *c_void,\n    dbus_internal_pad2: *c_void,\n    dbus_internal_pad3: *c_void,\n    dbus_internal_pad4: *c_void,\n    dbus_internal_pad5: *c_void,\n}\n\nstruct DBusCon {\n    priv raw: *_DBusCon,\n}\n\nimpl DBusCon {\n    fn reg_obj_path<T>(&self, path: &str, msg_func: |DBusMsg,&T| -> DBusHandlerResult, unreg_func: |&T|, data: ~T) {\n        unsafe {\n            let vtable: ~_DBusObjectPathVTable<T> = ~_DBusObjectPathVTable {\n                unreg_func: _unreg_func,\n                msg_func: _msg_func,\n                dbus_internal_pad1: null(),\n                dbus_internal_pad2: null(),\n                dbus_internal_pad3: null(),\n                dbus_internal_pad4: null(),\n                dbus_internal_pad5: null(),\n            };\n            let _path = path.to_c_str().unwrap();\n            let _vtable: *_DBusObjectPathVTable<T> = transmute(vtable);\n            let _data = ~_data {\n                msg_func: msg_func,\n                unreg_func: unreg_func,\n                path: _path,\n                data: data,\n                vtable: _vtable,\n            };\n            let __data: *_data<T> = transmute(_data);\n        }\n    }\n}\n\nextern \"C\" fn _msg_func<T>(con: *_DBusCon, _msg: *_DBusMsg, data: *_data<T>) -> DBusHandlerResult {\n    unsafe {\n        let msg = DBusMsg::new(_msg);\n        ((*data).msg_func)(msg, (*data).data)\n    }\n}\nextern \"C\" fn _unreg_func<T>(con: *_DBusCon, data: *_data<T>) {\n    unsafe {\n        ((*data).unreg_func)((*data).data);\n        CString::new((*data).path, true);\n        let d: ~_data<T>  = transmute(data);\n        let v: ~_DBusObjectPathVTable<T> = transmute(d.vtable);\n    }\n}\n\nstruct _data<'a, T> {\n    msg_func: 'a |DBusMsg,&T| -> DBusHandlerResult,\n    unreg_func: 'a |&'a T|,\n    path: *c_char,\n    data: ~T,\n    vtable: *_DBusObjectPathVTable<T>,\n}\n\nstruct DBusMsg {\n    priv raw: *_DBusMsg,\n}\n\nimpl DBusMsg {\n    fn new(raw: *_DBusMsg) -> DBusMsg {\n        DBusMsg { raw: raw }\n    }\n}\n\nfn main() {}\n```\n\nCompiler output:\n\n```\nerror: internal compiler error: type_of with ty_param\nThis message reflects a bug in the Rust compiler.\nWe would appreciate a bug report: https://github.com/mozilla/rust/wiki/HOWTO-submit-a-Rust-bug-report\ntask 'rustc' failed at 'explicit failure', /root/catacombs/scrap/rust/src/libsyntax/diagnostic.rs:102\ntask '<main>' failed at 'explicit failure', /root/catacombs/scrap/rust/src/librustc/lib.rs:393\n```\n", "closed_by": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/10954/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/10954/timeline", "performed_via_github_app": null, "state_reason": "completed"}