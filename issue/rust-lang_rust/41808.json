{"url": "https://api.github.com/repos/rust-lang/rust/issues/41808", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/41808/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/41808/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/41808/events", "html_url": "https://github.com/rust-lang/rust/issues/41808", "id": 226846119, "node_id": "MDU6SXNzdWUyMjY4NDYxMTk=", "number": 41808, "title": "Broken MIR, bad field access when matching constants", "user": {"login": "cpichard", "id": 300243, "node_id": "MDQ6VXNlcjMwMDI0Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/300243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cpichard", "html_url": "https://github.com/cpichard", "followers_url": "https://api.github.com/users/cpichard/followers", "following_url": "https://api.github.com/users/cpichard/following{/other_user}", "gists_url": "https://api.github.com/users/cpichard/gists{/gist_id}", "starred_url": "https://api.github.com/users/cpichard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cpichard/subscriptions", "organizations_url": "https://api.github.com/users/cpichard/orgs", "repos_url": "https://api.github.com/users/cpichard/repos", "events_url": "https://api.github.com/users/cpichard/events{/privacy}", "received_events_url": "https://api.github.com/users/cpichard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 9618520, "node_id": "MDU6TGFiZWw5NjE4NTIw", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-ICE", "name": "I-ICE", "color": "e10c02", "default": false, "description": "Issue: The compiler panicked, giving an Internal Compilation Error (ICE) \u2744\ufe0f"}, {"id": 256133398, "node_id": "MDU6TGFiZWwyNTYxMzMzOTg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-mir", "name": "A-mir", "color": "f7e101", "default": false, "description": "Area: Mid-level IR (MIR) - https://blog.rust-lang.org/2016/04/19/MIR.html"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-05-07T10:12:35Z", "updated_at": "2017-05-15T09:36:57Z", "closed_at": "2017-05-15T09:36:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nI tried to match constant strings inside a struct and wasn't able to compile the following code:\r\n```\r\nuse std::ffi::*;\r\n\r\n#[derive(PartialEq, Eq)]\r\npub struct MyStruct<'a>(&'a [u8]);\r\n\r\npub const CONSTANT: MyStruct<'static> =\r\n    MyStruct(b\"ConstantString\\0\");\r\n\r\nfn main() {\r\n    let cstr = CString::new(\"ConstantString\").unwrap();\r\n    match MyStruct(cstr.to_bytes_with_nul()) {\r\n        CONSTANT => println!(\"compilation error here\"),\r\n        _ => println!(\"not found\"),\r\n    }\r\n}\r\n```\r\nThe compiler returns an internal compilation error.\r\n\r\nI managed to compile using:\r\n`ref v @ MyStruct(_) if *v == CONSTANT => println!(\"it compiles\"),`\r\n\r\nThe first version, matching directly the CONSTANT would be easier to read and understand.\r\n\r\n## META\r\nrustc 1.17.0 (56124baa9 2017-04-24)\r\nbinary: rustc\r\ncommit-hash: 56124baa9e73f28c0709e59e74783cf234a978cf\r\ncommit-date: 2017-04-24\r\nhost: x86_64-apple-darwin\r\nrelease: 1.17.0\r\nLLVM version: 3.9\r\n\r\n\r\nThanks !", "closed_by": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/41808/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/41808/timeline", "performed_via_github_app": null, "state_reason": "completed"}