{"url": "https://api.github.com/repos/rust-lang/rust/issues/9003", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/9003/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/9003/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/9003/events", "html_url": "https://github.com/rust-lang/rust/issues/9003", "id": 19080229, "node_id": "MDU6SXNzdWUxOTA4MDIyOQ==", "number": 9003, "title": "Clarify the rustpkg testing story", "user": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2013-09-05T23:10:54Z", "updated_at": "2014-06-16T21:56:38Z", "closed_at": "2014-02-04T13:53:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On IRC, @bjz and @Kimundi pointed out some infelicities with how rustpkg handles the test crate.\n\nkimundi writes: \"I think there are 3 ways to have the test suite of a rustpkg package work: in-crate by compiling the crate with rustc --test, out-of-crate by having a test.rs file that 'extern mod's the crate, and hybrid where you have a test.rs file that contains all modules of your crate with 'mod ...;' statements, effectively providing an alternate test crate-root.\"\n\nCurrently, rustpkg is designed to give preference to the last option: having a `test.rs` file that is an alternative crate root for building a test executable.\n\nSo one question is whether to support all 3 ways with equally good ergonomics in rustpkg. The other question is whether to choose one way that we prefer, and document that that is the preferred method.\n\nkimundi pointing out that the pros and cons of each approach are:\n\n\"in-crate: pro: quick and easy, can test private things. cons: clutters the code, change to tests mean recompile the library itself\n\nout-of-crate: pro: can test the public api extensivly, no cluttering the crate code itself, changes to testsuite do not cause the  crate to need recompiling. cons: can't test private items, need to do more work to test the public api\n\nhybrid: pro: can test private api, separate test crate from regular crate, can test public api separately without needing to recompile crate. cons: needs to compile the same amount of code as the crate, needs to duplicate crate root.\"\n", "closed_by": {"login": "sfackler", "id": 1455697, "node_id": "MDQ6VXNlcjE0NTU2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1455697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfackler", "html_url": "https://github.com/sfackler", "followers_url": "https://api.github.com/users/sfackler/followers", "following_url": "https://api.github.com/users/sfackler/following{/other_user}", "gists_url": "https://api.github.com/users/sfackler/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfackler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfackler/subscriptions", "organizations_url": "https://api.github.com/users/sfackler/orgs", "repos_url": "https://api.github.com/users/sfackler/repos", "events_url": "https://api.github.com/users/sfackler/events{/privacy}", "received_events_url": "https://api.github.com/users/sfackler/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/9003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/9003/timeline", "performed_via_github_app": null, "state_reason": "completed"}