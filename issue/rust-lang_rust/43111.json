{"url": "https://api.github.com/repos/rust-lang/rust/issues/43111", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/43111/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/43111/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/43111/events", "html_url": "https://github.com/rust-lang/rust/issues/43111", "id": 241319020, "node_id": "MDU6SXNzdWUyNDEzMTkwMjA=", "number": 43111, "title": "Doctest cannot find reexported proc-macro crate when --target is given", "user": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-07-07T16:45:05Z", "updated_at": "2017-07-07T16:45:29Z", "closed_at": "2017-07-07T16:45:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "### Repro step:\r\n\r\nExecute these in the shell:\r\n\r\n```sh\r\ncargo init --lib\r\necho 'serde = { version = \"1.0\", features = [\"derive\"] }' >> Cargo.toml\r\necho 'extern crate serde;' > src/lib.rs\r\ncargo test --target x86_64-apple-darwin\r\n```\r\n\r\n(The `x86_64-apple-darwin` should be replaced by the HOST triple. The same happens with `x86_64-unknown-linux-gnu` as the HOST.)\r\n\r\n### Actual result:\r\n\r\nThe doc test failed by complaining `serde_derive` not found:\r\n\r\n```\r\n   Doc-tests test2\r\nerror[E0463]: can't find crate for `serde_derive` which `serde` depends on\r\n --> $DIR/src/lib.rs:1:1\r\n  |\r\n1 | extern crate serde;\r\n  | ^^^^^^^^^^^^^^^^^^^ can't find crate\r\n```\r\n\r\n* Adding a `[dev-dependencies]` to `serde_derive` *will not* solve it. \r\n* Depending on `serde_derive` directly in `[dependencies]` + `extern crate serde_derive;` *will* solve it (but it defeats the purpose of `features = [\"derive\"]`)\r\n\r\n---\r\n\r\nThe problem is that `libserde_derive-*` are placed in the HOST folder (`target/debug/deps`), while `libserde-*` is in the TARGET folder (`target/<triple>/debug/deps`). rustdoc is executed only with `-L dependency=target/<triple>/debug/deps`, so `libserde_derive-*` is not found.\r\n\r\n```\r\n$ find . -name libserde*\r\n./target/debug/deps/libserde_derive-277a82a8f5bc6353.dylib\r\n./target/debug/deps/libserde_derive-277a82a8f5bc6353.dylib.dSYM\r\n./target/debug/deps/libserde_derive-277a82a8f5bc6353.dylib.dSYM/Contents/Resources/DWARF/libserde_derive-277a82a8f5bc6353.dylib\r\n./target/debug/deps/libserde_derive_internals-558d9b0ee0da671d.rlib\r\n./target/x86_64-apple-darwin/debug/deps/libserde-5b01ff1fa5c50deb.rlib\r\n```\r\n\r\n---\r\n\r\n<details><summary>Versions</summary>\r\n\r\n```sh\r\n$ rustc -vV\r\nrustc 1.20.0-nightly (696412de7 2017-07-06)\r\nbinary: rustc\r\ncommit-hash: 696412de7e4e119f8536686c643621115b90c775\r\ncommit-date: 2017-07-06\r\nhost: x86_64-apple-darwin\r\nrelease: 1.20.0-nightly\r\nLLVM version: 4.0\r\n\r\n$ cargo -vV\r\ncargo 0.21.0-nightly (eb6cf012a 2017-07-02)\r\nrelease: 0.21.0\r\ncommit-hash: eb6cf012a6cc23c9c89c4009564de9fccc38b9cb\r\ncommit-date: 2017-07-02\r\n```\r\n\r\n</details>", "closed_by": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/43111/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/43111/timeline", "performed_via_github_app": null, "state_reason": "completed"}