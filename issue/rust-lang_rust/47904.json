{"url": "https://api.github.com/repos/rust-lang/rust/issues/47904", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/47904/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/47904/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/47904/events", "html_url": "https://github.com/rust-lang/rust/issues/47904", "id": 293145120, "node_id": "MDU6SXNzdWUyOTMxNDUxMjA=", "number": 47904, "title": "Compiler Panic", "user": {"login": "AljoschaMeyer", "id": 12977795, "node_id": "MDQ6VXNlcjEyOTc3Nzk1", "avatar_url": "https://avatars.githubusercontent.com/u/12977795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AljoschaMeyer", "html_url": "https://github.com/AljoschaMeyer", "followers_url": "https://api.github.com/users/AljoschaMeyer/followers", "following_url": "https://api.github.com/users/AljoschaMeyer/following{/other_user}", "gists_url": "https://api.github.com/users/AljoschaMeyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/AljoschaMeyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AljoschaMeyer/subscriptions", "organizations_url": "https://api.github.com/users/AljoschaMeyer/orgs", "repos_url": "https://api.github.com/users/AljoschaMeyer/repos", "events_url": "https://api.github.com/users/AljoschaMeyer/events{/privacy}", "received_events_url": "https://api.github.com/users/AljoschaMeyer/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-31T12:45:52Z", "updated_at": "2018-02-01T15:21:28Z", "closed_at": "2018-02-01T15:21:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "I somehow managed to get the compiler to panic on trying to compile my code. Sorry for the unhelpful description, but that's all I've got. The code uses `#![feature(closure_to_fn_coercion)]`, that might be relevant.\r\n\r\nThe codebase is [here (links directly to the commit whose changes made the compiler crash)](https://github.com/AljoschaMeyer/packet-stream-rs/commit/215e8f1476c141a5d01e1a19134f872ac8792377)\r\nCrashing command: `cargo test`\r\n\r\nI don't have the time to investigate this right now, but will need to do so at some point. I'll post if I manage to narrow down the cause.\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.19.0-nightly (28fd1e519 2017-05-27)\r\nbinary: rustc\r\ncommit-hash: 28fd1e519a3807c632d58d01e73b4948000639ba\r\ncommit-date: 2017-05-27\r\nhost: x86_64-unknown-linux-gnu\r\nrelease: 1.19.0-nightly\r\nLLVM version: 4.0\r\n```\r\n\r\n## Output for `set -x RUST_BACKTRACE full; set -x RUST_BACKTRACE 1; cargo test --verbose -- --nocapture`, omitting warnings for unused code:\r\n\r\n```\r\n       Fresh cfg-if v0.1.2\r\n       Fresh void v1.0.2\r\n       Fresh byteorder v1.2.1\r\n       Fresh regex-syntax v0.3.9\r\n       Fresh winapi-build v0.1.1\r\n       Fresh log v0.4.1\r\n       Fresh unreachable v1.0.0\r\n       Fresh winapi v0.2.8\r\n       Fresh log v0.3.9\r\n       Fresh utf8-ranges v0.1.3\r\n       Fresh regex-syntax v0.4.2\r\n       Fresh futures v0.1.17\r\n       Fresh libc v0.2.35\r\n       Fresh utf8-ranges v1.0.0\r\n       Fresh lazy_static v1.0.0\r\n       Fresh memchr v2.0.1\r\n       Fresh memchr v0.1.11\r\n       Fresh rand v0.3.20\r\n       Fresh kernel32-sys v0.2.2\r\n       Fresh aho-corasick v0.6.4\r\n       Fresh aho-corasick v0.5.3\r\n       Fresh iovec v0.1.1\r\n       Fresh thread_local v0.3.5\r\n       Fresh ordermap v0.3.4\r\n       Fresh thread-id v2.0.0\r\n       Fresh bytes v0.4.6\r\n       Fresh regex v0.2.5\r\n       Fresh multi-consumer-stream v0.2.0\r\n       Fresh thread_local v0.2.7\r\n       Fresh tokio-io v0.1.4\r\n       Fresh env_logger v0.4.3\r\n       Fresh multi-producer-sink v0.1.0\r\n       Fresh regex v0.1.80\r\n       Fresh async-ringbuffer v0.1.0\r\n       Fresh quickcheck v0.5.0\r\n       Fresh atm-io-utils v0.1.0\r\n       Fresh env_logger v0.3.5\r\n       Fresh atm-async-utils v0.1.1\r\n       Fresh quickcheck v0.4.1\r\n       Fresh partial-io v0.2.5\r\n   Compiling packet-stream v0.1.0 (file:///home/aljoscha/projects/packet-stream-rs)\r\n     Running `rustc --crate-name packet_stream src/lib.rs --emit=dep-info,link -C debuginfo=2 --test -C metadata=066442e80d647294 -C extra-filename=-066442e80d647294 --out-dir /home/aljoscha/projects/packet-stream-rs/target/debug/deps -L dependency=/home/aljoscha/projects/packet-stream-rs/target/debug/deps --extern multi_consumer_stream=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libmulti_consumer_stream-5a4ce9a776d6c4b8.rlib --extern atm_io_utils=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libatm_io_utils-071ee257d54bd20c.rlib --extern quickcheck=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libquickcheck-97686dbf695e8694.rlib --extern futures=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libfutures-fb03a1e35425c824.rlib --extern tokio_io=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libtokio_io-5be3a1d45098ff0e.rlib --extern rand=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/librand-395d79dcece8a755.rlib --extern async_ringbuffer=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libasync_ringbuffer-3d231e8e522c1ba9.rlib --extern multi_producer_sink=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libmulti_producer_sink-5622659b55680890.rlib --extern partial_io=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libpartial_io-f62cfe2fd8a90c72.rlib --extern atm_async_utils=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libatm_async_utils-79e420050927c989.rlib --extern void=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libvoid-f4e2164e54e8e4e8.rlib`\r\n\r\n[unused code warnings omitted]\r\n\r\nerror: internal compiler error: unexpected panic\r\n\r\nnote: the compiler unexpectedly panicked. this is a bug.\r\n\r\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\r\n\r\nnote: run with `RUST_BACKTRACE=1` for a backtrace\r\n\r\nthread 'rustc' panicked at 'assertion failed: !value.needs_subst()', /checkout/src/librustc/infer/mod.rs:629\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:71\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:60\r\n             at /checkout/src/libstd/panicking.rs:355\r\n   3: std::panicking::default_hook\r\n             at /checkout/src/libstd/panicking.rs:365\r\n   4: std::panicking::rust_panic_with_hook\r\n             at /checkout/src/libstd/panicking.rs:549\r\n   5: std::panicking::begin_panic\r\n   6: rustc::infer::<impl rustc::ty::context::TyCtxt<'a, 'tcx, 'tcx>>::erase_late_bound_regions_and_normalize\r\n   7: rustc_trans::monomorphize::resolve_closure\r\n   8: <rustc_trans::collector::MirNeighborCollector<'a, 'tcx> as rustc::mir::visit::Visitor<'tcx>>::visit_rvalue\r\n   9: rustc::mir::visit::Visitor::visit_mir\r\n  10: rustc_trans::collector::collect_items_rec\r\n  11: rustc_trans::collector::collect_items_rec\r\n  12: rustc_trans::collector::collect_items_rec\r\n  13: rustc_trans::collector::collect_items_rec\r\n  14: rustc_trans::collector::collect_items_rec\r\n  15: rustc_trans::collector::collect_items_rec\r\n  16: rustc_trans::collector::collect_items_rec\r\n  17: rustc_trans::collector::collect_items_rec\r\n  18: rustc_trans::collector::collect_items_rec\r\n  19: rustc_trans::collector::collect_items_rec\r\n  20: rustc_trans::collector::collect_items_rec\r\n  21: rustc_trans::collector::collect_items_rec\r\n  22: rustc_trans::collector::collect_items_rec\r\n  23: rustc_trans::collector::collect_items_rec\r\n  24: rustc_trans::collector::collect_items_rec\r\n  25: rustc_trans::collector::collect_items_rec\r\n  26: rustc_trans::base::collect_and_partition_translation_items::{{closure}}\r\n  27: rustc_trans::base::trans_crate\r\n  28: rustc_driver::driver::phase_4_translate_to_llvm\r\n  29: rustc_driver::driver::compile_input::{{closure}}\r\n  30: rustc_driver::driver::phase_3_run_analysis_passes::{{closure}}\r\n  31: rustc_driver::driver::phase_3_run_analysis_passes\r\n  32: rustc_driver::driver::compile_input\r\n  33: rustc_driver::run_compiler\r\n\r\nerror: Could not compile `packet-stream`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name packet_stream src/lib.rs --emit=dep-info,link -C debuginfo=2 --test -C metadata=066442e80d647294 -C extra-filename=-066442e80d647294 --out-dir /home/aljoscha/projects/packet-stream-rs/target/debug/deps -L dependency=/home/aljoscha/projects/packet-stream-rs/target/debug/deps --extern multi_consumer_stream=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libmulti_consumer_stream-5a4ce9a776d6c4b8.rlib --extern atm_io_utils=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libatm_io_utils-071ee257d54bd20c.rlib --extern quickcheck=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libquickcheck-97686dbf695e8694.rlib --extern futures=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libfutures-fb03a1e35425c824.rlib --extern tokio_io=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libtokio_io-5be3a1d45098ff0e.rlib --extern rand=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/librand-395d79dcece8a755.rlib --extern async_ringbuffer=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libasync_ringbuffer-3d231e8e522c1ba9.rlib --extern multi_producer_sink=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libmulti_producer_sink-5622659b55680890.rlib --extern partial_io=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libpartial_io-f62cfe2fd8a90c72.rlib --extern atm_async_utils=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libatm_async_utils-79e420050927c989.rlib --extern void=/home/aljoscha/projects/packet-stream-rs/target/debug/deps/libvoid-f4e2164e54e8e4e8.rlib` (exit code: 101)\r\n\r\n```\r\n", "closed_by": {"login": "AljoschaMeyer", "id": 12977795, "node_id": "MDQ6VXNlcjEyOTc3Nzk1", "avatar_url": "https://avatars.githubusercontent.com/u/12977795?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AljoschaMeyer", "html_url": "https://github.com/AljoschaMeyer", "followers_url": "https://api.github.com/users/AljoschaMeyer/followers", "following_url": "https://api.github.com/users/AljoschaMeyer/following{/other_user}", "gists_url": "https://api.github.com/users/AljoschaMeyer/gists{/gist_id}", "starred_url": "https://api.github.com/users/AljoschaMeyer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AljoschaMeyer/subscriptions", "organizations_url": "https://api.github.com/users/AljoschaMeyer/orgs", "repos_url": "https://api.github.com/users/AljoschaMeyer/repos", "events_url": "https://api.github.com/users/AljoschaMeyer/events{/privacy}", "received_events_url": "https://api.github.com/users/AljoschaMeyer/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/47904/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/47904/timeline", "performed_via_github_app": null, "state_reason": "completed"}