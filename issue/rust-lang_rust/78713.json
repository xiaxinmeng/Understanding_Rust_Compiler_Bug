{"url": "https://api.github.com/repos/rust-lang/rust/issues/78713", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/78713/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/78713/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/78713/events", "html_url": "https://github.com/rust-lang/rust/issues/78713", "id": 735624166, "node_id": "MDU6SXNzdWU3MzU2MjQxNjY=", "number": 78713, "title": "regression: `panic!` and RUST_BACKTRACE=1 Show Wrong & Non-Informative Function Names when Unwinding", "user": {"login": "DK26", "id": 12109801, "node_id": "MDQ6VXNlcjEyMTA5ODAx", "avatar_url": "https://avatars.githubusercontent.com/u/12109801?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DK26", "html_url": "https://github.com/DK26", "followers_url": "https://api.github.com/users/DK26/followers", "following_url": "https://api.github.com/users/DK26/following{/other_user}", "gists_url": "https://api.github.com/users/DK26/gists{/gist_id}", "starred_url": "https://api.github.com/users/DK26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DK26/subscriptions", "organizations_url": "https://api.github.com/users/DK26/orgs", "repos_url": "https://api.github.com/users/DK26/repos", "events_url": "https://api.github.com/users/DK26/events{/privacy}", "received_events_url": "https://api.github.com/users/DK26/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}, {"id": 123109, "node_id": "MDU6TGFiZWwxMjMxMDk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows", "name": "O-windows", "color": "6e6ec0", "default": false, "description": "Operating system: Windows"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 266005765, "node_id": "MDU6TGFiZWwyNjYwMDU3NjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-windows-msvc", "name": "O-windows-msvc", "color": "6e6ec0", "default": false, "description": "Toolchain: MSVC, Operating system: Windows"}, {"id": 289259951, "node_id": "MDU6TGFiZWwyODkyNTk5NTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/E-help-wanted", "name": "E-help-wanted", "color": "02E10C", "default": false, "description": "Call for participation: Help is requested to fix this issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 2011781731, "node_id": "MDU6TGFiZWwyMDExNzgxNzMx", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-libs", "name": "T-libs", "color": "bfd4f2", "default": false, "description": "Relevant to the library team, which will review and decide on the PR/issue."}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2020-11-03T20:47:00Z", "updated_at": "2022-05-25T08:30:29Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\nAs I'm learning the language from a book (\"_The Complete Rust Programming Reference Guide_\" p. 229-230), and was executing the  `panic!` macro in a multi-thread environment, I've noticed the unwinding from the book is different from the one I've got where the one I've got is not informative or helpful, and seems wrong where the one in book seems to be OK.\r\n\r\n### Code\r\n\r\nI tried this code:\r\n\r\n```rust\r\n// panic_unwinding.rs\r\n\r\nuse std::thread;\r\n\r\nfn alice() -> thread::JoinHandle<()> {\r\n    thread::spawn(move || {\r\n        bob();\r\n    })\r\n}\r\n\r\nfn bob() {\r\n    malice();\r\n}\r\n\r\nfn malice() {\r\n    panic!(\"malice is panicking!\");\r\n}\r\n\r\nfn main() {\r\n\r\n    let child = alice();\r\n    let _ = child.join();\r\n\r\n    bob();\r\n    println!(\"This is unreachable code\");\r\n    \r\n}\r\n```\r\n\r\nI expected the backtrace to include the function names as they were called, all the way from the entry point of the threads.\r\n\r\nInstead, all functions were named the same: \r\n(env: `RUST_BACKTRACE=1`)\r\n```\r\nthread '<unnamed>' panicked at 'malice is panicking!', .\\panic_unwinding.rs:16:5\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n   1: panic_unwinding::alice::{{closure}}\r\n   2: panic_unwinding::alice::{{closure}}\r\n   3: panic_unwinding::alice::{{closure}}\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nthread 'main' panicked at 'malice is panicking!', .\\panic_unwinding.rs:16:5\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n   1: panic_unwinding::alice::{{closure}}\r\n   2: panic_unwinding::alice::{{closure}}\r\n   3: panic_unwinding::alice::{{closure}}\r\n   4: core::ops::function::FnOnce::call_once\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n```\r\n\r\n### Version it worked on\r\nI don't know from when is the regression. The book is using an old version of Rust: 1.32.0\r\n<!--\r\nProvide the most recent version this worked on, for example:\r\n\r\nIt most recently worked on: Rust 1.47\r\n-->\r\n### Version with regression\r\nI use the most current version: Rust 1.47.0\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.47.0 (18bf6b4f0 2020-10-07)\r\nbinary: rustc\r\ncommit-hash: 18bf6b4f01a6feaf7259ba7cdae58031af1b7b39\r\ncommit-date: 2020-10-07\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.47.0\r\nLLVM version: 11.0\r\n```\r\n</p>\r\n</details>\r\n\r\n<!--\r\nIf you know when this regression occurred, please add a line like below, replacing `{channel}` with one of stable, beta, or nightly.\r\n\r\n@rustbot modify labels: +regression-from-stable-to-{channel} -regression-untriaged\r\n-->\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/78713/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/78713/timeline", "performed_via_github_app": null, "state_reason": null}