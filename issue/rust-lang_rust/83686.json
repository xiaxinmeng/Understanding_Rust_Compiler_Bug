{"url": "https://api.github.com/repos/rust-lang/rust/issues/83686", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/83686/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/83686/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/83686/events", "html_url": "https://github.com/rust-lang/rust/issues/83686", "id": 845048234, "node_id": "MDU6SXNzdWU4NDUwNDgyMzQ=", "number": 83686, "title": "Signature mismatch in __wasilibc_find_relpath", "user": {"login": "jrandall", "id": 458361, "node_id": "MDQ6VXNlcjQ1ODM2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/458361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrandall", "html_url": "https://github.com/jrandall", "followers_url": "https://api.github.com/users/jrandall/followers", "following_url": "https://api.github.com/users/jrandall/following{/other_user}", "gists_url": "https://api.github.com/users/jrandall/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrandall/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrandall/subscriptions", "organizations_url": "https://api.github.com/users/jrandall/orgs", "repos_url": "https://api.github.com/users/jrandall/repos", "events_url": "https://api.github.com/users/jrandall/events{/privacy}", "received_events_url": "https://api.github.com/users/jrandall/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 474645165, "node_id": "MDU6TGFiZWw0NzQ2NDUxNjU=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-wasm", "name": "O-wasm", "color": "6e6ec0", "default": false, "description": "Target: WASM (WebAssembly), http://webassembly.org/"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2021-03-30T18:42:51Z", "updated_at": "2022-12-12T12:16:24Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "In https://github.com/rust-lang/rust/pull/67267, @alexcrichton indicated that the signature of `__wasilibc_find_relpath` had changed upstream, and that PR was merged changing the signature from a 4-argument version to a 2-argument version.\r\n\r\nI'm not 100% sure what \"upstream\" means in this context, but I had previously thought it was wasi-libc from the `WebAssembly` repo. It does seem to be the case that until recently, `WebAssembly/wasi-libc` had a 2-argument version of `__wasilibc_find_relpath` so that seems consistent. \r\n\r\nHowever, about 4 months ago in https://github.com/WebAssembly/wasi-libc/pull/214, @alexcrichton changed the signature of `__wasilibc_find_relpath` from a 2-argument version to a 4-argument version (among higher-level changes relating to `getcwd`/`chdir`): https://github.com/WebAssembly/wasi-libc/pull/214/files#diff-a1d7011f390a08ae599db3993ed73f49d1b52748faae3fc11d0f5a12e5e1a2edR28-R31\r\n\r\nWe have a project in which we build a rust staticlib crate using the `wasm32-wasi` target, and then link that with C code that is also built against `wasm32-wasi`. This had been working, but after updating rust to 1.50.0 (from a much older version) it is now broken with the following final (llvm-11) linker error:\r\n```\r\nwasm-ld: warning: function signature mismatch: __wasilibc_find_relpath\r\n     >>> defined as (i32, i32) -> i32 in /build/example/libexample.a(std-0bc94da15b7c3ad9.std.553gu1ty-cgu.0.rcgu.o)\r\n     >>> defined as (i32, i32, i32, i32) -> i32 in /opt/wasi-sdk/share/sysroot/lib/wasm32-wasi/libc.a(preopens.o)\r\n```\r\n\r\nIf \"upstream\" means what I think it does, I think the rust signature of `__wasilibc_find_relpath` now no longer matches the current wasi-libc version. ", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/83686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/83686/timeline", "performed_via_github_app": null, "state_reason": null}