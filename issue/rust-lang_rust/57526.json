{"url": "https://api.github.com/repos/rust-lang/rust/issues/57526", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/57526/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/57526/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/57526/events", "html_url": "https://github.com/rust-lang/rust/issues/57526", "id": 398445577, "node_id": "MDU6SXNzdWUzOTg0NDU1Nzc=", "number": 57526, "title": "first/second mutable borrow occurs here wrong diagnostic in nll", "user": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 171502053, "node_id": "MDU6TGFiZWwxNzE1MDIwNTM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-borrow-checker", "name": "A-borrow-checker", "color": "f7e101", "default": false, "description": "Area: The borrow checker"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596122130, "node_id": "MDU6TGFiZWwxNTk2MTIyMTMw", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-papercut", "name": "D-papercut", "color": "c9f7a3", "default": false, "description": "Diagnostic error that needs small tweaks"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-01-11T20:45:28Z", "updated_at": "2021-10-04T13:07:56Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "After https://github.com/rust-lang/rust/pull/56113 we figured with @nikomatsakis that the output of `src/test/ui/borrowck/borrowck-mut-borrow-linear-errors.rs` in NLL is not ideal ([play](https://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=e214c2f5b4adadbcdfde970a69b7557f)):\r\n\r\n```rust\r\nfn main() {\r\n    let mut x = 1;\r\n    let mut addr = vec![];\r\n    loop {\r\n        match 1 {\r\n            1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n            2 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n            _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n            //[mir]~^ ERROR [E0499]\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThis outputs:\r\n\r\n```\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:13:30\r\n   |\r\nLL |             1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                    ----      ^^^^^^ second mutable borrow occurs here\r\n   |                    |\r\n   |                    first borrow later used here\r\n...\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ------ first mutable borrow occurs here\r\n\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:15:30\r\n   |\r\nLL |             1 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                    ---- first borrow later used here\r\nLL |             //[mir]~^ ERROR [E0499]\r\nLL |             2 => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ^^^^^^ second mutable borrow occurs here\r\nLL |             //[mir]~^ ERROR [E0499]\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ------ first mutable borrow occurs here\r\n\r\nerror[E0499]: cannot borrow `x` as mutable more than once at a time\r\n  --> $DIR/borrowck-mut-borrow-linear-errors.rs:17:30\r\n   |\r\nLL |             _ => { addr.push(&mut x); } //[ast]~ ERROR [E0499]\r\n   |                              ^^^^^^ mutable borrow starts here in previous iteration of loop\r\n\r\nerror: aborting due to 3 previous errors\r\n\r\nFor more information about this error, try `rustc --explain E0499`.\r\n```\r\n\r\nin NLL mode.\r\n\r\nIn particular the mention of first and second is weird. Why the `_ =>` arm is the first one?. Is that clear to the user?. There are several errors in the test also. Is it better to mix the fact that you're mutably borrowing something in `_ =>` and the mutably borrowing in `1 =>`? or is it better and easier to just state that both borrows are inside of the loop?.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/57526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/57526/timeline", "performed_via_github_app": null, "state_reason": null}