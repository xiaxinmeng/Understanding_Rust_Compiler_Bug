{"url": "https://api.github.com/repos/rust-lang/rust/issues/36614", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/36614/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/36614/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/36614/events", "html_url": "https://github.com/rust-lang/rust/issues/36614", "id": 178257529, "node_id": "MDU6SXNzdWUxNzgyNTc1Mjk=", "number": 36614, "title": "Compiler crashes on `if let` match using copied const char", "user": {"login": "joshhansen", "id": 733906, "node_id": "MDQ6VXNlcjczMzkwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/733906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshhansen", "html_url": "https://github.com/joshhansen", "followers_url": "https://api.github.com/users/joshhansen/followers", "following_url": "https://api.github.com/users/joshhansen/following{/other_user}", "gists_url": "https://api.github.com/users/joshhansen/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshhansen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshhansen/subscriptions", "organizations_url": "https://api.github.com/users/joshhansen/orgs", "repos_url": "https://api.github.com/users/joshhansen/repos", "events_url": "https://api.github.com/users/joshhansen/events{/privacy}", "received_events_url": "https://api.github.com/users/joshhansen/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-09-21T06:24:00Z", "updated_at": "2016-09-22T03:46:39Z", "closed_at": "2016-09-22T03:46:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Something about a copied const char inside an enum member being matched against makes the compiler explode. The expected behavior was that the compiler completes its run. The actual behavior was that the compiler crashes on this minimal example:\n\n```\nconst A: char = 'a';\nconst B: char = A;\n\nenum C {\n    D(char)\n}\n\nfn main() {\n    if let C::D(B) = C::D('?') {\n    }\n}\n```\n\nAnd here's the full stacktrace and error output:\n\n```\n$ RUST_BACKTRACE=1 cargo build\n   Compiling rustc-bug v0.1.0 (file:///home/josh/Projects/Umpire-rustc-bug)\nsrc/main.rs:9:17: 9:18 error: internal compiler error: ../src/librustc_trans/debuginfo/metadata.rs:910: debuginfo: Could not find scope info for node NodeExpr(expr(6: 'a'))\nsrc/main.rs:9     if let C::D(B) = C::D('?') {\n                              ^\nnote: the compiler unexpectedly panicked. this is a bug.\nnote: we would appreciate a bug report: https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#bug-reports\nnote: run with `RUST_BACKTRACE=1` for a backtrace\nthread 'rustc' panicked at 'Box<Any>', ../src/librustc_errors/lib.rs:580\nstack backtrace:\n   1:     0x7fafc1aa7e2f - std::sys::backtrace::tracing::imp::write::h46e546df6e4e4fe6\n   2:     0x7fafc1ab613b - std::panicking::default_hook::_$u7b$$u7b$closure$u7d$$u7d$::h077deeda8b799591\n   3:     0x7fafc1ab5cd8 - std::panicking::default_hook::heb8b6fd640571a4f\n   4:     0x7fafc1a7bade - std::panicking::rust_panic_with_hook::hd7b83626099d3416\n   5:     0x7fafc0981018 - std::panicking::begin_panic::h3e029d5f110b4661\n   6:     0x7fafc0980e85 - rustc::session::opt_span_bug_fmt::_$u7b$$u7b$closure$u7d$$u7d$::h11fa08f71c1e9d84\n   7:     0x7fafc0980c4f - rustc::session::span_bug_fmt::he71d3b772c0a8595\n   8:     0x7fafc0a5a935 - rustc_trans::debuginfo::metadata::scope_metadata::h731586b717fdb550\n   9:     0x7fafc0a4d769 - rustc_trans::debuginfo::source_loc::set_source_location::h29529e8aed3c00b6\n  10:     0x7fafc098407e - rustc_trans::build::ICmp::hd7251cb7a5ff9d7f\n  11:     0x7fafc098e7db - rustc_trans::base::compare_scalar_types::hb0e9dedaf9824996\n  12:     0x7fafc0a98256 - rustc_trans::_match::compile_submatch_continue::ha4993c8e4f88d5d5\n  13:     0x7fafc0a93ff0 - rustc_trans::_match::compile_submatch::h59f8ee210cad8fbb\n  14:     0x7fafc0a99c1c - rustc_trans::_match::compile_submatch_continue::ha4993c8e4f88d5d5\n  15:     0x7fafc0a93ff0 - rustc_trans::_match::compile_submatch::h59f8ee210cad8fbb\n  16:     0x7fafc0a9c8ed - rustc_trans::_match::trans_match_inner::h428a9204356e967f\n  17:     0x7fafc0a65da7 - rustc_trans::expr::trans_rvalue_dps_unadjusted::h3c5303bd2a5eb96a\n  18:     0x7fafc09b6c32 - rustc_trans::expr::trans_into::h7bef8459884ddb79\n  19:     0x7fafc09ae61e - rustc_trans::controlflow::trans_block::h6560e54eab89317d\n  20:     0x7fafc09a8518 - rustc_trans::base::trans_closure::h1ab33a1b60511d91\n  21:     0x7fafc09aede3 - rustc_trans::base::trans_fn::he8613d5f36dd799b\n  22:     0x7fafc09b82be - rustc_trans::base::trans_item::hcfc6f2f68b9918b0\n  23:     0x7fafc09d0893 - _<rustc_trans..base..TransItemsWithinModVisitor<'a, 'tcx> as rustc..hir..intravisit..Visitor<'v>>::visit_item::hfffd713d2b3de363\n  24:     0x7fafc09c1337 - rustc_trans::base::trans_crate::h75826f6271b49faf\n  25:     0x7fafc1ffc07f - rustc_driver::driver::phase_4_translate_to_llvm::hbc7e9672529bb439\n  26:     0x7fafc1ff906c - rustc_driver::driver::compile_input::_$u7b$$u7b$closure$u7d$$u7d$::h7168080c5b7e33b9\n  27:     0x7fafc1ff577d - rustc_driver::driver::phase_3_run_analysis_passes::_$u7b$$u7b$closure$u7d$$u7d$::hded790081e457a76\n  28:     0x7fafc1feef49 - rustc::ty::context::TyCtxt::create_and_enter::h7622c0f52ea2e7fe\n  29:     0x7fafc1fac80f - rustc_driver::driver::compile_input::hdfe4405d66704c31\n  30:     0x7fafc1f98f44 - rustc_driver::run_compiler::h581448fb74257353\n  31:     0x7fafc1f9604e - std::panicking::try::call::hf081e8ea5e252d1a\n  32:     0x7fafc1ac463b - __rust_try\n  33:     0x7fafc1ac45de - __rust_maybe_catch_panic\n  34:     0x7fafc1f96b34 - _<F as alloc..boxed..FnBox<A>>::call_box::h2d5dcb354b3ff8db\n  35:     0x7fafc1ab4264 - std::sys::thread::Thread::new::thread_start::hf2eed4b6f7149599\n  36:     0x7fafb9d24ee4 - start_thread\n  37:     0x7fafc16efd1c - clone\n  38:                0x0 - <unknown>\n\nerror: Could not compile `rustc-bug`.\n\nTo learn more, run the command again with --verbose.\n```\n\nRust version information:\n\n```\n$ rustc --version --verbose\nrustc 1.11.0 (9b21dcd6a 2016-08-15)\nbinary: rustc\ncommit-hash: 9b21dcd6a89f38e8ceccb2ede8c9027cb409f6e3\ncommit-date: 2016-08-15\nhost: x86_64-unknown-linux-gnu\nrelease: 1.11.0\n```\n\nNote that changing the if let expression to `if let C::D(A) = C::D('?')` results in a successful compile.\n", "closed_by": {"login": "joshhansen", "id": 733906, "node_id": "MDQ6VXNlcjczMzkwNg==", "avatar_url": "https://avatars.githubusercontent.com/u/733906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joshhansen", "html_url": "https://github.com/joshhansen", "followers_url": "https://api.github.com/users/joshhansen/followers", "following_url": "https://api.github.com/users/joshhansen/following{/other_user}", "gists_url": "https://api.github.com/users/joshhansen/gists{/gist_id}", "starred_url": "https://api.github.com/users/joshhansen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joshhansen/subscriptions", "organizations_url": "https://api.github.com/users/joshhansen/orgs", "repos_url": "https://api.github.com/users/joshhansen/repos", "events_url": "https://api.github.com/users/joshhansen/events{/privacy}", "received_events_url": "https://api.github.com/users/joshhansen/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/36614/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/36614/timeline", "performed_via_github_app": null, "state_reason": "completed"}