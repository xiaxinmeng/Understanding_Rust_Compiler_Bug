{"url": "https://api.github.com/repos/rust-lang/rust/issues/60593", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/60593/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/60593/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/60593/events", "html_url": "https://github.com/rust-lang/rust/issues/60593", "id": 440937359, "node_id": "MDU6SXNzdWU0NDA5MzczNTk=", "number": 60593, "title": "Panic inside panic when procedural macro is called with proc_macro::bridge::client", "user": {"login": "fedochet", "id": 8393617, "node_id": "MDQ6VXNlcjgzOTM2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8393617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fedochet", "html_url": "https://github.com/fedochet", "followers_url": "https://api.github.com/users/fedochet/followers", "following_url": "https://api.github.com/users/fedochet/following{/other_user}", "gists_url": "https://api.github.com/users/fedochet/gists{/gist_id}", "starred_url": "https://api.github.com/users/fedochet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fedochet/subscriptions", "organizations_url": "https://api.github.com/users/fedochet/orgs", "repos_url": "https://api.github.com/users/fedochet/repos", "events_url": "https://api.github.com/users/fedochet/events{/privacy}", "received_events_url": "https://api.github.com/users/fedochet/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 39, "created_at": "2019-05-06T22:56:40Z", "updated_at": "2022-08-08T23:31:20Z", "closed_at": "2022-08-08T08:33:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am experiencing a strange panic that happens inside procedural macros when they are compiled as dynamic libraries, dynamically linked and then called explicitly using `proc_macro::bridge::client`.\r\n\r\nIt's quite hard to reproduce in small amount of code, so I've made up an example project where you can launch the tests and see the panic, it is [here](https://github.com/fedochet/rust-proc-macro-panic-inside-panic-expample). Specifically, the stack backtrace can be seen [here](https://github.com/fedochet/rust-proc-macro-panic-inside-panic-expample#how-to-see-the-panic).\r\n\r\nI've experimented with different compiler versions, and it seems that the only thing that triggers such panic is version alignment between compiler that compiled procedural macro itself, and compiler that compiled the code that is calling run method. As long as those compilers have different versions, everything works as expected.\r\n\r\nI wasn't able to find the reason of this problem myself, so I thought it may be useful for you to know about this behaviour (maybe it is a bug of some sort).", "closed_by": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/60593/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/60593/timeline", "performed_via_github_app": null, "state_reason": "completed"}