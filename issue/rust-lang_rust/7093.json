{"url": "https://api.github.com/repos/rust-lang/rust/issues/7093", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/7093/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/7093/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/7093/events", "html_url": "https://github.com/rust-lang/rust/issues/7093", "id": 15483636, "node_id": "MDU6SXNzdWUxNTQ4MzYzNg==", "number": 7093, "title": "../configure --disable-optimize-cxx breaks jemalloc", "user": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 36953, "node_id": "MDU6TGFiZWwzNjk1Mw==", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-runtime", "name": "A-runtime", "color": "f7e101", "default": false, "description": "Area: std's runtime and \"pre-main\" init for handling backtraces, unwinds, stack overflows"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2013-06-13T01:19:06Z", "updated_at": "2013-08-05T16:22:00Z", "closed_at": "2013-08-05T16:22:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Building libstd in stage1 crashes with this backtrace:\n\n```\n0x00007ffff599486d in arena_chunk_dirty_remove (rbtree=0x0, node=0x0) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:205\n205     rb_gen(static UNUSED, arena_chunk_dirty_, arena_chunk_tree_t, arena_chunk_t,\n(gdb) bt\n#0  0x00007ffff599486d in arena_chunk_dirty_remove (rbtree=0x0, node=0x0) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:205\n#1  0x00007ffff5996f8b in arena_avail_remove (arena=0x7ffff28092c0, chunk=0x7ffff2000000, pageind=538, npages=1, maybe_adjac_pred=true, maybe_adjac_succ=true)\n    at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:293\n#2  0x00007ffff599861d in arena_run_split (arena=0x7ffff28092c0, run=0x7ffff221a000, size=4096, large=true, binind=255, zero=false) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:406\n#3  0x00007ffff599d4f6 in arena_chunk_purge (arena=0x7ffff28092c0, chunk=0x7ffff2000000, all=false) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:775\n#4  0x00007ffff599e513 in arena_purge (arena=0x7ffff28092c0, all=false) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:952\n#5  0x00007ffff599c87e in arena_maybe_purge (arena=0x7ffff28092c0) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:707\n#6  0x00007ffff59a1a85 in arena_run_dalloc (arena=0x7ffff28092c0, run=0x7ffff2261000, dirty=true, cleaned=false) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:1101\n#7  0x00007ffff59ac128 in arena_dalloc_bin_run (arena=0x7ffff28092c0, chunk=0x7ffff2000000, run=0x7ffff2261000, bin=0x7ffff280a350) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:1658\n#8  0x00007ffff59acb6f in arena_dalloc_bin_locked (arena=0x7ffff28092c0, chunk=0x7ffff2000000, ptr=0x7ffff2261c00, mapelm=0x7ffff20038b8) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:1712\n#9  0x00007ffff59acdb1 in arena_dalloc_bin (arena=0x7ffff28092c0, chunk=0x7ffff2000000, ptr=0x7ffff2261c00, pageind=609, mapelm=0x7ffff20038b8) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:1733\n#10 0x00007ffff59ad69a in arena_dalloc_small (arena=0x7ffff28092c0, chunk=0x7ffff2000000, ptr=0x7ffff2261c00, pageind=609) at /home/brian/dev/rust2/src/rt/jemalloc/src/arena.c:1749\n#11 0x00007ffff59874cc in arena_dalloc (try_tcache=true, ptr=0x7ffff2261c00, chunk=0x7ffff2000000, arena=0x7ffff28092c0) at /home/brian/dev/rust2/src/rt/jemalloc/include/jemalloc/internal/arena.h:1005\n#12 idallocx (try_tcache=true, ptr=0x7ffff2261c00) at include/jemalloc/internal/jemalloc_internal.h:910\n#13 iqallocx (try_tcache=true, ptr=0x7ffff2261c00) at include/jemalloc/internal/jemalloc_internal.h:929\n#14 iqalloc (ptr=0x7ffff2261c00) at include/jemalloc/internal/jemalloc_internal.h:936\n#15 free (ptr=0x7ffff2261c00) at /home/brian/dev/rust2/src/rt/jemalloc/src/jemalloc.c:1272\n#16 0x00007ffff5927053 in rust_exchange_alloc::free (this=0x7ffff242a080, ptr=0x7ffff2261c00) at /home/brian/dev/rust2/src/rt/rust_exchange_alloc.cpp:41\n#17 0x00007ffff5931f85 in rust_kernel::free (this=0x7ffff242a080, mem=0x7ffff2261c00) at /home/brian/dev/rust2/src/rt/rust_kernel.cpp:88\n#18 0x00007ffff591be9b in kernel_owned<rust_sched_launcher>::operator delete (ptr=0x7ffff2261c00) at /home/brian/dev/rust2/src/rt/rust_kernel.h:170\n#19 0x00007ffff591c0c6 in rust_thread_sched_launcher::~rust_thread_sched_launcher (this=0x7ffff2261c00, __in_chrg=<optimized out>) at /home/brian/dev/rust2/src/rt/rust_sched_launcher.h:43\n#20 0x00007ffff591cbae in rust_scheduler::destroy_task_thread (this=0x7ffff2432180, thread=0x7ffff2261c00) at /home/brian/dev/rust2/src/rt/rust_scheduler.cpp:60\n#21 0x00007ffff591cc0a in rust_scheduler::destroy_task_threads (this=0x7ffff2432180) at /home/brian/dev/rust2/src/rt/rust_scheduler.cpp:67\n#22 0x00007ffff591ca38 in rust_scheduler::delete_this (this=0x7ffff2432180) at /home/brian/dev/rust2/src/rt/rust_scheduler.cpp:41\n#23 0x00007ffff5932d38 in rust_scheduler::deref (this=0x7ffff2432180) at /home/brian/dev/rust2/src/rt/rust_scheduler.h:30\n#24 0x00007ffff5932483 in rust_kernel::wait_for_schedulers (this=0x7ffff242a080) at /home/brian/dev/rust2/src/rt/rust_kernel.cpp:184\n#25 0x00007ffff591d672 in rust_sched_reaper::run (this=0x7ffff242a1c8) at /home/brian/dev/rust2/src/rt/rust_sched_reaper.cpp:24\n#26 0x00007ffff5914a95 in rust_thread_start (ptr=0x7ffff242a1c8) at /home/brian/dev/rust2/src/rt/sync/rust_thread.cpp:36\n#27 0x00007ffff50f4e9a in start_thread (arg=0x7ffff7fdb700) at pthread_create.c:308\n#28 0x00007ffff5606ccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n\n```\n", "closed_by": {"login": "emberian", "id": 704250, "node_id": "MDQ6VXNlcjcwNDI1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/704250?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emberian", "html_url": "https://github.com/emberian", "followers_url": "https://api.github.com/users/emberian/followers", "following_url": "https://api.github.com/users/emberian/following{/other_user}", "gists_url": "https://api.github.com/users/emberian/gists{/gist_id}", "starred_url": "https://api.github.com/users/emberian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emberian/subscriptions", "organizations_url": "https://api.github.com/users/emberian/orgs", "repos_url": "https://api.github.com/users/emberian/repos", "events_url": "https://api.github.com/users/emberian/events{/privacy}", "received_events_url": "https://api.github.com/users/emberian/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/7093/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/7093/timeline", "performed_via_github_app": null, "state_reason": "completed"}