{"url": "https://api.github.com/repos/rust-lang/rust/issues/48233", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/48233/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/48233/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/48233/events", "html_url": "https://github.com/rust-lang/rust/issues/48233", "id": 297482188, "node_id": "MDU6SXNzdWUyOTc0ODIxODg=", "number": 48233, "title": "codegen-units=16 doubles compile times for Firefox", "user": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 234956, "node_id": "MDU6TGFiZWwyMzQ5NTY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-codegen", "name": "A-codegen", "color": "f7e101", "default": false, "description": "Area: Code generation"}, {"id": 60344715, "node_id": "MDU6TGFiZWw2MDM0NDcxNQ==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-medium", "name": "P-medium", "color": "eb6420", "default": false, "description": "Medium priority"}, {"id": 64037154, "node_id": "MDU6TGFiZWw2NDAzNzE1NA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/I-compiletime", "name": "I-compiletime", "color": "e11d21", "default": false, "description": "Problems and improvements with respect to compile times."}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 16, "created_at": "2018-02-15T15:15:57Z", "updated_at": "2018-05-06T21:15:35Z", "closed_at": "2018-05-06T21:15:34Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "https://bugzilla.mozilla.org/show_bug.cgi?id=1436251\r\n\r\nThe other day I was experimenting with codegen-units, and realized that Firefox's build gets _really_ slow with codgen-units=16 (the default):\r\n\r\n```\r\nwith codegen-units=1\r\nreal    20m35.218s\r\nuser    135m46.044s\r\nsys     5m49.332s\r\n\r\nwith default codegen-units (16)\r\nreal    38m3.751s\r\nuser    156m53.384s\r\nsys     6m22.100s\r\n```\r\n\r\nI wasn't able to reduce the testcase.\r\n\r\nIf you wish to do it, use nightly to build Firefox with the following mozconfig file:\r\n\r\n```\r\nac_add_options --enable-debug\r\nac_add_options --enable-optimize\r\nac_add_options --enable-release\r\n```\r\n\r\n\r\nand revert this patch: https://hg.mozilla.org/mozilla-central/rev/fe90c7d53a7c\r\n\r\nA useful bit of information may be that we pass `-Clto` only to the toplevel crate, i.e. we build with `cargo rustc -- -Clto`. I don't remember but it might have been only the last crate (\"gkrust\") taking forever to build (I can retest this if you wish) so it might be some pathological case with LTO.\r\n\r\ncc @michaelwoerister ", "closed_by": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/48233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/48233/timeline", "performed_via_github_app": null, "state_reason": "completed"}