{"url": "https://api.github.com/repos/rust-lang/rust/issues/77721", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/77721/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/77721/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/77721/events", "html_url": "https://github.com/rust-lang/rust/issues/77721", "id": 717666297, "node_id": "MDU6SXNzdWU3MTc2NjYyOTc=", "number": 77721, "title": "bootstrap tries to create prefix without taking DESTDIR into account", "user": {"login": "gyakovlev", "id": 168902, "node_id": "MDQ6VXNlcjE2ODkwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/168902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gyakovlev", "html_url": "https://github.com/gyakovlev", "followers_url": "https://api.github.com/users/gyakovlev/followers", "following_url": "https://api.github.com/users/gyakovlev/following{/other_user}", "gists_url": "https://api.github.com/users/gyakovlev/gists{/gist_id}", "starred_url": "https://api.github.com/users/gyakovlev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gyakovlev/subscriptions", "organizations_url": "https://api.github.com/users/gyakovlev/orgs", "repos_url": "https://api.github.com/users/gyakovlev/repos", "events_url": "https://api.github.com/users/gyakovlev/events{/privacy}", "received_events_url": "https://api.github.com/users/gyakovlev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-08T21:08:31Z", "updated_at": "2021-01-07T17:54:05Z", "closed_at": "2021-01-07T17:54:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "https://github.com/rust-lang/rust/commit/8e7606f204d8775b051cdd9a427ec6dd89b837b8 uncovered a regression in bootstrap\r\n\r\nThe usual distribution/packager workflow is\r\n\r\ndefine prefix as path intended prefix for installation.\r\nduring install phase define DESTDIR, so installation is dumped there to be packed up by package manager.\r\n\r\nbut with 8e7606f204d8775b051cdd9a427ec6dd89b837b8 installer tries to create a prefix, ignoring destdir.\r\n\r\nexpected behaviour is to create ${DESTDIR}/${prefix}\r\n \r\nso if `prefix=/usr` it works fine, as `/usr` always exists. and it will install to `${DESTDIR}/usr/...`\r\nif `prefix=/usr/lib/rust/$ver` , bootstrap will attempt to create prefix directory directly if it does not exist yet, but it should prepend `DISTDIR` at this step, as creating directories on host filesystem is not allowed in sandboxed builds, and it will fail if building as non-root user.\r\n\r\n\r\n", "closed_by": {"login": "gyakovlev", "id": 168902, "node_id": "MDQ6VXNlcjE2ODkwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/168902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gyakovlev", "html_url": "https://github.com/gyakovlev", "followers_url": "https://api.github.com/users/gyakovlev/followers", "following_url": "https://api.github.com/users/gyakovlev/following{/other_user}", "gists_url": "https://api.github.com/users/gyakovlev/gists{/gist_id}", "starred_url": "https://api.github.com/users/gyakovlev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gyakovlev/subscriptions", "organizations_url": "https://api.github.com/users/gyakovlev/orgs", "repos_url": "https://api.github.com/users/gyakovlev/repos", "events_url": "https://api.github.com/users/gyakovlev/events{/privacy}", "received_events_url": "https://api.github.com/users/gyakovlev/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/77721/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/77721/timeline", "performed_via_github_app": null, "state_reason": "completed"}