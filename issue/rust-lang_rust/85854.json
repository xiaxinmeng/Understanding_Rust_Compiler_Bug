{"url": "https://api.github.com/repos/rust-lang/rust/issues/85854", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/85854/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/85854/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/85854/events", "html_url": "https://github.com/rust-lang/rust/issues/85854", "id": 907456346, "node_id": "MDU6SXNzdWU5MDc0NTYzNDY=", "number": 85854, "title": "Input to a #[proc_macro_derive] sees underlying derives on the item", "user": {"login": "MihirLuthra", "id": 42952059, "node_id": "MDQ6VXNlcjQyOTUyMDU5", "avatar_url": "https://avatars.githubusercontent.com/u/42952059?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MihirLuthra", "html_url": "https://github.com/MihirLuthra", "followers_url": "https://api.github.com/users/MihirLuthra/followers", "following_url": "https://api.github.com/users/MihirLuthra/following{/other_user}", "gists_url": "https://api.github.com/users/MihirLuthra/gists{/gist_id}", "starred_url": "https://api.github.com/users/MihirLuthra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MihirLuthra/subscriptions", "organizations_url": "https://api.github.com/users/MihirLuthra/orgs", "repos_url": "https://api.github.com/users/MihirLuthra/repos", "events_url": "https://api.github.com/users/MihirLuthra/events{/privacy}", "received_events_url": "https://api.github.com/users/MihirLuthra/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 431251592, "node_id": "MDU6TGFiZWw0MzEyNTE1OTI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-docs", "name": "A-docs", "color": "f7e101", "default": false, "description": "Area: documentation for any part of the project, including the compiler, standard library, and tools"}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2021-05-31T13:07:37Z", "updated_at": "2021-06-17T01:12:30Z", "closed_at": "2021-06-17T01:12:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a regression report! \ud83d\udc1b A regression is something that changed between versions of Rust but was not supposed to.\r\n\r\nPlease provide a short summary of the regression, along with any information you feel is relevant to replicate it.\r\n-->\r\nInput to `#[proc_macro_derive]` is able to see underlying derive attributes. This is not supposed to happen as per the change in [version 1.17.0](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1170-2017-04-27). A [pull request was merged](https://github.com/rust-lang/rust/pull/39572) to remove this effect.\r\n\r\nBut [version 1.52.0](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1520-2021-05-06) onwards, underlying attributes are visible again to derive and this is **not** mentioned in [RELEASES.md](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1520-2021-05-06).\r\n\r\n### Code\r\n\r\nExample code is available here: https://github.com/MihirLuthra/derive_issue_example\r\n\r\nIn the following code below, `#[derive(Abc)]` generates a function named `print_all_attributes()` which prints all derive attributes visible to it.\r\n\r\n```rust\r\n// main.rs\r\n\r\nuse abc_derive::Abc;\r\n\r\n#[derive(Abc)]\r\n#[derive(Debug, PartialEq, Eq)]\r\nstruct Xyz;\r\n\r\nfn main() {\r\n    print_all_attributes();\r\n}\r\n```\r\n\r\n`#[derive(Abc)]` is defined as:\r\n\r\n```rust\r\nuse proc_macro::TokenStream;\r\nuse quote::quote;\r\nuse syn::{parse_macro_input, DeriveInput};\r\n\r\n#[proc_macro_derive(Abc)]\r\npub fn abc_derive(input: TokenStream) -> TokenStream {\r\n    let derive_input = parse_macro_input!(input as DeriveInput);\r\n\r\n    let attrs = &derive_input.attrs;\r\n\r\n    (quote! {\r\n        fn print_all_attributes() {\r\n            println!(\r\n                stringify!(#( #attrs )*)\r\n            );\r\n        }\r\n    })\r\n    .into()\r\n}\r\n```\r\n\r\n### Output on Version 1.51.0\r\n\r\nOuputs a blank line:\r\n```text\r\n\r\n```\r\n\r\n`rustc --version --verbose`:\r\n\r\n```text\r\nrustc 1.51.0 (2fd73fabe 2021-03-23)\r\nbinary: rustc\r\ncommit-hash: 2fd73fabe469357a12c2c974c140f67e7cdd76d0\r\ncommit-date: 2021-03-23\r\nhost: x86_64-apple-darwin\r\nrelease: 1.51.0\r\nLLVM version: 11.0.1\r\n```\r\n\r\n### Output on Version 1.52.1\r\n\r\n```text\r\n#[derive(Debug, PartialEq, Eq)]\r\n```\r\n\r\n`rustc --version --verbose`:\r\n\r\n```text\r\nrustc 1.52.1 (9bc8c42bb 2021-05-09)\r\nbinary: rustc\r\ncommit-hash: 9bc8c42bb2f19e745a63f3445f1ac248fb015e53\r\ncommit-date: 2021-05-09\r\nhost: x86_64-apple-darwin\r\nrelease: 1.52.1\r\nLLVM version: 12.0.0\r\n```", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/85854/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/85854/timeline", "performed_via_github_app": null, "state_reason": "completed"}