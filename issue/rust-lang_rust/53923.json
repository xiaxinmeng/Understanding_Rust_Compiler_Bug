{"url": "https://api.github.com/repos/rust-lang/rust/issues/53923", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/53923/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/53923/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/53923/events", "html_url": "https://github.com/rust-lang/rust/issues/53923", "id": 356470989, "node_id": "MDU6SXNzdWUzNTY0NzA5ODk=", "number": 53923, "title": "Type error refers to wrong type", "user": {"login": "Boscop", "id": 535593, "node_id": "MDQ6VXNlcjUzNTU5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/535593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Boscop", "html_url": "https://github.com/Boscop", "followers_url": "https://api.github.com/users/Boscop/followers", "following_url": "https://api.github.com/users/Boscop/following{/other_user}", "gists_url": "https://api.github.com/users/Boscop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Boscop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Boscop/subscriptions", "organizations_url": "https://api.github.com/users/Boscop/orgs", "repos_url": "https://api.github.com/users/Boscop/repos", "events_url": "https://api.github.com/users/Boscop/events{/privacy}", "received_events_url": "https://api.github.com/users/Boscop/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-03T11:39:49Z", "updated_at": "2018-09-04T10:29:03Z", "closed_at": "2018-09-04T10:29:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "I had this code:\r\n```rust\r\n    if let Some(mode) = self.active_automations.get(&p) {\r\n        for (i, &ap) in MAP_AUTOMATION.iter() {\r\n            use self::AutomationMode::*;\r\n            use self::AutomationParam::*;\r\n            let val = match (ap, mode) {\r\n                (ApInc, Inc(step)) => step,\r\n                _ => 0.,\r\n            };\r\n            device.set_encoder(i, val);\r\n        }\r\n    }\r\n```\r\n\r\nwhich caused this error:\r\n```\r\nerror[E0308]: match arms have incompatible types\r\n   --> src\\devices\\bcr\\mod.rs:530:16\r\n    |\r\n530 |                       let val = match (ap, mode) {\r\n    |  _______________________________^\r\n531 | |                         (ApInc, Inc(step)) => step,\r\n532 | |                         _ => 0.,\r\n    | |                              -- match arm with an incompatible type\r\n533 | |                     };\r\n    | |_____________________^ expected &f32, found floating-point variable\r\n    |\r\n    = note: expected type `&f32`\r\n               found type `{float}`\r\n```\r\n\r\nBut the actual error was that `mode` is a ref but should be a value, i.e. I should have written `&` before `mode` like:\r\n```rust\r\n    if let Some(&mode) = self.active_automations.get(&p) {\r\n```\r\n(or `let val = match (ap, *mode) {`).\r\n\r\nBtw, `ap` and `*mode` are both enum types, only `step` is a f32, so the error that `rustc` is showing is wrong here.", "closed_by": {"login": "Boscop", "id": 535593, "node_id": "MDQ6VXNlcjUzNTU5Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/535593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Boscop", "html_url": "https://github.com/Boscop", "followers_url": "https://api.github.com/users/Boscop/followers", "following_url": "https://api.github.com/users/Boscop/following{/other_user}", "gists_url": "https://api.github.com/users/Boscop/gists{/gist_id}", "starred_url": "https://api.github.com/users/Boscop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Boscop/subscriptions", "organizations_url": "https://api.github.com/users/Boscop/orgs", "repos_url": "https://api.github.com/users/Boscop/repos", "events_url": "https://api.github.com/users/Boscop/events{/privacy}", "received_events_url": "https://api.github.com/users/Boscop/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/53923/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/53923/timeline", "performed_via_github_app": null, "state_reason": "completed"}