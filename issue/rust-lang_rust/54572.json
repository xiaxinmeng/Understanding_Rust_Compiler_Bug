{"url": "https://api.github.com/repos/rust-lang/rust/issues/54572", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/54572/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/54572/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/54572/events", "html_url": "https://github.com/rust-lang/rust/issues/54572", "id": 363740318, "node_id": "MDU6SXNzdWUzNjM3NDAzMTg=", "number": 54572, "title": "\"approximate check\" for outlives relations can miss matches", "user": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 604489711, "node_id": "MDU6TGFiZWw2MDQ0ODk3MTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-NLL", "name": "A-NLL", "color": "f7e101", "default": false, "description": "Area: Non Lexical Lifetimes (NLL)"}, {"id": 867465703, "node_id": "MDU6TGFiZWw4Njc0NjU3MDM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/NLL-complete", "name": "NLL-complete", "color": "f799ea", "default": false, "description": "Working towards the \"valid code works\" goal"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-09-25T19:52:29Z", "updated_at": "2023-05-01T10:53:23Z", "closed_at": "2023-05-01T10:53:22Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Per [this comment](https://github.com/rust-lang/rust/pull/54453#issuecomment-424053852), the current system for handling outlives obligations relies on an \"approximate\" match for outlives relations that is actually kind of flawed in some edge cases, which can lead to us overconstraining inference:\r\n\r\n> It's not really meant to be conservative in \"two dimensions\". That is, `projection_approx_declared_bounds_from_env` ought to return anything that might **potentially** be useful. I suspect this is not presently true, though, around bound regions and a few other edge cases (e.g., I think we by and large ignore things like `for<'a> T::Proj<'a>: 'a`, which is really a bug, although a pre-existing one; we also are too conservative I think around equality of types like `for<'a> fn(&'a u32)` vs `for<'b> fn(&'b u32)`. Also a pre-existing bug.)\r\n>\r\n> I might be able to fix those cases where we are \"overly\" conservative though via a more thorough erasure. I think erasing regions today preserves the lifetime bounds, but we would ideally look for an \"equality\" check that just **completely** ignores region equality (even around binders). I was working towards that but never finished it. \r\n\r\nOriginally, I had intended to fix this by using the \"type relation\" code from the NLL type checker, but in a mode where it ignored all the outlives relations. I introduced the idea of an \"outlives delegate\" and so forth in preparation for that but then never took the last step, since \"erasing obligations\" seemed simpler and sufficient for the moment.", "closed_by": {"login": "aliemjay", "id": 28497461, "node_id": "MDQ6VXNlcjI4NDk3NDYx", "avatar_url": "https://avatars.githubusercontent.com/u/28497461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aliemjay", "html_url": "https://github.com/aliemjay", "followers_url": "https://api.github.com/users/aliemjay/followers", "following_url": "https://api.github.com/users/aliemjay/following{/other_user}", "gists_url": "https://api.github.com/users/aliemjay/gists{/gist_id}", "starred_url": "https://api.github.com/users/aliemjay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aliemjay/subscriptions", "organizations_url": "https://api.github.com/users/aliemjay/orgs", "repos_url": "https://api.github.com/users/aliemjay/repos", "events_url": "https://api.github.com/users/aliemjay/events{/privacy}", "received_events_url": "https://api.github.com/users/aliemjay/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/54572/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/54572/timeline", "performed_via_github_app": null, "state_reason": "completed"}