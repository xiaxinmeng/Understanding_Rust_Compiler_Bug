{"url": "https://api.github.com/repos/rust-lang/rust/issues/61182", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/61182/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/61182/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/61182/events", "html_url": "https://github.com/rust-lang/rust/issues/61182", "id": 448471318, "node_id": "MDU6SXNzdWU0NDg0NzEzMTg=", "number": 61182, "title": "bootstrap fails on powerpc64le-unknown-linux-musl (stage1 std rustc sigsegv for `alloc`)", "user": {"login": "q66", "id": 222373, "node_id": "MDQ6VXNlcjIyMjM3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/222373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/q66", "html_url": "https://github.com/q66", "followers_url": "https://api.github.com/users/q66/followers", "following_url": "https://api.github.com/users/q66/following{/other_user}", "gists_url": "https://api.github.com/users/q66/gists{/gist_id}", "starred_url": "https://api.github.com/users/q66/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/q66/subscriptions", "organizations_url": "https://api.github.com/users/q66/orgs", "repos_url": "https://api.github.com/users/q66/repos", "events_url": "https://api.github.com/users/q66/events{/privacy}", "received_events_url": "https://api.github.com/users/q66/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 515028847, "node_id": "MDU6TGFiZWw1MTUwMjg4NDc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-PowerPC", "name": "O-PowerPC", "color": "6e6ec0", "default": false, "description": "Target: PowerPC processors"}, {"id": 630662867, "node_id": "MDU6TGFiZWw2MzA2NjI4Njc=", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-musl", "name": "O-musl", "color": "6e6ec0", "default": false, "description": "Target: The musl libc"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-05-25T14:47:15Z", "updated_at": "2019-07-07T18:24:02Z", "closed_at": "2019-07-07T18:24:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "When trying to bootstrap natively on `powerpc64le-unknown-linux-musl`, rustc segfaults when compiling stage1 std artifacts:\r\n\r\n```\r\nBuilding stage1 std artifacts (powerpc64le-unknown-linux-musl -> powerpc64le-unknown-linux-musl)\r\nrunning: \"/builddir/rustc-1.35.0-src/prebuilt/bin/cargo\" \"build\" \"--target\" \"powerpc64le-unknown-linux-musl\" \"-j\" \"72\" \"--release\" \"--frozen\" \"--features\" \"panic-unwind backtrace\" \"--manifest-path\" \"/builddir/rustc-1.35.0-src/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\r\n   Compiling cc v1.0.28\r\n   Compiling core v0.0.0 (/builddir/rustc-1.35.0-src/src/libcore)\r\n   Compiling libc v0.2.51\r\n   Compiling unwind v0.0.0 (/builddir/rustc-1.35.0-src/src/libunwind)\r\n   Compiling compiler_builtins v0.1.9\r\n   Compiling backtrace-sys v0.1.27\r\n   Compiling std v0.0.0 (/builddir/rustc-1.35.0-src/src/libstd)\r\n   Compiling rustc-std-workspace-core v1.0.0 (/builddir/rustc-1.35.0-src/src/tools/rustc-std-workspace-core)\r\n   Compiling alloc v0.0.0 (/builddir/rustc-1.35.0-src/src/liballoc)\r\n   Compiling panic_abort v0.0.0 (/builddir/rustc-1.35.0-src/src/libpanic_abort)\r\n   Compiling rustc-demangle v0.1.10\r\nerror: Could not compile `alloc`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `/builddir/rustc-1.35.0-src/build/bootstrap/debug/rustc --edition=2018 --crate-name alloc src/liballoc/lib.rs --color never --error-format json --crate-type lib --emit=dep-info,link -C opt-level=2 -C metadata=f6536ad6454e1a0f -C extra-filename=-f6536ad6454e1a0f --out-dir /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/powerpc64le-unknown-linux-musl/release/deps --target powerpc64le-unknown-linux-musl -L dependency=/builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/powerpc64le-unknown-linux-musl/release/deps -L dependency=/builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/release/deps --extern compiler_builtins=/builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/powerpc64le-unknown-linux-musl/release/deps/libcompiler_builtins-7fc2bd91898850dc.rlib --extern core=/builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/powerpc64le-unknown-linux-musl/release/deps/libcore-821d71ff6e8bc869.rlib -C linker=cc -L native=/builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1-std/powerpc64le-unknown-linux-musl/release/build/compiler_builtins-4678d9d6beb9ca77/out` (signal: 11, SIGSEGV: invalid memory reference)\r\ncommand did not execute successfully: \"/builddir/rustc-1.35.0-src/prebuilt/bin/cargo\" \"build\" \"--target\" \"powerpc64le-unknown-linux-musl\" \"-j\" \"72\" \"--release\" \"--frozen\" \"--features\" \"panic-unwind backtrace\" \"--manifest-path\" \"/builddir/rustc-1.35.0-src/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\r\nexpected success, got: exit code: 101\r\nTraceback (most recent call last):\r\n  File \"/builddir/rustc-1.35.0-src/src/bootstrap/bootstrap.py\", line 859, in <module>\r\n    main()\r\n  File \"/builddir/rustc-1.35.0-src/src/bootstrap/bootstrap.py\", line 842, in main\r\n    bootstrap(help_triggered)\r\n  File \"/builddir/rustc-1.35.0-src/src/bootstrap/bootstrap.py\", line 828, in bootstrap\r\n    run(args, env=env, verbose=build.verbose)\r\n  File \"/builddir/rustc-1.35.0-src/src/bootstrap/bootstrap.py\", line 141, in run\r\n    raise RuntimeError(err)\r\nRuntimeError: failed to run: /builddir/rustc-1.35.0-src/build/bootstrap/debug/bootstrap dist -v\r\nmake: *** [Makefile:60: dist] Error 1\r\n```\r\n\r\nEnabling debuginfo and getting a coredump reveals this backtrace:\r\n\r\n```\r\n#0  0x0000000000000000 in ?? ()\r\n#1  0x000070d4b46793a0 in syntax_pos::<impl core::fmt::Debug for syntax_pos::span_encoding::Span>::fmt () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/libsyntax_pos-d7af1be421a84ca1.so\r\n#2  0x000070d4b6ce30d4 in core::fmt::write (output=..., args=...) at src/libcore/fmt/mod.rs:1016\r\n#3  0x000070d4b526d0b8 in rustc::ty::print::pretty::PrettyPrinter::pretty_print_type () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc-c34e8f271e128c49.so\r\n#4  0x000070d4b54bdab4 in rustc::ty::print::pretty::<impl core::fmt::Display for &rustc::ty::TyS>::fmt () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc-c34e8f271e128c49.so\r\n#5  0x000070d4b6ce30d4 in core::fmt::write (output=..., args=...) at src/libcore/fmt/mod.rs:1016\r\n#6  0x000070d4b6cb99e0 in core::fmt::Write::write_fmt (self=0xe20320709e0, args=...) at /builddir/rustc-1.35.0-src/src/libcore/fmt/mod.rs:195\r\n#7  alloc::fmt::format (args=...) at src/liballoc/fmt.rs:563\r\n#8  0x000070d4b43c306c in rustc_lint::builtin::BoxPointers::check_heap_type () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#9  0x000070d4b43ecdb8 in <rustc_lint::BuiltinCombinedModuleLateLintPass as rustc::lint::LateLintPass>::check_expr () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#10 0x000070d4b43f952c in rustc::hir::intravisit::walk_expr () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#11 0x000070d4b43ef8b0 in rustc::hir::intravisit::walk_block () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#12 0x000070d4b43a1028 in <rustc::lint::context::LateContextAndPass<T> as rustc::hir::intravisit::Visitor>::visit_nested_body ()\r\n   from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#13 0x000070d4b43a1c58 in <rustc::lint::context::LateContextAndPass<T> as rustc::hir::intravisit::Visitor>::visit_fn () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#14 0x000070d4b43f197c in rustc::hir::intravisit::walk_impl_item () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#15 0x000070d4b43a7974 in rustc::hir::intravisit::Visitor::visit_nested_impl_item () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#16 0x000070d4b43fc428 in rustc::hir::intravisit::walk_item () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#17 0x000070d4b43a6e84 in rustc::hir::intravisit::Visitor::visit_nested_item () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#18 0x000070d4b43a8cd0 in rustc::lint::context::late_lint_mod () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_lint-ec9b804da742764c.so\r\n#19 0x000070d4b6b0c448 in rustc::ty::query::__query_compute::lint_mod () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#20 0x000070d4b6a2280c in rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::lint_mod>::compute ()\r\n   from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#21 0x000070d4b6a1bb9c in rustc::dep_graph::graph::DepGraph::with_task_impl () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#22 0x000070d4b6a2a5d0 in rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#23 0x000070d4b6a0f594 in rustc::lint::context::check_crate::{{closure}}::{{closure}} () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#24 0x000070d4b6a0073c in rustc_data_structures::sync::serial_join () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#25 0x000070d4b6a13458 in rustc::util::common::time () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#26 0x000070d4b6ca7de4 in __rust_maybe_catch_panic (f=<optimized out>, data=<optimized out>, data_ptr=0x70d4b33c39f8, vtable_ptr=0x70d4b33c3a00) at src/libpanic_unwind/lib.rs:87\r\n#27 0x000070d4b69d1314 in <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#28 0x000070d4b6ca7de4 in __rust_maybe_catch_panic (f=<optimized out>, data=<optimized out>, data_ptr=0x70d4b33c3ae0, vtable_ptr=0x70d4b33c3ae8) at src/libpanic_unwind/lib.rs:87\r\n#29 0x000070d4b6a200d0 in rustc_interface::passes::analysis::{{closure}} () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#30 0x000070d4b6a13eb8 in rustc::util::common::time () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#31 0x000070d4b6a7ae10 in rustc_interface::passes::analysis () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#32 0x000070d4b6db7574 in rustc::ty::query::__query_compute::analysis () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#33 0x000070d4b6e1bd58 in rustc::ty::query::<impl rustc::ty::query::config::QueryAccessors for rustc::ty::query::queries::analysis>::compute ()\r\n   from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#34 0x000070d4b6de7394 in rustc::dep_graph::graph::DepGraph::with_task_impl () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#35 0x000070d4b6e1cb50 in rustc::ty::query::plumbing::<impl rustc::ty::context::TyCtxt>::get_query () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#36 0x000070d4b6dc7954 in rustc_interface::passes::BoxedGlobalCtxt::access::{{closure}} () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#37 0x000070d4b6adbc60 in rustc_interface::passes::create_global_ctxt::{{closure}} () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_interface-5183811d86ee957c.so\r\n#38 0x000070d4b6dcad78 in rustc_interface::interface::run_compiler_in_existing_thread_pool () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#39 0x000070d4b6da7888 in std::thread::local::LocalKey<T>::with () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#40 0x000070d4b6e29858 in scoped_tls::ScopedKey<T>::set () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#41 0x000070d4b6e6a0d4 in syntax::with_globals () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#42 0x000070d4b6dcbb64 in std::sys_common::backtrace::__rust_begin_short_backtrace () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#43 0x000070d4b6ca7de4 in __rust_maybe_catch_panic (f=<optimized out>, data=<optimized out>, data_ptr=0x70d4b33ce500, vtable_ptr=0x70d4b33ce508) at src/libpanic_unwind/lib.rs:87\r\n#44 0x000070d4b6dcd084 in core::ops::function::FnOnce::call_once{{vtable-shim}} () from /builddir/rustc-1.35.0-src/build/powerpc64le-unknown-linux-musl/stage1/lib/librustc_driver-64f3f0b358d083de.so\r\n#45 0x000070d4b6c8dab8 in <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once (self=..., args=<optimized out>) at /builddir/rustc-1.35.0-src/src/liballoc/boxed.rs:702\r\n#46 0x000070d4b6c9ee90 in <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once (self=<optimized out>, args=<optimized out>) at /builddir/rustc-1.35.0-src/src/liballoc/boxed.rs:702\r\n#47 std::sys_common::thread::start_thread (main=0x70d4b700e8c0 \"\\200\", <incomplete sequence \\350>) at src/libstd/sys_common/thread.rs:14\r\n#48 0x000070d4b6ca6848 in std::sys::unix::thread::Thread::new::thread_start (main=<optimized out>) at src/libstd/sys/unix/thread.rs:80\r\n#49 0x000070d4b6fa40f8 in start (p=0x70d4b33ce6b0) at src/thread/pthread_create.c:144\r\n#50 0x000070d4b6fb697c in __clone () at src/thread/powerpc64/clone.s:44\r\n```\r\n\r\nCross-compiling for the target works okay (from `powerpc64le-unknown-linux-gnu`).", "closed_by": {"login": "q66", "id": 222373, "node_id": "MDQ6VXNlcjIyMjM3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/222373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/q66", "html_url": "https://github.com/q66", "followers_url": "https://api.github.com/users/q66/followers", "following_url": "https://api.github.com/users/q66/following{/other_user}", "gists_url": "https://api.github.com/users/q66/gists{/gist_id}", "starred_url": "https://api.github.com/users/q66/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/q66/subscriptions", "organizations_url": "https://api.github.com/users/q66/orgs", "repos_url": "https://api.github.com/users/q66/repos", "events_url": "https://api.github.com/users/q66/events{/privacy}", "received_events_url": "https://api.github.com/users/q66/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/61182/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/61182/timeline", "performed_via_github_app": null, "state_reason": "completed"}