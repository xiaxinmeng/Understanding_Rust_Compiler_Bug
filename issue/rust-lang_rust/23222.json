{"url": "https://api.github.com/repos/rust-lang/rust/issues/23222", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/23222/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/23222/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/23222/events", "html_url": "https://github.com/rust-lang/rust/issues/23222", "id": 60342575, "node_id": "MDU6SXNzdWU2MDM0MjU3NQ==", "number": 23222, "title": "element drop order inconsistent between in-progress versus completed arrays", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 211668019, "node_id": "MDU6TGFiZWwyMTE2NjgwMTk=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-lang", "name": "T-lang", "color": "bfd4f2", "default": false, "description": "Relevant to the language team, which will review and decide on the PR/issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2015-03-09T13:27:47Z", "updated_at": "2017-03-24T19:19:37Z", "closed_at": "2017-02-15T12:40:13Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "This code:\n\n``` rust\nuse std::thread;\n\nstruct D(u32);\n\nimpl Drop for D {\n    fn drop(&mut self) {\n        println!(\"Dropping {}\", self.0);\n    }\n}\n\nfn main() {\n    fn die() -> D { panic!(\"Oh no\"); }\n    let g = thread::spawn(|| {\n        let _a: [D; 3]      = [D(101), D(102), D(103)];\n        let _d: [D; 4]      = [D(401), D(402), die(), D(404)];\n    });\n    assert!(g.join().is_err());\n}\n```\n\nprints \n\n```\nDropping 402\nDropping 401\nDropping 101\nDropping 102\nDropping 103\n```\n\ni.e. when the panic occurs, we do the dropping in reverse order for the array being built, but then we do the drop in \"declaration order\" for the array that was fully constructed.\n\nSee also https://github.com/rust-lang/rfcs/issues/744 and rust-lang/rust#16493\n", "closed_by": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/23222/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/23222/timeline", "performed_via_github_app": null, "state_reason": "completed"}