{"url": "https://api.github.com/repos/rust-lang/rust/issues/68420", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/68420/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/68420/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/68420/events", "html_url": "https://github.com/rust-lang/rust/issues/68420", "id": 553017667, "node_id": "MDU6SXNzdWU1NTMwMTc2Njc=", "number": 68420, "title": "transparent enum diagnostic should suppress field count when >1 variant", "user": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 234902, "node_id": "MDU6TGFiZWwyMzQ5MDI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-enhancement", "name": "C-enhancement", "color": "f5f1fd", "default": false, "description": "Category: An issue proposing an enhancement or a PR with one."}, {"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1659943986, "node_id": "MDU6TGFiZWwxNjU5OTQzOTg2", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-verbose", "name": "D-verbose", "color": "c9f7a3", "default": false, "description": "Too much output caused by a single piece of incorrect code"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-21T17:18:15Z", "updated_at": "2022-12-28T13:07:09Z", "closed_at": "2022-12-28T13:07:09Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Consider this code:\r\n\r\n```rust\r\n#![feature(transparent_enums)]\r\n\r\nuse std::mem::size_of;\r\n\r\nfn main() {\r\n    #[repr(transparent)]\r\n    enum VisibleE8 {\r\n        A(u8), B(u8), C(u8), D(u8), E(u8), F(u8), G(u8), H(u8), I(u8), J(u8),\r\n        K(u8), L(u8), M(u8), N(u8), O(u8), P(u8), Q(u8), R(u8), S(u8), T(u8),\r\n    }\r\n\r\n    println!(\"VisibleE8: {}\", size_of::<VisibleE8>());\r\n}\r\n```\r\n\r\nWhen you try to compile this, you get two error diagnostics:\r\n\r\n```\r\nerror[E0731]: transparent enum needs exactly one variant, but has 20\r\n --> src/main.rs:7:5\r\n  |\r\n7 |     enum VisibleE8 {\r\n  |     ^^^^^^^^^^^^^^ needs exactly one variant, but has 20\r\n8 |         A(u8), B(u8), C(u8), D(u8), E(u8), F(u8), G(u8), H(u8), I(u8), J(u8),\r\n  |         -----  -----  -----  -----  -----  -----  -----  -----  -----  -----\r\n9 |         K(u8), L(u8), M(u8), N(u8), O(u8), P(u8), Q(u8), R(u8), S(u8), T(u8),\r\n  |         -----  -----  -----  -----  -----  -----  -----  -----  -----  ----- too many variants in `main::VisibleE8`\r\n\r\nerror[E0690]: the variant of a transparent enum needs exactly one non-zero-sized field, but has 20\r\n --> src/main.rs:7:5\r\n  |\r\n7 |     enum VisibleE8 {\r\n  |     ^^^^^^^^^^^^^^ needs exactly one non-zero-sized field, but has 20\r\n8 |         A(u8), B(u8), C(u8), D(u8), E(u8), F(u8), G(u8), H(u8), I(u8), J(u8),\r\n  |           --     --     --     --     --     --     --     --     --     -- this field is non-zero-sized\r\n  |           |      |      |      |      |      |      |      |      |\r\n  |           |      |      |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      this field is non-zero-sized\r\n  |           |      |      this field is non-zero-sized\r\n  |           |      this field is non-zero-sized\r\n  |           this field is non-zero-sized\r\n9 |         K(u8), L(u8), M(u8), N(u8), O(u8), P(u8), Q(u8), R(u8), S(u8), T(u8),\r\n  |           --     --     --     --     --     --     --     --     --     -- this field is non-zero-sized\r\n  |           |      |      |      |      |      |      |      |      |\r\n  |           |      |      |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      |      this field is non-zero-sized\r\n  |           |      |      |      this field is non-zero-sized\r\n  |           |      |      this field is non-zero-sized\r\n  |           |      this field is non-zero-sized\r\n  |           this field is non-zero-sized\r\n\r\nerror: aborting due to 2 previous errors\r\n```\r\n\r\n\r\nThe first diagnostic is exactly describing the problem.\r\n\r\nThe second diagnostic is irrelevant, and arguably confusing (at least in my mental model of enums, the field count of one variant should be considered independently of the counts for all of the enum's other variants).", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/68420/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/68420/timeline", "performed_via_github_app": null, "state_reason": "completed"}