{"url": "https://api.github.com/repos/rust-lang/rust/issues/59864", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/59864/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/59864/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/59864/events", "html_url": "https://github.com/rust-lang/rust/issues/59864", "id": 431776619, "node_id": "MDU6SXNzdWU0MzE3NzY2MTk=", "number": 59864, "title": "x.py's naming of stages is confusing", "user": {"login": "nnethercote", "id": 1940286, "node_id": "MDQ6VXNlcjE5NDAyODY=", "avatar_url": "https://avatars.githubusercontent.com/u/1940286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nnethercote", "html_url": "https://github.com/nnethercote", "followers_url": "https://api.github.com/users/nnethercote/followers", "following_url": "https://api.github.com/users/nnethercote/following{/other_user}", "gists_url": "https://api.github.com/users/nnethercote/gists{/gist_id}", "starred_url": "https://api.github.com/users/nnethercote/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nnethercote/subscriptions", "organizations_url": "https://api.github.com/users/nnethercote/orgs", "repos_url": "https://api.github.com/users/nnethercote/repos", "events_url": "https://api.github.com/users/nnethercote/events{/privacy}", "received_events_url": "https://api.github.com/users/nnethercote/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 325438536, "node_id": "MDU6TGFiZWwzMjU0Mzg1MzY=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-bootstrap", "name": "T-bootstrap", "color": "bfd4f2", "default": false, "description": "Relevant to the bootstrap subteam: Rust's build system (x.py and src/bootstrap)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 26, "created_at": "2019-04-11T00:23:01Z", "updated_at": "2023-02-03T06:59:37Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Rust has the standard multi-stage structure that all bootstrapping compilers have.\r\n\r\nA newcomer who knows about compiler stages will be confident with this, until they run a command like `./x.py build --stage 1` and get output like this:\r\n```\r\nBuilding stage0 std artifacts \r\n    ...\r\nCopying stage0 std from stage0\r\nBuilding stage0 test artifacts \r\n    ...\r\nCopying stage0 test from stage0\r\nBuilding stage0 compiler artifacts \r\n    ...\r\nCopying stage0 rustc from stage0\r\nBuilding stage0 codegen artifacts \r\n    ...\r\nAssembling stage1 compiler \r\nBuilding stage1 std artifacts \r\n    ...\r\nCopying stage1 std from stage1\r\nBuilding stage1 test artifacts \r\n    ...\r\nCopying stage1 test from stage1\r\nBuilding stage1 compiler artifacts \r\n    ...\r\nCopying stage1 rustc from stage1\r\nBuilding stage1 codegen artifacts \r\n    ...\r\nBuilding rustdoc for stage1 \r\n    ...\r\n```\r\nFor a newcomer, this is completely bizarre.\r\n- Why is it building stage 0? Isn't stage 0 the compiler you download?\r\n- How does it assemble the stage 1 compiler before building the stage 1 artifacts?\r\n- Why is it building two stages? Shouldn't it only build one stage?\r\n\r\nThe key to understanding this is that `x.py` uses a surprising naming convention:\r\n- A \"stage N artifact\" is an artifact that is *produced* by the stage N compiler.\r\n- The \"stage (N+1) compiler\" is assembled from \"stage N artifacts\".\r\n- A `--stage N` flag means build *with* stage N.\r\n\r\nSomebody had to explain this to me when I started working on Rust. I have since had to explain it to multiple newcomers. Even though I understand it now, I still find it very confusing, and I have to think carefully about it all.\r\n\r\nHere's a naming convention that makes more sense to me:\r\n- A \"stage N artifact\" is an artifact that is produced by the stage (N-1) compiler.\r\n- The \"stage N compiler\" is assembled from \"stage N artifacts\".\r\n- A `--stage N` flag means build stage N, using stage (N-1).\r\n\r\nThat way, a command like `./x.py build --stage 1` would produce output like this:\r\n```\r\nBuilding stage1 std artifacts \r\n    ...\r\nCopying stage1 std from stage1\r\nBuilding stage1 test artifacts \r\n    ...\r\nCopying stage1 test from stage1\r\nBuilding stage1 compiler artifacts \r\n    ...\r\nCopying stage1 rustc from stage1\r\nBuilding stage1 codegen artifacts \r\n    ...\r\nAssembling stage1 compiler \r\n```\r\nIs there any appetite for this change? I realize it would be invasive and people would have to update their aliases, build scripts, etc. But it might be worthwhile to avoid the ongoing confusion to both newcomers and experienced contributors. Deprecating the word \"stage\" in favour of  \"phase\" could help with the transition.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/59864/reactions", "total_count": 22, "+1": 21, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/59864/timeline", "performed_via_github_app": null, "state_reason": null}