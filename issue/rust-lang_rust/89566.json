{"url": "https://api.github.com/repos/rust-lang/rust/issues/89566", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/89566/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/89566/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/89566/events", "html_url": "https://github.com/rust-lang/rust/issues/89566", "id": 1016606415, "node_id": "I_kwDOAAsO6M48mC7P", "number": 89566, "title": "Diagnostics: improve error message for incorrect inner attribute", "user": {"login": "ogham", "id": 503760, "node_id": "MDQ6VXNlcjUwMzc2MA==", "avatar_url": "https://avatars.githubusercontent.com/u/503760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ogham", "html_url": "https://github.com/ogham", "followers_url": "https://api.github.com/users/ogham/followers", "following_url": "https://api.github.com/users/ogham/following{/other_user}", "gists_url": "https://api.github.com/users/ogham/gists{/gist_id}", "starred_url": "https://api.github.com/users/ogham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ogham/subscriptions", "organizations_url": "https://api.github.com/users/ogham/orgs", "repos_url": "https://api.github.com/users/ogham/repos", "events_url": "https://api.github.com/users/ogham/events{/privacy}", "received_events_url": "https://api.github.com/users/ogham/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235791, "node_id": "MDU6TGFiZWwyMzU3OTE=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-diagnostics", "name": "A-diagnostics", "color": "f7e101", "default": false, "description": "Area: Messages for errors, warnings, and lints"}, {"id": 132910982, "node_id": "MDU6TGFiZWwxMzI5MTA5ODI=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-macros", "name": "A-macros", "color": "f7e101", "default": false, "description": "Area: All kinds of macros (custom derive, macro_rules!, proc macros, ..)"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 1596121013, "node_id": "MDU6TGFiZWwxNTk2MTIxMDEz", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-confusing", "name": "D-confusing", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error that should be reworked"}, {"id": 1596122811, "node_id": "MDU6TGFiZWwxNTk2MTIyODEx", "url": "https://api.github.com/repos/rust-lang/rust/labels/D-newcomer-roadblock", "name": "D-newcomer-roadblock", "color": "c9f7a3", "default": false, "description": "Confusing diagnostic error hard to understand for new users"}], "state": "open", "locked": false, "assignee": {"login": "tom7980", "id": 8884102, "node_id": "MDQ6VXNlcjg4ODQxMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8884102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tom7980", "html_url": "https://github.com/tom7980", "followers_url": "https://api.github.com/users/tom7980/followers", "following_url": "https://api.github.com/users/tom7980/following{/other_user}", "gists_url": "https://api.github.com/users/tom7980/gists{/gist_id}", "starred_url": "https://api.github.com/users/tom7980/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tom7980/subscriptions", "organizations_url": "https://api.github.com/users/tom7980/orgs", "repos_url": "https://api.github.com/users/tom7980/repos", "events_url": "https://api.github.com/users/tom7980/events{/privacy}", "received_events_url": "https://api.github.com/users/tom7980/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "tom7980", "id": 8884102, "node_id": "MDQ6VXNlcjg4ODQxMDI=", "avatar_url": "https://avatars.githubusercontent.com/u/8884102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tom7980", "html_url": "https://github.com/tom7980", "followers_url": "https://api.github.com/users/tom7980/followers", "following_url": "https://api.github.com/users/tom7980/following{/other_user}", "gists_url": "https://api.github.com/users/tom7980/gists{/gist_id}", "starred_url": "https://api.github.com/users/tom7980/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tom7980/subscriptions", "organizations_url": "https://api.github.com/users/tom7980/orgs", "repos_url": "https://api.github.com/users/tom7980/repos", "events_url": "https://api.github.com/users/tom7980/events{/privacy}", "received_events_url": "https://api.github.com/users/tom7980/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2021-10-05T17:43:14Z", "updated_at": "2021-10-07T22:58:17Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was assisting someone new to Rust and they were confused by an error message. This is the complete file of code they had written:\r\n\r\n```rust\r\n#![derive(Debug)]\r\nstruct Test {\r\n    s: String,\r\n}\r\n\r\nfn main() {\r\n}\r\n```\r\n\r\nUsing rustc 1.55.0 (c8dfcfe04 2021-09-06) and rustc 1.57.0-nightly (f03eb6bef 2021-10-02), the compiler outputs the following error ([playground link](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=148060b0318329961ad9ec4d1e7af0b4)):\r\n\r\n```\r\nerror: cannot determine resolution for the attribute macro `derive`\r\n --> src/main.rs:1:4\r\n  |\r\n1 | #![derive(Debug)]\r\n  |    ^^^^^^\r\n  |\r\n  = note: import resolution is stuck, try simplifying macro imports\r\n```\r\n\r\nThe fix is to use `#[derive]`, an outer attribute, rather than `#![derive]`, an inner attribute, but the compiler's error does not make that clear. And its suggestion to simplify macro imports doesn't help, as from the user's perspective, nothing is being imported in this source file!\r\n\r\nI think a more specific error message that checks whether the inner attribute's name would fit as an outer attribute would be helpful here. A suggestion to remove the `!` would be even better. Annoyingly, having `#!` at the start of the file looked correct as it resembles a shebang.\r\n\r\nNote that there _is_ a good error for using `#![]` instead of `#[]` in the general case. It even mentions the difference between inner and outer attributes in its message. It was just bad luck that this particular struct happened to be at the very start of the source file, so that error was not displayed.\r\n\r\nI also spotted that in issue #67107, which has a _very_ similar piece of example code, the compiler used to provide a suggestion to \"try an outer attribute\". But, running that example on the latest stable and nightly, it looks like that suggestion is not being produced anymore.\r\n\n\n<!-- TRIAGEBOT_START -->\n\n<!-- TRIAGEBOT_ASSIGN_START -->\n\n<!-- TRIAGEBOT_ASSIGN_DATA_START$${\"user\":\"tom7980\"}$$TRIAGEBOT_ASSIGN_DATA_END -->\n\n<!-- TRIAGEBOT_ASSIGN_END -->\n<!-- TRIAGEBOT_END -->", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/89566/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/89566/timeline", "performed_via_github_app": null, "state_reason": null}