{"url": "https://api.github.com/repos/rust-lang/rust/issues/103949", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/103949/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/103949/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/103949/events", "html_url": "https://github.com/rust-lang/rust/issues/103949", "id": 1435478976, "node_id": "I_kwDOAAsO6M5Vj6vA", "number": 103949, "title": "riscv32imac-unknown-xous-elf: `rust-lld` gives `offset is outside the section` errors", "user": {"login": "xobs", "id": 238325, "node_id": "MDQ6VXNlcjIzODMyNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/238325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xobs", "html_url": "https://github.com/xobs", "followers_url": "https://api.github.com/users/xobs/followers", "following_url": "https://api.github.com/users/xobs/following{/other_user}", "gists_url": "https://api.github.com/users/xobs/gists{/gist_id}", "starred_url": "https://api.github.com/users/xobs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xobs/subscriptions", "organizations_url": "https://api.github.com/users/xobs/orgs", "repos_url": "https://api.github.com/users/xobs/repos", "events_url": "https://api.github.com/users/xobs/events{/privacy}", "received_events_url": "https://api.github.com/users/xobs/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 108333, "node_id": "MDU6TGFiZWwxMDgzMzM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/A-LLVM", "name": "A-LLVM", "color": "f7e101", "default": false, "description": "Area: Code generation parts specific to LLVM. Both correctness bugs and optimization-related issues."}, {"id": 60329014, "node_id": "MDU6TGFiZWw2MDMyOTAxNA==", "url": "https://api.github.com/repos/rust-lang/rust/labels/P-low", "name": "P-low", "color": "eb6420", "default": false, "description": "Low priority"}, {"id": 211668100, "node_id": "MDU6TGFiZWwyMTE2NjgxMDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/T-compiler", "name": "T-compiler", "color": "bfd4f2", "default": false, "description": "Relevant to the compiler team, which will review and decide on the PR/issue."}, {"id": 262252840, "node_id": "MDU6TGFiZWwyNjIyNTI4NDA=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-stable", "name": "regression-from-stable-to-stable", "color": "e4008a", "default": false, "description": "Performance or correctness regression from one stable version to another."}, {"id": 650731663, "node_id": "MDU6TGFiZWw2NTA3MzE2NjM=", "url": "https://api.github.com/repos/rust-lang/rust/labels/C-bug", "name": "C-bug", "color": "f5f1fd", "default": false, "description": "Category: This is a bug."}, {"id": 5199227096, "node_id": "LA_kwDOAAsO6M8AAAABNeXo2A", "url": "https://api.github.com/repos/rust-lang/rust/labels/O-xous", "name": "O-xous", "color": "6e6ec0", "default": false, "description": "OS: A microkernel OS for privacy in computing"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2022-11-04T03:04:30Z", "updated_at": "2023-04-05T17:34:05Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "### Version it worked on\r\n\r\nIt most recently worked on: Rust 1.64.0\r\n\r\n### Version with regression\r\n\r\n<!--\r\nProvide the version you are using that has the regression.\r\n-->\r\n\r\n`rustc --version --verbose`:\r\n```\r\nrustc 1.65.0 (897e37553 2022-11-02)\r\nbinary: rustc\r\ncommit-hash: 897e37553bba8b42751c67658967889d11ecd120\r\ncommit-date: 2022-11-02\r\nhost: x86_64-pc-windows-msvc\r\nrelease: 1.65.0\r\nLLVM version: 15.0.0\r\n```\r\n\r\n### Description\r\n\r\nBuilding crates for the `riscv32imac-unknown-xous-elf` target sometimes results in a link error. This began with Rust 1.65.0. For example:\r\n\r\n```\r\nerror: linking with `rust-lld` failed: exit code: 1\r\n  |\r\n  = note: \"rust-lld\" \"-flavor\" \"gnu\" \"C:\\\\Users\\\\Sean\\\\AppData\\\\Local\\\\Temp\\\\rustcR77RGd\\\\symbols.o\" \"E:\\\\Code\\\\Xous\\\\Core\\\\target\\\\riscv32imac-unknown-xous-elf\\\\release\\\\deps\\\\pddb-8aba67b084ba8fc1.pddb-b3f235aec8c95441.n927u1iqdxcieg4.rcgu.o.rcgu.o\" \"--as-needed\" \"-L\" \"E:\\\\Code\\\\Xous\\\\Core\\\\target\\\\riscv32imac-unknown-xous-elf\\\\release\\\\deps\" \"-L\" \"E:\\\\Code\\\\Xous\\\\Core\\\\target\\\\release\\\\deps\" \"-L\" \"E:\\\\Code\\\\Xous\\\\Core\\\\target\\\\riscv32imac-unknown-xous-elf\\\\release\\\\build\\\\xous-08f083a692e5c29b\\\\out\" \"-L\" \"C:\\\\Users\\\\Sean\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\riscv32imac-unknown-xous-elf\\\\lib\" \"-Bstatic\" \"C:\\\\Users\\\\Sean\\\\AppData\\\\Local\\\\Temp\\\\rustcR77RGd\\\\libxous-26655dcc7bb206b6.rlib\" \"C:\\\\Users\\\\Sean\\\\AppData\\\\Local\\\\Temp\\\\rustcR77RGd\\\\libxous-d175a8531300a7f7.rlib\" \"C:\\\\Users\\\\Sean\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\riscv32imac-unknown-xous-elf\\\\lib\\\\libcompiler_builtins-67716ddc427f4546.rlib\" \"-Bdynamic\" \"--eh-frame-hdr\" \"-znoexecstack\" \"-L\" \"C:\\\\Users\\\\Sean\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\riscv32imac-unknown-xous-elf\\\\lib\" \"-o\" \"E:\\\\Code\\\\Xous\\\\Core\\\\target\\\\riscv32imac-unknown-xous-elf\\\\release\\\\deps\\\\pddb-8aba67b084ba8fc1\" \"--gc-sections\" \"-O1\"\r\n  = note: rust-lld: error: E:\\Code\\Xous\\Core\\target\\riscv32imac-unknown-xous-elf\\release\\deps\\pddb-8aba67b084ba8fc1.pddb-b3f235aec8c95441.n927u1iqdxcieg4.rcgu.o.rcgu.o:(.rodata.cst32): offset is outside the section\r\n\r\n\r\nerror: could not compile `pddb` due to previous error\r\n```\r\n\r\n### Background\r\n\r\nWe build a custom libstd for the `riscv32imac-unknown-xous-elf` target, which is a Tier-3 target. This repository is at https://github.com/betrusted-io/rust. We are working on preparing patches for upstream that do not add any external dependencies, but this work is taking time. As a result, we generally forward-port our patchset every six weeks once the stable build is released.\r\n\r\nWhen building packages for the Betrusted platform, our build system compiles around 27 packages. Many of these packages succeed, but with Rust 1.65.0 we have three packages fail.\r\n\r\nThis target does not have a linker script, and instead relies on the default one provided by `rust-lld`.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/103949/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/103949/timeline", "performed_via_github_app": null, "state_reason": null}