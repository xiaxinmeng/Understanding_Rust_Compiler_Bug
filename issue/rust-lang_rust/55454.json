{"url": "https://api.github.com/repos/rust-lang/rust/issues/55454", "repository_url": "https://api.github.com/repos/rust-lang/rust", "labels_url": "https://api.github.com/repos/rust-lang/rust/issues/55454/labels{/name}", "comments_url": "https://api.github.com/repos/rust-lang/rust/issues/55454/comments", "events_url": "https://api.github.com/repos/rust-lang/rust/issues/55454/events", "html_url": "https://github.com/rust-lang/rust/issues/55454", "id": 374799108, "node_id": "MDU6SXNzdWUzNzQ3OTkxMDg=", "number": 55454, "title": "Mir undefined behaviour false positive when comparing Option<&T>", "user": {"login": "jesskfullwood", "id": 38404589, "node_id": "MDQ6VXNlcjM4NDA0NTg5", "avatar_url": "https://avatars.githubusercontent.com/u/38404589?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jesskfullwood", "html_url": "https://github.com/jesskfullwood", "followers_url": "https://api.github.com/users/jesskfullwood/followers", "following_url": "https://api.github.com/users/jesskfullwood/following{/other_user}", "gists_url": "https://api.github.com/users/jesskfullwood/gists{/gist_id}", "starred_url": "https://api.github.com/users/jesskfullwood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jesskfullwood/subscriptions", "organizations_url": "https://api.github.com/users/jesskfullwood/orgs", "repos_url": "https://api.github.com/users/jesskfullwood/repos", "events_url": "https://api.github.com/users/jesskfullwood/events{/privacy}", "received_events_url": "https://api.github.com/users/jesskfullwood/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 147085028, "node_id": "MDU6TGFiZWwxNDcwODUwMjg=", "url": "https://api.github.com/repos/rust-lang/rust/labels/regression-from-stable-to-nightly", "name": "regression-from-stable-to-nightly", "color": "e4008a", "default": false, "description": "Performance or correctness regression from stable to nightly."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2018-10-28T21:13:37Z", "updated_at": "2018-10-30T14:20:17Z", "closed_at": "2018-10-30T14:20:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "I discovered this bug while tinkering with the [frunk](https://github.com/lloydmeta/frunk) crate.\r\n```rust\r\n#[derive(PartialEq, Debug)]\r\nstruct Cons<H, T: Hlist> {\r\n    head: H,\r\n    tail: T\r\n}\r\n\r\n#[derive(PartialEq, Debug)]\r\nstruct Nil;\r\n\r\ntrait Hlist {}\r\nimpl<H, T: Hlist> Hlist for Cons<H, T> {}\r\nimpl Hlist for Nil {}\r\n\r\nfn main() {\r\n\r\n    // This part works fine\r\n    let x = Cons {head: Some(&0), tail: Nil};\r\n    let y = Cons {head: Some(&0), tail: Nil};\r\n    assert_eq!(x, y);\r\n\r\n    // This apparently-equivalent code fails to compile (passes cargo-check but not cargo-build)\r\n    assert_eq!(\r\n        Cons {head: Some(&0), tail: Nil},\r\n        Cons {head: Some(&0), tail: Nil}\r\n    );\r\n}\r\n```\r\nThis code compiles and runs on stable.\r\n```\r\n\u279c  rustup default stable\r\ninfo: using existing install for 'stable-x86_64-unknown-linux-gnu'\r\ninfo: default toolchain set to 'stable-x86_64-unknown-linux-gnu'\r\n\r\n  stable-x86_64-unknown-linux-gnu unchanged - rustc 1.30.0 (da5f414c2 2018-10-24)\r\n\r\n\u279c cargo build\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.12s    \r\n```\r\nBut fails on nightly\r\n```bash\r\n\u279c  rustup default nightly\r\ninfo: using existing install for 'nightly-x86_64-unknown-linux-gnu'\r\ninfo: default toolchain set to 'nightly-x86_64-unknown-linux-gnu'\r\n\r\n  nightly-x86_64-unknown-linux-gnu unchanged - rustc 1.31.0-nightly (cae6efc37 2018-10-27)\r\n\r\n\u279c  cargo build\r\n   Compiling typeck v0.1.0                                               \r\nerror[E0080]: it is undefined behavior to use this value                                                \r\n  --> src/main.rs:15:1                                                                                  \r\n   |                                                                                                    \r\n15 | / fn main() {                                                                                      \r\n16 | |                                                                                                  \r\n17 | |     // This part works fine                                                                      \r\n18 | |     let x = Cons {head: Some(&0), tail: Nil};                                                    \r\n...  |                                                                                                  \r\n26 | |     );                                                                                           \r\n27 | | }                                                                                                \r\n   | |_^ type validation failed: encountered a pointer, but expected something that cannot possibly be outside the (wrapping) range 1..=0\r\n   |                                                                                                    \r\n   = note: The rules on what exactly is undefined behavior aren't clear, so this check might be overzealous. Please open an issue on the rust compiler repository if you believe it should not be considered undefined behavior\r\n                                                                                                        \r\nerror: aborting due to previous error                                                                   \r\n                                                                                                        \r\nFor more information about this error, try `rustc --explain E0080`.                                     \r\nerror: Could not compile `typeck`.                                                                      \r\n\r\nTo learn more, run the command again with --verbose.", "closed_by": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/rust-lang/rust/issues/55454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/rust-lang/rust/issues/55454/timeline", "performed_via_github_app": null, "state_reason": "completed"}