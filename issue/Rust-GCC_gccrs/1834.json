{"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834", "repository_url": "https://api.github.com/repos/Rust-GCC/gccrs", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834/labels{/name}", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834/comments", "events_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834/events", "html_url": "https://github.com/Rust-GCC/gccrs/issues/1834", "id": 1576141251, "node_id": "I_kwDOANBUbM5d8gHD", "number": 1834, "title": "ICE on `include!` macro", "user": {"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 61372775, "node_id": "MDU6TGFiZWw2MTM3Mjc3NQ==", "url": "https://api.github.com/repos/Rust-GCC/gccrs/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/milestones/12", "html_url": "https://github.com/Rust-GCC/gccrs/milestone/12", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/milestones/12/labels", "id": 8516486, "node_id": "MI_kwDOANBUbM4AgfOG", "number": 12, "title": "Final upstream patches", "description": "", "creator": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 241, "state": "closed", "created_at": "2022-10-07T08:38:31Z", "updated_at": "2023-06-14T11:12:35Z", "due_on": "2023-04-30T07:00:00Z", "closed_at": "2023-05-10T08:27:18Z"}, "comments": 0, "created_at": "2023-02-08T13:38:08Z", "updated_at": "2023-02-15T14:45:12Z", "closed_at": "2023-02-15T14:45:11Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nThank you for finding an Internal Compiler Error! \ud83e\uddca  If possible, try to provide\r\na minimal verifiable example. You can read \"Rust Bug Minimization Patterns\" for\r\nhow to create smaller examples.\r\n\r\nhttp://blog.pnkfx.org/blog/2019/11/18/rust-bug-minimization-patterns/\r\n\r\n-->\r\n\r\n### Code\r\n\r\n```rust\r\n#[rustc_builtin_macro]\r\nmacro_rules! include {\r\n    () => {{}};\r\n}\r\n\r\ninclude!(\"test.in\");\r\n\r\nfn main() {\r\n    let a = 0;\r\n}\r\n```\r\n\r\nThe file `test.in` can be left empty, the ice is triggered independently from it's content.\r\n\r\n### Meta\r\n\r\n- What version of Rust GCC were you using, git sha if possible.\r\n\r\n```\r\na158a665b35dbacc14f256cad54961d4b25d3c90\r\n```\r\n(macro eager expansion rework)\r\n\r\n### Error output\r\n\r\n```\r\nrust1: note: Preparing to parse files.\r\nrust1: note: inferred crate name: main\r\nrust1: note: Attempting to parse file: /home/patryp/Documents/include_macro/main.rs\r\nrust1: note: in macro rules def, about to parse parens.\r\nrust1: note: begun parsing macro matcher\r\nrust1: note: finished parsing new delim token tree - peeked token is now '}' while t is '}'\r\nrust1: note: finished parsing new delim token tree - peeked token is now ';' while t is '}'\r\nrust1: note: successfully pushed back initial macro rule\r\nrust1: note: broke out of parsing macro rules loop due to finding delim\r\nrust1: note: skipped token is ')', next token (current peek) is 'fn'\r\nrust1: note: beginning crate recursive as-string\r\nrust1: note: SUCCESSFULLY PARSED CRATE\r\nrust1: note: ran register_plugins (with no body)\r\nrust1: note: SUCCESSFULLY REGISTERED PLUGINS\r\nrust1: note: started injection\r\nrust1: note: finished injection\r\nrust1: note: SUCCESSFULLY FINISHED INJECTION\r\nrust1: note: started expansion\r\n/home/patryp/Documents/include_macro/main.rs:2:1: note: inserting macro def: [include]\r\n    2 | macro_rules! include {\r\n      | ^~~~~~~~~~~\r\nrust1: note: Attempting to parse included file /home/patryp/Documents/include_macro/test.in\r\nrust1: internal compiler error: Segmentation fault\r\n```\r\n\r\n<!--\r\nInclude a backtrace if available.\r\n-->\r\n<details><summary>Backtrace</summary>\r\n  <p>\r\n  \r\n  ```\r\n  rust1: internal compiler error: Segmentation fault\r\n0x1109b6f crash_signal\r\n\t../../gcc/toplev.cc:314\r\n0x7f7d18d1fd5f ???\r\n\t./signal/../sysdeps/unix/sysv/linux/x86_64/sigaction.c:0\r\n0xa07882 std::__shared_ptr<Rust::Token const, (__gnu_cxx::_Lock_policy)2>::__shared_ptr(std::__shared_ptr<Rust::Token const, (__gnu_cxx::_Lock_policy)2> const&)\r\n\t/usr/include/c++/10/bits/shared_ptr_base.h:1181\r\n0xa07882 std::shared_ptr<Rust::Token const>::shared_ptr(std::shared_ptr<Rust::Token const> const&)\r\n\t/usr/include/c++/10/bits/shared_ptr.h:149\r\n0xa07882 Rust::AST::Token::Token(Rust::AST::Token const&)\r\n\t../../gcc/rust/ast/rust-ast.h:132\r\n0xa07882 Rust::AST::Token::clone_token_impl() const\r\n\t../../gcc/rust/ast/rust-ast.h:247\r\n0xa07882 Rust::AST::Token::clone_token() const\r\n\t../../gcc/rust/ast/rust-ast.h:158\r\n0xa07882 Rust::AST::Fragment::operator=(Rust::AST::Fragment const&)\r\n\t../../gcc/rust/ast/rust-ast-fragment.cc:47\r\n0xa3b2dd Rust::MacroExpander::expand_invoc(Rust::AST::MacroInvocation&, bool)\r\n\t../../gcc/rust/expand/rust-macro-expand.cc:272\r\n0xa2fade Rust::MacroExpander::expand_crate()\r\n\t../../gcc/rust/expand/rust-macro-expand.cc:409\r\n0xa10bf3 Rust::Session::expansion(Rust::AST::Crate&)\r\n\t../../gcc/rust/rust-session-manager.cc:848\r\n0xa1d382 Rust::Session::compile_crate(char const*)\r\n\t../../gcc/rust/rust-session-manager.cc:556\r\n  ```\r\n  \r\n  </p>\r\n</details>\r\n", "closed_by": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1834/timeline", "performed_via_github_app": null, "state_reason": "completed"}