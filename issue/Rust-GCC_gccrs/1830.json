{"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830", "repository_url": "https://api.github.com/repos/Rust-GCC/gccrs", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830/labels{/name}", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830/comments", "events_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830/events", "html_url": "https://github.com/Rust-GCC/gccrs/issues/1830", "id": 1575892104, "node_id": "I_kwDOANBUbM5d7jSI", "number": 1830, "title": "`include_str` & `include_bytes` macro crash on empty string", "user": {"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 61372775, "node_id": "MDU6TGFiZWw2MTM3Mjc3NQ==", "url": "https://api.github.com/repos/Rust-GCC/gccrs/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/milestones/12", "html_url": "https://github.com/Rust-GCC/gccrs/milestone/12", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/milestones/12/labels", "id": 8516486, "node_id": "MI_kwDOANBUbM4AgfOG", "number": 12, "title": "Final upstream patches", "description": "", "creator": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "open_issues": 0, "closed_issues": 241, "state": "closed", "created_at": "2022-10-07T08:38:31Z", "updated_at": "2023-06-14T11:12:35Z", "due_on": "2023-04-30T07:00:00Z", "closed_at": "2023-05-10T08:27:18Z"}, "comments": 8, "created_at": "2023-02-08T10:46:14Z", "updated_at": "2023-02-14T20:52:18Z", "closed_at": "2023-02-14T20:52:18Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "I tried this code:\r\n\r\n```rust\r\n#[rustc_builtin_macro]\r\nmacro_rules! include_str {\r\n    () => {{}};\r\n}\r\n\r\nfn main() {\r\n    let x = include_str!(\"\");\r\n}\r\n```\r\n\r\nI expected to see this happen:\r\n```\r\nerror: couldn't read src/: Is a directory (os error 21)\r\n```\r\n\r\nInstead, this happened:\r\n```\r\nterminate called after throwing an instance of 'std::bad_alloc'\r\n  what():  std::bad_alloc\r\nrust1: internal compiler error: Aborted\r\n0x1109ecf crash_signal\r\n\t../../gcc/toplev.cc:314\r\n0x7f07ec29ed5f ???\r\n\t./signal/../sysdeps/unix/sysv/linux/x86_64/sigaction.c:0\r\n0x7f07ec29ece1 __GI_raise\r\n\t../sysdeps/unix/sysv/linux/raise.c:51\r\n0x7f07ec288536 __GI_abort\r\n\t./stdlib/abort.c:79\r\n0xa8fe80 __gnu_cxx::new_allocator<unsigned char>::allocate(unsigned long, void const*)\r\n\t/usr/include/c++/10/ext/new_allocator.h:115\r\n0xa8fe80 std::allocator_traits<std::allocator<unsigned char> >::allocate(std::allocator<unsigned char>&, unsigned long)\r\n\t/usr/include/c++/10/bits/alloc_traits.h:460\r\n0xa8fe80 std::_Vector_base<unsigned char, std::allocator<unsigned char> >::_M_allocate(unsigned long)\r\n\t/usr/include/c++/10/bits/stl_vector.h:346\r\n0xa8fe80 std::_Vector_base<unsigned char, std::allocator<unsigned char> >::_M_create_storage(unsigned long)\r\n\t/usr/include/c++/10/bits/stl_vector.h:361\r\n0xa8fe80 std::_Vector_base<unsigned char, std::allocator<unsigned char> >::_Vector_base(unsigned long, std::allocator<unsigned char> const&)\r\n\t/usr/include/c++/10/bits/stl_vector.h:305\r\n0xa8fe80 std::vector<unsigned char, std::allocator<unsigned char> >::vector(unsigned long, std::allocator<unsigned char> const&)\r\n\t/usr/include/c++/10/bits/stl_vector.h:511\r\n0xa8fe80 load_file_bytes\r\n\t../../gcc/rust/expand/rust-macro-builtins.cc:284\r\n0xaa0796 Rust::MacroBuiltin::include_str_handler(Location, Rust::AST::MacroInvocData&)\r\n\t../../gcc/rust/expand/rust-macro-builtins.cc:421\r\n0x99ed93 Rust::AST::Fragment std::__invoke_impl<Rust::AST::Fragment, Rust::AST::Fragment (*&)(Location, Rust::AST::MacroInvocData&), Location, Rust::AST::MacroInvocData&>(std::__invoke_other, Rust::AST::Fragment (*&)(Location, Rust::AST::MacroInvocData&), Location&&, Rust::AST::MacroInvocData&)\r\n\t/usr/include/c++/10/bits/invoke.h:60\r\n0x99ed93 std::enable_if<std::__and_<std::__not_<std::is_void<Rust::AST::Fragment> >, std::is_convertible<std::__invoke_result<Rust::AST::Fragment (*&)(Location, Rust::AST::MacroInvocData&), Location, Rust::AST::MacroInvocData&>::type, Rust::AST::Fragment> >::value, Rust::AST::Fragment>::type std::__invoke_r<Rust::AST::Fragment, Rust::AST::Fragment (*&)(Location, Rust::AST::MacroInvocData&), Location, Rust::AST::MacroInvocData&>(Rust::AST::Fragment (*&)(Location, Rust::AST::MacroInvocData&), Location&&, Rust::AST::MacroInvocData&)\r\n\t/usr/include/c++/10/bits/invoke.h:142\r\n0x99ed93 std::_Function_handler<Rust::AST::Fragment (Location, Rust::AST::MacroInvocData&), Rust::AST::Fragment (*)(Location, Rust::AST::MacroInvocData&)>::_M_invoke(std::_Any_data const&, Location&&, Rust::AST::MacroInvocData&)\r\n\t/usr/include/c++/10/bits/std_function.h:292\r\n0xa3b2fe std::function<Rust::AST::Fragment (Location, Rust::AST::MacroInvocData&)>::operator()(Location, Rust::AST::MacroInvocData&) const\r\n\t/usr/include/c++/10/bits/std_function.h:622\r\n0xa3b2fe Rust::MacroExpander::expand_invoc(Rust::AST::MacroInvocation&, bool)\r\n\t../../gcc/rust/expand/rust-macro-expand.cc:272\r\n0xa87533 Rust::AttrVisitor::visit(Rust::AST::LetStmt&)\r\n\t../../gcc/rust/expand/rust-attribute-visitor.cc:3202\r\n0xa87533 Rust::AttrVisitor::visit(Rust::AST::LetStmt&)\r\n\t../../gcc/rust/expand/rust-attribute-visitor.cc:3162\r\n0xa8b89a void Rust::AttrVisitor::expand_macro_children<std::vector<std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> >, std::allocator<std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> > > >, std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> > >(Rust::MacroExpander::ContextType, std::vector<std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> >, std::allocator<std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> > > >&, std::function<std::unique_ptr<Rust::AST::Stmt, std::default_delete<Rust::AST::Stmt> > (Rust::AST::SingleASTNode)>)\r\n\t../../gcc/rust/expand/rust-attribute-visitor.h:69\r\nPlease submit a full bug report, with preprocessed source (by using -freport-bug).\r\nPlease include the complete backtrace with any bug report.\r\nSee <https://gcc.gnu.org/bugs/> for instructions.\r\n```\r\n\r\n### Meta\r\n\r\n- GCC commits\r\n\r\n```\r\n7f66312db45e3e157123108934f6cf0c71a1c235\r\n```\r\n(master)\r\n\r\n```\r\na158a665b35dbacc14f256cad54961d4b25d3c90\r\n```\r\n(macro rework with eager expansion)\r\n\r\n", "closed_by": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1830/timeline", "performed_via_github_app": null, "state_reason": "completed"}