{"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196", "repository_url": "https://api.github.com/repos/Rust-GCC/gccrs", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196/labels{/name}", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196/comments", "events_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196/events", "html_url": "https://github.com/Rust-GCC/gccrs/issues/1196", "id": 1219126740, "node_id": "I_kwDOANBUbM5IqmXU", "number": 1196, "title": "erroneous \"cannot 'break' outside of a loop\" from match within LoopExpr", "user": {"login": "dafaust", "id": 4460334, "node_id": "MDQ6VXNlcjQ0NjAzMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4460334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dafaust", "html_url": "https://github.com/dafaust", "followers_url": "https://api.github.com/users/dafaust/followers", "following_url": "https://api.github.com/users/dafaust/following{/other_user}", "gists_url": "https://api.github.com/users/dafaust/gists{/gist_id}", "starred_url": "https://api.github.com/users/dafaust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dafaust/subscriptions", "organizations_url": "https://api.github.com/users/dafaust/orgs", "repos_url": "https://api.github.com/users/dafaust/repos", "events_url": "https://api.github.com/users/dafaust/events{/privacy}", "received_events_url": "https://api.github.com/users/dafaust/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 61372775, "node_id": "MDU6TGFiZWw2MTM3Mjc3NQ==", "url": "https://api.github.com/repos/Rust-GCC/gccrs/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "dafaust", "id": 4460334, "node_id": "MDQ6VXNlcjQ0NjAzMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4460334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dafaust", "html_url": "https://github.com/dafaust", "followers_url": "https://api.github.com/users/dafaust/followers", "following_url": "https://api.github.com/users/dafaust/following{/other_user}", "gists_url": "https://api.github.com/users/dafaust/gists{/gist_id}", "starred_url": "https://api.github.com/users/dafaust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dafaust/subscriptions", "organizations_url": "https://api.github.com/users/dafaust/orgs", "repos_url": "https://api.github.com/users/dafaust/repos", "events_url": "https://api.github.com/users/dafaust/events{/privacy}", "received_events_url": "https://api.github.com/users/dafaust/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dafaust", "id": 4460334, "node_id": "MDQ6VXNlcjQ0NjAzMzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4460334?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dafaust", "html_url": "https://github.com/dafaust", "followers_url": "https://api.github.com/users/dafaust/followers", "following_url": "https://api.github.com/users/dafaust/following{/other_user}", "gists_url": "https://api.github.com/users/dafaust/gists{/gist_id}", "starred_url": "https://api.github.com/users/dafaust/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dafaust/subscriptions", "organizations_url": "https://api.github.com/users/dafaust/orgs", "repos_url": "https://api.github.com/users/dafaust/repos", "events_url": "https://api.github.com/users/dafaust/events{/privacy}", "received_events_url": "https://api.github.com/users/dafaust/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2022-04-28T18:42:05Z", "updated_at": "2022-05-04T11:26:15Z", "closed_at": "2022-05-04T11:26:14Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "Bumped into this while investigating #253\r\n\r\nI tried this code:\r\n\r\n```rust\r\nfn bar () -> i32 {\r\n\r\n    let mut x = 0;\r\n    let mut y = 0;\r\n\r\n    loop {\r\n        match x < 100 {\r\n            true => {\r\n                y += x;\r\n                x += 1;\r\n            },\r\n            _ => { break; },\r\n        }\r\n    }\r\n\r\n    return y;\r\n}\r\n\r\nfn main () {\r\n    let z = bar ();\r\n}\r\n\r\n```\r\n\r\nI expected to see this happen: compiles without issue\r\n\r\nInstead, this happened: \r\n```\r\n/home/dfaust/playpen/gccrs/lower-while/bar.rs:13:20: error: cannot \u2018break\u2019 outside of a loop\r\n   13 |             _ => { break; },\r\n      |                    ^\r\n/home/dfaust/playpen/gccrs/lower-while/bar.rs:13:20: error: failed to type resolve expression\r\n```\r\n\r\n<details><summary> backtrace </summary>\r\n<p>\r\n\r\n```\r\n/home/dfaust/playpen/gccrs/lower-while/bar.rs:13:20: error: cannot \u2018break\u2019 outside of a loop\r\n   13 |             _ => { break; },\r\n      |                    ^\r\n\r\nBreakpoint 5, Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffcbd0, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:904\r\n904\t\treturn;\r\n(gdb) bt\r\n#0  Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffcbd0, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:904\r\n#1  0x0000000000f6b5f4 in Rust::HIR::BreakExpr::accept_vis (this=0x32c2da0, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4076\r\n#2  0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32c2da0, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#3  0x000000000104f614 in Rust::Resolver::TypeCheckStmt::visit (this=0x7fffffffccd0, stmt=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-stmt.h:50\r\n#4  0x0000000000f6c5a2 in Rust::HIR::ExprStmtWithoutBlock::accept_vis (this=0x32cab40, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4538\r\n#5  0x000000000104f587 in Rust::Resolver::TypeCheckStmt::Resolve (stmt=0x32cab40, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-stmt.h:39\r\n#6  0x000000000103e2fa in Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffce20, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check.cc:106\r\n#7  0x0000000000f6b558 in Rust::HIR::BlockExpr::accept_vis (this=0x32c0a00, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4058\r\n#8  0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32c0a00, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#9  0x0000000001048818 in Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffcfc0, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:1030\r\n#10 0x0000000000f6ba38 in Rust::HIR::MatchExpr::accept_vis (this=0x32c0c80, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4202\r\n#11 0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32c0c80, inside_loop=true)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#12 0x000000000103e441 in Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffd160, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check.cc:123\r\n#13 0x0000000000f6b558 in Rust::HIR::BlockExpr::accept_vis (this=0x32c0d00, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4058\r\n#14 0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32c0d00, inside_loop=true)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#15 0x0000000001047e40 in Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffd2a0, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:855\r\n#16 0x0000000000f6b7c8 in Rust::HIR::LoopExpr::accept_vis (this=0x32cb0e0, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4130\r\n#17 0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32cb0e0, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#18 0x000000000104f5d2 in Rust::Resolver::TypeCheckStmt::visit (this=0x7fffffffd3a0, stmt=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-stmt.h:45\r\n#19 0x0000000000f6c5d6 in Rust::HIR::ExprStmtWithBlock::accept_vis (this=0x32cb260, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4544\r\n#20 0x000000000104f587 in Rust::Resolver::TypeCheckStmt::Resolve (stmt=0x32cb260, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-stmt.h:39\r\n#21 0x000000000103e2fa in Rust::Resolver::TypeCheckExpr::visit (this=0x7fffffffd4f0, expr=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check.cc:106\r\n#22 0x0000000000f6b558 in Rust::HIR::BlockExpr::accept_vis (this=0x32c1180, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4058\r\n#23 0x0000000001044bd5 in Rust::Resolver::TypeCheckExpr::Resolve (expr=0x32c1180, inside_loop=false)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-expr.h:49\r\n#24 0x0000000001052ad3 in Rust::Resolver::TypeCheckItem::visit (this=0x7fffffffd650, function=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-item.h:213\r\n#25 0x0000000000f6bd08 in Rust::HIR::Function::accept_vis (this=0x32985c0, vis=...)\r\n    at ../../gccrs/gcc/rust/hir/tree/rust-hir-full-test.cc:4286\r\n#26 0x0000000001051d75 in Rust::Resolver::TypeCheckItem::Resolve (item=0x32985c0)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check-item.h:41\r\n#27 0x000000000103e098 in Rust::Resolver::TypeResolution::Resolve (crate=...)\r\n    at ../../gccrs/gcc/rust/typecheck/rust-hir-type-check.cc:47\r\n#28 0x0000000000ebd8e8 in Rust::Session::parse_file (\r\n    this=0x30bc0c0 <Rust::Session::get_instance()::instance>, \r\n--Type <RET> for more, q to quit, c to continue without paging--c\r\n    filename=0x7fffffffe36b \"/home/dfaust/playpen/gccrs/lower-while/bar.rs\") at ../../gccrs/gcc/rust/rust-session-manager.cc:741\r\n#29 0x0000000000ebd03c in Rust::Session::parse_files (this=0x30bc0c0 <Rust::Session::get_instance()::instance>, num_files=1, files=0x32a9430) at ../../gccrs/gcc/rust/rust-session-manager.cc:572\r\n#30 0x0000000000d97a55 in grs_langhook_parse_file () at ../../gccrs/gcc/rust/rust-lang.cc:173\r\n#31 0x00000000015c9cfe in compile_file () at ../../gccrs/gcc/toplev.cc:452\r\n#32 0x0000000000d9545b in do_compile (no_backend=false) at ../../gccrs/gcc/toplev.cc:2158\r\n#33 toplev::main (this=this@entry=0x7fffffffdeae, argc=<optimized out>, argc@entry=17, argv=<optimized out>, argv@entry=0x7fffffffdfb8) at ../../gccrs/gcc/toplev.cc:2310\r\n#34 0x0000000000d9739f in main (argc=17, argv=0x7fffffffdfb8) at ../../gccrs/gcc/main.cc:39\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n\r\n### Meta\r\n\r\n- What version of Rust GCC were you using, git sha if possible: 83e13db1fa12d3ff8751a293595cbf01fd1ac236\r\n\r\n\r\n\r\n", "closed_by": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1196/timeline", "performed_via_github_app": null, "state_reason": "completed"}