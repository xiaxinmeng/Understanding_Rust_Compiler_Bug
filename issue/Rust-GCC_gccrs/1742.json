{"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742", "repository_url": "https://api.github.com/repos/Rust-GCC/gccrs", "labels_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742/labels{/name}", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742/comments", "events_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742/events", "html_url": "https://github.com/Rust-GCC/gccrs/issues/1742", "id": 1533987126, "node_id": "I_kwDOANBUbM5bbsk2", "number": 1742, "title": "Incorrect DWARF for enum types", "user": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 61372775, "node_id": "MDU6TGFiZWw2MTM3Mjc3NQ==", "url": "https://api.github.com/repos/Rust-GCC/gccrs/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2023-01-15T20:31:13Z", "updated_at": "2023-01-15T20:31:13Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nThank you for filing a bug report! \ud83d\udc1b Please provide a short summary of the bug,\r\nalong with any information you feel relevant to replicating the bug.\r\n-->\r\n\r\nI tried this code:\r\n\r\n```rust\r\nenum TheEnum {\r\n    One(u8),\r\n    Two(u16),\r\n}\r\n\r\npub fn main() {\r\n    let x = TheEnum::One(72);\r\n    let y = TheEnum::Two(0);\r\n}\r\n```\r\n\r\nI compiled with `g` and examined the output with `readelf -wi`.  I notice that gccrs is still using the old-style `DISR` description -- this is long obsolete and shouldn't be used.\r\n\r\nIn `rust-compile-type.cc` I see a note:\r\n```\r\n      // Ada, qual_union_types might still work for this but I am not 100% sure.\r\n      // I ran into some issues lets reuse our normal union and ask Ada people\r\n      // about it.\r\n```\r\nThe story here is a bit complicated.  Ada has a more expressive type system than Rust, so it has more needs here.  While looking into this, the GNAT developers realized that the way that DWARF represents variant parts does not make sense (there's a GCC PR for this but I can't find it right now).  However, when adding this feature to rustc, the LLVM developers insisted on a literal reading of the DWARF standard.  So, there's a bit of a divergence here.  Anyway, using the GCC approach is preferable, and if you take this route, I can ensure that gdb handles it properly.\r\n\r\n\r\n### Meta\r\n\r\ngit gcc, commit 2f9f77f9dd6330fe60554400133d7217f78afa43\r\n\r\n\r\n", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Rust-GCC/gccrs/issues/1742/timeline", "performed_via_github_app": null, "state_reason": null}